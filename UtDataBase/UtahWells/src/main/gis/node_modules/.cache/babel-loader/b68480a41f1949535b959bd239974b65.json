{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport { isSome as t } from \"../../../../../core/maybe.js\";\nimport { BucketType as e } from \"../enums.js\";\nimport { VTLSymbol as r } from \"./core.js\";\n\nclass s {\n  constructor(t) {\n    this.tile = t, this.parent = null, this.children = new Set();\n  }\n\n}\n\nclass i {\n  constructor() {\n    this.nodes = new Map(), this.roots = new Set();\n  }\n\n  create(t) {\n    const e = new s(t);\n    let r;\n    const i = [];\n\n    if (this.nodes.forEach(t => {\n      this._canConnectDirectly(e, t) && i.push(t), !r && this._canConnectDirectly(t, e) && (r = t);\n    }), r) {\n      for (const t of i) r.children.delete(t), e.children.add(t), t.parent = e;\n\n      r.children.add(e), e.parent = r;\n    } else {\n      this.roots.add(e);\n\n      for (const t of i) e.children.add(t), t.parent = e, this.roots.delete(t);\n    }\n\n    return this.nodes.set(t.key.id, e), e;\n  }\n\n  destroy(e) {\n    t(e.parent) ? (e.parent.children.delete(e), e.children.forEach(r => {\n      t(e.parent) && e.parent.children.add(r);\n    })) : this.roots.delete(e), e.children.forEach(t => {\n      t.parent = e.parent, e.parent || this.roots.add(t);\n    }), this.nodes.delete(e.tile.key.id);\n  }\n\n  clear() {\n    this.roots.clear(), this.nodes.clear();\n  }\n\n  _canConnectDirectly(t, e) {\n    let {\n      level: r,\n      row: s,\n      col: i\n    } = e.tile.key;\n    const {\n      world: l\n    } = e.tile.key;\n\n    for (; r > 0;) {\n      if (r--, s >>= 1, i >>= 1, t.tile.key.level === r && t.tile.key.row === s && t.tile.key.col === i && t.tile.key.world === l) return !0;\n      if (this.nodes.has(`${r}/${s}/${i}/${l}`)) return !1;\n    }\n\n    return !1;\n  }\n\n}\n\nclass l {\n  constructor() {\n    this._tileGraph = new i(), this._tileArray = null;\n  }\n\n  has(t) {\n    return \"string\" == typeof t ? this._tileGraph.nodes.has(t) : this._tileGraph.nodes.has(t.key.id);\n  }\n\n  getAll() {\n    return this._tileArray || (this._tileArray = [], this._tileGraph.nodes.forEach(t => {\n      this._tileArray.push(t.tile);\n    })), this._tileArray;\n  }\n\n  getRoots() {\n    const t = [];\n    return this._tileGraph.roots.forEach(e => {\n      t.push(e.tile);\n    }), t;\n  }\n\n  getParent(e) {\n    const r = this._tileGraph.nodes.get(\"string\" == typeof e ? e : e.key.id);\n\n    return t(r.parent) && r.parent.tile;\n  }\n\n  getChildren(t) {\n    const e = [];\n    return this._tileGraph.nodes.get(\"string\" == typeof t ? t : t.key.id).children.forEach(t => {\n      e.push(t.tile);\n    }), e;\n  }\n\n  get(t) {\n    return this._tileGraph.nodes.get(t).tile;\n  }\n\n  removeKey(t) {\n    const e = this._tileGraph.nodes.get(t);\n\n    this._tileGraph.destroy(e), this._tileArray = null;\n  }\n\n  forEach(t) {\n    this._tileGraph.nodes.forEach((e, r) => t(e.tile, r));\n  }\n\n  add(t) {\n    this._tileGraph.create(t), this._tileArray = null;\n  }\n\n  remove(t) {\n    const e = this._tileGraph.nodes.get(t.key.id);\n\n    this._tileGraph.destroy(e), this._tileArray = null;\n  }\n\n  clear() {\n    this._tileGraph.clear(), this._tileArray = [];\n  }\n\n}\n\nfunction o(t, e, r, s, i, l) {\n  const o = r - i;\n  if (o >= 0) return (e >> o) + (s - (l << o)) * (t >> o);\n  const n = -o;\n  return e - (l - (s << n)) * (t >> n) << n;\n}\n\nclass n {\n  constructor(t, e, r) {\n    this._rows = Math.ceil(e / r), this._columns = Math.ceil(t / r), this._cellSize = r, this.cells = new Array(this._rows);\n\n    for (let s = 0; s < this._rows; s++) {\n      this.cells[s] = new Array(this._columns);\n\n      for (let t = 0; t < this._columns; t++) this.cells[s][t] = [];\n    }\n  }\n\n  getCell(t, e) {\n    const r = Math.min(Math.max(Math.floor(e / this._cellSize), 0), this._rows - 1),\n          s = Math.min(Math.max(Math.floor(t / this._cellSize), 0), this._columns - 1);\n    return this.cells[r] && this.cells[r][s] || null;\n  }\n\n  getCellSpan(t, e, r, s) {\n    return [Math.min(Math.max(Math.floor(t / this._cellSize), 0), this.columns - 1), Math.min(Math.max(Math.floor(e / this._cellSize), 0), this.rows - 1), Math.min(Math.max(Math.floor(r / this._cellSize), 0), this.columns - 1), Math.min(Math.max(Math.floor(s / this._cellSize), 0), this.rows - 1)];\n  }\n\n  get cellSize() {\n    return this._cellSize;\n  }\n\n  get columns() {\n    return this._columns;\n  }\n\n  get rows() {\n    return this._rows;\n  }\n\n}\n\nfunction h(t, e, s, i, l, o) {\n  const n = e[i++];\n\n  for (let h = 0; h < n; h++) {\n    const n = new r(o);\n    n.xTile = e[i++], n.yTile = e[i++], n.hash = e[i++], n.priority = e[i++];\n    const h = e[i++];\n\n    for (let t = 0; t < h; t++) {\n      const t = e[i++],\n            r = e[i++],\n            l = e[i++],\n            o = e[i++],\n            h = !!e[i++],\n            a = e[i++],\n            c = s[i++],\n            d = s[i++],\n            p = e[i++],\n            u = e[i++];\n      n.colliders.push({\n        xTile: t,\n        yTile: r,\n        dxPixels: l,\n        dyPixels: o,\n        hard: h,\n        partIndex: a,\n        width: p,\n        height: u,\n        minLod: c,\n        maxLod: d\n      });\n    }\n\n    const a = t[i++];\n\n    for (let e = 0; e < a; e++) n.textVertexRanges.push([t[i++], t[i++]]);\n\n    const c = t[i++];\n\n    for (let e = 0; e < c; e++) n.iconVertexRanges.push([t[i++], t[i++]]);\n\n    l.push(n);\n  }\n\n  return i;\n}\n\nfunction a(t, e, r) {\n  for (const [s, i] of t.symbols) c(t, e, r, i, s);\n}\n\nfunction c(t, r, s, i, l) {\n  const o = t.layerData.get(l);\n\n  if (o.type === e.SYMBOL) {\n    for (const e of i) {\n      const r = e.unique;\n      let i;\n\n      if (e.selectedForRendering) {\n        const e = r.parts[0],\n              l = e.startOpacity,\n              o = e.targetOpacity;\n        t.allSymbolsFadingOut = t.allSymbolsFadingOut && 0 === o;\n        const n = s ? Math.floor(127 * l) | o << 7 : o ? 255 : 0;\n        i = n << 24 | n << 16 | n << 8 | n;\n      } else i = 0;\n\n      for (const [t, s] of e.iconVertexRanges) for (let e = t; e < t + s; e += 4) o.iconOpacity[e / 4] = i;\n\n      if (e.selectedForRendering) {\n        const e = r.parts[1],\n              l = e.startOpacity,\n              o = e.targetOpacity;\n        t.allSymbolsFadingOut = t.allSymbolsFadingOut && 0 === o;\n        const n = s ? Math.floor(127 * l) | o << 7 : o ? 255 : 0;\n        i = n << 24 | n << 16 | n << 8 | n;\n      } else i = 0;\n\n      for (const [t, s] of e.textVertexRanges) for (let e = t; e < t + s; e += 4) o.textOpacity[e / 4] = i;\n    }\n\n    o.lastOpacityUpdate = r, o.opacityChanged = !0;\n  }\n}\n\nexport { n as GridIndex, l as TileForest, i as TileGraph, s as TileNode, h as deserializeSymbols, o as tileCoordChange, a as writeOpacityToBuffers };","map":{"version":3,"sources":["D:/Github/CUSP_DataBase/CUSP_DB/src/main/gis/node_modules/@arcgis/core/views/2d/engine/vectorTiles/decluttering/util.js"],"names":["isSome","t","BucketType","e","VTLSymbol","r","s","constructor","tile","parent","children","Set","i","nodes","Map","roots","create","forEach","_canConnectDirectly","push","delete","add","set","key","id","destroy","clear","level","row","col","world","l","has","_tileGraph","_tileArray","getAll","getRoots","getParent","get","getChildren","removeKey","remove","o","n","_rows","Math","ceil","_columns","_cellSize","cells","Array","getCell","min","max","floor","getCellSpan","columns","rows","cellSize","h","xTile","yTile","hash","priority","a","c","d","p","u","colliders","dxPixels","dyPixels","hard","partIndex","width","height","minLod","maxLod","textVertexRanges","iconVertexRanges","symbols","layerData","type","SYMBOL","unique","selectedForRendering","parts","startOpacity","targetOpacity","allSymbolsFadingOut","iconOpacity","textOpacity","lastOpacityUpdate","opacityChanged","GridIndex","TileForest","TileGraph","TileNode","deserializeSymbols","tileCoordChange","writeOpacityToBuffers"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport{isSome as t}from\"../../../../../core/maybe.js\";import{BucketType as e}from\"../enums.js\";import{VTLSymbol as r}from\"./core.js\";class s{constructor(t){this.tile=t,this.parent=null,this.children=new Set}}class i{constructor(){this.nodes=new Map,this.roots=new Set}create(t){const e=new s(t);let r;const i=[];if(this.nodes.forEach((t=>{this._canConnectDirectly(e,t)&&i.push(t),!r&&this._canConnectDirectly(t,e)&&(r=t)})),r){for(const t of i)r.children.delete(t),e.children.add(t),t.parent=e;r.children.add(e),e.parent=r}else{this.roots.add(e);for(const t of i)e.children.add(t),t.parent=e,this.roots.delete(t)}return this.nodes.set(t.key.id,e),e}destroy(e){t(e.parent)?(e.parent.children.delete(e),e.children.forEach((r=>{t(e.parent)&&e.parent.children.add(r)}))):this.roots.delete(e),e.children.forEach((t=>{t.parent=e.parent,e.parent||this.roots.add(t)})),this.nodes.delete(e.tile.key.id)}clear(){this.roots.clear(),this.nodes.clear()}_canConnectDirectly(t,e){let{level:r,row:s,col:i}=e.tile.key;const{world:l}=e.tile.key;for(;r>0;){if(r--,s>>=1,i>>=1,t.tile.key.level===r&&t.tile.key.row===s&&t.tile.key.col===i&&t.tile.key.world===l)return!0;if(this.nodes.has(`${r}/${s}/${i}/${l}`))return!1}return!1}}class l{constructor(){this._tileGraph=new i,this._tileArray=null}has(t){return\"string\"==typeof t?this._tileGraph.nodes.has(t):this._tileGraph.nodes.has(t.key.id)}getAll(){return this._tileArray||(this._tileArray=[],this._tileGraph.nodes.forEach((t=>{this._tileArray.push(t.tile)}))),this._tileArray}getRoots(){const t=[];return this._tileGraph.roots.forEach((e=>{t.push(e.tile)})),t}getParent(e){const r=this._tileGraph.nodes.get(\"string\"==typeof e?e:e.key.id);return t(r.parent)&&r.parent.tile}getChildren(t){const e=[];return this._tileGraph.nodes.get(\"string\"==typeof t?t:t.key.id).children.forEach((t=>{e.push(t.tile)})),e}get(t){return this._tileGraph.nodes.get(t).tile}removeKey(t){const e=this._tileGraph.nodes.get(t);this._tileGraph.destroy(e),this._tileArray=null}forEach(t){this._tileGraph.nodes.forEach(((e,r)=>t(e.tile,r)))}add(t){this._tileGraph.create(t),this._tileArray=null}remove(t){const e=this._tileGraph.nodes.get(t.key.id);this._tileGraph.destroy(e),this._tileArray=null}clear(){this._tileGraph.clear(),this._tileArray=[]}}function o(t,e,r,s,i,l){const o=r-i;if(o>=0)return(e>>o)+(s-(l<<o))*(t>>o);const n=-o;return e-(l-(s<<n))*(t>>n)<<n}class n{constructor(t,e,r){this._rows=Math.ceil(e/r),this._columns=Math.ceil(t/r),this._cellSize=r,this.cells=new Array(this._rows);for(let s=0;s<this._rows;s++){this.cells[s]=new Array(this._columns);for(let t=0;t<this._columns;t++)this.cells[s][t]=[]}}getCell(t,e){const r=Math.min(Math.max(Math.floor(e/this._cellSize),0),this._rows-1),s=Math.min(Math.max(Math.floor(t/this._cellSize),0),this._columns-1);return this.cells[r]&&this.cells[r][s]||null}getCellSpan(t,e,r,s){return[Math.min(Math.max(Math.floor(t/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(e/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(r/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(s/this._cellSize),0),this.rows-1)]}get cellSize(){return this._cellSize}get columns(){return this._columns}get rows(){return this._rows}}function h(t,e,s,i,l,o){const n=e[i++];for(let h=0;h<n;h++){const n=new r(o);n.xTile=e[i++],n.yTile=e[i++],n.hash=e[i++],n.priority=e[i++];const h=e[i++];for(let t=0;t<h;t++){const t=e[i++],r=e[i++],l=e[i++],o=e[i++],h=!!e[i++],a=e[i++],c=s[i++],d=s[i++],p=e[i++],u=e[i++];n.colliders.push({xTile:t,yTile:r,dxPixels:l,dyPixels:o,hard:h,partIndex:a,width:p,height:u,minLod:c,maxLod:d})}const a=t[i++];for(let e=0;e<a;e++)n.textVertexRanges.push([t[i++],t[i++]]);const c=t[i++];for(let e=0;e<c;e++)n.iconVertexRanges.push([t[i++],t[i++]]);l.push(n)}return i}function a(t,e,r){for(const[s,i]of t.symbols)c(t,e,r,i,s)}function c(t,r,s,i,l){const o=t.layerData.get(l);if(o.type===e.SYMBOL){for(const e of i){const r=e.unique;let i;if(e.selectedForRendering){const e=r.parts[0],l=e.startOpacity,o=e.targetOpacity;t.allSymbolsFadingOut=t.allSymbolsFadingOut&&0===o;const n=s?Math.floor(127*l)|o<<7:o?255:0;i=n<<24|n<<16|n<<8|n}else i=0;for(const[t,s]of e.iconVertexRanges)for(let e=t;e<t+s;e+=4)o.iconOpacity[e/4]=i;if(e.selectedForRendering){const e=r.parts[1],l=e.startOpacity,o=e.targetOpacity;t.allSymbolsFadingOut=t.allSymbolsFadingOut&&0===o;const n=s?Math.floor(127*l)|o<<7:o?255:0;i=n<<24|n<<16|n<<8|n}else i=0;for(const[t,s]of e.textVertexRanges)for(let e=t;e<t+s;e+=4)o.textOpacity[e/4]=i}o.lastOpacityUpdate=r,o.opacityChanged=!0}}export{n as GridIndex,l as TileForest,i as TileGraph,s as TileNode,h as deserializeSymbols,o as tileCoordChange,a as writeOpacityToBuffers};\n"]},"metadata":{},"sourceType":"module"}