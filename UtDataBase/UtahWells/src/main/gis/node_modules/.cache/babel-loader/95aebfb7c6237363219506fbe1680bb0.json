{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport e from \"../../../Color.js\";\nimport a from \"../../../Graphic.js\";\nimport { neverReached as r } from \"../../../core/compilerUtils.js\";\nimport i from \"../../../core/Logger.js\";\nimport { isSome as n, isNone as t } from \"../../../core/maybe.js\";\nimport { meterIn as s } from \"../../support/lengthUtils.js\";\nimport { isSizeVariable as o, isValidNumber as l, TransformationType as c, InputValueType as u } from \"./sizeVariableUtils.js\";\nconst f = i.getLogger(\"esri.renderers.visualVariables.support.visualVariableUtils\"),\n      p = new a(),\n      d = Math.PI,\n      v = /^\\s*(return\\s+)?\\$view\\.scale\\s*(;)?\\s*$/i;\n\nfunction b(a, r, i) {\n  const t = \"visualVariables\" in a && a.visualVariables ? a.visualVariables.find(e => \"color\" === e.type) : a;\n  if (!t) return;\n  if (\"esri.renderers.visualVariables.ColorVariable\" !== t.declaredClass) return void f.warn(\"The visualVariable should be an instance of esri.renderers.visualVariables.ColorVariable\");\n  const s = \"number\" == typeof r,\n        o = s ? null : r,\n        l = o && o.attributes;\n  let c = s ? r : null;\n  const u = t.field,\n        {\n    ipData: p,\n    hasExpression: d\n  } = t.cache;\n  let v = t.cache.compiledFunc;\n\n  if (!u && !d) {\n    const e = t.stops;\n    return e && e[0] && e[0].color;\n  }\n\n  if (\"number\" != typeof c) if (d) {\n    if (!n(i) || !n(i.arcade)) return void f.error(\"Use of arcade expressions requires an arcade context\");\n    const e = {\n      viewingMode: i.viewingMode,\n      scale: i.scale,\n      spatialReference: i.spatialReference\n    },\n          a = i.arcade.arcadeUtils,\n          r = a.getViewInfo(e),\n          s = a.createExecContext(o, r);\n\n    if (!v) {\n      const e = a.createSyntaxTree(t.valueExpression);\n      v = a.createFunction(e), t.cache.compiledFunc = v;\n    }\n\n    c = a.executeFunction(v, s);\n  } else l && (c = l[u]);\n  const b = t.normalizationField,\n        h = l ? parseFloat(l[b]) : void 0;\n\n  if (null != c && (!b || s || !isNaN(h) && 0 !== h)) {\n    isNaN(h) || s || (c /= h);\n    const a = R(c, p);\n\n    if (a) {\n      const r = a[0],\n            s = a[1],\n            o = r === s ? t.stops[r].color : e.blendColors(t.stops[r].color, t.stops[s].color, a[2], n(i) ? i.color : void 0);\n      return new e(o);\n    }\n  }\n}\n\nfunction h(e, a, r) {\n  const i = \"visualVariables\" in e && e.visualVariables ? e.visualVariables.find(e => \"opacity\" === e.type) : e;\n  if (!i) return;\n  if (\"esri.renderers.visualVariables.OpacityVariable\" !== i.declaredClass) return void f.warn(\"The visualVariable should be an instance of esri.renderers.visualVariables.OpacityVariable\");\n  const n = \"number\" == typeof a,\n        s = n ? null : a,\n        o = s && s.attributes;\n  let l = n ? a : null;\n  const c = i.field,\n        {\n    ipData: u,\n    hasExpression: p\n  } = i.cache;\n  let d = i.cache.compiledFunc;\n\n  if (!c && !p) {\n    const e = i.stops;\n    return e && e[0] && e[0].opacity;\n  }\n\n  if (\"number\" != typeof l) if (p) {\n    if (t(r) || t(r.arcade)) return void f.error(\"Use of arcade expressions requires an arcade context\");\n    const e = {\n      viewingMode: r.viewingMode,\n      scale: r.scale,\n      spatialReference: r.spatialReference\n    },\n          a = r.arcade.arcadeUtils,\n          n = a.getViewInfo(e),\n          o = a.createExecContext(s, n);\n\n    if (!d) {\n      const e = a.createSyntaxTree(i.valueExpression);\n      d = a.createFunction(e), i.cache.compiledFunc = d;\n    }\n\n    l = a.executeFunction(d, o);\n  } else o && (l = o[c]);\n  const v = i.normalizationField,\n        b = o ? parseFloat(o[v]) : void 0;\n\n  if (null != l && (!v || n || !isNaN(b) && 0 !== b)) {\n    isNaN(b) || n || (l /= b);\n    const e = R(l, u);\n\n    if (e) {\n      const a = e[0],\n            r = e[1];\n      if (a === r) return i.stops[a].opacity;\n      {\n        const n = i.stops[a].opacity;\n        return n + (i.stops[r].opacity - n) * e[2];\n      }\n    }\n  }\n}\n\nfunction m(e, a, r) {\n  const i = \"visualVariables\" in e && e.visualVariables ? e.visualVariables.find(e => \"rotation\" === e.type) : e;\n  if (!i) return;\n  if (\"esri.renderers.visualVariables.RotationVariable\" !== i.declaredClass) return void f.warn(\"The visualVariable should be an instance of esri.renderers.visualVariables.RotationVariable\");\n  const n = i.axis || \"heading\",\n        s = \"heading\" === n && \"arithmetic\" === i.rotationType ? 90 : 0,\n        o = \"heading\" === n && \"arithmetic\" === i.rotationType ? -1 : 1,\n        l = \"number\" == typeof a ? null : a,\n        c = l && l.attributes,\n        u = i.field,\n        {\n    hasExpression: p\n  } = i.cache;\n  let d = i.cache.compiledFunc,\n      v = 0;\n  if (!u && !p) return v;\n\n  if (p) {\n    if (t(r) || t(r.arcade)) return void f.error(\"Use of arcade expressions requires an arcade context\");\n    const e = {\n      viewingMode: r.viewingMode,\n      scale: r.scale,\n      spatialReference: r.spatialReference\n    },\n          a = r.arcade.arcadeUtils,\n          n = a.getViewInfo(e),\n          s = a.createExecContext(l, n);\n\n    if (!d) {\n      const e = a.createSyntaxTree(i.valueExpression);\n      d = a.createFunction(e), i.cache.compiledFunc = d;\n    }\n\n    v = a.executeFunction(d, s);\n  } else c && (v = c[u] || 0);\n\n  return v = \"number\" != typeof v || isNaN(v) ? null : s + o * v, v;\n}\n\nfunction V(e, a, r) {\n  const i = \"number\" == typeof a,\n        s = i ? null : a,\n        o = s && s.attributes;\n  let c = i ? a : null;\n  const {\n    isScaleDriven: p\n  } = e.cache;\n  let d = e.cache.compiledFunc;\n\n  if (p) {\n    const a = n(r) ? r.scale : void 0,\n          i = n(r) ? r.view : void 0;\n    c = null == a || \"3d\" === i ? x(e) : a;\n  } else if (!i) switch (e.inputValueType) {\n    case u.Expression:\n      {\n        if (t(r) || t(r.arcade)) return void f.error(\"Use of arcade expressions requires an arcade context\");\n        const a = {\n          viewingMode: r.viewingMode,\n          scale: r.scale,\n          spatialReference: r.spatialReference\n        },\n              i = r.arcade.arcadeUtils,\n              n = i.getViewInfo(a),\n              o = i.createExecContext(s, n);\n\n        if (!d) {\n          const a = i.createSyntaxTree(e.valueExpression);\n          d = i.createFunction(a), e.cache.compiledFunc = d;\n        }\n\n        c = i.executeFunction(d, o);\n        break;\n      }\n\n    case u.Field:\n      o && (c = o[e.field]);\n      break;\n\n    case u.Unknown:\n      c = null;\n  }\n\n  if (!l(c)) return null;\n  if (i || !e.normalizationField) return c;\n  const v = o ? parseFloat(o[e.normalizationField]) : null;\n  return l(v) && 0 !== v ? c / v : null;\n}\n\nfunction x(e) {\n  let a = null,\n      r = null;\n  const i = e.stops;\n  return i ? (a = i[0].value, r = i[i.length - 1].value) : (a = e.minDataValue || 0, r = e.maxDataValue || 0), (a + r) / 2;\n}\n\nfunction y(e, a, r) {\n  const i = \"visualVariables\" in e && e.visualVariables ? e.visualVariables.find(e => \"size\" === e.type) : e;\n  if (!i) return;\n  if (\"esri.renderers.visualVariables.SizeVariable\" !== i.declaredClass) return void f.warn(\"The visualVariable should be an instance of esri.renderers.visualVariables.SizeVariable\");\n  const n = M(V(i, a, r), i, a, r, i.cache.ipData);\n  return null == n || isNaN(n) ? 0 : n;\n}\n\nfunction w(e, a, r) {\n  return null == e ? null : o(e) ? y(e, a, r) : l(e) ? e : null;\n}\n\nfunction g(e, a, r) {\n  return l(r) && e > r ? r : l(a) && e < a ? a : e;\n}\n\nfunction z(e, a, r, i) {\n  return e + (w(a.minSize, r, i) || a.minDataValue);\n}\n\nfunction F(e, a, r) {\n  const i = e.stops;\n  let n = i && i.length && i[0].size;\n  return null == n && (n = e.minSize), w(n, a, r);\n}\n\nfunction S(e, a, r, i) {\n  const t = (e - a.minDataValue) / (a.maxDataValue - a.minDataValue),\n        s = w(a.minSize, r, i),\n        o = w(a.maxSize, r, i),\n        l = n(i) ? i.shape : void 0;\n  if (e <= a.minDataValue) return s;\n  if (e >= a.maxDataValue) return o;\n\n  if (\"area\" === a.scaleBy && l) {\n    const e = \"circle\" === l,\n          a = e ? d * (s / 2) ** 2 : s * s,\n          r = a + t * ((e ? d * (o / 2) ** 2 : o * o) - a);\n    return e ? 2 * Math.sqrt(r / d) : Math.sqrt(r);\n  }\n\n  return s + t * (o - s);\n}\n\nfunction E(e, a, r, i) {\n  const t = n(i) ? i.shape : void 0,\n        s = e / a.minDataValue,\n        o = w(a.minSize, r, i),\n        l = w(a.maxSize, r, i);\n  let c = null;\n  return c = \"circle\" === t ? 2 * Math.sqrt(s * (o / 2) ** 2) : \"square\" === t || \"diamond\" === t || \"image\" === t ? Math.sqrt(s * o ** 2) : s * o, g(c, o, l);\n}\n\nfunction U(e, a, r, i, n) {\n  const [t, s, o] = R(e, n);\n  if (t === s) return w(a.stops[t].size, r, i);\n  {\n    const e = w(a.stops[t].size, r, i);\n    return e + (w(a.stops[s].size, r, i) - e) * o;\n  }\n}\n\nfunction C(e, a, r, i) {\n  const t = (n(i) && i.resolution ? i.resolution : 1) * s[a.valueUnit],\n        o = w(a.minSize, r, i),\n        l = w(a.maxSize, r, i),\n        {\n    valueRepresentation: c\n  } = a;\n  let u = null;\n  return u = \"area\" === c ? 2 * Math.sqrt(e / d) / t : \"radius\" === c || \"distance\" === c ? 2 * e / t : e / t, g(u, o, l);\n}\n\nfunction D(e) {\n  return e;\n}\n\nfunction M(e, a, r, i, n) {\n  switch (a.transformationType) {\n    case c.Additive:\n      return z(e, a, r, i);\n\n    case c.Constant:\n      return F(a, r, i);\n\n    case c.ClampedLinear:\n      return S(e, a, r, i);\n\n    case c.Proportional:\n      return E(e, a, r, i);\n\n    case c.Stops:\n      return U(e, a, r, i, n);\n\n    case c.RealWorldSize:\n      return C(e, a, r, i);\n\n    case c.Identity:\n      return D(e);\n\n    case c.Unknown:\n      return null;\n  }\n}\n\nfunction k(e, a, r) {\n  const {\n    isScaleDriven: i\n  } = e.cache;\n  if (!(i && \"3d\" === r || a)) return null;\n  const n = {\n    scale: a,\n    view: r\n  };\n  let t = w(e.minSize, p, n),\n      s = w(e.maxSize, p, n);\n\n  if (null != t || null != s) {\n    if (t > s) {\n      const e = s;\n      s = t, t = e;\n    }\n\n    return {\n      minSize: t,\n      maxSize: s\n    };\n  }\n}\n\nfunction N(e, a, r) {\n  if (!e.visualVariables) return;\n  const i = [],\n        n = [],\n        t = [],\n        s = [],\n        o = [];\n\n  for (const l of e.visualVariables) switch (l.type) {\n    case \"color\":\n      n.push(l);\n      break;\n\n    case \"opacity\":\n      t.push(l);\n      break;\n\n    case \"rotation\":\n      o.push(l);\n      break;\n\n    case \"size\":\n      s.push(l);\n  }\n\n  return n.forEach(e => {\n    const n = b(e, a, r);\n    i.push({\n      variable: e,\n      value: n\n    });\n  }), t.forEach(e => {\n    const n = h(e, a, r);\n    i.push({\n      variable: e,\n      value: n\n    });\n  }), o.forEach(e => {\n    const n = m(e, a, r);\n    i.push({\n      variable: e,\n      value: n\n    });\n  }), s.forEach(e => {\n    const n = y(e, a, r);\n    i.push({\n      variable: e,\n      value: n\n    });\n  }), i.filter(e => null != e.value);\n}\n\nfunction R(e, a) {\n  if (!a) return;\n  let r = 0,\n      i = a.length - 1;\n  return a.some((a, n) => e < a ? (i = n, !0) : (r = n, !1)), [r, i, (e - a[r]) / (a[i] - a[r])];\n}\n\nfunction T(e, a, i) {\n  const n = [\"proportional\", \"proportional\", \"proportional\"];\n\n  for (const t of e) {\n    const e = t.useSymbolValue ? \"symbol-value\" : y(t, a, i);\n\n    switch (t.axis) {\n      case \"width\":\n        n[0] = e;\n        break;\n\n      case \"depth\":\n        n[1] = e;\n        break;\n\n      case \"height\":\n        n[2] = e;\n        break;\n\n      case \"width-and-depth\":\n        n[0] = e, n[1] = e;\n        break;\n\n      case \"all\":\n      case void 0:\n      case null:\n        n[0] = e, n[1] = e, n[2] = e;\n        break;\n\n      default:\n        r(t.axis);\n    }\n  }\n\n  return n;\n}\n\nexport { T as getAllSizes, b as getColor, h as getOpacity, m as getRotationAngle, y as getSize, M as getSizeForValue, w as getSizeFromNumberOrVariable, k as getSizeRangeAtScale, N as getVisualVariableValues, v as viewScaleRE };","map":{"version":3,"sources":["D:/Github/CUSP_DataBase/CUSP_DB/src/main/gis/node_modules/@arcgis/core/renderers/visualVariables/support/visualVariableUtils.js"],"names":["e","a","neverReached","r","i","isSome","n","isNone","t","meterIn","s","isSizeVariable","o","isValidNumber","l","TransformationType","c","InputValueType","u","f","getLogger","p","d","Math","PI","v","b","visualVariables","find","type","declaredClass","warn","attributes","field","ipData","hasExpression","cache","compiledFunc","stops","color","arcade","error","viewingMode","scale","spatialReference","arcadeUtils","getViewInfo","createExecContext","createSyntaxTree","valueExpression","createFunction","executeFunction","normalizationField","h","parseFloat","isNaN","R","blendColors","opacity","m","axis","rotationType","V","isScaleDriven","view","x","inputValueType","Expression","Field","Unknown","value","length","minDataValue","maxDataValue","y","M","w","g","z","minSize","F","size","S","maxSize","shape","scaleBy","sqrt","E","U","C","resolution","valueUnit","valueRepresentation","D","transformationType","Additive","Constant","ClampedLinear","Proportional","Stops","RealWorldSize","Identity","k","N","push","forEach","variable","filter","some","T","useSymbolValue","getAllSizes","getColor","getOpacity","getRotationAngle","getSize","getSizeForValue","getSizeFromNumberOrVariable","getSizeRangeAtScale","getVisualVariableValues","viewScaleRE"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport e from\"../../../Color.js\";import a from\"../../../Graphic.js\";import{neverReached as r}from\"../../../core/compilerUtils.js\";import i from\"../../../core/Logger.js\";import{isSome as n,isNone as t}from\"../../../core/maybe.js\";import{meterIn as s}from\"../../support/lengthUtils.js\";import{isSizeVariable as o,isValidNumber as l,TransformationType as c,InputValueType as u}from\"./sizeVariableUtils.js\";const f=i.getLogger(\"esri.renderers.visualVariables.support.visualVariableUtils\"),p=new a,d=Math.PI,v=/^\\s*(return\\s+)?\\$view\\.scale\\s*(;)?\\s*$/i;function b(a,r,i){const t=\"visualVariables\"in a&&a.visualVariables?a.visualVariables.find((e=>\"color\"===e.type)):a;if(!t)return;if(\"esri.renderers.visualVariables.ColorVariable\"!==t.declaredClass)return void f.warn(\"The visualVariable should be an instance of esri.renderers.visualVariables.ColorVariable\");const s=\"number\"==typeof r,o=s?null:r,l=o&&o.attributes;let c=s?r:null;const u=t.field,{ipData:p,hasExpression:d}=t.cache;let v=t.cache.compiledFunc;if(!u&&!d){const e=t.stops;return e&&e[0]&&e[0].color}if(\"number\"!=typeof c)if(d){if(!n(i)||!n(i.arcade))return void f.error(\"Use of arcade expressions requires an arcade context\");const e={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},a=i.arcade.arcadeUtils,r=a.getViewInfo(e),s=a.createExecContext(o,r);if(!v){const e=a.createSyntaxTree(t.valueExpression);v=a.createFunction(e),t.cache.compiledFunc=v}c=a.executeFunction(v,s)}else l&&(c=l[u]);const b=t.normalizationField,h=l?parseFloat(l[b]):void 0;if(null!=c&&(!b||s||!isNaN(h)&&0!==h)){isNaN(h)||s||(c/=h);const a=R(c,p);if(a){const r=a[0],s=a[1],o=r===s?t.stops[r].color:e.blendColors(t.stops[r].color,t.stops[s].color,a[2],n(i)?i.color:void 0);return new e(o)}}}function h(e,a,r){const i=\"visualVariables\"in e&&e.visualVariables?e.visualVariables.find((e=>\"opacity\"===e.type)):e;if(!i)return;if(\"esri.renderers.visualVariables.OpacityVariable\"!==i.declaredClass)return void f.warn(\"The visualVariable should be an instance of esri.renderers.visualVariables.OpacityVariable\");const n=\"number\"==typeof a,s=n?null:a,o=s&&s.attributes;let l=n?a:null;const c=i.field,{ipData:u,hasExpression:p}=i.cache;let d=i.cache.compiledFunc;if(!c&&!p){const e=i.stops;return e&&e[0]&&e[0].opacity}if(\"number\"!=typeof l)if(p){if(t(r)||t(r.arcade))return void f.error(\"Use of arcade expressions requires an arcade context\");const e={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},a=r.arcade.arcadeUtils,n=a.getViewInfo(e),o=a.createExecContext(s,n);if(!d){const e=a.createSyntaxTree(i.valueExpression);d=a.createFunction(e),i.cache.compiledFunc=d}l=a.executeFunction(d,o)}else o&&(l=o[c]);const v=i.normalizationField,b=o?parseFloat(o[v]):void 0;if(null!=l&&(!v||n||!isNaN(b)&&0!==b)){isNaN(b)||n||(l/=b);const e=R(l,u);if(e){const a=e[0],r=e[1];if(a===r)return i.stops[a].opacity;{const n=i.stops[a].opacity;return n+(i.stops[r].opacity-n)*e[2]}}}}function m(e,a,r){const i=\"visualVariables\"in e&&e.visualVariables?e.visualVariables.find((e=>\"rotation\"===e.type)):e;if(!i)return;if(\"esri.renderers.visualVariables.RotationVariable\"!==i.declaredClass)return void f.warn(\"The visualVariable should be an instance of esri.renderers.visualVariables.RotationVariable\");const n=i.axis||\"heading\",s=\"heading\"===n&&\"arithmetic\"===i.rotationType?90:0,o=\"heading\"===n&&\"arithmetic\"===i.rotationType?-1:1,l=\"number\"==typeof a?null:a,c=l&&l.attributes,u=i.field,{hasExpression:p}=i.cache;let d=i.cache.compiledFunc,v=0;if(!u&&!p)return v;if(p){if(t(r)||t(r.arcade))return void f.error(\"Use of arcade expressions requires an arcade context\");const e={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},a=r.arcade.arcadeUtils,n=a.getViewInfo(e),s=a.createExecContext(l,n);if(!d){const e=a.createSyntaxTree(i.valueExpression);d=a.createFunction(e),i.cache.compiledFunc=d}v=a.executeFunction(d,s)}else c&&(v=c[u]||0);return v=\"number\"!=typeof v||isNaN(v)?null:s+o*v,v}function V(e,a,r){const i=\"number\"==typeof a,s=i?null:a,o=s&&s.attributes;let c=i?a:null;const{isScaleDriven:p}=e.cache;let d=e.cache.compiledFunc;if(p){const a=n(r)?r.scale:void 0,i=n(r)?r.view:void 0;c=null==a||\"3d\"===i?x(e):a}else if(!i)switch(e.inputValueType){case u.Expression:{if(t(r)||t(r.arcade))return void f.error(\"Use of arcade expressions requires an arcade context\");const a={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},i=r.arcade.arcadeUtils,n=i.getViewInfo(a),o=i.createExecContext(s,n);if(!d){const a=i.createSyntaxTree(e.valueExpression);d=i.createFunction(a),e.cache.compiledFunc=d}c=i.executeFunction(d,o);break}case u.Field:o&&(c=o[e.field]);break;case u.Unknown:c=null}if(!l(c))return null;if(i||!e.normalizationField)return c;const v=o?parseFloat(o[e.normalizationField]):null;return l(v)&&0!==v?c/v:null}function x(e){let a=null,r=null;const i=e.stops;return i?(a=i[0].value,r=i[i.length-1].value):(a=e.minDataValue||0,r=e.maxDataValue||0),(a+r)/2}function y(e,a,r){const i=\"visualVariables\"in e&&e.visualVariables?e.visualVariables.find((e=>\"size\"===e.type)):e;if(!i)return;if(\"esri.renderers.visualVariables.SizeVariable\"!==i.declaredClass)return void f.warn(\"The visualVariable should be an instance of esri.renderers.visualVariables.SizeVariable\");const n=M(V(i,a,r),i,a,r,i.cache.ipData);return null==n||isNaN(n)?0:n}function w(e,a,r){return null==e?null:o(e)?y(e,a,r):l(e)?e:null}function g(e,a,r){return l(r)&&e>r?r:l(a)&&e<a?a:e}function z(e,a,r,i){return e+(w(a.minSize,r,i)||a.minDataValue)}function F(e,a,r){const i=e.stops;let n=i&&i.length&&i[0].size;return null==n&&(n=e.minSize),w(n,a,r)}function S(e,a,r,i){const t=(e-a.minDataValue)/(a.maxDataValue-a.minDataValue),s=w(a.minSize,r,i),o=w(a.maxSize,r,i),l=n(i)?i.shape:void 0;if(e<=a.minDataValue)return s;if(e>=a.maxDataValue)return o;if(\"area\"===a.scaleBy&&l){const e=\"circle\"===l,a=e?d*(s/2)**2:s*s,r=a+t*((e?d*(o/2)**2:o*o)-a);return e?2*Math.sqrt(r/d):Math.sqrt(r)}return s+t*(o-s)}function E(e,a,r,i){const t=n(i)?i.shape:void 0,s=e/a.minDataValue,o=w(a.minSize,r,i),l=w(a.maxSize,r,i);let c=null;return c=\"circle\"===t?2*Math.sqrt(s*(o/2)**2):\"square\"===t||\"diamond\"===t||\"image\"===t?Math.sqrt(s*o**2):s*o,g(c,o,l)}function U(e,a,r,i,n){const[t,s,o]=R(e,n);if(t===s)return w(a.stops[t].size,r,i);{const e=w(a.stops[t].size,r,i);return e+(w(a.stops[s].size,r,i)-e)*o}}function C(e,a,r,i){const t=(n(i)&&i.resolution?i.resolution:1)*s[a.valueUnit],o=w(a.minSize,r,i),l=w(a.maxSize,r,i),{valueRepresentation:c}=a;let u=null;return u=\"area\"===c?2*Math.sqrt(e/d)/t:\"radius\"===c||\"distance\"===c?2*e/t:e/t,g(u,o,l)}function D(e){return e}function M(e,a,r,i,n){switch(a.transformationType){case c.Additive:return z(e,a,r,i);case c.Constant:return F(a,r,i);case c.ClampedLinear:return S(e,a,r,i);case c.Proportional:return E(e,a,r,i);case c.Stops:return U(e,a,r,i,n);case c.RealWorldSize:return C(e,a,r,i);case c.Identity:return D(e);case c.Unknown:return null}}function k(e,a,r){const{isScaleDriven:i}=e.cache;if(!(i&&\"3d\"===r||a))return null;const n={scale:a,view:r};let t=w(e.minSize,p,n),s=w(e.maxSize,p,n);if(null!=t||null!=s){if(t>s){const e=s;s=t,t=e}return{minSize:t,maxSize:s}}}function N(e,a,r){if(!e.visualVariables)return;const i=[],n=[],t=[],s=[],o=[];for(const l of e.visualVariables)switch(l.type){case\"color\":n.push(l);break;case\"opacity\":t.push(l);break;case\"rotation\":o.push(l);break;case\"size\":s.push(l)}return n.forEach((e=>{const n=b(e,a,r);i.push({variable:e,value:n})})),t.forEach((e=>{const n=h(e,a,r);i.push({variable:e,value:n})})),o.forEach((e=>{const n=m(e,a,r);i.push({variable:e,value:n})})),s.forEach((e=>{const n=y(e,a,r);i.push({variable:e,value:n})})),i.filter((e=>null!=e.value))}function R(e,a){if(!a)return;let r=0,i=a.length-1;return a.some(((a,n)=>e<a?(i=n,!0):(r=n,!1))),[r,i,(e-a[r])/(a[i]-a[r])]}function T(e,a,i){const n=[\"proportional\",\"proportional\",\"proportional\"];for(const t of e){const e=t.useSymbolValue?\"symbol-value\":y(t,a,i);switch(t.axis){case\"width\":n[0]=e;break;case\"depth\":n[1]=e;break;case\"height\":n[2]=e;break;case\"width-and-depth\":n[0]=e,n[1]=e;break;case\"all\":case void 0:case null:n[0]=e,n[1]=e,n[2]=e;break;default:r(t.axis)}}return n}export{T as getAllSizes,b as getColor,h as getOpacity,m as getRotationAngle,y as getSize,M as getSizeForValue,w as getSizeFromNumberOrVariable,k as getSizeRangeAtScale,N as getVisualVariableValues,v as viewScaleRE};\n"]},"metadata":{},"sourceType":"module"}