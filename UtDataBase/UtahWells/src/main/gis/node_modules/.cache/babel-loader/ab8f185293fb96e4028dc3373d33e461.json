{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport { _ as t } from \"./chunks/tslib.es6.js\";\nimport e from \"./core/Collection.js\";\nimport { JSONSupport as o } from \"./core/JSONSupport.js\";\nimport { clone as s } from \"./core/lang.js\";\nimport i from \"./core/Logger.js\";\nimport { isPromiseLike as r } from \"./core/promiseUtils.js\";\nimport { property as n } from \"./core/accessorSupport/decorators/property.js\";\nimport { cast as p } from \"./core/accessorSupport/decorators/cast.js\";\nimport { reader as l } from \"./core/accessorSupport/decorators/reader.js\";\nimport { subclass as a } from \"./core/accessorSupport/decorators/subclass.js\";\nimport { writer as d } from \"./core/accessorSupport/decorators/writer.js\";\nimport { ensureOneOfType as c } from \"./core/accessorSupport/ensureType.js\";\nimport { collectFields as f, collectArcadeFieldNames as m } from \"./layers/support/fieldUtils.js\";\nimport { persistableTypes as u } from \"./popup/content.js\";\nimport y from \"./popup/ExpressionInfo.js\";\nimport h from \"./popup/FieldInfo.js\";\nimport I from \"./popup/LayerOptions.js\";\nimport x from \"./popup/RelatedRecordsInfo.js\";\nimport { types as F } from \"./popup/content/support/mediaInfoTypes.js\";\nimport A from \"./support/actions/ActionBase.js\";\nimport _ from \"./support/actions/ActionButton.js\";\nimport g from \"./support/actions/ActionToggle.js\";\nimport w from \"./popup/content/MediaContent.js\";\nimport j from \"./popup/content/TextContent.js\";\nimport N from \"./popup/content/AttachmentsContent.js\";\nimport C from \"./popup/content/FieldsContent.js\";\nimport v from \"./popup/content/ExpressionContent.js\";\nimport E from \"./popup/content/Content.js\";\nimport O from \"./popup/content/CustomContent.js\";\nvar S;\nconst T = e.ofType({\n  key: \"type\",\n  defaultKeyValue: \"button\",\n  base: A,\n  typeMap: {\n    button: _,\n    toggle: g\n  }\n}),\n      b = {\n  base: E,\n  key: \"type\",\n  typeMap: {\n    media: w,\n    custom: O,\n    text: j,\n    attachments: N,\n    fields: C,\n    expression: v\n  }\n},\n      R = \"esri.PopupTemplate\",\n      L = i.getLogger(R),\n      J = [\"attachments\", \"fields\", \"media\", \"text\", \"expression\"];\nlet M = S = class extends o {\n  constructor() {\n    super(...arguments), this.actions = null, this.content = \"\", this.expressionInfos = null, this.fieldInfos = null, this.layerOptions = null, this.lastEditInfoEnabled = !0, this.outFields = null, this.overwriteActions = !1, this.returnGeometry = !1, this.title = \"\", this.relatedRecordsInfo = null;\n  }\n\n  castContent(t) {\n    return Array.isArray(t) ? t.map(t => c(b, t)) : \"string\" == typeof t || \"function\" == typeof t || t instanceof HTMLElement || r(t) ? t : (L.error(\"content error\", \"unsupported content value\", {\n      value: t\n    }), null);\n  }\n\n  readContent(t, e) {\n    const {\n      popupElements: o\n    } = e;\n    return Array.isArray(o) && o.length > 0 ? this._readPopupInfoElements(e) : this._readPopupInfo(e);\n  }\n\n  writeContent(t, e, o, s) {\n    \"string\" != typeof t ? Array.isArray(t) && (e.popupElements = t.filter(t => -1 !== J.indexOf(t.type)).map(t => t && t.toJSON(s)), e.popupElements.forEach(t => {\n      \"attachments\" === t.type ? this._writeAttachmentContent(e) : \"media\" === t.type ? this._writeMediaContent(t, e) : \"text\" === t.type && this._writeTextContent(t, e);\n    })) : e.description = t;\n  }\n\n  writeFieldInfos(t, e, o, s) {\n    const {\n      content: i\n    } = this,\n          r = Array.isArray(i) ? i : null;\n\n    if (t) {\n      const o = r ? r.filter(t => \"fields\" === t.type) : [],\n            i = o.length && o.every(t => {\n        var e;\n        return null == (e = t.fieldInfos) ? void 0 : e.length;\n      });\n      e.fieldInfos = t.filter(Boolean).map(t => {\n        const e = t.toJSON(s);\n        return i && (e.visible = !1), e;\n      });\n    }\n\n    if (r) for (const n of r) \"fields\" === n.type && this._writeFieldsContent(n, e);\n  }\n\n  writeLayerOptions(t, e, o, s) {\n    e[o] = !t || null === t.showNoDataRecords && null === t.returnTopmostRaster ? null : t.toJSON(s);\n  }\n\n  writeTitle(t, e) {\n    e.title = t || \"\";\n  }\n\n  clone() {\n    const {\n      actions: t\n    } = this,\n          e = t ? s(t.toArray()) : [];\n    return new S({\n      actions: e,\n      content: Array.isArray(this.content) ? s(this.content) : this.content,\n      expressionInfos: Array.isArray(this.expressionInfos) ? s(this.expressionInfos) : null,\n      fieldInfos: Array.isArray(this.fieldInfos) ? s(this.fieldInfos) : null,\n      layerOptions: this.layerOptions ? s(this.layerOptions) : null,\n      lastEditInfoEnabled: this.lastEditInfoEnabled,\n      outFields: Array.isArray(this.outFields) ? s(this.outFields) : null,\n      overwriteActions: this.overwriteActions,\n      returnGeometry: this.returnGeometry,\n      title: this.title,\n      relatedRecordsInfo: this.relatedRecordsInfo ? s(this.relatedRecordsInfo) : null\n    });\n  }\n\n  async collectRequiredFields(t, e) {\n    const o = this.expressionInfos || [];\n    await this._collectExpressionInfoFields(t, e, [...o, ...this._getContentExpressionInfos(this.content, o)]), f(t, e, [...(this.outFields || []), ...this._getActionsFields(this.actions), ...this._getTitleFields(this.title), ...this._getContentFields(this.content)]);\n  }\n\n  async getRequiredFields(t) {\n    const e = new Set();\n    return await this.collectRequiredFields(e, t), [...e].sort();\n  }\n\n  _writeFieldsContent(t, e) {\n    if (!Array.isArray(t.fieldInfos) || !t.fieldInfos.length) return;\n    const o = s(t.fieldInfos);\n    Array.isArray(e.fieldInfos) ? o.forEach(t => {\n      const o = e.fieldInfos.find(e => e.fieldName.toLowerCase() === t.fieldName.toLowerCase());\n      o ? o.visible = !0 : e.fieldInfos.push(t);\n    }) : e.fieldInfos = o;\n  }\n\n  _writeAttachmentContent(t) {\n    t.showAttachments || (t.showAttachments = !0);\n  }\n\n  _writeTextContent(t, e) {\n    !e.description && t.text && (e.description = t.text);\n  }\n\n  _writeMediaContent(t, e) {\n    if (!Array.isArray(t.mediaInfos) || !t.mediaInfos.length) return;\n    const o = s(t.mediaInfos);\n    Array.isArray(e.mediaInfos) ? e.mediaInfos = [...e.mediaInfos, ...o] : e.mediaInfos = o;\n  }\n\n  _readPopupInfoElements(_ref) {\n    let {\n      description: t,\n      mediaInfos: e,\n      popupElements: o\n    } = _ref;\n    const s = {\n      description: !1,\n      mediaInfos: !1\n    };\n    return o.map(o => \"media\" === o.type ? (o.mediaInfos || !e || s.mediaInfos || (o.mediaInfos = e, s.mediaInfos = !0), w.fromJSON(o)) : \"text\" === o.type ? (o.text || !t || s.description || (o.text = t, s.description = !0), j.fromJSON(o)) : \"attachments\" === o.type ? N.fromJSON(o) : \"fields\" === o.type ? C.fromJSON(o) : \"expression\" === o.type ? v.fromJSON(o) : void 0).filter(Boolean);\n  }\n\n  _readPopupInfo(_ref2) {\n    let {\n      description: t,\n      mediaInfos: e,\n      showAttachments: o\n    } = _ref2;\n    const s = [];\n    return t ? s.push(new j({\n      text: t\n    })) : s.push(new C()), Array.isArray(e) && e.length && s.push(w.fromJSON({\n      mediaInfos: e\n    })), o && s.push(N.fromJSON({\n      displayType: \"auto\"\n    })), s.length ? s : t;\n  }\n\n  _getContentElementFields(t) {\n    const e = null == t ? void 0 : t.type;\n    if (\"attachments\" === e) return [...this._extractFieldNames(t.title), ...this._extractFieldNames(t.description)];\n    if (\"custom\" === e) return t.outFields || [];\n    if (\"fields\" === e) return [...this._extractFieldNames(t.title), ...this._extractFieldNames(t.description), ...this._getFieldInfoFields(t.fieldInfos || this.fieldInfos)];\n\n    if (\"media\" === e) {\n      const e = t.mediaInfos || [];\n      return [...this._extractFieldNames(t.title), ...this._extractFieldNames(t.description), ...e.reduce((t, e) => [...t, ...this._getMediaInfoFields(e)], [])];\n    }\n\n    return \"text\" === e ? this._extractFieldNames(t.text) : [];\n  }\n\n  _getMediaInfoFields(t) {\n    const {\n      caption: e,\n      title: o,\n      value: s\n    } = t,\n          i = s || {},\n          {\n      fields: r = [],\n      normalizeField: n,\n      tooltipField: p,\n      sourceURL: l,\n      linkURL: a\n    } = i,\n          d = [...this._extractFieldNames(o), ...this._extractFieldNames(e), ...this._extractFieldNames(l), ...this._extractFieldNames(a), ...r];\n    return n && d.push(n), p && d.push(p), d;\n  }\n\n  _getContentExpressionInfos(t, e) {\n    return Array.isArray(t) ? t.reduce((t, e) => [...t, ...(\"expression\" === e.type && e.expressionInfo ? [e.expressionInfo] : [])], e) : [];\n  }\n\n  _getContentFields(t) {\n    return \"string\" == typeof t ? this._extractFieldNames(t) : Array.isArray(t) ? t.reduce((t, e) => [...t, ...this._getContentElementFields(e)], []) : [];\n  }\n\n  async _collectExpressionInfoFields(t, e, o) {\n    o && (await Promise.all(o.map(o => m(t, e, o.expression))));\n  }\n\n  _getFieldInfoFields(t) {\n    return t ? t.filter(t => void 0 === t.visible || !!t.visible).map(t => t.fieldName).filter(t => -1 === t.indexOf(\"relationships/\") && -1 === t.indexOf(\"expression/\")) : [];\n  }\n\n  _getActionsFields(t) {\n    return t ? t.toArray().reduce((t, e) => [...t, ...this._getActionFields(e)], []) : [];\n  }\n\n  _getActionFields(t) {\n    const {\n      className: e,\n      title: o,\n      type: s\n    } = t,\n          i = \"button\" === s || \"toggle\" === s ? t.image : \"\";\n    return [...this._extractFieldNames(o), ...this._extractFieldNames(e), ...this._extractFieldNames(i)];\n  }\n\n  _getTitleFields(t) {\n    return \"string\" == typeof t ? this._extractFieldNames(t) : [];\n  }\n\n  _extractFieldNames(t) {\n    if (!t || \"string\" != typeof t) return [];\n    const e = /{[^}]*}/g,\n          o = t.match(e);\n    if (!o) return [];\n    const s = /\\{(\\w+):.+\\}/,\n          i = o.filter(t => !(0 === t.indexOf(\"{relationships/\") || 0 === t.indexOf(\"{expression/\"))).map(t => t.replace(s, \"{$1}\"));\n    return i ? i.map(t => t.slice(1, -1)) : [];\n  }\n\n};\nt([n({\n  type: T\n})], M.prototype, \"actions\", void 0), t([n()], M.prototype, \"content\", void 0), t([p(\"content\")], M.prototype, \"castContent\", null), t([l(\"content\", [\"description\", \"fieldInfos\", \"popupElements\", \"mediaInfos\", \"showAttachments\"])], M.prototype, \"readContent\", null), t([d(\"content\", {\n  popupElements: {\n    type: e.ofType(u)\n  },\n  showAttachments: {\n    type: Boolean\n  },\n  mediaInfos: {\n    type: e.ofType(F)\n  },\n  description: {\n    type: String\n  }\n})], M.prototype, \"writeContent\", null), t([n({\n  type: [y],\n  json: {\n    write: !0\n  }\n})], M.prototype, \"expressionInfos\", void 0), t([n({\n  type: [h]\n})], M.prototype, \"fieldInfos\", void 0), t([d(\"fieldInfos\")], M.prototype, \"writeFieldInfos\", null), t([n({\n  type: I\n})], M.prototype, \"layerOptions\", void 0), t([d(\"layerOptions\")], M.prototype, \"writeLayerOptions\", null), t([n({\n  type: Boolean,\n  json: {\n    read: {\n      source: \"showLastEditInfo\"\n    },\n    write: {\n      target: \"showLastEditInfo\"\n    },\n    default: !0\n  }\n})], M.prototype, \"lastEditInfoEnabled\", void 0), t([n()], M.prototype, \"outFields\", void 0), t([n()], M.prototype, \"overwriteActions\", void 0), t([n()], M.prototype, \"returnGeometry\", void 0), t([n({\n  json: {\n    type: String\n  }\n})], M.prototype, \"title\", void 0), t([d(\"title\")], M.prototype, \"writeTitle\", null), t([n({\n  type: x,\n  json: {\n    write: !0\n  }\n})], M.prototype, \"relatedRecordsInfo\", void 0), M = S = t([a(R)], M);\nconst B = M;\nexport { B as default };","map":{"version":3,"sources":["D:/Github/CUSP_DataBase/CUSP_DB/src/main/gis/node_modules/@arcgis/core/PopupTemplate.js"],"names":["_","t","e","JSONSupport","o","clone","s","i","isPromiseLike","r","property","n","cast","p","reader","l","subclass","a","writer","d","ensureOneOfType","c","collectFields","f","collectArcadeFieldNames","m","persistableTypes","u","y","h","I","x","types","F","A","g","w","j","N","C","v","E","O","S","T","ofType","key","defaultKeyValue","base","typeMap","button","toggle","b","media","custom","text","attachments","fields","expression","R","L","getLogger","J","M","constructor","arguments","actions","content","expressionInfos","fieldInfos","layerOptions","lastEditInfoEnabled","outFields","overwriteActions","returnGeometry","title","relatedRecordsInfo","castContent","Array","isArray","map","HTMLElement","error","value","readContent","popupElements","length","_readPopupInfoElements","_readPopupInfo","writeContent","filter","indexOf","type","toJSON","forEach","_writeAttachmentContent","_writeMediaContent","_writeTextContent","description","writeFieldInfos","every","Boolean","visible","_writeFieldsContent","writeLayerOptions","showNoDataRecords","returnTopmostRaster","writeTitle","toArray","collectRequiredFields","_collectExpressionInfoFields","_getContentExpressionInfos","_getActionsFields","_getTitleFields","_getContentFields","getRequiredFields","Set","sort","find","fieldName","toLowerCase","push","showAttachments","mediaInfos","fromJSON","displayType","_getContentElementFields","_extractFieldNames","_getFieldInfoFields","reduce","_getMediaInfoFields","caption","normalizeField","tooltipField","sourceURL","linkURL","expressionInfo","Promise","all","_getActionFields","className","image","match","replace","slice","prototype","String","json","write","read","source","target","default","B"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport{_ as t}from\"./chunks/tslib.es6.js\";import e from\"./core/Collection.js\";import{JSONSupport as o}from\"./core/JSONSupport.js\";import{clone as s}from\"./core/lang.js\";import i from\"./core/Logger.js\";import{isPromiseLike as r}from\"./core/promiseUtils.js\";import{property as n}from\"./core/accessorSupport/decorators/property.js\";import{cast as p}from\"./core/accessorSupport/decorators/cast.js\";import{reader as l}from\"./core/accessorSupport/decorators/reader.js\";import{subclass as a}from\"./core/accessorSupport/decorators/subclass.js\";import{writer as d}from\"./core/accessorSupport/decorators/writer.js\";import{ensureOneOfType as c}from\"./core/accessorSupport/ensureType.js\";import{collectFields as f,collectArcadeFieldNames as m}from\"./layers/support/fieldUtils.js\";import{persistableTypes as u}from\"./popup/content.js\";import y from\"./popup/ExpressionInfo.js\";import h from\"./popup/FieldInfo.js\";import I from\"./popup/LayerOptions.js\";import x from\"./popup/RelatedRecordsInfo.js\";import{types as F}from\"./popup/content/support/mediaInfoTypes.js\";import A from\"./support/actions/ActionBase.js\";import _ from\"./support/actions/ActionButton.js\";import g from\"./support/actions/ActionToggle.js\";import w from\"./popup/content/MediaContent.js\";import j from\"./popup/content/TextContent.js\";import N from\"./popup/content/AttachmentsContent.js\";import C from\"./popup/content/FieldsContent.js\";import v from\"./popup/content/ExpressionContent.js\";import E from\"./popup/content/Content.js\";import O from\"./popup/content/CustomContent.js\";var S;const T=e.ofType({key:\"type\",defaultKeyValue:\"button\",base:A,typeMap:{button:_,toggle:g}}),b={base:E,key:\"type\",typeMap:{media:w,custom:O,text:j,attachments:N,fields:C,expression:v}},R=\"esri.PopupTemplate\",L=i.getLogger(R),J=[\"attachments\",\"fields\",\"media\",\"text\",\"expression\"];let M=S=class extends o{constructor(){super(...arguments),this.actions=null,this.content=\"\",this.expressionInfos=null,this.fieldInfos=null,this.layerOptions=null,this.lastEditInfoEnabled=!0,this.outFields=null,this.overwriteActions=!1,this.returnGeometry=!1,this.title=\"\",this.relatedRecordsInfo=null}castContent(t){return Array.isArray(t)?t.map((t=>c(b,t))):\"string\"==typeof t||\"function\"==typeof t||t instanceof HTMLElement||r(t)?t:(L.error(\"content error\",\"unsupported content value\",{value:t}),null)}readContent(t,e){const{popupElements:o}=e;return Array.isArray(o)&&o.length>0?this._readPopupInfoElements(e):this._readPopupInfo(e)}writeContent(t,e,o,s){\"string\"!=typeof t?Array.isArray(t)&&(e.popupElements=t.filter((t=>-1!==J.indexOf(t.type))).map((t=>t&&t.toJSON(s))),e.popupElements.forEach((t=>{\"attachments\"===t.type?this._writeAttachmentContent(e):\"media\"===t.type?this._writeMediaContent(t,e):\"text\"===t.type&&this._writeTextContent(t,e)}))):e.description=t}writeFieldInfos(t,e,o,s){const{content:i}=this,r=Array.isArray(i)?i:null;if(t){const o=r?r.filter((t=>\"fields\"===t.type)):[],i=o.length&&o.every((t=>{var e;return null==(e=t.fieldInfos)?void 0:e.length}));e.fieldInfos=t.filter(Boolean).map((t=>{const e=t.toJSON(s);return i&&(e.visible=!1),e}))}if(r)for(const n of r)\"fields\"===n.type&&this._writeFieldsContent(n,e)}writeLayerOptions(t,e,o,s){e[o]=!t||null===t.showNoDataRecords&&null===t.returnTopmostRaster?null:t.toJSON(s)}writeTitle(t,e){e.title=t||\"\"}clone(){const{actions:t}=this,e=t?s(t.toArray()):[];return new S({actions:e,content:Array.isArray(this.content)?s(this.content):this.content,expressionInfos:Array.isArray(this.expressionInfos)?s(this.expressionInfos):null,fieldInfos:Array.isArray(this.fieldInfos)?s(this.fieldInfos):null,layerOptions:this.layerOptions?s(this.layerOptions):null,lastEditInfoEnabled:this.lastEditInfoEnabled,outFields:Array.isArray(this.outFields)?s(this.outFields):null,overwriteActions:this.overwriteActions,returnGeometry:this.returnGeometry,title:this.title,relatedRecordsInfo:this.relatedRecordsInfo?s(this.relatedRecordsInfo):null})}async collectRequiredFields(t,e){const o=this.expressionInfos||[];await this._collectExpressionInfoFields(t,e,[...o,...this._getContentExpressionInfos(this.content,o)]),f(t,e,[...this.outFields||[],...this._getActionsFields(this.actions),...this._getTitleFields(this.title),...this._getContentFields(this.content)])}async getRequiredFields(t){const e=new Set;return await this.collectRequiredFields(e,t),[...e].sort()}_writeFieldsContent(t,e){if(!Array.isArray(t.fieldInfos)||!t.fieldInfos.length)return;const o=s(t.fieldInfos);Array.isArray(e.fieldInfos)?o.forEach((t=>{const o=e.fieldInfos.find((e=>e.fieldName.toLowerCase()===t.fieldName.toLowerCase()));o?o.visible=!0:e.fieldInfos.push(t)})):e.fieldInfos=o}_writeAttachmentContent(t){t.showAttachments||(t.showAttachments=!0)}_writeTextContent(t,e){!e.description&&t.text&&(e.description=t.text)}_writeMediaContent(t,e){if(!Array.isArray(t.mediaInfos)||!t.mediaInfos.length)return;const o=s(t.mediaInfos);Array.isArray(e.mediaInfos)?e.mediaInfos=[...e.mediaInfos,...o]:e.mediaInfos=o}_readPopupInfoElements({description:t,mediaInfos:e,popupElements:o}){const s={description:!1,mediaInfos:!1};return o.map((o=>\"media\"===o.type?(o.mediaInfos||!e||s.mediaInfos||(o.mediaInfos=e,s.mediaInfos=!0),w.fromJSON(o)):\"text\"===o.type?(o.text||!t||s.description||(o.text=t,s.description=!0),j.fromJSON(o)):\"attachments\"===o.type?N.fromJSON(o):\"fields\"===o.type?C.fromJSON(o):\"expression\"===o.type?v.fromJSON(o):void 0)).filter(Boolean)}_readPopupInfo({description:t,mediaInfos:e,showAttachments:o}){const s=[];return t?s.push(new j({text:t})):s.push(new C),Array.isArray(e)&&e.length&&s.push(w.fromJSON({mediaInfos:e})),o&&s.push(N.fromJSON({displayType:\"auto\"})),s.length?s:t}_getContentElementFields(t){const e=null==t?void 0:t.type;if(\"attachments\"===e)return[...this._extractFieldNames(t.title),...this._extractFieldNames(t.description)];if(\"custom\"===e)return t.outFields||[];if(\"fields\"===e)return[...this._extractFieldNames(t.title),...this._extractFieldNames(t.description),...this._getFieldInfoFields(t.fieldInfos||this.fieldInfos)];if(\"media\"===e){const e=t.mediaInfos||[];return[...this._extractFieldNames(t.title),...this._extractFieldNames(t.description),...e.reduce(((t,e)=>[...t,...this._getMediaInfoFields(e)]),[])]}return\"text\"===e?this._extractFieldNames(t.text):[]}_getMediaInfoFields(t){const{caption:e,title:o,value:s}=t,i=s||{},{fields:r=[],normalizeField:n,tooltipField:p,sourceURL:l,linkURL:a}=i,d=[...this._extractFieldNames(o),...this._extractFieldNames(e),...this._extractFieldNames(l),...this._extractFieldNames(a),...r];return n&&d.push(n),p&&d.push(p),d}_getContentExpressionInfos(t,e){return Array.isArray(t)?t.reduce(((t,e)=>[...t,...\"expression\"===e.type&&e.expressionInfo?[e.expressionInfo]:[]]),e):[]}_getContentFields(t){return\"string\"==typeof t?this._extractFieldNames(t):Array.isArray(t)?t.reduce(((t,e)=>[...t,...this._getContentElementFields(e)]),[]):[]}async _collectExpressionInfoFields(t,e,o){o&&await Promise.all(o.map((o=>m(t,e,o.expression))))}_getFieldInfoFields(t){return t?t.filter((t=>void 0===t.visible||!!t.visible)).map((t=>t.fieldName)).filter((t=>-1===t.indexOf(\"relationships/\")&&-1===t.indexOf(\"expression/\"))):[]}_getActionsFields(t){return t?t.toArray().reduce(((t,e)=>[...t,...this._getActionFields(e)]),[]):[]}_getActionFields(t){const{className:e,title:o,type:s}=t,i=\"button\"===s||\"toggle\"===s?t.image:\"\";return[...this._extractFieldNames(o),...this._extractFieldNames(e),...this._extractFieldNames(i)]}_getTitleFields(t){return\"string\"==typeof t?this._extractFieldNames(t):[]}_extractFieldNames(t){if(!t||\"string\"!=typeof t)return[];const e=/{[^}]*}/g,o=t.match(e);if(!o)return[];const s=/\\{(\\w+):.+\\}/,i=o.filter((t=>!(0===t.indexOf(\"{relationships/\")||0===t.indexOf(\"{expression/\")))).map((t=>t.replace(s,\"{$1}\")));return i?i.map((t=>t.slice(1,-1))):[]}};t([n({type:T})],M.prototype,\"actions\",void 0),t([n()],M.prototype,\"content\",void 0),t([p(\"content\")],M.prototype,\"castContent\",null),t([l(\"content\",[\"description\",\"fieldInfos\",\"popupElements\",\"mediaInfos\",\"showAttachments\"])],M.prototype,\"readContent\",null),t([d(\"content\",{popupElements:{type:e.ofType(u)},showAttachments:{type:Boolean},mediaInfos:{type:e.ofType(F)},description:{type:String}})],M.prototype,\"writeContent\",null),t([n({type:[y],json:{write:!0}})],M.prototype,\"expressionInfos\",void 0),t([n({type:[h]})],M.prototype,\"fieldInfos\",void 0),t([d(\"fieldInfos\")],M.prototype,\"writeFieldInfos\",null),t([n({type:I})],M.prototype,\"layerOptions\",void 0),t([d(\"layerOptions\")],M.prototype,\"writeLayerOptions\",null),t([n({type:Boolean,json:{read:{source:\"showLastEditInfo\"},write:{target:\"showLastEditInfo\"},default:!0}})],M.prototype,\"lastEditInfoEnabled\",void 0),t([n()],M.prototype,\"outFields\",void 0),t([n()],M.prototype,\"overwriteActions\",void 0),t([n()],M.prototype,\"returnGeometry\",void 0),t([n({json:{type:String}})],M.prototype,\"title\",void 0),t([d(\"title\")],M.prototype,\"writeTitle\",null),t([n({type:x,json:{write:!0}})],M.prototype,\"relatedRecordsInfo\",void 0),M=S=t([a(R)],M);const B=M;export{B as default};\n"]},"metadata":{},"sourceType":"module"}