{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport \"../../../intl.js\";\nimport e from \"../../../core/Logger.js\";\nimport { isNone as t, isSome as r } from \"../../../core/maybe.js\";\nimport { replace as n } from \"../../../core/string.js\";\nimport { formatDate as i, convertDateFormatToIntlOptions as o } from \"../../../intl/date.js\";\nimport { formatNumber as a, convertNumberFormatToIntlOptions as u } from \"../../../intl/number.js\";\nimport { featureHasFields as l } from \"../../../layers/support/fieldUtils.js\";\nimport s from \"../../../popup/support/FieldInfoFormat.js\";\nimport { loadArcade as f } from \"../../../support/arcadeOnDemand.js\";\nconst c = \"esri.widgets.Feature.support.featureUtils\",\n      d = e.getLogger(c),\n      p = /href=(\"\"|'')/gi,\n      m = /(\\{([^\\{\\r\\n]+)\\})/g,\n      y = /\\'/g,\n      g = /^\\s*expression\\//i,\n      h = /(\\n)/gi,\n      b = /[\\u00A0-\\u9999<>\\&]/gim,\n      F = /href\\s*=\\s*(?:\\\"([^\\\"]+)\\\"|\\'([^\\']+)\\')/gi,\n      I = /^(?:mailto:|tel:)/,\n      w = \"relationships/\",\n      N = o(\"short-date-short-time\");\n\nfunction x(e) {\n  if (!t(e)) return e.get(\"sourceLayer\") || e.get(\"layer\");\n}\n\nasync function E(e, t) {\n  return \"function\" == typeof e ? e.call(null, t) : e;\n}\n\nfunction v() {\n  let e = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : \"\";\n  if (e) return !I.test(e.trim().toLowerCase());\n}\n\nfunction j(e) {\n  return !!e && g.test(e);\n}\n\nfunction T(e, t) {\n  if (!j(t) || !e) return null;\n  const r = t.replace(g, \"\").toLowerCase();\n  let n;\n  return e.some(e => e.name.toLowerCase() === r && (n = e, !0)), n;\n}\n\nfunction C(e, t) {\n  const r = T(t, null == e ? void 0 : e.fieldName);\n  return r ? r.title || null : e ? e.label || e.fieldName : null;\n}\n\nfunction q(e, t) {\n  const r = t.get(e.toLowerCase());\n  return `{${r && r.fieldName || e}}`;\n}\n\nfunction D(e) {\n  return e.replace(p, \"\");\n}\n\nfunction R(e, t) {\n  const r = M(t, e);\n  return r ? r.name : e;\n}\n\nfunction L(e, t) {\n  return e && e.map(e => R(e, t));\n}\n\nfunction M(e, t) {\n  return e && \"function\" == typeof e.getField ? e.getField(t) : null;\n}\n\nfunction U(e) {\n  return `${e}`.trim();\n}\n\nfunction $(_ref) {\n  let {\n    attributes: e,\n    globalAttributes: t,\n    layer: r,\n    text: n,\n    expressionAttributes: i,\n    fieldInfoMap: o\n  } = _ref;\n  return n ? A({\n    formattedAttributes: t,\n    template: P(n, { ...t,\n      ...i,\n      ...e\n    }, r),\n    fieldInfoMap: o\n  }) : \"\";\n}\n\nfunction A(_ref2) {\n  let {\n    formattedAttributes: e,\n    template: t,\n    fieldInfoMap: r\n  } = _ref2;\n  return U(D(n(n(t, e => q(e, r)), e)));\n}\n\nfunction O(e, t) {\n  let r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : !1;\n  const n = t[e];\n\n  if (\"string\" == typeof n) {\n    const i = \"%27\",\n          o = (r ? encodeURIComponent(n) : n).replace(y, i);\n    t[e] = o;\n  }\n}\n\nfunction S(e) {\n  let t = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : !1;\n  const r = { ...e\n  };\n  return Object.keys(r).forEach(e => O(e, r, t)), r;\n}\n\nfunction G(e, t, r) {\n  const i = (t = U(t)) && \"{\" !== t[0];\n  return n(e, S(r, i));\n}\n\nfunction k(e, t) {\n  return e.replace(m, (e, r, n) => {\n    const i = M(t, n);\n    return i ? `{${i.name}}` : r;\n  });\n}\n\nfunction P(e, t, r) {\n  const n = k(e, r);\n  return n ? n.replace(F, (e, r, n) => G(e, r || n, t)) : n;\n}\n\nfunction _(e, t) {\n  if (\"string\" == typeof e && t && null == t.dateFormat && (null != t.places || null != t.digitSeparator)) {\n    const t = Number(e);\n    if (!isNaN(t)) return t;\n  }\n\n  return e;\n}\n\nfunction z(e) {\n  return \"feature\" === (null == e ? void 0 : e.type);\n}\n\nfunction H(e) {\n  return \"map-image\" === (null == e ? void 0 : e.type);\n}\n\nfunction Q(e) {\n  return !(null == e || !e.layer);\n}\n\nfunction Z(e, t) {\n  const r = t.fieldInfos,\n        n = t.fieldName,\n        i = B(r, n),\n        o = null == i ? void 0 : i.clone(),\n        l = t.preventPlacesFormatting,\n        f = t.layer,\n        c = M(f, n);\n\n  if (o && \"date\" === (null == c ? void 0 : c.type)) {\n    const e = o.format || new s();\n    e.dateFormat = e.dateFormat || \"short-date-short-time\", e.dateTimeFormatOptions = z(f) && f.datesInUnknownTimezone || Q(f) && H(f.layer) && f.layer.datesInUnknownTimezone ? {\n      timeZone: \"UTC\"\n    } : null, o.format = e;\n  }\n\n  const d = o && o.format;\n  return \"string\" == typeof (e = _(e, d)) || null == e || null == d ? ee(e) : l ? a(e, { ...u(d),\n    minimumFractionDigits: 0,\n    maximumFractionDigits: 20\n  }) : d.format(e);\n}\n\nfunction B(e, t) {\n  if (!e || !e.length || !t) return;\n  const r = t.toLowerCase();\n  let n;\n  return e.some(e => !(!e.fieldName || e.fieldName.toLowerCase() !== r) && (n = e, !0)), n;\n}\n\nfunction J(_ref3) {\n  let {\n    fieldName: e,\n    graphic: t,\n    layer: r\n  } = _ref3;\n  if (ae(e)) return null;\n  if (!r || \"function\" != typeof r.getFeatureType) return null;\n  const {\n    typeIdField: n\n  } = r;\n  if (!n || e !== n) return null;\n  const i = r.getFeatureType(t);\n  return i ? i.name : null;\n}\n\nfunction K(_ref4) {\n  let {\n    fieldName: e,\n    value: t,\n    graphic: r,\n    layer: n\n  } = _ref4;\n  if (ae(e)) return null;\n  if (!n || \"function\" != typeof n.getFieldDomain) return null;\n  const i = n.getFieldDomain(e, {\n    feature: r\n  });\n  return i && \"coded-value\" === i.type ? i.getName(t) : null;\n}\n\nfunction V(e, t) {\n  const {\n    creatorField: r,\n    creationDateField: n,\n    editorField: o,\n    editDateField: a\n  } = e;\n  if (!t) return;\n  const u = t[a];\n\n  if (\"number\" == typeof u) {\n    const e = t[o];\n    return {\n      type: \"edit\",\n      date: i(u, N),\n      user: e\n    };\n  }\n\n  const l = t[n];\n\n  if (\"number\" == typeof l) {\n    const e = t[r];\n    return {\n      type: \"create\",\n      date: i(l, N),\n      user: e\n    };\n  }\n\n  return null;\n}\n\nfunction W(e, t) {\n  const r = new Map();\n  return e && e.forEach(e => {\n    const n = R(e.fieldName, t);\n    e.fieldName = n, r.set(n.toLowerCase(), e);\n  }), r;\n}\n\nfunction X(e) {\n  const t = [];\n  if (!e) return t;\n  const {\n    fieldInfos: r,\n    content: n\n  } = e;\n  return r && t.push(...r), n && Array.isArray(n) ? (n.forEach(e => {\n    if (\"fields\" === e.type) {\n      const r = e && e.fieldInfos;\n      r && t.push(...r);\n    }\n  }), t) : t;\n}\n\nfunction Y(e) {\n  return e.replace(b, e => `&#${e.charCodeAt(0)};`);\n}\n\nfunction ee(e) {\n  return \"string\" == typeof e ? e.replace(h, '<br class=\"esri-text-new-line\" />') : e;\n}\n\nfunction te(e) {\n  const {\n    value: t,\n    fieldName: r,\n    fieldInfos: n,\n    fieldInfoMap: o,\n    layer: a,\n    graphic: u\n  } = e;\n  if (null == t) return \"\";\n  const l = K({\n    fieldName: r,\n    value: t,\n    graphic: u,\n    layer: a\n  });\n  if (l) return l;\n  const s = J({\n    fieldName: r,\n    graphic: u,\n    layer: a\n  });\n  if (s) return s;\n  if (o.get(r.toLowerCase())) return Z(t, {\n    fieldInfos: n,\n    fieldName: r,\n    layer: a\n  });\n  const f = a && a.fieldsIndex;\n  return f && f.isDateField(r) ? i(t, N) : ee(t);\n}\n\nfunction re(_ref5) {\n  let {\n    fieldInfos: e,\n    attributes: t,\n    layer: r,\n    graphic: n,\n    fieldInfoMap: i,\n    relatedInfos: o\n  } = _ref5;\n  const a = {};\n  return null == o || o.forEach(e => se(a, e)), Object.keys(t).forEach(o => {\n    const u = t[o];\n    a[o] = te({\n      fieldName: o,\n      fieldInfos: e,\n      fieldInfoMap: i,\n      layer: r,\n      value: u,\n      graphic: n\n    });\n  }), a;\n}\n\nasync function ne(e, t) {\n  var r, n;\n  const {\n    layer: i,\n    graphic: o,\n    outFields: a,\n    objectIds: u,\n    returnGeometry: l,\n    spatialReference: s\n  } = e,\n        f = u[0];\n\n  if (\"number\" != typeof f && \"string\" != typeof f) {\n    const e = \"Could not query required fields for the specified feature. The feature's ID is invalid.\",\n          t = {\n      layer: i,\n      graphic: o,\n      objectId: f,\n      requiredFields: a\n    };\n    return d.warn(e, t), null;\n  }\n\n  if (null == (r = i.capabilities) || null == (n = r.operations) || !n.supportsQuery) {\n    const e = \"The specified layer cannot be queried. The following fields will not be available.\",\n          t = {\n      layer: i,\n      graphic: o,\n      requiredFields: a,\n      returnGeometry: l\n    };\n    return d.warn(e, t), null;\n  }\n\n  const c = i.createQuery();\n  c.objectIds = u, c.outFields = null != a && a.length ? a : [i.objectIdField], c.returnGeometry = !!l, c.returnZ = !!l, c.returnM = !!l, c.outSpatialReference = s;\n  return (await i.queryFeatures(c, t)).features[0];\n}\n\nasync function ie(e) {\n  var t;\n  if (null == (t = e.expressionInfos) || !t.length) return !1;\n  const r = await f(),\n        {\n    arcadeUtils: {\n      hasGeometryFunctions: n\n    }\n  } = r;\n  return n(e);\n}\n\nasync function oe(_ref6, i) {\n  let {\n    graphic: e,\n    popupTemplate: t,\n    layer: r,\n    spatialReference: n\n  } = _ref6;\n  if (!r || !t) return;\n  if (\"function\" == typeof r.load && (await r.load(i)), !e.attributes) return;\n  const o = e.attributes[r.objectIdField];\n  if (null == o) return;\n  const a = [o],\n        u = await t.getRequiredFields(r.fieldsIndex),\n        s = l(u, e),\n        f = s ? [] : u,\n        c = t.returnGeometry || (await ie(t));\n  if (s && !c) return;\n  const d = await ne({\n    layer: r,\n    graphic: e,\n    outFields: f,\n    objectIds: a,\n    returnGeometry: c,\n    spatialReference: n\n  }, i);\n  d && (d.geometry && (e.geometry = d.geometry), d.attributes && (e.attributes = { ...e.attributes,\n    ...d.attributes\n  }));\n}\n\nfunction ae() {\n  let e = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : \"\";\n  return !!e && -1 !== e.indexOf(w);\n}\n\nfunction ue(e) {\n  return e ? `${w}${e.layerId}/${e.fieldName}` : \"\";\n}\n\nfunction le(_ref7) {\n  let {\n    attributes: e,\n    graphic: t,\n    relatedInfo: r\n  } = _ref7;\n  e && t && r && Object.keys(t.attributes).forEach(n => {\n    const i = ue({\n      layerId: r.relation.id.toString(),\n      fieldName: n\n    });\n    e[i] = t.attributes[n];\n  });\n}\n\nfunction se(e, t) {\n  e && t && (t.relatedFeatures && t.relatedFeatures && t.relatedFeatures.forEach(r => le({\n    attributes: e,\n    graphic: r,\n    relatedInfo: t\n  })), t.relatedStatsFeatures && t.relatedStatsFeatures && t.relatedStatsFeatures.forEach(r => le({\n    attributes: e,\n    graphic: r,\n    relatedInfo: t\n  })));\n}\n\nconst fe = e => {\n  if (!e) return !1;\n  const t = e.toUpperCase();\n  return t.indexOf(\"CURRENT_TIMESTAMP\") > -1 || t.indexOf(\"CURRENT_DATE\") > -1 || t.indexOf(\"CURRENT_TIME\") > -1;\n},\n      ce = _ref8 => {\n  let {\n    layer: e,\n    method: t,\n    query: n,\n    definitionExpression: i\n  } = _ref8;\n  var o, a;\n  if (null == (o = e.capabilities) || null == (a = o.query) || !a.supportsCacheHint || \"attachments\" === t) return;\n  const u = r(n.where) && n.where,\n        l = r(n.geometry) && n.geometry;\n  fe(i) || fe(u) || \"extent\" === (null == l ? void 0 : l.type) || \"tile\" === n.resultType || (n.cacheHint = !0);\n},\n      de = _ref9 => {\n  let {\n    query: e,\n    layer: t,\n    method: r\n  } = _ref9;\n  ce({\n    layer: t,\n    method: r,\n    query: e,\n    definitionExpression: `${t.definitionExpression} ${t.serviceDefinitionExpression}`\n  });\n},\n      pe = _ref10 => {\n  let {\n    queryPayload: e,\n    layer: t,\n    method: r\n  } = _ref10;\n  ce({\n    layer: t,\n    method: r,\n    query: e,\n    definitionExpression: `${t.definitionExpression} ${t.serviceDefinitionExpression}`\n  });\n};\n\nexport { ee as applyTextFormattingHTML, W as createfieldInfoMap, k as fixTokens, re as formatAttributes, V as formatEditInfo, Z as formatValueToFieldInfo, X as getAllFieldInfos, B as getFieldInfo, C as getFieldInfoLabel, R as getFixedFieldName, L as getFixedFieldNames, x as getSourceLayer, E as graphicCallback, Y as htmlEntities, j as isExpressionField, ae as isRelatedField, de as preLayerQueryCallback, pe as preRequestCallback, oe as queryUpdatedFeature, v as shouldOpenInNewTab, A as substituteAttributes, $ as substituteFieldsInLinksAndAttributes };","map":{"version":3,"sources":["D:/Github/CUSP_DataBase/CUSP_DB/src/main/gis/node_modules/@arcgis/core/widgets/Feature/support/featureUtils.js"],"names":["e","isNone","t","isSome","r","replace","n","formatDate","i","convertDateFormatToIntlOptions","o","formatNumber","a","convertNumberFormatToIntlOptions","u","featureHasFields","l","s","loadArcade","f","c","d","getLogger","p","m","y","g","h","b","F","I","w","N","x","get","E","call","v","test","trim","toLowerCase","j","T","some","name","C","fieldName","title","label","q","D","R","M","L","map","getField","U","$","attributes","globalAttributes","layer","text","expressionAttributes","fieldInfoMap","A","formattedAttributes","template","P","O","encodeURIComponent","S","Object","keys","forEach","G","k","_","dateFormat","places","digitSeparator","Number","isNaN","z","type","H","Q","Z","fieldInfos","B","clone","preventPlacesFormatting","format","dateTimeFormatOptions","datesInUnknownTimezone","timeZone","ee","minimumFractionDigits","maximumFractionDigits","length","J","graphic","ae","getFeatureType","typeIdField","K","value","getFieldDomain","feature","getName","V","creatorField","creationDateField","editorField","editDateField","date","user","W","Map","set","X","content","push","Array","isArray","Y","charCodeAt","te","fieldsIndex","isDateField","re","relatedInfos","se","ne","outFields","objectIds","returnGeometry","spatialReference","objectId","requiredFields","warn","capabilities","operations","supportsQuery","createQuery","objectIdField","returnZ","returnM","outSpatialReference","queryFeatures","features","ie","expressionInfos","arcadeUtils","hasGeometryFunctions","oe","popupTemplate","load","getRequiredFields","geometry","indexOf","ue","layerId","le","relatedInfo","relation","id","toString","relatedFeatures","relatedStatsFeatures","fe","toUpperCase","ce","method","query","definitionExpression","supportsCacheHint","where","resultType","cacheHint","de","serviceDefinitionExpression","pe","queryPayload","applyTextFormattingHTML","createfieldInfoMap","fixTokens","formatAttributes","formatEditInfo","formatValueToFieldInfo","getAllFieldInfos","getFieldInfo","getFieldInfoLabel","getFixedFieldName","getFixedFieldNames","getSourceLayer","graphicCallback","htmlEntities","isExpressionField","isRelatedField","preLayerQueryCallback","preRequestCallback","queryUpdatedFeature","shouldOpenInNewTab","substituteAttributes","substituteFieldsInLinksAndAttributes"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport\"../../../intl.js\";import e from\"../../../core/Logger.js\";import{isNone as t,isSome as r}from\"../../../core/maybe.js\";import{replace as n}from\"../../../core/string.js\";import{formatDate as i,convertDateFormatToIntlOptions as o}from\"../../../intl/date.js\";import{formatNumber as a,convertNumberFormatToIntlOptions as u}from\"../../../intl/number.js\";import{featureHasFields as l}from\"../../../layers/support/fieldUtils.js\";import s from\"../../../popup/support/FieldInfoFormat.js\";import{loadArcade as f}from\"../../../support/arcadeOnDemand.js\";const c=\"esri.widgets.Feature.support.featureUtils\",d=e.getLogger(c),p=/href=(\"\"|'')/gi,m=/(\\{([^\\{\\r\\n]+)\\})/g,y=/\\'/g,g=/^\\s*expression\\//i,h=/(\\n)/gi,b=/[\\u00A0-\\u9999<>\\&]/gim,F=/href\\s*=\\s*(?:\\\"([^\\\"]+)\\\"|\\'([^\\']+)\\')/gi,I=/^(?:mailto:|tel:)/,w=\"relationships/\",N=o(\"short-date-short-time\");function x(e){if(!t(e))return e.get(\"sourceLayer\")||e.get(\"layer\")}async function E(e,t){return\"function\"==typeof e?e.call(null,t):e}function v(e=\"\"){if(e)return!I.test(e.trim().toLowerCase())}function j(e){return!!e&&g.test(e)}function T(e,t){if(!j(t)||!e)return null;const r=t.replace(g,\"\").toLowerCase();let n;return e.some((e=>e.name.toLowerCase()===r&&(n=e,!0))),n}function C(e,t){const r=T(t,null==e?void 0:e.fieldName);return r?r.title||null:e?e.label||e.fieldName:null}function q(e,t){const r=t.get(e.toLowerCase());return`{${r&&r.fieldName||e}}`}function D(e){return e.replace(p,\"\")}function R(e,t){const r=M(t,e);return r?r.name:e}function L(e,t){return e&&e.map((e=>R(e,t)))}function M(e,t){return e&&\"function\"==typeof e.getField?e.getField(t):null}function U(e){return`${e}`.trim()}function $({attributes:e,globalAttributes:t,layer:r,text:n,expressionAttributes:i,fieldInfoMap:o}){return n?A({formattedAttributes:t,template:P(n,{...t,...i,...e},r),fieldInfoMap:o}):\"\"}function A({formattedAttributes:e,template:t,fieldInfoMap:r}){return U(D(n(n(t,(e=>q(e,r))),e)))}function O(e,t,r=!1){const n=t[e];if(\"string\"==typeof n){const i=\"%27\",o=(r?encodeURIComponent(n):n).replace(y,i);t[e]=o}}function S(e,t=!1){const r={...e};return Object.keys(r).forEach((e=>O(e,r,t))),r}function G(e,t,r){const i=(t=U(t))&&\"{\"!==t[0];return n(e,S(r,i))}function k(e,t){return e.replace(m,((e,r,n)=>{const i=M(t,n);return i?`{${i.name}}`:r}))}function P(e,t,r){const n=k(e,r);return n?n.replace(F,((e,r,n)=>G(e,r||n,t))):n}function _(e,t){if(\"string\"==typeof e&&t&&null==t.dateFormat&&(null!=t.places||null!=t.digitSeparator)){const t=Number(e);if(!isNaN(t))return t}return e}function z(e){return\"feature\"===(null==e?void 0:e.type)}function H(e){return\"map-image\"===(null==e?void 0:e.type)}function Q(e){return!(null==e||!e.layer)}function Z(e,t){const r=t.fieldInfos,n=t.fieldName,i=B(r,n),o=null==i?void 0:i.clone(),l=t.preventPlacesFormatting,f=t.layer,c=M(f,n);if(o&&\"date\"===(null==c?void 0:c.type)){const e=o.format||new s;e.dateFormat=e.dateFormat||\"short-date-short-time\",e.dateTimeFormatOptions=z(f)&&f.datesInUnknownTimezone||Q(f)&&H(f.layer)&&f.layer.datesInUnknownTimezone?{timeZone:\"UTC\"}:null,o.format=e}const d=o&&o.format;return\"string\"==typeof(e=_(e,d))||null==e||null==d?ee(e):l?a(e,{...u(d),minimumFractionDigits:0,maximumFractionDigits:20}):d.format(e)}function B(e,t){if(!e||!e.length||!t)return;const r=t.toLowerCase();let n;return e.some((e=>!(!e.fieldName||e.fieldName.toLowerCase()!==r)&&(n=e,!0))),n}function J({fieldName:e,graphic:t,layer:r}){if(ae(e))return null;if(!r||\"function\"!=typeof r.getFeatureType)return null;const{typeIdField:n}=r;if(!n||e!==n)return null;const i=r.getFeatureType(t);return i?i.name:null}function K({fieldName:e,value:t,graphic:r,layer:n}){if(ae(e))return null;if(!n||\"function\"!=typeof n.getFieldDomain)return null;const i=n.getFieldDomain(e,{feature:r});return i&&\"coded-value\"===i.type?i.getName(t):null}function V(e,t){const{creatorField:r,creationDateField:n,editorField:o,editDateField:a}=e;if(!t)return;const u=t[a];if(\"number\"==typeof u){const e=t[o];return{type:\"edit\",date:i(u,N),user:e}}const l=t[n];if(\"number\"==typeof l){const e=t[r];return{type:\"create\",date:i(l,N),user:e}}return null}function W(e,t){const r=new Map;return e&&e.forEach((e=>{const n=R(e.fieldName,t);e.fieldName=n,r.set(n.toLowerCase(),e)})),r}function X(e){const t=[];if(!e)return t;const{fieldInfos:r,content:n}=e;return r&&t.push(...r),n&&Array.isArray(n)?(n.forEach((e=>{if(\"fields\"===e.type){const r=e&&e.fieldInfos;r&&t.push(...r)}})),t):t}function Y(e){return e.replace(b,(e=>`&#${e.charCodeAt(0)};`))}function ee(e){return\"string\"==typeof e?e.replace(h,'<br class=\"esri-text-new-line\" />'):e}function te(e){const{value:t,fieldName:r,fieldInfos:n,fieldInfoMap:o,layer:a,graphic:u}=e;if(null==t)return\"\";const l=K({fieldName:r,value:t,graphic:u,layer:a});if(l)return l;const s=J({fieldName:r,graphic:u,layer:a});if(s)return s;if(o.get(r.toLowerCase()))return Z(t,{fieldInfos:n,fieldName:r,layer:a});const f=a&&a.fieldsIndex;return f&&f.isDateField(r)?i(t,N):ee(t)}function re({fieldInfos:e,attributes:t,layer:r,graphic:n,fieldInfoMap:i,relatedInfos:o}){const a={};return null==o||o.forEach((e=>se(a,e))),Object.keys(t).forEach((o=>{const u=t[o];a[o]=te({fieldName:o,fieldInfos:e,fieldInfoMap:i,layer:r,value:u,graphic:n})})),a}async function ne(e,t){var r,n;const{layer:i,graphic:o,outFields:a,objectIds:u,returnGeometry:l,spatialReference:s}=e,f=u[0];if(\"number\"!=typeof f&&\"string\"!=typeof f){const e=\"Could not query required fields for the specified feature. The feature's ID is invalid.\",t={layer:i,graphic:o,objectId:f,requiredFields:a};return d.warn(e,t),null}if(null==(r=i.capabilities)||null==(n=r.operations)||!n.supportsQuery){const e=\"The specified layer cannot be queried. The following fields will not be available.\",t={layer:i,graphic:o,requiredFields:a,returnGeometry:l};return d.warn(e,t),null}const c=i.createQuery();c.objectIds=u,c.outFields=null!=a&&a.length?a:[i.objectIdField],c.returnGeometry=!!l,c.returnZ=!!l,c.returnM=!!l,c.outSpatialReference=s;return(await i.queryFeatures(c,t)).features[0]}async function ie(e){var t;if(null==(t=e.expressionInfos)||!t.length)return!1;const r=await f(),{arcadeUtils:{hasGeometryFunctions:n}}=r;return n(e)}async function oe({graphic:e,popupTemplate:t,layer:r,spatialReference:n},i){if(!r||!t)return;if(\"function\"==typeof r.load&&await r.load(i),!e.attributes)return;const o=e.attributes[r.objectIdField];if(null==o)return;const a=[o],u=await t.getRequiredFields(r.fieldsIndex),s=l(u,e),f=s?[]:u,c=t.returnGeometry||await ie(t);if(s&&!c)return;const d=await ne({layer:r,graphic:e,outFields:f,objectIds:a,returnGeometry:c,spatialReference:n},i);d&&(d.geometry&&(e.geometry=d.geometry),d.attributes&&(e.attributes={...e.attributes,...d.attributes}))}function ae(e=\"\"){return!!e&&-1!==e.indexOf(w)}function ue(e){return e?`${w}${e.layerId}/${e.fieldName}`:\"\"}function le({attributes:e,graphic:t,relatedInfo:r}){e&&t&&r&&Object.keys(t.attributes).forEach((n=>{const i=ue({layerId:r.relation.id.toString(),fieldName:n});e[i]=t.attributes[n]}))}function se(e,t){e&&t&&(t.relatedFeatures&&t.relatedFeatures&&t.relatedFeatures.forEach((r=>le({attributes:e,graphic:r,relatedInfo:t}))),t.relatedStatsFeatures&&t.relatedStatsFeatures&&t.relatedStatsFeatures.forEach((r=>le({attributes:e,graphic:r,relatedInfo:t}))))}const fe=e=>{if(!e)return!1;const t=e.toUpperCase();return t.indexOf(\"CURRENT_TIMESTAMP\")>-1||t.indexOf(\"CURRENT_DATE\")>-1||t.indexOf(\"CURRENT_TIME\")>-1},ce=({layer:e,method:t,query:n,definitionExpression:i})=>{var o,a;if(null==(o=e.capabilities)||null==(a=o.query)||!a.supportsCacheHint||\"attachments\"===t)return;const u=r(n.where)&&n.where,l=r(n.geometry)&&n.geometry;fe(i)||fe(u)||\"extent\"===(null==l?void 0:l.type)||\"tile\"===n.resultType||(n.cacheHint=!0)},de=({query:e,layer:t,method:r})=>{ce({layer:t,method:r,query:e,definitionExpression:`${t.definitionExpression} ${t.serviceDefinitionExpression}`})},pe=({queryPayload:e,layer:t,method:r})=>{ce({layer:t,method:r,query:e,definitionExpression:`${t.definitionExpression} ${t.serviceDefinitionExpression}`})};export{ee as applyTextFormattingHTML,W as createfieldInfoMap,k as fixTokens,re as formatAttributes,V as formatEditInfo,Z as formatValueToFieldInfo,X as getAllFieldInfos,B as getFieldInfo,C as getFieldInfoLabel,R as getFixedFieldName,L as getFixedFieldNames,x as getSourceLayer,E as graphicCallback,Y as htmlEntities,j as isExpressionField,ae as isRelatedField,de as preLayerQueryCallback,pe as preRequestCallback,oe as queryUpdatedFeature,v as shouldOpenInNewTab,A as substituteAttributes,$ as substituteFieldsInLinksAndAttributes};\n"]},"metadata":{},"sourceType":"module"}