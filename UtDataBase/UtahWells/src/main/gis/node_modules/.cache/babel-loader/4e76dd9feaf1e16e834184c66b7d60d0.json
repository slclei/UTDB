{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../chunks/tslib.es6.js\";\nimport t from \"../config.js\";\nimport { id as r } from \"../kernel.js\";\nimport s from \"../request.js\";\nimport i from \"../core/Error.js\";\nimport n from \"../core/Evented.js\";\nimport { on as o } from \"../core/events.js\";\nimport { fixJson as a } from \"../core/lang.js\";\nimport { getDeepValue as h } from \"../core/object.js\";\nimport { createResolver as l, onAbort as c, isAborted as d } from \"../core/promiseUtils.js\";\nimport { Url as u, urlToObject as p, hasSameOrigin as _, queryToObject as f, base64UrlEncode as g, objectToQuery as m, normalize as v, getProxyRule as S, makeAbsolute as w, addQueryParameters as I } from \"../core/urlUtils.js\";\nimport { property as A } from \"../core/accessorSupport/decorators/property.js\";\nimport \"../core/accessorSupport/ensureType.js\";\nimport { subclass as k } from \"../core/accessorSupport/decorators/subclass.js\";\nimport y from \"./IdentityForm.js\";\nimport U from \"./IdentityModal.js\";\nimport T from \"./OAuthCredential.js\";\nimport x from \"./OAuthInfo.js\";\nimport O from \"./ServerInfo.js\";\n\nconst P = {},\n      R = e => {\n  const t = new u(e.owningSystemUrl).host,\n        r = new u(e.server).host,\n        s = /.+\\.arcgis\\.com$/i;\n  return s.test(t) && s.test(r);\n},\n      C = (e, t) => !!(R(e) && t && t.some(t => t.test(e.server)));\n\nlet b = null,\n    D = null;\n\ntry {\n  b = window.localStorage, D = window.sessionStorage;\n} catch {}\n\nclass q extends n {\n  constructor() {\n    super(), this._portalConfig = globalThis.esriGeowConfig, this.serverInfos = [], this.oAuthInfos = [], this.credentials = [], this._soReqs = [], this._xoReqs = [], this._portals = [], this.defaultOAuthInfo = null, this.defaultTokenValidity = 60, this.dialog = null, this.formConstructor = y, this.tokenValidity = null, this.normalizeWebTierAuth = !1, this._appOrigin = \"null\" !== window.origin ? window.origin : window.location.origin, this._appUrlObj = p(window.location.href), this._busy = null, this._rejectOnPersistedPageShow = !1, this._oAuthLocationParams = null, this._gwTokenUrl = \"/sharing/rest/generateToken\", this._agsRest = \"/rest/services\", this._agsPortal = /\\/sharing(\\/|$)/i, this._agsAdmin = /(https?:\\/\\/[^\\/]+\\/[^\\/]+)\\/admin\\/?(\\/.*)?$/i, this._adminSvcs = /\\/rest\\/admin\\/services(\\/|$)/i, this._gwDomains = [{\n      regex: /^https?:\\/\\/www\\.arcgis\\.com/i,\n      customBaseUrl: \"maps.arcgis.com\",\n      tokenServiceUrl: \"https://www.arcgis.com/sharing/rest/generateToken\"\n    }, {\n      regex: /^https?:\\/\\/(?:dev|[a-z\\d-]+\\.mapsdev)\\.arcgis\\.com/i,\n      customBaseUrl: \"mapsdev.arcgis.com\",\n      tokenServiceUrl: \"https://dev.arcgis.com/sharing/rest/generateToken\"\n    }, {\n      regex: /^https?:\\/\\/(?:devext|[a-z\\d-]+\\.mapsdevext)\\.arcgis\\.com/i,\n      customBaseUrl: \"mapsdevext.arcgis.com\",\n      tokenServiceUrl: \"https://devext.arcgis.com/sharing/rest/generateToken\"\n    }, {\n      regex: /^https?:\\/\\/(?:qaext|[a-z\\d-]+\\.mapsqa)\\.arcgis\\.com/i,\n      customBaseUrl: \"mapsqa.arcgis.com\",\n      tokenServiceUrl: \"https://qaext.arcgis.com/sharing/rest/generateToken\"\n    }, {\n      regex: /^https?:\\/\\/[a-z\\d-]+\\.maps\\.arcgis\\.com/i,\n      customBaseUrl: \"maps.arcgis.com\",\n      tokenServiceUrl: \"https://www.arcgis.com/sharing/rest/generateToken\"\n    }], this._legacyFed = [], this._regexSDirUrl = /http.+\\/rest\\/services\\/?/gi, this._regexServerType = /(\\/(FeatureServer|GPServer|GeoDataServer|GeocodeServer|GeoenrichmentServer|GeometryServer|GlobeServer|ImageServer|MapServer|MobileServer|NAServer|NetworkDiagramServer|OGCFeatureServer|ParcelFabricServer|RelationalCatalogServer|SceneServer|StreamServer|UtilityNetworkServer|ValidationServer|VectorTileServer|VersionManagementServer)).*/gi, this._gwUser = /http.+\\/users\\/([^\\/]+)\\/?.*/i, this._gwItem = /http.+\\/items\\/([^\\/]+)\\/?.*/i, this._gwGroup = /http.+\\/groups\\/([^\\/]+)\\/?.*/i, this._rePortalTokenSvc = /\\/sharing(\\/rest)?\\/generatetoken/i, this._createDefaultOAuthInfo = !0, this._hasTestedIfAppIsOnPortal = !1, this._getOAuthLocationParams(), window.addEventListener(\"pageshow\", e => {\n      this._pageShowHandler(e);\n    });\n  }\n\n  registerServers(e) {\n    const t = this.serverInfos;\n    t ? (e = e.filter(e => !this.findServerInfo(e.server)), this.serverInfos = t.concat(e)) : this.serverInfos = e, e.forEach(e => {\n      e.owningSystemUrl && this._portals.push(e.owningSystemUrl), e.hasPortal && this._portals.push(e.server);\n    });\n  }\n\n  registerOAuthInfos(e) {\n    const t = this.oAuthInfos;\n\n    if (t) {\n      for (const r of e) {\n        const e = this.findOAuthInfo(r.portalUrl);\n        e && t.splice(t.indexOf(e), 1);\n      }\n\n      this.oAuthInfos = t.concat(e);\n    } else this.oAuthInfos = e;\n  }\n\n  registerToken(e) {\n    e = { ...e\n    };\n\n    const t = this._sanitizeUrl(e.server),\n          r = this._isServerRsrc(t);\n\n    let s,\n        i = this.findServerInfo(t),\n        n = !0;\n    i || (i = new O(), i.server = this._getServerInstanceRoot(t), r ? i.hasServer = !0 : (i.tokenServiceUrl = this._getTokenSvcUrl(t), i.hasPortal = !0), this.registerServers([i])), s = this._findCredential(t), s ? (delete e.server, Object.assign(s, e), n = !1) : (s = new j({\n      userId: e.userId,\n      server: i.server,\n      token: e.token,\n      expires: e.expires,\n      ssl: e.ssl,\n      scope: r ? \"server\" : \"portal\"\n    }), s.resources = [t], this.credentials.push(s)), s.emitTokenChange(!1), n || s.refreshServerTokens();\n  }\n\n  toJSON() {\n    return a({\n      serverInfos: this.serverInfos.map(e => e.toJSON()),\n      oAuthInfos: this.oAuthInfos.map(e => e.toJSON()),\n      credentials: this.credentials.map(e => e.toJSON())\n    });\n  }\n\n  initialize(e) {\n    if (!e) return;\n    \"string\" == typeof e && (e = JSON.parse(e));\n    const t = e.serverInfos,\n          r = e.oAuthInfos,\n          s = e.credentials;\n\n    if (t) {\n      const e = [];\n      t.forEach(t => {\n        t.server && t.tokenServiceUrl && e.push(t.declaredClass ? t : new O(t));\n      }), e.length && this.registerServers(e);\n    }\n\n    if (r) {\n      const e = [];\n      r.forEach(t => {\n        t.appId && e.push(t.declaredClass ? t : new x(t));\n      }), e.length && this.registerOAuthInfos(e);\n    }\n\n    s && s.forEach(e => {\n      e.server && e.token && e.expires && e.expires > Date.now() && ((e = e.declaredClass ? e : new j(e)).emitTokenChange(), this.credentials.push(e));\n    });\n  }\n\n  findServerInfo(e) {\n    let t;\n    e = this._sanitizeUrl(e);\n\n    for (const r of this.serverInfos) if (this._hasSameServerInstance(r.server, e)) {\n      t = r;\n      break;\n    }\n\n    return t;\n  }\n\n  findOAuthInfo(e) {\n    let t;\n    e = this._sanitizeUrl(e);\n\n    for (const r of this.oAuthInfos) if (this._hasSameServerInstance(r.portalUrl, e)) {\n      t = r;\n      break;\n    }\n\n    return t;\n  }\n\n  findCredential(e, t) {\n    let r;\n    e = this._sanitizeUrl(e);\n    const s = this._isServerRsrc(e) ? \"server\" : \"portal\";\n\n    if (t) {\n      for (const i of this.credentials) if (this._hasSameServerInstance(i.server, e) && t === i.userId && i.scope === s) {\n        r = i;\n        break;\n      }\n    } else for (const i of this.credentials) if (this._hasSameServerInstance(i.server, e) && -1 !== this._getIdenticalSvcIdx(e, i) && i.scope === s) {\n      r = i;\n      break;\n    }\n\n    return r;\n  }\n\n  getCredential(e, t) {\n    let r,\n        s,\n        n = !0;\n    t && (r = !!t.token, s = t.error, n = !1 !== t.prompt), t = { ...t\n    }, e = this._sanitizeUrl(e);\n    const o = new AbortController(),\n          a = l();\n    if (t.signal && c(t.signal, () => {\n      o.abort();\n    }), c(o, () => {\n      a.reject(new i(\"identity-manager:user-aborted\", \"ABORTED\"));\n    }), d(o)) return a.promise;\n    t.signal = o.signal;\n\n    const h = this._isAdminResource(e),\n          u = r ? this.findCredential(e) : null;\n\n    let p;\n    if (u && s && s.details && 498 === s.details.httpStatus) u.destroy();else if (u) return p = new i(\"identity-manager:not-authorized\", \"You are currently signed in as: '\" + u.userId + \"'. You do not have access to this resource: \" + e, {\n      error: s\n    }), a.reject(p), a.promise;\n\n    const f = this._findCredential(e, t);\n\n    if (f) return a.resolve(f), a.promise;\n    let g = this.findServerInfo(e);\n    if (g) !g.hasServer && this._isServerRsrc(e) && (g._restInfoPms = this._getTokenSvcUrl(e), g.hasServer = !0);else {\n      const t = this._getTokenSvcUrl(e);\n\n      if (!t) return p = new i(\"identity-manager:unknown-resource\", \"Unknown resource - could not find token service endpoint.\"), a.reject(p), a.promise;\n      g = new O(), g.server = this._getServerInstanceRoot(e), \"string\" == typeof t ? (g.tokenServiceUrl = t, g.hasPortal = !0) : (g._restInfoPms = t, g.hasServer = !0), this.registerServers([g]);\n    }\n    return g.hasPortal && void 0 === g._selfReq && (n || _(g.tokenServiceUrl, this._appOrigin) || this._gwDomains.some(e => e.tokenServiceUrl === g.tokenServiceUrl)) && (g._selfReq = {\n      owningTenant: t && t.owningTenant,\n      selfDfd: this._getPortalSelf(g.tokenServiceUrl.replace(this._rePortalTokenSvc, \"/sharing/rest/portals/self\"), e)\n    }), this._enqueue(e, g, t, a, h);\n  }\n\n  getResourceName(e) {\n    return this._isRESTService(e) ? e.replace(this._regexSDirUrl, \"\").replace(this._regexServerType, \"\") || \"\" : this._gwUser.test(e) && e.replace(this._gwUser, \"$1\") || this._gwItem.test(e) && e.replace(this._gwItem, \"$1\") || this._gwGroup.test(e) && e.replace(this._gwGroup, \"$1\") || \"\";\n  }\n\n  generateToken(e, t, r) {\n    const n = this._rePortalTokenSvc.test(e.tokenServiceUrl),\n          o = new u(this._appOrigin),\n          a = e.shortLivedTokenValidity;\n\n    let h, l, c, d, p, f, g, m;\n    t && (m = this.tokenValidity || a || this.defaultTokenValidity, m > a && a > 0 && (m = a)), r && (h = r.isAdmin, l = r.serverUrl, c = r.token, f = r.signal, g = r.ssl, e.customParameters = r.customParameters), h ? d = e.adminTokenServiceUrl : (d = e.tokenServiceUrl, p = new u(d.toLowerCase()), e.webTierAuth && null != r && r.serverUrl && !g && \"http\" === o.scheme && (_(o.uri, d, !0) || \"https\" === p.scheme && o.host === p.host && \"7080\" === o.port && \"7443\" === p.port) && (d = d.replace(/^https:/i, \"http:\").replace(/:7443/i, \":7080\")));\n    const v = {\n      query: {\n        request: \"getToken\",\n        username: null == t ? void 0 : t.username,\n        password: null == t ? void 0 : t.password,\n        serverUrl: l,\n        token: c,\n        expiration: m,\n        referer: h || n ? this._appOrigin : null,\n        client: h ? \"referer\" : null,\n        f: \"json\",\n        ...e.customParameters\n      },\n      method: \"post\",\n      authMode: \"anonymous\",\n      useProxy: this._useProxy(e, r),\n      signal: f,\n      ...(null == r ? void 0 : r.ioArgs)\n    };\n    n || (v.withCredentials = !1);\n    return s(d, v).then(r => {\n      const s = r.data;\n      if (!s || !s.token) return new i(\"identity-manager:authentication-failed\", \"Unable to generate token\");\n      const n = e.server;\n      return P[n] || (P[n] = {}), t && (P[n][t.username] = t.password), s.validity = m, s;\n    });\n  }\n\n  isBusy() {\n    return !!this._busy;\n  }\n\n  checkSignInStatus(e) {\n    return this.checkAppAccess(e, \"\").then(e => e.credential);\n  }\n\n  checkAppAccess(e, t, r) {\n    let n = !1;\n    return this.getCredential(e, {\n      prompt: !1\n    }).then(o => {\n      let a;\n      const h = {\n        f: \"json\"\n      };\n      if (\"portal\" === o.scope) {\n        if (t && (this._doPortalSignIn(e) || r && r.force)) a = o.server + \"/sharing/rest/oauth2/validateAppAccess\", h.client_id = t;else {\n          if (!o.token) return {\n            credential: o\n          };\n          a = o.server + \"/sharing/rest\";\n        }\n      } else {\n        if (!o.token) return {\n          credential: o\n        };\n        a = o.server + \"/rest/services\";\n      }\n      return o.token && (h.token = o.token), s(a, {\n        query: h,\n        authMode: \"anonymous\"\n      }).then(e => {\n        if (!1 === e.data.valid) throw new i(\"identity-manager:not-authorized\", `You are currently signed in as: '${o.userId}'.`, e.data);\n        return n = !!e.data.viewOnlyUserTypeApp, {\n          credential: o\n        };\n      }).catch(e => {\n        if (\"identity-manager:not-authorized\" === e.name) throw e;\n        const t = e.details && e.details.httpStatus;\n        if (498 === t) throw o.destroy(), new i(\"identity-manager:not-authenticated\", \"User is not signed in.\");\n        if (400 === t) throw new i(\"identity-manager:invalid-request\");\n        return {\n          credential: o\n        };\n      });\n    }).then(e => ({\n      credential: e.credential,\n      viewOnly: n\n    }));\n  }\n\n  setOAuthResponseHash(e) {\n    e && (\"#\" === e.charAt(0) && (e = e.substring(1)), this._processOAuthPopupParams(f(e)));\n  }\n\n  setOAuthRedirectionHandler(e) {\n    this._oAuthRedirectFunc = e;\n  }\n\n  setProtocolErrorHandler(e) {\n    this._protocolFunc = e;\n  }\n\n  signIn(e, t) {\n    let r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n\n    const s = l(),\n          n = () => {\n      var e, t, r, s, i;\n      null == (e = h) || e.remove(), null == (t = d) || t.remove(), null == (r = u) || r.remove(), null == (s = a) || s.destroy(), null == (i = this.dialog) || i.destroy(), this.dialog = a = h = d = u = null;\n    },\n          o = () => {\n      n(), this._oAuthDfd = null, s.reject(new i(\"identity-manager:user-aborted\", \"ABORTED\"));\n    };\n\n    r.signal && c(r.signal, () => {\n      o();\n    });\n    let a = new this.formConstructor();\n    a.resource = this.getResourceName(e), a.server = t.server, this.dialog = new U(), this.dialog.content = a, this.dialog.open = !0, this.emit(\"dialog-create\");\n    let h = a.on(\"cancel\", o),\n        d = this.dialog.watch(\"open\", o),\n        u = a.on(\"submit\", e => {\n      this.generateToken(t, e, {\n        isAdmin: r.isAdmin,\n        signal: r.signal\n      }).then(i => {\n        n();\n        const o = new j({\n          userId: e.username,\n          server: t.server,\n          token: i.token,\n          expires: null != i.expires ? Number(i.expires) : null,\n          ssl: !!i.ssl,\n          isAdmin: r.isAdmin,\n          validity: i.validity\n        });\n        s.resolve(o);\n      }).catch(e => {\n        a.error = e, a.signingIn = !1;\n      });\n    });\n    return s.promise;\n  }\n\n  oAuthSignIn(e, t, r, s) {\n    this._oAuthDfd = l();\n    const n = this._oAuthDfd;\n    let o;\n    null != s && s.signal && c(s.signal, () => {\n      const e = this._oAuthDfd && this._oAuthDfd.oAuthWin_;\n      e && !e.closed ? e.close() : this.dialog && _();\n    }), n.resUrl_ = e, n.sinfo_ = t, n.oinfo_ = r;\n    const a = r._oAuthCred;\n\n    if (a.storage && (\"authorization-code\" === r.flowType || \"auto\" === r.flowType && !r.popup && t.currentVersion >= 8.4)) {\n      let e = crypto.getRandomValues(new Uint8Array(32));\n      o = g(e), a.codeVerifier = o, e = crypto.getRandomValues(new Uint8Array(32)), a.stateUID = g(e), a.save() || (a.codeVerifier = o = null);\n    } else a.codeVerifier = null;\n\n    let h, d, u, p;\n\n    this._getCodeChallenge(o).then(i => {\n      const n = !s || !1 !== s.oAuthPopupConfirmation;\n      r.popup && n ? (h = new this.formConstructor(), h.oAuthPrompt = !0, h.server = t.server, this.dialog = new U(), this.dialog.content = h, this.dialog.open = !0, this.emit(\"dialog-create\"), d = h.on(\"cancel\", _), u = this.dialog.watch(\"open\", _), p = h.on(\"submit\", () => {\n        f(), this._doOAuthSignIn(e, t, r, i);\n      })) : this._doOAuthSignIn(e, t, r, i);\n    });\n\n    const _ = () => {\n      f(), this._oAuthDfd = null, n.reject(new i(\"identity-manager:user-aborted\", \"ABORTED\"));\n    },\n          f = () => {\n      var e, t, r, s, i;\n      null == (e = d) || e.remove(), null == (t = u) || t.remove(), null == (r = p) || r.remove(), null == (s = h) || s.destroy(), null == (i = this.dialog) || i.destroy(), this.dialog = null;\n    };\n\n    return n.promise;\n  }\n\n  destroyCredentials() {\n    if (this.credentials) {\n      this.credentials.slice().forEach(e => {\n        e.destroy();\n      });\n    }\n\n    this.emit(\"credentials-destroy\");\n  }\n\n  enablePostMessageAuth() {\n    let e = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : \"https://www.arcgis.com/sharing/rest\";\n    this._postMessageAuthHandle && this._postMessageAuthHandle.remove(), this._postMessageAuthHandle = o(window, \"message\", t => {\n      var r;\n\n      if ((t.origin === this._appOrigin || t.origin.endsWith(\".arcgis.com\")) && \"arcgis:auth:requestCredential\" === (null == (r = t.data) ? void 0 : r.type)) {\n        const r = t.source;\n        this.getCredential(e).then(e => {\n          r.postMessage({\n            type: \"arcgis:auth:credential\",\n            credential: {\n              expires: e.expires,\n              server: e.server,\n              ssl: e.ssl,\n              token: e.token,\n              userId: e.userId\n            }\n          }, t.origin);\n        }).catch(e => {\n          r.postMessage({\n            type: \"arcgis:auth:error\",\n            error: {\n              name: e.name,\n              message: e.message\n            }\n          }, t.origin);\n        });\n      }\n    });\n  }\n\n  disablePostMessageAuth() {\n    this._postMessageAuthHandle && (this._postMessageAuthHandle.remove(), this._postMessageAuthHandle = null);\n  }\n\n  _getOAuthLocationParams() {\n    let e = window.location.hash;\n\n    if (e) {\n      \"#\" === e.charAt(0) && (e = e.substring(1));\n      const r = f(e);\n      let s = !1;\n      if (r.access_token && r.expires_in && r.state && r.hasOwnProperty(\"username\")) try {\n        r.state = JSON.parse(r.state), r.state.portalUrl && (this._oAuthLocationParams = r, s = !0);\n      } catch {} else if (r.error && r.error_description && (console.log(\"IdentityManager OAuth Error: \", r.error, \" - \", r.error_description), \"access_denied\" === r.error && (s = !0, r.state))) try {\n        r.state = JSON.parse(r.state);\n      } catch {}\n      var t;\n      if (s) window.location.hash = (null == (t = r.state) ? void 0 : t.hash) || \"\";\n    }\n\n    let r = window.location.search;\n\n    if (r) {\n      \"?\" === r.charAt(0) && (r = r.substring(1));\n      const e = f(r);\n      let t = !1;\n      if (e.code && e.state) try {\n        e.state = JSON.parse(e.state), e.state.portalUrl && e.state.uid && (this._oAuthLocationParams = e, t = !0);\n      } catch {} else if (e.error && e.error_description && (console.log(\"IdentityManager OAuth Error: \", e.error, \" - \", e.error_description), \"access_denied\" === e.error && (t = !0, e.state))) try {\n        e.state = JSON.parse(e.state);\n      } catch {}\n\n      if (t) {\n        var s;\n        const t = { ...e\n        };\n        [\"code\", \"error\", \"error_description\", \"message_code\", \"persist\", \"state\"].forEach(e => {\n          delete t[e];\n        });\n        const r = m(t),\n              i = window.location.pathname + (r ? `?${r}` : \"\") + ((null == (s = e.state) ? void 0 : s.hash) || \"\");\n        window.history.replaceState(window.history.state, \"\", i);\n      }\n    }\n  }\n\n  _getOAuthToken(e, t, r, i, n) {\n    return e = e.replace(/^http:/i, \"https:\"), s(`${e}/sharing/rest/oauth2/token`, {\n      authMode: \"anonymous\",\n      method: \"post\",\n      query: i && n ? {\n        grant_type: \"authorization_code\",\n        code: t,\n        redirect_uri: i,\n        client_id: r,\n        code_verifier: n\n      } : {\n        grant_type: \"refresh_token\",\n        refresh_token: t,\n        client_id: r\n      }\n    }).then(e => e.data);\n  }\n\n  _getCodeChallenge(e) {\n    if (e && globalThis.isSecureContext) {\n      const t = new TextEncoder().encode(e);\n      return crypto.subtle.digest(\"SHA-256\", t).then(e => g(new Uint8Array(e)));\n    }\n\n    return Promise.resolve(null);\n  }\n\n  _pageShowHandler(e) {\n    if (e.persisted && this.isBusy() && this._rejectOnPersistedPageShow) {\n      const e = new i(\"identity-manager:user-aborted\", \"ABORTED\");\n\n      this._errbackFunc(e);\n    }\n  }\n\n  _findCredential(e, t) {\n    let r,\n        s,\n        i,\n        n,\n        o = -1;\n    const a = t && t.token,\n          h = t && t.resource,\n          l = this._isServerRsrc(e) ? \"server\" : \"portal\",\n          c = this.credentials.filter(t => this._hasSameServerInstance(t.server, e) && t.scope === l);\n    if (e = h || e, c.length) if (1 === c.length) {\n      if (r = c[0], n = this.findServerInfo(r.server), s = n && n.owningSystemUrl, i = s && this.findCredential(s, r.userId), o = this._getIdenticalSvcIdx(e, r), !a) return -1 === o && r.resources.push(e), this._addResource(e, i), r;\n      -1 !== o && (r.resources.splice(o, 1), this._removeResource(e, i));\n    } else {\n      let t, r;\n      if (c.some(a => (r = this._getIdenticalSvcIdx(e, a), -1 !== r && (t = a, n = this.findServerInfo(t.server), s = n && n.owningSystemUrl, i = s && this.findCredential(s, t.userId), o = r, !0))), a) t && (t.resources.splice(o, 1), this._removeResource(e, i));else if (t) return this._addResource(e, i), t;\n    }\n  }\n\n  _findOAuthInfo(e) {\n    let t = this.findOAuthInfo(e);\n    if (!t) for (const r of this.oAuthInfos) if (this._isIdProvider(r.portalUrl, e)) {\n      t = r;\n      break;\n    }\n    return t;\n  }\n\n  _addResource(e, t) {\n    t && -1 === this._getIdenticalSvcIdx(e, t) && t.resources.push(e);\n  }\n\n  _removeResource(e, t) {\n    let r = -1;\n    t && (r = this._getIdenticalSvcIdx(e, t), r > -1 && t.resources.splice(r, 1));\n  }\n\n  _useProxy(e, t) {\n    return t && t.isAdmin && !_(e.adminTokenServiceUrl, this._appOrigin) || !this._isPortalDomain(e.tokenServiceUrl) && \"10.1\" === String(e.currentVersion) && !_(e.tokenServiceUrl, this._appOrigin);\n  }\n\n  _getOrigin(e) {\n    const t = new u(e);\n    return t.scheme + \"://\" + t.host + (null != t.port ? \":\" + t.port : \"\");\n  }\n\n  _getServerInstanceRoot(e) {\n    const t = e.toLowerCase();\n    let r = t.indexOf(this._agsRest);\n    return -1 === r && this._isAdminResource(e) && (r = this._agsAdmin.test(e) ? e.replace(this._agsAdmin, \"$1\").length : e.search(this._adminSvcs)), -1 === r && (r = t.indexOf(\"/sharing\")), -1 === r && \"/\" === t.substr(-1) && (r = t.length - 1), r > -1 ? e.substring(0, r) : e;\n  }\n\n  _hasSameServerInstance(e, t) {\n    return \"/\" === e.substr(-1) && (e = e.slice(0, -1)), e = e.toLowerCase(), t = this._getServerInstanceRoot(t).toLowerCase(), e = this._normalizeAGOLorgDomain(e), t = this._normalizeAGOLorgDomain(t), (e = e.substr(e.indexOf(\":\"))) === (t = t.substr(t.indexOf(\":\")));\n  }\n\n  _normalizeAGOLorgDomain(e) {\n    const t = /^https?:\\/\\/(?:cdn|[a-z\\d-]+\\.maps)\\.arcgis\\.com/i,\n          r = /^https?:\\/\\/(?:cdndev|[a-z\\d-]+\\.mapsdevext)\\.arcgis\\.com/i,\n          s = /^https?:\\/\\/(?:cdnqa|[a-z\\d-]+\\.mapsqa)\\.arcgis\\.com/i;\n    return t.test(e) ? e = e.replace(t, \"https://www.arcgis.com\") : r.test(e) ? e = e.replace(r, \"https://devext.arcgis.com\") : s.test(e) && (e = e.replace(s, \"https://qaext.arcgis.com\")), e;\n  }\n\n  _sanitizeUrl(e) {\n    const r = (t.request.proxyUrl || \"\").toLowerCase(),\n          s = r ? e.toLowerCase().indexOf(r + \"?\") : -1;\n    return -1 !== s && (e = e.substring(s + r.length + 1)), e = v(e), p(e).path;\n  }\n\n  _isRESTService(e) {\n    return e.indexOf(this._agsRest) > -1;\n  }\n\n  _isAdminResource(e) {\n    return this._agsAdmin.test(e) || this._adminSvcs.test(e);\n  }\n\n  _isServerRsrc(e) {\n    return this._isRESTService(e) || this._isAdminResource(e);\n  }\n\n  _isIdenticalService(e, t) {\n    let r;\n\n    if (this._isRESTService(e) && this._isRESTService(t)) {\n      const s = this._getSuffix(e).toLowerCase(),\n            i = this._getSuffix(t).toLowerCase();\n\n      if (r = s === i, !r) {\n        const e = /(.*)\\/(MapServer|FeatureServer|UtilityNetworkServer).*/gi;\n        r = s.replace(e, \"$1\") === i.replace(e, \"$1\");\n      }\n    } else this._isAdminResource(e) && this._isAdminResource(t) ? r = !0 : this._isServerRsrc(e) || this._isServerRsrc(t) || !this._isPortalDomain(e) || (r = !0);\n\n    return r;\n  }\n\n  _isPortalDomain(e) {\n    const r = new u(e.toLowerCase()),\n          s = this._portalConfig;\n\n    let i = this._gwDomains.some(e => e.regex.test(r.uri));\n\n    return !i && s && (i = this._hasSameServerInstance(this._getServerInstanceRoot(s.restBaseUrl), r.uri)), i || t.portalUrl && (i = _(r, t.portalUrl, !0)), i || (i = this._portals.some(e => this._hasSameServerInstance(e, r.uri))), i = i || this._agsPortal.test(r.path), i;\n  }\n\n  _isIdProvider(e, t) {\n    let r = -1,\n        s = -1;\n\n    this._gwDomains.forEach((i, n) => {\n      -1 === r && i.regex.test(e) && (r = n), -1 === s && i.regex.test(t) && (s = n);\n    });\n\n    let i = !1;\n\n    if (r > -1 && s > -1 && (0 === r || 4 === r ? 0 !== s && 4 !== s || (i = !0) : 1 === r ? 1 !== s && 2 !== s || (i = !0) : 2 === r ? 2 === s && (i = !0) : 3 === r && 3 === s && (i = !0)), !i) {\n      const r = this.findServerInfo(t),\n            s = r && r.owningSystemUrl;\n      s && R(r) && this._isPortalDomain(s) && this._isIdProvider(e, s) && (i = !0);\n    }\n\n    return i;\n  }\n\n  _getIdenticalSvcIdx(e, t) {\n    let r = -1;\n\n    for (let s = 0; s < t.resources.length; s++) {\n      const i = t.resources[s];\n\n      if (this._isIdenticalService(e, i)) {\n        r = s;\n        break;\n      }\n    }\n\n    return r;\n  }\n\n  _getSuffix(e) {\n    return e.replace(this._regexSDirUrl, \"\").replace(this._regexServerType, \"$1\");\n  }\n\n  _getTokenSvcUrl(e) {\n    let t, r, i;\n\n    if (this._isRESTService(e) || this._isAdminResource(e)) {\n      const i = this._getServerInstanceRoot(e);\n\n      return t = i + \"/admin/generateToken\", r = s(e = i + \"/rest/info\", {\n        query: {\n          f: \"json\"\n        }\n      }).then(e => e.data), {\n        adminUrl: t,\n        promise: r\n      };\n    }\n\n    if (this._isPortalDomain(e)) {\n      let t = \"\";\n\n      if (this._gwDomains.some(r => (r.regex.test(e) && (t = r.tokenServiceUrl), !!t)), t || this._portals.some(r => (this._hasSameServerInstance(r, e) && (t = r + this._gwTokenUrl), !!t)), t || (i = e.toLowerCase().indexOf(\"/sharing\"), -1 !== i && (t = e.substring(0, i) + this._gwTokenUrl)), t || (t = this._getOrigin(e) + this._gwTokenUrl), t) {\n        const r = new u(e).port;\n        /^http:\\/\\//i.test(e) && \"7080\" === r && (t = t.replace(/:7080/i, \":7443\")), t = t.replace(/http:/i, \"https:\");\n      }\n\n      return t;\n    }\n\n    if (-1 !== e.toLowerCase().indexOf(\"premium.arcgisonline.com\")) return \"https://premium.arcgisonline.com/server/tokens\";\n  }\n\n  _processOAuthResponseParams(e, t, r) {\n    const s = t._oAuthCred;\n\n    if (e.code) {\n      const i = s.codeVerifier;\n      return s.codeVerifier = null, s.stateUID = null, s.save(), this._getOAuthToken(r.server, e.code, t.appId, this._getRedirectURI(t, !0), i).then(i => {\n        const n = new j({\n          userId: i.username,\n          server: r.server,\n          token: i.access_token,\n          expires: Date.now() + 1e3 * i.expires_in,\n          ssl: i.ssl,\n          oAuthState: e.state,\n          _oAuthCred: s\n        });\n        return t.userId = n.userId, s.storage = i.persist ? b : D, s.refreshToken = i.refresh_token, s.token = null, s.expires = i.refresh_token_expires_in ? Date.now() + 1e3 * i.refresh_token_expires_in : null, s.userId = n.userId, s.ssl = n.ssl, s.save(), n;\n      });\n    }\n\n    const i = new j({\n      userId: e.username,\n      server: r.server,\n      token: e.access_token,\n      expires: Date.now() + 1e3 * Number(e.expires_in),\n      ssl: \"true\" === e.ssl,\n      oAuthState: e.state,\n      _oAuthCred: s\n    });\n    return t.userId = i.userId, s.storage = e.persist ? b : D, s.refreshToken = null, s.token = i.token, s.expires = i.expires, s.userId = i.userId, s.ssl = i.ssl, s.save(), Promise.resolve(i);\n  }\n\n  _processOAuthPopupParams(e) {\n    var t;\n    const r = this._oAuthDfd;\n    if (this._oAuthDfd = null, r) if (clearInterval(this._oAuthIntervalId), null == (t = this._oAuthOnPopupHandle) || t.remove(), e.error) {\n      const t = \"access_denied\" === e.error,\n            s = new i(t ? \"identity-manager:user-aborted\" : \"identity-manager:authentication-failed\", t ? \"ABORTED\" : \"OAuth: \" + e.error + \" - \" + e.error_description);\n      r.reject(s);\n    } else this._processOAuthResponseParams(e, r.oinfo_, r.sinfo_).then(e => {\n      r.resolve(e);\n    }).catch(e => {\n      r.reject(e);\n    });\n  }\n\n  _setOAuthResponseQueryString(e) {\n    e && (\"?\" === e.charAt(0) && (e = e.substring(1)), this._processOAuthPopupParams(f(e)));\n  }\n\n  _exchangeToken(e, t, r) {\n    return s(`${e}/sharing/rest/oauth2/exchangeToken`, {\n      authMode: \"anonymous\",\n      method: \"post\",\n      query: {\n        f: \"json\",\n        client_id: t,\n        token: r\n      }\n    }).then(e => e.data.token);\n  }\n\n  _getPlatformSelf(e, t) {\n    return e = e.replace(/^http:/i, \"https:\"), s(`${e}/sharing/rest/oauth2/platformSelf`, {\n      authMode: \"anonymous\",\n      headers: {\n        \"X-Esri-Auth-Client-Id\": t,\n        \"X-Esri-Auth-Redirect-Uri\": window.location.href.replace(/#.*$/, \"\")\n      },\n      method: \"post\",\n      query: {\n        f: \"json\",\n        expiration: 30\n      },\n      withCredentials: !0\n    }).then(e => e.data);\n  }\n\n  _getPortalSelf(e, t) {\n    let r;\n    if (this._gwDomains.some(t => (t.regex.test(e) && (r = t.customBaseUrl), !!r)), r) return Promise.resolve({\n      allSSL: !0,\n      currentVersion: \"8.4\",\n      customBaseUrl: r,\n      portalMode: \"multitenant\",\n      supportsOAuth: !0\n    });\n    this._appOrigin.startsWith(\"https:\") ? e = e.replace(/^http:/i, \"https:\").replace(/:7080/i, \":7443\") : /^http:/i.test(t) && (e = e.replace(/^https:/i, \"http:\").replace(/:7443/i, \":7080\"));\n    return s(e, {\n      query: {\n        f: \"json\"\n      },\n      authMode: \"anonymous\",\n      withCredentials: !0\n    }).then(e => e.data);\n  }\n\n  _doPortalSignIn(e) {\n    const t = this._portalConfig,\n          r = window.location.href,\n          s = this.findServerInfo(e);\n    return !(!t && !this._isPortalDomain(r) || !(s ? s.hasPortal || s.owningSystemUrl && this._isPortalDomain(s.owningSystemUrl) : this._isPortalDomain(e)) || !(this._isIdProvider(r, e) || t && (this._hasSameServerInstance(this._getServerInstanceRoot(t.restBaseUrl), e) || this._isIdProvider(t.restBaseUrl, e)) || _(r, e, !0)));\n  }\n\n  _checkProtocol(e, t, r, s) {\n    let n = !0;\n    const o = s ? t.adminTokenServiceUrl : t.tokenServiceUrl;\n\n    if (o.trim().toLowerCase().startsWith(\"https:\") && !this._appOrigin.startsWith(\"https:\") && S(o) && (n = !!this._protocolFunc && !!this._protocolFunc({\n      resourceUrl: e,\n      serverInfo: t\n    }), !n)) {\n      r(new i(\"identity-manager:aborted\", \"Aborted the Sign-In process to avoid sending password over insecure connection.\"));\n    }\n\n    return n;\n  }\n\n  _enqueue(e, t, r, s, i, n) {\n    return s || (s = l()), s.resUrl_ = e, s.sinfo_ = t, s.options_ = r, s.admin_ = i, s.refresh_ = n, this._busy ? this._hasSameServerInstance(this._getServerInstanceRoot(e), this._busy.resUrl_) ? (this._oAuthDfd && this._oAuthDfd.oAuthWin_ && this._oAuthDfd.oAuthWin_.focus(), this._soReqs.push(s)) : this._xoReqs.push(s) : this._doSignIn(s), s.promise;\n  }\n\n  _doSignIn(e) {\n    this._busy = e, this._rejectOnPersistedPageShow = !1;\n\n    const t = t => {\n      const r = e.options_ && e.options_.resource,\n            s = e.resUrl_,\n            i = e.refresh_;\n      let n = !1;\n      -1 === this.credentials.indexOf(t) && (i && -1 !== this.credentials.indexOf(i) ? (i.userId = t.userId, i.token = t.token, i.expires = t.expires, i.validity = t.validity, i.ssl = t.ssl, i.creationTime = t.creationTime, n = !0, t = i) : this.credentials.push(t)), t.resources || (t.resources = []), t.resources.includes(r || s) || t.resources.push(r || s), t.scope = this._isServerRsrc(s) ? \"server\" : \"portal\", t.emitTokenChange();\n      const o = this._soReqs,\n            a = {};\n      this._soReqs = [], o.forEach(e => {\n        if (!this._isIdenticalService(s, e.resUrl_)) {\n          const r = this._getSuffix(e.resUrl_);\n\n          a[r] || (a[r] = !0, t.resources.push(e.resUrl_));\n        }\n      }), e.resolve(t), o.forEach(e => {\n        this._hasSameServerInstance(this._getServerInstanceRoot(s), e.resUrl_) ? e.resolve(t) : this._soReqs.push(e);\n      }), this._busy = e.resUrl_ = e.sinfo_ = e.refresh_ = null, n || this.emit(\"credential-create\", {\n        credential: t\n      }), this._soReqs.length ? this._doSignIn(this._soReqs.shift()) : this._xoReqs.length && this._doSignIn(this._xoReqs.shift());\n    },\n          r = t => {\n      e.reject(t), this._busy = e.resUrl_ = e.sinfo_ = e.refresh_ = null, this._soReqs.length ? this._doSignIn(this._soReqs.shift()) : this._xoReqs.length && this._doSignIn(this._xoReqs.shift());\n    },\n          s = (n, a, h, l) => {\n      var d, u;\n\n      const p = e.sinfo_,\n            f = !e.options_ || !1 !== e.options_.prompt,\n            g = p.hasPortal && this._findOAuthInfo(e.resUrl_);\n\n      let m, v;\n      if (n) t(new j({\n        userId: n,\n        server: p.server,\n        token: h || null,\n        expires: null != l ? Number(l) : null,\n        ssl: !!a\n      }));else if (window !== window.parent && null != (d = this._appUrlObj.query) && d[\"arcgis-auth-origin\"] && null != (u = this._appUrlObj.query) && u[\"arcgis-auth-portal\"] && this._hasSameServerInstance(this._getServerInstanceRoot(this._appUrlObj.query[\"arcgis-auth-portal\"]), e.resUrl_)) {\n        var S;\n        window.parent.postMessage({\n          type: \"arcgis:auth:requestCredential\"\n        }, this._appUrlObj.query[\"arcgis-auth-origin\"]);\n        const s = o(window, \"message\", e => {\n          e.source === window.parent && e.data && (\"arcgis:auth:credential\" === e.data.type ? (s.remove(), e.data.credential.expires < Date.now() ? r(new i(\"identity-manager:credential-request-failed\", \"Parent application's token has expired.\")) : t(new j(e.data.credential))) : \"arcgis:auth:error\" === e.data.type && (s.remove(), \"tokenExpiredError\" === e.data.error.name ? r(new i(\"identity-manager:credential-request-failed\", \"Parent application's token has expired.\")) : r(i.fromJSON(e.data.error))));\n        });\n        c(null == (S = e.options_) ? void 0 : S.signal, () => {\n          s.remove();\n        });\n      } else if (g) {\n        let n = g._oAuthCred;\n\n        if (!n) {\n          const e = new T(g, b),\n                t = new T(g, D);\n          e.isValid() && t.isValid() ? e.expires > t.expires ? (n = e, t.destroy()) : (n = t, e.destroy()) : n = e.isValid() ? e : t, g._oAuthCred = n;\n        }\n\n        if (n.isValid()) {\n          m = new j({\n            userId: n.userId,\n            server: p.server,\n            token: n.token,\n            expires: n.expires,\n            ssl: n.ssl,\n            _oAuthCred: n\n          });\n\n          const r = g.appId !== n.appId && this._doPortalSignIn(e.resUrl_);\n\n          r || n.refreshToken ? (e._pendingDfd = n.refreshToken ? this._getOAuthToken(p.server, n.refreshToken, n.appId).then(e => (m.expires = Date.now() + 1e3 * e.expires_in, m.token = e.access_token, m)) : Promise.resolve(m), e._pendingDfd.then(e => r ? this._exchangeToken(e.server, g.appId, e.token).then(t => (e.token = t, e)).catch(() => e) : e).then(e => {\n            t(e);\n          }).catch(() => {\n            n.destroy(), s();\n          })) : t(m);\n        } else if (this._oAuthLocationParams && this._hasSameServerInstance(g.portalUrl, this._oAuthLocationParams.state.portalUrl) && (this._oAuthLocationParams.access_token || this._oAuthLocationParams.code && this._oAuthLocationParams.state.uid === n.stateUID && n.codeVerifier)) {\n          const s = this._oAuthLocationParams;\n          this._oAuthLocationParams = null, e._pendingDfd = this._processOAuthResponseParams(s, g, p).then(e => {\n            t(e);\n          }).catch(r);\n        } else {\n          const s = () => {\n            f ? e._pendingDfd = this.oAuthSignIn(e.resUrl_, p, g, e.options_).then(t, r) : (v = new i(\"identity-manager:not-authenticated\", \"User is not signed in.\"), r(v));\n          };\n\n          this._doPortalSignIn(e.resUrl_) ? e._pendingDfd = this._getPlatformSelf(p.server, g.appId).then(e => {\n            _(e.portalUrl, this._appOrigin, !0) ? (m = new j({\n              userId: e.username,\n              server: p.server,\n              expires: Date.now() + 1e3 * e.expires_in,\n              token: e.token\n            }), t(m)) : s();\n          }).catch(s) : s();\n        }\n      } else if (f) {\n        if (this._checkProtocol(e.resUrl_, p, r, e.admin_)) {\n          let s = e.options_;\n          e.admin_ && (s = s || {}, s.isAdmin = !0), e._pendingDfd = this.signIn(e.resUrl_, p, s).then(t, r);\n        }\n      } else v = new i(\"identity-manager:not-authenticated\", \"User is not signed in.\"), r(v);\n    },\n          n = () => {\n      const s = e.sinfo_,\n            i = s.owningSystemUrl,\n            n = e.options_;\n      let o, a, h, l;\n      if (n && (o = n.token, a = n.error, h = n.prompt), l = this._findCredential(i, {\n        token: o,\n        resource: e.resUrl_\n      }), !l) for (const e of this.credentials) if (this._isIdProvider(i, e.server)) {\n        l = e;\n        break;\n      }\n\n      if (l) {\n        const i = this.findCredential(e.resUrl_, l.userId);\n        if (i) t(i);else if (C(s, this._legacyFed)) {\n          const e = l.toJSON();\n          e.server = s.server, e.resources = null, t(new j(e));\n        } else {\n          (e._pendingDfd = this.generateToken(this.findServerInfo(l.server), null, {\n            serverUrl: e.resUrl_,\n            token: l.token,\n            signal: e.options_.signal,\n            ssl: l.ssl\n          })).then(r => {\n            t(new j({\n              userId: l.userId,\n              server: s.server,\n              token: r.token,\n              expires: null != r.expires ? Number(r.expires) : null,\n              ssl: !!r.ssl,\n              isAdmin: e.admin_,\n              validity: r.validity\n            }));\n          }, r);\n        }\n      } else {\n        this._busy = null, o && (e.options_.token = null);\n        (e._pendingDfd = this.getCredential(i.replace(/\\/?$/, \"/sharing\"), {\n          resource: e.resUrl_,\n          owningTenant: s.owningTenant,\n          signal: e.options_.signal,\n          token: o,\n          error: a,\n          prompt: h\n        })).then(() => {\n          this._enqueue(e.resUrl_, e.sinfo_, e.options_, e, e.admin_);\n        }, t => {\n          e.resUrl_ = e.sinfo_ = e.refresh_ = null, e.reject(t);\n        });\n      }\n    };\n\n    this._errbackFunc = r;\n\n    const a = e.sinfo_.owningSystemUrl,\n          l = this._isServerRsrc(e.resUrl_),\n          d = e.sinfo_._restInfoPms;\n\n    d ? d.promise.then(t => {\n      const r = e.sinfo_;\n\n      if (r._restInfoPms) {\n        r.adminTokenServiceUrl = r._restInfoPms.adminUrl, r._restInfoPms = null, r.tokenServiceUrl = h(\"authInfo.tokenServicesUrl\", t) || h(\"authInfo.tokenServiceUrl\", t) || h(\"tokenServiceUrl\", t), r.shortLivedTokenValidity = h(\"authInfo.shortLivedTokenValidity\", t), r.currentVersion = t.currentVersion, r.owningTenant = t.owningTenant;\n        const e = r.owningSystemUrl = t.owningSystemUrl;\n        e && this._portals.push(e);\n      }\n\n      l && r.owningSystemUrl ? n() : s();\n    }, () => {\n      e.sinfo_._restInfoPms = null;\n      const t = new i(\"identity-manager:server-identification-failed\", \"Unknown resource - could not find token service endpoint.\");\n      r(t);\n    }) : l && a ? n() : e.sinfo_._selfReq ? e.sinfo_._selfReq.selfDfd.then(t => {\n      const r = {};\n      let s, i, n, o;\n      return t && (s = t.user && t.user.username, r.username = s, r.allSSL = t.allSSL, i = t.supportsOAuth, n = parseFloat(t.currentVersion), \"multitenant\" === t.portalMode && (o = t.customBaseUrl), e.sinfo_.currentVersion = n), e.sinfo_.webTierAuth = !!s, s && this.normalizeWebTierAuth ? this.generateToken(e.sinfo_, null, {\n        ssl: r.allSSL\n      }).catch(() => null).then(e => (r.portalToken = e && e.token, r.tokenExpiration = e && e.expires, r)) : !s && i && n >= 4.4 && !this._findOAuthInfo(e.resUrl_) ? this._generateOAuthInfo({\n        portalUrl: e.sinfo_.server,\n        customBaseUrl: o,\n        owningTenant: e.sinfo_._selfReq.owningTenant\n      }).catch(() => null).then(() => r) : r;\n    }).catch(() => null).then(t => {\n      e.sinfo_._selfReq = null, t ? s(t.username, t.allSSL, t.portalToken, t.tokenExpiration) : s();\n    }) : s();\n  }\n\n  _generateOAuthInfo(e) {\n    let t,\n        r,\n        i = e.portalUrl;\n    const n = e.customBaseUrl,\n          o = e.owningTenant,\n          a = !this.defaultOAuthInfo && this._createDefaultOAuthInfo && !this._hasTestedIfAppIsOnPortal;\n\n    if (a) {\n      r = window.location.href;\n      let e = r.indexOf(\"?\");\n      e > -1 && (r = r.slice(0, e)), e = r.search(/\\/(apps|home)\\//), r = e > -1 ? r.slice(0, e) : null;\n    }\n\n    return a && r ? (this._hasTestedIfAppIsOnPortal = !0, t = s(r + \"/sharing/rest\", {\n      query: {\n        f: \"json\"\n      }\n    }).then(() => {\n      this.defaultOAuthInfo = new x({\n        appId: \"arcgisonline\",\n        popupCallbackUrl: r + \"/home/oauth-callback.html\"\n      });\n    })) : t = Promise.resolve(), t.then(() => {\n      if (this.defaultOAuthInfo) return i = i.replace(/^http:/i, \"https:\"), s(i + \"/sharing/rest/oauth2/validateRedirectUri\", {\n        query: {\n          accountId: o,\n          client_id: this.defaultOAuthInfo.appId,\n          redirect_uri: w(this.defaultOAuthInfo.popupCallbackUrl),\n          f: \"json\"\n        }\n      }).then(e => {\n        if (e.data.valid) {\n          const t = this.defaultOAuthInfo.clone();\n          e.data.urlKey && n ? t.portalUrl = \"https://\" + e.data.urlKey.toLowerCase() + \".\" + n : t.portalUrl = i, t.popup = window !== window.top || !(_(i, this._appOrigin) || this._gwDomains.some(e => e.regex.test(i) && e.regex.test(this._appOrigin))), this.oAuthInfos.push(t);\n        }\n      });\n    });\n  }\n\n  _doOAuthSignIn(e, t, r, s) {\n    const n = r._oAuthCred,\n          a = {\n      portalUrl: r.portalUrl\n    };\n    !r.popup && r.preserveUrlHash && window.location.hash && (a.hash = window.location.hash), n.stateUID && (a.uid = n.stateUID);\n    const h = {\n      client_id: r.appId,\n      response_type: n.codeVerifier ? \"code\" : \"token\",\n      state: JSON.stringify(a),\n      expiration: r.expiration,\n      locale: r.locale,\n      redirect_uri: this._getRedirectURI(r, !!n.codeVerifier)\n    };\n    r.forceLogin && (h.force_login = !0), r.forceUserId && r.userId && (h.prepopulatedusername = r.userId), !r.popup && this._doPortalSignIn(e) && (h.redirectToUserOrgUrl = !0), n.codeVerifier && (h.code_challenge = s || n.codeVerifier, h.code_challenge_method = s ? \"S256\" : \"plain\");\n    const l = r.portalUrl.replace(/^http:/i, \"https:\") + \"/sharing/oauth2/authorize\",\n          c = l + \"?\" + m(h);\n\n    if (r.popup) {\n      const e = window.open(c, \"esriJSAPIOAuth\", r.popupWindowFeatures);\n      if (e) e.focus(), this._oAuthDfd.oAuthWin_ = e, this._oAuthIntervalId = setInterval(() => {\n        if (e.closed) {\n          clearInterval(this._oAuthIntervalId), this._oAuthOnPopupHandle.remove();\n          const e = this._oAuthDfd;\n\n          if (e) {\n            const t = new i(\"identity-manager:user-aborted\", \"ABORTED\");\n            e.reject(t);\n          }\n        }\n      }, 500), this._oAuthOnPopupHandle = o(window, [\"arcgis:auth:hash\", \"arcgis:auth:location:search\"], e => {\n        \"arcgis:auth:hash\" === e.type ? this.setOAuthResponseHash(e.detail) : this._setOAuthResponseQueryString(e.detail);\n      });else {\n        const e = new i(\"identity-manager:popup-blocked\", \"ABORTED\");\n\n        this._oAuthDfd.reject(e);\n      }\n    } else this._rejectOnPersistedPageShow = !0, this._oAuthRedirectFunc ? this._oAuthRedirectFunc({\n      authorizeParams: h,\n      authorizeUrl: l,\n      resourceUrl: e,\n      serverInfo: t,\n      oAuthInfo: r\n    }) : window.location.href = c;\n  }\n\n  _getRedirectURI(e, t) {\n    const r = window.location.href.replace(/#.*$/, \"\");\n    if (e.popup) return w(e.popupCallbackUrl);\n\n    if (t) {\n      const e = p(r);\n      return e.query && [\"code\", \"error\", \"error_description\", \"message_code\", \"persist\", \"state\"].forEach(t => {\n        delete e.query[t];\n      }), I(e.path, e.query);\n    }\n\n    return r;\n  }\n\n}\n\nq.prototype.declaredClass = \"esri.identity.IdentityManagerBase\";\nlet j = class extends n.EventedAccessor {\n  constructor(e) {\n    super(e), this._oAuthCred = null, this.tokenRefreshBuffer = 2, e && e._oAuthCred && (this._oAuthCred = e._oAuthCred);\n  }\n\n  initialize() {\n    this.resources = this.resources || [], null == this.creationTime && (this.creationTime = Date.now());\n  }\n\n  refreshToken() {\n    const e = r.findServerInfo(this.server),\n          t = e && e.owningSystemUrl,\n          s = !!t && \"server\" === this.scope,\n          i = s && C(e, r._legacyFed),\n          n = e.webTierAuth,\n          o = n && r.normalizeWebTierAuth,\n          a = P[this.server],\n          h = a && a[this.userId];\n    let l,\n        c = this.resources && this.resources[0],\n        d = s && r.findServerInfo(t),\n        u = {\n      username: this.userId,\n      password: h\n    };\n    if (n && !o) return;\n    s && !d && r.serverInfos.some(e => (r._isIdProvider(t, e.server) && (d = e), !!d));\n    const p = d && r.findCredential(d.server, this.userId);\n\n    if (!s || p) {\n      if (!i) {\n        if (s) l = {\n          serverUrl: c,\n          token: p && p.token,\n          ssl: p && p.ssl\n        };else if (o) u = null, l = {\n          ssl: this.ssl\n        };else {\n          if (!h) {\n            let t;\n            return c && (c = r._sanitizeUrl(c), this._enqueued = 1, t = r._enqueue(c, e, null, null, this.isAdmin, this), t.then(() => {\n              this._enqueued = 0, this.refreshServerTokens();\n            }).catch(() => {\n              this._enqueued = 0;\n            })), t;\n          }\n\n          this.isAdmin && (l = {\n            isAdmin: !0\n          });\n        }\n        return r.generateToken(s ? d : e, s ? null : u, l).then(e => {\n          this.token = e.token, this.expires = null != e.expires ? Number(e.expires) : null, this.creationTime = Date.now(), this.validity = e.validity, this.emitTokenChange(), this.refreshServerTokens();\n        }).catch(() => {});\n      }\n\n      p.refreshToken();\n    }\n  }\n\n  refreshServerTokens() {\n    \"portal\" === this.scope && r.credentials.forEach(e => {\n      const t = r.findServerInfo(e.server),\n            s = t && t.owningSystemUrl;\n      e !== this && e.userId === this.userId && s && \"server\" === e.scope && (r._hasSameServerInstance(this.server, s) || r._isIdProvider(s, this.server)) && (C(t, r._legacyFed) ? (e.token = this.token, e.expires = this.expires, e.creationTime = this.creationTime, e.validity = this.validity, e.emitTokenChange()) : e.refreshToken());\n    });\n  }\n\n  emitTokenChange(e) {\n    clearTimeout(this._refreshTimer);\n    const t = this.server && r.findServerInfo(this.server),\n          s = t && t.owningSystemUrl,\n          i = s && r.findServerInfo(s);\n    !1 === e || s && \"portal\" !== this.scope && (!i || !i.webTierAuth || r.normalizeWebTierAuth) || null == this.expires && null == this.validity || this._startRefreshTimer(), this.emit(\"token-change\");\n  }\n\n  destroy() {\n    this.userId = this.server = this.token = this.expires = this.validity = this.resources = this.creationTime = null, this._oAuthCred && (this._oAuthCred.destroy(), this._oAuthCred = null);\n    const e = r.credentials.indexOf(this);\n    e > -1 && r.credentials.splice(e, 1), this.emitTokenChange(), this.emit(\"destroy\");\n  }\n\n  toJSON() {\n    const e = a({\n      userId: this.userId,\n      server: this.server,\n      token: this.token,\n      expires: this.expires,\n      validity: this.validity,\n      ssl: this.ssl,\n      isAdmin: this.isAdmin,\n      creationTime: this.creationTime,\n      scope: this.scope\n    }),\n          t = this.resources;\n    return t && t.length > 0 && (e.resources = t.slice()), e;\n  }\n\n  _startRefreshTimer() {\n    clearTimeout(this._refreshTimer);\n    const e = 6e4 * this.tokenRefreshBuffer,\n          t = 2 ** 31 - 1;\n    let r = (this.validity ? this.creationTime + 6e4 * this.validity : this.expires) - Date.now();\n    r < 0 ? r = 0 : r > t && (r = t), this._refreshTimer = setTimeout(this.refreshToken.bind(this), r > e ? r - e : r);\n  }\n\n};\ne([A()], j.prototype, \"creationTime\", void 0), e([A()], j.prototype, \"expires\", void 0), e([A()], j.prototype, \"isAdmin\", void 0), e([A()], j.prototype, \"oAuthState\", void 0), e([A()], j.prototype, \"resources\", void 0), e([A()], j.prototype, \"scope\", void 0), e([A()], j.prototype, \"server\", void 0), e([A()], j.prototype, \"ssl\", void 0), e([A()], j.prototype, \"token\", void 0), e([A()], j.prototype, \"tokenRefreshBuffer\", void 0), e([A()], j.prototype, \"userId\", void 0), e([A()], j.prototype, \"validity\", void 0), j = e([k(\"esri.identity.Credential\")], j);\nexport { j as Credential, q as IdentityManagerBase };","map":{"version":3,"sources":["D:/Github/CUSP_DataBase/CUSP_DB/src/main/gis/node_modules/@arcgis/core/identity/IdentityManagerBase.js"],"names":["_","e","t","id","r","s","i","n","on","o","fixJson","a","getDeepValue","h","createResolver","l","onAbort","c","isAborted","d","Url","u","urlToObject","p","hasSameOrigin","queryToObject","f","base64UrlEncode","g","objectToQuery","m","normalize","v","getProxyRule","S","makeAbsolute","w","addQueryParameters","I","property","A","subclass","k","y","U","T","x","O","P","R","owningSystemUrl","host","server","test","C","some","b","D","window","localStorage","sessionStorage","q","constructor","_portalConfig","globalThis","esriGeowConfig","serverInfos","oAuthInfos","credentials","_soReqs","_xoReqs","_portals","defaultOAuthInfo","defaultTokenValidity","dialog","formConstructor","tokenValidity","normalizeWebTierAuth","_appOrigin","origin","location","_appUrlObj","href","_busy","_rejectOnPersistedPageShow","_oAuthLocationParams","_gwTokenUrl","_agsRest","_agsPortal","_agsAdmin","_adminSvcs","_gwDomains","regex","customBaseUrl","tokenServiceUrl","_legacyFed","_regexSDirUrl","_regexServerType","_gwUser","_gwItem","_gwGroup","_rePortalTokenSvc","_createDefaultOAuthInfo","_hasTestedIfAppIsOnPortal","_getOAuthLocationParams","addEventListener","_pageShowHandler","registerServers","filter","findServerInfo","concat","forEach","push","hasPortal","registerOAuthInfos","findOAuthInfo","portalUrl","splice","indexOf","registerToken","_sanitizeUrl","_isServerRsrc","_getServerInstanceRoot","hasServer","_getTokenSvcUrl","_findCredential","Object","assign","j","userId","token","expires","ssl","scope","resources","emitTokenChange","refreshServerTokens","toJSON","map","initialize","JSON","parse","declaredClass","length","appId","Date","now","_hasSameServerInstance","findCredential","_getIdenticalSvcIdx","getCredential","error","prompt","AbortController","signal","abort","reject","promise","_isAdminResource","details","httpStatus","destroy","resolve","_restInfoPms","_selfReq","owningTenant","selfDfd","_getPortalSelf","replace","_enqueue","getResourceName","_isRESTService","generateToken","shortLivedTokenValidity","isAdmin","serverUrl","customParameters","adminTokenServiceUrl","toLowerCase","webTierAuth","scheme","uri","port","query","request","username","password","expiration","referer","client","method","authMode","useProxy","_useProxy","ioArgs","withCredentials","then","data","validity","isBusy","checkSignInStatus","checkAppAccess","credential","_doPortalSignIn","force","client_id","valid","viewOnlyUserTypeApp","catch","name","viewOnly","setOAuthResponseHash","charAt","substring","_processOAuthPopupParams","setOAuthRedirectionHandler","_oAuthRedirectFunc","setProtocolErrorHandler","_protocolFunc","signIn","remove","_oAuthDfd","resource","content","open","emit","watch","Number","signingIn","oAuthSignIn","oAuthWin_","closed","close","resUrl_","sinfo_","oinfo_","_oAuthCred","storage","flowType","popup","currentVersion","crypto","getRandomValues","Uint8Array","codeVerifier","stateUID","save","_getCodeChallenge","oAuthPopupConfirmation","oAuthPrompt","_doOAuthSignIn","destroyCredentials","slice","enablePostMessageAuth","_postMessageAuthHandle","endsWith","type","source","postMessage","message","disablePostMessageAuth","hash","access_token","expires_in","state","hasOwnProperty","error_description","console","log","search","code","uid","pathname","history","replaceState","_getOAuthToken","grant_type","redirect_uri","code_verifier","refresh_token","isSecureContext","TextEncoder","encode","subtle","digest","Promise","persisted","_errbackFunc","_addResource","_removeResource","_findOAuthInfo","_isIdProvider","_isPortalDomain","String","_getOrigin","substr","_normalizeAGOLorgDomain","proxyUrl","path","_isIdenticalService","_getSuffix","restBaseUrl","adminUrl","_processOAuthResponseParams","_getRedirectURI","oAuthState","persist","refreshToken","refresh_token_expires_in","clearInterval","_oAuthIntervalId","_oAuthOnPopupHandle","_setOAuthResponseQueryString","_exchangeToken","_getPlatformSelf","headers","allSSL","portalMode","supportsOAuth","startsWith","_checkProtocol","trim","resourceUrl","serverInfo","options_","admin_","refresh_","focus","_doSignIn","creationTime","includes","shift","parent","fromJSON","isValid","_pendingDfd","user","parseFloat","portalToken","tokenExpiration","_generateOAuthInfo","popupCallbackUrl","accountId","clone","urlKey","top","preserveUrlHash","response_type","stringify","locale","forceLogin","force_login","forceUserId","prepopulatedusername","redirectToUserOrgUrl","code_challenge","code_challenge_method","popupWindowFeatures","setInterval","detail","authorizeParams","authorizeUrl","oAuthInfo","prototype","EventedAccessor","tokenRefreshBuffer","_enqueued","clearTimeout","_refreshTimer","_startRefreshTimer","setTimeout","bind","Credential","IdentityManagerBase"],"mappings":"AAAA;AACA;AACA;AACA;AACA,SAAOA,CAAC,IAAIC,CAAZ,QAAkB,wBAAlB;AAA2C,OAAOC,CAAP,MAAa,cAAb;AAA4B,SAAOC,EAAE,IAAIC,CAAb,QAAmB,cAAnB;AAAkC,OAAOC,CAAP,MAAa,eAAb;AAA6B,OAAOC,CAAP,MAAa,kBAAb;AAAgC,OAAOC,CAAP,MAAa,oBAAb;AAAkC,SAAOC,EAAE,IAAIC,CAAb,QAAmB,mBAAnB;AAAuC,SAAOC,OAAO,IAAIC,CAAlB,QAAwB,iBAAxB;AAA0C,SAAOC,YAAY,IAAIC,CAAvB,QAA6B,mBAA7B;AAAiD,SAAOC,cAAc,IAAIC,CAAzB,EAA2BC,OAAO,IAAIC,CAAtC,EAAwCC,SAAS,IAAIC,CAArD,QAA2D,yBAA3D;AAAqF,SAAOC,GAAG,IAAIC,CAAd,EAAgBC,WAAW,IAAIC,CAA/B,EAAiCC,aAAa,IAAIxB,CAAlD,EAAoDyB,aAAa,IAAIC,CAArE,EAAuEC,eAAe,IAAIC,CAA1F,EAA4FC,aAAa,IAAIC,CAA7G,EAA+GC,SAAS,IAAIC,CAA5H,EAA8HC,YAAY,IAAIC,CAA9I,EAAgJC,YAAY,IAAIC,CAAhK,EAAkKC,kBAAkB,IAAIC,CAAxL,QAA8L,qBAA9L;AAAoN,SAAOC,QAAQ,IAAIC,CAAnB,QAAyB,gDAAzB;AAA0E,OAAM,uCAAN;AAA8C,SAAOC,QAAQ,IAAIC,CAAnB,QAAyB,gDAAzB;AAA0E,OAAOC,CAAP,MAAa,mBAAb;AAAiC,OAAOC,CAAP,MAAa,oBAAb;AAAkC,OAAOC,CAAP,MAAa,sBAAb;AAAoC,OAAOC,CAAP,MAAa,gBAAb;AAA8B,OAAOC,CAAP,MAAa,iBAAb;;AAA+B,MAAMC,CAAC,GAAC,EAAR;AAAA,MAAWC,CAAC,GAAChD,CAAC,IAAE;AAAC,QAAMC,CAAC,GAAC,IAAImB,CAAJ,CAAMpB,CAAC,CAACiD,eAAR,EAAyBC,IAAjC;AAAA,QAAsC/C,CAAC,GAAC,IAAIiB,CAAJ,CAAMpB,CAAC,CAACmD,MAAR,EAAgBD,IAAxD;AAAA,QAA6D9C,CAAC,GAAC,mBAA/D;AAAmF,SAAOA,CAAC,CAACgD,IAAF,CAAOnD,CAAP,KAAWG,CAAC,CAACgD,IAAF,CAAOjD,CAAP,CAAlB;AAA4B,CAAhI;AAAA,MAAiIkD,CAAC,GAAC,CAACrD,CAAD,EAAGC,CAAH,KAAO,CAAC,EAAE+C,CAAC,CAAChD,CAAD,CAAD,IAAMC,CAAN,IAASA,CAAC,CAACqD,IAAF,CAAQrD,CAAC,IAAEA,CAAC,CAACmD,IAAF,CAAOpD,CAAC,CAACmD,MAAT,CAAX,CAAX,CAA3I;;AAAqL,IAAII,CAAC,GAAC,IAAN;AAAA,IAAWC,CAAC,GAAC,IAAb;;AAAkB,IAAG;AAACD,EAAAA,CAAC,GAACE,MAAM,CAACC,YAAT,EAAsBF,CAAC,GAACC,MAAM,CAACE,cAA/B;AAA8C,CAAlD,CAAkD,MAAK,CAAE;;AAAA,MAAMC,CAAN,SAAgBtD,CAAhB,CAAiB;AAACuD,EAAAA,WAAW,GAAE;AAAC,aAAQ,KAAKC,aAAL,GAAmBC,UAAU,CAACC,cAAtC,EAAqD,KAAKC,WAAL,GAAiB,EAAtE,EAAyE,KAAKC,UAAL,GAAgB,EAAzF,EAA4F,KAAKC,WAAL,GAAiB,EAA7G,EAAgH,KAAKC,OAAL,GAAa,EAA7H,EAAgI,KAAKC,OAAL,GAAa,EAA7I,EAAgJ,KAAKC,QAAL,GAAc,EAA9J,EAAiK,KAAKC,gBAAL,GAAsB,IAAvL,EAA4L,KAAKC,oBAAL,GAA0B,EAAtN,EAAyN,KAAKC,MAAL,GAAY,IAArO,EAA0O,KAAKC,eAAL,GAAqBhC,CAA/P,EAAiQ,KAAKiC,aAAL,GAAmB,IAApR,EAAyR,KAAKC,oBAAL,GAA0B,CAAC,CAApT,EAAsT,KAAKC,UAAL,GAAgB,WAASpB,MAAM,CAACqB,MAAhB,GAAuBrB,MAAM,CAACqB,MAA9B,GAAqCrB,MAAM,CAACsB,QAAP,CAAgBD,MAA3X,EAAkY,KAAKE,UAAL,GAAgB1D,CAAC,CAACmC,MAAM,CAACsB,QAAP,CAAgBE,IAAjB,CAAnZ,EAA0a,KAAKC,KAAL,GAAW,IAArb,EAA0b,KAAKC,0BAAL,GAAgC,CAAC,CAA3d,EAA6d,KAAKC,oBAAL,GAA0B,IAAvf,EAA4f,KAAKC,WAAL,GAAiB,6BAA7gB,EAA2iB,KAAKC,QAAL,GAAc,gBAAzjB,EAA0kB,KAAKC,UAAL,GAAgB,kBAA1lB,EAA6mB,KAAKC,SAAL,GAAe,gDAA5nB,EAA6qB,KAAKC,UAAL,GAAgB,gCAA7rB,EAA8tB,KAAKC,UAAL,GAAgB,CAAC;AAACC,MAAAA,KAAK,EAAC,+BAAP;AAAuCC,MAAAA,aAAa,EAAC,iBAArD;AAAuEC,MAAAA,eAAe,EAAC;AAAvF,KAAD,EAA6I;AAACF,MAAAA,KAAK,EAAC,sDAAP;AAA8DC,MAAAA,aAAa,EAAC,oBAA5E;AAAiGC,MAAAA,eAAe,EAAC;AAAjH,KAA7I,EAAmT;AAACF,MAAAA,KAAK,EAAC,4DAAP;AAAoEC,MAAAA,aAAa,EAAC,uBAAlF;AAA0GC,MAAAA,eAAe,EAAC;AAA1H,KAAnT,EAAqe;AAACF,MAAAA,KAAK,EAAC,uDAAP;AAA+DC,MAAAA,aAAa,EAAC,mBAA7E;AAAiGC,MAAAA,eAAe,EAAC;AAAjH,KAAre,EAA6oB;AAACF,MAAAA,KAAK,EAAC,2CAAP;AAAmDC,MAAAA,aAAa,EAAC,iBAAjE;AAAmFC,MAAAA,eAAe,EAAC;AAAnG,KAA7oB,CAA9uB,EAAohD,KAAKC,UAAL,GAAgB,EAApiD,EAAuiD,KAAKC,aAAL,GAAmB,6BAA1jD,EAAwlD,KAAKC,gBAAL,GAAsB,kVAA9mD,EAAi8D,KAAKC,OAAL,GAAa,+BAA98D,EAA8+D,KAAKC,OAAL,GAAa,+BAA3/D,EAA2hE,KAAKC,QAAL,GAAc,gCAAziE,EAA0kE,KAAKC,iBAAL,GAAuB,oCAAjmE,EAAsoE,KAAKC,uBAAL,GAA6B,CAAC,CAApqE,EAAsqE,KAAKC,yBAAL,GAA+B,CAAC,CAAtsE,EAAwsE,KAAKC,uBAAL,EAAxsE,EAAuuE9C,MAAM,CAAC+C,gBAAP,CAAwB,UAAxB,EAAoCxG,CAAC,IAAE;AAAC,WAAKyG,gBAAL,CAAsBzG,CAAtB;AAAyB,KAAjE,CAAvuE;AAA2yE;;AAAA0G,EAAAA,eAAe,CAAC1G,CAAD,EAAG;AAAC,UAAMC,CAAC,GAAC,KAAKgE,WAAb;AAAyBhE,IAAAA,CAAC,IAAED,CAAC,GAACA,CAAC,CAAC2G,MAAF,CAAU3G,CAAC,IAAE,CAAC,KAAK4G,cAAL,CAAoB5G,CAAC,CAACmD,MAAtB,CAAd,CAAF,EAAgD,KAAKc,WAAL,GAAiBhE,CAAC,CAAC4G,MAAF,CAAS7G,CAAT,CAAnE,IAAgF,KAAKiE,WAAL,GAAiBjE,CAAlG,EAAoGA,CAAC,CAAC8G,OAAF,CAAW9G,CAAC,IAAE;AAACA,MAAAA,CAAC,CAACiD,eAAF,IAAmB,KAAKqB,QAAL,CAAcyC,IAAd,CAAmB/G,CAAC,CAACiD,eAArB,CAAnB,EAAyDjD,CAAC,CAACgH,SAAF,IAAa,KAAK1C,QAAL,CAAcyC,IAAd,CAAmB/G,CAAC,CAACmD,MAArB,CAAtE;AAAmG,KAAlH,CAApG;AAAyN;;AAAA8D,EAAAA,kBAAkB,CAACjH,CAAD,EAAG;AAAC,UAAMC,CAAC,GAAC,KAAKiE,UAAb;;AAAwB,QAAGjE,CAAH,EAAK;AAAC,WAAI,MAAME,CAAV,IAAeH,CAAf,EAAiB;AAAC,cAAMA,CAAC,GAAC,KAAKkH,aAAL,CAAmB/G,CAAC,CAACgH,SAArB,CAAR;AAAwCnH,QAAAA,CAAC,IAAEC,CAAC,CAACmH,MAAF,CAASnH,CAAC,CAACoH,OAAF,CAAUrH,CAAV,CAAT,EAAsB,CAAtB,CAAH;AAA4B;;AAAA,WAAKkE,UAAL,GAAgBjE,CAAC,CAAC4G,MAAF,CAAS7G,CAAT,CAAhB;AAA4B,KAAxH,MAA6H,KAAKkE,UAAL,GAAgBlE,CAAhB;AAAkB;;AAAAsH,EAAAA,aAAa,CAACtH,CAAD,EAAG;AAACA,IAAAA,CAAC,GAAC,EAAC,GAAGA;AAAJ,KAAF;;AAAS,UAAMC,CAAC,GAAC,KAAKsH,YAAL,CAAkBvH,CAAC,CAACmD,MAApB,CAAR;AAAA,UAAoChD,CAAC,GAAC,KAAKqH,aAAL,CAAmBvH,CAAnB,CAAtC;;AAA4D,QAAIG,CAAJ;AAAA,QAAMC,CAAC,GAAC,KAAKuG,cAAL,CAAoB3G,CAApB,CAAR;AAAA,QAA+BK,CAAC,GAAC,CAAC,CAAlC;AAAoCD,IAAAA,CAAC,KAAGA,CAAC,GAAC,IAAIyC,CAAJ,EAAF,EAAQzC,CAAC,CAAC8C,MAAF,GAAS,KAAKsE,sBAAL,CAA4BxH,CAA5B,CAAjB,EAAgDE,CAAC,GAACE,CAAC,CAACqH,SAAF,GAAY,CAAC,CAAd,IAAiBrH,CAAC,CAACwF,eAAF,GAAkB,KAAK8B,eAAL,CAAqB1H,CAArB,CAAlB,EAA0CI,CAAC,CAAC2G,SAAF,GAAY,CAAC,CAAxE,CAAjD,EAA4H,KAAKN,eAAL,CAAqB,CAACrG,CAAD,CAArB,CAA/H,CAAD,EAA2JD,CAAC,GAAC,KAAKwH,eAAL,CAAqB3H,CAArB,CAA7J,EAAqLG,CAAC,IAAE,OAAOJ,CAAC,CAACmD,MAAT,EAAgB0E,MAAM,CAACC,MAAP,CAAc1H,CAAd,EAAgBJ,CAAhB,CAAhB,EAAmCM,CAAC,GAAC,CAAC,CAAxC,KAA4CF,CAAC,GAAC,IAAI2H,CAAJ,CAAM;AAACC,MAAAA,MAAM,EAAChI,CAAC,CAACgI,MAAV;AAAiB7E,MAAAA,MAAM,EAAC9C,CAAC,CAAC8C,MAA1B;AAAiC8E,MAAAA,KAAK,EAACjI,CAAC,CAACiI,KAAzC;AAA+CC,MAAAA,OAAO,EAAClI,CAAC,CAACkI,OAAzD;AAAiEC,MAAAA,GAAG,EAACnI,CAAC,CAACmI,GAAvE;AAA2EC,MAAAA,KAAK,EAACjI,CAAC,GAAC,QAAD,GAAU;AAA5F,KAAN,CAAF,EAA+GC,CAAC,CAACiI,SAAF,GAAY,CAACpI,CAAD,CAA3H,EAA+H,KAAKkE,WAAL,CAAiB4C,IAAjB,CAAsB3G,CAAtB,CAA3K,CAAtL,EAA2XA,CAAC,CAACkI,eAAF,CAAkB,CAAC,CAAnB,CAA3X,EAAiZhI,CAAC,IAAEF,CAAC,CAACmI,mBAAF,EAApZ;AAA4a;;AAAAC,EAAAA,MAAM,GAAE;AAAC,WAAO9H,CAAC,CAAC;AAACuD,MAAAA,WAAW,EAAC,KAAKA,WAAL,CAAiBwE,GAAjB,CAAsBzI,CAAC,IAAEA,CAAC,CAACwI,MAAF,EAAzB,CAAb;AAAmDtE,MAAAA,UAAU,EAAC,KAAKA,UAAL,CAAgBuE,GAAhB,CAAqBzI,CAAC,IAAEA,CAAC,CAACwI,MAAF,EAAxB,CAA9D;AAAmGrE,MAAAA,WAAW,EAAC,KAAKA,WAAL,CAAiBsE,GAAjB,CAAsBzI,CAAC,IAAEA,CAAC,CAACwI,MAAF,EAAzB;AAA/G,KAAD,CAAR;AAAgK;;AAAAE,EAAAA,UAAU,CAAC1I,CAAD,EAAG;AAAC,QAAG,CAACA,CAAJ,EAAM;AAAO,gBAAU,OAAOA,CAAjB,KAAqBA,CAAC,GAAC2I,IAAI,CAACC,KAAL,CAAW5I,CAAX,CAAvB;AAAsC,UAAMC,CAAC,GAACD,CAAC,CAACiE,WAAV;AAAA,UAAsB9D,CAAC,GAACH,CAAC,CAACkE,UAA1B;AAAA,UAAqC9D,CAAC,GAACJ,CAAC,CAACmE,WAAzC;;AAAqD,QAAGlE,CAAH,EAAK;AAAC,YAAMD,CAAC,GAAC,EAAR;AAAWC,MAAAA,CAAC,CAAC6G,OAAF,CAAW7G,CAAC,IAAE;AAACA,QAAAA,CAAC,CAACkD,MAAF,IAAUlD,CAAC,CAAC4F,eAAZ,IAA6B7F,CAAC,CAAC+G,IAAF,CAAO9G,CAAC,CAAC4I,aAAF,GAAgB5I,CAAhB,GAAkB,IAAI6C,CAAJ,CAAM7C,CAAN,CAAzB,CAA7B;AAAgE,OAA/E,GAAkFD,CAAC,CAAC8I,MAAF,IAAU,KAAKpC,eAAL,CAAqB1G,CAArB,CAA5F;AAAoH;;AAAA,QAAGG,CAAH,EAAK;AAAC,YAAMH,CAAC,GAAC,EAAR;AAAWG,MAAAA,CAAC,CAAC2G,OAAF,CAAW7G,CAAC,IAAE;AAACA,QAAAA,CAAC,CAAC8I,KAAF,IAAS/I,CAAC,CAAC+G,IAAF,CAAO9G,CAAC,CAAC4I,aAAF,GAAgB5I,CAAhB,GAAkB,IAAI4C,CAAJ,CAAM5C,CAAN,CAAzB,CAAT;AAA4C,OAA3D,GAA8DD,CAAC,CAAC8I,MAAF,IAAU,KAAK7B,kBAAL,CAAwBjH,CAAxB,CAAxE;AAAmG;;AAAAI,IAAAA,CAAC,IAAEA,CAAC,CAAC0G,OAAF,CAAW9G,CAAC,IAAE;AAACA,MAAAA,CAAC,CAACmD,MAAF,IAAUnD,CAAC,CAACiI,KAAZ,IAAmBjI,CAAC,CAACkI,OAArB,IAA8BlI,CAAC,CAACkI,OAAF,GAAUc,IAAI,CAACC,GAAL,EAAxC,KAAqD,CAACjJ,CAAC,GAACA,CAAC,CAAC6I,aAAF,GAAgB7I,CAAhB,GAAkB,IAAI+H,CAAJ,CAAM/H,CAAN,CAArB,EAA+BsI,eAA/B,IAAiD,KAAKnE,WAAL,CAAiB4C,IAAjB,CAAsB/G,CAAtB,CAAtG;AAAgI,KAA/I,CAAH;AAAqJ;;AAAA4G,EAAAA,cAAc,CAAC5G,CAAD,EAAG;AAAC,QAAIC,CAAJ;AAAMD,IAAAA,CAAC,GAAC,KAAKuH,YAAL,CAAkBvH,CAAlB,CAAF;;AAAuB,SAAI,MAAMG,CAAV,IAAe,KAAK8D,WAApB,EAAgC,IAAG,KAAKiF,sBAAL,CAA4B/I,CAAC,CAACgD,MAA9B,EAAqCnD,CAArC,CAAH,EAA2C;AAACC,MAAAA,CAAC,GAACE,CAAF;AAAI;AAAM;;AAAA,WAAOF,CAAP;AAAS;;AAAAiH,EAAAA,aAAa,CAAClH,CAAD,EAAG;AAAC,QAAIC,CAAJ;AAAMD,IAAAA,CAAC,GAAC,KAAKuH,YAAL,CAAkBvH,CAAlB,CAAF;;AAAuB,SAAI,MAAMG,CAAV,IAAe,KAAK+D,UAApB,EAA+B,IAAG,KAAKgF,sBAAL,CAA4B/I,CAAC,CAACgH,SAA9B,EAAwCnH,CAAxC,CAAH,EAA8C;AAACC,MAAAA,CAAC,GAACE,CAAF;AAAI;AAAM;;AAAA,WAAOF,CAAP;AAAS;;AAAAkJ,EAAAA,cAAc,CAACnJ,CAAD,EAAGC,CAAH,EAAK;AAAC,QAAIE,CAAJ;AAAMH,IAAAA,CAAC,GAAC,KAAKuH,YAAL,CAAkBvH,CAAlB,CAAF;AAAuB,UAAMI,CAAC,GAAC,KAAKoH,aAAL,CAAmBxH,CAAnB,IAAsB,QAAtB,GAA+B,QAAvC;;AAAgD,QAAGC,CAAH,EAAK;AAAC,WAAI,MAAMI,CAAV,IAAe,KAAK8D,WAApB,EAAgC,IAAG,KAAK+E,sBAAL,CAA4B7I,CAAC,CAAC8C,MAA9B,EAAqCnD,CAArC,KAAyCC,CAAC,KAAGI,CAAC,CAAC2H,MAA/C,IAAuD3H,CAAC,CAAC+H,KAAF,KAAUhI,CAApE,EAAsE;AAACD,QAAAA,CAAC,GAACE,CAAF;AAAI;AAAM;AAAC,KAAxH,MAA6H,KAAI,MAAMA,CAAV,IAAe,KAAK8D,WAApB,EAAgC,IAAG,KAAK+E,sBAAL,CAA4B7I,CAAC,CAAC8C,MAA9B,EAAqCnD,CAArC,KAAyC,CAAC,CAAD,KAAK,KAAKoJ,mBAAL,CAAyBpJ,CAAzB,EAA2BK,CAA3B,CAA9C,IAA6EA,CAAC,CAAC+H,KAAF,KAAUhI,CAA1F,EAA4F;AAACD,MAAAA,CAAC,GAACE,CAAF;AAAI;AAAM;;AAAA,WAAOF,CAAP;AAAS;;AAAAkJ,EAAAA,aAAa,CAACrJ,CAAD,EAAGC,CAAH,EAAK;AAAC,QAAIE,CAAJ;AAAA,QAAMC,CAAN;AAAA,QAAQE,CAAC,GAAC,CAAC,CAAX;AAAaL,IAAAA,CAAC,KAAGE,CAAC,GAAC,CAAC,CAACF,CAAC,CAACgI,KAAN,EAAY7H,CAAC,GAACH,CAAC,CAACqJ,KAAhB,EAAsBhJ,CAAC,GAAC,CAAC,CAAD,KAAKL,CAAC,CAACsJ,MAAlC,CAAD,EAA2CtJ,CAAC,GAAC,EAAC,GAAGA;AAAJ,KAA7C,EAAoDD,CAAC,GAAC,KAAKuH,YAAL,CAAkBvH,CAAlB,CAAtD;AAA2E,UAAMQ,CAAC,GAAC,IAAIgJ,eAAJ,EAAR;AAAA,UAA4B9I,CAAC,GAACI,CAAC,EAA/B;AAAkC,QAAGb,CAAC,CAACwJ,MAAF,IAAUzI,CAAC,CAACf,CAAC,CAACwJ,MAAH,EAAW,MAAI;AAACjJ,MAAAA,CAAC,CAACkJ,KAAF;AAAU,KAA1B,CAAX,EAAwC1I,CAAC,CAACR,CAAD,EAAI,MAAI;AAACE,MAAAA,CAAC,CAACiJ,MAAF,CAAS,IAAItJ,CAAJ,CAAM,+BAAN,EAAsC,SAAtC,CAAT;AAA2D,KAApE,CAAzC,EAAgHa,CAAC,CAACV,CAAD,CAApH,EAAwH,OAAOE,CAAC,CAACkJ,OAAT;AAAiB3J,IAAAA,CAAC,CAACwJ,MAAF,GAASjJ,CAAC,CAACiJ,MAAX;;AAAkB,UAAM7I,CAAC,GAAC,KAAKiJ,gBAAL,CAAsB7J,CAAtB,CAAR;AAAA,UAAiCoB,CAAC,GAACjB,CAAC,GAAC,KAAKgJ,cAAL,CAAoBnJ,CAApB,CAAD,GAAwB,IAA5D;;AAAiE,QAAIsB,CAAJ;AAAM,QAAGF,CAAC,IAAEhB,CAAH,IAAMA,CAAC,CAAC0J,OAAR,IAAiB,QAAM1J,CAAC,CAAC0J,OAAF,CAAUC,UAApC,EAA+C3I,CAAC,CAAC4I,OAAF,GAA/C,KAAgE,IAAG5I,CAAH,EAAK,OAAOE,CAAC,GAAC,IAAIjB,CAAJ,CAAM,iCAAN,EAAwC,sCAAoCe,CAAC,CAAC4G,MAAtC,GAA6C,8CAA7C,GAA4FhI,CAApI,EAAsI;AAACsJ,MAAAA,KAAK,EAAClJ;AAAP,KAAtI,CAAF,EAAmJM,CAAC,CAACiJ,MAAF,CAASrI,CAAT,CAAnJ,EAA+JZ,CAAC,CAACkJ,OAAxK;;AAAgL,UAAMnI,CAAC,GAAC,KAAKmG,eAAL,CAAqB5H,CAArB,EAAuBC,CAAvB,CAAR;;AAAkC,QAAGwB,CAAH,EAAK,OAAOf,CAAC,CAACuJ,OAAF,CAAUxI,CAAV,GAAaf,CAAC,CAACkJ,OAAtB;AAA8B,QAAIjI,CAAC,GAAC,KAAKiF,cAAL,CAAoB5G,CAApB,CAAN;AAA6B,QAAG2B,CAAH,EAAK,CAACA,CAAC,CAAC+F,SAAH,IAAc,KAAKF,aAAL,CAAmBxH,CAAnB,CAAd,KAAsC2B,CAAC,CAACuI,YAAF,GAAe,KAAKvC,eAAL,CAAqB3H,CAArB,CAAf,EAAuC2B,CAAC,CAAC+F,SAAF,GAAY,CAAC,CAA1F,EAAL,KAAsG;AAAC,YAAMzH,CAAC,GAAC,KAAK0H,eAAL,CAAqB3H,CAArB,CAAR;;AAAgC,UAAG,CAACC,CAAJ,EAAM,OAAOqB,CAAC,GAAC,IAAIjB,CAAJ,CAAM,mCAAN,EAA0C,2DAA1C,CAAF,EAAyGK,CAAC,CAACiJ,MAAF,CAASrI,CAAT,CAAzG,EAAqHZ,CAAC,CAACkJ,OAA9H;AAAsIjI,MAAAA,CAAC,GAAC,IAAImB,CAAJ,EAAF,EAAQnB,CAAC,CAACwB,MAAF,GAAS,KAAKsE,sBAAL,CAA4BzH,CAA5B,CAAjB,EAAgD,YAAU,OAAOC,CAAjB,IAAoB0B,CAAC,CAACkE,eAAF,GAAkB5F,CAAlB,EAAoB0B,CAAC,CAACqF,SAAF,GAAY,CAAC,CAArD,KAAyDrF,CAAC,CAACuI,YAAF,GAAejK,CAAf,EAAiB0B,CAAC,CAAC+F,SAAF,GAAY,CAAC,CAAvF,CAAhD,EAA0I,KAAKhB,eAAL,CAAqB,CAAC/E,CAAD,CAArB,CAA1I;AAAoK;AAAA,WAAOA,CAAC,CAACqF,SAAF,IAAa,KAAK,CAAL,KAASrF,CAAC,CAACwI,QAAxB,KAAmC7J,CAAC,IAAEP,CAAC,CAAC4B,CAAC,CAACkE,eAAH,EAAmB,KAAKhB,UAAxB,CAAJ,IAAyC,KAAKa,UAAL,CAAgBpC,IAAhB,CAAsBtD,CAAC,IAAEA,CAAC,CAAC6F,eAAF,KAAoBlE,CAAC,CAACkE,eAA/C,CAA5E,MAAgJlE,CAAC,CAACwI,QAAF,GAAW;AAACC,MAAAA,YAAY,EAACnK,CAAC,IAAEA,CAAC,CAACmK,YAAnB;AAAgCC,MAAAA,OAAO,EAAC,KAAKC,cAAL,CAAoB3I,CAAC,CAACkE,eAAF,CAAkB0E,OAAlB,CAA0B,KAAKnE,iBAA/B,EAAiD,4BAAjD,CAApB,EAAmGpG,CAAnG;AAAxC,KAA3J,GAA2S,KAAKwK,QAAL,CAAcxK,CAAd,EAAgB2B,CAAhB,EAAkB1B,CAAlB,EAAoBS,CAApB,EAAsBE,CAAtB,CAAlT;AAA2U;;AAAA6J,EAAAA,eAAe,CAACzK,CAAD,EAAG;AAAC,WAAO,KAAK0K,cAAL,CAAoB1K,CAApB,IAAuBA,CAAC,CAACuK,OAAF,CAAU,KAAKxE,aAAf,EAA6B,EAA7B,EAAiCwE,OAAjC,CAAyC,KAAKvE,gBAA9C,EAA+D,EAA/D,KAAoE,EAA3F,GAA8F,KAAKC,OAAL,CAAa7C,IAAb,CAAkBpD,CAAlB,KAAsBA,CAAC,CAACuK,OAAF,CAAU,KAAKtE,OAAf,EAAuB,IAAvB,CAAtB,IAAoD,KAAKC,OAAL,CAAa9C,IAAb,CAAkBpD,CAAlB,KAAsBA,CAAC,CAACuK,OAAF,CAAU,KAAKrE,OAAf,EAAuB,IAAvB,CAA1E,IAAwG,KAAKC,QAAL,CAAc/C,IAAd,CAAmBpD,CAAnB,KAAuBA,CAAC,CAACuK,OAAF,CAAU,KAAKpE,QAAf,EAAwB,IAAxB,CAA/H,IAA8J,EAAnQ;AAAsQ;;AAAAwE,EAAAA,aAAa,CAAC3K,CAAD,EAAGC,CAAH,EAAKE,CAAL,EAAO;AAAC,UAAMG,CAAC,GAAC,KAAK8F,iBAAL,CAAuBhD,IAAvB,CAA4BpD,CAAC,CAAC6F,eAA9B,CAAR;AAAA,UAAuDrF,CAAC,GAAC,IAAIY,CAAJ,CAAM,KAAKyD,UAAX,CAAzD;AAAA,UAAgFnE,CAAC,GAACV,CAAC,CAAC4K,uBAApF;;AAA4G,QAAIhK,CAAJ,EAAME,CAAN,EAAQE,CAAR,EAAUE,CAAV,EAAYI,CAAZ,EAAcG,CAAd,EAAgBE,CAAhB,EAAkBE,CAAlB;AAAoB5B,IAAAA,CAAC,KAAG4B,CAAC,GAAC,KAAK8C,aAAL,IAAoBjE,CAApB,IAAuB,KAAK8D,oBAA9B,EAAmD3C,CAAC,GAACnB,CAAF,IAAKA,CAAC,GAAC,CAAP,KAAWmB,CAAC,GAACnB,CAAb,CAAtD,CAAD,EAAwEP,CAAC,KAAGS,CAAC,GAACT,CAAC,CAAC0K,OAAJ,EAAY/J,CAAC,GAACX,CAAC,CAAC2K,SAAhB,EAA0B9J,CAAC,GAACb,CAAC,CAAC8H,KAA9B,EAAoCxG,CAAC,GAACtB,CAAC,CAACsJ,MAAxC,EAA+C9H,CAAC,GAACxB,CAAC,CAACgI,GAAnD,EAAuDnI,CAAC,CAAC+K,gBAAF,GAAmB5K,CAAC,CAAC4K,gBAA/E,CAAzE,EAA0KnK,CAAC,GAACM,CAAC,GAAClB,CAAC,CAACgL,oBAAL,IAA2B9J,CAAC,GAAClB,CAAC,CAAC6F,eAAJ,EAAoBvE,CAAC,GAAC,IAAIF,CAAJ,CAAMF,CAAC,CAAC+J,WAAF,EAAN,CAAtB,EAA6CjL,CAAC,CAACkL,WAAF,IAAe,QAAM/K,CAArB,IAAwBA,CAAC,CAAC2K,SAA1B,IAAqC,CAACnJ,CAAtC,IAAyC,WAASnB,CAAC,CAAC2K,MAApD,KAA6DpL,CAAC,CAACS,CAAC,CAAC4K,GAAH,EAAOlK,CAAP,EAAS,CAAC,CAAV,CAAD,IAAe,YAAUI,CAAC,CAAC6J,MAAZ,IAAoB3K,CAAC,CAAC0C,IAAF,KAAS5B,CAAC,CAAC4B,IAA/B,IAAqC,WAAS1C,CAAC,CAAC6K,IAAhD,IAAsD,WAAS/J,CAAC,CAAC+J,IAA7I,MAAqJnK,CAAC,GAACA,CAAC,CAACqJ,OAAF,CAAU,UAAV,EAAqB,OAArB,EAA8BA,OAA9B,CAAsC,QAAtC,EAA+C,OAA/C,CAAvJ,CAAxE,CAA3K;AAAoc,UAAMxI,CAAC,GAAC;AAACuJ,MAAAA,KAAK,EAAC;AAACC,QAAAA,OAAO,EAAC,UAAT;AAAoBC,QAAAA,QAAQ,EAAC,QAAMvL,CAAN,GAAQ,KAAK,CAAb,GAAeA,CAAC,CAACuL,QAA9C;AAAuDC,QAAAA,QAAQ,EAAC,QAAMxL,CAAN,GAAQ,KAAK,CAAb,GAAeA,CAAC,CAACwL,QAAjF;AAA0FX,QAAAA,SAAS,EAAChK,CAApG;AAAsGmH,QAAAA,KAAK,EAACjH,CAA5G;AAA8G0K,QAAAA,UAAU,EAAC7J,CAAzH;AAA2H8J,QAAAA,OAAO,EAAC/K,CAAC,IAAEN,CAAH,GAAK,KAAKuE,UAAV,GAAqB,IAAxJ;AAA6J+G,QAAAA,MAAM,EAAChL,CAAC,GAAC,SAAD,GAAW,IAAhL;AAAqLa,QAAAA,CAAC,EAAC,MAAvL;AAA8L,WAAGzB,CAAC,CAAC+K;AAAnM,OAAP;AAA4Nc,MAAAA,MAAM,EAAC,MAAnO;AAA0OC,MAAAA,QAAQ,EAAC,WAAnP;AAA+PC,MAAAA,QAAQ,EAAC,KAAKC,SAAL,CAAehM,CAAf,EAAiBG,CAAjB,CAAxQ;AAA4RsJ,MAAAA,MAAM,EAAChI,CAAnS;AAAqS,UAAG,QAAMtB,CAAN,GAAQ,KAAK,CAAb,GAAeA,CAAC,CAAC8L,MAApB;AAArS,KAAR;AAAyU3L,IAAAA,CAAC,KAAGyB,CAAC,CAACmK,eAAF,GAAkB,CAAC,CAAtB,CAAD;AAA0B,WAAO9L,CAAC,CAACc,CAAD,EAAGa,CAAH,CAAD,CAAOoK,IAAP,CAAahM,CAAC,IAAE;AAAC,YAAMC,CAAC,GAACD,CAAC,CAACiM,IAAV;AAAe,UAAG,CAAChM,CAAD,IAAI,CAACA,CAAC,CAAC6H,KAAV,EAAgB,OAAO,IAAI5H,CAAJ,CAAM,wCAAN,EAA+C,0BAA/C,CAAP;AAAkF,YAAMC,CAAC,GAACN,CAAC,CAACmD,MAAV;AAAiB,aAAOJ,CAAC,CAACzC,CAAD,CAAD,KAAOyC,CAAC,CAACzC,CAAD,CAAD,GAAK,EAAZ,GAAgBL,CAAC,KAAG8C,CAAC,CAACzC,CAAD,CAAD,CAAKL,CAAC,CAACuL,QAAP,IAAiBvL,CAAC,CAACwL,QAAtB,CAAjB,EAAiDrL,CAAC,CAACiM,QAAF,GAAWxK,CAA5D,EAA8DzB,CAArE;AAAuE,KAA1N,CAAP;AAAoO;;AAAAkM,EAAAA,MAAM,GAAE;AAAC,WAAM,CAAC,CAAC,KAAKpH,KAAb;AAAmB;;AAAAqH,EAAAA,iBAAiB,CAACvM,CAAD,EAAG;AAAC,WAAO,KAAKwM,cAAL,CAAoBxM,CAApB,EAAsB,EAAtB,EAA0BmM,IAA1B,CAAgCnM,CAAC,IAAEA,CAAC,CAACyM,UAArC,CAAP;AAAyD;;AAAAD,EAAAA,cAAc,CAACxM,CAAD,EAAGC,CAAH,EAAKE,CAAL,EAAO;AAAC,QAAIG,CAAC,GAAC,CAAC,CAAP;AAAS,WAAO,KAAK+I,aAAL,CAAmBrJ,CAAnB,EAAqB;AAACuJ,MAAAA,MAAM,EAAC,CAAC;AAAT,KAArB,EAAkC4C,IAAlC,CAAwC3L,CAAC,IAAE;AAAC,UAAIE,CAAJ;AAAM,YAAME,CAAC,GAAC;AAACa,QAAAA,CAAC,EAAC;AAAH,OAAR;AAAmB,UAAG,aAAWjB,CAAC,CAAC4H,KAAhB;AAAsB,YAAGnI,CAAC,KAAG,KAAKyM,eAAL,CAAqB1M,CAArB,KAAyBG,CAAC,IAAEA,CAAC,CAACwM,KAAjC,CAAJ,EAA4CjM,CAAC,GAACF,CAAC,CAAC2C,MAAF,GAAS,wCAAX,EAAoDvC,CAAC,CAACgM,SAAF,GAAY3M,CAAhE,CAA5C,KAAkH;AAAC,cAAG,CAACO,CAAC,CAACyH,KAAN,EAAY,OAAM;AAACwE,YAAAA,UAAU,EAACjM;AAAZ,WAAN;AAAqBE,UAAAA,CAAC,GAACF,CAAC,CAAC2C,MAAF,GAAS,eAAX;AAA2B;AAArM,aAAyM;AAAC,YAAG,CAAC3C,CAAC,CAACyH,KAAN,EAAY,OAAM;AAACwE,UAAAA,UAAU,EAACjM;AAAZ,SAAN;AAAqBE,QAAAA,CAAC,GAACF,CAAC,CAAC2C,MAAF,GAAS,gBAAX;AAA4B;AAAA,aAAO3C,CAAC,CAACyH,KAAF,KAAUrH,CAAC,CAACqH,KAAF,GAAQzH,CAAC,CAACyH,KAApB,GAA2B7H,CAAC,CAACM,CAAD,EAAG;AAAC4K,QAAAA,KAAK,EAAC1K,CAAP;AAASkL,QAAAA,QAAQ,EAAC;AAAlB,OAAH,CAAD,CAAoCK,IAApC,CAA0CnM,CAAC,IAAE;AAAC,YAAG,CAAC,CAAD,KAAKA,CAAC,CAACoM,IAAF,CAAOS,KAAf,EAAqB,MAAM,IAAIxM,CAAJ,CAAM,iCAAN,EAAyC,oCAAmCG,CAAC,CAACwH,MAAO,IAArF,EAAyFhI,CAAC,CAACoM,IAA3F,CAAN;AAAuG,eAAO9L,CAAC,GAAC,CAAC,CAACN,CAAC,CAACoM,IAAF,CAAOU,mBAAX,EAA+B;AAACL,UAAAA,UAAU,EAACjM;AAAZ,SAAtC;AAAqD,OAA/N,EAAkOuM,KAAlO,CAAyO/M,CAAC,IAAE;AAAC,YAAG,sCAAoCA,CAAC,CAACgN,IAAzC,EAA8C,MAAMhN,CAAN;AAAQ,cAAMC,CAAC,GAACD,CAAC,CAAC8J,OAAF,IAAW9J,CAAC,CAAC8J,OAAF,CAAUC,UAA7B;AAAwC,YAAG,QAAM9J,CAAT,EAAW,MAAMO,CAAC,CAACwJ,OAAF,IAAY,IAAI3J,CAAJ,CAAM,oCAAN,EAA2C,wBAA3C,CAAlB;AAAuF,YAAG,QAAMJ,CAAT,EAAW,MAAM,IAAII,CAAJ,CAAM,kCAAN,CAAN;AAAgD,eAAM;AAACoM,UAAAA,UAAU,EAACjM;AAAZ,SAAN;AAAqB,OAA7f,CAAlC;AAAkiB,KAA92B,EAAi3B2L,IAAj3B,CAAu3BnM,CAAC,KAAG;AAACyM,MAAAA,UAAU,EAACzM,CAAC,CAACyM,UAAd;AAAyBQ,MAAAA,QAAQ,EAAC3M;AAAlC,KAAH,CAAx3B,CAAP;AAA06B;;AAAA4M,EAAAA,oBAAoB,CAAClN,CAAD,EAAG;AAACA,IAAAA,CAAC,KAAG,QAAMA,CAAC,CAACmN,MAAF,CAAS,CAAT,CAAN,KAAoBnN,CAAC,GAACA,CAAC,CAACoN,SAAF,CAAY,CAAZ,CAAtB,GAAsC,KAAKC,wBAAL,CAA8B5L,CAAC,CAACzB,CAAD,CAA/B,CAAzC,CAAD;AAA+E;;AAAAsN,EAAAA,0BAA0B,CAACtN,CAAD,EAAG;AAAC,SAAKuN,kBAAL,GAAwBvN,CAAxB;AAA0B;;AAAAwN,EAAAA,uBAAuB,CAACxN,CAAD,EAAG;AAAC,SAAKyN,aAAL,GAAmBzN,CAAnB;AAAqB;;AAAA0N,EAAAA,MAAM,CAAC1N,CAAD,EAAGC,CAAH,EAAU;AAAA,QAALE,CAAK,uEAAH,EAAG;;AAAC,UAAMC,CAAC,GAACU,CAAC,EAAT;AAAA,UAAYR,CAAC,GAAC,MAAI;AAAC,UAAIN,CAAJ,EAAMC,CAAN,EAAQE,CAAR,EAAUC,CAAV,EAAYC,CAAZ;AAAc,eAAOL,CAAC,GAACY,CAAT,KAAaZ,CAAC,CAAC2N,MAAF,EAAb,EAAwB,SAAO1N,CAAC,GAACiB,CAAT,KAAajB,CAAC,CAAC0N,MAAF,EAArC,EAAgD,SAAOxN,CAAC,GAACiB,CAAT,KAAajB,CAAC,CAACwN,MAAF,EAA7D,EAAwE,SAAOvN,CAAC,GAACM,CAAT,KAAaN,CAAC,CAAC4J,OAAF,EAArF,EAAiG,SAAO3J,CAAC,GAAC,KAAKoE,MAAd,KAAuBpE,CAAC,CAAC2J,OAAF,EAAxH,EAAoI,KAAKvF,MAAL,GAAY/D,CAAC,GAACE,CAAC,GAACM,CAAC,GAACE,CAAC,GAAC,IAAxJ;AAA6J,KAA9L;AAAA,UAA+LZ,CAAC,GAAC,MAAI;AAACF,MAAAA,CAAC,IAAG,KAAKsN,SAAL,GAAe,IAAlB,EAAuBxN,CAAC,CAACuJ,MAAF,CAAS,IAAItJ,CAAJ,CAAM,+BAAN,EAAsC,SAAtC,CAAT,CAAxB;AAAmF,KAAzR;;AAA0RF,IAAAA,CAAC,CAACsJ,MAAF,IAAUzI,CAAC,CAACb,CAAC,CAACsJ,MAAH,EAAW,MAAI;AAACjJ,MAAAA,CAAC;AAAG,KAApB,CAAX;AAAkC,QAAIE,CAAC,GAAC,IAAI,KAAKgE,eAAT,EAAN;AAA+BhE,IAAAA,CAAC,CAACmN,QAAF,GAAW,KAAKpD,eAAL,CAAqBzK,CAArB,CAAX,EAAmCU,CAAC,CAACyC,MAAF,GAASlD,CAAC,CAACkD,MAA9C,EAAqD,KAAKsB,MAAL,GAAY,IAAI9B,CAAJ,EAAjE,EAAuE,KAAK8B,MAAL,CAAYqJ,OAAZ,GAAoBpN,CAA3F,EAA6F,KAAK+D,MAAL,CAAYsJ,IAAZ,GAAiB,CAAC,CAA/G,EAAiH,KAAKC,IAAL,CAAU,eAAV,CAAjH;AAA4I,QAAIpN,CAAC,GAACF,CAAC,CAACH,EAAF,CAAK,QAAL,EAAcC,CAAd,CAAN;AAAA,QAAuBU,CAAC,GAAC,KAAKuD,MAAL,CAAYwJ,KAAZ,CAAkB,MAAlB,EAAyBzN,CAAzB,CAAzB;AAAA,QAAqDY,CAAC,GAACV,CAAC,CAACH,EAAF,CAAK,QAAL,EAAeP,CAAC,IAAE;AAAC,WAAK2K,aAAL,CAAmB1K,CAAnB,EAAqBD,CAArB,EAAuB;AAAC6K,QAAAA,OAAO,EAAC1K,CAAC,CAAC0K,OAAX;AAAmBpB,QAAAA,MAAM,EAACtJ,CAAC,CAACsJ;AAA5B,OAAvB,EAA4D0C,IAA5D,CAAkE9L,CAAC,IAAE;AAACC,QAAAA,CAAC;AAAG,cAAME,CAAC,GAAC,IAAIuH,CAAJ,CAAM;AAACC,UAAAA,MAAM,EAAChI,CAAC,CAACwL,QAAV;AAAmBrI,UAAAA,MAAM,EAAClD,CAAC,CAACkD,MAA5B;AAAmC8E,UAAAA,KAAK,EAAC5H,CAAC,CAAC4H,KAA3C;AAAiDC,UAAAA,OAAO,EAAC,QAAM7H,CAAC,CAAC6H,OAAR,GAAgBgG,MAAM,CAAC7N,CAAC,CAAC6H,OAAH,CAAtB,GAAkC,IAA3F;AAAgGC,UAAAA,GAAG,EAAC,CAAC,CAAC9H,CAAC,CAAC8H,GAAxG;AAA4G0C,UAAAA,OAAO,EAAC1K,CAAC,CAAC0K,OAAtH;AAA8HwB,UAAAA,QAAQ,EAAChM,CAAC,CAACgM;AAAzI,SAAN,CAAR;AAAkKjM,QAAAA,CAAC,CAAC6J,OAAF,CAAUzJ,CAAV;AAAa,OAAzP,EAA4PuM,KAA5P,CAAmQ/M,CAAC,IAAE;AAACU,QAAAA,CAAC,CAAC4I,KAAF,GAAQtJ,CAAR,EAAUU,CAAC,CAACyN,SAAF,GAAY,CAAC,CAAvB;AAAyB,OAAhS;AAAmS,KAAtT,CAAvD;AAAgX,WAAO/N,CAAC,CAACwJ,OAAT;AAAiB;;AAAAwE,EAAAA,WAAW,CAACpO,CAAD,EAAGC,CAAH,EAAKE,CAAL,EAAOC,CAAP,EAAS;AAAC,SAAKwN,SAAL,GAAe9M,CAAC,EAAhB;AAAmB,UAAMR,CAAC,GAAC,KAAKsN,SAAb;AAAuB,QAAIpN,CAAJ;AAAM,YAAMJ,CAAN,IAASA,CAAC,CAACqJ,MAAX,IAAmBzI,CAAC,CAACZ,CAAC,CAACqJ,MAAH,EAAW,MAAI;AAAC,YAAMzJ,CAAC,GAAC,KAAK4N,SAAL,IAAgB,KAAKA,SAAL,CAAeS,SAAvC;AAAiDrO,MAAAA,CAAC,IAAE,CAACA,CAAC,CAACsO,MAAN,GAAatO,CAAC,CAACuO,KAAF,EAAb,GAAuB,KAAK9J,MAAL,IAAa1E,CAAC,EAArC;AAAwC,KAAzG,CAApB,EAAgIO,CAAC,CAACkO,OAAF,GAAUxO,CAA1I,EAA4IM,CAAC,CAACmO,MAAF,GAASxO,CAArJ,EAAuJK,CAAC,CAACoO,MAAF,GAASvO,CAAhK;AAAkK,UAAMO,CAAC,GAACP,CAAC,CAACwO,UAAV;;AAAqB,QAAGjO,CAAC,CAACkO,OAAF,KAAY,yBAAuBzO,CAAC,CAAC0O,QAAzB,IAAmC,WAAS1O,CAAC,CAAC0O,QAAX,IAAqB,CAAC1O,CAAC,CAAC2O,KAAxB,IAA+B7O,CAAC,CAAC8O,cAAF,IAAkB,GAAhG,CAAH,EAAwG;AAAC,UAAI/O,CAAC,GAACgP,MAAM,CAACC,eAAP,CAAuB,IAAIC,UAAJ,CAAe,EAAf,CAAvB,CAAN;AAAiD1O,MAAAA,CAAC,GAACmB,CAAC,CAAC3B,CAAD,CAAH,EAAOU,CAAC,CAACyO,YAAF,GAAe3O,CAAtB,EAAwBR,CAAC,GAACgP,MAAM,CAACC,eAAP,CAAuB,IAAIC,UAAJ,CAAe,EAAf,CAAvB,CAA1B,EAAqExO,CAAC,CAAC0O,QAAF,GAAWzN,CAAC,CAAC3B,CAAD,CAAjF,EAAqFU,CAAC,CAAC2O,IAAF,OAAW3O,CAAC,CAACyO,YAAF,GAAe3O,CAAC,GAAC,IAA5B,CAArF;AAAuH,KAAjR,MAAsRE,CAAC,CAACyO,YAAF,GAAe,IAAf;;AAAoB,QAAIvO,CAAJ,EAAMM,CAAN,EAAQE,CAAR,EAAUE,CAAV;;AAAY,SAAKgO,iBAAL,CAAuB9O,CAAvB,EAA0B2L,IAA1B,CAAgC9L,CAAC,IAAE;AAAC,YAAMC,CAAC,GAAC,CAACF,CAAD,IAAI,CAAC,CAAD,KAAKA,CAAC,CAACmP,sBAAnB;AAA0CpP,MAAAA,CAAC,CAAC2O,KAAF,IAASxO,CAAT,IAAYM,CAAC,GAAC,IAAI,KAAK8D,eAAT,EAAF,EAA2B9D,CAAC,CAAC4O,WAAF,GAAc,CAAC,CAA1C,EAA4C5O,CAAC,CAACuC,MAAF,GAASlD,CAAC,CAACkD,MAAvD,EAA8D,KAAKsB,MAAL,GAAY,IAAI9B,CAAJ,EAA1E,EAAgF,KAAK8B,MAAL,CAAYqJ,OAAZ,GAAoBlN,CAApG,EAAsG,KAAK6D,MAAL,CAAYsJ,IAAZ,GAAiB,CAAC,CAAxH,EAA0H,KAAKC,IAAL,CAAU,eAAV,CAA1H,EAAqJ9M,CAAC,GAACN,CAAC,CAACL,EAAF,CAAK,QAAL,EAAcR,CAAd,CAAvJ,EAAwKqB,CAAC,GAAC,KAAKqD,MAAL,CAAYwJ,KAAZ,CAAkB,MAAlB,EAAyBlO,CAAzB,CAA1K,EAAsMuB,CAAC,GAACV,CAAC,CAACL,EAAF,CAAK,QAAL,EAAe,MAAI;AAACkB,QAAAA,CAAC,IAAG,KAAKgO,cAAL,CAAoBzP,CAApB,EAAsBC,CAAtB,EAAwBE,CAAxB,EAA0BE,CAA1B,CAAJ;AAAiC,OAArD,CAApN,IAA6Q,KAAKoP,cAAL,CAAoBzP,CAApB,EAAsBC,CAAtB,EAAwBE,CAAxB,EAA0BE,CAA1B,CAA7Q;AAA0S,KAAxX;;AAA2X,UAAMN,CAAC,GAAC,MAAI;AAAC0B,MAAAA,CAAC,IAAG,KAAKmM,SAAL,GAAe,IAAlB,EAAuBtN,CAAC,CAACqJ,MAAF,CAAS,IAAItJ,CAAJ,CAAM,+BAAN,EAAsC,SAAtC,CAAT,CAAxB;AAAmF,KAAhG;AAAA,UAAiGoB,CAAC,GAAC,MAAI;AAAC,UAAIzB,CAAJ,EAAMC,CAAN,EAAQE,CAAR,EAAUC,CAAV,EAAYC,CAAZ;AAAc,eAAOL,CAAC,GAACkB,CAAT,KAAalB,CAAC,CAAC2N,MAAF,EAAb,EAAwB,SAAO1N,CAAC,GAACmB,CAAT,KAAanB,CAAC,CAAC0N,MAAF,EAArC,EAAgD,SAAOxN,CAAC,GAACmB,CAAT,KAAanB,CAAC,CAACwN,MAAF,EAA7D,EAAwE,SAAOvN,CAAC,GAACQ,CAAT,KAAaR,CAAC,CAAC4J,OAAF,EAArF,EAAiG,SAAO3J,CAAC,GAAC,KAAKoE,MAAd,KAAuBpE,CAAC,CAAC2J,OAAF,EAAxH,EAAoI,KAAKvF,MAAL,GAAY,IAAhJ;AAAqJ,KAA3Q;;AAA4Q,WAAOnE,CAAC,CAACsJ,OAAT;AAAiB;;AAAA8F,EAAAA,kBAAkB,GAAE;AAAC,QAAG,KAAKvL,WAAR,EAAoB;AAAC,WAAKA,WAAL,CAAiBwL,KAAjB,GAAyB7I,OAAzB,CAAkC9G,CAAC,IAAE;AAACA,QAAAA,CAAC,CAACgK,OAAF;AAAY,OAAlD;AAAqD;;AAAA,SAAKgE,IAAL,CAAU,qBAAV;AAAiC;;AAAA4B,EAAAA,qBAAqB,GAAyC;AAAA,QAAxC5P,CAAwC,uEAAtC,qCAAsC;AAAC,SAAK6P,sBAAL,IAA6B,KAAKA,sBAAL,CAA4BlC,MAA5B,EAA7B,EAAkE,KAAKkC,sBAAL,GAA4BrP,CAAC,CAACiD,MAAD,EAAQ,SAAR,EAAmBxD,CAAC,IAAE;AAAC,UAAIE,CAAJ;;AAAM,UAAG,CAACF,CAAC,CAAC6E,MAAF,KAAW,KAAKD,UAAhB,IAA4B5E,CAAC,CAAC6E,MAAF,CAASgL,QAAT,CAAkB,aAAlB,CAA7B,KAAgE,qCAAmC,SAAO3P,CAAC,GAACF,CAAC,CAACmM,IAAX,IAAiB,KAAK,CAAtB,GAAwBjM,CAAC,CAAC4P,IAA7D,CAAnE,EAAsI;AAAC,cAAM5P,CAAC,GAACF,CAAC,CAAC+P,MAAV;AAAiB,aAAK3G,aAAL,CAAmBrJ,CAAnB,EAAsBmM,IAAtB,CAA4BnM,CAAC,IAAE;AAACG,UAAAA,CAAC,CAAC8P,WAAF,CAAc;AAACF,YAAAA,IAAI,EAAC,wBAAN;AAA+BtD,YAAAA,UAAU,EAAC;AAACvE,cAAAA,OAAO,EAAClI,CAAC,CAACkI,OAAX;AAAmB/E,cAAAA,MAAM,EAACnD,CAAC,CAACmD,MAA5B;AAAmCgF,cAAAA,GAAG,EAACnI,CAAC,CAACmI,GAAzC;AAA6CF,cAAAA,KAAK,EAACjI,CAAC,CAACiI,KAArD;AAA2DD,cAAAA,MAAM,EAAChI,CAAC,CAACgI;AAApE;AAA1C,WAAd,EAAqI/H,CAAC,CAAC6E,MAAvI;AAA+I,SAA/K,EAAkLiI,KAAlL,CAAyL/M,CAAC,IAAE;AAACG,UAAAA,CAAC,CAAC8P,WAAF,CAAc;AAACF,YAAAA,IAAI,EAAC,mBAAN;AAA0BzG,YAAAA,KAAK,EAAC;AAAC0D,cAAAA,IAAI,EAAChN,CAAC,CAACgN,IAAR;AAAakD,cAAAA,OAAO,EAAClQ,CAAC,CAACkQ;AAAvB;AAAhC,WAAd,EAA+EjQ,CAAC,CAAC6E,MAAjF;AAAyF,SAAtR;AAAyR;AAAC,KAA/c,CAA/F;AAAijB;;AAAAqL,EAAAA,sBAAsB,GAAE;AAAC,SAAKN,sBAAL,KAA8B,KAAKA,sBAAL,CAA4BlC,MAA5B,IAAqC,KAAKkC,sBAAL,GAA4B,IAA/F;AAAqG;;AAAAtJ,EAAAA,uBAAuB,GAAE;AAAC,QAAIvG,CAAC,GAACyD,MAAM,CAACsB,QAAP,CAAgBqL,IAAtB;;AAA2B,QAAGpQ,CAAH,EAAK;AAAC,cAAMA,CAAC,CAACmN,MAAF,CAAS,CAAT,CAAN,KAAoBnN,CAAC,GAACA,CAAC,CAACoN,SAAF,CAAY,CAAZ,CAAtB;AAAsC,YAAMjN,CAAC,GAACsB,CAAC,CAACzB,CAAD,CAAT;AAAa,UAAII,CAAC,GAAC,CAAC,CAAP;AAAS,UAAGD,CAAC,CAACkQ,YAAF,IAAgBlQ,CAAC,CAACmQ,UAAlB,IAA8BnQ,CAAC,CAACoQ,KAAhC,IAAuCpQ,CAAC,CAACqQ,cAAF,CAAiB,UAAjB,CAA1C,EAAuE,IAAG;AAACrQ,QAAAA,CAAC,CAACoQ,KAAF,GAAQ5H,IAAI,CAACC,KAAL,CAAWzI,CAAC,CAACoQ,KAAb,CAAR,EAA4BpQ,CAAC,CAACoQ,KAAF,CAAQpJ,SAAR,KAAoB,KAAK/B,oBAAL,GAA0BjF,CAA1B,EAA4BC,CAAC,GAAC,CAAC,CAAnD,CAA5B;AAAkF,OAAtF,CAAsF,MAAK,CAAE,CAApK,MAAyK,IAAGD,CAAC,CAACmJ,KAAF,IAASnJ,CAAC,CAACsQ,iBAAX,KAA+BC,OAAO,CAACC,GAAR,CAAY,+BAAZ,EAA4CxQ,CAAC,CAACmJ,KAA9C,EAAoD,KAApD,EAA0DnJ,CAAC,CAACsQ,iBAA5D,GAA+E,oBAAkBtQ,CAAC,CAACmJ,KAApB,KAA4BlJ,CAAC,GAAC,CAAC,CAAH,EAAKD,CAAC,CAACoQ,KAAnC,CAA9G,CAAH,EAA4J,IAAG;AAACpQ,QAAAA,CAAC,CAACoQ,KAAF,GAAQ5H,IAAI,CAACC,KAAL,CAAWzI,CAAC,CAACoQ,KAAb,CAAR;AAA4B,OAAhC,CAAgC,MAAK,CAAE;AAAA,UAAItQ,CAAJ;AAAM,UAAGG,CAAH,EAAKqD,MAAM,CAACsB,QAAP,CAAgBqL,IAAhB,GAAqB,CAAC,SAAOnQ,CAAC,GAACE,CAAC,CAACoQ,KAAX,IAAkB,KAAK,CAAvB,GAAyBtQ,CAAC,CAACmQ,IAA5B,KAAmC,EAAxD;AAA2D;;AAAA,QAAIjQ,CAAC,GAACsD,MAAM,CAACsB,QAAP,CAAgB6L,MAAtB;;AAA6B,QAAGzQ,CAAH,EAAK;AAAC,cAAMA,CAAC,CAACgN,MAAF,CAAS,CAAT,CAAN,KAAoBhN,CAAC,GAACA,CAAC,CAACiN,SAAF,CAAY,CAAZ,CAAtB;AAAsC,YAAMpN,CAAC,GAACyB,CAAC,CAACtB,CAAD,CAAT;AAAa,UAAIF,CAAC,GAAC,CAAC,CAAP;AAAS,UAAGD,CAAC,CAAC6Q,IAAF,IAAQ7Q,CAAC,CAACuQ,KAAb,EAAmB,IAAG;AAACvQ,QAAAA,CAAC,CAACuQ,KAAF,GAAQ5H,IAAI,CAACC,KAAL,CAAW5I,CAAC,CAACuQ,KAAb,CAAR,EAA4BvQ,CAAC,CAACuQ,KAAF,CAAQpJ,SAAR,IAAmBnH,CAAC,CAACuQ,KAAF,CAAQO,GAA3B,KAAiC,KAAK1L,oBAAL,GAA0BpF,CAA1B,EAA4BC,CAAC,GAAC,CAAC,CAAhE,CAA5B;AAA+F,OAAnG,CAAmG,MAAK,CAAE,CAA7H,MAAkI,IAAGD,CAAC,CAACsJ,KAAF,IAAStJ,CAAC,CAACyQ,iBAAX,KAA+BC,OAAO,CAACC,GAAR,CAAY,+BAAZ,EAA4C3Q,CAAC,CAACsJ,KAA9C,EAAoD,KAApD,EAA0DtJ,CAAC,CAACyQ,iBAA5D,GAA+E,oBAAkBzQ,CAAC,CAACsJ,KAApB,KAA4BrJ,CAAC,GAAC,CAAC,CAAH,EAAKD,CAAC,CAACuQ,KAAnC,CAA9G,CAAH,EAA4J,IAAG;AAACvQ,QAAAA,CAAC,CAACuQ,KAAF,GAAQ5H,IAAI,CAACC,KAAL,CAAW5I,CAAC,CAACuQ,KAAb,CAAR;AAA4B,OAAhC,CAAgC,MAAK,CAAE;;AAAA,UAAGtQ,CAAH,EAAK;AAAC,YAAIG,CAAJ;AAAM,cAAMH,CAAC,GAAC,EAAC,GAAGD;AAAJ,SAAR;AAAe,SAAC,MAAD,EAAQ,OAAR,EAAgB,mBAAhB,EAAoC,cAApC,EAAmD,SAAnD,EAA6D,OAA7D,EAAsE8G,OAAtE,CAA+E9G,CAAC,IAAE;AAAC,iBAAOC,CAAC,CAACD,CAAD,CAAR;AAAY,SAA/F;AAAkG,cAAMG,CAAC,GAAC0B,CAAC,CAAC5B,CAAD,CAAT;AAAA,cAAaI,CAAC,GAACoD,MAAM,CAACsB,QAAP,CAAgBgM,QAAhB,IAA0B5Q,CAAC,GAAE,IAAGA,CAAE,EAAP,GAAS,EAApC,KAAyC,CAAC,SAAOC,CAAC,GAACJ,CAAC,CAACuQ,KAAX,IAAkB,KAAK,CAAvB,GAAyBnQ,CAAC,CAACgQ,IAA5B,KAAmC,EAA5E,CAAf;AAA+F3M,QAAAA,MAAM,CAACuN,OAAP,CAAeC,YAAf,CAA4BxN,MAAM,CAACuN,OAAP,CAAeT,KAA3C,EAAiD,EAAjD,EAAoDlQ,CAApD;AAAuD;AAAC;AAAC;;AAAA6Q,EAAAA,cAAc,CAAClR,CAAD,EAAGC,CAAH,EAAKE,CAAL,EAAOE,CAAP,EAASC,CAAT,EAAW;AAAC,WAAON,CAAC,GAACA,CAAC,CAACuK,OAAF,CAAU,SAAV,EAAoB,QAApB,CAAF,EAAgCnK,CAAC,CAAE,GAAEJ,CAAE,4BAAN,EAAkC;AAAC8L,MAAAA,QAAQ,EAAC,WAAV;AAAsBD,MAAAA,MAAM,EAAC,MAA7B;AAAoCP,MAAAA,KAAK,EAACjL,CAAC,IAAEC,CAAH,GAAK;AAAC6Q,QAAAA,UAAU,EAAC,oBAAZ;AAAiCN,QAAAA,IAAI,EAAC5Q,CAAtC;AAAwCmR,QAAAA,YAAY,EAAC/Q,CAArD;AAAuDuM,QAAAA,SAAS,EAACzM,CAAjE;AAAmEkR,QAAAA,aAAa,EAAC/Q;AAAjF,OAAL,GAAyF;AAAC6Q,QAAAA,UAAU,EAAC,eAAZ;AAA4BG,QAAAA,aAAa,EAACrR,CAA1C;AAA4C2M,QAAAA,SAAS,EAACzM;AAAtD;AAAnI,KAAlC,CAAD,CAAiOgM,IAAjO,CAAuOnM,CAAC,IAAEA,CAAC,CAACoM,IAA5O,CAAvC;AAA0R;;AAAAkD,EAAAA,iBAAiB,CAACtP,CAAD,EAAG;AAAC,QAAGA,CAAC,IAAE+D,UAAU,CAACwN,eAAjB,EAAiC;AAAC,YAAMtR,CAAC,GAAE,IAAIuR,WAAJ,EAAD,CAAkBC,MAAlB,CAAyBzR,CAAzB,CAAR;AAAoC,aAAOgP,MAAM,CAAC0C,MAAP,CAAcC,MAAd,CAAqB,SAArB,EAA+B1R,CAA/B,EAAkCkM,IAAlC,CAAwCnM,CAAC,IAAE2B,CAAC,CAAC,IAAIuN,UAAJ,CAAelP,CAAf,CAAD,CAA5C,CAAP;AAAyE;;AAAA,WAAO4R,OAAO,CAAC3H,OAAR,CAAgB,IAAhB,CAAP;AAA6B;;AAAAxD,EAAAA,gBAAgB,CAACzG,CAAD,EAAG;AAAC,QAAGA,CAAC,CAAC6R,SAAF,IAAa,KAAKvF,MAAL,EAAb,IAA4B,KAAKnH,0BAApC,EAA+D;AAAC,YAAMnF,CAAC,GAAC,IAAIK,CAAJ,CAAM,+BAAN,EAAsC,SAAtC,CAAR;;AAAyD,WAAKyR,YAAL,CAAkB9R,CAAlB;AAAqB;AAAC;;AAAA4H,EAAAA,eAAe,CAAC5H,CAAD,EAAGC,CAAH,EAAK;AAAC,QAAIE,CAAJ;AAAA,QAAMC,CAAN;AAAA,QAAQC,CAAR;AAAA,QAAUC,CAAV;AAAA,QAAYE,CAAC,GAAC,CAAC,CAAf;AAAiB,UAAME,CAAC,GAACT,CAAC,IAAEA,CAAC,CAACgI,KAAb;AAAA,UAAmBrH,CAAC,GAACX,CAAC,IAAEA,CAAC,CAAC4N,QAA1B;AAAA,UAAmC/M,CAAC,GAAC,KAAK0G,aAAL,CAAmBxH,CAAnB,IAAsB,QAAtB,GAA+B,QAApE;AAAA,UAA6EgB,CAAC,GAAC,KAAKmD,WAAL,CAAiBwC,MAAjB,CAAyB1G,CAAC,IAAE,KAAKiJ,sBAAL,CAA4BjJ,CAAC,CAACkD,MAA9B,EAAqCnD,CAArC,KAAyCC,CAAC,CAACmI,KAAF,KAAUtH,CAA/E,CAA/E;AAAkK,QAAGd,CAAC,GAACY,CAAC,IAAEZ,CAAL,EAAOgB,CAAC,CAAC8H,MAAZ,EAAmB,IAAG,MAAI9H,CAAC,CAAC8H,MAAT,EAAgB;AAAC,UAAG3I,CAAC,GAACa,CAAC,CAAC,CAAD,CAAH,EAAOV,CAAC,GAAC,KAAKsG,cAAL,CAAoBzG,CAAC,CAACgD,MAAtB,CAAT,EAAuC/C,CAAC,GAACE,CAAC,IAAEA,CAAC,CAAC2C,eAA9C,EAA8D5C,CAAC,GAACD,CAAC,IAAE,KAAK+I,cAAL,CAAoB/I,CAApB,EAAsBD,CAAC,CAAC6H,MAAxB,CAAnE,EAAmGxH,CAAC,GAAC,KAAK4I,mBAAL,CAAyBpJ,CAAzB,EAA2BG,CAA3B,CAArG,EAAmI,CAACO,CAAvI,EAAyI,OAAM,CAAC,CAAD,KAAKF,CAAL,IAAQL,CAAC,CAACkI,SAAF,CAAYtB,IAAZ,CAAiB/G,CAAjB,CAAR,EAA4B,KAAK+R,YAAL,CAAkB/R,CAAlB,EAAoBK,CAApB,CAA5B,EAAmDF,CAAzD;AAA2D,OAAC,CAAD,KAAKK,CAAL,KAASL,CAAC,CAACkI,SAAF,CAAYjB,MAAZ,CAAmB5G,CAAnB,EAAqB,CAArB,GAAwB,KAAKwR,eAAL,CAAqBhS,CAArB,EAAuBK,CAAvB,CAAjC;AAA4D,KAAjR,MAAqR;AAAC,UAAIJ,CAAJ,EAAME,CAAN;AAAQ,UAAGa,CAAC,CAACsC,IAAF,CAAQ5C,CAAC,KAAGP,CAAC,GAAC,KAAKiJ,mBAAL,CAAyBpJ,CAAzB,EAA2BU,CAA3B,CAAF,EAAgC,CAAC,CAAD,KAAKP,CAAL,KAASF,CAAC,GAACS,CAAF,EAAIJ,CAAC,GAAC,KAAKsG,cAAL,CAAoB3G,CAAC,CAACkD,MAAtB,CAAN,EAAoC/C,CAAC,GAACE,CAAC,IAAEA,CAAC,CAAC2C,eAA3C,EAA2D5C,CAAC,GAACD,CAAC,IAAE,KAAK+I,cAAL,CAAoB/I,CAApB,EAAsBH,CAAC,CAAC+H,MAAxB,CAAhE,EAAgGxH,CAAC,GAACL,CAAlG,EAAoG,CAAC,CAA9G,CAAnC,CAAT,GAAgKO,CAAnK,EAAqKT,CAAC,KAAGA,CAAC,CAACoI,SAAF,CAAYjB,MAAZ,CAAmB5G,CAAnB,EAAqB,CAArB,GAAwB,KAAKwR,eAAL,CAAqBhS,CAArB,EAAuBK,CAAvB,CAA3B,CAAD,CAArK,KAAiO,IAAGJ,CAAH,EAAK,OAAO,KAAK8R,YAAL,CAAkB/R,CAAlB,EAAoBK,CAApB,GAAuBJ,CAA9B;AAAgC;AAAC;;AAAAgS,EAAAA,cAAc,CAACjS,CAAD,EAAG;AAAC,QAAIC,CAAC,GAAC,KAAKiH,aAAL,CAAmBlH,CAAnB,CAAN;AAA4B,QAAG,CAACC,CAAJ,EAAM,KAAI,MAAME,CAAV,IAAe,KAAK+D,UAApB,EAA+B,IAAG,KAAKgO,aAAL,CAAmB/R,CAAC,CAACgH,SAArB,EAA+BnH,CAA/B,CAAH,EAAqC;AAACC,MAAAA,CAAC,GAACE,CAAF;AAAI;AAAM;AAAA,WAAOF,CAAP;AAAS;;AAAA8R,EAAAA,YAAY,CAAC/R,CAAD,EAAGC,CAAH,EAAK;AAACA,IAAAA,CAAC,IAAE,CAAC,CAAD,KAAK,KAAKmJ,mBAAL,CAAyBpJ,CAAzB,EAA2BC,CAA3B,CAAR,IAAuCA,CAAC,CAACoI,SAAF,CAAYtB,IAAZ,CAAiB/G,CAAjB,CAAvC;AAA2D;;AAAAgS,EAAAA,eAAe,CAAChS,CAAD,EAAGC,CAAH,EAAK;AAAC,QAAIE,CAAC,GAAC,CAAC,CAAP;AAASF,IAAAA,CAAC,KAAGE,CAAC,GAAC,KAAKiJ,mBAAL,CAAyBpJ,CAAzB,EAA2BC,CAA3B,CAAF,EAAgCE,CAAC,GAAC,CAAC,CAAH,IAAMF,CAAC,CAACoI,SAAF,CAAYjB,MAAZ,CAAmBjH,CAAnB,EAAqB,CAArB,CAAzC,CAAD;AAAmE;;AAAA6L,EAAAA,SAAS,CAAChM,CAAD,EAAGC,CAAH,EAAK;AAAC,WAAOA,CAAC,IAAEA,CAAC,CAAC4K,OAAL,IAAc,CAAC9K,CAAC,CAACC,CAAC,CAACgL,oBAAH,EAAwB,KAAKnG,UAA7B,CAAhB,IAA0D,CAAC,KAAKsN,eAAL,CAAqBnS,CAAC,CAAC6F,eAAvB,CAAD,IAA0C,WAASuM,MAAM,CAACpS,CAAC,CAAC+O,cAAH,CAAzD,IAA6E,CAAChP,CAAC,CAACC,CAAC,CAAC6F,eAAH,EAAmB,KAAKhB,UAAxB,CAAhJ;AAAoL;;AAAAwN,EAAAA,UAAU,CAACrS,CAAD,EAAG;AAAC,UAAMC,CAAC,GAAC,IAAImB,CAAJ,CAAMpB,CAAN,CAAR;AAAiB,WAAOC,CAAC,CAACkL,MAAF,GAAS,KAAT,GAAelL,CAAC,CAACiD,IAAjB,IAAuB,QAAMjD,CAAC,CAACoL,IAAR,GAAa,MAAIpL,CAAC,CAACoL,IAAnB,GAAwB,EAA/C,CAAP;AAA0D;;AAAA5D,EAAAA,sBAAsB,CAACzH,CAAD,EAAG;AAAC,UAAMC,CAAC,GAACD,CAAC,CAACiL,WAAF,EAAR;AAAwB,QAAI9K,CAAC,GAACF,CAAC,CAACoH,OAAF,CAAU,KAAK/B,QAAf,CAAN;AAA+B,WAAM,CAAC,CAAD,KAAKnF,CAAL,IAAQ,KAAK0J,gBAAL,CAAsB7J,CAAtB,CAAR,KAAmCG,CAAC,GAAC,KAAKqF,SAAL,CAAepC,IAAf,CAAoBpD,CAApB,IAAuBA,CAAC,CAACuK,OAAF,CAAU,KAAK/E,SAAf,EAAyB,IAAzB,EAA+BsD,MAAtD,GAA6D9I,CAAC,CAAC4Q,MAAF,CAAS,KAAKnL,UAAd,CAAlG,GAA6H,CAAC,CAAD,KAAKtF,CAAL,KAASA,CAAC,GAACF,CAAC,CAACoH,OAAF,CAAU,UAAV,CAAX,CAA7H,EAA+J,CAAC,CAAD,KAAKlH,CAAL,IAAQ,QAAMF,CAAC,CAACqS,MAAF,CAAS,CAAC,CAAV,CAAd,KAA6BnS,CAAC,GAACF,CAAC,CAAC6I,MAAF,GAAS,CAAxC,CAA/J,EAA0M3I,CAAC,GAAC,CAAC,CAAH,GAAKH,CAAC,CAACoN,SAAF,CAAY,CAAZ,EAAcjN,CAAd,CAAL,GAAsBH,CAAtO;AAAwO;;AAAAkJ,EAAAA,sBAAsB,CAAClJ,CAAD,EAAGC,CAAH,EAAK;AAAC,WAAM,QAAMD,CAAC,CAACsS,MAAF,CAAS,CAAC,CAAV,CAAN,KAAqBtS,CAAC,GAACA,CAAC,CAAC2P,KAAF,CAAQ,CAAR,EAAU,CAAC,CAAX,CAAvB,GAAsC3P,CAAC,GAACA,CAAC,CAACiL,WAAF,EAAxC,EAAwDhL,CAAC,GAAC,KAAKwH,sBAAL,CAA4BxH,CAA5B,EAA+BgL,WAA/B,EAA1D,EAAuGjL,CAAC,GAAC,KAAKuS,uBAAL,CAA6BvS,CAA7B,CAAzG,EAAyIC,CAAC,GAAC,KAAKsS,uBAAL,CAA6BtS,CAA7B,CAA3I,EAA2K,CAACD,CAAC,GAACA,CAAC,CAACsS,MAAF,CAAStS,CAAC,CAACqH,OAAF,CAAU,GAAV,CAAT,CAAH,OAAgCpH,CAAC,GAACA,CAAC,CAACqS,MAAF,CAASrS,CAAC,CAACoH,OAAF,CAAU,GAAV,CAAT,CAAlC,CAAjL;AAA6O;;AAAAkL,EAAAA,uBAAuB,CAACvS,CAAD,EAAG;AAAC,UAAMC,CAAC,GAAC,mDAAR;AAAA,UAA4DE,CAAC,GAAC,4DAA9D;AAAA,UAA2HC,CAAC,GAAC,uDAA7H;AAAqL,WAAOH,CAAC,CAACmD,IAAF,CAAOpD,CAAP,IAAUA,CAAC,GAACA,CAAC,CAACuK,OAAF,CAAUtK,CAAV,EAAY,wBAAZ,CAAZ,GAAkDE,CAAC,CAACiD,IAAF,CAAOpD,CAAP,IAAUA,CAAC,GAACA,CAAC,CAACuK,OAAF,CAAUpK,CAAV,EAAY,2BAAZ,CAAZ,GAAqDC,CAAC,CAACgD,IAAF,CAAOpD,CAAP,MAAYA,CAAC,GAACA,CAAC,CAACuK,OAAF,CAAUnK,CAAV,EAAY,0BAAZ,CAAd,CAAvG,EAA8JJ,CAArK;AAAuK;;AAAAuH,EAAAA,YAAY,CAACvH,CAAD,EAAG;AAAC,UAAMG,CAAC,GAAC,CAACF,CAAC,CAACsL,OAAF,CAAUiH,QAAV,IAAoB,EAArB,EAAyBvH,WAAzB,EAAR;AAAA,UAA+C7K,CAAC,GAACD,CAAC,GAACH,CAAC,CAACiL,WAAF,GAAgB5D,OAAhB,CAAwBlH,CAAC,GAAC,GAA1B,CAAD,GAAgC,CAAC,CAAnF;AAAqF,WAAM,CAAC,CAAD,KAAKC,CAAL,KAASJ,CAAC,GAACA,CAAC,CAACoN,SAAF,CAAYhN,CAAC,GAACD,CAAC,CAAC2I,MAAJ,GAAW,CAAvB,CAAX,GAAsC9I,CAAC,GAAC+B,CAAC,CAAC/B,CAAD,CAAzC,EAA6CsB,CAAC,CAACtB,CAAD,CAAD,CAAKyS,IAAxD;AAA6D;;AAAA/H,EAAAA,cAAc,CAAC1K,CAAD,EAAG;AAAC,WAAOA,CAAC,CAACqH,OAAF,CAAU,KAAK/B,QAAf,IAAyB,CAAC,CAAjC;AAAmC;;AAAAuE,EAAAA,gBAAgB,CAAC7J,CAAD,EAAG;AAAC,WAAO,KAAKwF,SAAL,CAAepC,IAAf,CAAoBpD,CAApB,KAAwB,KAAKyF,UAAL,CAAgBrC,IAAhB,CAAqBpD,CAArB,CAA/B;AAAuD;;AAAAwH,EAAAA,aAAa,CAACxH,CAAD,EAAG;AAAC,WAAO,KAAK0K,cAAL,CAAoB1K,CAApB,KAAwB,KAAK6J,gBAAL,CAAsB7J,CAAtB,CAA/B;AAAwD;;AAAA0S,EAAAA,mBAAmB,CAAC1S,CAAD,EAAGC,CAAH,EAAK;AAAC,QAAIE,CAAJ;;AAAM,QAAG,KAAKuK,cAAL,CAAoB1K,CAApB,KAAwB,KAAK0K,cAAL,CAAoBzK,CAApB,CAA3B,EAAkD;AAAC,YAAMG,CAAC,GAAC,KAAKuS,UAAL,CAAgB3S,CAAhB,EAAmBiL,WAAnB,EAAR;AAAA,YAAyC5K,CAAC,GAAC,KAAKsS,UAAL,CAAgB1S,CAAhB,EAAmBgL,WAAnB,EAA3C;;AAA4E,UAAG9K,CAAC,GAACC,CAAC,KAAGC,CAAN,EAAQ,CAACF,CAAZ,EAAc;AAAC,cAAMH,CAAC,GAAC,0DAAR;AAAmEG,QAAAA,CAAC,GAACC,CAAC,CAACmK,OAAF,CAAUvK,CAAV,EAAY,IAAZ,MAAoBK,CAAC,CAACkK,OAAF,CAAUvK,CAAV,EAAY,IAAZ,CAAtB;AAAwC;AAAC,KAA1P,MAA+P,KAAK6J,gBAAL,CAAsB7J,CAAtB,KAA0B,KAAK6J,gBAAL,CAAsB5J,CAAtB,CAA1B,GAAmDE,CAAC,GAAC,CAAC,CAAtD,GAAwD,KAAKqH,aAAL,CAAmBxH,CAAnB,KAAuB,KAAKwH,aAAL,CAAmBvH,CAAnB,CAAvB,IAA8C,CAAC,KAAKkS,eAAL,CAAqBnS,CAArB,CAA/C,KAAyEG,CAAC,GAAC,CAAC,CAA5E,CAAxD;;AAAuI,WAAOA,CAAP;AAAS;;AAAAgS,EAAAA,eAAe,CAACnS,CAAD,EAAG;AAAC,UAAMG,CAAC,GAAC,IAAIiB,CAAJ,CAAMpB,CAAC,CAACiL,WAAF,EAAN,CAAR;AAAA,UAA+B7K,CAAC,GAAC,KAAK0D,aAAtC;;AAAoD,QAAIzD,CAAC,GAAC,KAAKqF,UAAL,CAAgBpC,IAAhB,CAAsBtD,CAAC,IAAEA,CAAC,CAAC2F,KAAF,CAAQvC,IAAR,CAAajD,CAAC,CAACiL,GAAf,CAAzB,CAAN;;AAAqD,WAAM,CAAC/K,CAAD,IAAID,CAAJ,KAAQC,CAAC,GAAC,KAAK6I,sBAAL,CAA4B,KAAKzB,sBAAL,CAA4BrH,CAAC,CAACwS,WAA9B,CAA5B,EAAuEzS,CAAC,CAACiL,GAAzE,CAAV,GAAyF/K,CAAC,IAAEJ,CAAC,CAACkH,SAAF,KAAc9G,CAAC,GAACN,CAAC,CAACI,CAAD,EAAGF,CAAC,CAACkH,SAAL,EAAe,CAAC,CAAhB,CAAjB,CAA5F,EAAiI9G,CAAC,KAAGA,CAAC,GAAC,KAAKiE,QAAL,CAAchB,IAAd,CAAoBtD,CAAC,IAAE,KAAKkJ,sBAAL,CAA4BlJ,CAA5B,EAA8BG,CAAC,CAACiL,GAAhC,CAAvB,CAAL,CAAlI,EAAsM/K,CAAC,GAACA,CAAC,IAAE,KAAKkF,UAAL,CAAgBnC,IAAhB,CAAqBjD,CAAC,CAACsS,IAAvB,CAA3M,EAAwOpS,CAA9O;AAAgP;;AAAA6R,EAAAA,aAAa,CAAClS,CAAD,EAAGC,CAAH,EAAK;AAAC,QAAIE,CAAC,GAAC,CAAC,CAAP;AAAA,QAASC,CAAC,GAAC,CAAC,CAAZ;;AAAc,SAAKsF,UAAL,CAAgBoB,OAAhB,CAAyB,CAACzG,CAAD,EAAGC,CAAH,KAAO;AAAC,OAAC,CAAD,KAAKH,CAAL,IAAQE,CAAC,CAACsF,KAAF,CAAQvC,IAAR,CAAapD,CAAb,CAAR,KAA0BG,CAAC,GAACG,CAA5B,GAA+B,CAAC,CAAD,KAAKF,CAAL,IAAQC,CAAC,CAACsF,KAAF,CAAQvC,IAAR,CAAanD,CAAb,CAAR,KAA0BG,CAAC,GAACE,CAA5B,CAA/B;AAA8D,KAA/F;;AAAkG,QAAID,CAAC,GAAC,CAAC,CAAP;;AAAS,QAAGF,CAAC,GAAC,CAAC,CAAH,IAAMC,CAAC,GAAC,CAAC,CAAT,KAAa,MAAID,CAAJ,IAAO,MAAIA,CAAX,GAAa,MAAIC,CAAJ,IAAO,MAAIA,CAAX,KAAeC,CAAC,GAAC,CAAC,CAAlB,CAAb,GAAkC,MAAIF,CAAJ,GAAM,MAAIC,CAAJ,IAAO,MAAIA,CAAX,KAAeC,CAAC,GAAC,CAAC,CAAlB,CAAN,GAA2B,MAAIF,CAAJ,GAAM,MAAIC,CAAJ,KAAQC,CAAC,GAAC,CAAC,CAAX,CAAN,GAAoB,MAAIF,CAAJ,IAAO,MAAIC,CAAX,KAAeC,CAAC,GAAC,CAAC,CAAlB,CAA9F,GAAoH,CAACA,CAAxH,EAA0H;AAAC,YAAMF,CAAC,GAAC,KAAKyG,cAAL,CAAoB3G,CAApB,CAAR;AAAA,YAA+BG,CAAC,GAACD,CAAC,IAAEA,CAAC,CAAC8C,eAAtC;AAAsD7C,MAAAA,CAAC,IAAE4C,CAAC,CAAC7C,CAAD,CAAJ,IAAS,KAAKgS,eAAL,CAAqB/R,CAArB,CAAT,IAAkC,KAAK8R,aAAL,CAAmBlS,CAAnB,EAAqBI,CAArB,CAAlC,KAA4DC,CAAC,GAAC,CAAC,CAA/D;AAAkE;;AAAA,WAAOA,CAAP;AAAS;;AAAA+I,EAAAA,mBAAmB,CAACpJ,CAAD,EAAGC,CAAH,EAAK;AAAC,QAAIE,CAAC,GAAC,CAAC,CAAP;;AAAS,SAAI,IAAIC,CAAC,GAAC,CAAV,EAAYA,CAAC,GAACH,CAAC,CAACoI,SAAF,CAAYS,MAA1B,EAAiC1I,CAAC,EAAlC,EAAqC;AAAC,YAAMC,CAAC,GAACJ,CAAC,CAACoI,SAAF,CAAYjI,CAAZ,CAAR;;AAAuB,UAAG,KAAKsS,mBAAL,CAAyB1S,CAAzB,EAA2BK,CAA3B,CAAH,EAAiC;AAACF,QAAAA,CAAC,GAACC,CAAF;AAAI;AAAM;AAAC;;AAAA,WAAOD,CAAP;AAAS;;AAAAwS,EAAAA,UAAU,CAAC3S,CAAD,EAAG;AAAC,WAAOA,CAAC,CAACuK,OAAF,CAAU,KAAKxE,aAAf,EAA6B,EAA7B,EAAiCwE,OAAjC,CAAyC,KAAKvE,gBAA9C,EAA+D,IAA/D,CAAP;AAA4E;;AAAA2B,EAAAA,eAAe,CAAC3H,CAAD,EAAG;AAAC,QAAIC,CAAJ,EAAME,CAAN,EAAQE,CAAR;;AAAU,QAAG,KAAKqK,cAAL,CAAoB1K,CAApB,KAAwB,KAAK6J,gBAAL,CAAsB7J,CAAtB,CAA3B,EAAoD;AAAC,YAAMK,CAAC,GAAC,KAAKoH,sBAAL,CAA4BzH,CAA5B,CAAR;;AAAuC,aAAOC,CAAC,GAACI,CAAC,GAAC,sBAAJ,EAA2BF,CAAC,GAACC,CAAC,CAACJ,CAAC,GAACK,CAAC,GAAC,YAAL,EAAkB;AAACiL,QAAAA,KAAK,EAAC;AAAC7J,UAAAA,CAAC,EAAC;AAAH;AAAP,OAAlB,CAAD,CAAuC0K,IAAvC,CAA6CnM,CAAC,IAAEA,CAAC,CAACoM,IAAlD,CAA7B,EAAsF;AAACyG,QAAAA,QAAQ,EAAC5S,CAAV;AAAY2J,QAAAA,OAAO,EAACzJ;AAApB,OAA7F;AAAoH;;AAAA,QAAG,KAAKgS,eAAL,CAAqBnS,CAArB,CAAH,EAA2B;AAAC,UAAIC,CAAC,GAAC,EAAN;;AAAS,UAAG,KAAKyF,UAAL,CAAgBpC,IAAhB,CAAsBnD,CAAC,KAAGA,CAAC,CAACwF,KAAF,CAAQvC,IAAR,CAAapD,CAAb,MAAkBC,CAAC,GAACE,CAAC,CAAC0F,eAAtB,GAAuC,CAAC,CAAC5F,CAA5C,CAAvB,GAAwEA,CAAC,IAAE,KAAKqE,QAAL,CAAchB,IAAd,CAAoBnD,CAAC,KAAG,KAAK+I,sBAAL,CAA4B/I,CAA5B,EAA8BH,CAA9B,MAAmCC,CAAC,GAACE,CAAC,GAAC,KAAKkF,WAA5C,GAAyD,CAAC,CAACpF,CAA9D,CAArB,CAA3E,EAAmKA,CAAC,KAAGI,CAAC,GAACL,CAAC,CAACiL,WAAF,GAAgB5D,OAAhB,CAAwB,UAAxB,CAAF,EAAsC,CAAC,CAAD,KAAKhH,CAAL,KAASJ,CAAC,GAACD,CAAC,CAACoN,SAAF,CAAY,CAAZ,EAAc/M,CAAd,IAAiB,KAAKgF,WAAjC,CAAzC,CAApK,EAA4PpF,CAAC,KAAGA,CAAC,GAAC,KAAKoS,UAAL,CAAgBrS,CAAhB,IAAmB,KAAKqF,WAA7B,CAA7P,EAAuSpF,CAA1S,EAA4S;AAAC,cAAME,CAAC,GAAC,IAAIiB,CAAJ,CAAMpB,CAAN,EAASqL,IAAjB;AAAsB,sBAAcjI,IAAd,CAAmBpD,CAAnB,KAAuB,WAASG,CAAhC,KAAoCF,CAAC,GAACA,CAAC,CAACsK,OAAF,CAAU,QAAV,EAAmB,OAAnB,CAAtC,GAAmEtK,CAAC,GAACA,CAAC,CAACsK,OAAF,CAAU,QAAV,EAAmB,QAAnB,CAArE;AAAkG;;AAAA,aAAOtK,CAAP;AAAS;;AAAA,QAAG,CAAC,CAAD,KAAKD,CAAC,CAACiL,WAAF,GAAgB5D,OAAhB,CAAwB,0BAAxB,CAAR,EAA4D,OAAM,gDAAN;AAAuD;;AAAAyL,EAAAA,2BAA2B,CAAC9S,CAAD,EAAGC,CAAH,EAAKE,CAAL,EAAO;AAAC,UAAMC,CAAC,GAACH,CAAC,CAAC0O,UAAV;;AAAqB,QAAG3O,CAAC,CAAC6Q,IAAL,EAAU;AAAC,YAAMxQ,CAAC,GAACD,CAAC,CAAC+O,YAAV;AAAuB,aAAO/O,CAAC,CAAC+O,YAAF,GAAe,IAAf,EAAoB/O,CAAC,CAACgP,QAAF,GAAW,IAA/B,EAAoChP,CAAC,CAACiP,IAAF,EAApC,EAA6C,KAAK6B,cAAL,CAAoB/Q,CAAC,CAACgD,MAAtB,EAA6BnD,CAAC,CAAC6Q,IAA/B,EAAoC5Q,CAAC,CAAC8I,KAAtC,EAA4C,KAAKgK,eAAL,CAAqB9S,CAArB,EAAuB,CAAC,CAAxB,CAA5C,EAAuEI,CAAvE,EAA0E8L,IAA1E,CAAgF9L,CAAC,IAAE;AAAC,cAAMC,CAAC,GAAC,IAAIyH,CAAJ,CAAM;AAACC,UAAAA,MAAM,EAAC3H,CAAC,CAACmL,QAAV;AAAmBrI,UAAAA,MAAM,EAAChD,CAAC,CAACgD,MAA5B;AAAmC8E,UAAAA,KAAK,EAAC5H,CAAC,CAACgQ,YAA3C;AAAwDnI,UAAAA,OAAO,EAACc,IAAI,CAACC,GAAL,KAAW,MAAI5I,CAAC,CAACiQ,UAAjF;AAA4FnI,UAAAA,GAAG,EAAC9H,CAAC,CAAC8H,GAAlG;AAAsG6K,UAAAA,UAAU,EAAChT,CAAC,CAACuQ,KAAnH;AAAyH5B,UAAAA,UAAU,EAACvO;AAApI,SAAN,CAAR;AAAsJ,eAAOH,CAAC,CAAC+H,MAAF,GAAS1H,CAAC,CAAC0H,MAAX,EAAkB5H,CAAC,CAACwO,OAAF,GAAUvO,CAAC,CAAC4S,OAAF,GAAU1P,CAAV,GAAYC,CAAxC,EAA0CpD,CAAC,CAAC8S,YAAF,GAAe7S,CAAC,CAACiR,aAA3D,EAAyElR,CAAC,CAAC6H,KAAF,GAAQ,IAAjF,EAAsF7H,CAAC,CAAC8H,OAAF,GAAU7H,CAAC,CAAC8S,wBAAF,GAA2BnK,IAAI,CAACC,GAAL,KAAW,MAAI5I,CAAC,CAAC8S,wBAA5C,GAAqE,IAArK,EAA0K/S,CAAC,CAAC4H,MAAF,GAAS1H,CAAC,CAAC0H,MAArL,EAA4L5H,CAAC,CAAC+H,GAAF,GAAM7H,CAAC,CAAC6H,GAApM,EAAwM/H,CAAC,CAACiP,IAAF,EAAxM,EAAiN/O,CAAxN;AAA0N,OAApc,CAApD;AAA2f;;AAAA,UAAMD,CAAC,GAAC,IAAI0H,CAAJ,CAAM;AAACC,MAAAA,MAAM,EAAChI,CAAC,CAACwL,QAAV;AAAmBrI,MAAAA,MAAM,EAAChD,CAAC,CAACgD,MAA5B;AAAmC8E,MAAAA,KAAK,EAACjI,CAAC,CAACqQ,YAA3C;AAAwDnI,MAAAA,OAAO,EAACc,IAAI,CAACC,GAAL,KAAW,MAAIiF,MAAM,CAAClO,CAAC,CAACsQ,UAAH,CAArF;AAAoGnI,MAAAA,GAAG,EAAC,WAASnI,CAAC,CAACmI,GAAnH;AAAuH6K,MAAAA,UAAU,EAAChT,CAAC,CAACuQ,KAApI;AAA0I5B,MAAAA,UAAU,EAACvO;AAArJ,KAAN,CAAR;AAAuK,WAAOH,CAAC,CAAC+H,MAAF,GAAS3H,CAAC,CAAC2H,MAAX,EAAkB5H,CAAC,CAACwO,OAAF,GAAU5O,CAAC,CAACiT,OAAF,GAAU1P,CAAV,GAAYC,CAAxC,EAA0CpD,CAAC,CAAC8S,YAAF,GAAe,IAAzD,EAA8D9S,CAAC,CAAC6H,KAAF,GAAQ5H,CAAC,CAAC4H,KAAxE,EAA8E7H,CAAC,CAAC8H,OAAF,GAAU7H,CAAC,CAAC6H,OAA1F,EAAkG9H,CAAC,CAAC4H,MAAF,GAAS3H,CAAC,CAAC2H,MAA7G,EAAoH5H,CAAC,CAAC+H,GAAF,GAAM9H,CAAC,CAAC8H,GAA5H,EAAgI/H,CAAC,CAACiP,IAAF,EAAhI,EAAyIuC,OAAO,CAAC3H,OAAR,CAAgB5J,CAAhB,CAAhJ;AAAmK;;AAAAgN,EAAAA,wBAAwB,CAACrN,CAAD,EAAG;AAAC,QAAIC,CAAJ;AAAM,UAAME,CAAC,GAAC,KAAKyN,SAAb;AAAuB,QAAG,KAAKA,SAAL,GAAe,IAAf,EAAoBzN,CAAvB,EAAyB,IAAGiT,aAAa,CAAC,KAAKC,gBAAN,CAAb,EAAqC,SAAOpT,CAAC,GAAC,KAAKqT,mBAAd,KAAoCrT,CAAC,CAAC0N,MAAF,EAAzE,EAAoF3N,CAAC,CAACsJ,KAAzF,EAA+F;AAAC,YAAMrJ,CAAC,GAAC,oBAAkBD,CAAC,CAACsJ,KAA5B;AAAA,YAAkClJ,CAAC,GAAC,IAAIC,CAAJ,CAAMJ,CAAC,GAAC,+BAAD,GAAiC,wCAAxC,EAAiFA,CAAC,GAAC,SAAD,GAAW,YAAUD,CAAC,CAACsJ,KAAZ,GAAkB,KAAlB,GAAwBtJ,CAAC,CAACyQ,iBAAvH,CAApC;AAA8KtQ,MAAAA,CAAC,CAACwJ,MAAF,CAASvJ,CAAT;AAAY,KAA1R,MAA+R,KAAK0S,2BAAL,CAAiC9S,CAAjC,EAAmCG,CAAC,CAACuO,MAArC,EAA4CvO,CAAC,CAACsO,MAA9C,EAAsDtC,IAAtD,CAA4DnM,CAAC,IAAE;AAACG,MAAAA,CAAC,CAAC8J,OAAF,CAAUjK,CAAV;AAAa,KAA7E,EAAgF+M,KAAhF,CAAuF/M,CAAC,IAAE;AAACG,MAAAA,CAAC,CAACwJ,MAAF,CAAS3J,CAAT;AAAY,KAAvG;AAA0G;;AAAAuT,EAAAA,4BAA4B,CAACvT,CAAD,EAAG;AAACA,IAAAA,CAAC,KAAG,QAAMA,CAAC,CAACmN,MAAF,CAAS,CAAT,CAAN,KAAoBnN,CAAC,GAACA,CAAC,CAACoN,SAAF,CAAY,CAAZ,CAAtB,GAAsC,KAAKC,wBAAL,CAA8B5L,CAAC,CAACzB,CAAD,CAA/B,CAAzC,CAAD;AAA+E;;AAAAwT,EAAAA,cAAc,CAACxT,CAAD,EAAGC,CAAH,EAAKE,CAAL,EAAO;AAAC,WAAOC,CAAC,CAAE,GAAEJ,CAAE,oCAAN,EAA0C;AAAC8L,MAAAA,QAAQ,EAAC,WAAV;AAAsBD,MAAAA,MAAM,EAAC,MAA7B;AAAoCP,MAAAA,KAAK,EAAC;AAAC7J,QAAAA,CAAC,EAAC,MAAH;AAAUmL,QAAAA,SAAS,EAAC3M,CAApB;AAAsBgI,QAAAA,KAAK,EAAC9H;AAA5B;AAA1C,KAA1C,CAAD,CAAsHgM,IAAtH,CAA4HnM,CAAC,IAAEA,CAAC,CAACoM,IAAF,CAAOnE,KAAtI,CAAP;AAAqJ;;AAAAwL,EAAAA,gBAAgB,CAACzT,CAAD,EAAGC,CAAH,EAAK;AAAC,WAAOD,CAAC,GAACA,CAAC,CAACuK,OAAF,CAAU,SAAV,EAAoB,QAApB,CAAF,EAAgCnK,CAAC,CAAE,GAAEJ,CAAE,mCAAN,EAAyC;AAAC8L,MAAAA,QAAQ,EAAC,WAAV;AAAsB4H,MAAAA,OAAO,EAAC;AAAC,iCAAwBzT,CAAzB;AAA2B,oCAA2BwD,MAAM,CAACsB,QAAP,CAAgBE,IAAhB,CAAqBsF,OAArB,CAA6B,MAA7B,EAAoC,EAApC;AAAtD,OAA9B;AAA6HsB,MAAAA,MAAM,EAAC,MAApI;AAA2IP,MAAAA,KAAK,EAAC;AAAC7J,QAAAA,CAAC,EAAC,MAAH;AAAUiK,QAAAA,UAAU,EAAC;AAArB,OAAjJ;AAA0KQ,MAAAA,eAAe,EAAC,CAAC;AAA3L,KAAzC,CAAD,CAAyOC,IAAzO,CAA+OnM,CAAC,IAAEA,CAAC,CAACoM,IAApP,CAAvC;AAAkS;;AAAA9B,EAAAA,cAAc,CAACtK,CAAD,EAAGC,CAAH,EAAK;AAAC,QAAIE,CAAJ;AAAM,QAAG,KAAKuF,UAAL,CAAgBpC,IAAhB,CAAsBrD,CAAC,KAAGA,CAAC,CAAC0F,KAAF,CAAQvC,IAAR,CAAapD,CAAb,MAAkBG,CAAC,GAACF,CAAC,CAAC2F,aAAtB,GAAqC,CAAC,CAACzF,CAA1C,CAAvB,GAAsEA,CAAzE,EAA2E,OAAOyR,OAAO,CAAC3H,OAAR,CAAgB;AAAC0J,MAAAA,MAAM,EAAC,CAAC,CAAT;AAAW5E,MAAAA,cAAc,EAAC,KAA1B;AAAgCnJ,MAAAA,aAAa,EAACzF,CAA9C;AAAgDyT,MAAAA,UAAU,EAAC,aAA3D;AAAyEC,MAAAA,aAAa,EAAC,CAAC;AAAxF,KAAhB,CAAP;AAAmH,SAAKhP,UAAL,CAAgBiP,UAAhB,CAA2B,QAA3B,IAAqC9T,CAAC,GAACA,CAAC,CAACuK,OAAF,CAAU,SAAV,EAAoB,QAApB,EAA8BA,OAA9B,CAAsC,QAAtC,EAA+C,OAA/C,CAAvC,GAA+F,UAAUnH,IAAV,CAAenD,CAAf,MAAoBD,CAAC,GAACA,CAAC,CAACuK,OAAF,CAAU,UAAV,EAAqB,OAArB,EAA8BA,OAA9B,CAAsC,QAAtC,EAA+C,OAA/C,CAAtB,CAA/F;AAA8K,WAAOnK,CAAC,CAACJ,CAAD,EAAG;AAACsL,MAAAA,KAAK,EAAC;AAAC7J,QAAAA,CAAC,EAAC;AAAH,OAAP;AAAkBqK,MAAAA,QAAQ,EAAC,WAA3B;AAAuCI,MAAAA,eAAe,EAAC,CAAC;AAAxD,KAAH,CAAD,CAAgEC,IAAhE,CAAsEnM,CAAC,IAAEA,CAAC,CAACoM,IAA3E,CAAP;AAAyF;;AAAAM,EAAAA,eAAe,CAAC1M,CAAD,EAAG;AAAC,UAAMC,CAAC,GAAC,KAAK6D,aAAb;AAAA,UAA2B3D,CAAC,GAACsD,MAAM,CAACsB,QAAP,CAAgBE,IAA7C;AAAA,UAAkD7E,CAAC,GAAC,KAAKwG,cAAL,CAAoB5G,CAApB,CAApD;AAA2E,WAAM,EAAE,CAACC,CAAD,IAAI,CAAC,KAAKkS,eAAL,CAAqBhS,CAArB,CAAL,IAA8B,EAAEC,CAAC,GAACA,CAAC,CAAC4G,SAAF,IAAa5G,CAAC,CAAC6C,eAAF,IAAmB,KAAKkP,eAAL,CAAqB/R,CAAC,CAAC6C,eAAvB,CAAjC,GAAyE,KAAKkP,eAAL,CAAqBnS,CAArB,CAA5E,CAA9B,IAAoI,EAAE,KAAKkS,aAAL,CAAmB/R,CAAnB,EAAqBH,CAArB,KAAyBC,CAAC,KAAG,KAAKiJ,sBAAL,CAA4B,KAAKzB,sBAAL,CAA4BxH,CAAC,CAAC2S,WAA9B,CAA5B,EAAuE5S,CAAvE,KAA2E,KAAKkS,aAAL,CAAmBjS,CAAC,CAAC2S,WAArB,EAAiC5S,CAAjC,CAA9E,CAA1B,IAA8ID,CAAC,CAACI,CAAD,EAAGH,CAAH,EAAK,CAAC,CAAN,CAAjJ,CAAtI,CAAN;AAAwS;;AAAA+T,EAAAA,cAAc,CAAC/T,CAAD,EAAGC,CAAH,EAAKE,CAAL,EAAOC,CAAP,EAAS;AAAC,QAAIE,CAAC,GAAC,CAAC,CAAP;AAAS,UAAME,CAAC,GAACJ,CAAC,GAACH,CAAC,CAAC+K,oBAAH,GAAwB/K,CAAC,CAAC4F,eAAnC;;AAAmD,QAAGrF,CAAC,CAACwT,IAAF,GAAS/I,WAAT,GAAuB6I,UAAvB,CAAkC,QAAlC,KAA6C,CAAC,KAAKjP,UAAL,CAAgBiP,UAAhB,CAA2B,QAA3B,CAA9C,IAAoF7R,CAAC,CAACzB,CAAD,CAArF,KAA2FF,CAAC,GAAC,CAAC,CAAC,KAAKmN,aAAP,IAAsB,CAAC,CAAC,KAAKA,aAAL,CAAmB;AAACwG,MAAAA,WAAW,EAACjU,CAAb;AAAekU,MAAAA,UAAU,EAACjU;AAA1B,KAAnB,CAA1B,EAA2E,CAACK,CAAvK,CAAH,EAA6K;AAACH,MAAAA,CAAC,CAAC,IAAIE,CAAJ,CAAM,0BAAN,EAAiC,iFAAjC,CAAD,CAAD;AAAuH;;AAAA,WAAOC,CAAP;AAAS;;AAAAkK,EAAAA,QAAQ,CAACxK,CAAD,EAAGC,CAAH,EAAKE,CAAL,EAAOC,CAAP,EAASC,CAAT,EAAWC,CAAX,EAAa;AAAC,WAAOF,CAAC,KAAGA,CAAC,GAACU,CAAC,EAAN,CAAD,EAAWV,CAAC,CAACoO,OAAF,GAAUxO,CAArB,EAAuBI,CAAC,CAACqO,MAAF,GAASxO,CAAhC,EAAkCG,CAAC,CAAC+T,QAAF,GAAWhU,CAA7C,EAA+CC,CAAC,CAACgU,MAAF,GAAS/T,CAAxD,EAA0DD,CAAC,CAACiU,QAAF,GAAW/T,CAArE,EAAuE,KAAK4E,KAAL,GAAW,KAAKgE,sBAAL,CAA4B,KAAKzB,sBAAL,CAA4BzH,CAA5B,CAA5B,EAA2D,KAAKkF,KAAL,CAAWsJ,OAAtE,KAAgF,KAAKZ,SAAL,IAAgB,KAAKA,SAAL,CAAeS,SAA/B,IAA0C,KAAKT,SAAL,CAAeS,SAAf,CAAyBiG,KAAzB,EAA1C,EAA2E,KAAKlQ,OAAL,CAAa2C,IAAb,CAAkB3G,CAAlB,CAA3J,IAAiL,KAAKiE,OAAL,CAAa0C,IAAb,CAAkB3G,CAAlB,CAA5L,GAAiN,KAAKmU,SAAL,CAAenU,CAAf,CAAxR,EAA0SA,CAAC,CAACwJ,OAAnT;AAA2T;;AAAA2K,EAAAA,SAAS,CAACvU,CAAD,EAAG;AAAC,SAAKkF,KAAL,GAAWlF,CAAX,EAAa,KAAKmF,0BAAL,GAAgC,CAAC,CAA9C;;AAAgD,UAAMlF,CAAC,GAACA,CAAC,IAAE;AAAC,YAAME,CAAC,GAACH,CAAC,CAACmU,QAAF,IAAYnU,CAAC,CAACmU,QAAF,CAAWtG,QAA/B;AAAA,YAAwCzN,CAAC,GAACJ,CAAC,CAACwO,OAA5C;AAAA,YAAoDnO,CAAC,GAACL,CAAC,CAACqU,QAAxD;AAAiE,UAAI/T,CAAC,GAAC,CAAC,CAAP;AAAS,OAAC,CAAD,KAAK,KAAK6D,WAAL,CAAiBkD,OAAjB,CAAyBpH,CAAzB,CAAL,KAAmCI,CAAC,IAAE,CAAC,CAAD,KAAK,KAAK8D,WAAL,CAAiBkD,OAAjB,CAAyBhH,CAAzB,CAAR,IAAqCA,CAAC,CAAC2H,MAAF,GAAS/H,CAAC,CAAC+H,MAAX,EAAkB3H,CAAC,CAAC4H,KAAF,GAAQhI,CAAC,CAACgI,KAA5B,EAAkC5H,CAAC,CAAC6H,OAAF,GAAUjI,CAAC,CAACiI,OAA9C,EAAsD7H,CAAC,CAACgM,QAAF,GAAWpM,CAAC,CAACoM,QAAnE,EAA4EhM,CAAC,CAAC8H,GAAF,GAAMlI,CAAC,CAACkI,GAApF,EAAwF9H,CAAC,CAACmU,YAAF,GAAevU,CAAC,CAACuU,YAAzG,EAAsHlU,CAAC,GAAC,CAAC,CAAzH,EAA2HL,CAAC,GAACI,CAAlK,IAAqK,KAAK8D,WAAL,CAAiB4C,IAAjB,CAAsB9G,CAAtB,CAAxM,GAAkOA,CAAC,CAACoI,SAAF,KAAcpI,CAAC,CAACoI,SAAF,GAAY,EAA1B,CAAlO,EAAgQpI,CAAC,CAACoI,SAAF,CAAYoM,QAAZ,CAAqBtU,CAAC,IAAEC,CAAxB,KAA4BH,CAAC,CAACoI,SAAF,CAAYtB,IAAZ,CAAiB5G,CAAC,IAAEC,CAApB,CAA5R,EAAmTH,CAAC,CAACmI,KAAF,GAAQ,KAAKZ,aAAL,CAAmBpH,CAAnB,IAAsB,QAAtB,GAA+B,QAA1V,EAAmWH,CAAC,CAACqI,eAAF,EAAnW;AAAuX,YAAM9H,CAAC,GAAC,KAAK4D,OAAb;AAAA,YAAqB1D,CAAC,GAAC,EAAvB;AAA0B,WAAK0D,OAAL,GAAa,EAAb,EAAgB5D,CAAC,CAACsG,OAAF,CAAW9G,CAAC,IAAE;AAAC,YAAG,CAAC,KAAK0S,mBAAL,CAAyBtS,CAAzB,EAA2BJ,CAAC,CAACwO,OAA7B,CAAJ,EAA0C;AAAC,gBAAMrO,CAAC,GAAC,KAAKwS,UAAL,CAAgB3S,CAAC,CAACwO,OAAlB,CAAR;;AAAmC9N,UAAAA,CAAC,CAACP,CAAD,CAAD,KAAOO,CAAC,CAACP,CAAD,CAAD,GAAK,CAAC,CAAN,EAAQF,CAAC,CAACoI,SAAF,CAAYtB,IAAZ,CAAiB/G,CAAC,CAACwO,OAAnB,CAAf;AAA4C;AAAC,OAA1I,CAAhB,EAA6JxO,CAAC,CAACiK,OAAF,CAAUhK,CAAV,CAA7J,EAA0KO,CAAC,CAACsG,OAAF,CAAW9G,CAAC,IAAE;AAAC,aAAKkJ,sBAAL,CAA4B,KAAKzB,sBAAL,CAA4BrH,CAA5B,CAA5B,EAA2DJ,CAAC,CAACwO,OAA7D,IAAsExO,CAAC,CAACiK,OAAF,CAAUhK,CAAV,CAAtE,GAAmF,KAAKmE,OAAL,CAAa2C,IAAb,CAAkB/G,CAAlB,CAAnF;AAAwG,OAAvH,CAA1K,EAAoS,KAAKkF,KAAL,GAAWlF,CAAC,CAACwO,OAAF,GAAUxO,CAAC,CAACyO,MAAF,GAASzO,CAAC,CAACqU,QAAF,GAAW,IAA7U,EAAkV/T,CAAC,IAAE,KAAK0N,IAAL,CAAU,mBAAV,EAA8B;AAACvB,QAAAA,UAAU,EAACxM;AAAZ,OAA9B,CAArV,EAAmY,KAAKmE,OAAL,CAAa0E,MAAb,GAAoB,KAAKyL,SAAL,CAAe,KAAKnQ,OAAL,CAAasQ,KAAb,EAAf,CAApB,GAAyD,KAAKrQ,OAAL,CAAayE,MAAb,IAAqB,KAAKyL,SAAL,CAAe,KAAKlQ,OAAL,CAAaqQ,KAAb,EAAf,CAAjd;AAAsf,KAA79B;AAAA,UAA89BvU,CAAC,GAACF,CAAC,IAAE;AAACD,MAAAA,CAAC,CAAC2J,MAAF,CAAS1J,CAAT,GAAY,KAAKiF,KAAL,GAAWlF,CAAC,CAACwO,OAAF,GAAUxO,CAAC,CAACyO,MAAF,GAASzO,CAAC,CAACqU,QAAF,GAAW,IAArD,EAA0D,KAAKjQ,OAAL,CAAa0E,MAAb,GAAoB,KAAKyL,SAAL,CAAe,KAAKnQ,OAAL,CAAasQ,KAAb,EAAf,CAApB,GAAyD,KAAKrQ,OAAL,CAAayE,MAAb,IAAqB,KAAKyL,SAAL,CAAe,KAAKlQ,OAAL,CAAaqQ,KAAb,EAAf,CAAxI;AAA6K,KAAjpC;AAAA,UAAkpCtU,CAAC,GAAC,CAACE,CAAD,EAAGI,CAAH,EAAKE,CAAL,EAAOE,CAAP,KAAW;AAAC,UAAII,CAAJ,EAAME,CAAN;;AAAQ,YAAME,CAAC,GAACtB,CAAC,CAACyO,MAAV;AAAA,YAAiBhN,CAAC,GAAC,CAACzB,CAAC,CAACmU,QAAH,IAAa,CAAC,CAAD,KAAKnU,CAAC,CAACmU,QAAF,CAAW5K,MAAhD;AAAA,YAAuD5H,CAAC,GAACL,CAAC,CAAC0F,SAAF,IAAa,KAAKiL,cAAL,CAAoBjS,CAAC,CAACwO,OAAtB,CAAtE;;AAAqG,UAAI3M,CAAJ,EAAME,CAAN;AAAQ,UAAGzB,CAAH,EAAKL,CAAC,CAAC,IAAI8H,CAAJ,CAAM;AAACC,QAAAA,MAAM,EAAC1H,CAAR;AAAU6C,QAAAA,MAAM,EAAC7B,CAAC,CAAC6B,MAAnB;AAA0B8E,QAAAA,KAAK,EAACrH,CAAC,IAAE,IAAnC;AAAwCsH,QAAAA,OAAO,EAAC,QAAMpH,CAAN,GAAQoN,MAAM,CAACpN,CAAD,CAAd,GAAkB,IAAlE;AAAuEqH,QAAAA,GAAG,EAAC,CAAC,CAACzH;AAA7E,OAAN,CAAD,CAAD,CAAL,KAAoG,IAAG+C,MAAM,KAAGA,MAAM,CAACkR,MAAhB,IAAwB,SAAOzT,CAAC,GAAC,KAAK8D,UAAL,CAAgBsG,KAAzB,CAAxB,IAAyDpK,CAAC,CAAC,oBAAD,CAA1D,IAAkF,SAAOE,CAAC,GAAC,KAAK4D,UAAL,CAAgBsG,KAAzB,CAAlF,IAAmHlK,CAAC,CAAC,oBAAD,CAApH,IAA4I,KAAK8H,sBAAL,CAA4B,KAAKzB,sBAAL,CAA4B,KAAKzC,UAAL,CAAgBsG,KAAhB,CAAsB,oBAAtB,CAA5B,CAA5B,EAAqGtL,CAAC,CAACwO,OAAvG,CAA/I,EAA+P;AAAC,YAAIvM,CAAJ;AAAMwB,QAAAA,MAAM,CAACkR,MAAP,CAAc1E,WAAd,CAA0B;AAACF,UAAAA,IAAI,EAAC;AAAN,SAA1B,EAAiE,KAAK/K,UAAL,CAAgBsG,KAAhB,CAAsB,oBAAtB,CAAjE;AAA8G,cAAMlL,CAAC,GAACI,CAAC,CAACiD,MAAD,EAAQ,SAAR,EAAmBzD,CAAC,IAAE;AAACA,UAAAA,CAAC,CAACgQ,MAAF,KAAWvM,MAAM,CAACkR,MAAlB,IAA0B3U,CAAC,CAACoM,IAA5B,KAAmC,6BAA2BpM,CAAC,CAACoM,IAAF,CAAO2D,IAAlC,IAAwC3P,CAAC,CAACuN,MAAF,IAAW3N,CAAC,CAACoM,IAAF,CAAOK,UAAP,CAAkBvE,OAAlB,GAA0Bc,IAAI,CAACC,GAAL,EAA1B,GAAqC9I,CAAC,CAAC,IAAIE,CAAJ,CAAM,4CAAN,EAAmD,yCAAnD,CAAD,CAAtC,GAAsIJ,CAAC,CAAC,IAAI8H,CAAJ,CAAM/H,CAAC,CAACoM,IAAF,CAAOK,UAAb,CAAD,CAA1L,IAAsN,wBAAsBzM,CAAC,CAACoM,IAAF,CAAO2D,IAA7B,KAAoC3P,CAAC,CAACuN,MAAF,IAAW,wBAAsB3N,CAAC,CAACoM,IAAF,CAAO9C,KAAP,CAAa0D,IAAnC,GAAwC7M,CAAC,CAAC,IAAIE,CAAJ,CAAM,4CAAN,EAAmD,yCAAnD,CAAD,CAAzC,GAAyIF,CAAC,CAACE,CAAC,CAACuU,QAAF,CAAW5U,CAAC,CAACoM,IAAF,CAAO9C,KAAlB,CAAD,CAAzL,CAAzP;AAA+c,SAAte,CAAT;AAAkftI,QAAAA,CAAC,CAAC,SAAOiB,CAAC,GAACjC,CAAC,CAACmU,QAAX,IAAqB,KAAK,CAA1B,GAA4BlS,CAAC,CAACwH,MAA/B,EAAuC,MAAI;AAACrJ,UAAAA,CAAC,CAACuN,MAAF;AAAW,SAAvD,CAAD;AAA2D,OAAj6B,MAAs6B,IAAGhM,CAAH,EAAK;AAAC,YAAIrB,CAAC,GAACqB,CAAC,CAACgN,UAAR;;AAAmB,YAAG,CAACrO,CAAJ,EAAM;AAAC,gBAAMN,CAAC,GAAC,IAAI4C,CAAJ,CAAMjB,CAAN,EAAQ4B,CAAR,CAAR;AAAA,gBAAmBtD,CAAC,GAAC,IAAI2C,CAAJ,CAAMjB,CAAN,EAAQ6B,CAAR,CAArB;AAAgCxD,UAAAA,CAAC,CAAC6U,OAAF,MAAa5U,CAAC,CAAC4U,OAAF,EAAb,GAAyB7U,CAAC,CAACkI,OAAF,GAAUjI,CAAC,CAACiI,OAAZ,IAAqB5H,CAAC,GAACN,CAAF,EAAIC,CAAC,CAAC+J,OAAF,EAAzB,KAAuC1J,CAAC,GAACL,CAAF,EAAID,CAAC,CAACgK,OAAF,EAA3C,CAAzB,GAAiF1J,CAAC,GAACN,CAAC,CAAC6U,OAAF,KAAY7U,CAAZ,GAAcC,CAAjG,EAAmG0B,CAAC,CAACgN,UAAF,GAAarO,CAAhH;AAAkH;;AAAA,YAAGA,CAAC,CAACuU,OAAF,EAAH,EAAe;AAAChT,UAAAA,CAAC,GAAC,IAAIkG,CAAJ,CAAM;AAACC,YAAAA,MAAM,EAAC1H,CAAC,CAAC0H,MAAV;AAAiB7E,YAAAA,MAAM,EAAC7B,CAAC,CAAC6B,MAA1B;AAAiC8E,YAAAA,KAAK,EAAC3H,CAAC,CAAC2H,KAAzC;AAA+CC,YAAAA,OAAO,EAAC5H,CAAC,CAAC4H,OAAzD;AAAiEC,YAAAA,GAAG,EAAC7H,CAAC,CAAC6H,GAAvE;AAA2EwG,YAAAA,UAAU,EAACrO;AAAtF,WAAN,CAAF;;AAAkG,gBAAMH,CAAC,GAACwB,CAAC,CAACoH,KAAF,KAAUzI,CAAC,CAACyI,KAAZ,IAAmB,KAAK2D,eAAL,CAAqB1M,CAAC,CAACwO,OAAvB,CAA3B;;AAA2DrO,UAAAA,CAAC,IAAEG,CAAC,CAAC4S,YAAL,IAAmBlT,CAAC,CAAC8U,WAAF,GAAcxU,CAAC,CAAC4S,YAAF,GAAe,KAAKhC,cAAL,CAAoB5P,CAAC,CAAC6B,MAAtB,EAA6B7C,CAAC,CAAC4S,YAA/B,EAA4C5S,CAAC,CAACyI,KAA9C,EAAqDoD,IAArD,CAA2DnM,CAAC,KAAG6B,CAAC,CAACqG,OAAF,GAAUc,IAAI,CAACC,GAAL,KAAW,MAAIjJ,CAAC,CAACsQ,UAA3B,EAAsCzO,CAAC,CAACoG,KAAF,GAAQjI,CAAC,CAACqQ,YAAhD,EAA6DxO,CAAhE,CAA5D,CAAf,GAAgJ+P,OAAO,CAAC3H,OAAR,CAAgBpI,CAAhB,CAA9J,EAAiL7B,CAAC,CAAC8U,WAAF,CAAc3I,IAAd,CAAoBnM,CAAC,IAAEG,CAAC,GAAC,KAAKqT,cAAL,CAAoBxT,CAAC,CAACmD,MAAtB,EAA6BxB,CAAC,CAACoH,KAA/B,EAAqC/I,CAAC,CAACiI,KAAvC,EAA8CkE,IAA9C,CAAoDlM,CAAC,KAAGD,CAAC,CAACiI,KAAF,GAAQhI,CAAR,EAAUD,CAAb,CAArD,EAAuE+M,KAAvE,CAA8E,MAAI/M,CAAlF,CAAD,GAAuFA,CAA/G,EAAmHmM,IAAnH,CAAyHnM,CAAC,IAAE;AAACC,YAAAA,CAAC,CAACD,CAAD,CAAD;AAAK,WAAlI,EAAqI+M,KAArI,CAA4I,MAAI;AAACzM,YAAAA,CAAC,CAAC0J,OAAF,IAAY5J,CAAC,EAAb;AAAgB,WAAjK,CAApM,IAAyWH,CAAC,CAAC4B,CAAD,CAA1W;AAA8W,SAA3hB,MAAgiB,IAAG,KAAKuD,oBAAL,IAA2B,KAAK8D,sBAAL,CAA4BvH,CAAC,CAACwF,SAA9B,EAAwC,KAAK/B,oBAAL,CAA0BmL,KAA1B,CAAgCpJ,SAAxE,CAA3B,KAAgH,KAAK/B,oBAAL,CAA0BiL,YAA1B,IAAwC,KAAKjL,oBAAL,CAA0ByL,IAA1B,IAAgC,KAAKzL,oBAAL,CAA0BmL,KAA1B,CAAgCO,GAAhC,KAAsCxQ,CAAC,CAAC8O,QAAxE,IAAkF9O,CAAC,CAAC6O,YAA5O,CAAH,EAA6P;AAAC,gBAAM/O,CAAC,GAAC,KAAKgF,oBAAb;AAAkC,eAAKA,oBAAL,GAA0B,IAA1B,EAA+BpF,CAAC,CAAC8U,WAAF,GAAc,KAAKhC,2BAAL,CAAiC1S,CAAjC,EAAmCuB,CAAnC,EAAqCL,CAArC,EAAwC6K,IAAxC,CAA8CnM,CAAC,IAAE;AAACC,YAAAA,CAAC,CAACD,CAAD,CAAD;AAAK,WAAvD,EAA0D+M,KAA1D,CAAgE5M,CAAhE,CAA7C;AAAgH,SAAhZ,MAAoZ;AAAC,gBAAMC,CAAC,GAAC,MAAI;AAACqB,YAAAA,CAAC,GAACzB,CAAC,CAAC8U,WAAF,GAAc,KAAK1G,WAAL,CAAiBpO,CAAC,CAACwO,OAAnB,EAA2BlN,CAA3B,EAA6BK,CAA7B,EAA+B3B,CAAC,CAACmU,QAAjC,EAA2ChI,IAA3C,CAAgDlM,CAAhD,EAAkDE,CAAlD,CAAf,IAAqE4B,CAAC,GAAC,IAAI1B,CAAJ,CAAM,oCAAN,EAA2C,wBAA3C,CAAF,EAAuEF,CAAC,CAAC4B,CAAD,CAA7I,CAAD;AAAmJ,WAAhK;;AAAiK,eAAK2K,eAAL,CAAqB1M,CAAC,CAACwO,OAAvB,IAAgCxO,CAAC,CAAC8U,WAAF,GAAc,KAAKrB,gBAAL,CAAsBnS,CAAC,CAAC6B,MAAxB,EAA+BxB,CAAC,CAACoH,KAAjC,EAAwCoD,IAAxC,CAA8CnM,CAAC,IAAE;AAACD,YAAAA,CAAC,CAACC,CAAC,CAACmH,SAAH,EAAa,KAAKtC,UAAlB,EAA6B,CAAC,CAA9B,CAAD,IAAmChD,CAAC,GAAC,IAAIkG,CAAJ,CAAM;AAACC,cAAAA,MAAM,EAAChI,CAAC,CAACwL,QAAV;AAAmBrI,cAAAA,MAAM,EAAC7B,CAAC,CAAC6B,MAA5B;AAAmC+E,cAAAA,OAAO,EAACc,IAAI,CAACC,GAAL,KAAW,MAAIjJ,CAAC,CAACsQ,UAA5D;AAAuErI,cAAAA,KAAK,EAACjI,CAAC,CAACiI;AAA/E,aAAN,CAAF,EAA+FhI,CAAC,CAAC4B,CAAD,CAAnI,IAAwIzB,CAAC,EAAzI;AAA4I,WAA9L,EAAiM2M,KAAjM,CAAuM3M,CAAvM,CAA9C,GAAwPA,CAAC,EAAzP;AAA4P;AAAC,OAArgD,MAA0gD,IAAGqB,CAAH,EAAK;AAAC,YAAG,KAAKsS,cAAL,CAAoB/T,CAAC,CAACwO,OAAtB,EAA8BlN,CAA9B,EAAgCnB,CAAhC,EAAkCH,CAAC,CAACoU,MAApC,CAAH,EAA+C;AAAC,cAAIhU,CAAC,GAACJ,CAAC,CAACmU,QAAR;AAAiBnU,UAAAA,CAAC,CAACoU,MAAF,KAAWhU,CAAC,GAACA,CAAC,IAAE,EAAL,EAAQA,CAAC,CAACyK,OAAF,GAAU,CAAC,CAA9B,GAAiC7K,CAAC,CAAC8U,WAAF,GAAc,KAAKpH,MAAL,CAAY1N,CAAC,CAACwO,OAAd,EAAsBlN,CAAtB,EAAwBlB,CAAxB,EAA2B+L,IAA3B,CAAgClM,CAAhC,EAAkCE,CAAlC,CAA/C;AAAoF;AAAC,OAA5J,MAAiK4B,CAAC,GAAC,IAAI1B,CAAJ,CAAM,oCAAN,EAA2C,wBAA3C,CAAF,EAAuEF,CAAC,CAAC4B,CAAD,CAAxE;AAA4E,KAAthI;AAAA,UAAuhIzB,CAAC,GAAC,MAAI;AAAC,YAAMF,CAAC,GAACJ,CAAC,CAACyO,MAAV;AAAA,YAAiBpO,CAAC,GAACD,CAAC,CAAC6C,eAArB;AAAA,YAAqC3C,CAAC,GAACN,CAAC,CAACmU,QAAzC;AAAkD,UAAI3T,CAAJ,EAAME,CAAN,EAAQE,CAAR,EAAUE,CAAV;AAAY,UAAGR,CAAC,KAAGE,CAAC,GAACF,CAAC,CAAC2H,KAAJ,EAAUvH,CAAC,GAACJ,CAAC,CAACgJ,KAAd,EAAoB1I,CAAC,GAACN,CAAC,CAACiJ,MAA3B,CAAD,EAAoCzI,CAAC,GAAC,KAAK8G,eAAL,CAAqBvH,CAArB,EAAuB;AAAC4H,QAAAA,KAAK,EAACzH,CAAP;AAASqN,QAAAA,QAAQ,EAAC7N,CAAC,CAACwO;AAApB,OAAvB,CAAtC,EAA2F,CAAC1N,CAA/F,EAAiG,KAAI,MAAMd,CAAV,IAAe,KAAKmE,WAApB,EAAgC,IAAG,KAAK+N,aAAL,CAAmB7R,CAAnB,EAAqBL,CAAC,CAACmD,MAAvB,CAAH,EAAkC;AAACrC,QAAAA,CAAC,GAACd,CAAF;AAAI;AAAM;;AAAA,UAAGc,CAAH,EAAK;AAAC,cAAMT,CAAC,GAAC,KAAK8I,cAAL,CAAoBnJ,CAAC,CAACwO,OAAtB,EAA8B1N,CAAC,CAACkH,MAAhC,CAAR;AAAgD,YAAG3H,CAAH,EAAKJ,CAAC,CAACI,CAAD,CAAD,CAAL,KAAe,IAAGgD,CAAC,CAACjD,CAAD,EAAG,KAAK0F,UAAR,CAAJ,EAAwB;AAAC,gBAAM9F,CAAC,GAACc,CAAC,CAAC0H,MAAF,EAAR;AAAmBxI,UAAAA,CAAC,CAACmD,MAAF,GAAS/C,CAAC,CAAC+C,MAAX,EAAkBnD,CAAC,CAACqI,SAAF,GAAY,IAA9B,EAAmCpI,CAAC,CAAC,IAAI8H,CAAJ,CAAM/H,CAAN,CAAD,CAApC;AAA+C,SAA3F,MAA+F;AAAC,WAACA,CAAC,CAAC8U,WAAF,GAAc,KAAKnK,aAAL,CAAmB,KAAK/D,cAAL,CAAoB9F,CAAC,CAACqC,MAAtB,CAAnB,EAAiD,IAAjD,EAAsD;AAAC2H,YAAAA,SAAS,EAAC9K,CAAC,CAACwO,OAAb;AAAqBvG,YAAAA,KAAK,EAACnH,CAAC,CAACmH,KAA7B;AAAmCwB,YAAAA,MAAM,EAACzJ,CAAC,CAACmU,QAAF,CAAW1K,MAArD;AAA4DtB,YAAAA,GAAG,EAACrH,CAAC,CAACqH;AAAlE,WAAtD,CAAf,EAA8IgE,IAA9I,CAAoJhM,CAAC,IAAE;AAACF,YAAAA,CAAC,CAAC,IAAI8H,CAAJ,CAAM;AAACC,cAAAA,MAAM,EAAClH,CAAC,CAACkH,MAAV;AAAiB7E,cAAAA,MAAM,EAAC/C,CAAC,CAAC+C,MAA1B;AAAiC8E,cAAAA,KAAK,EAAC9H,CAAC,CAAC8H,KAAzC;AAA+CC,cAAAA,OAAO,EAAC,QAAM/H,CAAC,CAAC+H,OAAR,GAAgBgG,MAAM,CAAC/N,CAAC,CAAC+H,OAAH,CAAtB,GAAkC,IAAzF;AAA8FC,cAAAA,GAAG,EAAC,CAAC,CAAChI,CAAC,CAACgI,GAAtG;AAA0G0C,cAAAA,OAAO,EAAC7K,CAAC,CAACoU,MAApH;AAA2H/H,cAAAA,QAAQ,EAAClM,CAAC,CAACkM;AAAtI,aAAN,CAAD,CAAD;AAA0J,WAAlT,EAAoTlM,CAApT;AAAuT;AAAC,OAA7d,MAAie;AAAC,aAAK+E,KAAL,GAAW,IAAX,EAAgB1E,CAAC,KAAGR,CAAC,CAACmU,QAAF,CAAWlM,KAAX,GAAiB,IAApB,CAAjB;AAA2C,SAACjI,CAAC,CAAC8U,WAAF,GAAc,KAAKzL,aAAL,CAAmBhJ,CAAC,CAACkK,OAAF,CAAU,MAAV,EAAiB,UAAjB,CAAnB,EAAgD;AAACsD,UAAAA,QAAQ,EAAC7N,CAAC,CAACwO,OAAZ;AAAoBpE,UAAAA,YAAY,EAAChK,CAAC,CAACgK,YAAnC;AAAgDX,UAAAA,MAAM,EAACzJ,CAAC,CAACmU,QAAF,CAAW1K,MAAlE;AAAyExB,UAAAA,KAAK,EAACzH,CAA/E;AAAiF8I,UAAAA,KAAK,EAAC5I,CAAvF;AAAyF6I,UAAAA,MAAM,EAAC3I;AAAhG,SAAhD,CAAf,EAAoKuL,IAApK,CAA0K,MAAI;AAAC,eAAK3B,QAAL,CAAcxK,CAAC,CAACwO,OAAhB,EAAwBxO,CAAC,CAACyO,MAA1B,EAAiCzO,CAAC,CAACmU,QAAnC,EAA4CnU,CAA5C,EAA8CA,CAAC,CAACoU,MAAhD;AAAwD,SAAvO,EAA0OnU,CAAC,IAAE;AAACD,UAAAA,CAAC,CAACwO,OAAF,GAAUxO,CAAC,CAACyO,MAAF,GAASzO,CAAC,CAACqU,QAAF,GAAW,IAA9B,EAAmCrU,CAAC,CAAC2J,MAAF,CAAS1J,CAAT,CAAnC;AAA+C,SAA7R;AAAgS;AAAC,KAAxjK;;AAAyjK,SAAK6R,YAAL,GAAkB3R,CAAlB;;AAAoB,UAAMO,CAAC,GAACV,CAAC,CAACyO,MAAF,CAASxL,eAAjB;AAAA,UAAiCnC,CAAC,GAAC,KAAK0G,aAAL,CAAmBxH,CAAC,CAACwO,OAArB,CAAnC;AAAA,UAAiEtN,CAAC,GAAClB,CAAC,CAACyO,MAAF,CAASvE,YAA5E;;AAAyFhJ,IAAAA,CAAC,GAACA,CAAC,CAAC0I,OAAF,CAAUuC,IAAV,CAAgBlM,CAAC,IAAE;AAAC,YAAME,CAAC,GAACH,CAAC,CAACyO,MAAV;;AAAiB,UAAGtO,CAAC,CAAC+J,YAAL,EAAkB;AAAC/J,QAAAA,CAAC,CAAC6K,oBAAF,GAAuB7K,CAAC,CAAC+J,YAAF,CAAe2I,QAAtC,EAA+C1S,CAAC,CAAC+J,YAAF,GAAe,IAA9D,EAAmE/J,CAAC,CAAC0F,eAAF,GAAkBjF,CAAC,CAAC,2BAAD,EAA6BX,CAA7B,CAAD,IAAkCW,CAAC,CAAC,0BAAD,EAA4BX,CAA5B,CAAnC,IAAmEW,CAAC,CAAC,iBAAD,EAAmBX,CAAnB,CAAzJ,EAA+KE,CAAC,CAACyK,uBAAF,GAA0BhK,CAAC,CAAC,kCAAD,EAAoCX,CAApC,CAA1M,EAAiPE,CAAC,CAAC4O,cAAF,GAAiB9O,CAAC,CAAC8O,cAApQ,EAAmR5O,CAAC,CAACiK,YAAF,GAAenK,CAAC,CAACmK,YAApS;AAAiT,cAAMpK,CAAC,GAACG,CAAC,CAAC8C,eAAF,GAAkBhD,CAAC,CAACgD,eAA5B;AAA4CjD,QAAAA,CAAC,IAAE,KAAKsE,QAAL,CAAcyC,IAAd,CAAmB/G,CAAnB,CAAH;AAAyB;;AAAAc,MAAAA,CAAC,IAAEX,CAAC,CAAC8C,eAAL,GAAqB3C,CAAC,EAAtB,GAAyBF,CAAC,EAA1B;AAA6B,KAA3c,EAA8c,MAAI;AAACJ,MAAAA,CAAC,CAACyO,MAAF,CAASvE,YAAT,GAAsB,IAAtB;AAA2B,YAAMjK,CAAC,GAAC,IAAII,CAAJ,CAAM,+CAAN,EAAsD,2DAAtD,CAAR;AAA2HF,MAAAA,CAAC,CAACF,CAAD,CAAD;AAAK,KAA9mB,CAAD,GAAknBa,CAAC,IAAEJ,CAAH,GAAKJ,CAAC,EAAN,GAASN,CAAC,CAACyO,MAAF,CAAStE,QAAT,GAAkBnK,CAAC,CAACyO,MAAF,CAAStE,QAAT,CAAkBE,OAAlB,CAA0B8B,IAA1B,CAAgClM,CAAC,IAAE;AAAC,YAAME,CAAC,GAAC,EAAR;AAAW,UAAIC,CAAJ,EAAMC,CAAN,EAAQC,CAAR,EAAUE,CAAV;AAAY,aAAOP,CAAC,KAAGG,CAAC,GAACH,CAAC,CAAC8U,IAAF,IAAQ9U,CAAC,CAAC8U,IAAF,CAAOvJ,QAAjB,EAA0BrL,CAAC,CAACqL,QAAF,GAAWpL,CAArC,EAAuCD,CAAC,CAACwT,MAAF,GAAS1T,CAAC,CAAC0T,MAAlD,EAAyDtT,CAAC,GAACJ,CAAC,CAAC4T,aAA7D,EAA2EvT,CAAC,GAAC0U,UAAU,CAAC/U,CAAC,CAAC8O,cAAH,CAAvF,EAA0G,kBAAgB9O,CAAC,CAAC2T,UAAlB,KAA+BpT,CAAC,GAACP,CAAC,CAAC2F,aAAnC,CAA1G,EAA4J5F,CAAC,CAACyO,MAAF,CAASM,cAAT,GAAwBzO,CAAvL,CAAD,EAA2LN,CAAC,CAACyO,MAAF,CAASvD,WAAT,GAAqB,CAAC,CAAC9K,CAAlN,EAAoNA,CAAC,IAAE,KAAKwE,oBAAR,GAA6B,KAAK+F,aAAL,CAAmB3K,CAAC,CAACyO,MAArB,EAA4B,IAA5B,EAAiC;AAACtG,QAAAA,GAAG,EAAChI,CAAC,CAACwT;AAAP,OAAjC,EAAiD5G,KAAjD,CAAwD,MAAI,IAA5D,EAAmEZ,IAAnE,CAAyEnM,CAAC,KAAGG,CAAC,CAAC8U,WAAF,GAAcjV,CAAC,IAAEA,CAAC,CAACiI,KAAnB,EAAyB9H,CAAC,CAAC+U,eAAF,GAAkBlV,CAAC,IAAEA,CAAC,CAACkI,OAAhD,EAAwD/H,CAA3D,CAA1E,CAA7B,GAAuK,CAACC,CAAD,IAAIC,CAAJ,IAAOC,CAAC,IAAE,GAAV,IAAe,CAAC,KAAK2R,cAAL,CAAoBjS,CAAC,CAACwO,OAAtB,CAAhB,GAA+C,KAAK2G,kBAAL,CAAwB;AAAChO,QAAAA,SAAS,EAACnH,CAAC,CAACyO,MAAF,CAAStL,MAApB;AAA2ByC,QAAAA,aAAa,EAACpF,CAAzC;AAA2C4J,QAAAA,YAAY,EAACpK,CAAC,CAACyO,MAAF,CAAStE,QAAT,CAAkBC;AAA1E,OAAxB,EAAiH2C,KAAjH,CAAwH,MAAI,IAA5H,EAAmIZ,IAAnI,CAAyI,MAAIhM,CAA7I,CAA/C,GAAgMA,CAAlkB;AAAokB,KAA/nB,EAAkoB4M,KAAloB,CAAyoB,MAAI,IAA7oB,EAAopBZ,IAAppB,CAA0pBlM,CAAC,IAAE;AAACD,MAAAA,CAAC,CAACyO,MAAF,CAAStE,QAAT,GAAkB,IAAlB,EAAuBlK,CAAC,GAACG,CAAC,CAACH,CAAC,CAACuL,QAAH,EAAYvL,CAAC,CAAC0T,MAAd,EAAqB1T,CAAC,CAACgV,WAAvB,EAAmChV,CAAC,CAACiV,eAArC,CAAF,GAAwD9U,CAAC,EAAjF;AAAoF,KAAlvB,CAAlB,GAAuwBA,CAAC,EAAp4C;AAAu4C;;AAAA+U,EAAAA,kBAAkB,CAACnV,CAAD,EAAG;AAAC,QAAIC,CAAJ;AAAA,QAAME,CAAN;AAAA,QAAQE,CAAC,GAACL,CAAC,CAACmH,SAAZ;AAAsB,UAAM7G,CAAC,GAACN,CAAC,CAAC4F,aAAV;AAAA,UAAwBpF,CAAC,GAACR,CAAC,CAACoK,YAA5B;AAAA,UAAyC1J,CAAC,GAAC,CAAC,KAAK6D,gBAAN,IAAwB,KAAK8B,uBAA7B,IAAsD,CAAC,KAAKC,yBAAvG;;AAAiI,QAAG5F,CAAH,EAAK;AAACP,MAAAA,CAAC,GAACsD,MAAM,CAACsB,QAAP,CAAgBE,IAAlB;AAAuB,UAAIjF,CAAC,GAACG,CAAC,CAACkH,OAAF,CAAU,GAAV,CAAN;AAAqBrH,MAAAA,CAAC,GAAC,CAAC,CAAH,KAAOG,CAAC,GAACA,CAAC,CAACwP,KAAF,CAAQ,CAAR,EAAU3P,CAAV,CAAT,GAAuBA,CAAC,GAACG,CAAC,CAACyQ,MAAF,CAAS,iBAAT,CAAzB,EAAqDzQ,CAAC,GAACH,CAAC,GAAC,CAAC,CAAH,GAAKG,CAAC,CAACwP,KAAF,CAAQ,CAAR,EAAU3P,CAAV,CAAL,GAAkB,IAAzE;AAA8E;;AAAA,WAAOU,CAAC,IAAEP,CAAH,IAAM,KAAKmG,yBAAL,GAA+B,CAAC,CAAhC,EAAkCrG,CAAC,GAACG,CAAC,CAACD,CAAC,GAAC,eAAH,EAAmB;AAACmL,MAAAA,KAAK,EAAC;AAAC7J,QAAAA,CAAC,EAAC;AAAH;AAAP,KAAnB,CAAD,CAAwC0K,IAAxC,CAA8C,MAAI;AAAC,WAAK5H,gBAAL,GAAsB,IAAI1B,CAAJ,CAAM;AAACkG,QAAAA,KAAK,EAAC,cAAP;AAAsBqM,QAAAA,gBAAgB,EAACjV,CAAC,GAAC;AAAzC,OAAN,CAAtB;AAAmG,KAAtJ,CAA1C,IAAoMF,CAAC,GAAC2R,OAAO,CAAC3H,OAAR,EAAtM,EAAwNhK,CAAC,CAACkM,IAAF,CAAQ,MAAI;AAAC,UAAG,KAAK5H,gBAAR,EAAyB,OAAOlE,CAAC,GAACA,CAAC,CAACkK,OAAF,CAAU,SAAV,EAAoB,QAApB,CAAF,EAAgCnK,CAAC,CAACC,CAAC,GAAC,0CAAH,EAA8C;AAACiL,QAAAA,KAAK,EAAC;AAAC+J,UAAAA,SAAS,EAAC7U,CAAX;AAAaoM,UAAAA,SAAS,EAAC,KAAKrI,gBAAL,CAAsBwE,KAA7C;AAAmDqI,UAAAA,YAAY,EAACjP,CAAC,CAAC,KAAKoC,gBAAL,CAAsB6Q,gBAAvB,CAAjE;AAA0G3T,UAAAA,CAAC,EAAC;AAA5G;AAAP,OAA9C,CAAD,CAA4K0K,IAA5K,CAAkLnM,CAAC,IAAE;AAAC,YAAGA,CAAC,CAACoM,IAAF,CAAOS,KAAV,EAAgB;AAAC,gBAAM5M,CAAC,GAAC,KAAKsE,gBAAL,CAAsB+Q,KAAtB,EAAR;AAAsCtV,UAAAA,CAAC,CAACoM,IAAF,CAAOmJ,MAAP,IAAejV,CAAf,GAAiBL,CAAC,CAACkH,SAAF,GAAY,aAAWnH,CAAC,CAACoM,IAAF,CAAOmJ,MAAP,CAActK,WAAd,EAAX,GAAuC,GAAvC,GAA2C3K,CAAxE,GAA0EL,CAAC,CAACkH,SAAF,GAAY9G,CAAtF,EAAwFJ,CAAC,CAAC6O,KAAF,GAAQrL,MAAM,KAAGA,MAAM,CAAC+R,GAAhB,IAAqB,EAAEzV,CAAC,CAACM,CAAD,EAAG,KAAKwE,UAAR,CAAD,IAAsB,KAAKa,UAAL,CAAgBpC,IAAhB,CAAsBtD,CAAC,IAAEA,CAAC,CAAC2F,KAAF,CAAQvC,IAAR,CAAa/C,CAAb,KAAiBL,CAAC,CAAC2F,KAAF,CAAQvC,IAAR,CAAa,KAAKyB,UAAlB,CAA1C,CAAxB,CAArH,EAAwN,KAAKX,UAAL,CAAgB6C,IAAhB,CAAqB9G,CAArB,CAAxN;AAAgP;AAAC,OAA9d,CAAvC;AAAwgB,KAA9iB,CAA/N;AAAgxB;;AAAAwP,EAAAA,cAAc,CAACzP,CAAD,EAAGC,CAAH,EAAKE,CAAL,EAAOC,CAAP,EAAS;AAAC,UAAME,CAAC,GAACH,CAAC,CAACwO,UAAV;AAAA,UAAqBjO,CAAC,GAAC;AAACyG,MAAAA,SAAS,EAAChH,CAAC,CAACgH;AAAb,KAAvB;AAA+C,KAAChH,CAAC,CAAC2O,KAAH,IAAU3O,CAAC,CAACsV,eAAZ,IAA6BhS,MAAM,CAACsB,QAAP,CAAgBqL,IAA7C,KAAoD1P,CAAC,CAAC0P,IAAF,GAAO3M,MAAM,CAACsB,QAAP,CAAgBqL,IAA3E,GAAiF9P,CAAC,CAAC8O,QAAF,KAAa1O,CAAC,CAACoQ,GAAF,GAAMxQ,CAAC,CAAC8O,QAArB,CAAjF;AAAgH,UAAMxO,CAAC,GAAC;AAACgM,MAAAA,SAAS,EAACzM,CAAC,CAAC4I,KAAb;AAAmB2M,MAAAA,aAAa,EAACpV,CAAC,CAAC6O,YAAF,GAAe,MAAf,GAAsB,OAAvD;AAA+DoB,MAAAA,KAAK,EAAC5H,IAAI,CAACgN,SAAL,CAAejV,CAAf,CAArE;AAAuFgL,MAAAA,UAAU,EAACvL,CAAC,CAACuL,UAApG;AAA+GkK,MAAAA,MAAM,EAACzV,CAAC,CAACyV,MAAxH;AAA+HxE,MAAAA,YAAY,EAAC,KAAK2B,eAAL,CAAqB5S,CAArB,EAAuB,CAAC,CAACG,CAAC,CAAC6O,YAA3B;AAA5I,KAAR;AAA8LhP,IAAAA,CAAC,CAAC0V,UAAF,KAAejV,CAAC,CAACkV,WAAF,GAAc,CAAC,CAA9B,GAAiC3V,CAAC,CAAC4V,WAAF,IAAe5V,CAAC,CAAC6H,MAAjB,KAA0BpH,CAAC,CAACoV,oBAAF,GAAuB7V,CAAC,CAAC6H,MAAnD,CAAjC,EAA4F,CAAC7H,CAAC,CAAC2O,KAAH,IAAU,KAAKpC,eAAL,CAAqB1M,CAArB,CAAV,KAAoCY,CAAC,CAACqV,oBAAF,GAAuB,CAAC,CAA5D,CAA5F,EAA2J3V,CAAC,CAAC6O,YAAF,KAAiBvO,CAAC,CAACsV,cAAF,GAAiB9V,CAAC,IAAEE,CAAC,CAAC6O,YAAtB,EAAmCvO,CAAC,CAACuV,qBAAF,GAAwB/V,CAAC,GAAC,MAAD,GAAQ,OAArF,CAA3J;AAAyP,UAAMU,CAAC,GAACX,CAAC,CAACgH,SAAF,CAAYoD,OAAZ,CAAoB,SAApB,EAA8B,QAA9B,IAAwC,2BAAhD;AAAA,UAA4EvJ,CAAC,GAACF,CAAC,GAAC,GAAF,GAAMe,CAAC,CAACjB,CAAD,CAArF;;AAAyF,QAAGT,CAAC,CAAC2O,KAAL,EAAW;AAAC,YAAM9O,CAAC,GAACyD,MAAM,CAACsK,IAAP,CAAY/M,CAAZ,EAAc,gBAAd,EAA+Bb,CAAC,CAACiW,mBAAjC,CAAR;AAA8D,UAAGpW,CAAH,EAAKA,CAAC,CAACsU,KAAF,IAAU,KAAK1G,SAAL,CAAeS,SAAf,GAAyBrO,CAAnC,EAAqC,KAAKqT,gBAAL,GAAsBgD,WAAW,CAAE,MAAI;AAAC,YAAGrW,CAAC,CAACsO,MAAL,EAAY;AAAC8E,UAAAA,aAAa,CAAC,KAAKC,gBAAN,CAAb,EAAqC,KAAKC,mBAAL,CAAyB3F,MAAzB,EAArC;AAAuE,gBAAM3N,CAAC,GAAC,KAAK4N,SAAb;;AAAuB,cAAG5N,CAAH,EAAK;AAAC,kBAAMC,CAAC,GAAC,IAAII,CAAJ,CAAM,+BAAN,EAAsC,SAAtC,CAAR;AAAyDL,YAAAA,CAAC,CAAC2J,MAAF,CAAS1J,CAAT;AAAY;AAAC;AAAC,OAA/L,EAAiM,GAAjM,CAAtE,EAA4Q,KAAKqT,mBAAL,GAAyB9S,CAAC,CAACiD,MAAD,EAAQ,CAAC,kBAAD,EAAoB,6BAApB,CAAR,EAA4DzD,CAAC,IAAE;AAAC,+BAAqBA,CAAC,CAAC+P,IAAvB,GAA4B,KAAK7C,oBAAL,CAA0BlN,CAAC,CAACsW,MAA5B,CAA5B,GAAgE,KAAK/C,4BAAL,CAAkCvT,CAAC,CAACsW,MAApC,CAAhE;AAA4G,OAA5K,CAAtS,CAAL,KAA8d;AAAC,cAAMtW,CAAC,GAAC,IAAIK,CAAJ,CAAM,gCAAN,EAAuC,SAAvC,CAAR;;AAA0D,aAAKuN,SAAL,CAAejE,MAAf,CAAsB3J,CAAtB;AAAyB;AAAC,KAA7nB,MAAkoB,KAAKmF,0BAAL,GAAgC,CAAC,CAAjC,EAAmC,KAAKoI,kBAAL,GAAwB,KAAKA,kBAAL,CAAwB;AAACgJ,MAAAA,eAAe,EAAC3V,CAAjB;AAAmB4V,MAAAA,YAAY,EAAC1V,CAAhC;AAAkCmT,MAAAA,WAAW,EAACjU,CAA9C;AAAgDkU,MAAAA,UAAU,EAACjU,CAA3D;AAA6DwW,MAAAA,SAAS,EAACtW;AAAvE,KAAxB,CAAxB,GAA2HsD,MAAM,CAACsB,QAAP,CAAgBE,IAAhB,GAAqBjE,CAAnL;AAAqL;;AAAA+R,EAAAA,eAAe,CAAC/S,CAAD,EAAGC,CAAH,EAAK;AAAC,UAAME,CAAC,GAACsD,MAAM,CAACsB,QAAP,CAAgBE,IAAhB,CAAqBsF,OAArB,CAA6B,MAA7B,EAAoC,EAApC,CAAR;AAAgD,QAAGvK,CAAC,CAAC8O,KAAL,EAAW,OAAO3M,CAAC,CAACnC,CAAC,CAACoV,gBAAH,CAAR;;AAA6B,QAAGnV,CAAH,EAAK;AAAC,YAAMD,CAAC,GAACsB,CAAC,CAACnB,CAAD,CAAT;AAAa,aAAOH,CAAC,CAACsL,KAAF,IAAS,CAAC,MAAD,EAAQ,OAAR,EAAgB,mBAAhB,EAAoC,cAApC,EAAmD,SAAnD,EAA6D,OAA7D,EAAsExE,OAAtE,CAA+E7G,CAAC,IAAE;AAAC,eAAOD,CAAC,CAACsL,KAAF,CAAQrL,CAAR,CAAP;AAAkB,OAArG,CAAT,EAAiHoC,CAAC,CAACrC,CAAC,CAACyS,IAAH,EAAQzS,CAAC,CAACsL,KAAV,CAAzH;AAA0I;;AAAA,WAAOnL,CAAP;AAAS;;AAAlw+B;;AAAmw+ByD,CAAC,CAAC8S,SAAF,CAAY7N,aAAZ,GAA0B,mCAA1B;AAA8D,IAAId,CAAC,GAAC,cAAczH,CAAC,CAACqW,eAAhB,CAA+B;AAAC9S,EAAAA,WAAW,CAAC7D,CAAD,EAAG;AAAC,UAAMA,CAAN,GAAS,KAAK2O,UAAL,GAAgB,IAAzB,EAA8B,KAAKiI,kBAAL,GAAwB,CAAtD,EAAwD5W,CAAC,IAAEA,CAAC,CAAC2O,UAAL,KAAkB,KAAKA,UAAL,GAAgB3O,CAAC,CAAC2O,UAApC,CAAxD;AAAwG;;AAAAjG,EAAAA,UAAU,GAAE;AAAC,SAAKL,SAAL,GAAe,KAAKA,SAAL,IAAgB,EAA/B,EAAkC,QAAM,KAAKmM,YAAX,KAA0B,KAAKA,YAAL,GAAkBxL,IAAI,CAACC,GAAL,EAA5C,CAAlC;AAA0F;;AAAAiK,EAAAA,YAAY,GAAE;AAAC,UAAMlT,CAAC,GAACG,CAAC,CAACyG,cAAF,CAAiB,KAAKzD,MAAtB,CAAR;AAAA,UAAsClD,CAAC,GAACD,CAAC,IAAEA,CAAC,CAACiD,eAA7C;AAAA,UAA6D7C,CAAC,GAAC,CAAC,CAACH,CAAF,IAAK,aAAW,KAAKmI,KAApF;AAAA,UAA0F/H,CAAC,GAACD,CAAC,IAAEiD,CAAC,CAACrD,CAAD,EAAGG,CAAC,CAAC2F,UAAL,CAAhG;AAAA,UAAiHxF,CAAC,GAACN,CAAC,CAACkL,WAArH;AAAA,UAAiI1K,CAAC,GAACF,CAAC,IAAEH,CAAC,CAACyE,oBAAxI;AAAA,UAA6JlE,CAAC,GAACqC,CAAC,CAAC,KAAKI,MAAN,CAAhK;AAAA,UAA8KvC,CAAC,GAACF,CAAC,IAAEA,CAAC,CAAC,KAAKsH,MAAN,CAApL;AAAkM,QAAIlH,CAAJ;AAAA,QAAME,CAAC,GAAC,KAAKqH,SAAL,IAAgB,KAAKA,SAAL,CAAe,CAAf,CAAxB;AAAA,QAA0CnH,CAAC,GAACd,CAAC,IAAED,CAAC,CAACyG,cAAF,CAAiB3G,CAAjB,CAA/C;AAAA,QAAmEmB,CAAC,GAAC;AAACoK,MAAAA,QAAQ,EAAC,KAAKxD,MAAf;AAAsByD,MAAAA,QAAQ,EAAC7K;AAA/B,KAArE;AAAuG,QAAGN,CAAC,IAAE,CAACE,CAAP,EAAS;AAAOJ,IAAAA,CAAC,IAAE,CAACc,CAAJ,IAAOf,CAAC,CAAC8D,WAAF,CAAcX,IAAd,CAAoBtD,CAAC,KAAGG,CAAC,CAAC+R,aAAF,CAAgBjS,CAAhB,EAAkBD,CAAC,CAACmD,MAApB,MAA8BjC,CAAC,GAAClB,CAAhC,GAAmC,CAAC,CAACkB,CAAxC,CAArB,CAAP;AAAyE,UAAMI,CAAC,GAACJ,CAAC,IAAEf,CAAC,CAACgJ,cAAF,CAAiBjI,CAAC,CAACiC,MAAnB,EAA0B,KAAK6E,MAA/B,CAAX;;AAAkD,QAAG,CAAC5H,CAAD,IAAIkB,CAAP,EAAS;AAAC,UAAG,CAACjB,CAAJ,EAAM;AAAC,YAAGD,CAAH,EAAKU,CAAC,GAAC;AAACgK,UAAAA,SAAS,EAAC9J,CAAX;AAAaiH,UAAAA,KAAK,EAAC3G,CAAC,IAAEA,CAAC,CAAC2G,KAAxB;AAA8BE,UAAAA,GAAG,EAAC7G,CAAC,IAAEA,CAAC,CAAC6G;AAAvC,SAAF,CAAL,KAAwD,IAAG3H,CAAH,EAAKY,CAAC,GAAC,IAAF,EAAON,CAAC,GAAC;AAACqH,UAAAA,GAAG,EAAC,KAAKA;AAAV,SAAT,CAAL,KAAiC;AAAC,cAAG,CAACvH,CAAJ,EAAM;AAAC,gBAAIX,CAAJ;AAAM,mBAAOe,CAAC,KAAGA,CAAC,GAACb,CAAC,CAACoH,YAAF,CAAevG,CAAf,CAAF,EAAoB,KAAK6V,SAAL,GAAe,CAAnC,EAAqC5W,CAAC,GAACE,CAAC,CAACqK,QAAF,CAAWxJ,CAAX,EAAahB,CAAb,EAAe,IAAf,EAAoB,IAApB,EAAyB,KAAK6K,OAA9B,EAAsC,IAAtC,CAAvC,EAAmF5K,CAAC,CAACkM,IAAF,CAAQ,MAAI;AAAC,mBAAK0K,SAAL,GAAe,CAAf,EAAiB,KAAKtO,mBAAL,EAAjB;AAA4C,aAAzD,EAA4DwE,KAA5D,CAAmE,MAAI;AAAC,mBAAK8J,SAAL,GAAe,CAAf;AAAiB,aAAzF,CAAtF,CAAD,EAAoL5W,CAA3L;AAA6L;;AAAA,eAAK4K,OAAL,KAAe/J,CAAC,GAAC;AAAC+J,YAAAA,OAAO,EAAC,CAAC;AAAV,WAAjB;AAA+B;AAAA,eAAO1K,CAAC,CAACwK,aAAF,CAAgBvK,CAAC,GAACc,CAAD,GAAGlB,CAApB,EAAsBI,CAAC,GAAC,IAAD,GAAMgB,CAA7B,EAA+BN,CAA/B,EAAkCqL,IAAlC,CAAwCnM,CAAC,IAAE;AAAC,eAAKiI,KAAL,GAAWjI,CAAC,CAACiI,KAAb,EAAmB,KAAKC,OAAL,GAAa,QAAMlI,CAAC,CAACkI,OAAR,GAAgBgG,MAAM,CAAClO,CAAC,CAACkI,OAAH,CAAtB,GAAkC,IAAlE,EAAuE,KAAKsM,YAAL,GAAkBxL,IAAI,CAACC,GAAL,EAAzF,EAAoG,KAAKoD,QAAL,GAAcrM,CAAC,CAACqM,QAApH,EAA6H,KAAK/D,eAAL,EAA7H,EAAoJ,KAAKC,mBAAL,EAApJ;AAA+K,SAA3N,EAA8NwE,KAA9N,CAAqO,MAAI,CAAE,CAA3O,CAAP;AAAqP;;AAAAzL,MAAAA,CAAC,CAAC4R,YAAF;AAAiB;AAAC;;AAAA3K,EAAAA,mBAAmB,GAAE;AAAC,iBAAW,KAAKH,KAAhB,IAAuBjI,CAAC,CAACgE,WAAF,CAAc2C,OAAd,CAAuB9G,CAAC,IAAE;AAAC,YAAMC,CAAC,GAACE,CAAC,CAACyG,cAAF,CAAiB5G,CAAC,CAACmD,MAAnB,CAAR;AAAA,YAAmC/C,CAAC,GAACH,CAAC,IAAEA,CAAC,CAACgD,eAA1C;AAA0DjD,MAAAA,CAAC,KAAG,IAAJ,IAAUA,CAAC,CAACgI,MAAF,KAAW,KAAKA,MAA1B,IAAkC5H,CAAlC,IAAqC,aAAWJ,CAAC,CAACoI,KAAlD,KAA0DjI,CAAC,CAAC+I,sBAAF,CAAyB,KAAK/F,MAA9B,EAAqC/C,CAArC,KAAyCD,CAAC,CAAC+R,aAAF,CAAgB9R,CAAhB,EAAkB,KAAK+C,MAAvB,CAAnG,MAAqIE,CAAC,CAACpD,CAAD,EAAGE,CAAC,CAAC2F,UAAL,CAAD,IAAmB9F,CAAC,CAACiI,KAAF,GAAQ,KAAKA,KAAb,EAAmBjI,CAAC,CAACkI,OAAF,GAAU,KAAKA,OAAlC,EAA0ClI,CAAC,CAACwU,YAAF,GAAe,KAAKA,YAA9D,EAA2ExU,CAAC,CAACqM,QAAF,GAAW,KAAKA,QAA3F,EAAoGrM,CAAC,CAACsI,eAAF,EAAvH,IAA4ItI,CAAC,CAACkT,YAAF,EAAjR;AAAmS,KAAxX,CAAvB;AAAkZ;;AAAA5K,EAAAA,eAAe,CAACtI,CAAD,EAAG;AAAC8W,IAAAA,YAAY,CAAC,KAAKC,aAAN,CAAZ;AAAiC,UAAM9W,CAAC,GAAC,KAAKkD,MAAL,IAAahD,CAAC,CAACyG,cAAF,CAAiB,KAAKzD,MAAtB,CAArB;AAAA,UAAmD/C,CAAC,GAACH,CAAC,IAAEA,CAAC,CAACgD,eAA1D;AAAA,UAA0E5C,CAAC,GAACD,CAAC,IAAED,CAAC,CAACyG,cAAF,CAAiBxG,CAAjB,CAA/E;AAAmG,KAAC,CAAD,KAAKJ,CAAL,IAAQI,CAAC,IAAE,aAAW,KAAKgI,KAAnB,KAA2B,CAAC/H,CAAD,IAAI,CAACA,CAAC,CAAC6K,WAAP,IAAoB/K,CAAC,CAACyE,oBAAjD,CAAR,IAAgF,QAAM,KAAKsD,OAAX,IAAoB,QAAM,KAAKmE,QAA/G,IAAyH,KAAK2K,kBAAL,EAAzH,EAAmJ,KAAKhJ,IAAL,CAAU,cAAV,CAAnJ;AAA6K;;AAAAhE,EAAAA,OAAO,GAAE;AAAC,SAAKhC,MAAL,GAAY,KAAK7E,MAAL,GAAY,KAAK8E,KAAL,GAAW,KAAKC,OAAL,GAAa,KAAKmE,QAAL,GAAc,KAAKhE,SAAL,GAAe,KAAKmM,YAAL,GAAkB,IAA/F,EAAoG,KAAK7F,UAAL,KAAkB,KAAKA,UAAL,CAAgB3E,OAAhB,IAA0B,KAAK2E,UAAL,GAAgB,IAA5D,CAApG;AAAsK,UAAM3O,CAAC,GAACG,CAAC,CAACgE,WAAF,CAAckD,OAAd,CAAsB,IAAtB,CAAR;AAAoCrH,IAAAA,CAAC,GAAC,CAAC,CAAH,IAAMG,CAAC,CAACgE,WAAF,CAAciD,MAAd,CAAqBpH,CAArB,EAAuB,CAAvB,CAAN,EAAgC,KAAKsI,eAAL,EAAhC,EAAuD,KAAK0F,IAAL,CAAU,SAAV,CAAvD;AAA4E;;AAAAxF,EAAAA,MAAM,GAAE;AAAC,UAAMxI,CAAC,GAACU,CAAC,CAAC;AAACsH,MAAAA,MAAM,EAAC,KAAKA,MAAb;AAAoB7E,MAAAA,MAAM,EAAC,KAAKA,MAAhC;AAAuC8E,MAAAA,KAAK,EAAC,KAAKA,KAAlD;AAAwDC,MAAAA,OAAO,EAAC,KAAKA,OAArE;AAA6EmE,MAAAA,QAAQ,EAAC,KAAKA,QAA3F;AAAoGlE,MAAAA,GAAG,EAAC,KAAKA,GAA7G;AAAiH0C,MAAAA,OAAO,EAAC,KAAKA,OAA9H;AAAsI2J,MAAAA,YAAY,EAAC,KAAKA,YAAxJ;AAAqKpM,MAAAA,KAAK,EAAC,KAAKA;AAAhL,KAAD,CAAT;AAAA,UAAkMnI,CAAC,GAAC,KAAKoI,SAAzM;AAAmN,WAAOpI,CAAC,IAAEA,CAAC,CAAC6I,MAAF,GAAS,CAAZ,KAAgB9I,CAAC,CAACqI,SAAF,GAAYpI,CAAC,CAAC0P,KAAF,EAA5B,GAAuC3P,CAA9C;AAAgD;;AAAAgX,EAAAA,kBAAkB,GAAE;AAACF,IAAAA,YAAY,CAAC,KAAKC,aAAN,CAAZ;AAAiC,UAAM/W,CAAC,GAAC,MAAI,KAAK4W,kBAAjB;AAAA,UAAoC3W,CAAC,GAAC,KAAG,EAAH,GAAM,CAA5C;AAA8C,QAAIE,CAAC,GAAC,CAAC,KAAKkM,QAAL,GAAc,KAAKmI,YAAL,GAAkB,MAAI,KAAKnI,QAAzC,GAAkD,KAAKnE,OAAxD,IAAiEc,IAAI,CAACC,GAAL,EAAvE;AAAkF9I,IAAAA,CAAC,GAAC,CAAF,GAAIA,CAAC,GAAC,CAAN,GAAQA,CAAC,GAACF,CAAF,KAAME,CAAC,GAACF,CAAR,CAAR,EAAmB,KAAK8W,aAAL,GAAmBE,UAAU,CAAC,KAAK/D,YAAL,CAAkBgE,IAAlB,CAAuB,IAAvB,CAAD,EAA8B/W,CAAC,GAACH,CAAF,GAAIG,CAAC,GAACH,CAAN,GAAQG,CAAtC,CAAhD;AAAyF;;AAApyF,CAArC;AAA20FH,CAAC,CAAC,CAACuC,CAAC,EAAF,CAAD,EAAOwF,CAAC,CAAC2O,SAAT,EAAmB,cAAnB,EAAkC,KAAK,CAAvC,CAAD,EAA2C1W,CAAC,CAAC,CAACuC,CAAC,EAAF,CAAD,EAAOwF,CAAC,CAAC2O,SAAT,EAAmB,SAAnB,EAA6B,KAAK,CAAlC,CAA5C,EAAiF1W,CAAC,CAAC,CAACuC,CAAC,EAAF,CAAD,EAAOwF,CAAC,CAAC2O,SAAT,EAAmB,SAAnB,EAA6B,KAAK,CAAlC,CAAlF,EAAuH1W,CAAC,CAAC,CAACuC,CAAC,EAAF,CAAD,EAAOwF,CAAC,CAAC2O,SAAT,EAAmB,YAAnB,EAAgC,KAAK,CAArC,CAAxH,EAAgK1W,CAAC,CAAC,CAACuC,CAAC,EAAF,CAAD,EAAOwF,CAAC,CAAC2O,SAAT,EAAmB,WAAnB,EAA+B,KAAK,CAApC,CAAjK,EAAwM1W,CAAC,CAAC,CAACuC,CAAC,EAAF,CAAD,EAAOwF,CAAC,CAAC2O,SAAT,EAAmB,OAAnB,EAA2B,KAAK,CAAhC,CAAzM,EAA4O1W,CAAC,CAAC,CAACuC,CAAC,EAAF,CAAD,EAAOwF,CAAC,CAAC2O,SAAT,EAAmB,QAAnB,EAA4B,KAAK,CAAjC,CAA7O,EAAiR1W,CAAC,CAAC,CAACuC,CAAC,EAAF,CAAD,EAAOwF,CAAC,CAAC2O,SAAT,EAAmB,KAAnB,EAAyB,KAAK,CAA9B,CAAlR,EAAmT1W,CAAC,CAAC,CAACuC,CAAC,EAAF,CAAD,EAAOwF,CAAC,CAAC2O,SAAT,EAAmB,OAAnB,EAA2B,KAAK,CAAhC,CAApT,EAAuV1W,CAAC,CAAC,CAACuC,CAAC,EAAF,CAAD,EAAOwF,CAAC,CAAC2O,SAAT,EAAmB,oBAAnB,EAAwC,KAAK,CAA7C,CAAxV,EAAwY1W,CAAC,CAAC,CAACuC,CAAC,EAAF,CAAD,EAAOwF,CAAC,CAAC2O,SAAT,EAAmB,QAAnB,EAA4B,KAAK,CAAjC,CAAzY,EAA6a1W,CAAC,CAAC,CAACuC,CAAC,EAAF,CAAD,EAAOwF,CAAC,CAAC2O,SAAT,EAAmB,UAAnB,EAA8B,KAAK,CAAnC,CAA9a,EAAod3O,CAAC,GAAC/H,CAAC,CAAC,CAACyC,CAAC,CAAC,0BAAD,CAAF,CAAD,EAAiCsF,CAAjC,CAAvd;AAA2f,SAAOA,CAAC,IAAIoP,UAAZ,EAAuBvT,CAAC,IAAIwT,mBAA5B","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../chunks/tslib.es6.js\";import t from\"../config.js\";import{id as r}from\"../kernel.js\";import s from\"../request.js\";import i from\"../core/Error.js\";import n from\"../core/Evented.js\";import{on as o}from\"../core/events.js\";import{fixJson as a}from\"../core/lang.js\";import{getDeepValue as h}from\"../core/object.js\";import{createResolver as l,onAbort as c,isAborted as d}from\"../core/promiseUtils.js\";import{Url as u,urlToObject as p,hasSameOrigin as _,queryToObject as f,base64UrlEncode as g,objectToQuery as m,normalize as v,getProxyRule as S,makeAbsolute as w,addQueryParameters as I}from\"../core/urlUtils.js\";import{property as A}from\"../core/accessorSupport/decorators/property.js\";import\"../core/accessorSupport/ensureType.js\";import{subclass as k}from\"../core/accessorSupport/decorators/subclass.js\";import y from\"./IdentityForm.js\";import U from\"./IdentityModal.js\";import T from\"./OAuthCredential.js\";import x from\"./OAuthInfo.js\";import O from\"./ServerInfo.js\";const P={},R=e=>{const t=new u(e.owningSystemUrl).host,r=new u(e.server).host,s=/.+\\.arcgis\\.com$/i;return s.test(t)&&s.test(r)},C=(e,t)=>!!(R(e)&&t&&t.some((t=>t.test(e.server))));let b=null,D=null;try{b=window.localStorage,D=window.sessionStorage}catch{}class q extends n{constructor(){super(),this._portalConfig=globalThis.esriGeowConfig,this.serverInfos=[],this.oAuthInfos=[],this.credentials=[],this._soReqs=[],this._xoReqs=[],this._portals=[],this.defaultOAuthInfo=null,this.defaultTokenValidity=60,this.dialog=null,this.formConstructor=y,this.tokenValidity=null,this.normalizeWebTierAuth=!1,this._appOrigin=\"null\"!==window.origin?window.origin:window.location.origin,this._appUrlObj=p(window.location.href),this._busy=null,this._rejectOnPersistedPageShow=!1,this._oAuthLocationParams=null,this._gwTokenUrl=\"/sharing/rest/generateToken\",this._agsRest=\"/rest/services\",this._agsPortal=/\\/sharing(\\/|$)/i,this._agsAdmin=/(https?:\\/\\/[^\\/]+\\/[^\\/]+)\\/admin\\/?(\\/.*)?$/i,this._adminSvcs=/\\/rest\\/admin\\/services(\\/|$)/i,this._gwDomains=[{regex:/^https?:\\/\\/www\\.arcgis\\.com/i,customBaseUrl:\"maps.arcgis.com\",tokenServiceUrl:\"https://www.arcgis.com/sharing/rest/generateToken\"},{regex:/^https?:\\/\\/(?:dev|[a-z\\d-]+\\.mapsdev)\\.arcgis\\.com/i,customBaseUrl:\"mapsdev.arcgis.com\",tokenServiceUrl:\"https://dev.arcgis.com/sharing/rest/generateToken\"},{regex:/^https?:\\/\\/(?:devext|[a-z\\d-]+\\.mapsdevext)\\.arcgis\\.com/i,customBaseUrl:\"mapsdevext.arcgis.com\",tokenServiceUrl:\"https://devext.arcgis.com/sharing/rest/generateToken\"},{regex:/^https?:\\/\\/(?:qaext|[a-z\\d-]+\\.mapsqa)\\.arcgis\\.com/i,customBaseUrl:\"mapsqa.arcgis.com\",tokenServiceUrl:\"https://qaext.arcgis.com/sharing/rest/generateToken\"},{regex:/^https?:\\/\\/[a-z\\d-]+\\.maps\\.arcgis\\.com/i,customBaseUrl:\"maps.arcgis.com\",tokenServiceUrl:\"https://www.arcgis.com/sharing/rest/generateToken\"}],this._legacyFed=[],this._regexSDirUrl=/http.+\\/rest\\/services\\/?/gi,this._regexServerType=/(\\/(FeatureServer|GPServer|GeoDataServer|GeocodeServer|GeoenrichmentServer|GeometryServer|GlobeServer|ImageServer|MapServer|MobileServer|NAServer|NetworkDiagramServer|OGCFeatureServer|ParcelFabricServer|RelationalCatalogServer|SceneServer|StreamServer|UtilityNetworkServer|ValidationServer|VectorTileServer|VersionManagementServer)).*/gi,this._gwUser=/http.+\\/users\\/([^\\/]+)\\/?.*/i,this._gwItem=/http.+\\/items\\/([^\\/]+)\\/?.*/i,this._gwGroup=/http.+\\/groups\\/([^\\/]+)\\/?.*/i,this._rePortalTokenSvc=/\\/sharing(\\/rest)?\\/generatetoken/i,this._createDefaultOAuthInfo=!0,this._hasTestedIfAppIsOnPortal=!1,this._getOAuthLocationParams(),window.addEventListener(\"pageshow\",(e=>{this._pageShowHandler(e)}))}registerServers(e){const t=this.serverInfos;t?(e=e.filter((e=>!this.findServerInfo(e.server))),this.serverInfos=t.concat(e)):this.serverInfos=e,e.forEach((e=>{e.owningSystemUrl&&this._portals.push(e.owningSystemUrl),e.hasPortal&&this._portals.push(e.server)}))}registerOAuthInfos(e){const t=this.oAuthInfos;if(t){for(const r of e){const e=this.findOAuthInfo(r.portalUrl);e&&t.splice(t.indexOf(e),1)}this.oAuthInfos=t.concat(e)}else this.oAuthInfos=e}registerToken(e){e={...e};const t=this._sanitizeUrl(e.server),r=this._isServerRsrc(t);let s,i=this.findServerInfo(t),n=!0;i||(i=new O,i.server=this._getServerInstanceRoot(t),r?i.hasServer=!0:(i.tokenServiceUrl=this._getTokenSvcUrl(t),i.hasPortal=!0),this.registerServers([i])),s=this._findCredential(t),s?(delete e.server,Object.assign(s,e),n=!1):(s=new j({userId:e.userId,server:i.server,token:e.token,expires:e.expires,ssl:e.ssl,scope:r?\"server\":\"portal\"}),s.resources=[t],this.credentials.push(s)),s.emitTokenChange(!1),n||s.refreshServerTokens()}toJSON(){return a({serverInfos:this.serverInfos.map((e=>e.toJSON())),oAuthInfos:this.oAuthInfos.map((e=>e.toJSON())),credentials:this.credentials.map((e=>e.toJSON()))})}initialize(e){if(!e)return;\"string\"==typeof e&&(e=JSON.parse(e));const t=e.serverInfos,r=e.oAuthInfos,s=e.credentials;if(t){const e=[];t.forEach((t=>{t.server&&t.tokenServiceUrl&&e.push(t.declaredClass?t:new O(t))})),e.length&&this.registerServers(e)}if(r){const e=[];r.forEach((t=>{t.appId&&e.push(t.declaredClass?t:new x(t))})),e.length&&this.registerOAuthInfos(e)}s&&s.forEach((e=>{e.server&&e.token&&e.expires&&e.expires>Date.now()&&((e=e.declaredClass?e:new j(e)).emitTokenChange(),this.credentials.push(e))}))}findServerInfo(e){let t;e=this._sanitizeUrl(e);for(const r of this.serverInfos)if(this._hasSameServerInstance(r.server,e)){t=r;break}return t}findOAuthInfo(e){let t;e=this._sanitizeUrl(e);for(const r of this.oAuthInfos)if(this._hasSameServerInstance(r.portalUrl,e)){t=r;break}return t}findCredential(e,t){let r;e=this._sanitizeUrl(e);const s=this._isServerRsrc(e)?\"server\":\"portal\";if(t){for(const i of this.credentials)if(this._hasSameServerInstance(i.server,e)&&t===i.userId&&i.scope===s){r=i;break}}else for(const i of this.credentials)if(this._hasSameServerInstance(i.server,e)&&-1!==this._getIdenticalSvcIdx(e,i)&&i.scope===s){r=i;break}return r}getCredential(e,t){let r,s,n=!0;t&&(r=!!t.token,s=t.error,n=!1!==t.prompt),t={...t},e=this._sanitizeUrl(e);const o=new AbortController,a=l();if(t.signal&&c(t.signal,(()=>{o.abort()})),c(o,(()=>{a.reject(new i(\"identity-manager:user-aborted\",\"ABORTED\"))})),d(o))return a.promise;t.signal=o.signal;const h=this._isAdminResource(e),u=r?this.findCredential(e):null;let p;if(u&&s&&s.details&&498===s.details.httpStatus)u.destroy();else if(u)return p=new i(\"identity-manager:not-authorized\",\"You are currently signed in as: '\"+u.userId+\"'. You do not have access to this resource: \"+e,{error:s}),a.reject(p),a.promise;const f=this._findCredential(e,t);if(f)return a.resolve(f),a.promise;let g=this.findServerInfo(e);if(g)!g.hasServer&&this._isServerRsrc(e)&&(g._restInfoPms=this._getTokenSvcUrl(e),g.hasServer=!0);else{const t=this._getTokenSvcUrl(e);if(!t)return p=new i(\"identity-manager:unknown-resource\",\"Unknown resource - could not find token service endpoint.\"),a.reject(p),a.promise;g=new O,g.server=this._getServerInstanceRoot(e),\"string\"==typeof t?(g.tokenServiceUrl=t,g.hasPortal=!0):(g._restInfoPms=t,g.hasServer=!0),this.registerServers([g])}return g.hasPortal&&void 0===g._selfReq&&(n||_(g.tokenServiceUrl,this._appOrigin)||this._gwDomains.some((e=>e.tokenServiceUrl===g.tokenServiceUrl)))&&(g._selfReq={owningTenant:t&&t.owningTenant,selfDfd:this._getPortalSelf(g.tokenServiceUrl.replace(this._rePortalTokenSvc,\"/sharing/rest/portals/self\"),e)}),this._enqueue(e,g,t,a,h)}getResourceName(e){return this._isRESTService(e)?e.replace(this._regexSDirUrl,\"\").replace(this._regexServerType,\"\")||\"\":this._gwUser.test(e)&&e.replace(this._gwUser,\"$1\")||this._gwItem.test(e)&&e.replace(this._gwItem,\"$1\")||this._gwGroup.test(e)&&e.replace(this._gwGroup,\"$1\")||\"\"}generateToken(e,t,r){const n=this._rePortalTokenSvc.test(e.tokenServiceUrl),o=new u(this._appOrigin),a=e.shortLivedTokenValidity;let h,l,c,d,p,f,g,m;t&&(m=this.tokenValidity||a||this.defaultTokenValidity,m>a&&a>0&&(m=a)),r&&(h=r.isAdmin,l=r.serverUrl,c=r.token,f=r.signal,g=r.ssl,e.customParameters=r.customParameters),h?d=e.adminTokenServiceUrl:(d=e.tokenServiceUrl,p=new u(d.toLowerCase()),e.webTierAuth&&null!=r&&r.serverUrl&&!g&&\"http\"===o.scheme&&(_(o.uri,d,!0)||\"https\"===p.scheme&&o.host===p.host&&\"7080\"===o.port&&\"7443\"===p.port)&&(d=d.replace(/^https:/i,\"http:\").replace(/:7443/i,\":7080\")));const v={query:{request:\"getToken\",username:null==t?void 0:t.username,password:null==t?void 0:t.password,serverUrl:l,token:c,expiration:m,referer:h||n?this._appOrigin:null,client:h?\"referer\":null,f:\"json\",...e.customParameters},method:\"post\",authMode:\"anonymous\",useProxy:this._useProxy(e,r),signal:f,...null==r?void 0:r.ioArgs};n||(v.withCredentials=!1);return s(d,v).then((r=>{const s=r.data;if(!s||!s.token)return new i(\"identity-manager:authentication-failed\",\"Unable to generate token\");const n=e.server;return P[n]||(P[n]={}),t&&(P[n][t.username]=t.password),s.validity=m,s}))}isBusy(){return!!this._busy}checkSignInStatus(e){return this.checkAppAccess(e,\"\").then((e=>e.credential))}checkAppAccess(e,t,r){let n=!1;return this.getCredential(e,{prompt:!1}).then((o=>{let a;const h={f:\"json\"};if(\"portal\"===o.scope)if(t&&(this._doPortalSignIn(e)||r&&r.force))a=o.server+\"/sharing/rest/oauth2/validateAppAccess\",h.client_id=t;else{if(!o.token)return{credential:o};a=o.server+\"/sharing/rest\"}else{if(!o.token)return{credential:o};a=o.server+\"/rest/services\"}return o.token&&(h.token=o.token),s(a,{query:h,authMode:\"anonymous\"}).then((e=>{if(!1===e.data.valid)throw new i(\"identity-manager:not-authorized\",`You are currently signed in as: '${o.userId}'.`,e.data);return n=!!e.data.viewOnlyUserTypeApp,{credential:o}})).catch((e=>{if(\"identity-manager:not-authorized\"===e.name)throw e;const t=e.details&&e.details.httpStatus;if(498===t)throw o.destroy(),new i(\"identity-manager:not-authenticated\",\"User is not signed in.\");if(400===t)throw new i(\"identity-manager:invalid-request\");return{credential:o}}))})).then((e=>({credential:e.credential,viewOnly:n})))}setOAuthResponseHash(e){e&&(\"#\"===e.charAt(0)&&(e=e.substring(1)),this._processOAuthPopupParams(f(e)))}setOAuthRedirectionHandler(e){this._oAuthRedirectFunc=e}setProtocolErrorHandler(e){this._protocolFunc=e}signIn(e,t,r={}){const s=l(),n=()=>{var e,t,r,s,i;null==(e=h)||e.remove(),null==(t=d)||t.remove(),null==(r=u)||r.remove(),null==(s=a)||s.destroy(),null==(i=this.dialog)||i.destroy(),this.dialog=a=h=d=u=null},o=()=>{n(),this._oAuthDfd=null,s.reject(new i(\"identity-manager:user-aborted\",\"ABORTED\"))};r.signal&&c(r.signal,(()=>{o()}));let a=new this.formConstructor;a.resource=this.getResourceName(e),a.server=t.server,this.dialog=new U,this.dialog.content=a,this.dialog.open=!0,this.emit(\"dialog-create\");let h=a.on(\"cancel\",o),d=this.dialog.watch(\"open\",o),u=a.on(\"submit\",(e=>{this.generateToken(t,e,{isAdmin:r.isAdmin,signal:r.signal}).then((i=>{n();const o=new j({userId:e.username,server:t.server,token:i.token,expires:null!=i.expires?Number(i.expires):null,ssl:!!i.ssl,isAdmin:r.isAdmin,validity:i.validity});s.resolve(o)})).catch((e=>{a.error=e,a.signingIn=!1}))}));return s.promise}oAuthSignIn(e,t,r,s){this._oAuthDfd=l();const n=this._oAuthDfd;let o;null!=s&&s.signal&&c(s.signal,(()=>{const e=this._oAuthDfd&&this._oAuthDfd.oAuthWin_;e&&!e.closed?e.close():this.dialog&&_()})),n.resUrl_=e,n.sinfo_=t,n.oinfo_=r;const a=r._oAuthCred;if(a.storage&&(\"authorization-code\"===r.flowType||\"auto\"===r.flowType&&!r.popup&&t.currentVersion>=8.4)){let e=crypto.getRandomValues(new Uint8Array(32));o=g(e),a.codeVerifier=o,e=crypto.getRandomValues(new Uint8Array(32)),a.stateUID=g(e),a.save()||(a.codeVerifier=o=null)}else a.codeVerifier=null;let h,d,u,p;this._getCodeChallenge(o).then((i=>{const n=!s||!1!==s.oAuthPopupConfirmation;r.popup&&n?(h=new this.formConstructor,h.oAuthPrompt=!0,h.server=t.server,this.dialog=new U,this.dialog.content=h,this.dialog.open=!0,this.emit(\"dialog-create\"),d=h.on(\"cancel\",_),u=this.dialog.watch(\"open\",_),p=h.on(\"submit\",(()=>{f(),this._doOAuthSignIn(e,t,r,i)}))):this._doOAuthSignIn(e,t,r,i)}));const _=()=>{f(),this._oAuthDfd=null,n.reject(new i(\"identity-manager:user-aborted\",\"ABORTED\"))},f=()=>{var e,t,r,s,i;null==(e=d)||e.remove(),null==(t=u)||t.remove(),null==(r=p)||r.remove(),null==(s=h)||s.destroy(),null==(i=this.dialog)||i.destroy(),this.dialog=null};return n.promise}destroyCredentials(){if(this.credentials){this.credentials.slice().forEach((e=>{e.destroy()}))}this.emit(\"credentials-destroy\")}enablePostMessageAuth(e=\"https://www.arcgis.com/sharing/rest\"){this._postMessageAuthHandle&&this._postMessageAuthHandle.remove(),this._postMessageAuthHandle=o(window,\"message\",(t=>{var r;if((t.origin===this._appOrigin||t.origin.endsWith(\".arcgis.com\"))&&\"arcgis:auth:requestCredential\"===(null==(r=t.data)?void 0:r.type)){const r=t.source;this.getCredential(e).then((e=>{r.postMessage({type:\"arcgis:auth:credential\",credential:{expires:e.expires,server:e.server,ssl:e.ssl,token:e.token,userId:e.userId}},t.origin)})).catch((e=>{r.postMessage({type:\"arcgis:auth:error\",error:{name:e.name,message:e.message}},t.origin)}))}}))}disablePostMessageAuth(){this._postMessageAuthHandle&&(this._postMessageAuthHandle.remove(),this._postMessageAuthHandle=null)}_getOAuthLocationParams(){let e=window.location.hash;if(e){\"#\"===e.charAt(0)&&(e=e.substring(1));const r=f(e);let s=!1;if(r.access_token&&r.expires_in&&r.state&&r.hasOwnProperty(\"username\"))try{r.state=JSON.parse(r.state),r.state.portalUrl&&(this._oAuthLocationParams=r,s=!0)}catch{}else if(r.error&&r.error_description&&(console.log(\"IdentityManager OAuth Error: \",r.error,\" - \",r.error_description),\"access_denied\"===r.error&&(s=!0,r.state)))try{r.state=JSON.parse(r.state)}catch{}var t;if(s)window.location.hash=(null==(t=r.state)?void 0:t.hash)||\"\"}let r=window.location.search;if(r){\"?\"===r.charAt(0)&&(r=r.substring(1));const e=f(r);let t=!1;if(e.code&&e.state)try{e.state=JSON.parse(e.state),e.state.portalUrl&&e.state.uid&&(this._oAuthLocationParams=e,t=!0)}catch{}else if(e.error&&e.error_description&&(console.log(\"IdentityManager OAuth Error: \",e.error,\" - \",e.error_description),\"access_denied\"===e.error&&(t=!0,e.state)))try{e.state=JSON.parse(e.state)}catch{}if(t){var s;const t={...e};[\"code\",\"error\",\"error_description\",\"message_code\",\"persist\",\"state\"].forEach((e=>{delete t[e]}));const r=m(t),i=window.location.pathname+(r?`?${r}`:\"\")+((null==(s=e.state)?void 0:s.hash)||\"\");window.history.replaceState(window.history.state,\"\",i)}}}_getOAuthToken(e,t,r,i,n){return e=e.replace(/^http:/i,\"https:\"),s(`${e}/sharing/rest/oauth2/token`,{authMode:\"anonymous\",method:\"post\",query:i&&n?{grant_type:\"authorization_code\",code:t,redirect_uri:i,client_id:r,code_verifier:n}:{grant_type:\"refresh_token\",refresh_token:t,client_id:r}}).then((e=>e.data))}_getCodeChallenge(e){if(e&&globalThis.isSecureContext){const t=(new TextEncoder).encode(e);return crypto.subtle.digest(\"SHA-256\",t).then((e=>g(new Uint8Array(e))))}return Promise.resolve(null)}_pageShowHandler(e){if(e.persisted&&this.isBusy()&&this._rejectOnPersistedPageShow){const e=new i(\"identity-manager:user-aborted\",\"ABORTED\");this._errbackFunc(e)}}_findCredential(e,t){let r,s,i,n,o=-1;const a=t&&t.token,h=t&&t.resource,l=this._isServerRsrc(e)?\"server\":\"portal\",c=this.credentials.filter((t=>this._hasSameServerInstance(t.server,e)&&t.scope===l));if(e=h||e,c.length)if(1===c.length){if(r=c[0],n=this.findServerInfo(r.server),s=n&&n.owningSystemUrl,i=s&&this.findCredential(s,r.userId),o=this._getIdenticalSvcIdx(e,r),!a)return-1===o&&r.resources.push(e),this._addResource(e,i),r;-1!==o&&(r.resources.splice(o,1),this._removeResource(e,i))}else{let t,r;if(c.some((a=>(r=this._getIdenticalSvcIdx(e,a),-1!==r&&(t=a,n=this.findServerInfo(t.server),s=n&&n.owningSystemUrl,i=s&&this.findCredential(s,t.userId),o=r,!0)))),a)t&&(t.resources.splice(o,1),this._removeResource(e,i));else if(t)return this._addResource(e,i),t}}_findOAuthInfo(e){let t=this.findOAuthInfo(e);if(!t)for(const r of this.oAuthInfos)if(this._isIdProvider(r.portalUrl,e)){t=r;break}return t}_addResource(e,t){t&&-1===this._getIdenticalSvcIdx(e,t)&&t.resources.push(e)}_removeResource(e,t){let r=-1;t&&(r=this._getIdenticalSvcIdx(e,t),r>-1&&t.resources.splice(r,1))}_useProxy(e,t){return t&&t.isAdmin&&!_(e.adminTokenServiceUrl,this._appOrigin)||!this._isPortalDomain(e.tokenServiceUrl)&&\"10.1\"===String(e.currentVersion)&&!_(e.tokenServiceUrl,this._appOrigin)}_getOrigin(e){const t=new u(e);return t.scheme+\"://\"+t.host+(null!=t.port?\":\"+t.port:\"\")}_getServerInstanceRoot(e){const t=e.toLowerCase();let r=t.indexOf(this._agsRest);return-1===r&&this._isAdminResource(e)&&(r=this._agsAdmin.test(e)?e.replace(this._agsAdmin,\"$1\").length:e.search(this._adminSvcs)),-1===r&&(r=t.indexOf(\"/sharing\")),-1===r&&\"/\"===t.substr(-1)&&(r=t.length-1),r>-1?e.substring(0,r):e}_hasSameServerInstance(e,t){return\"/\"===e.substr(-1)&&(e=e.slice(0,-1)),e=e.toLowerCase(),t=this._getServerInstanceRoot(t).toLowerCase(),e=this._normalizeAGOLorgDomain(e),t=this._normalizeAGOLorgDomain(t),(e=e.substr(e.indexOf(\":\")))===(t=t.substr(t.indexOf(\":\")))}_normalizeAGOLorgDomain(e){const t=/^https?:\\/\\/(?:cdn|[a-z\\d-]+\\.maps)\\.arcgis\\.com/i,r=/^https?:\\/\\/(?:cdndev|[a-z\\d-]+\\.mapsdevext)\\.arcgis\\.com/i,s=/^https?:\\/\\/(?:cdnqa|[a-z\\d-]+\\.mapsqa)\\.arcgis\\.com/i;return t.test(e)?e=e.replace(t,\"https://www.arcgis.com\"):r.test(e)?e=e.replace(r,\"https://devext.arcgis.com\"):s.test(e)&&(e=e.replace(s,\"https://qaext.arcgis.com\")),e}_sanitizeUrl(e){const r=(t.request.proxyUrl||\"\").toLowerCase(),s=r?e.toLowerCase().indexOf(r+\"?\"):-1;return-1!==s&&(e=e.substring(s+r.length+1)),e=v(e),p(e).path}_isRESTService(e){return e.indexOf(this._agsRest)>-1}_isAdminResource(e){return this._agsAdmin.test(e)||this._adminSvcs.test(e)}_isServerRsrc(e){return this._isRESTService(e)||this._isAdminResource(e)}_isIdenticalService(e,t){let r;if(this._isRESTService(e)&&this._isRESTService(t)){const s=this._getSuffix(e).toLowerCase(),i=this._getSuffix(t).toLowerCase();if(r=s===i,!r){const e=/(.*)\\/(MapServer|FeatureServer|UtilityNetworkServer).*/gi;r=s.replace(e,\"$1\")===i.replace(e,\"$1\")}}else this._isAdminResource(e)&&this._isAdminResource(t)?r=!0:this._isServerRsrc(e)||this._isServerRsrc(t)||!this._isPortalDomain(e)||(r=!0);return r}_isPortalDomain(e){const r=new u(e.toLowerCase()),s=this._portalConfig;let i=this._gwDomains.some((e=>e.regex.test(r.uri)));return!i&&s&&(i=this._hasSameServerInstance(this._getServerInstanceRoot(s.restBaseUrl),r.uri)),i||t.portalUrl&&(i=_(r,t.portalUrl,!0)),i||(i=this._portals.some((e=>this._hasSameServerInstance(e,r.uri)))),i=i||this._agsPortal.test(r.path),i}_isIdProvider(e,t){let r=-1,s=-1;this._gwDomains.forEach(((i,n)=>{-1===r&&i.regex.test(e)&&(r=n),-1===s&&i.regex.test(t)&&(s=n)}));let i=!1;if(r>-1&&s>-1&&(0===r||4===r?0!==s&&4!==s||(i=!0):1===r?1!==s&&2!==s||(i=!0):2===r?2===s&&(i=!0):3===r&&3===s&&(i=!0)),!i){const r=this.findServerInfo(t),s=r&&r.owningSystemUrl;s&&R(r)&&this._isPortalDomain(s)&&this._isIdProvider(e,s)&&(i=!0)}return i}_getIdenticalSvcIdx(e,t){let r=-1;for(let s=0;s<t.resources.length;s++){const i=t.resources[s];if(this._isIdenticalService(e,i)){r=s;break}}return r}_getSuffix(e){return e.replace(this._regexSDirUrl,\"\").replace(this._regexServerType,\"$1\")}_getTokenSvcUrl(e){let t,r,i;if(this._isRESTService(e)||this._isAdminResource(e)){const i=this._getServerInstanceRoot(e);return t=i+\"/admin/generateToken\",r=s(e=i+\"/rest/info\",{query:{f:\"json\"}}).then((e=>e.data)),{adminUrl:t,promise:r}}if(this._isPortalDomain(e)){let t=\"\";if(this._gwDomains.some((r=>(r.regex.test(e)&&(t=r.tokenServiceUrl),!!t))),t||this._portals.some((r=>(this._hasSameServerInstance(r,e)&&(t=r+this._gwTokenUrl),!!t))),t||(i=e.toLowerCase().indexOf(\"/sharing\"),-1!==i&&(t=e.substring(0,i)+this._gwTokenUrl)),t||(t=this._getOrigin(e)+this._gwTokenUrl),t){const r=new u(e).port;/^http:\\/\\//i.test(e)&&\"7080\"===r&&(t=t.replace(/:7080/i,\":7443\")),t=t.replace(/http:/i,\"https:\")}return t}if(-1!==e.toLowerCase().indexOf(\"premium.arcgisonline.com\"))return\"https://premium.arcgisonline.com/server/tokens\"}_processOAuthResponseParams(e,t,r){const s=t._oAuthCred;if(e.code){const i=s.codeVerifier;return s.codeVerifier=null,s.stateUID=null,s.save(),this._getOAuthToken(r.server,e.code,t.appId,this._getRedirectURI(t,!0),i).then((i=>{const n=new j({userId:i.username,server:r.server,token:i.access_token,expires:Date.now()+1e3*i.expires_in,ssl:i.ssl,oAuthState:e.state,_oAuthCred:s});return t.userId=n.userId,s.storage=i.persist?b:D,s.refreshToken=i.refresh_token,s.token=null,s.expires=i.refresh_token_expires_in?Date.now()+1e3*i.refresh_token_expires_in:null,s.userId=n.userId,s.ssl=n.ssl,s.save(),n}))}const i=new j({userId:e.username,server:r.server,token:e.access_token,expires:Date.now()+1e3*Number(e.expires_in),ssl:\"true\"===e.ssl,oAuthState:e.state,_oAuthCred:s});return t.userId=i.userId,s.storage=e.persist?b:D,s.refreshToken=null,s.token=i.token,s.expires=i.expires,s.userId=i.userId,s.ssl=i.ssl,s.save(),Promise.resolve(i)}_processOAuthPopupParams(e){var t;const r=this._oAuthDfd;if(this._oAuthDfd=null,r)if(clearInterval(this._oAuthIntervalId),null==(t=this._oAuthOnPopupHandle)||t.remove(),e.error){const t=\"access_denied\"===e.error,s=new i(t?\"identity-manager:user-aborted\":\"identity-manager:authentication-failed\",t?\"ABORTED\":\"OAuth: \"+e.error+\" - \"+e.error_description);r.reject(s)}else this._processOAuthResponseParams(e,r.oinfo_,r.sinfo_).then((e=>{r.resolve(e)})).catch((e=>{r.reject(e)}))}_setOAuthResponseQueryString(e){e&&(\"?\"===e.charAt(0)&&(e=e.substring(1)),this._processOAuthPopupParams(f(e)))}_exchangeToken(e,t,r){return s(`${e}/sharing/rest/oauth2/exchangeToken`,{authMode:\"anonymous\",method:\"post\",query:{f:\"json\",client_id:t,token:r}}).then((e=>e.data.token))}_getPlatformSelf(e,t){return e=e.replace(/^http:/i,\"https:\"),s(`${e}/sharing/rest/oauth2/platformSelf`,{authMode:\"anonymous\",headers:{\"X-Esri-Auth-Client-Id\":t,\"X-Esri-Auth-Redirect-Uri\":window.location.href.replace(/#.*$/,\"\")},method:\"post\",query:{f:\"json\",expiration:30},withCredentials:!0}).then((e=>e.data))}_getPortalSelf(e,t){let r;if(this._gwDomains.some((t=>(t.regex.test(e)&&(r=t.customBaseUrl),!!r))),r)return Promise.resolve({allSSL:!0,currentVersion:\"8.4\",customBaseUrl:r,portalMode:\"multitenant\",supportsOAuth:!0});this._appOrigin.startsWith(\"https:\")?e=e.replace(/^http:/i,\"https:\").replace(/:7080/i,\":7443\"):/^http:/i.test(t)&&(e=e.replace(/^https:/i,\"http:\").replace(/:7443/i,\":7080\"));return s(e,{query:{f:\"json\"},authMode:\"anonymous\",withCredentials:!0}).then((e=>e.data))}_doPortalSignIn(e){const t=this._portalConfig,r=window.location.href,s=this.findServerInfo(e);return!(!t&&!this._isPortalDomain(r)||!(s?s.hasPortal||s.owningSystemUrl&&this._isPortalDomain(s.owningSystemUrl):this._isPortalDomain(e))||!(this._isIdProvider(r,e)||t&&(this._hasSameServerInstance(this._getServerInstanceRoot(t.restBaseUrl),e)||this._isIdProvider(t.restBaseUrl,e))||_(r,e,!0)))}_checkProtocol(e,t,r,s){let n=!0;const o=s?t.adminTokenServiceUrl:t.tokenServiceUrl;if(o.trim().toLowerCase().startsWith(\"https:\")&&!this._appOrigin.startsWith(\"https:\")&&S(o)&&(n=!!this._protocolFunc&&!!this._protocolFunc({resourceUrl:e,serverInfo:t}),!n)){r(new i(\"identity-manager:aborted\",\"Aborted the Sign-In process to avoid sending password over insecure connection.\"))}return n}_enqueue(e,t,r,s,i,n){return s||(s=l()),s.resUrl_=e,s.sinfo_=t,s.options_=r,s.admin_=i,s.refresh_=n,this._busy?this._hasSameServerInstance(this._getServerInstanceRoot(e),this._busy.resUrl_)?(this._oAuthDfd&&this._oAuthDfd.oAuthWin_&&this._oAuthDfd.oAuthWin_.focus(),this._soReqs.push(s)):this._xoReqs.push(s):this._doSignIn(s),s.promise}_doSignIn(e){this._busy=e,this._rejectOnPersistedPageShow=!1;const t=t=>{const r=e.options_&&e.options_.resource,s=e.resUrl_,i=e.refresh_;let n=!1;-1===this.credentials.indexOf(t)&&(i&&-1!==this.credentials.indexOf(i)?(i.userId=t.userId,i.token=t.token,i.expires=t.expires,i.validity=t.validity,i.ssl=t.ssl,i.creationTime=t.creationTime,n=!0,t=i):this.credentials.push(t)),t.resources||(t.resources=[]),t.resources.includes(r||s)||t.resources.push(r||s),t.scope=this._isServerRsrc(s)?\"server\":\"portal\",t.emitTokenChange();const o=this._soReqs,a={};this._soReqs=[],o.forEach((e=>{if(!this._isIdenticalService(s,e.resUrl_)){const r=this._getSuffix(e.resUrl_);a[r]||(a[r]=!0,t.resources.push(e.resUrl_))}})),e.resolve(t),o.forEach((e=>{this._hasSameServerInstance(this._getServerInstanceRoot(s),e.resUrl_)?e.resolve(t):this._soReqs.push(e)})),this._busy=e.resUrl_=e.sinfo_=e.refresh_=null,n||this.emit(\"credential-create\",{credential:t}),this._soReqs.length?this._doSignIn(this._soReqs.shift()):this._xoReqs.length&&this._doSignIn(this._xoReqs.shift())},r=t=>{e.reject(t),this._busy=e.resUrl_=e.sinfo_=e.refresh_=null,this._soReqs.length?this._doSignIn(this._soReqs.shift()):this._xoReqs.length&&this._doSignIn(this._xoReqs.shift())},s=(n,a,h,l)=>{var d,u;const p=e.sinfo_,f=!e.options_||!1!==e.options_.prompt,g=p.hasPortal&&this._findOAuthInfo(e.resUrl_);let m,v;if(n)t(new j({userId:n,server:p.server,token:h||null,expires:null!=l?Number(l):null,ssl:!!a}));else if(window!==window.parent&&null!=(d=this._appUrlObj.query)&&d[\"arcgis-auth-origin\"]&&null!=(u=this._appUrlObj.query)&&u[\"arcgis-auth-portal\"]&&this._hasSameServerInstance(this._getServerInstanceRoot(this._appUrlObj.query[\"arcgis-auth-portal\"]),e.resUrl_)){var S;window.parent.postMessage({type:\"arcgis:auth:requestCredential\"},this._appUrlObj.query[\"arcgis-auth-origin\"]);const s=o(window,\"message\",(e=>{e.source===window.parent&&e.data&&(\"arcgis:auth:credential\"===e.data.type?(s.remove(),e.data.credential.expires<Date.now()?r(new i(\"identity-manager:credential-request-failed\",\"Parent application's token has expired.\")):t(new j(e.data.credential))):\"arcgis:auth:error\"===e.data.type&&(s.remove(),\"tokenExpiredError\"===e.data.error.name?r(new i(\"identity-manager:credential-request-failed\",\"Parent application's token has expired.\")):r(i.fromJSON(e.data.error))))}));c(null==(S=e.options_)?void 0:S.signal,(()=>{s.remove()}))}else if(g){let n=g._oAuthCred;if(!n){const e=new T(g,b),t=new T(g,D);e.isValid()&&t.isValid()?e.expires>t.expires?(n=e,t.destroy()):(n=t,e.destroy()):n=e.isValid()?e:t,g._oAuthCred=n}if(n.isValid()){m=new j({userId:n.userId,server:p.server,token:n.token,expires:n.expires,ssl:n.ssl,_oAuthCred:n});const r=g.appId!==n.appId&&this._doPortalSignIn(e.resUrl_);r||n.refreshToken?(e._pendingDfd=n.refreshToken?this._getOAuthToken(p.server,n.refreshToken,n.appId).then((e=>(m.expires=Date.now()+1e3*e.expires_in,m.token=e.access_token,m))):Promise.resolve(m),e._pendingDfd.then((e=>r?this._exchangeToken(e.server,g.appId,e.token).then((t=>(e.token=t,e))).catch((()=>e)):e)).then((e=>{t(e)})).catch((()=>{n.destroy(),s()}))):t(m)}else if(this._oAuthLocationParams&&this._hasSameServerInstance(g.portalUrl,this._oAuthLocationParams.state.portalUrl)&&(this._oAuthLocationParams.access_token||this._oAuthLocationParams.code&&this._oAuthLocationParams.state.uid===n.stateUID&&n.codeVerifier)){const s=this._oAuthLocationParams;this._oAuthLocationParams=null,e._pendingDfd=this._processOAuthResponseParams(s,g,p).then((e=>{t(e)})).catch(r)}else{const s=()=>{f?e._pendingDfd=this.oAuthSignIn(e.resUrl_,p,g,e.options_).then(t,r):(v=new i(\"identity-manager:not-authenticated\",\"User is not signed in.\"),r(v))};this._doPortalSignIn(e.resUrl_)?e._pendingDfd=this._getPlatformSelf(p.server,g.appId).then((e=>{_(e.portalUrl,this._appOrigin,!0)?(m=new j({userId:e.username,server:p.server,expires:Date.now()+1e3*e.expires_in,token:e.token}),t(m)):s()})).catch(s):s()}}else if(f){if(this._checkProtocol(e.resUrl_,p,r,e.admin_)){let s=e.options_;e.admin_&&(s=s||{},s.isAdmin=!0),e._pendingDfd=this.signIn(e.resUrl_,p,s).then(t,r)}}else v=new i(\"identity-manager:not-authenticated\",\"User is not signed in.\"),r(v)},n=()=>{const s=e.sinfo_,i=s.owningSystemUrl,n=e.options_;let o,a,h,l;if(n&&(o=n.token,a=n.error,h=n.prompt),l=this._findCredential(i,{token:o,resource:e.resUrl_}),!l)for(const e of this.credentials)if(this._isIdProvider(i,e.server)){l=e;break}if(l){const i=this.findCredential(e.resUrl_,l.userId);if(i)t(i);else if(C(s,this._legacyFed)){const e=l.toJSON();e.server=s.server,e.resources=null,t(new j(e))}else{(e._pendingDfd=this.generateToken(this.findServerInfo(l.server),null,{serverUrl:e.resUrl_,token:l.token,signal:e.options_.signal,ssl:l.ssl})).then((r=>{t(new j({userId:l.userId,server:s.server,token:r.token,expires:null!=r.expires?Number(r.expires):null,ssl:!!r.ssl,isAdmin:e.admin_,validity:r.validity}))}),r)}}else{this._busy=null,o&&(e.options_.token=null);(e._pendingDfd=this.getCredential(i.replace(/\\/?$/,\"/sharing\"),{resource:e.resUrl_,owningTenant:s.owningTenant,signal:e.options_.signal,token:o,error:a,prompt:h})).then((()=>{this._enqueue(e.resUrl_,e.sinfo_,e.options_,e,e.admin_)}),(t=>{e.resUrl_=e.sinfo_=e.refresh_=null,e.reject(t)}))}};this._errbackFunc=r;const a=e.sinfo_.owningSystemUrl,l=this._isServerRsrc(e.resUrl_),d=e.sinfo_._restInfoPms;d?d.promise.then((t=>{const r=e.sinfo_;if(r._restInfoPms){r.adminTokenServiceUrl=r._restInfoPms.adminUrl,r._restInfoPms=null,r.tokenServiceUrl=h(\"authInfo.tokenServicesUrl\",t)||h(\"authInfo.tokenServiceUrl\",t)||h(\"tokenServiceUrl\",t),r.shortLivedTokenValidity=h(\"authInfo.shortLivedTokenValidity\",t),r.currentVersion=t.currentVersion,r.owningTenant=t.owningTenant;const e=r.owningSystemUrl=t.owningSystemUrl;e&&this._portals.push(e)}l&&r.owningSystemUrl?n():s()}),(()=>{e.sinfo_._restInfoPms=null;const t=new i(\"identity-manager:server-identification-failed\",\"Unknown resource - could not find token service endpoint.\");r(t)})):l&&a?n():e.sinfo_._selfReq?e.sinfo_._selfReq.selfDfd.then((t=>{const r={};let s,i,n,o;return t&&(s=t.user&&t.user.username,r.username=s,r.allSSL=t.allSSL,i=t.supportsOAuth,n=parseFloat(t.currentVersion),\"multitenant\"===t.portalMode&&(o=t.customBaseUrl),e.sinfo_.currentVersion=n),e.sinfo_.webTierAuth=!!s,s&&this.normalizeWebTierAuth?this.generateToken(e.sinfo_,null,{ssl:r.allSSL}).catch((()=>null)).then((e=>(r.portalToken=e&&e.token,r.tokenExpiration=e&&e.expires,r))):!s&&i&&n>=4.4&&!this._findOAuthInfo(e.resUrl_)?this._generateOAuthInfo({portalUrl:e.sinfo_.server,customBaseUrl:o,owningTenant:e.sinfo_._selfReq.owningTenant}).catch((()=>null)).then((()=>r)):r})).catch((()=>null)).then((t=>{e.sinfo_._selfReq=null,t?s(t.username,t.allSSL,t.portalToken,t.tokenExpiration):s()})):s()}_generateOAuthInfo(e){let t,r,i=e.portalUrl;const n=e.customBaseUrl,o=e.owningTenant,a=!this.defaultOAuthInfo&&this._createDefaultOAuthInfo&&!this._hasTestedIfAppIsOnPortal;if(a){r=window.location.href;let e=r.indexOf(\"?\");e>-1&&(r=r.slice(0,e)),e=r.search(/\\/(apps|home)\\//),r=e>-1?r.slice(0,e):null}return a&&r?(this._hasTestedIfAppIsOnPortal=!0,t=s(r+\"/sharing/rest\",{query:{f:\"json\"}}).then((()=>{this.defaultOAuthInfo=new x({appId:\"arcgisonline\",popupCallbackUrl:r+\"/home/oauth-callback.html\"})}))):t=Promise.resolve(),t.then((()=>{if(this.defaultOAuthInfo)return i=i.replace(/^http:/i,\"https:\"),s(i+\"/sharing/rest/oauth2/validateRedirectUri\",{query:{accountId:o,client_id:this.defaultOAuthInfo.appId,redirect_uri:w(this.defaultOAuthInfo.popupCallbackUrl),f:\"json\"}}).then((e=>{if(e.data.valid){const t=this.defaultOAuthInfo.clone();e.data.urlKey&&n?t.portalUrl=\"https://\"+e.data.urlKey.toLowerCase()+\".\"+n:t.portalUrl=i,t.popup=window!==window.top||!(_(i,this._appOrigin)||this._gwDomains.some((e=>e.regex.test(i)&&e.regex.test(this._appOrigin)))),this.oAuthInfos.push(t)}}))}))}_doOAuthSignIn(e,t,r,s){const n=r._oAuthCred,a={portalUrl:r.portalUrl};!r.popup&&r.preserveUrlHash&&window.location.hash&&(a.hash=window.location.hash),n.stateUID&&(a.uid=n.stateUID);const h={client_id:r.appId,response_type:n.codeVerifier?\"code\":\"token\",state:JSON.stringify(a),expiration:r.expiration,locale:r.locale,redirect_uri:this._getRedirectURI(r,!!n.codeVerifier)};r.forceLogin&&(h.force_login=!0),r.forceUserId&&r.userId&&(h.prepopulatedusername=r.userId),!r.popup&&this._doPortalSignIn(e)&&(h.redirectToUserOrgUrl=!0),n.codeVerifier&&(h.code_challenge=s||n.codeVerifier,h.code_challenge_method=s?\"S256\":\"plain\");const l=r.portalUrl.replace(/^http:/i,\"https:\")+\"/sharing/oauth2/authorize\",c=l+\"?\"+m(h);if(r.popup){const e=window.open(c,\"esriJSAPIOAuth\",r.popupWindowFeatures);if(e)e.focus(),this._oAuthDfd.oAuthWin_=e,this._oAuthIntervalId=setInterval((()=>{if(e.closed){clearInterval(this._oAuthIntervalId),this._oAuthOnPopupHandle.remove();const e=this._oAuthDfd;if(e){const t=new i(\"identity-manager:user-aborted\",\"ABORTED\");e.reject(t)}}}),500),this._oAuthOnPopupHandle=o(window,[\"arcgis:auth:hash\",\"arcgis:auth:location:search\"],(e=>{\"arcgis:auth:hash\"===e.type?this.setOAuthResponseHash(e.detail):this._setOAuthResponseQueryString(e.detail)}));else{const e=new i(\"identity-manager:popup-blocked\",\"ABORTED\");this._oAuthDfd.reject(e)}}else this._rejectOnPersistedPageShow=!0,this._oAuthRedirectFunc?this._oAuthRedirectFunc({authorizeParams:h,authorizeUrl:l,resourceUrl:e,serverInfo:t,oAuthInfo:r}):window.location.href=c}_getRedirectURI(e,t){const r=window.location.href.replace(/#.*$/,\"\");if(e.popup)return w(e.popupCallbackUrl);if(t){const e=p(r);return e.query&&[\"code\",\"error\",\"error_description\",\"message_code\",\"persist\",\"state\"].forEach((t=>{delete e.query[t]})),I(e.path,e.query)}return r}}q.prototype.declaredClass=\"esri.identity.IdentityManagerBase\";let j=class extends n.EventedAccessor{constructor(e){super(e),this._oAuthCred=null,this.tokenRefreshBuffer=2,e&&e._oAuthCred&&(this._oAuthCred=e._oAuthCred)}initialize(){this.resources=this.resources||[],null==this.creationTime&&(this.creationTime=Date.now())}refreshToken(){const e=r.findServerInfo(this.server),t=e&&e.owningSystemUrl,s=!!t&&\"server\"===this.scope,i=s&&C(e,r._legacyFed),n=e.webTierAuth,o=n&&r.normalizeWebTierAuth,a=P[this.server],h=a&&a[this.userId];let l,c=this.resources&&this.resources[0],d=s&&r.findServerInfo(t),u={username:this.userId,password:h};if(n&&!o)return;s&&!d&&r.serverInfos.some((e=>(r._isIdProvider(t,e.server)&&(d=e),!!d)));const p=d&&r.findCredential(d.server,this.userId);if(!s||p){if(!i){if(s)l={serverUrl:c,token:p&&p.token,ssl:p&&p.ssl};else if(o)u=null,l={ssl:this.ssl};else{if(!h){let t;return c&&(c=r._sanitizeUrl(c),this._enqueued=1,t=r._enqueue(c,e,null,null,this.isAdmin,this),t.then((()=>{this._enqueued=0,this.refreshServerTokens()})).catch((()=>{this._enqueued=0}))),t}this.isAdmin&&(l={isAdmin:!0})}return r.generateToken(s?d:e,s?null:u,l).then((e=>{this.token=e.token,this.expires=null!=e.expires?Number(e.expires):null,this.creationTime=Date.now(),this.validity=e.validity,this.emitTokenChange(),this.refreshServerTokens()})).catch((()=>{}))}p.refreshToken()}}refreshServerTokens(){\"portal\"===this.scope&&r.credentials.forEach((e=>{const t=r.findServerInfo(e.server),s=t&&t.owningSystemUrl;e!==this&&e.userId===this.userId&&s&&\"server\"===e.scope&&(r._hasSameServerInstance(this.server,s)||r._isIdProvider(s,this.server))&&(C(t,r._legacyFed)?(e.token=this.token,e.expires=this.expires,e.creationTime=this.creationTime,e.validity=this.validity,e.emitTokenChange()):e.refreshToken())}))}emitTokenChange(e){clearTimeout(this._refreshTimer);const t=this.server&&r.findServerInfo(this.server),s=t&&t.owningSystemUrl,i=s&&r.findServerInfo(s);!1===e||s&&\"portal\"!==this.scope&&(!i||!i.webTierAuth||r.normalizeWebTierAuth)||null==this.expires&&null==this.validity||this._startRefreshTimer(),this.emit(\"token-change\")}destroy(){this.userId=this.server=this.token=this.expires=this.validity=this.resources=this.creationTime=null,this._oAuthCred&&(this._oAuthCred.destroy(),this._oAuthCred=null);const e=r.credentials.indexOf(this);e>-1&&r.credentials.splice(e,1),this.emitTokenChange(),this.emit(\"destroy\")}toJSON(){const e=a({userId:this.userId,server:this.server,token:this.token,expires:this.expires,validity:this.validity,ssl:this.ssl,isAdmin:this.isAdmin,creationTime:this.creationTime,scope:this.scope}),t=this.resources;return t&&t.length>0&&(e.resources=t.slice()),e}_startRefreshTimer(){clearTimeout(this._refreshTimer);const e=6e4*this.tokenRefreshBuffer,t=2**31-1;let r=(this.validity?this.creationTime+6e4*this.validity:this.expires)-Date.now();r<0?r=0:r>t&&(r=t),this._refreshTimer=setTimeout(this.refreshToken.bind(this),r>e?r-e:r)}};e([A()],j.prototype,\"creationTime\",void 0),e([A()],j.prototype,\"expires\",void 0),e([A()],j.prototype,\"isAdmin\",void 0),e([A()],j.prototype,\"oAuthState\",void 0),e([A()],j.prototype,\"resources\",void 0),e([A()],j.prototype,\"scope\",void 0),e([A()],j.prototype,\"server\",void 0),e([A()],j.prototype,\"ssl\",void 0),e([A()],j.prototype,\"token\",void 0),e([A()],j.prototype,\"tokenRefreshBuffer\",void 0),e([A()],j.prototype,\"userId\",void 0),e([A()],j.prototype,\"validity\",void 0),j=e([k(\"esri.identity.Credential\")],j);export{j as Credential,q as IdentityManagerBase};\n"]},"metadata":{},"sourceType":"module"}