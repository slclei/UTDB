{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport { isSome as t } from \"../../../../../../core/maybe.js\";\nimport { pt2px as e } from \"../../../../../../core/screenUtils.js\";\nimport { Alignment as i } from \"../../../../../../symbols/cim/enums.js\";\nimport { getXAnchorDirection as s, getYAnchorDirection as o } from \"../../alignmentUtils.js\";\nimport { premultiplyAlphaRGBA as a } from \"../../color.js\";\nimport { MIN_MAX_ZOOM_PRECISION_FACTOR as n, GLYPH_SIZE as r } from \"../../definitions.js\";\nimport { i1616to32 as l } from \"../../number.js\";\nimport { TextMaterialKey as h } from \"../../materialKey/MaterialKey.js\";\nimport { isFunction as c, getMinMaxZoom as m } from \"./util.js\";\nimport _ from \"./WGLBaseTextTemplate.js\";\nimport f from \"./WGLDynamicMeshTemplate.js\";\nimport { codepoints as y } from \"../../../../layers/features/textUtils.js\";\nconst p = 5;\n\nfunction M(t, e, i, s) {\n  return \"string\" == typeof t.text ? t.text : \"function\" == typeof t.text ? t.text(e, i, s) : \"\";\n}\n\nclass d extends _(f) {\n  constructor(s, o, r) {\n    super(s), this._horizontalAlignment = \"center\", this._verticalAlignment = \"middle\", this._textToGlyphs = new Map(), this._minMaxZoom = l(Math.round(o * n), Math.round(r * n));\n    const m = s.scaleFactor || 1;\n    this._cimTextLayer = s;\n    const _ = s.color;\n\n    if (c(_)) {\n      const t = (t, e, i) => a(_(t, e, i));\n\n      this._dynamicPropertyMap.set(\"_color\", t);\n    } else this._color = a(_);\n\n    const f = s.outlineColor;\n\n    if (c(f)) {\n      const t = (t, e, i) => a(f(t, e, i));\n\n      this._dynamicPropertyMap.set(\"_haloColor\", t);\n    } else this._haloColor = a(f);\n\n    let y;\n    c(s.size) || (y = Math.min(Math.round(e(s.size * s.sizeRatio)), 127));\n\n    const M = (t, i, o) => c(s.size) ? Math.min(Math.round(e(s.size(t, i, o) * s.sizeRatio)), 127) : y;\n\n    if (this._dynamicPropertyMap.set(\"_size\", M), c(s.outlineSize)) {\n      const t = (t, i, o) => Math.min(Math.floor(p * e(s.outlineSize(t, i, o) * s.sizeRatio)), 127);\n\n      this._dynamicPropertyMap.set(\"_haloSize\", t);\n    } else this._haloSize = Math.min(Math.floor(p * e(s.outlineSize * s.sizeRatio)), 127);\n\n    let d;\n    c(s.offsetX) || (d = Math.round(e(s.offsetX * s.sizeRatio)));\n\n    const g = (t, i, o) => c(s.offsetX) ? Math.round(e(s.offsetX(t, i, o) * s.sizeRatio)) : d;\n\n    let u;\n    this._dynamicPropertyMap.set(\"_xOffset\", g), c(s.offsetY) || (u = Math.round(e(s.offsetY * s.sizeRatio)));\n\n    const z = (t, i, o) => c(s.offsetY) ? Math.round(e(s.offsetY(t, i, o) * s.sizeRatio)) : u;\n\n    if (this._dynamicPropertyMap.set(\"_yOffset\", z), c(s.angle) ? this._dynamicPropertyMap.set(\"_angle\", s.angle) : this._angle = s.angle, c(s.horizontalAlignment) ? this._dynamicPropertyMap.set(\"_horizontalAlignment\", s.horizontalAlignment) : this._horizontalAlignment = s.horizontalAlignment, c(s.verticalAlignment) ? this._dynamicPropertyMap.set(\"_verticalAlignment\", s.verticalAlignment) : this._verticalAlignment = s.verticalAlignment, t(s.effects)) {\n      const t = s.effects;\n      c(t) ? this._dynamicPropertyMap.set(\"_effects\", t) : this._effects = t;\n    }\n\n    if (t(s.markerPlacement)) {\n      const t = s.markerPlacement;\n      c(t) ? this._dynamicPropertyMap.set(\"_markerPlacement\", t) : this._textPlacement = t;\n    }\n\n    c(s.text) ? this._dynamicPropertyMap.set(\"_text\", s.text) : this._text = s.text, this._scaleFactor = m;\n    const x = Math.min(Math.round(e(s.referenceSize * s.sizeRatio)), 127);\n    this._referenceSize = Math.round(Math.sqrt(256 * x)), this._materialKey = s.materialKey;\n    const P = h.load(this._materialKey);\n    P.sdf = !0, this._bitset = (s.alignment === i.MAP ? 1 : 0) | (s.colorLocked ? 1 : 0) << 1, this._materialKey = P.data, this._decoration = \"none\", this._lineHeight = 1, this._lineWidth = 512, this._isCIM = !0;\n  }\n\n  static fromCIMText(t, e) {\n    const [i, s] = m(t.scaleInfo, e);\n    return new d(t, i, s);\n  }\n\n  async analyze(t, e, i, s) {\n    const o = e.readLegacyFeature(),\n          a = M(this._cimTextLayer, o, i, s),\n          n = await super.analyze(t, e, i, s, y(a));\n    return n && n.glyphMosaicItems && this._textToGlyphs.set(a, n.glyphMosaicItems), n;\n  }\n\n  bindFeature(t, e, i) {\n    const a = t.readLegacyFeature();\n    if (this._dynamicPropertyMap.forEach((t, s) => {\n      this[s] = t(a, e, i);\n    }), !this._text || 0 === this._text.length) return void (this._shapingInfo = null);\n    this._size *= this._scaleFactor, this._scale = this._size / r, this._xOffset *= this._scaleFactor, this._yOffset *= this._scaleFactor, this._xAlignD = s(this._horizontalAlignment || \"center\"), this._yAlignD = o(this._verticalAlignment || \"baseline\");\n\n    const n = this._textToGlyphs.get(this._text);\n\n    this.bindTextInfo(n, !1);\n  }\n\n}\n\nexport { d as default };","map":{"version":3,"sources":["D:/Github/CUSP_DataBase/CUSP_DB/src/main/gis/node_modules/@arcgis/core/views/2d/engine/webgl/mesh/templates/WGLDynamicTextTemplate.js"],"names":["isSome","t","pt2px","e","Alignment","i","getXAnchorDirection","s","getYAnchorDirection","o","premultiplyAlphaRGBA","a","MIN_MAX_ZOOM_PRECISION_FACTOR","n","GLYPH_SIZE","r","i1616to32","l","TextMaterialKey","h","isFunction","c","getMinMaxZoom","m","_","f","codepoints","y","p","M","text","d","constructor","_horizontalAlignment","_verticalAlignment","_textToGlyphs","Map","_minMaxZoom","Math","round","scaleFactor","_cimTextLayer","color","_dynamicPropertyMap","set","_color","outlineColor","_haloColor","size","min","sizeRatio","outlineSize","floor","_haloSize","offsetX","g","u","offsetY","z","angle","_angle","horizontalAlignment","verticalAlignment","effects","_effects","markerPlacement","_textPlacement","_text","_scaleFactor","x","referenceSize","_referenceSize","sqrt","_materialKey","materialKey","P","load","sdf","_bitset","alignment","MAP","colorLocked","data","_decoration","_lineHeight","_lineWidth","_isCIM","fromCIMText","scaleInfo","analyze","readLegacyFeature","glyphMosaicItems","bindFeature","forEach","length","_shapingInfo","_size","_scale","_xOffset","_yOffset","_xAlignD","_yAlignD","get","bindTextInfo","default"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport{isSome as t}from\"../../../../../../core/maybe.js\";import{pt2px as e}from\"../../../../../../core/screenUtils.js\";import{Alignment as i}from\"../../../../../../symbols/cim/enums.js\";import{getXAnchorDirection as s,getYAnchorDirection as o}from\"../../alignmentUtils.js\";import{premultiplyAlphaRGBA as a}from\"../../color.js\";import{MIN_MAX_ZOOM_PRECISION_FACTOR as n,GLYPH_SIZE as r}from\"../../definitions.js\";import{i1616to32 as l}from\"../../number.js\";import{TextMaterialKey as h}from\"../../materialKey/MaterialKey.js\";import{isFunction as c,getMinMaxZoom as m}from\"./util.js\";import _ from\"./WGLBaseTextTemplate.js\";import f from\"./WGLDynamicMeshTemplate.js\";import{codepoints as y}from\"../../../../layers/features/textUtils.js\";const p=5;function M(t,e,i,s){return\"string\"==typeof t.text?t.text:\"function\"==typeof t.text?t.text(e,i,s):\"\"}class d extends(_(f)){constructor(s,o,r){super(s),this._horizontalAlignment=\"center\",this._verticalAlignment=\"middle\",this._textToGlyphs=new Map,this._minMaxZoom=l(Math.round(o*n),Math.round(r*n));const m=s.scaleFactor||1;this._cimTextLayer=s;const _=s.color;if(c(_)){const t=(t,e,i)=>a(_(t,e,i));this._dynamicPropertyMap.set(\"_color\",t)}else this._color=a(_);const f=s.outlineColor;if(c(f)){const t=(t,e,i)=>a(f(t,e,i));this._dynamicPropertyMap.set(\"_haloColor\",t)}else this._haloColor=a(f);let y;c(s.size)||(y=Math.min(Math.round(e(s.size*s.sizeRatio)),127));const M=(t,i,o)=>c(s.size)?Math.min(Math.round(e(s.size(t,i,o)*s.sizeRatio)),127):y;if(this._dynamicPropertyMap.set(\"_size\",M),c(s.outlineSize)){const t=(t,i,o)=>Math.min(Math.floor(p*e(s.outlineSize(t,i,o)*s.sizeRatio)),127);this._dynamicPropertyMap.set(\"_haloSize\",t)}else this._haloSize=Math.min(Math.floor(p*e(s.outlineSize*s.sizeRatio)),127);let d;c(s.offsetX)||(d=Math.round(e(s.offsetX*s.sizeRatio)));const g=(t,i,o)=>c(s.offsetX)?Math.round(e(s.offsetX(t,i,o)*s.sizeRatio)):d;let u;this._dynamicPropertyMap.set(\"_xOffset\",g),c(s.offsetY)||(u=Math.round(e(s.offsetY*s.sizeRatio)));const z=(t,i,o)=>c(s.offsetY)?Math.round(e(s.offsetY(t,i,o)*s.sizeRatio)):u;if(this._dynamicPropertyMap.set(\"_yOffset\",z),c(s.angle)?this._dynamicPropertyMap.set(\"_angle\",s.angle):this._angle=s.angle,c(s.horizontalAlignment)?this._dynamicPropertyMap.set(\"_horizontalAlignment\",s.horizontalAlignment):this._horizontalAlignment=s.horizontalAlignment,c(s.verticalAlignment)?this._dynamicPropertyMap.set(\"_verticalAlignment\",s.verticalAlignment):this._verticalAlignment=s.verticalAlignment,t(s.effects)){const t=s.effects;c(t)?this._dynamicPropertyMap.set(\"_effects\",t):this._effects=t}if(t(s.markerPlacement)){const t=s.markerPlacement;c(t)?this._dynamicPropertyMap.set(\"_markerPlacement\",t):this._textPlacement=t}c(s.text)?this._dynamicPropertyMap.set(\"_text\",s.text):this._text=s.text,this._scaleFactor=m;const x=Math.min(Math.round(e(s.referenceSize*s.sizeRatio)),127);this._referenceSize=Math.round(Math.sqrt(256*x)),this._materialKey=s.materialKey;const P=h.load(this._materialKey);P.sdf=!0,this._bitset=(s.alignment===i.MAP?1:0)|(s.colorLocked?1:0)<<1,this._materialKey=P.data,this._decoration=\"none\",this._lineHeight=1,this._lineWidth=512,this._isCIM=!0}static fromCIMText(t,e){const[i,s]=m(t.scaleInfo,e);return new d(t,i,s)}async analyze(t,e,i,s){const o=e.readLegacyFeature(),a=M(this._cimTextLayer,o,i,s),n=await super.analyze(t,e,i,s,y(a));return n&&n.glyphMosaicItems&&this._textToGlyphs.set(a,n.glyphMosaicItems),n}bindFeature(t,e,i){const a=t.readLegacyFeature();if(this._dynamicPropertyMap.forEach(((t,s)=>{this[s]=t(a,e,i)})),!this._text||0===this._text.length)return void(this._shapingInfo=null);this._size*=this._scaleFactor,this._scale=this._size/r,this._xOffset*=this._scaleFactor,this._yOffset*=this._scaleFactor,this._xAlignD=s(this._horizontalAlignment||\"center\"),this._yAlignD=o(this._verticalAlignment||\"baseline\");const n=this._textToGlyphs.get(this._text);this.bindTextInfo(n,!1)}}export{d as default};\n"]},"metadata":{},"sourceType":"module"}