{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport e from \"../../core/Error.js\";\nimport t from \"../../core/Logger.js\";\nimport { throwIfNotAbortError as r } from \"../../core/promiseUtils.js\";\nimport { zoomToFeature as i, zoomToClusteredFeatures as o, browseClusteredFeatures as n, removeSelectedFeature as a } from \"./actions.js\";\n\nconst s = \"esri.widgets.Popup.PopupViewModel\",\n      c = t.getLogger(s),\n      u = function (t) {\n  const {\n    event: s,\n    view: c\n  } = t,\n        {\n    action: u\n  } = s,\n        d = c && c.popup;\n  if (!u) return Promise.reject(new e(\"trigger-action:missing-arguments\", \"Event has no action\"));\n  if (!d) return Promise.reject(new e(\"trigger-action:missing-arguments\", \"view.popup is missing\"));\n  const {\n    disabled: l,\n    id: v\n  } = u;\n  if (!v) return Promise.reject(new e(\"trigger-action:invalid-action\", \"action.id is missing\"));\n  if (l) return Promise.reject(new e(\"trigger-action:invalid-action\", \"Action is disabled\"));\n  if (v === i.id) return g(d.viewModel).catch(r);\n  if (v === o.id) return w(d.viewModel);\n  if (v === n.id) return d.featureMenuOpen = !d.featureMenuOpen, d.viewModel.browseClusterEnabled = !d.viewModel.browseClusterEnabled, Promise.resolve();\n\n  if (d.viewModel.browseClusterEnabled = !1, v === a.id) {\n    d.close();\n    const {\n      selectedFeature: t\n    } = d;\n    if (!t) return Promise.reject(new e(`trigger-action:${a.id}`, \"selectedFeature is required\", {\n      selectedFeature: t\n    }));\n    const {\n      sourceLayer: r\n    } = t;\n    return r ? r.remove(t) : c.graphics.remove(t), Promise.resolve();\n  }\n\n  return Promise.resolve();\n};\n\nfunction d(e) {\n  const {\n    selectedFeature: t,\n    location: r,\n    view: i\n  } = e;\n  if (!i) return null;\n  if (\"3d\" === i.type) return t || r;\n  return e.get(\"selectedFeature.geometry\") || r;\n}\n\nfunction l(t, r) {\n  if (\"3d\" !== (null == r ? void 0 : r.type) || !t || \"esri.Graphic\" !== t.declaredClass) return !0;\n  const i = r.getViewForGraphic(t);\n\n  if (i && \"whenGraphicBounds\" in i) {\n    let r = !1;\n    return i.whenGraphicBounds(t, {\n      useViewElevation: !0\n    }).then(e => {\n      r = !e || !e.boundingBox || e.boundingBox[0] === e.boundingBox[3] && e.boundingBox[1] === e.boundingBox[4] && e.boundingBox[2] === e.boundingBox[5];\n    }).catch(() => {\n      const r = new e(\"zoom-to:invalid-graphic\", \"Could not zoom to the location of the graphic.\", {\n        graphic: t\n      });\n      c.error(r);\n    }), r;\n  }\n\n  return !0;\n}\n\nasync function g(t) {\n  const {\n    location: r,\n    selectedFeature: o,\n    view: n,\n    zoomFactor: a\n  } = t,\n        s = d(t);\n\n  if (!s) {\n    const t = new e(\"zoom-to:invalid-target-or-view\", \"Cannot zoom to location without a target and view.\", {\n      target: s,\n      view: n\n    });\n    return c.error(t), Promise.reject(t);\n  }\n\n  const u = n.scale / a,\n        g = t.get(\"selectedFeature.geometry\") || r,\n        w = g && \"point\" === g.type && l(o, n);\n  i.active = !0, i.disabled = !0;\n\n  try {\n    await t.view.goTo({\n      target: s,\n      scale: w ? u : void 0\n    });\n  } finally {\n    i.active = !1, i.disabled = !1, t.zoomToLocation = null, w && (t.location = g);\n  }\n}\n\nasync function w(t) {\n  const {\n    selectedFeature: r,\n    view: i\n  } = t;\n\n  if (\"2d\" !== (null == i ? void 0 : i.type)) {\n    const t = new e(\"zoomToCluster:invalid-view\", \"View must be 2d MapView.\", {\n      view: i\n    });\n    throw c.error(t), t;\n  }\n\n  if (!r.isAggregate) {\n    const t = new e(\"zoomToCluster:invalid-selectedFeature\", \"Selected feature must represent an aggregate/cluster graphic.\", {\n      selectedFeature: r\n    });\n    throw c.error(t), t;\n  }\n\n  const n = r.sourceLayer,\n        a = await i.whenLayerView(n),\n        s = a.createQuery();\n  s.aggregateIds = [r.getObjectId()], o.active = !0, o.disabled = !0;\n  const {\n    extent: u\n  } = await a.queryExtent(s);\n  await i.goTo({\n    target: u\n  }), o.active = !1, o.disabled = !1;\n}\n\nasync function v(t) {\n  const {\n    selectedFeature: r,\n    view: i\n  } = t;\n\n  if (\"2d\" !== (null == i ? void 0 : i.type)) {\n    const t = new e(\"displayClusterExtent:invalid-view\", \"View must be 2d MapView.\", {\n      view: i\n    });\n    throw c.error(t), t;\n  }\n\n  if (!r.isAggregate) {\n    const t = new e(\"zoomToCluster:invalid-selectedFeature\", \"Selected feature must represent an aggregate/cluster graphic.\", {\n      selectedFeature: r\n    });\n    throw c.error(t), t;\n  }\n\n  const o = r.sourceLayer,\n        n = await i.whenLayerView(o),\n        a = n.createQuery();\n  a.aggregateIds = [r.getObjectId()];\n  const {\n    extent: s\n  } = await n.queryExtent(a);\n  t.selectedClusterBoundaryFeature.geometry = s, i.graphics.add(t.selectedClusterBoundaryFeature);\n}\n\nasync function p(t) {\n  const {\n    selectedFeature: r,\n    view: i\n  } = t;\n\n  if (\"2d\" !== (null == i ? void 0 : i.type)) {\n    const t = new e(\"browseAggregateFeatures:invalid-view\", \"View must be 2d MapView.\", {\n      view: i\n    });\n    throw c.error(t), t;\n  }\n\n  if (!r.isAggregate) {\n    const t = new e(\"browseAggregateFeatures:invalid-selectedFeature\", \"Selected feature must represent an aggregate/cluster graphic.\", {\n      selectedFeature: r\n    });\n    throw c.error(t), t;\n  }\n\n  const o = r.sourceLayer,\n        a = await i.whenLayerView(o),\n        s = a.createQuery();\n  s.aggregateIds = [r.getObjectId()], n.active = !0, n.disabled = !0;\n  const {\n    features: u\n  } = await a.queryFeatures(s);\n  n.active = !1, n.disabled = !1, i.popup.open({\n    features: [r].concat(u),\n    featureMenuOpen: !0\n  });\n}\n\nfunction f(e) {\n  var t;\n  null != (t = e.selectedFeature) && t.isAggregate && (e.features = e.features.filter(e => e.isAggregate));\n}\n\nexport { p as browseAggregateFeatures, v as displayClusterExtent, d as getSelectedTarget, l as isZoomScreenSize, f as removeClusteredFeaturesForBrowsing, u as triggerAction, w as zoomToClusterExtent, g as zoomToLocation };","map":{"version":3,"sources":["D:/Github/CUSP_DataBase/CUSP_DB/src/main/gis/node_modules/@arcgis/core/widgets/Popup/actionUtils.js"],"names":["e","t","throwIfNotAbortError","r","zoomToFeature","i","zoomToClusteredFeatures","o","browseClusteredFeatures","n","removeSelectedFeature","a","s","c","getLogger","u","event","view","action","d","popup","Promise","reject","disabled","l","id","v","g","viewModel","catch","w","featureMenuOpen","browseClusterEnabled","resolve","close","selectedFeature","sourceLayer","remove","graphics","location","type","get","declaredClass","getViewForGraphic","whenGraphicBounds","useViewElevation","then","boundingBox","graphic","error","zoomFactor","target","scale","active","goTo","zoomToLocation","isAggregate","whenLayerView","createQuery","aggregateIds","getObjectId","extent","queryExtent","selectedClusterBoundaryFeature","geometry","add","p","features","queryFeatures","open","concat","f","filter","browseAggregateFeatures","displayClusterExtent","getSelectedTarget","isZoomScreenSize","removeClusteredFeaturesForBrowsing","triggerAction","zoomToClusterExtent"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport e from\"../../core/Error.js\";import t from\"../../core/Logger.js\";import{throwIfNotAbortError as r}from\"../../core/promiseUtils.js\";import{zoomToFeature as i,zoomToClusteredFeatures as o,browseClusteredFeatures as n,removeSelectedFeature as a}from\"./actions.js\";const s=\"esri.widgets.Popup.PopupViewModel\",c=t.getLogger(s),u=function(t){const{event:s,view:c}=t,{action:u}=s,d=c&&c.popup;if(!u)return Promise.reject(new e(\"trigger-action:missing-arguments\",\"Event has no action\"));if(!d)return Promise.reject(new e(\"trigger-action:missing-arguments\",\"view.popup is missing\"));const{disabled:l,id:v}=u;if(!v)return Promise.reject(new e(\"trigger-action:invalid-action\",\"action.id is missing\"));if(l)return Promise.reject(new e(\"trigger-action:invalid-action\",\"Action is disabled\"));if(v===i.id)return g(d.viewModel).catch(r);if(v===o.id)return w(d.viewModel);if(v===n.id)return d.featureMenuOpen=!d.featureMenuOpen,d.viewModel.browseClusterEnabled=!d.viewModel.browseClusterEnabled,Promise.resolve();if(d.viewModel.browseClusterEnabled=!1,v===a.id){d.close();const{selectedFeature:t}=d;if(!t)return Promise.reject(new e(`trigger-action:${a.id}`,\"selectedFeature is required\",{selectedFeature:t}));const{sourceLayer:r}=t;return r?r.remove(t):c.graphics.remove(t),Promise.resolve()}return Promise.resolve()};function d(e){const{selectedFeature:t,location:r,view:i}=e;if(!i)return null;if(\"3d\"===i.type)return t||r;return e.get(\"selectedFeature.geometry\")||r}function l(t,r){if(\"3d\"!==(null==r?void 0:r.type)||!t||\"esri.Graphic\"!==t.declaredClass)return!0;const i=r.getViewForGraphic(t);if(i&&\"whenGraphicBounds\"in i){let r=!1;return i.whenGraphicBounds(t,{useViewElevation:!0}).then((e=>{r=!e||!e.boundingBox||e.boundingBox[0]===e.boundingBox[3]&&e.boundingBox[1]===e.boundingBox[4]&&e.boundingBox[2]===e.boundingBox[5]})).catch((()=>{const r=new e(\"zoom-to:invalid-graphic\",\"Could not zoom to the location of the graphic.\",{graphic:t});c.error(r)})),r}return!0}async function g(t){const{location:r,selectedFeature:o,view:n,zoomFactor:a}=t,s=d(t);if(!s){const t=new e(\"zoom-to:invalid-target-or-view\",\"Cannot zoom to location without a target and view.\",{target:s,view:n});return c.error(t),Promise.reject(t)}const u=n.scale/a,g=t.get(\"selectedFeature.geometry\")||r,w=g&&\"point\"===g.type&&l(o,n);i.active=!0,i.disabled=!0;try{await t.view.goTo({target:s,scale:w?u:void 0})}finally{i.active=!1,i.disabled=!1,t.zoomToLocation=null,w&&(t.location=g)}}async function w(t){const{selectedFeature:r,view:i}=t;if(\"2d\"!==(null==i?void 0:i.type)){const t=new e(\"zoomToCluster:invalid-view\",\"View must be 2d MapView.\",{view:i});throw c.error(t),t}if(!r.isAggregate){const t=new e(\"zoomToCluster:invalid-selectedFeature\",\"Selected feature must represent an aggregate/cluster graphic.\",{selectedFeature:r});throw c.error(t),t}const n=r.sourceLayer,a=await i.whenLayerView(n),s=a.createQuery();s.aggregateIds=[r.getObjectId()],o.active=!0,o.disabled=!0;const{extent:u}=await a.queryExtent(s);await i.goTo({target:u}),o.active=!1,o.disabled=!1}async function v(t){const{selectedFeature:r,view:i}=t;if(\"2d\"!==(null==i?void 0:i.type)){const t=new e(\"displayClusterExtent:invalid-view\",\"View must be 2d MapView.\",{view:i});throw c.error(t),t}if(!r.isAggregate){const t=new e(\"zoomToCluster:invalid-selectedFeature\",\"Selected feature must represent an aggregate/cluster graphic.\",{selectedFeature:r});throw c.error(t),t}const o=r.sourceLayer,n=await i.whenLayerView(o),a=n.createQuery();a.aggregateIds=[r.getObjectId()];const{extent:s}=await n.queryExtent(a);t.selectedClusterBoundaryFeature.geometry=s,i.graphics.add(t.selectedClusterBoundaryFeature)}async function p(t){const{selectedFeature:r,view:i}=t;if(\"2d\"!==(null==i?void 0:i.type)){const t=new e(\"browseAggregateFeatures:invalid-view\",\"View must be 2d MapView.\",{view:i});throw c.error(t),t}if(!r.isAggregate){const t=new e(\"browseAggregateFeatures:invalid-selectedFeature\",\"Selected feature must represent an aggregate/cluster graphic.\",{selectedFeature:r});throw c.error(t),t}const o=r.sourceLayer,a=await i.whenLayerView(o),s=a.createQuery();s.aggregateIds=[r.getObjectId()],n.active=!0,n.disabled=!0;const{features:u}=await a.queryFeatures(s);n.active=!1,n.disabled=!1,i.popup.open({features:[r].concat(u),featureMenuOpen:!0})}function f(e){var t;null!=(t=e.selectedFeature)&&t.isAggregate&&(e.features=e.features.filter((e=>e.isAggregate)))}export{p as browseAggregateFeatures,v as displayClusterExtent,d as getSelectedTarget,l as isZoomScreenSize,f as removeClusteredFeaturesForBrowsing,u as triggerAction,w as zoomToClusterExtent,g as zoomToLocation};\n"]},"metadata":{},"sourceType":"module"}