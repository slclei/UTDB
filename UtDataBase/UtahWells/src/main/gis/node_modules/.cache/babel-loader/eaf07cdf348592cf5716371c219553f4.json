{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport { _ as t } from \"../../../../chunks/tslib.es6.js\";\nimport \"../../../../geometry.js\";\nimport o from \"../../../../Viewpoint.js\";\nimport i from \"../../../../core/Accessor.js\";\nimport { property as s } from \"../../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../../core/arrayUtils.js\";\nimport \"../../../../core/has.js\";\nimport \"../../../../core/accessorSupport/ensureType.js\";\nimport { subclass as e } from \"../../../../core/accessorSupport/decorators/subclass.js\";\nimport { s as n, m } from \"../../../../chunks/vec2.js\";\nimport { a } from \"../../../../chunks/vec2f64.js\";\nimport { getPaddingScreenTranslation as r, scaleAndRotateBy as h } from \"../../viewpointUtils.js\";\nimport { RotationMomentumEstimator as u } from \"../../../navigation/RotationMomentumEstimator.js\";\nimport { ZoomMomentumEstimator as p } from \"../../../navigation/ZoomMomentumEstimator.js\";\nimport c from \"../../../../geometry/Point.js\";\nlet l = class extends i {\n  constructor(t) {\n    super(t), this._animationTime = 0, this._momentumFinished = !1, this._rotationMomentumEstimator = new u(.6, .15, .95), this._rotationDirection = 1, this._zoomDirection = 1, this._zoomMomentumEstimator = new p(), this._zoomOnly = null, this.zoomMomentum = null, this.rotateMomentum = null, this.viewpoint = new o({\n      targetGeometry: new c(),\n      scale: 0,\n      rotation: 0\n    }), this.watch(\"_momentumFinished\", t => {\n      t && this.navigation.stop();\n    });\n  }\n\n  begin(t, o) {\n    this.navigation.begin(), this._rotationMomentumEstimator.reset(), this._zoomMomentumEstimator.reset(), this._zoomOnly = null, this._previousAngle = this._startAngle = o.angle, this._previousRadius = this._startRadius = o.radius, this._previousCenter = o.center, this._updateTimestamp = null, t.constraints.rotationEnabled && this.addToRotateEstimator(0, o.timestamp), this.addToZoomEstimator(o, 1);\n  }\n\n  update(t, o) {\n    null === this._updateTimestamp && (this._updateTimestamp = o.timestamp);\n    const i = o.angle,\n          s = o.radius,\n          e = o.center,\n          n = Math.abs(180 * (i - this._startAngle) / Math.PI),\n          m = Math.abs(s - this._startRadius),\n          a = this._startRadius / s;\n\n    if (this._previousRadius) {\n      const r = s / this._previousRadius;\n      let h = 180 * (i - this._previousAngle) / Math.PI;\n      this._rotationDirection = h >= 0 ? 1 : -1, this._zoomDirection = r >= 1 ? 1 : -1, t.constraints.rotationEnabled ? (null === this._zoomOnly && o.timestamp - this._updateTimestamp > 200 && (this._zoomOnly = m - n > 0), null === this._zoomOnly || this._zoomOnly ? h = 0 : this.addToRotateEstimator(i - this._startAngle, o.timestamp)) : h = 0, this.addToZoomEstimator(o, a), this.navigation.setViewpoint([e.x, e.y], 1 / r, h, [this._previousCenter.x - e.x, e.y - this._previousCenter.y]);\n    }\n\n    this._previousAngle = i, this._previousRadius = s, this._previousCenter = e;\n  }\n\n  end(t) {\n    this.rotateMomentum = this._rotationMomentumEstimator.evaluateMomentum(), this.zoomMomentum = this._zoomMomentumEstimator.evaluateMomentum(), this._animationTime = 0, (this.rotateMomentum || this.zoomMomentum) && this.onAnimationUpdate(t), this.navigation.end();\n  }\n\n  addToRotateEstimator(t, o) {\n    this._rotationMomentumEstimator.add(t, .001 * o);\n  }\n\n  addToZoomEstimator(t, o) {\n    this._zoomMomentumEstimator.add(o, .001 * t.timestamp);\n  }\n\n  canZoomIn(t) {\n    const o = t.scale,\n          i = t.constraints.effectiveMaxScale;\n    return 0 === i || o > i;\n  }\n\n  canZoomOut(t) {\n    const o = t.scale,\n          i = t.constraints.effectiveMinScale;\n    return 0 === i || o < i;\n  }\n\n  onAnimationUpdate(t) {\n    this.navigation.animationManager.animateContinous(t.viewpoint, (o, i) => {\n      const s = !this.canZoomIn(t) && this._zoomDirection > 1 || !this.canZoomOut(t) && this._zoomDirection < 1,\n            e = !this.rotateMomentum || this.rotateMomentum.isFinished(this._animationTime),\n            u = s || !this.zoomMomentum || this.zoomMomentum.isFinished(this._animationTime),\n            p = .001 * i;\n\n      if (this._momentumFinished = e && u, !this._momentumFinished) {\n        const i = this.rotateMomentum ? Math.abs(this.rotateMomentum.valueDelta(this._animationTime, p)) * this._rotationDirection * 180 / Math.PI : 0;\n        let s = this.zoomMomentum ? Math.abs(this.zoomMomentum.valueDelta(this._animationTime, p)) : 1;\n        const e = a(),\n              u = a();\n\n        if (this._previousCenter) {\n          n(e, this._previousCenter.x, this._previousCenter.y), r(u, t.size, t.padding), m(e, e, u);\n          const {\n            constraints: a,\n            scale: p\n          } = t,\n                c = p * s;\n          s < 1 && !a.canZoomInTo(c) ? (s = p / a.effectiveMaxScale, this.zoomMomentum = null, this.rotateMomentum = null) : s > 1 && !a.canZoomOutTo(c) && (s = p / a.effectiveMinScale, this.zoomMomentum = null, this.rotateMomentum = null), h(o, t.viewpoint, s, i, e, t.size), t.constraints.constrainByGeometry(o);\n        }\n      }\n\n      this._animationTime += p;\n    });\n  }\n\n  stopMomentumNavigation() {\n    (this.rotateMomentum || this.zoomMomentum) && (this.rotateMomentum && (this._rotationMomentumEstimator.reset(), this.rotateMomentum = null), this.zoomMomentum && (this._zoomMomentumEstimator.reset(), this.zoomMomentum = null), this.navigation.stop());\n  }\n\n};\nt([s()], l.prototype, \"_momentumFinished\", void 0), t([s()], l.prototype, \"viewpoint\", void 0), t([s()], l.prototype, \"navigation\", void 0), l = t([e(\"esri.views.2d.navigation.actions.Pinch\")], l);\nconst _ = l;\nexport { _ as default };","map":{"version":3,"sources":["D:/Github/CUSP_DataBase/CUSP_DB/src/main/gis/node_modules/@arcgis/core/views/2d/navigation/actions/Pinch.js"],"names":["_","t","o","i","property","s","subclass","e","n","m","a","getPaddingScreenTranslation","r","scaleAndRotateBy","h","RotationMomentumEstimator","u","ZoomMomentumEstimator","p","c","l","constructor","_animationTime","_momentumFinished","_rotationMomentumEstimator","_rotationDirection","_zoomDirection","_zoomMomentumEstimator","_zoomOnly","zoomMomentum","rotateMomentum","viewpoint","targetGeometry","scale","rotation","watch","navigation","stop","begin","reset","_previousAngle","_startAngle","angle","_previousRadius","_startRadius","radius","_previousCenter","center","_updateTimestamp","constraints","rotationEnabled","addToRotateEstimator","timestamp","addToZoomEstimator","update","Math","abs","PI","setViewpoint","x","y","end","evaluateMomentum","onAnimationUpdate","add","canZoomIn","effectiveMaxScale","canZoomOut","effectiveMinScale","animationManager","animateContinous","isFinished","valueDelta","size","padding","canZoomInTo","canZoomOutTo","constrainByGeometry","stopMomentumNavigation","prototype","default"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport{_ as t}from\"../../../../chunks/tslib.es6.js\";import\"../../../../geometry.js\";import o from\"../../../../Viewpoint.js\";import i from\"../../../../core/Accessor.js\";import{property as s}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/arrayUtils.js\";import\"../../../../core/has.js\";import\"../../../../core/accessorSupport/ensureType.js\";import{subclass as e}from\"../../../../core/accessorSupport/decorators/subclass.js\";import{s as n,m}from\"../../../../chunks/vec2.js\";import{a}from\"../../../../chunks/vec2f64.js\";import{getPaddingScreenTranslation as r,scaleAndRotateBy as h}from\"../../viewpointUtils.js\";import{RotationMomentumEstimator as u}from\"../../../navigation/RotationMomentumEstimator.js\";import{ZoomMomentumEstimator as p}from\"../../../navigation/ZoomMomentumEstimator.js\";import c from\"../../../../geometry/Point.js\";let l=class extends i{constructor(t){super(t),this._animationTime=0,this._momentumFinished=!1,this._rotationMomentumEstimator=new u(.6,.15,.95),this._rotationDirection=1,this._zoomDirection=1,this._zoomMomentumEstimator=new p,this._zoomOnly=null,this.zoomMomentum=null,this.rotateMomentum=null,this.viewpoint=new o({targetGeometry:new c,scale:0,rotation:0}),this.watch(\"_momentumFinished\",(t=>{t&&this.navigation.stop()}))}begin(t,o){this.navigation.begin(),this._rotationMomentumEstimator.reset(),this._zoomMomentumEstimator.reset(),this._zoomOnly=null,this._previousAngle=this._startAngle=o.angle,this._previousRadius=this._startRadius=o.radius,this._previousCenter=o.center,this._updateTimestamp=null,t.constraints.rotationEnabled&&this.addToRotateEstimator(0,o.timestamp),this.addToZoomEstimator(o,1)}update(t,o){null===this._updateTimestamp&&(this._updateTimestamp=o.timestamp);const i=o.angle,s=o.radius,e=o.center,n=Math.abs(180*(i-this._startAngle)/Math.PI),m=Math.abs(s-this._startRadius),a=this._startRadius/s;if(this._previousRadius){const r=s/this._previousRadius;let h=180*(i-this._previousAngle)/Math.PI;this._rotationDirection=h>=0?1:-1,this._zoomDirection=r>=1?1:-1,t.constraints.rotationEnabled?(null===this._zoomOnly&&o.timestamp-this._updateTimestamp>200&&(this._zoomOnly=m-n>0),null===this._zoomOnly||this._zoomOnly?h=0:this.addToRotateEstimator(i-this._startAngle,o.timestamp)):h=0,this.addToZoomEstimator(o,a),this.navigation.setViewpoint([e.x,e.y],1/r,h,[this._previousCenter.x-e.x,e.y-this._previousCenter.y])}this._previousAngle=i,this._previousRadius=s,this._previousCenter=e}end(t){this.rotateMomentum=this._rotationMomentumEstimator.evaluateMomentum(),this.zoomMomentum=this._zoomMomentumEstimator.evaluateMomentum(),this._animationTime=0,(this.rotateMomentum||this.zoomMomentum)&&this.onAnimationUpdate(t),this.navigation.end()}addToRotateEstimator(t,o){this._rotationMomentumEstimator.add(t,.001*o)}addToZoomEstimator(t,o){this._zoomMomentumEstimator.add(o,.001*t.timestamp)}canZoomIn(t){const o=t.scale,i=t.constraints.effectiveMaxScale;return 0===i||o>i}canZoomOut(t){const o=t.scale,i=t.constraints.effectiveMinScale;return 0===i||o<i}onAnimationUpdate(t){this.navigation.animationManager.animateContinous(t.viewpoint,((o,i)=>{const s=!this.canZoomIn(t)&&this._zoomDirection>1||!this.canZoomOut(t)&&this._zoomDirection<1,e=!this.rotateMomentum||this.rotateMomentum.isFinished(this._animationTime),u=s||!this.zoomMomentum||this.zoomMomentum.isFinished(this._animationTime),p=.001*i;if(this._momentumFinished=e&&u,!this._momentumFinished){const i=this.rotateMomentum?Math.abs(this.rotateMomentum.valueDelta(this._animationTime,p))*this._rotationDirection*180/Math.PI:0;let s=this.zoomMomentum?Math.abs(this.zoomMomentum.valueDelta(this._animationTime,p)):1;const e=a(),u=a();if(this._previousCenter){n(e,this._previousCenter.x,this._previousCenter.y),r(u,t.size,t.padding),m(e,e,u);const{constraints:a,scale:p}=t,c=p*s;s<1&&!a.canZoomInTo(c)?(s=p/a.effectiveMaxScale,this.zoomMomentum=null,this.rotateMomentum=null):s>1&&!a.canZoomOutTo(c)&&(s=p/a.effectiveMinScale,this.zoomMomentum=null,this.rotateMomentum=null),h(o,t.viewpoint,s,i,e,t.size),t.constraints.constrainByGeometry(o)}}this._animationTime+=p}))}stopMomentumNavigation(){(this.rotateMomentum||this.zoomMomentum)&&(this.rotateMomentum&&(this._rotationMomentumEstimator.reset(),this.rotateMomentum=null),this.zoomMomentum&&(this._zoomMomentumEstimator.reset(),this.zoomMomentum=null),this.navigation.stop())}};t([s()],l.prototype,\"_momentumFinished\",void 0),t([s()],l.prototype,\"viewpoint\",void 0),t([s()],l.prototype,\"navigation\",void 0),l=t([e(\"esri.views.2d.navigation.actions.Pinch\")],l);const _=l;export{_ as default};\n"]},"metadata":{},"sourceType":"module"}