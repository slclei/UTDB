{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../../chunks/tslib.es6.js\";\nimport t from \"../../../AggregateGraphic.js\";\nimport \"../../../geometry.js\";\nimport i from \"../../../Graphic.js\";\nimport r from \"../../../core/Collection.js\";\nimport s from \"../../../core/Error.js\";\nimport a from \"../../../core/has.js\";\nimport { clone as n } from \"../../../core/lang.js\";\nimport l from \"../../../core/Logger.js\";\nimport { applySome as o, isSome as h, unwrap as u, isNone as d } from \"../../../core/maybe.js\";\nimport { debounce as p, isAbortError as y } from \"../../../core/promiseUtils.js\";\nimport { watch as c, whenOnce as f, initial as g } from \"../../../core/reactiveUtils.js\";\nimport { property as m } from \"../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../core/accessorSupport/ensureType.js\";\nimport { subclass as _ } from \"../../../core/accessorSupport/decorators/subclass.js\";\nimport v from \"../../../layers/effects/FeatureEffectView.js\";\nimport b from \"../../../layers/support/FeatureFilter.js\";\nimport R from \"../../../rest/support/FeatureSet.js\";\nimport x from \"../../../rest/support/Query.js\";\nimport { MAX_FILTERS as S } from \"../engine/webgl/definitions.js\";\nimport { LayerView2DMixin as w } from \"./LayerView2D.js\";\nimport { createSchema as U } from \"./features/schemaUtils.js\";\nimport { createOrReuseTileRenderer as F } from \"./features/tileRenderers.js\";\nimport { findSizeVV as C, createClusterCountSizeVariable as I, isClusterCompatibleRenderer as E, createClusterRenderer as O } from \"./support/clusterUtils.js\";\nimport T from \"./support/FeatureCommandQueue.js\";\nimport q from \"./support/FeatureLayerProxy.js\";\nimport { toJSONGeometryType as V } from \"./support/util.js\";\nimport { TileManager as j } from \"../tiling/TileManager.js\";\nimport { FeatureLayerView as N } from \"../../layers/FeatureLayerView.js\";\nimport L from \"../../layers/LayerView.js\";\nimport { RefreshableLayerView as P } from \"../../layers/RefreshableLayerView.js\";\nimport { getWebGL1Capabilities as k } from \"../../webgl/capabilities.js\";\nimport z from \"../../../geometry/Extent.js\";\n\nfunction H(e) {\n  return e && \"openPorts\" in e;\n}\n\nconst J = l.getLogger(\"esri.views.2d.layers.FeatureLayerView2D\");\nlet Q = class extends N(P(w(L))) {\n  constructor() {\n    super(...arguments), this._pipelineIsUpdating = !0, this._commandsQueue = new T({\n      process: e => {\n        switch (e.type) {\n          case \"processed-edit\":\n            return this._doEdit(e);\n\n          case \"refresh\":\n            return this._doRefresh(e.dataChanged);\n\n          case \"update\":\n            return this._doUpdate();\n        }\n      }\n    }), this._visibilityOverrides = new Set(), this._highlightIds = new Map(), this._updateHighlight = p(async () => this._proxy.setHighlight(Array.from(this._highlightIds.keys()))), this._uploadsLocked = !1, this._needsClusterSizeUpdate = !1, this.featureEffectView = new v(), this._lastDefinitionExpression = null;\n  }\n\n  destroy() {\n    var e;\n    o(this._updateClusterSizeTask, e => e.remove()), null == (e = this._proxy) || e.destroy(), this._commandsQueue.destroy();\n  }\n\n  initialize() {\n    this.addResolvingPromise(Promise.all([this._initProxy(), this._initServiceOptions()])), this.handles.add([this.on(\"valueRangesChanged\", e => {\n      this._set(\"_aggregateValueRanges\", e.valueRanges);\n    }), c(() => this.featureEffect, e => {\n      this.featureEffectView.featureEffect = e;\n    }, {\n      initial: !0,\n      sync: !0\n    })]);\n  }\n\n  async _initProxy() {\n    if (\"isTable\" in this.layer && this.layer.isTable) throw new s(\"featurelayerview:table-not-supported\", \"table feature layer can't be displayed\", {\n      layer: this.layer\n    });\n    this._proxy && this._proxy.destroy();\n\n    const e = this._createClientOptions();\n\n    return this._set(\"_proxy\", new q({\n      client: e\n    })), this._proxy.when();\n  }\n\n  async _initServiceOptions() {\n    return this._set(\"_serviceOptions\", await this._createServiceOptions()), this._serviceOptions;\n  }\n\n  get orderByFields() {\n    return \"stream\" !== this._serviceOptions.type && this._serviceOptions.orderByFields;\n  }\n\n  get labelsVisible() {\n    const e = \"subtype-group\" === this.layer.type ? this.layer.sublayers.items : [this.layer];\n    return !this.suspended && e.some(e => e.labelingInfo && e.labelsVisible);\n  }\n\n  get queryMode() {\n    return this._serviceOptions.type;\n  }\n\n  get renderingConfigHash() {\n    if (!this.layer) return null;\n    const e = this.availableFields,\n          t = this.layer,\n          i = this.view.floors,\n          {\n      definitionExpression: r\n    } = t,\n          s = \"subtype-group\" !== this.layer.type && this.layer.labelsVisible && this.layer.labelingInfo,\n          a = \"renderer\" in t && t.renderer,\n          n = \"feature\" === t.type ? t.gdbVersion : void 0,\n          l = \"feature\" === t.type && t.historicMoment ? t.historicMoment.getTime() : void 0,\n          {\n      timeExtent: o\n    } = this,\n          u = \"customParameters\" in t ? JSON.stringify(t.customParameters) : void 0,\n          d = \"apiKey\" in t ? t.apiKey : void 0,\n          p = \"stream\" === t.type ? `${JSON.stringify(t.geometryDefinition)}${t.definitionExpression}` : null,\n          y = JSON.stringify(this.clips),\n          c = t.featureReduction && t.featureReduction.toJSON(),\n          f = \"orderBy\" in this.layer && JSON.stringify(this.layer.orderBy),\n          g = \"sublayers\" in this.layer && this.layer.sublayers.items.reduce((e, t) => e + `${t.visible ? 1 : 0}.${JSON.stringify(t.renderer)}.${t.labelsVisible}\\n.${JSON.stringify(t.labelingInfo)}`, \"\");\n    return JSON.stringify({\n      orderBy: f,\n      sublayerHash: g,\n      filterHash: h(this.filter) && this.filter.toJSON(),\n      effectHash: h(this.featureEffect) && this.featureEffect.toJSON(),\n      streamFilter: p,\n      gdbVersion: n,\n      definitionExpression: r,\n      historicMoment: l,\n      availableFields: e,\n      renderer: a,\n      labelingInfo: s,\n      timeExtent: o,\n      floors: i,\n      clipsHash: y,\n      featureReduction: c,\n      customParameters: u,\n      apiKey: d\n    });\n  }\n\n  highlight(e) {\n    var t;\n    let s;\n    return e instanceof i ? s = [e.getObjectId()] : \"number\" == typeof e || \"string\" == typeof e ? s = [e] : Array.isArray(e) && e.length > 0 ? s = \"number\" == typeof e[0] || \"string\" == typeof e[0] ? e : e.map(e => null == e ? void 0 : e.getObjectId()) : r.isCollection(e) && e.length > 0 && (s = e.map(e => null == e ? void 0 : e.getObjectId()).toArray()), s = null == (t = s) ? void 0 : t.filter(e => null != e), s && s.length ? (this._addHighlight(s), {\n      remove: () => this._removeHighlight(s)\n    }) : {\n      remove: () => {}\n    };\n  }\n\n  hasHighlight() {\n    return !!this._highlightIds.size;\n  }\n\n  async hitTest(e, r) {\n    if (!this.tileRenderer) return null;\n    const s = await this.tileRenderer.hitTest(r);\n    if (0 === s.length) return null;\n    const {\n      features: a,\n      aggregates: n\n    } = await this._proxy.getFeatures(s);\n    return [...n.map(e => this._createHittestResult(t.fromJSON(e))), ...a.map(e => this._createHittestResult(i.fromJSON(e)))];\n  }\n\n  async queryAggregates() {\n    return (await this._proxy.getAggregates()).map(e => t.fromJSON(e));\n  }\n\n  queryStatistics() {\n    return this._proxy.queryStatistics();\n  }\n\n  async querySummaryStatistics(e, t, i) {\n    const r = { ...t,\n      scale: this.view.scale\n    };\n    return this._proxy.querySummaryStatistics(this._cleanUpQuery(e), r, i);\n  }\n\n  async queryUniqueValues(e, t, i) {\n    const r = { ...t,\n      scale: this.view.scale\n    };\n    return this._proxy.queryUniqueValues(this._cleanUpQuery(e), r, i);\n  }\n\n  async queryClassBreaks(e, t, i) {\n    const r = { ...t,\n      scale: this.view.scale\n    };\n    return this._proxy.queryClassBreaks(this._cleanUpQuery(e), r, i);\n  }\n\n  async queryHistogram(e, t, i) {\n    const r = { ...t,\n      scale: this.view.scale\n    };\n    return this._proxy.queryHistogram(this._cleanUpQuery(e), r, i);\n  }\n\n  queryFeatures(e, t) {\n    return this.queryFeaturesJSON(e, t).then(e => {\n      const t = R.fromJSON(e);\n      return t.features.forEach(e => this._setLayersForFeature(e)), t;\n    });\n  }\n\n  queryVisibleFeatures(e, t) {\n    return this._proxy.queryVisibleFeatures(this._cleanUpQuery(e), t).then(e => {\n      const t = R.fromJSON(e);\n      return t.features.forEach(e => this._setLayersForFeature(e)), t;\n    });\n  }\n\n  queryFeaturesJSON(e, t) {\n    return this._proxy.queryFeatures(this._cleanUpQuery(e), t);\n  }\n\n  queryObjectIds(e, t) {\n    return this._proxy.queryObjectIds(this._cleanUpQuery(e), t);\n  }\n\n  queryFeatureCount(e, t) {\n    return this._proxy.queryFeatureCount(this._cleanUpQuery(e), t);\n  }\n\n  queryExtent(e, t) {\n    return this._proxy.queryExtent(this._cleanUpQuery(e), t).then(e => ({\n      count: e.count,\n      extent: z.fromJSON(e.extent)\n    }));\n  }\n\n  setVisibility(e, t) {\n    t ? this._visibilityOverrides.delete(e) : this._visibilityOverrides.add(e), this._update();\n  }\n\n  update(e) {\n    if (!this._tileStrategy || !this.tileRenderer) return;\n\n    const {\n      hasMissingTiles: t,\n      added: i,\n      removed: r\n    } = this._tileStrategy.update(e);\n\n    (i.length || r.length) && this._proxy.updateTiles({\n      added: i,\n      removed: r\n    }), t && this.requestUpdate(), this.notifyChange(\"updating\");\n  }\n\n  attach() {\n    this.view.timeline.record(`${this.layer.title} (FeatureLayer) Attach`), this._tileStrategy = new j({\n      acquireTile: e => this._acquireTile(e),\n      releaseTile: e => this._releaseTile(e),\n      tileInfoView: this.view.featuresTilingScheme,\n      buffer: 0\n    }), this.handles.add(c(() => this.renderingConfigHash, () => this._update(), g), \"attach\"), \"stream\" !== this.layer.type && this.handles.add(this.layer.on(\"edits\", e => this._edit(e)), \"attach\");\n  }\n\n  detach() {\n    var e;\n    this._commandsQueue.clear(), null == (e = this._proxy) || e.stop(), this.container.removeAllChildren(), this.handles.remove(\"attach\"), this.tileRenderer && (this.tileRenderer.uninstall(this.container), this.tileRenderer = null), this._tileStrategy && (this._tileStrategy.destroy(), this._tileStrategy = null), this._tileRendererHash = null;\n  }\n\n  moveStart() {\n    this.requestUpdate();\n  }\n\n  viewChange() {\n    this.requestUpdate();\n  }\n\n  moveEnd() {\n    this.requestUpdate();\n  }\n\n  isUpdating() {\n    var e;\n    const t = \"renderer\" in this.layer && null != this.layer.renderer,\n          i = this._commandsQueue.updating,\n          r = null != this._updatingRequiredFieldsPromise,\n          s = !this._proxy || !this._proxy.isReady,\n          n = this._pipelineIsUpdating,\n          l = null == this.tileRenderer || (null == (e = this.tileRenderer) ? void 0 : e.updating),\n          o = t && (i || r || s || n || l);\n    return a(\"esri-2d-log-updating\") && console.log(`Updating FLV2D: ${o}\\n  -> hasRenderer ${t}\\n  -> hasPendingCommand ${i}\\n  -> updatingRequiredFields ${r}\\n  -> updatingProxy ${s}\\n  -> updatingPipeline ${n}\\n  -> updatingTileRenderer ${l}\\n`), o;\n  }\n\n  _createClientOptions() {\n    return {\n      setUpdating: e => {\n        this._set(\"_pipelineIsUpdating\", e);\n      },\n      emitEvent: e => {\n        this.emit(e.name, e.event);\n      }\n    };\n  }\n\n  async _detectQueryMode(e) {\n    var t;\n    const i = (\"path\" in e),\n          r = \"editingInfo\" in this.layer && (null == (t = this.layer.editingInfo) ? void 0 : t.lastEditDate),\n          s = !!this.layer.refreshInterval,\n          n = !r && s;\n    if (i && (\"feature\" === this.layer.type || \"subtype-group\" === this.layer.type) && \"point\" === this.layer.geometryType && this.layer.capabilities.query.supportsPagination && !this.layer.capabilities.operations.supportsEditing && !n && a(\"featurelayer-snapshot-enabled\")) try {\n      const e = await this.layer.queryFeatureCount();\n      if (e <= a(\"featurelayer-snapshot-point-min-threshold\")) return {\n        mode: \"snapshot\",\n        featureCount: e\n      };\n      const t = a(\"featurelayer-snapshot-point-max-threshold\"),\n            i = a(\"featurelayer-snapshot-point-coverage\"),\n            r = this.view.extent,\n            s = u(this.layer.fullExtent),\n            n = null == s ? void 0 : s.clone().intersection(r),\n            l = h(n) ? n.width * n.height : 0,\n            o = (null == s ? void 0 : s.width) * (null == s ? void 0 : s.height),\n            d = 0 === o ? 0 : l / o;\n      if (e <= t && d >= i) return {\n        mode: \"snapshot\",\n        featureCount: e\n      };\n    } catch (l) {\n      J.warn(\"mapview-feature-layer\", \"Encountered an error when querying for featureCount\", {\n        error: l\n      });\n    }\n    return {\n      mode: \"on-demand\"\n    };\n  }\n\n  async _createServiceOptions() {\n    var e;\n    const t = this.layer;\n    if (\"stream\" === t.type) return null;\n    const {\n      capabilities: i,\n      objectIdField: r\n    } = t,\n          s = t.fields.map(e => e.toJSON()),\n          a = h(t.fullExtent) && t.fullExtent.toJSON(),\n          l = V(t.geometryType),\n          o = t.timeInfo && t.timeInfo.toJSON() || null,\n          u = t.spatialReference ? t.spatialReference.toJSON() : null,\n          d = \"feature\" === t.type ? t.globalIdField : null;\n    let p;\n    \"ogc-feature\" === t.type ? p = t.source.getFeatureDefinition() : H(t.source) ? p = await t.source.openPorts() : t.parsedUrl && (p = n(t.parsedUrl), \"dynamicDataSource\" in t && t.dynamicDataSource && (p.query = {\n      layer: JSON.stringify({\n        source: t.dynamicDataSource\n      })\n    }));\n    const y = \"datesInUnknownTimezone\" in this.layer && this.layer.datesInUnknownTimezone,\n          c = null != (e = \"subtypeField\" in this.layer && this.layer.subtypeField) ? e : null,\n          {\n      mode: f,\n      featureCount: g\n    } = await this._detectQueryMode(p);\n    let m = this.layer.objectIdField;\n\n    if (\"feature\" === this.layer.type && h(this.layer.orderBy) && this.layer.orderBy.length) {\n      const e = !this.layer.orderBy[0].valueExpression && this.layer.orderBy[0].field;\n      e && (m = e);\n    }\n\n    return {\n      type: f,\n      timeReferenceUnknownClient: y,\n      subtypeField: c,\n      featureCount: g,\n      globalIdField: d,\n      maxRecordCount: i.query.maxRecordCount,\n      tileMaxRecordCount: i.query.tileMaxRecordCount,\n      capabilities: i,\n      fields: s,\n      fullExtent: a,\n      geometryType: l,\n      objectIdField: r,\n      source: p,\n      timeInfo: o,\n      spatialReference: u,\n      orderByFields: m\n    };\n  }\n\n  async _createMemoryServiceOptions(e) {\n    const t = await e.openPorts();\n    return { ...this._createServiceOptions(),\n      type: \"memory\",\n      source: t\n    };\n  }\n\n  _cleanUpQuery(e) {\n    const t = x.from(e) || this.createQuery();\n    return t.outSpatialReference || (t.outSpatialReference = this.view.spatialReference), t;\n  }\n\n  async _update() {\n    return this._commandsQueue.push({\n      type: \"update\"\n    });\n  }\n\n  async _edit(e) {\n    if (this.suspended) return void this._clearTiles();\n    return this._validateEdit(e) ? this._commandsQueue.push({\n      type: \"edit\",\n      edits: e\n    }) : void 0;\n  }\n\n  async doRefresh(e) {\n    if (this._tileStrategy.tileKeys().length) return this.suspended && e ? void this._clearTiles() : this._commandsQueue.push({\n      type: \"refresh\",\n      dataChanged: e\n    });\n  }\n\n  _clearTiles() {\n    this._tileStrategy.tileKeys().length && (this._proxy.updateTiles({\n      added: [],\n      removed: this._tileStrategy.tileKeys()\n    }), this._tileStrategy.clear(), this.requestUpdate(), this._commandsQueue.clear(), this._update());\n  }\n\n  _validateEdit(e) {\n    const t = \"globalIdField\" in this.layer && this.layer.globalIdField,\n          i = e.deletedFeatures.some(e => -1 === e.objectId || !e.objectId),\n          r = t && this.availableFields.includes(t);\n    return i && !r ? (J.error(new s(\"mapview-apply-edits\", `Editing the specified service requires the layer's globalIdField, ${t} to be included the layer's outFields for updates to be reflected on the map`)), null) : e;\n  }\n\n  async _doUpdate() {\n    try {\n      if (this.destroyed || !this._hasRequiredSupport(this.layer) || !this._tileStrategy) return;\n      const {\n        featureEffectView: t,\n        filter: i\n      } = this;\n      await this._updateRequiredFields();\n\n      const {\n        renderer: r\n      } = this._getEffectiveRenderer();\n\n      this._set(\"_effectiveRenderer\", r);\n\n      const s = this._createSchemaConfig(),\n            a = this._createConfiguration(s, i, t.filter),\n            n = this._lastDefinitionExpression !== a.definitionExpression;\n\n      this._lastDefinitionExpression = a.definitionExpression;\n\n      const l = this._createTileRendererHash(r);\n\n      if (\"snapshot\" === this._serviceOptions.type && (a.schema.source.featureCount = this._serviceOptions.featureCount), l !== this._tileRendererHash) {\n        await this._initTileRenderer(r);\n        const e = this.layer,\n              t = \"stream\" === e.type ? await this._initServiceOptions() : this._serviceOptions;\n        this.tileRenderer.onConfigUpdate(r), \"stream\" !== e.type && H(e.source) && (t.source = await e.source.openPorts());\n        const i = {\n          added: this._tileStrategy.tileKeys(),\n          removed: []\n        };\n        await this._proxy.startup(this.view.featuresTilingScheme, a, t, i), this.hasHighlight() && (await this._proxy.setHighlight(Array.from(this._highlightIds.keys()))), await this._onceTilesUpdated(), this.tileRenderer.onConfigUpdate(r);\n      } else {\n        \"snapshot\" === this._serviceOptions.type && n && (a.schema.source.featureCount = await this.layer.queryFeatureCount());\n        const t = await this._proxy.update(a);\n        (t.mesh || t.targets.aggregate) && this._lockGPUUploads();\n\n        try {\n          await this._proxy.applyUpdate(t);\n        } catch (e) {\n          y(e) || J.error(e);\n        }\n\n        (t.mesh || t.targets.aggregate) && this._unlockGPUUploads(), this.tileRenderer.onConfigUpdate(r), this._updateClusterSizeVariable(), this._forceAttributeTextureUpload();\n      }\n\n      this._tileRendererHash = l, this.tileRenderer.invalidateLabels(), this.requestUpdate();\n    } catch (e) {}\n  }\n\n  async _doEdit(e) {\n    try {\n      await this._proxy.onEdits(e);\n    } catch (t) {\n      y(t), 0;\n    }\n  }\n\n  async _doRefresh(e) {\n    var t;\n\n    this._lockGPUUploads();\n\n    try {\n      await this._proxy.refresh(e);\n    } catch (i) {\n      y(i), 0;\n    }\n\n    this._unlockGPUUploads(), null != (t = this.layer) && t.featureReduction && this._updateClusterSizeVariable();\n  }\n\n  _updateClusterSizeVariable() {\n    this._needsClusterSizeUpdate && (this.tileRenderer.onConfigUpdate(this._effectiveRenderer), this._needsClusterSizeUpdate = !1);\n  }\n\n  _createUpdateClusterSizeTask(e, t) {\n    return this.watch(\"_aggregateValueRanges\", async i => {\n      this._updateClusterEffectiveRendererSizeVariable(e, t, i), this._needsClusterSizeUpdate = !0, this._uploadsLocked || this._updateClusterSizeVariable();\n    });\n  }\n\n  async _updateClusterEffectiveRendererSizeVariable(e, t, i) {\n    if (e.dynamicClusterSize && \"visualVariables\" in e && e.visualVariables) {\n      const r = C(e.visualVariables);\n\n      if (h(r) && \"cluster_count\" === r.field) {\n        const s = e.visualVariables.indexOf(r);\n        e.visualVariables[s] = I(t, i);\n        const a = e.clone();\n        a.dynamicClusterSize = !0, this._set(\"_effectiveRenderer\", a);\n      }\n    }\n  }\n\n  _getEffectiveRenderer() {\n    const e = \"renderer\" in this.layer && this.layer.renderer,\n          t = this.layer.featureReduction;\n\n    if (h(this._updateClusterSizeTask) && (this._updateClusterSizeTask.remove(), this._updateClusterSizeTask = null), t && \"cluster\" === t.type && E(e)) {\n      const i = t,\n            r = [],\n            s = O(r, e, i, this._aggregateValueRanges);\n      return o(this._updateClusterSizeTask, e => e.remove()), this._updateClusterSizeTask = this._createUpdateClusterSizeTask(s, i), {\n        renderer: s,\n        aggregateFields: r,\n        featureReduction: t\n      };\n    }\n\n    return {\n      renderer: e,\n      aggregateFields: [],\n      featureReduction: null\n    };\n  }\n\n  _acquireTile(e) {\n    const t = this.tileRenderer.acquireTile(e);\n    return t.once(\"attach\", () => {\n      this.requestUpdate();\n    }), t;\n  }\n\n  _releaseTile(e) {\n    this.tileRenderer.releaseTile(e);\n  }\n\n  async _initTileRenderer(e) {\n    const t = await F(e, {\n      layerView: this,\n      tileInfoView: this.view.featuresTilingScheme,\n      layer: this.layer\n    });\n    return this.tileRenderer && (this._tileStrategy.clear(), this.tileRenderer.uninstall(this.container), this.tileRenderer.destroy(), this.tileRenderer = null), this.destroyed ? null : (this._proxy.tileRenderer = t, this._set(\"tileRenderer\", t), this.tileRenderer.install(this.container), this.tileRenderer.onConfigUpdate(e), this.requestUpdate(), this.tileRenderer);\n  }\n\n  _createTileRendererHash(e) {\n    return `${\"heatmap\" === e.type ? \"heatmap\" : \"symbol\"}`;\n  }\n\n  get hasFilter() {\n    const e = !!(\"floorInfo\" in this.layer && this.layer.floorInfo && this.view.floors && this.view.floors.length);\n    return !!this.filter || e || !!this._visibilityOverrides.size || !!this.timeExtent;\n  }\n\n  _injectOverrides(e) {\n    const t = h(e) ? e.timeExtent : null,\n          i = h(this.timeExtent) && h(t) ? this.timeExtent.intersection(t) : this.timeExtent || t;\n    let r = null;\n    const s = \"floorInfo\" in this.layer && this.layer.floorInfo;\n\n    if (s) {\n      const t = h(e) && e.where;\n      r = this._addFloorFilterClause(t);\n    }\n\n    if (!this._visibilityOverrides.size && !i && !s) return h(e) ? e.toJSON() : null;\n    (e = h(e) && e.clone() || new b()).timeExtent = i, r && (e.where = r);\n    const a = e.toJSON();\n    return a.hiddenIds = Array.from(this._visibilityOverrides), a;\n  }\n\n  _addFloorFilterClause(e) {\n    const t = this.layer;\n    let i = e || \"\";\n\n    if (\"floorInfo\" in t && t.floorInfo) {\n      var r;\n      let e = this.view.floors;\n      if (!e || !e.length) return i;\n      null != (r = t.floorInfo.viewAllLevelIds) && r.length && (e = t.floorInfo.viewAllLevelIds);\n      const s = e.filter(e => \"\" !== e).map(e => \"'\" + e + \"'\");\n      s.push(\"''\");\n      const a = t.floorInfo.floorField;\n      let n = \"(\" + a + \" IN ({ids}) OR \" + a + \" IS NULL)\";\n\n      if (n = n.replace(\"{ids}\", s.join(\", \")), h(i) && i.includes(a)) {\n        let e = new RegExp(\"AND \\\\(\" + a + \".*NULL\\\\)\", \"g\");\n        i = i.replace(e, \"\"), e = new RegExp(\"\\\\(\" + a + \".*NULL\\\\)\", \"g\"), i = i.replace(e, \"\"), i = i.replace(/\\s+/g, \" \").trim();\n      }\n\n      i = \"\" !== i ? \"(\" + i + \") AND \" + n : n;\n    }\n\n    return \"\" !== i ? i : null;\n  }\n\n  _createConfiguration(e, t, i) {\n    const r = \"feature\" === this.layer.type && this.layer.historicMoment ? this.layer.historicMoment.getTime() : void 0,\n          s = \"feature\" === this.layer.type ? this.layer.gdbVersion : void 0,\n          a = new Array(S),\n          n = this._injectOverrides(t);\n\n    a[0] = n, a[1] = h(i) ? i.toJSON() : null;\n    const l = U(e);\n    if (d(l)) return null;\n    const o = k();\n    return {\n      definitionExpression: this.layer.definitionExpression,\n      availableFields: this.availableFields,\n      gdbVersion: s,\n      historicMoment: r,\n      devicePixelRatio: window.devicePixelRatio || 1,\n      filters: a,\n      schema: l,\n      supportsTextureFloat: o.supportsTextureFloat,\n      maxTextureSize: o.maxTextureSize\n    };\n  }\n\n  _hasRequiredSupport(e) {\n    var t;\n    return !(\"renderer\" in e && \"dot-density\" === (null == (t = e.renderer) ? void 0 : t.type) && !k().supportsTextureFloat) || (J.error(new s(\"webgl-missing-extension\", \"Missing WebGL extension OES_Texture_Float which is required for DotDensity\")), !1);\n  }\n\n  _onceTilesUpdated() {\n    return this.requestUpdate(), f(() => !this._pipelineIsUpdating);\n  }\n\n  _lockGPUUploads() {\n    this.tileRenderer && (this._uploadsLocked = !0, this.tileRenderer.lockGPUUploads());\n  }\n\n  _unlockGPUUploads() {\n    this.tileRenderer && (this._uploadsLocked = !1, this.tileRenderer.unlockGPUUploads());\n  }\n\n  _forceAttributeTextureUpload() {\n    this.tileRenderer && this.tileRenderer.forceAttributeTextureUpload();\n  }\n\n  _createSchemaConfig() {\n    const e = \"feature\" === this.layer.type ? this.layer.historicMoment : null,\n          t = \"feature\" === this.layer.type ? this.layer.gdbVersion : null;\n    return {\n      renderer: \"renderer\" in this.layer && this.layer.renderer,\n      spatialReference: this.layer.spatialReference,\n      timeExtent: this.layer.timeExtent,\n      definitionExpression: this.layer.definitionExpression,\n      featureReduction: this.layer.featureReduction,\n      fields: this.layer.fields,\n      geometryType: this.layer.geometryType,\n      historicMoment: e,\n      labelsVisible: \"labelsVisible\" in this.layer && this.layer.labelsVisible,\n      labelingInfo: \"labelingInfo\" in this.layer && this.layer.labelingInfo,\n      availableFields: this.availableFields,\n      featureEffect: this.featureEffect,\n      filter: this.filter,\n      gdbVersion: t,\n      pixelBuffer: 0,\n      orderBy: \"orderBy\" in this.layer && this.layer.orderBy ? this.layer.orderBy : null,\n      customParameters: { ...(\"customParameters\" in this.layer ? this.layer.customParameters : void 0),\n        token: \"apiKey\" in this.layer ? this.layer.apiKey : void 0\n      }\n    };\n  }\n\n  _addHighlight(e) {\n    for (const t of e) if (this._highlightIds.has(t)) {\n      const e = this._highlightIds.get(t);\n\n      this._highlightIds.set(t, e + 1);\n    } else this._highlightIds.set(t, 1);\n\n    this._updateHighlight().catch(e => {\n      y(e) || J.error(e);\n    });\n  }\n\n  _removeHighlight(e) {\n    for (const t of e) if (this._highlightIds.has(t)) {\n      const e = this._highlightIds.get(t) - 1;\n      0 === e ? this._highlightIds.delete(t) : this._highlightIds.set(t, e);\n    }\n\n    this._updateHighlight().catch(e => {\n      y(e) || J.error(e);\n    });\n  }\n\n  _setLayersForFeature(e) {\n    const t = this.layer;\n    e.layer = t, e.sourceLayer = t;\n  }\n\n  _createHittestResult(e) {\n    return this._setLayersForFeature(e), h(e.geometry) && (e.geometry.spatialReference = this.view.spatialReference), e;\n  }\n\n};\ne([m()], Q.prototype, \"_serviceOptions\", void 0), e([m()], Q.prototype, \"_proxy\", void 0), e([m()], Q.prototype, \"_pipelineIsUpdating\", void 0), e([m()], Q.prototype, \"_effectiveRenderer\", void 0), e([m()], Q.prototype, \"_aggregateValueRanges\", void 0), e([m()], Q.prototype, \"_commandsQueue\", void 0), e([m()], Q.prototype, \"featureEffectView\", void 0), e([m()], Q.prototype, \"labelsVisible\", null), e([m({\n  readOnly: !0\n})], Q.prototype, \"queryMode\", null), e([m()], Q.prototype, \"renderingConfigHash\", null), e([m()], Q.prototype, \"tileRenderer\", void 0), e([m()], Q.prototype, \"updating\", void 0), Q = e([_(\"esri.views.2d.layers.FeatureLayerView2D\")], Q);\nconst A = Q;\nexport { A as default };","map":{"version":3,"sources":["D:/Github/CUSP_DataBase/CUSP_DB/src/main/gis/node_modules/@arcgis/core/views/2d/layers/FeatureLayerView2D.js"],"names":["_","e","t","i","r","s","a","clone","n","l","applySome","o","isSome","h","unwrap","u","isNone","d","debounce","p","isAbortError","y","watch","c","whenOnce","f","initial","g","property","m","subclass","v","b","R","x","MAX_FILTERS","S","LayerView2DMixin","w","createSchema","U","createOrReuseTileRenderer","F","findSizeVV","C","createClusterCountSizeVariable","I","isClusterCompatibleRenderer","E","createClusterRenderer","O","T","q","toJSONGeometryType","V","TileManager","j","FeatureLayerView","N","L","RefreshableLayerView","P","getWebGL1Capabilities","k","z","H","J","getLogger","Q","constructor","arguments","_pipelineIsUpdating","_commandsQueue","process","type","_doEdit","_doRefresh","dataChanged","_doUpdate","_visibilityOverrides","Set","_highlightIds","Map","_updateHighlight","_proxy","setHighlight","Array","from","keys","_uploadsLocked","_needsClusterSizeUpdate","featureEffectView","_lastDefinitionExpression","destroy","_updateClusterSizeTask","remove","initialize","addResolvingPromise","Promise","all","_initProxy","_initServiceOptions","handles","add","on","_set","valueRanges","featureEffect","sync","layer","isTable","_createClientOptions","client","when","_createServiceOptions","_serviceOptions","orderByFields","labelsVisible","sublayers","items","suspended","some","labelingInfo","queryMode","renderingConfigHash","availableFields","view","floors","definitionExpression","renderer","gdbVersion","historicMoment","getTime","timeExtent","JSON","stringify","customParameters","apiKey","geometryDefinition","clips","featureReduction","toJSON","orderBy","reduce","visible","sublayerHash","filterHash","filter","effectHash","streamFilter","clipsHash","highlight","getObjectId","isArray","length","map","isCollection","toArray","_addHighlight","_removeHighlight","hasHighlight","size","hitTest","tileRenderer","features","aggregates","getFeatures","_createHittestResult","fromJSON","queryAggregates","getAggregates","queryStatistics","querySummaryStatistics","scale","_cleanUpQuery","queryUniqueValues","queryClassBreaks","queryHistogram","queryFeatures","queryFeaturesJSON","then","forEach","_setLayersForFeature","queryVisibleFeatures","queryObjectIds","queryFeatureCount","queryExtent","count","extent","setVisibility","delete","_update","update","_tileStrategy","hasMissingTiles","added","removed","updateTiles","requestUpdate","notifyChange","attach","timeline","record","title","acquireTile","_acquireTile","releaseTile","_releaseTile","tileInfoView","featuresTilingScheme","buffer","_edit","detach","clear","stop","container","removeAllChildren","uninstall","_tileRendererHash","moveStart","viewChange","moveEnd","isUpdating","updating","_updatingRequiredFieldsPromise","isReady","console","log","setUpdating","emitEvent","emit","name","event","_detectQueryMode","editingInfo","lastEditDate","refreshInterval","geometryType","capabilities","query","supportsPagination","operations","supportsEditing","mode","featureCount","fullExtent","intersection","width","height","warn","error","objectIdField","fields","timeInfo","spatialReference","globalIdField","source","getFeatureDefinition","openPorts","parsedUrl","dynamicDataSource","datesInUnknownTimezone","subtypeField","valueExpression","field","timeReferenceUnknownClient","maxRecordCount","tileMaxRecordCount","_createMemoryServiceOptions","createQuery","outSpatialReference","push","_clearTiles","_validateEdit","edits","doRefresh","tileKeys","deletedFeatures","objectId","includes","destroyed","_hasRequiredSupport","_updateRequiredFields","_getEffectiveRenderer","_createSchemaConfig","_createConfiguration","_createTileRendererHash","schema","_initTileRenderer","onConfigUpdate","startup","_onceTilesUpdated","mesh","targets","aggregate","_lockGPUUploads","applyUpdate","_unlockGPUUploads","_updateClusterSizeVariable","_forceAttributeTextureUpload","invalidateLabels","onEdits","refresh","_effectiveRenderer","_createUpdateClusterSizeTask","_updateClusterEffectiveRendererSizeVariable","dynamicClusterSize","visualVariables","indexOf","_aggregateValueRanges","aggregateFields","once","layerView","install","hasFilter","floorInfo","_injectOverrides","where","_addFloorFilterClause","hiddenIds","viewAllLevelIds","floorField","replace","join","RegExp","trim","devicePixelRatio","window","filters","supportsTextureFloat","maxTextureSize","lockGPUUploads","unlockGPUUploads","forceAttributeTextureUpload","pixelBuffer","token","has","get","set","catch","sourceLayer","geometry","prototype","readOnly","A","default"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import t from\"../../../AggregateGraphic.js\";import\"../../../geometry.js\";import i from\"../../../Graphic.js\";import r from\"../../../core/Collection.js\";import s from\"../../../core/Error.js\";import a from\"../../../core/has.js\";import{clone as n}from\"../../../core/lang.js\";import l from\"../../../core/Logger.js\";import{applySome as o,isSome as h,unwrap as u,isNone as d}from\"../../../core/maybe.js\";import{debounce as p,isAbortError as y}from\"../../../core/promiseUtils.js\";import{watch as c,whenOnce as f,initial as g}from\"../../../core/reactiveUtils.js\";import{property as m}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/accessorSupport/ensureType.js\";import{subclass as _}from\"../../../core/accessorSupport/decorators/subclass.js\";import v from\"../../../layers/effects/FeatureEffectView.js\";import b from\"../../../layers/support/FeatureFilter.js\";import R from\"../../../rest/support/FeatureSet.js\";import x from\"../../../rest/support/Query.js\";import{MAX_FILTERS as S}from\"../engine/webgl/definitions.js\";import{LayerView2DMixin as w}from\"./LayerView2D.js\";import{createSchema as U}from\"./features/schemaUtils.js\";import{createOrReuseTileRenderer as F}from\"./features/tileRenderers.js\";import{findSizeVV as C,createClusterCountSizeVariable as I,isClusterCompatibleRenderer as E,createClusterRenderer as O}from\"./support/clusterUtils.js\";import T from\"./support/FeatureCommandQueue.js\";import q from\"./support/FeatureLayerProxy.js\";import{toJSONGeometryType as V}from\"./support/util.js\";import{TileManager as j}from\"../tiling/TileManager.js\";import{FeatureLayerView as N}from\"../../layers/FeatureLayerView.js\";import L from\"../../layers/LayerView.js\";import{RefreshableLayerView as P}from\"../../layers/RefreshableLayerView.js\";import{getWebGL1Capabilities as k}from\"../../webgl/capabilities.js\";import z from\"../../../geometry/Extent.js\";function H(e){return e&&\"openPorts\"in e}const J=l.getLogger(\"esri.views.2d.layers.FeatureLayerView2D\");let Q=class extends(N(P(w(L)))){constructor(){super(...arguments),this._pipelineIsUpdating=!0,this._commandsQueue=new T({process:e=>{switch(e.type){case\"processed-edit\":return this._doEdit(e);case\"refresh\":return this._doRefresh(e.dataChanged);case\"update\":return this._doUpdate()}}}),this._visibilityOverrides=new Set,this._highlightIds=new Map,this._updateHighlight=p((async()=>this._proxy.setHighlight(Array.from(this._highlightIds.keys())))),this._uploadsLocked=!1,this._needsClusterSizeUpdate=!1,this.featureEffectView=new v,this._lastDefinitionExpression=null}destroy(){var e;o(this._updateClusterSizeTask,(e=>e.remove())),null==(e=this._proxy)||e.destroy(),this._commandsQueue.destroy()}initialize(){this.addResolvingPromise(Promise.all([this._initProxy(),this._initServiceOptions()])),this.handles.add([this.on(\"valueRangesChanged\",(e=>{this._set(\"_aggregateValueRanges\",e.valueRanges)})),c((()=>this.featureEffect),(e=>{this.featureEffectView.featureEffect=e}),{initial:!0,sync:!0})])}async _initProxy(){if(\"isTable\"in this.layer&&this.layer.isTable)throw new s(\"featurelayerview:table-not-supported\",\"table feature layer can't be displayed\",{layer:this.layer});this._proxy&&this._proxy.destroy();const e=this._createClientOptions();return this._set(\"_proxy\",new q({client:e})),this._proxy.when()}async _initServiceOptions(){return this._set(\"_serviceOptions\",await this._createServiceOptions()),this._serviceOptions}get orderByFields(){return\"stream\"!==this._serviceOptions.type&&this._serviceOptions.orderByFields}get labelsVisible(){const e=\"subtype-group\"===this.layer.type?this.layer.sublayers.items:[this.layer];return!this.suspended&&e.some((e=>e.labelingInfo&&e.labelsVisible))}get queryMode(){return this._serviceOptions.type}get renderingConfigHash(){if(!this.layer)return null;const e=this.availableFields,t=this.layer,i=this.view.floors,{definitionExpression:r}=t,s=\"subtype-group\"!==this.layer.type&&this.layer.labelsVisible&&this.layer.labelingInfo,a=\"renderer\"in t&&t.renderer,n=\"feature\"===t.type?t.gdbVersion:void 0,l=\"feature\"===t.type&&t.historicMoment?t.historicMoment.getTime():void 0,{timeExtent:o}=this,u=\"customParameters\"in t?JSON.stringify(t.customParameters):void 0,d=\"apiKey\"in t?t.apiKey:void 0,p=\"stream\"===t.type?`${JSON.stringify(t.geometryDefinition)}${t.definitionExpression}`:null,y=JSON.stringify(this.clips),c=t.featureReduction&&t.featureReduction.toJSON(),f=\"orderBy\"in this.layer&&JSON.stringify(this.layer.orderBy),g=\"sublayers\"in this.layer&&this.layer.sublayers.items.reduce(((e,t)=>e+`${t.visible?1:0}.${JSON.stringify(t.renderer)}.${t.labelsVisible}\\n.${JSON.stringify(t.labelingInfo)}`),\"\");return JSON.stringify({orderBy:f,sublayerHash:g,filterHash:h(this.filter)&&this.filter.toJSON(),effectHash:h(this.featureEffect)&&this.featureEffect.toJSON(),streamFilter:p,gdbVersion:n,definitionExpression:r,historicMoment:l,availableFields:e,renderer:a,labelingInfo:s,timeExtent:o,floors:i,clipsHash:y,featureReduction:c,customParameters:u,apiKey:d})}highlight(e){var t;let s;return e instanceof i?s=[e.getObjectId()]:\"number\"==typeof e||\"string\"==typeof e?s=[e]:Array.isArray(e)&&e.length>0?s=\"number\"==typeof e[0]||\"string\"==typeof e[0]?e:e.map((e=>null==e?void 0:e.getObjectId())):r.isCollection(e)&&e.length>0&&(s=e.map((e=>null==e?void 0:e.getObjectId())).toArray()),s=null==(t=s)?void 0:t.filter((e=>null!=e)),s&&s.length?(this._addHighlight(s),{remove:()=>this._removeHighlight(s)}):{remove:()=>{}}}hasHighlight(){return!!this._highlightIds.size}async hitTest(e,r){if(!this.tileRenderer)return null;const s=await this.tileRenderer.hitTest(r);if(0===s.length)return null;const{features:a,aggregates:n}=await this._proxy.getFeatures(s);return[...n.map((e=>this._createHittestResult(t.fromJSON(e)))),...a.map((e=>this._createHittestResult(i.fromJSON(e))))]}async queryAggregates(){return(await this._proxy.getAggregates()).map((e=>t.fromJSON(e)))}queryStatistics(){return this._proxy.queryStatistics()}async querySummaryStatistics(e,t,i){const r={...t,scale:this.view.scale};return this._proxy.querySummaryStatistics(this._cleanUpQuery(e),r,i)}async queryUniqueValues(e,t,i){const r={...t,scale:this.view.scale};return this._proxy.queryUniqueValues(this._cleanUpQuery(e),r,i)}async queryClassBreaks(e,t,i){const r={...t,scale:this.view.scale};return this._proxy.queryClassBreaks(this._cleanUpQuery(e),r,i)}async queryHistogram(e,t,i){const r={...t,scale:this.view.scale};return this._proxy.queryHistogram(this._cleanUpQuery(e),r,i)}queryFeatures(e,t){return this.queryFeaturesJSON(e,t).then((e=>{const t=R.fromJSON(e);return t.features.forEach((e=>this._setLayersForFeature(e))),t}))}queryVisibleFeatures(e,t){return this._proxy.queryVisibleFeatures(this._cleanUpQuery(e),t).then((e=>{const t=R.fromJSON(e);return t.features.forEach((e=>this._setLayersForFeature(e))),t}))}queryFeaturesJSON(e,t){return this._proxy.queryFeatures(this._cleanUpQuery(e),t)}queryObjectIds(e,t){return this._proxy.queryObjectIds(this._cleanUpQuery(e),t)}queryFeatureCount(e,t){return this._proxy.queryFeatureCount(this._cleanUpQuery(e),t)}queryExtent(e,t){return this._proxy.queryExtent(this._cleanUpQuery(e),t).then((e=>({count:e.count,extent:z.fromJSON(e.extent)})))}setVisibility(e,t){t?this._visibilityOverrides.delete(e):this._visibilityOverrides.add(e),this._update()}update(e){if(!this._tileStrategy||!this.tileRenderer)return;const{hasMissingTiles:t,added:i,removed:r}=this._tileStrategy.update(e);(i.length||r.length)&&this._proxy.updateTiles({added:i,removed:r}),t&&this.requestUpdate(),this.notifyChange(\"updating\")}attach(){this.view.timeline.record(`${this.layer.title} (FeatureLayer) Attach`),this._tileStrategy=new j({acquireTile:e=>this._acquireTile(e),releaseTile:e=>this._releaseTile(e),tileInfoView:this.view.featuresTilingScheme,buffer:0}),this.handles.add(c((()=>this.renderingConfigHash),(()=>this._update()),g),\"attach\"),\"stream\"!==this.layer.type&&this.handles.add(this.layer.on(\"edits\",(e=>this._edit(e))),\"attach\")}detach(){var e;this._commandsQueue.clear(),null==(e=this._proxy)||e.stop(),this.container.removeAllChildren(),this.handles.remove(\"attach\"),this.tileRenderer&&(this.tileRenderer.uninstall(this.container),this.tileRenderer=null),this._tileStrategy&&(this._tileStrategy.destroy(),this._tileStrategy=null),this._tileRendererHash=null}moveStart(){this.requestUpdate()}viewChange(){this.requestUpdate()}moveEnd(){this.requestUpdate()}isUpdating(){var e;const t=\"renderer\"in this.layer&&null!=this.layer.renderer,i=this._commandsQueue.updating,r=null!=this._updatingRequiredFieldsPromise,s=!this._proxy||!this._proxy.isReady,n=this._pipelineIsUpdating,l=null==this.tileRenderer||(null==(e=this.tileRenderer)?void 0:e.updating),o=t&&(i||r||s||n||l);return a(\"esri-2d-log-updating\")&&console.log(`Updating FLV2D: ${o}\\n  -> hasRenderer ${t}\\n  -> hasPendingCommand ${i}\\n  -> updatingRequiredFields ${r}\\n  -> updatingProxy ${s}\\n  -> updatingPipeline ${n}\\n  -> updatingTileRenderer ${l}\\n`),o}_createClientOptions(){return{setUpdating:e=>{this._set(\"_pipelineIsUpdating\",e)},emitEvent:e=>{this.emit(e.name,e.event)}}}async _detectQueryMode(e){var t;const i=\"path\"in e,r=\"editingInfo\"in this.layer&&(null==(t=this.layer.editingInfo)?void 0:t.lastEditDate),s=!!this.layer.refreshInterval,n=!r&&s;if(i&&(\"feature\"===this.layer.type||\"subtype-group\"===this.layer.type)&&\"point\"===this.layer.geometryType&&this.layer.capabilities.query.supportsPagination&&!this.layer.capabilities.operations.supportsEditing&&!n&&a(\"featurelayer-snapshot-enabled\"))try{const e=await this.layer.queryFeatureCount();if(e<=a(\"featurelayer-snapshot-point-min-threshold\"))return{mode:\"snapshot\",featureCount:e};const t=a(\"featurelayer-snapshot-point-max-threshold\"),i=a(\"featurelayer-snapshot-point-coverage\"),r=this.view.extent,s=u(this.layer.fullExtent),n=null==s?void 0:s.clone().intersection(r),l=h(n)?n.width*n.height:0,o=(null==s?void 0:s.width)*(null==s?void 0:s.height),d=0===o?0:l/o;if(e<=t&&d>=i)return{mode:\"snapshot\",featureCount:e}}catch(l){J.warn(\"mapview-feature-layer\",\"Encountered an error when querying for featureCount\",{error:l})}return{mode:\"on-demand\"}}async _createServiceOptions(){var e;const t=this.layer;if(\"stream\"===t.type)return null;const{capabilities:i,objectIdField:r}=t,s=t.fields.map((e=>e.toJSON())),a=h(t.fullExtent)&&t.fullExtent.toJSON(),l=V(t.geometryType),o=t.timeInfo&&t.timeInfo.toJSON()||null,u=t.spatialReference?t.spatialReference.toJSON():null,d=\"feature\"===t.type?t.globalIdField:null;let p;\"ogc-feature\"===t.type?p=t.source.getFeatureDefinition():H(t.source)?p=await t.source.openPorts():t.parsedUrl&&(p=n(t.parsedUrl),\"dynamicDataSource\"in t&&t.dynamicDataSource&&(p.query={layer:JSON.stringify({source:t.dynamicDataSource})}));const y=\"datesInUnknownTimezone\"in this.layer&&this.layer.datesInUnknownTimezone,c=null!=(e=\"subtypeField\"in this.layer&&this.layer.subtypeField)?e:null,{mode:f,featureCount:g}=await this._detectQueryMode(p);let m=this.layer.objectIdField;if(\"feature\"===this.layer.type&&h(this.layer.orderBy)&&this.layer.orderBy.length){const e=!this.layer.orderBy[0].valueExpression&&this.layer.orderBy[0].field;e&&(m=e)}return{type:f,timeReferenceUnknownClient:y,subtypeField:c,featureCount:g,globalIdField:d,maxRecordCount:i.query.maxRecordCount,tileMaxRecordCount:i.query.tileMaxRecordCount,capabilities:i,fields:s,fullExtent:a,geometryType:l,objectIdField:r,source:p,timeInfo:o,spatialReference:u,orderByFields:m}}async _createMemoryServiceOptions(e){const t=await e.openPorts();return{...this._createServiceOptions(),type:\"memory\",source:t}}_cleanUpQuery(e){const t=x.from(e)||this.createQuery();return t.outSpatialReference||(t.outSpatialReference=this.view.spatialReference),t}async _update(){return this._commandsQueue.push({type:\"update\"})}async _edit(e){if(this.suspended)return void this._clearTiles();return this._validateEdit(e)?this._commandsQueue.push({type:\"edit\",edits:e}):void 0}async doRefresh(e){if(this._tileStrategy.tileKeys().length)return this.suspended&&e?void this._clearTiles():this._commandsQueue.push({type:\"refresh\",dataChanged:e})}_clearTiles(){this._tileStrategy.tileKeys().length&&(this._proxy.updateTiles({added:[],removed:this._tileStrategy.tileKeys()}),this._tileStrategy.clear(),this.requestUpdate(),this._commandsQueue.clear(),this._update())}_validateEdit(e){const t=\"globalIdField\"in this.layer&&this.layer.globalIdField,i=e.deletedFeatures.some((e=>-1===e.objectId||!e.objectId)),r=t&&this.availableFields.includes(t);return i&&!r?(J.error(new s(\"mapview-apply-edits\",`Editing the specified service requires the layer's globalIdField, ${t} to be included the layer's outFields for updates to be reflected on the map`)),null):e}async _doUpdate(){try{if(this.destroyed||!this._hasRequiredSupport(this.layer)||!this._tileStrategy)return;const{featureEffectView:t,filter:i}=this;await this._updateRequiredFields();const{renderer:r}=this._getEffectiveRenderer();this._set(\"_effectiveRenderer\",r);const s=this._createSchemaConfig(),a=this._createConfiguration(s,i,t.filter),n=this._lastDefinitionExpression!==a.definitionExpression;this._lastDefinitionExpression=a.definitionExpression;const l=this._createTileRendererHash(r);if(\"snapshot\"===this._serviceOptions.type&&(a.schema.source.featureCount=this._serviceOptions.featureCount),l!==this._tileRendererHash){await this._initTileRenderer(r);const e=this.layer,t=\"stream\"===e.type?await this._initServiceOptions():this._serviceOptions;this.tileRenderer.onConfigUpdate(r),\"stream\"!==e.type&&H(e.source)&&(t.source=await e.source.openPorts());const i={added:this._tileStrategy.tileKeys(),removed:[]};await this._proxy.startup(this.view.featuresTilingScheme,a,t,i),this.hasHighlight()&&await this._proxy.setHighlight(Array.from(this._highlightIds.keys())),await this._onceTilesUpdated(),this.tileRenderer.onConfigUpdate(r)}else{\"snapshot\"===this._serviceOptions.type&&n&&(a.schema.source.featureCount=await this.layer.queryFeatureCount());const t=await this._proxy.update(a);(t.mesh||t.targets.aggregate)&&this._lockGPUUploads();try{await this._proxy.applyUpdate(t)}catch(e){y(e)||J.error(e)}(t.mesh||t.targets.aggregate)&&this._unlockGPUUploads(),this.tileRenderer.onConfigUpdate(r),this._updateClusterSizeVariable(),this._forceAttributeTextureUpload()}this._tileRendererHash=l,this.tileRenderer.invalidateLabels(),this.requestUpdate()}catch(e){}}async _doEdit(e){try{await this._proxy.onEdits(e)}catch(t){y(t),0}}async _doRefresh(e){var t;this._lockGPUUploads();try{await this._proxy.refresh(e)}catch(i){y(i),0}this._unlockGPUUploads(),null!=(t=this.layer)&&t.featureReduction&&this._updateClusterSizeVariable()}_updateClusterSizeVariable(){this._needsClusterSizeUpdate&&(this.tileRenderer.onConfigUpdate(this._effectiveRenderer),this._needsClusterSizeUpdate=!1)}_createUpdateClusterSizeTask(e,t){return this.watch(\"_aggregateValueRanges\",(async i=>{this._updateClusterEffectiveRendererSizeVariable(e,t,i),this._needsClusterSizeUpdate=!0,this._uploadsLocked||this._updateClusterSizeVariable()}))}async _updateClusterEffectiveRendererSizeVariable(e,t,i){if(e.dynamicClusterSize&&\"visualVariables\"in e&&e.visualVariables){const r=C(e.visualVariables);if(h(r)&&\"cluster_count\"===r.field){const s=e.visualVariables.indexOf(r);e.visualVariables[s]=I(t,i);const a=e.clone();a.dynamicClusterSize=!0,this._set(\"_effectiveRenderer\",a)}}}_getEffectiveRenderer(){const e=\"renderer\"in this.layer&&this.layer.renderer,t=this.layer.featureReduction;if(h(this._updateClusterSizeTask)&&(this._updateClusterSizeTask.remove(),this._updateClusterSizeTask=null),t&&\"cluster\"===t.type&&E(e)){const i=t,r=[],s=O(r,e,i,this._aggregateValueRanges);return o(this._updateClusterSizeTask,(e=>e.remove())),this._updateClusterSizeTask=this._createUpdateClusterSizeTask(s,i),{renderer:s,aggregateFields:r,featureReduction:t}}return{renderer:e,aggregateFields:[],featureReduction:null}}_acquireTile(e){const t=this.tileRenderer.acquireTile(e);return t.once(\"attach\",(()=>{this.requestUpdate()})),t}_releaseTile(e){this.tileRenderer.releaseTile(e)}async _initTileRenderer(e){const t=await F(e,{layerView:this,tileInfoView:this.view.featuresTilingScheme,layer:this.layer});return this.tileRenderer&&(this._tileStrategy.clear(),this.tileRenderer.uninstall(this.container),this.tileRenderer.destroy(),this.tileRenderer=null),this.destroyed?null:(this._proxy.tileRenderer=t,this._set(\"tileRenderer\",t),this.tileRenderer.install(this.container),this.tileRenderer.onConfigUpdate(e),this.requestUpdate(),this.tileRenderer)}_createTileRendererHash(e){return`${\"heatmap\"===e.type?\"heatmap\":\"symbol\"}`}get hasFilter(){const e=!!(\"floorInfo\"in this.layer&&this.layer.floorInfo&&this.view.floors&&this.view.floors.length);return!!this.filter||e||!!this._visibilityOverrides.size||!!this.timeExtent}_injectOverrides(e){const t=h(e)?e.timeExtent:null,i=h(this.timeExtent)&&h(t)?this.timeExtent.intersection(t):this.timeExtent||t;let r=null;const s=\"floorInfo\"in this.layer&&this.layer.floorInfo;if(s){const t=h(e)&&e.where;r=this._addFloorFilterClause(t)}if(!this._visibilityOverrides.size&&!i&&!s)return h(e)?e.toJSON():null;(e=h(e)&&e.clone()||new b).timeExtent=i,r&&(e.where=r);const a=e.toJSON();return a.hiddenIds=Array.from(this._visibilityOverrides),a}_addFloorFilterClause(e){const t=this.layer;let i=e||\"\";if(\"floorInfo\"in t&&t.floorInfo){var r;let e=this.view.floors;if(!e||!e.length)return i;null!=(r=t.floorInfo.viewAllLevelIds)&&r.length&&(e=t.floorInfo.viewAllLevelIds);const s=e.filter((e=>\"\"!==e)).map((e=>\"'\"+e+\"'\"));s.push(\"''\");const a=t.floorInfo.floorField;let n=\"(\"+a+\" IN ({ids}) OR \"+a+\" IS NULL)\";if(n=n.replace(\"{ids}\",s.join(\", \")),h(i)&&i.includes(a)){let e=new RegExp(\"AND \\\\(\"+a+\".*NULL\\\\)\",\"g\");i=i.replace(e,\"\"),e=new RegExp(\"\\\\(\"+a+\".*NULL\\\\)\",\"g\"),i=i.replace(e,\"\"),i=i.replace(/\\s+/g,\" \").trim()}i=\"\"!==i?\"(\"+i+\") AND \"+n:n}return\"\"!==i?i:null}_createConfiguration(e,t,i){const r=\"feature\"===this.layer.type&&this.layer.historicMoment?this.layer.historicMoment.getTime():void 0,s=\"feature\"===this.layer.type?this.layer.gdbVersion:void 0,a=new Array(S),n=this._injectOverrides(t);a[0]=n,a[1]=h(i)?i.toJSON():null;const l=U(e);if(d(l))return null;const o=k();return{definitionExpression:this.layer.definitionExpression,availableFields:this.availableFields,gdbVersion:s,historicMoment:r,devicePixelRatio:window.devicePixelRatio||1,filters:a,schema:l,supportsTextureFloat:o.supportsTextureFloat,maxTextureSize:o.maxTextureSize}}_hasRequiredSupport(e){var t;return!(\"renderer\"in e&&\"dot-density\"===(null==(t=e.renderer)?void 0:t.type)&&!k().supportsTextureFloat)||(J.error(new s(\"webgl-missing-extension\",\"Missing WebGL extension OES_Texture_Float which is required for DotDensity\")),!1)}_onceTilesUpdated(){return this.requestUpdate(),f((()=>!this._pipelineIsUpdating))}_lockGPUUploads(){this.tileRenderer&&(this._uploadsLocked=!0,this.tileRenderer.lockGPUUploads())}_unlockGPUUploads(){this.tileRenderer&&(this._uploadsLocked=!1,this.tileRenderer.unlockGPUUploads())}_forceAttributeTextureUpload(){this.tileRenderer&&this.tileRenderer.forceAttributeTextureUpload()}_createSchemaConfig(){const e=\"feature\"===this.layer.type?this.layer.historicMoment:null,t=\"feature\"===this.layer.type?this.layer.gdbVersion:null;return{renderer:\"renderer\"in this.layer&&this.layer.renderer,spatialReference:this.layer.spatialReference,timeExtent:this.layer.timeExtent,definitionExpression:this.layer.definitionExpression,featureReduction:this.layer.featureReduction,fields:this.layer.fields,geometryType:this.layer.geometryType,historicMoment:e,labelsVisible:\"labelsVisible\"in this.layer&&this.layer.labelsVisible,labelingInfo:\"labelingInfo\"in this.layer&&this.layer.labelingInfo,availableFields:this.availableFields,featureEffect:this.featureEffect,filter:this.filter,gdbVersion:t,pixelBuffer:0,orderBy:\"orderBy\"in this.layer&&this.layer.orderBy?this.layer.orderBy:null,customParameters:{...\"customParameters\"in this.layer?this.layer.customParameters:void 0,token:\"apiKey\"in this.layer?this.layer.apiKey:void 0}}}_addHighlight(e){for(const t of e)if(this._highlightIds.has(t)){const e=this._highlightIds.get(t);this._highlightIds.set(t,e+1)}else this._highlightIds.set(t,1);this._updateHighlight().catch((e=>{y(e)||J.error(e)}))}_removeHighlight(e){for(const t of e)if(this._highlightIds.has(t)){const e=this._highlightIds.get(t)-1;0===e?this._highlightIds.delete(t):this._highlightIds.set(t,e)}this._updateHighlight().catch((e=>{y(e)||J.error(e)}))}_setLayersForFeature(e){const t=this.layer;e.layer=t,e.sourceLayer=t}_createHittestResult(e){return this._setLayersForFeature(e),h(e.geometry)&&(e.geometry.spatialReference=this.view.spatialReference),e}};e([m()],Q.prototype,\"_serviceOptions\",void 0),e([m()],Q.prototype,\"_proxy\",void 0),e([m()],Q.prototype,\"_pipelineIsUpdating\",void 0),e([m()],Q.prototype,\"_effectiveRenderer\",void 0),e([m()],Q.prototype,\"_aggregateValueRanges\",void 0),e([m()],Q.prototype,\"_commandsQueue\",void 0),e([m()],Q.prototype,\"featureEffectView\",void 0),e([m()],Q.prototype,\"labelsVisible\",null),e([m({readOnly:!0})],Q.prototype,\"queryMode\",null),e([m()],Q.prototype,\"renderingConfigHash\",null),e([m()],Q.prototype,\"tileRenderer\",void 0),e([m()],Q.prototype,\"updating\",void 0),Q=e([_(\"esri.views.2d.layers.FeatureLayerView2D\")],Q);const A=Q;export{A as default};\n"]},"metadata":{},"sourceType":"module"}