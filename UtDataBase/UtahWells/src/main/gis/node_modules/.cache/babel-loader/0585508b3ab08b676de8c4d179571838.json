{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport { isSome as e, isNone as t, unwrap as s } from \"../../../../core/maybe.js\";\nimport { createResolver as r } from \"../../../../core/promiseUtils.js\";\nimport { create as i } from \"../../../../geometry/support/aaBoundingRect.js\";\nimport { SymbolFader as o } from \"./decluttering/SymbolFader.js\";\nimport { Visibility as l, StyleLayerType as n } from \"./style/StyleDefinition.js\";\nimport { WGLDrawPhase as a } from \"../webgl/enums.js\";\nimport { RenderableTile as d } from \"../webgl/RenderableTile.js\";\nimport h from \"../webgl/TileContainer.js\";\nimport c from \"../../tiling/TileCoverage.js\";\nimport y from \"../../tiling/TileKey.js\";\nimport { StencilOperation as p, CompareFunction as m, BlendFactor as u } from \"../../../webgl/enums.js\";\nconst _ = 1e-6;\n\nfunction f(e, t) {\n  if (e) {\n    const s = e.getLayoutProperty(\"visibility\");\n    if (!s || s.getValue() !== l.NONE && (void 0 === e.minzoom || e.minzoom < t + _) && (void 0 === e.maxzoom || e.maxzoom >= t - _)) return !0;\n  }\n\n  return !1;\n}\n\nclass b extends h {\n  constructor(e) {\n    super(e), this._backgroundTiles = [], this._pointToCallbacks = new Map();\n  }\n\n  destroy() {\n    this.removeAllChildren(), this._spriteMosaic && (this._spriteMosaic.dispose(), this._spriteMosaic = null), this._glyphMosaic && (this._glyphMosaic.dispose(), this._glyphMosaic = null), e(this._symbolFader) && (this._symbolFader.clear(), this._symbolFader = null), this._styleRepository = null, this._backgroundTiles = [], this._pointToCallbacks.clear();\n  }\n\n  setStyleResources(e, r, i) {\n    if (this._spriteMosaic = e, this._glyphMosaic = r, this._styleRepository = i, t(this._symbolFader)) {\n      const e = new o(this._styleRepository, this.children);\n      e.on(\"fade-start\", () => {\n        this.emit(\"fade-start\"), this.requestRender();\n      }), e.on(\"fade-complete\", () => {\n        this.emit(\"fade-complete\"), this.requestRender();\n      }), this._symbolFader = e;\n    }\n\n    s(this._symbolFader).styleRepository = i;\n  }\n\n  setSpriteMosaic(e) {\n    this._spriteMosaic.dispose(), this._spriteMosaic = e;\n  }\n\n  deleteStyleLayers(t) {\n    e(this._symbolFader) && this._symbolFader.deleteStyleLayers(t);\n  }\n\n  async hitTest(e) {\n    const t = r();\n    return this._pointToCallbacks.set(e, t), this.requestRender(), t.promise;\n  }\n\n  enterTileInvalidation() {\n    for (const e of this.children) e.invalidating = !0;\n  }\n\n  createRenderParams(e) {\n    return { ...super.createRenderParams(e),\n      renderPass: null,\n      styleLayer: null,\n      styleLayerUID: -1,\n      glyphMosaic: this._glyphMosaic,\n      spriteMosaic: this._spriteMosaic,\n      hasClipping: !!this._clippingInfos\n    };\n  }\n\n  doRender(e) {\n    !this.visible || e.drawPhase !== a.MAP && e.drawPhase !== a.DEBUG || void 0 === this._spriteMosaic || super.doRender(e);\n  }\n\n  addChild(t) {\n    return super.addChild(t), e(this._symbolFader) ? this._symbolFader.addTile(t) : t.decluttered = !0, this.requestRender(), t;\n  }\n\n  removeChild(t) {\n    return e(this._symbolFader) && this._symbolFader.removeTile(t), this.requestRender(), super.removeChild(t);\n  }\n\n  renderChildren(e) {\n    const {\n      drawPhase: t\n    } = e;\n\n    if (t !== a.DEBUG) {\n      if (this._doRender(e), this._pointToCallbacks.size > 0) {\n        e.drawPhase = a.HITTEST;\n        const s = e.painter.effects.hittestVTL;\n        s.bind(e), this._doRender(e), s.draw(e, this._pointToCallbacks), s.unbind(e), e.drawPhase = t;\n      }\n    } else super.renderChildren(e);\n  }\n\n  removeAllChildren() {\n    for (let t = 0; t < this.children.length; t++) {\n      const s = this.children[t];\n      e(this._symbolFader) && this._symbolFader.removeTile(s), s.dispose();\n    }\n\n    super.removeAllChildren();\n  }\n\n  getStencilTarget() {\n    return this.children.filter(e => e.neededForCoverage && e.hasData());\n  }\n\n  restartDeclutter() {\n    e(this._symbolFader) && this._symbolFader.restartDeclutter();\n  }\n\n  _doRender(e) {\n    const {\n      context: t\n    } = e,\n          s = this._styleRepository;\n    if (!s) return;\n    const r = s.layers;\n    let i = !0;\n    e.drawPhase === a.HITTEST && (i = !1), s.backgroundBucketIds.length > 0 && (e.renderPass = \"background\", this._renderBackgroundLayers(e, s.backgroundBucketIds)), super.renderChildren(e), e.drawPhase === a.MAP && this._fade(e.displayLevel, e.state);\n    const o = this.children.filter(e => e.visible && e.hasData());\n    if (!o || 0 === o.length) return t.bindVAO(), t.setStencilTestEnabled(!0), void t.setBlendingEnabled(!0);\n\n    for (const l of o) l.triangleCount = 0;\n\n    t.setStencilWriteMask(0), t.setColorMask(!0, !0, !0, !0), t.setStencilOp(p.KEEP, p.KEEP, p.REPLACE), t.setStencilTestEnabled(!0), t.setBlendingEnabled(!1), t.setDepthTestEnabled(!0), t.setDepthWriteEnabled(!0), t.setDepthFunction(m.LEQUAL), t.setClearDepth(1), t.clear(t.gl.DEPTH_BUFFER_BIT), e.renderPass = \"opaque\";\n\n    for (let l = r.length - 1; l >= 0; l--) this._renderStyleLayer(r[l], e, o);\n\n    t.setDepthWriteEnabled(!1), t.setBlendingEnabled(i), t.setBlendFunctionSeparate(u.ONE, u.ONE_MINUS_SRC_ALPHA, u.ONE, u.ONE_MINUS_SRC_ALPHA), e.renderPass = \"translucent\";\n\n    for (let l = 0; l < r.length; l++) this._renderStyleLayer(r[l], e, o);\n\n    t.setDepthTestEnabled(!1), e.renderPass = \"symbol\";\n\n    for (let l = 0; l < r.length; l++) this._renderStyleLayer(r[l], e, o);\n\n    t.bindVAO(), t.setStencilTestEnabled(!0), t.setBlendingEnabled(!0);\n  }\n\n  _fade(t, s) {\n    e(this._symbolFader) && (this._symbolFader.update(t, s) || this.requestRender());\n  }\n\n  _renderStyleLayer(e, t, s) {\n    const {\n      painter: r,\n      renderPass: i\n    } = t;\n    if (void 0 === e) return;\n    const o = e.getLayoutProperty(\"visibility\");\n    if (o && o.getValue() === l.NONE) return;\n    let a;\n\n    switch (e.type) {\n      case n.BACKGROUND:\n        return;\n\n      case n.FILL:\n        if (\"opaque\" !== i && \"translucent\" !== t.renderPass) return;\n        a = \"vtlFill\";\n        break;\n\n      case n.LINE:\n        if (\"translucent\" !== i) return;\n        a = \"vtlLine\";\n        break;\n\n      case n.CIRCLE:\n        if (\"symbol\" !== i) return;\n        a = \"vtlCircle\";\n        break;\n\n      case n.SYMBOL:\n        if (\"symbol\" !== i) return;\n        a = \"vtlSymbol\";\n    }\n\n    if (s = e.type === n.SYMBOL ? s.filter(e => e.decluttered) : s.filter(e => e.neededForCoverage), \"vtlSymbol\" !== a) {\n      const r = t.displayLevel;\n      if (0 === s.length || void 0 !== e.minzoom && e.minzoom >= r + _ || void 0 !== e.maxzoom && e.maxzoom < r - _) return;\n    }\n\n    const d = e.uid;\n    t.styleLayerUID = d, t.styleLayer = e;\n\n    for (const l of s) if (l.layerData.has(d)) {\n      r.renderObjects(t, s, a);\n      break;\n    }\n  }\n\n  _renderBackgroundLayers(t, s) {\n    const {\n      context: r,\n      displayLevel: o,\n      painter: l,\n      state: h\n    } = t,\n          u = this._styleRepository;\n\n    let _ = !1;\n\n    for (const e of s) {\n      if (u.getLayerById(e).type === n.BACKGROUND && f(u.getLayerById(e), o)) {\n        _ = !0;\n        break;\n      }\n    }\n\n    if (!_) return;\n\n    const b = this._tileInfoView.getTileCoverage(t.state, 0, \"smallest\"),\n          {\n      spans: g,\n      lodInfo: T\n    } = b,\n          {\n      level: E\n    } = T,\n          C = i(),\n          L = [];\n\n    if (this._renderPasses) {\n      const s = this._renderPasses[0];\n      e(this._clippingInfos) && (s.brushes[0].prepareState(t, this._clippingInfos[0]), s.brushes[0].drawMany(t, this._clippingInfos));\n    }\n\n    const v = this._backgroundTiles;\n    let S,\n        P = 0;\n\n    for (const {\n      row: e,\n      colFrom: n,\n      colTo: a\n    } of g) for (let t = n; t <= a; t++) {\n      if (P < v.length) S = v[P], S.key.set(E, e, T.normalizeCol(t), T.getWorldForColumn(t)), this._tileInfoView.getTileBounds(C, S.key, !1), S.x = C[0], S.y = C[3];else {\n        const s = new y(E, e, T.normalizeCol(t), T.getWorldForColumn(t)),\n              r = this._tileInfoView.getTileBounds(i(), s);\n\n        S = new d(s, r[0], r[3], 512, 512, 4096, 4096), v.push(S);\n      }\n      S.setTransform(h, this._tileInfoView.getTileResolution(S.key)), L.push(S), P++;\n    }\n\n    r.setStencilWriteMask(0), r.setColorMask(!0, !0, !0, !0), r.setStencilOp(p.KEEP, p.KEEP, p.REPLACE), r.setStencilFunction(m.EQUAL, 0, 255);\n    let R = !0;\n    t.drawPhase === a.HITTEST && (R = !1), r.setStencilTestEnabled(R);\n\n    for (const e of s) {\n      const s = u.getLayerById(e);\n      s.type === n.BACKGROUND && f(s, o) && (t.styleLayerUID = s.uid, t.styleLayer = s, l.renderObjects(t, L, \"vtlBackground\"));\n    }\n\n    c.pool.release(b);\n  }\n\n}\n\nexport { b as VectorTileContainer };","map":{"version":3,"sources":["D:/Github/CUSP_DataBase/CUSP_DB/src/main/gis/node_modules/@arcgis/core/views/2d/engine/vectorTiles/VectorTileContainer.js"],"names":["isSome","e","isNone","t","unwrap","s","createResolver","r","create","i","SymbolFader","o","Visibility","l","StyleLayerType","n","WGLDrawPhase","a","RenderableTile","d","h","c","y","StencilOperation","p","CompareFunction","m","BlendFactor","u","_","f","getLayoutProperty","getValue","NONE","minzoom","maxzoom","b","constructor","_backgroundTiles","_pointToCallbacks","Map","destroy","removeAllChildren","_spriteMosaic","dispose","_glyphMosaic","_symbolFader","clear","_styleRepository","setStyleResources","children","on","emit","requestRender","styleRepository","setSpriteMosaic","deleteStyleLayers","hitTest","set","promise","enterTileInvalidation","invalidating","createRenderParams","renderPass","styleLayer","styleLayerUID","glyphMosaic","spriteMosaic","hasClipping","_clippingInfos","doRender","visible","drawPhase","MAP","DEBUG","addChild","addTile","decluttered","removeChild","removeTile","renderChildren","_doRender","size","HITTEST","painter","effects","hittestVTL","bind","draw","unbind","length","getStencilTarget","filter","neededForCoverage","hasData","restartDeclutter","context","layers","backgroundBucketIds","_renderBackgroundLayers","_fade","displayLevel","state","bindVAO","setStencilTestEnabled","setBlendingEnabled","triangleCount","setStencilWriteMask","setColorMask","setStencilOp","KEEP","REPLACE","setDepthTestEnabled","setDepthWriteEnabled","setDepthFunction","LEQUAL","setClearDepth","gl","DEPTH_BUFFER_BIT","_renderStyleLayer","setBlendFunctionSeparate","ONE","ONE_MINUS_SRC_ALPHA","update","type","BACKGROUND","FILL","LINE","CIRCLE","SYMBOL","uid","layerData","has","renderObjects","getLayerById","_tileInfoView","getTileCoverage","spans","g","lodInfo","T","level","E","C","L","_renderPasses","brushes","prepareState","drawMany","v","S","P","row","colFrom","colTo","key","normalizeCol","getWorldForColumn","getTileBounds","x","push","setTransform","getTileResolution","setStencilFunction","EQUAL","R","pool","release","VectorTileContainer"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport{isSome as e,isNone as t,unwrap as s}from\"../../../../core/maybe.js\";import{createResolver as r}from\"../../../../core/promiseUtils.js\";import{create as i}from\"../../../../geometry/support/aaBoundingRect.js\";import{SymbolFader as o}from\"./decluttering/SymbolFader.js\";import{Visibility as l,StyleLayerType as n}from\"./style/StyleDefinition.js\";import{WGLDrawPhase as a}from\"../webgl/enums.js\";import{RenderableTile as d}from\"../webgl/RenderableTile.js\";import h from\"../webgl/TileContainer.js\";import c from\"../../tiling/TileCoverage.js\";import y from\"../../tiling/TileKey.js\";import{StencilOperation as p,CompareFunction as m,BlendFactor as u}from\"../../../webgl/enums.js\";const _=1e-6;function f(e,t){if(e){const s=e.getLayoutProperty(\"visibility\");if(!s||s.getValue()!==l.NONE&&(void 0===e.minzoom||e.minzoom<t+_)&&(void 0===e.maxzoom||e.maxzoom>=t-_))return!0}return!1}class b extends h{constructor(e){super(e),this._backgroundTiles=[],this._pointToCallbacks=new Map}destroy(){this.removeAllChildren(),this._spriteMosaic&&(this._spriteMosaic.dispose(),this._spriteMosaic=null),this._glyphMosaic&&(this._glyphMosaic.dispose(),this._glyphMosaic=null),e(this._symbolFader)&&(this._symbolFader.clear(),this._symbolFader=null),this._styleRepository=null,this._backgroundTiles=[],this._pointToCallbacks.clear()}setStyleResources(e,r,i){if(this._spriteMosaic=e,this._glyphMosaic=r,this._styleRepository=i,t(this._symbolFader)){const e=new o(this._styleRepository,this.children);e.on(\"fade-start\",(()=>{this.emit(\"fade-start\"),this.requestRender()})),e.on(\"fade-complete\",(()=>{this.emit(\"fade-complete\"),this.requestRender()})),this._symbolFader=e}s(this._symbolFader).styleRepository=i}setSpriteMosaic(e){this._spriteMosaic.dispose(),this._spriteMosaic=e}deleteStyleLayers(t){e(this._symbolFader)&&this._symbolFader.deleteStyleLayers(t)}async hitTest(e){const t=r();return this._pointToCallbacks.set(e,t),this.requestRender(),t.promise}enterTileInvalidation(){for(const e of this.children)e.invalidating=!0}createRenderParams(e){return{...super.createRenderParams(e),renderPass:null,styleLayer:null,styleLayerUID:-1,glyphMosaic:this._glyphMosaic,spriteMosaic:this._spriteMosaic,hasClipping:!!this._clippingInfos}}doRender(e){!this.visible||e.drawPhase!==a.MAP&&e.drawPhase!==a.DEBUG||void 0===this._spriteMosaic||super.doRender(e)}addChild(t){return super.addChild(t),e(this._symbolFader)?this._symbolFader.addTile(t):t.decluttered=!0,this.requestRender(),t}removeChild(t){return e(this._symbolFader)&&this._symbolFader.removeTile(t),this.requestRender(),super.removeChild(t)}renderChildren(e){const{drawPhase:t}=e;if(t!==a.DEBUG){if(this._doRender(e),this._pointToCallbacks.size>0){e.drawPhase=a.HITTEST;const s=e.painter.effects.hittestVTL;s.bind(e),this._doRender(e),s.draw(e,this._pointToCallbacks),s.unbind(e),e.drawPhase=t}}else super.renderChildren(e)}removeAllChildren(){for(let t=0;t<this.children.length;t++){const s=this.children[t];e(this._symbolFader)&&this._symbolFader.removeTile(s),s.dispose()}super.removeAllChildren()}getStencilTarget(){return this.children.filter((e=>e.neededForCoverage&&e.hasData()))}restartDeclutter(){e(this._symbolFader)&&this._symbolFader.restartDeclutter()}_doRender(e){const{context:t}=e,s=this._styleRepository;if(!s)return;const r=s.layers;let i=!0;e.drawPhase===a.HITTEST&&(i=!1),s.backgroundBucketIds.length>0&&(e.renderPass=\"background\",this._renderBackgroundLayers(e,s.backgroundBucketIds)),super.renderChildren(e),e.drawPhase===a.MAP&&this._fade(e.displayLevel,e.state);const o=this.children.filter((e=>e.visible&&e.hasData()));if(!o||0===o.length)return t.bindVAO(),t.setStencilTestEnabled(!0),void t.setBlendingEnabled(!0);for(const l of o)l.triangleCount=0;t.setStencilWriteMask(0),t.setColorMask(!0,!0,!0,!0),t.setStencilOp(p.KEEP,p.KEEP,p.REPLACE),t.setStencilTestEnabled(!0),t.setBlendingEnabled(!1),t.setDepthTestEnabled(!0),t.setDepthWriteEnabled(!0),t.setDepthFunction(m.LEQUAL),t.setClearDepth(1),t.clear(t.gl.DEPTH_BUFFER_BIT),e.renderPass=\"opaque\";for(let l=r.length-1;l>=0;l--)this._renderStyleLayer(r[l],e,o);t.setDepthWriteEnabled(!1),t.setBlendingEnabled(i),t.setBlendFunctionSeparate(u.ONE,u.ONE_MINUS_SRC_ALPHA,u.ONE,u.ONE_MINUS_SRC_ALPHA),e.renderPass=\"translucent\";for(let l=0;l<r.length;l++)this._renderStyleLayer(r[l],e,o);t.setDepthTestEnabled(!1),e.renderPass=\"symbol\";for(let l=0;l<r.length;l++)this._renderStyleLayer(r[l],e,o);t.bindVAO(),t.setStencilTestEnabled(!0),t.setBlendingEnabled(!0)}_fade(t,s){e(this._symbolFader)&&(this._symbolFader.update(t,s)||this.requestRender())}_renderStyleLayer(e,t,s){const{painter:r,renderPass:i}=t;if(void 0===e)return;const o=e.getLayoutProperty(\"visibility\");if(o&&o.getValue()===l.NONE)return;let a;switch(e.type){case n.BACKGROUND:return;case n.FILL:if(\"opaque\"!==i&&\"translucent\"!==t.renderPass)return;a=\"vtlFill\";break;case n.LINE:if(\"translucent\"!==i)return;a=\"vtlLine\";break;case n.CIRCLE:if(\"symbol\"!==i)return;a=\"vtlCircle\";break;case n.SYMBOL:if(\"symbol\"!==i)return;a=\"vtlSymbol\"}if(s=e.type===n.SYMBOL?s.filter((e=>e.decluttered)):s.filter((e=>e.neededForCoverage)),\"vtlSymbol\"!==a){const r=t.displayLevel;if(0===s.length||void 0!==e.minzoom&&e.minzoom>=r+_||void 0!==e.maxzoom&&e.maxzoom<r-_)return}const d=e.uid;t.styleLayerUID=d,t.styleLayer=e;for(const l of s)if(l.layerData.has(d)){r.renderObjects(t,s,a);break}}_renderBackgroundLayers(t,s){const{context:r,displayLevel:o,painter:l,state:h}=t,u=this._styleRepository;let _=!1;for(const e of s){if(u.getLayerById(e).type===n.BACKGROUND&&f(u.getLayerById(e),o)){_=!0;break}}if(!_)return;const b=this._tileInfoView.getTileCoverage(t.state,0,\"smallest\"),{spans:g,lodInfo:T}=b,{level:E}=T,C=i(),L=[];if(this._renderPasses){const s=this._renderPasses[0];e(this._clippingInfos)&&(s.brushes[0].prepareState(t,this._clippingInfos[0]),s.brushes[0].drawMany(t,this._clippingInfos))}const v=this._backgroundTiles;let S,P=0;for(const{row:e,colFrom:n,colTo:a}of g)for(let t=n;t<=a;t++){if(P<v.length)S=v[P],S.key.set(E,e,T.normalizeCol(t),T.getWorldForColumn(t)),this._tileInfoView.getTileBounds(C,S.key,!1),S.x=C[0],S.y=C[3];else{const s=new y(E,e,T.normalizeCol(t),T.getWorldForColumn(t)),r=this._tileInfoView.getTileBounds(i(),s);S=new d(s,r[0],r[3],512,512,4096,4096),v.push(S)}S.setTransform(h,this._tileInfoView.getTileResolution(S.key)),L.push(S),P++}r.setStencilWriteMask(0),r.setColorMask(!0,!0,!0,!0),r.setStencilOp(p.KEEP,p.KEEP,p.REPLACE),r.setStencilFunction(m.EQUAL,0,255);let R=!0;t.drawPhase===a.HITTEST&&(R=!1),r.setStencilTestEnabled(R);for(const e of s){const s=u.getLayerById(e);s.type===n.BACKGROUND&&f(s,o)&&(t.styleLayerUID=s.uid,t.styleLayer=s,l.renderObjects(t,L,\"vtlBackground\"))}c.pool.release(b)}}export{b as VectorTileContainer};\n"]},"metadata":{},"sourceType":"module"}