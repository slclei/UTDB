{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport e from \"../../../../../../core/has.js\";\nimport { isSome as t, unwrap as r } from \"../../../../../../core/maybe.js\";\nimport s from \"../../../../../../core/workers/Connection.js\";\nimport { toQuantizationTransform as i } from \"../../../../../../geometry/support/quantizationUtils.js\";\nimport { convertFromFeatureSet as a, quantizeOptimizedFeatureSet as o } from \"../../../../../../layers/graphics/featureConversionUtils.js\";\nimport { queryOptimizedFeatureSet as n } from \"../../../../../../layers/ogc/ogcFeatureUtils.js\";\nimport { executeQueryPBFBuffer as c, executeQuery as u } from \"../../../../../../rest/query/operations/query.js\";\nimport { FeatureSetReaderJSON as m } from \"../../support/FeatureSetReaderJSON.js\";\nimport { FeatureSetReaderPBF as p } from \"../../support/FeatureSetReaderPBF.js\";\n\nclass l {\n  constructor(e) {\n    this.service = e;\n  }\n\n  destroy() {}\n\n}\n\nfunction f(e) {\n  return Array.isArray(e.source);\n}\n\nfunction y(e) {\n  return e && e.capabilities && e.collection && e.layerDefinition;\n}\n\nfunction h(t) {\n  const {\n    capabilities: r\n  } = t;\n  return y(t.source) ? new w(t) : f(t) ? new v(t) : r.query.supportsFormatPBF && e(\"featurelayer-pbf\") ? new F(t) : new q(t);\n}\n\nasync function d(e) {\n  const t = new s();\n  return await t.open(e, {}), t;\n}\n\nclass v extends l {\n  constructor(e) {\n    super(e), this._portsOpen = d(e.source).then(e => this.client = e);\n  }\n\n  destroy() {\n    this.client.close(), this.client = null;\n  }\n\n  async executeQuery(e, t) {\n    await this._portsOpen;\n    const r = await this.client.invoke(\"queryFeatures\", e.toJSON(), t);\n    return m.fromFeatureSet(r, this.service);\n  }\n\n}\n\nclass F extends l {\n  async executeQuery(e, t) {\n    const {\n      data: r\n    } = await c(this.service.source, e, t),\n          s = !e.quantizationParameters;\n    return p.fromBuffer(r, this.service, s);\n  }\n\n}\n\nclass q extends l {\n  async executeQuery(e, s) {\n    const {\n      source: n,\n      capabilities: c,\n      spatialReference: p,\n      objectIdField: l,\n      geometryType: f\n    } = this.service;\n\n    if (t(e.quantizationParameters) && !c.query.supportsQuantization) {\n      const t = e.clone(),\n            c = i(r(t.quantizationParameters));\n      t.quantizationParameters = null;\n      const {\n        data: f\n      } = await u(n, t, p, s),\n            y = a(f, l);\n      return o(c, y), m.fromOptimizedFeatureSet(y, this.service);\n    }\n\n    const {\n      data: y\n    } = await u(n, e, this.service.spatialReference, s);\n    var h;\n    \"esriGeometryPoint\" === f && (y.features = null == (h = y.features) ? void 0 : h.filter(e => {\n      if (t(e.geometry)) {\n        const t = e.geometry;\n        return Number.isFinite(t.x) && Number.isFinite(t.y);\n      }\n\n      return !0;\n    }));\n    return m.fromFeatureSet(y, this.service);\n  }\n\n}\n\nclass w extends l {\n  async executeQuery(e, t) {\n    const {\n      capabilities: s\n    } = this.service;\n\n    if (e.quantizationParameters && !s.query.supportsQuantization) {\n      const s = e.clone(),\n            a = i(r(s.quantizationParameters));\n      s.quantizationParameters = null;\n      const c = await n(this.service.source, e, t);\n      return o(a, c), m.fromOptimizedFeatureSet(c, this.service);\n    }\n\n    const a = await n(this.service.source, e, t);\n    return m.fromOptimizedFeatureSet(a, this.service);\n  }\n\n}\n\nexport { l as SourceAdapter, h as createSourceAdapter };","map":{"version":3,"sources":["D:/Github/CUSP_DataBase/CUSP_DB/src/main/gis/node_modules/@arcgis/core/views/2d/layers/features/controllers/support/sourceAdapters.js"],"names":["e","isSome","t","unwrap","r","s","toQuantizationTransform","i","convertFromFeatureSet","a","quantizeOptimizedFeatureSet","o","queryOptimizedFeatureSet","n","executeQueryPBFBuffer","c","executeQuery","u","FeatureSetReaderJSON","m","FeatureSetReaderPBF","p","l","constructor","service","destroy","f","Array","isArray","source","y","capabilities","collection","layerDefinition","h","w","v","query","supportsFormatPBF","F","q","d","open","_portsOpen","then","client","close","invoke","toJSON","fromFeatureSet","data","quantizationParameters","fromBuffer","spatialReference","objectIdField","geometryType","supportsQuantization","clone","fromOptimizedFeatureSet","features","filter","geometry","Number","isFinite","x","SourceAdapter","createSourceAdapter"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport e from\"../../../../../../core/has.js\";import{isSome as t,unwrap as r}from\"../../../../../../core/maybe.js\";import s from\"../../../../../../core/workers/Connection.js\";import{toQuantizationTransform as i}from\"../../../../../../geometry/support/quantizationUtils.js\";import{convertFromFeatureSet as a,quantizeOptimizedFeatureSet as o}from\"../../../../../../layers/graphics/featureConversionUtils.js\";import{queryOptimizedFeatureSet as n}from\"../../../../../../layers/ogc/ogcFeatureUtils.js\";import{executeQueryPBFBuffer as c,executeQuery as u}from\"../../../../../../rest/query/operations/query.js\";import{FeatureSetReaderJSON as m}from\"../../support/FeatureSetReaderJSON.js\";import{FeatureSetReaderPBF as p}from\"../../support/FeatureSetReaderPBF.js\";class l{constructor(e){this.service=e}destroy(){}}function f(e){return Array.isArray(e.source)}function y(e){return e&&e.capabilities&&e.collection&&e.layerDefinition}function h(t){const{capabilities:r}=t;return y(t.source)?new w(t):f(t)?new v(t):r.query.supportsFormatPBF&&e(\"featurelayer-pbf\")?new F(t):new q(t)}async function d(e){const t=new s;return await t.open(e,{}),t}class v extends l{constructor(e){super(e),this._portsOpen=d(e.source).then((e=>this.client=e))}destroy(){this.client.close(),this.client=null}async executeQuery(e,t){await this._portsOpen;const r=await this.client.invoke(\"queryFeatures\",e.toJSON(),t);return m.fromFeatureSet(r,this.service)}}class F extends l{async executeQuery(e,t){const{data:r}=await c(this.service.source,e,t),s=!e.quantizationParameters;return p.fromBuffer(r,this.service,s)}}class q extends l{async executeQuery(e,s){const{source:n,capabilities:c,spatialReference:p,objectIdField:l,geometryType:f}=this.service;if(t(e.quantizationParameters)&&!c.query.supportsQuantization){const t=e.clone(),c=i(r(t.quantizationParameters));t.quantizationParameters=null;const{data:f}=await u(n,t,p,s),y=a(f,l);return o(c,y),m.fromOptimizedFeatureSet(y,this.service)}const{data:y}=await u(n,e,this.service.spatialReference,s);var h;\"esriGeometryPoint\"===f&&(y.features=null==(h=y.features)?void 0:h.filter((e=>{if(t(e.geometry)){const t=e.geometry;return Number.isFinite(t.x)&&Number.isFinite(t.y)}return!0})));return m.fromFeatureSet(y,this.service)}}class w extends l{async executeQuery(e,t){const{capabilities:s}=this.service;if(e.quantizationParameters&&!s.query.supportsQuantization){const s=e.clone(),a=i(r(s.quantizationParameters));s.quantizationParameters=null;const c=await n(this.service.source,e,t);return o(a,c),m.fromOptimizedFeatureSet(c,this.service)}const a=await n(this.service.source,e,t);return m.fromOptimizedFeatureSet(a,this.service)}}export{l as SourceAdapter,h as createSourceAdapter};\n"]},"metadata":{},"sourceType":"module"}