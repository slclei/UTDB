{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport e from \"../../core/Error.js\";\nimport { isSome as t } from \"../../core/maybe.js\";\nimport n from \"../../geometry/Extent.js\";\nimport i from \"../../geometry/Point.js\";\nimport { getReferenceEllipsoidFromWKID as r } from \"../../geometry/projectionEllipsoid.js\";\nimport o from \"../../geometry/support/WKIDUnitConversion.js\";\nimport { isAxesOrderReversedForWkid as l } from \"../ogc/crsUtils.js\";\nimport { visitXML as s } from \"../ogc/xmlUtils.js\";\nimport a from \"./TileInfo.js\";\nconst c = 90.71428571428571;\n\nfunction u(t, n) {\n  var i, r;\n  t = t.replace(/ows:/gi, \"\");\n  const o = new DOMParser().parseFromString(t, \"text/xml\").documentElement,\n        l = new Map(),\n        s = new Map(),\n        a = f(\"Contents\", o);\n  if (!a) throw new e(\"wmtslayer:wmts-capabilities-xml-is-not-valid\");\n  const c = f(\"OperationsMetadata\", o),\n        u = null == c ? void 0 : c.querySelector(\"[name='GetTile']\"),\n        p = null == u ? void 0 : u.getElementsByTagName(\"Get\"),\n        d = p && Array.prototype.slice.call(p),\n        g = null != (i = (null == n || null == (r = n.url) ? void 0 : r.indexOf(\"https\")) > -1) && i;\n  let C,\n      M,\n      T = n.serviceMode,\n      y = n && n.url;\n  if (d && d.length && d.some(e => {\n    const t = f(\"Constraint\", e);\n    return !t || h(\"AllowedValues\", \"Value\", T, t) ? (y = e.attributes[0].nodeValue, !0) : (!t || h(\"AllowedValues\", \"Value\", \"RESTful\", t) || h(\"AllowedValues\", \"Value\", \"REST\", t) ? M = e.attributes[0].nodeValue : t && !h(\"AllowedValues\", \"Value\", \"KVP\", t) || (C = e.attributes[0].nodeValue), !1);\n  }), !y) if (M) y = M, T = \"RESTful\";else if (C) y = C, T = \"KVP\";else {\n    const e = f(\"ServiceMetadataURL\", o);\n    y = e && e.getAttribute(\"xlink:href\");\n  }\n  const R = y.indexOf(\"1.0.0/\");\n  -1 === R && \"RESTful\" === T ? y += \"/\" : R > -1 && (y = y.substring(0, R)), \"KVP\" === T && (y += R > -1 ? \"\" : \"?\"), g && (y = y.replace(/^http:/i, \"https:\"));\n  const S = x(\"ServiceIdentification>ServiceTypeVersion\", o),\n        V = x(\"ServiceIdentification>AccessConstraints\", o),\n        v = m(\"Layer\", a),\n        b = m(\"TileMatrixSet\", a),\n        E = v.map(e => {\n    const t = x(\"Identifier\", e);\n    return l.set(t, e), w(t, e, b, g, S);\n  });\n  return {\n    copyright: V,\n    dimensionMap: s,\n    layerMap: l,\n    layers: E,\n    serviceMode: T,\n    tileUrl: y\n  };\n}\n\nfunction p(e) {\n  return e.layers.forEach(e => {\n    e.tileMatrixSets.forEach(e => {\n      const t = e.tileInfo;\n      96 !== t.dpi && (t.lods.forEach(n => {\n        n.scale = 96 * n.scale / t.dpi, n.resolution = U(t.spatialReference.wkid, n.scale * c / 96, e.id);\n      }), t.dpi = 96);\n    });\n  }), e;\n}\n\nfunction d(e) {\n  return e.nodeType === Node.ELEMENT_NODE;\n}\n\nfunction f(e, t) {\n  for (let n = 0; n < t.childNodes.length; n++) {\n    const i = t.childNodes[n];\n    if (d(i) && i.nodeName === e) return i;\n  }\n\n  return null;\n}\n\nfunction m(e, t) {\n  const n = [];\n\n  for (let i = 0; i < t.childNodes.length; i++) {\n    const r = t.childNodes[i];\n    d(r) && r.nodeName === e && n.push(r);\n  }\n\n  return n;\n}\n\nfunction g(e, t) {\n  const n = [];\n\n  for (let i = 0; i < t.childNodes.length; i++) {\n    const r = t.childNodes[i];\n    d(r) && r.nodeName === e && n.push(r);\n  }\n\n  return n.map(e => e.textContent);\n}\n\nfunction x(e, t) {\n  return e.split(\">\").forEach(e => {\n    t && (t = f(e, t));\n  }), t && t.textContent;\n}\n\nfunction h(e, t, n, i) {\n  let r;\n  return Array.prototype.slice.call(i.childNodes).some(i => {\n    if (i.nodeName.indexOf(e) > -1) {\n      const e = f(t, i),\n            o = e && e.textContent;\n      if (o === n || n.split(\":\") && n.split(\":\")[1] === o) return r = i, !0;\n    }\n\n    return !1;\n  }), r;\n}\n\nfunction w(e, t, n, i, r) {\n  const o = x(\"Abstract\", t),\n        l = g(\"Format\", t);\n  return {\n    id: e,\n    fullExtent: R(t),\n    fullExtents: S(t),\n    description: o,\n    formats: l,\n    styles: V(t, i),\n    title: x(\"Title\", t),\n    tileMatrixSets: v(r, t, n)\n  };\n}\n\nfunction C(e, t) {\n  var n;\n  const i = [],\n        r = null == (n = e.layerMap) ? void 0 : n.get(t);\n  if (!r) return;\n  const o = m(\"ResourceURL\", r),\n        l = m(\"Dimension\", r);\n  let s, a, c, u;\n  return l.length && (s = x(\"Identifier\", l[0]), a = g(\"Default\", l[0]) || g(\"Value\", l[0])), l.length > 1 && (c = x(\"Identifier\", l[1]), u = g(\"Default\", l[1]) || g(\"Value\", l[1])), e.dimensionMap.set(t, {\n    dimensions: a,\n    dimensions2: u\n  }), o.forEach(e => {\n    let t = e.getAttribute(\"template\");\n\n    if (\"tile\" === e.getAttribute(\"resourceType\")) {\n      if (s && a.length) if (t.indexOf(\"{\" + s + \"}\") > -1) t = t.replace(\"{\" + s + \"}\", \"{dimensionValue}\");else {\n        const e = t.toLowerCase().indexOf(\"{\" + s.toLowerCase() + \"}\");\n        e > -1 && (t = t.substring(0, e) + \"{dimensionValue}\" + t.substring(e + s.length + 2));\n      }\n      if (c && u.length) if (t.indexOf(\"{\" + c + \"}\") > -1) t = t.replace(\"{\" + c + \"}\", \"{dimensionValue2}\");else {\n        const e = t.toLowerCase().indexOf(\"{\" + c.toLowerCase() + \"}\");\n        e > -1 && (t = t.substring(0, e) + \"{dimensionValue2}\" + t.substring(e + c.length + 2));\n      }\n      i.push({\n        template: t,\n        format: e.getAttribute(\"format\"),\n        resourceType: \"tile\"\n      });\n    }\n  }), i;\n}\n\nfunction M(e, t, n, i, r, o, l, s) {\n  var a, c;\n  const u = T(e, t, i);\n  if (!((null == u ? void 0 : u.length) > 0)) return \"\";\n  const {\n    dimensionMap: p\n  } = e,\n        d = null == (a = p.get(t).dimensions) ? void 0 : a[0],\n        f = null == (c = p.get(t).dimensions2) ? void 0 : c[0];\n  return u[l % u.length].template.replace(/\\{Style\\}/gi, r).replace(/\\{TileMatrixSet\\}/gi, n).replace(/\\{TileMatrix\\}/gi, o).replace(/\\{TileRow\\}/gi, \"\" + l).replace(/\\{TileCol\\}/gi, \"\" + s).replace(/\\{dimensionValue\\}/gi, d).replace(/\\{dimensionValue2\\}/gi, f);\n}\n\nfunction T(e, t, n) {\n  const i = C(e, t),\n        r = i.filter(e => e.format === n);\n  return r.length ? r : i;\n}\n\nfunction y(e, t, n, i) {\n  const {\n    dimensionMap: r\n  } = e,\n        o = C(e, t);\n  let l = \"\";\n\n  if (o && o.length > 0) {\n    const e = r.get(t).dimensions && r.get(t).dimensions[0],\n          s = r.get(t).dimensions2 && r.get(t).dimensions2[0];\n    l = o[0].template, l.indexOf(\".xxx\") === l.length - 4 && (l = l.slice(0, l.length - 4)), l = l.replace(/\\{Style\\}/gi, i), l = l.replace(/\\{TileMatrixSet\\}/gi, n), l = l.replace(/\\{TileMatrix\\}/gi, \"{level}\"), l = l.replace(/\\{TileRow\\}/gi, \"{row}\"), l = l.replace(/\\{TileCol\\}/gi, \"{col}\"), l = l.replace(/\\{dimensionValue\\}/gi, e), l = l.replace(/\\{dimensionValue2\\}/gi, s);\n  }\n\n  return l;\n}\n\nfunction R(e) {\n  const t = f(\"WGS84BoundingBox\", e),\n        n = t ? x(\"LowerCorner\", t).split(\" \") : [\"-180\", \"-90\"],\n        i = t ? x(\"UpperCorner\", t).split(\" \") : [\"180\", \"90\"];\n  return {\n    xmin: parseFloat(n[0]),\n    ymin: parseFloat(n[1]),\n    xmax: parseFloat(i[0]),\n    ymax: parseFloat(i[1]),\n    spatialReference: {\n      wkid: 4326\n    }\n  };\n}\n\nfunction S(e) {\n  const t = [];\n  return s(e, {\n    BoundingBox: e => {\n      if (!e.getAttribute(\"crs\")) return;\n      const n = e.getAttribute(\"crs\").toLowerCase(),\n            i = E(n),\n            r = n.includes(\"epsg\") && l(i.wkid);\n      let o, a, c, u;\n      s(e, {\n        LowerCorner: e => {\n          [o, a] = e.textContent.split(\" \").map(e => Number.parseFloat(e)), r && ([o, a] = [a, o]);\n        },\n        UpperCorner: e => {\n          [c, u] = e.textContent.split(\" \").map(e => Number.parseFloat(e)), r && ([c, u] = [u, c]);\n        }\n      }), t.push({\n        xmin: o,\n        ymin: a,\n        xmax: c,\n        ymax: u,\n        spatialReference: i\n      });\n    }\n  }), t;\n}\n\nfunction V(e, t) {\n  return m(\"Style\", e).map(e => {\n    const n = f(\"LegendURL\", e),\n          i = f(\"Keywords\", e),\n          r = i && g(\"Keyword\", i);\n    let o = n && n.getAttribute(\"xlink:href\");\n    t && (o = o && o.replace(/^http:/i, \"https:\"));\n    return {\n      abstract: x(\"Abstract\", e),\n      id: x(\"Identifier\", e),\n      isDefault: \"true\" === e.getAttribute(\"isDefault\"),\n      keywords: r,\n      legendUrl: o,\n      title: x(\"Title\", e)\n    };\n  });\n}\n\nfunction v(e, t, n) {\n  return m(\"TileMatrixSetLink\", t).map(t => b(e, t, n));\n}\n\nfunction b(e, t, n) {\n  const i = f(\"TileMatrixSet\", t).textContent,\n        r = g(\"TileMatrix\", t),\n        o = n.find(e => {\n    const t = f(\"Identifier\", e),\n          n = t && t.textContent;\n    return !!(n === i || i.split(\":\") && i.split(\":\")[1] === n);\n  }),\n        l = f(\"TileMatrixSetLimits\", t),\n        s = l && m(\"TileMatrixLimits\", l),\n        c = new Map();\n  if (null != s && s.length) for (const a of s) {\n    const e = f(\"TileMatrix\", a).textContent,\n          t = +f(\"MinTileRow\", a).textContent,\n          n = +f(\"MaxTileRow\", a).textContent,\n          i = +f(\"MinTileCol\", a).textContent,\n          r = +f(\"MaxTileCol\", a).textContent;\n    c.set(e, {\n      minCol: i,\n      maxCol: r,\n      minRow: t,\n      maxRow: n\n    });\n  }\n  const u = x(\"SupportedCRS\", o).toLowerCase(),\n        p = L(o, u),\n        d = p.spatialReference,\n        w = f(\"TileMatrix\", o),\n        C = [parseInt(x(\"TileWidth\", w), 10), parseInt(x(\"TileHeight\", w), 10)],\n        M = [];\n  if (r.length) r.forEach((e, t) => {\n    const n = h(\"TileMatrix\", \"Identifier\", e, o);\n    M.push(k(n, u, t, i, c));\n  });else {\n    m(\"TileMatrix\", o).forEach((e, t) => {\n      M.push(k(e, u, t, i, c));\n    });\n  }\n  const T = N(e, o, p, C, M[0]).toJSON(),\n        y = new a({\n    dpi: 96,\n    spatialReference: d,\n    size: C,\n    origin: p,\n    lods: M\n  }).toJSON();\n  return {\n    id: i,\n    fullExtent: T,\n    tileInfo: y\n  };\n}\n\nfunction E(e) {\n  e = e.toLowerCase();\n  let n = parseInt(e.split(\":\").pop(), 10);\n  900913 !== n && 3857 !== n || (n = 102100);\n  const i = O(e);\n  return t(i) && (n = i), {\n    wkid: n\n  };\n}\n\nfunction L(e, t) {\n  return I(f(\"TileMatrix\", e), t);\n}\n\nfunction I(e, t) {\n  const n = E(t),\n        [r, o] = x(\"TopLeftCorner\", e).split(\" \").map(e => parseFloat(e)),\n        s = t.includes(\"epsg\") && l(n.wkid);\n  return new i(s ? {\n    x: o,\n    y: r,\n    spatialReference: n\n  } : {\n    x: r,\n    y: o,\n    spatialReference: n\n  });\n}\n\nfunction N(e, t, i, r, o) {\n  const l = f(\"BoundingBox\", t);\n  let s, a, c, u, p, d;\n  if (l && (s = x(\"LowerCorner\", l).split(\" \"), a = x(\"UpperCorner\", l).split(\" \")), s && s.length > 1 && a && a.length > 1) c = parseFloat(s[0]), p = parseFloat(s[1]), u = parseFloat(a[0]), d = parseFloat(a[1]);else {\n    const e = f(\"TileMatrix\", t),\n          n = parseInt(x(\"MatrixWidth\", e), 10),\n          l = parseInt(x(\"MatrixHeight\", e), 10);\n    c = i.x, d = i.y, u = c + n * r[0] * o.resolution, p = d - l * r[1] * o.resolution;\n  }\n  return A(e, i.spatialReference) ? new n(p, c, d, u, i.spatialReference) : new n(c, p, u, d, i.spatialReference);\n}\n\nfunction A(e, t) {\n  return \"1.0.0\" === e && l(t.wkid);\n}\n\nvar F;\n\nfunction O(e) {\n  return e.includes(\"crs84\") || e.includes(\"crs:84\") ? F.CRS84 : e.includes(\"crs83\") || e.includes(\"crs:83\") ? F.CRS83 : e.includes(\"crs27\") || e.includes(\"crs:27\") ? F.CRS27 : null;\n}\n\nfunction k(e, t, n, i, r) {\n  var o;\n  const l = E(t),\n        s = x(\"Identifier\", e);\n  let a = parseFloat(x(\"ScaleDenominator\", e));\n  const u = U(l.wkid, a, i);\n  a *= 96 / c;\n  const p = +x(\"MatrixWidth\", e),\n        d = +x(\"MatrixHeight\", e),\n        {\n    maxCol: f = p - 1,\n    maxRow: m = d - 1,\n    minCol: g = 0,\n    minRow: h = 0\n  } = null != (o = r.get(s)) ? o : {},\n        {\n    x: w,\n    y: C\n  } = I(e, t);\n  return {\n    cols: [g, f],\n    level: n,\n    levelValue: s,\n    origin: [w, C],\n    scale: a,\n    resolution: u,\n    rows: [h, m]\n  };\n}\n\nfunction U(e, t, n) {\n  let i;\n  return i = o.hasOwnProperty(\"\" + e) ? o.values[o[e]] : \"default028mm\" === n ? 6370997 * Math.PI / 180 : r(e).metersPerDegree, 7 * t / 25e3 / i;\n}\n\n!function (e) {\n  e[e.CRS84 = 4326] = \"CRS84\", e[e.CRS83 = 4269] = \"CRS83\", e[e.CRS27 = 4267] = \"CRS27\";\n}(F || (F = {}));\nexport { M as getTileUrlFromResourceUrls, y as getTileUrlTemplateFromResourceUrls, T as getTileUrlTemplates, u as parseCapabilities, p as parseResourceInfo };","map":{"version":3,"sources":["D:/Github/CUSP_DataBase/CUSP_DB/src/main/gis/node_modules/@arcgis/core/layers/support/wmtsUtils.js"],"names":["e","isSome","t","n","i","getReferenceEllipsoidFromWKID","r","o","isAxesOrderReversedForWkid","l","visitXML","s","a","c","u","replace","DOMParser","parseFromString","documentElement","Map","f","querySelector","p","getElementsByTagName","d","Array","prototype","slice","call","g","url","indexOf","C","M","T","serviceMode","y","length","some","h","attributes","nodeValue","getAttribute","R","substring","S","x","V","v","m","b","E","map","set","w","copyright","dimensionMap","layerMap","layers","tileUrl","forEach","tileMatrixSets","tileInfo","dpi","lods","scale","resolution","U","spatialReference","wkid","id","nodeType","Node","ELEMENT_NODE","childNodes","nodeName","push","textContent","split","fullExtent","fullExtents","description","formats","styles","title","get","dimensions","dimensions2","toLowerCase","template","format","resourceType","filter","xmin","parseFloat","ymin","xmax","ymax","BoundingBox","includes","LowerCorner","Number","UpperCorner","abstract","isDefault","keywords","legendUrl","find","minCol","maxCol","minRow","maxRow","L","parseInt","k","N","toJSON","size","origin","pop","O","I","A","F","CRS84","CRS83","CRS27","cols","level","levelValue","rows","hasOwnProperty","values","Math","PI","metersPerDegree","getTileUrlFromResourceUrls","getTileUrlTemplateFromResourceUrls","getTileUrlTemplates","parseCapabilities","parseResourceInfo"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport e from\"../../core/Error.js\";import{isSome as t}from\"../../core/maybe.js\";import n from\"../../geometry/Extent.js\";import i from\"../../geometry/Point.js\";import{getReferenceEllipsoidFromWKID as r}from\"../../geometry/projectionEllipsoid.js\";import o from\"../../geometry/support/WKIDUnitConversion.js\";import{isAxesOrderReversedForWkid as l}from\"../ogc/crsUtils.js\";import{visitXML as s}from\"../ogc/xmlUtils.js\";import a from\"./TileInfo.js\";const c=90.71428571428571;function u(t,n){var i,r;t=t.replace(/ows:/gi,\"\");const o=(new DOMParser).parseFromString(t,\"text/xml\").documentElement,l=new Map,s=new Map,a=f(\"Contents\",o);if(!a)throw new e(\"wmtslayer:wmts-capabilities-xml-is-not-valid\");const c=f(\"OperationsMetadata\",o),u=null==c?void 0:c.querySelector(\"[name='GetTile']\"),p=null==u?void 0:u.getElementsByTagName(\"Get\"),d=p&&Array.prototype.slice.call(p),g=null!=(i=(null==n||null==(r=n.url)?void 0:r.indexOf(\"https\"))>-1)&&i;let C,M,T=n.serviceMode,y=n&&n.url;if(d&&d.length&&d.some((e=>{const t=f(\"Constraint\",e);return!t||h(\"AllowedValues\",\"Value\",T,t)?(y=e.attributes[0].nodeValue,!0):(!t||h(\"AllowedValues\",\"Value\",\"RESTful\",t)||h(\"AllowedValues\",\"Value\",\"REST\",t)?M=e.attributes[0].nodeValue:t&&!h(\"AllowedValues\",\"Value\",\"KVP\",t)||(C=e.attributes[0].nodeValue),!1)})),!y)if(M)y=M,T=\"RESTful\";else if(C)y=C,T=\"KVP\";else{const e=f(\"ServiceMetadataURL\",o);y=e&&e.getAttribute(\"xlink:href\")}const R=y.indexOf(\"1.0.0/\");-1===R&&\"RESTful\"===T?y+=\"/\":R>-1&&(y=y.substring(0,R)),\"KVP\"===T&&(y+=R>-1?\"\":\"?\"),g&&(y=y.replace(/^http:/i,\"https:\"));const S=x(\"ServiceIdentification>ServiceTypeVersion\",o),V=x(\"ServiceIdentification>AccessConstraints\",o),v=m(\"Layer\",a),b=m(\"TileMatrixSet\",a),E=v.map((e=>{const t=x(\"Identifier\",e);return l.set(t,e),w(t,e,b,g,S)}));return{copyright:V,dimensionMap:s,layerMap:l,layers:E,serviceMode:T,tileUrl:y}}function p(e){return e.layers.forEach((e=>{e.tileMatrixSets.forEach((e=>{const t=e.tileInfo;96!==t.dpi&&(t.lods.forEach((n=>{n.scale=96*n.scale/t.dpi,n.resolution=U(t.spatialReference.wkid,n.scale*c/96,e.id)})),t.dpi=96)}))})),e}function d(e){return e.nodeType===Node.ELEMENT_NODE}function f(e,t){for(let n=0;n<t.childNodes.length;n++){const i=t.childNodes[n];if(d(i)&&i.nodeName===e)return i}return null}function m(e,t){const n=[];for(let i=0;i<t.childNodes.length;i++){const r=t.childNodes[i];d(r)&&r.nodeName===e&&n.push(r)}return n}function g(e,t){const n=[];for(let i=0;i<t.childNodes.length;i++){const r=t.childNodes[i];d(r)&&r.nodeName===e&&n.push(r)}return n.map((e=>e.textContent))}function x(e,t){return e.split(\">\").forEach((e=>{t&&(t=f(e,t))})),t&&t.textContent}function h(e,t,n,i){let r;return Array.prototype.slice.call(i.childNodes).some((i=>{if(i.nodeName.indexOf(e)>-1){const e=f(t,i),o=e&&e.textContent;if(o===n||n.split(\":\")&&n.split(\":\")[1]===o)return r=i,!0}return!1})),r}function w(e,t,n,i,r){const o=x(\"Abstract\",t),l=g(\"Format\",t);return{id:e,fullExtent:R(t),fullExtents:S(t),description:o,formats:l,styles:V(t,i),title:x(\"Title\",t),tileMatrixSets:v(r,t,n)}}function C(e,t){var n;const i=[],r=null==(n=e.layerMap)?void 0:n.get(t);if(!r)return;const o=m(\"ResourceURL\",r),l=m(\"Dimension\",r);let s,a,c,u;return l.length&&(s=x(\"Identifier\",l[0]),a=g(\"Default\",l[0])||g(\"Value\",l[0])),l.length>1&&(c=x(\"Identifier\",l[1]),u=g(\"Default\",l[1])||g(\"Value\",l[1])),e.dimensionMap.set(t,{dimensions:a,dimensions2:u}),o.forEach((e=>{let t=e.getAttribute(\"template\");if(\"tile\"===e.getAttribute(\"resourceType\")){if(s&&a.length)if(t.indexOf(\"{\"+s+\"}\")>-1)t=t.replace(\"{\"+s+\"}\",\"{dimensionValue}\");else{const e=t.toLowerCase().indexOf(\"{\"+s.toLowerCase()+\"}\");e>-1&&(t=t.substring(0,e)+\"{dimensionValue}\"+t.substring(e+s.length+2))}if(c&&u.length)if(t.indexOf(\"{\"+c+\"}\")>-1)t=t.replace(\"{\"+c+\"}\",\"{dimensionValue2}\");else{const e=t.toLowerCase().indexOf(\"{\"+c.toLowerCase()+\"}\");e>-1&&(t=t.substring(0,e)+\"{dimensionValue2}\"+t.substring(e+c.length+2))}i.push({template:t,format:e.getAttribute(\"format\"),resourceType:\"tile\"})}})),i}function M(e,t,n,i,r,o,l,s){var a,c;const u=T(e,t,i);if(!((null==u?void 0:u.length)>0))return\"\";const{dimensionMap:p}=e,d=null==(a=p.get(t).dimensions)?void 0:a[0],f=null==(c=p.get(t).dimensions2)?void 0:c[0];return u[l%u.length].template.replace(/\\{Style\\}/gi,r).replace(/\\{TileMatrixSet\\}/gi,n).replace(/\\{TileMatrix\\}/gi,o).replace(/\\{TileRow\\}/gi,\"\"+l).replace(/\\{TileCol\\}/gi,\"\"+s).replace(/\\{dimensionValue\\}/gi,d).replace(/\\{dimensionValue2\\}/gi,f)}function T(e,t,n){const i=C(e,t),r=i.filter((e=>e.format===n));return r.length?r:i}function y(e,t,n,i){const{dimensionMap:r}=e,o=C(e,t);let l=\"\";if(o&&o.length>0){const e=r.get(t).dimensions&&r.get(t).dimensions[0],s=r.get(t).dimensions2&&r.get(t).dimensions2[0];l=o[0].template,l.indexOf(\".xxx\")===l.length-4&&(l=l.slice(0,l.length-4)),l=l.replace(/\\{Style\\}/gi,i),l=l.replace(/\\{TileMatrixSet\\}/gi,n),l=l.replace(/\\{TileMatrix\\}/gi,\"{level}\"),l=l.replace(/\\{TileRow\\}/gi,\"{row}\"),l=l.replace(/\\{TileCol\\}/gi,\"{col}\"),l=l.replace(/\\{dimensionValue\\}/gi,e),l=l.replace(/\\{dimensionValue2\\}/gi,s)}return l}function R(e){const t=f(\"WGS84BoundingBox\",e),n=t?x(\"LowerCorner\",t).split(\" \"):[\"-180\",\"-90\"],i=t?x(\"UpperCorner\",t).split(\" \"):[\"180\",\"90\"];return{xmin:parseFloat(n[0]),ymin:parseFloat(n[1]),xmax:parseFloat(i[0]),ymax:parseFloat(i[1]),spatialReference:{wkid:4326}}}function S(e){const t=[];return s(e,{BoundingBox:e=>{if(!e.getAttribute(\"crs\"))return;const n=e.getAttribute(\"crs\").toLowerCase(),i=E(n),r=n.includes(\"epsg\")&&l(i.wkid);let o,a,c,u;s(e,{LowerCorner:e=>{[o,a]=e.textContent.split(\" \").map((e=>Number.parseFloat(e))),r&&([o,a]=[a,o])},UpperCorner:e=>{[c,u]=e.textContent.split(\" \").map((e=>Number.parseFloat(e))),r&&([c,u]=[u,c])}}),t.push({xmin:o,ymin:a,xmax:c,ymax:u,spatialReference:i})}}),t}function V(e,t){return m(\"Style\",e).map((e=>{const n=f(\"LegendURL\",e),i=f(\"Keywords\",e),r=i&&g(\"Keyword\",i);let o=n&&n.getAttribute(\"xlink:href\");t&&(o=o&&o.replace(/^http:/i,\"https:\"));return{abstract:x(\"Abstract\",e),id:x(\"Identifier\",e),isDefault:\"true\"===e.getAttribute(\"isDefault\"),keywords:r,legendUrl:o,title:x(\"Title\",e)}}))}function v(e,t,n){return m(\"TileMatrixSetLink\",t).map((t=>b(e,t,n)))}function b(e,t,n){const i=f(\"TileMatrixSet\",t).textContent,r=g(\"TileMatrix\",t),o=n.find((e=>{const t=f(\"Identifier\",e),n=t&&t.textContent;return!!(n===i||i.split(\":\")&&i.split(\":\")[1]===n)})),l=f(\"TileMatrixSetLimits\",t),s=l&&m(\"TileMatrixLimits\",l),c=new Map;if(null!=s&&s.length)for(const a of s){const e=f(\"TileMatrix\",a).textContent,t=+f(\"MinTileRow\",a).textContent,n=+f(\"MaxTileRow\",a).textContent,i=+f(\"MinTileCol\",a).textContent,r=+f(\"MaxTileCol\",a).textContent;c.set(e,{minCol:i,maxCol:r,minRow:t,maxRow:n})}const u=x(\"SupportedCRS\",o).toLowerCase(),p=L(o,u),d=p.spatialReference,w=f(\"TileMatrix\",o),C=[parseInt(x(\"TileWidth\",w),10),parseInt(x(\"TileHeight\",w),10)],M=[];if(r.length)r.forEach(((e,t)=>{const n=h(\"TileMatrix\",\"Identifier\",e,o);M.push(k(n,u,t,i,c))}));else{m(\"TileMatrix\",o).forEach(((e,t)=>{M.push(k(e,u,t,i,c))}))}const T=N(e,o,p,C,M[0]).toJSON(),y=new a({dpi:96,spatialReference:d,size:C,origin:p,lods:M}).toJSON();return{id:i,fullExtent:T,tileInfo:y}}function E(e){e=e.toLowerCase();let n=parseInt(e.split(\":\").pop(),10);900913!==n&&3857!==n||(n=102100);const i=O(e);return t(i)&&(n=i),{wkid:n}}function L(e,t){return I(f(\"TileMatrix\",e),t)}function I(e,t){const n=E(t),[r,o]=x(\"TopLeftCorner\",e).split(\" \").map((e=>parseFloat(e))),s=t.includes(\"epsg\")&&l(n.wkid);return new i(s?{x:o,y:r,spatialReference:n}:{x:r,y:o,spatialReference:n})}function N(e,t,i,r,o){const l=f(\"BoundingBox\",t);let s,a,c,u,p,d;if(l&&(s=x(\"LowerCorner\",l).split(\" \"),a=x(\"UpperCorner\",l).split(\" \")),s&&s.length>1&&a&&a.length>1)c=parseFloat(s[0]),p=parseFloat(s[1]),u=parseFloat(a[0]),d=parseFloat(a[1]);else{const e=f(\"TileMatrix\",t),n=parseInt(x(\"MatrixWidth\",e),10),l=parseInt(x(\"MatrixHeight\",e),10);c=i.x,d=i.y,u=c+n*r[0]*o.resolution,p=d-l*r[1]*o.resolution}return A(e,i.spatialReference)?new n(p,c,d,u,i.spatialReference):new n(c,p,u,d,i.spatialReference)}function A(e,t){return\"1.0.0\"===e&&l(t.wkid)}var F;function O(e){return e.includes(\"crs84\")||e.includes(\"crs:84\")?F.CRS84:e.includes(\"crs83\")||e.includes(\"crs:83\")?F.CRS83:e.includes(\"crs27\")||e.includes(\"crs:27\")?F.CRS27:null}function k(e,t,n,i,r){var o;const l=E(t),s=x(\"Identifier\",e);let a=parseFloat(x(\"ScaleDenominator\",e));const u=U(l.wkid,a,i);a*=96/c;const p=+x(\"MatrixWidth\",e),d=+x(\"MatrixHeight\",e),{maxCol:f=p-1,maxRow:m=d-1,minCol:g=0,minRow:h=0}=null!=(o=r.get(s))?o:{},{x:w,y:C}=I(e,t);return{cols:[g,f],level:n,levelValue:s,origin:[w,C],scale:a,resolution:u,rows:[h,m]}}function U(e,t,n){let i;return i=o.hasOwnProperty(\"\"+e)?o.values[o[e]]:\"default028mm\"===n?6370997*Math.PI/180:r(e).metersPerDegree,7*t/25e3/i}!function(e){e[e.CRS84=4326]=\"CRS84\",e[e.CRS83=4269]=\"CRS83\",e[e.CRS27=4267]=\"CRS27\"}(F||(F={}));export{M as getTileUrlFromResourceUrls,y as getTileUrlTemplateFromResourceUrls,T as getTileUrlTemplates,u as parseCapabilities,p as parseResourceInfo};\n"]},"metadata":{},"sourceType":"module"}