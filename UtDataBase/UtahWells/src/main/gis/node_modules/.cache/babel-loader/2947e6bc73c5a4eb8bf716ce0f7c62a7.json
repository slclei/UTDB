{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport { isSome as e, isNone as t } from \"../../../../core/maybe.js\";\nimport { brushes as s } from \"../brushes.js\";\nimport r from \"../vectorTiles/shaders/VTLMaterialManager.js\";\nimport { BitBlitRenderer as i } from \"./BitBlitRenderer.js\";\nimport { WGLGeometryType as n, WGLDrawPhase as o } from \"./enums.js\";\nimport a from \"./MaterialManager.js\";\nimport h from \"./TextureManager.js\";\nimport { AnimationEffect as f } from \"./effects/AnimationEffect.js\";\nimport { BlendEffect as l } from \"./effects/BlendEffect.js\";\nimport { FeatureEffect as c } from \"./effects/FeatureEffect.js\";\nimport _ from \"./effects/HighlightEffect.js\";\nimport { HittestEffect as d } from \"./effects/HittestEffect.js\";\nimport { HittestEffectVTL as b } from \"./effects/HittestEffectVTL.js\";\nimport { EffectManager as g } from \"./effects/post-processing/EffectManager.js\";\nimport u from \"./painter/RenderPass.js\";\nimport { TextureType as E, PixelFormat as p, PixelType as m, TextureSamplingMode as T, TextureWrapMode as M, TargetType as F, DepthStencilTargetType as R, RenderbufferFormat as w, BlendFactor as C } from \"../../../webgl/enums.js\";\nimport { FramebufferObject as B } from \"../../../webgl/FramebufferObject.js\";\nimport { Renderbuffer as O } from \"../../../webgl/Renderbuffer.js\";\nconst S = {\n  [n.FILL]: s.fill,\n  [n.LINE]: s.line,\n  [n.MARKER]: s.marker,\n  [n.TEXT]: s.text\n};\n\nclass P {\n  constructor(e, t, s) {\n    this.context = e, this._blitRenderer = new i(), this._brushCache = new Map(), this._vtlMaterialManager = new r(), this._blendEffect = new l(), this._fboPool = [], this.effects = {\n      highlight: new _(),\n      hittest: new d(),\n      hittestVTL: new b(),\n      integrate: new f(),\n      insideEffect: new c(\"inside\"),\n      outsideEffect: new c(\"outside\")\n    }, this.materialManager = new a(e), this.textureManager = new h(t, s), this._effectsManager = new g(t);\n  }\n\n  get vectorTilesMaterialManager() {\n    return this._vtlMaterialManager;\n  }\n\n  getRenderTarget() {\n    return this._renderTarget;\n  }\n\n  setRenderTarget(e) {\n    this._renderTarget = e;\n  }\n\n  getFbos(e, t) {\n    if (e !== this._lastWidth || t !== this._lastHeight) {\n      if (this._lastWidth = e, this._lastHeight = t, this._fbos) {\n        for (const s in this._fbos) this._fbos[s].resize(e, t);\n\n        return this._fbos;\n      }\n\n      const s = {\n        target: E.TEXTURE_2D,\n        pixelFormat: p.RGBA,\n        dataType: m.UNSIGNED_BYTE,\n        samplingMode: T.NEAREST,\n        wrapMode: M.CLAMP_TO_EDGE,\n        width: e,\n        height: t\n      },\n            r = {\n        colorTarget: F.TEXTURE,\n        depthStencilTarget: R.DEPTH_STENCIL_RENDER_BUFFER\n      },\n            i = new O(this.context, {\n        width: e,\n        height: t,\n        internalFormat: w.DEPTH_STENCIL\n      });\n      this._stencilBuf = i, this._fbos = {\n        output: new B(this.context, r, s, i),\n        blend: new B(this.context, r, s, i),\n        effect0: new B(this.context, r, s, i)\n      };\n    }\n\n    return this._fbos;\n  }\n\n  acquireFbo(e, t) {\n    let s;\n    s = this._fboPool.length > 0 ? this._fboPool.pop() : new B(this.context, {\n      colorTarget: F.TEXTURE,\n      depthStencilTarget: R.DEPTH_STENCIL_RENDER_BUFFER\n    }, {\n      target: E.TEXTURE_2D,\n      pixelFormat: p.RGBA,\n      dataType: m.UNSIGNED_BYTE,\n      samplingMode: T.NEAREST,\n      wrapMode: M.CLAMP_TO_EDGE,\n      width: e,\n      height: t\n    }, this._stencilBuf);\n    const r = s.descriptor;\n    return r.width === e && r.height === t || s.resize(e, t), s;\n  }\n\n  releaseFbo(e) {\n    this._fboPool.push(e);\n  }\n\n  getSharedStencilBuffer() {\n    return this._stencilBuf;\n  }\n\n  beforeRenderLayers(t) {\n    let s = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n    const {\n      width: r,\n      height: i\n    } = t.getViewport();\n    this._prevFBO = t.getBoundFramebufferObject();\n    const n = this.getFbos(r, i);\n\n    if (t.bindFramebuffer(n.output), t.setColorMask(!0, !0, !0, !0), t.setDepthWriteEnabled(!0), e(s)) {\n      const {\n        r: e,\n        g: r,\n        b: i,\n        a: n\n      } = s.color;\n      t.setClearColor(n * e / 255, n * r / 255, n * i / 255, n);\n    } else t.setClearColor(0, 0, 0, 0);\n\n    t.setClearDepth(1), t.clear(t.gl.COLOR_BUFFER_BIT | t.gl.DEPTH_BUFFER_BIT), t.setDepthWriteEnabled(!1);\n  }\n\n  beforeRenderLayer(e, t, s) {\n    const {\n      context: r,\n      blendMode: i,\n      effects: n,\n      requireFBO: o,\n      drawPhase: a\n    } = e;\n    if (o || N(a, i, n, s)) r.bindFramebuffer(this._fbos.blend), r.setColorMask(!0, !0, !0, !0), r.setClearColor(0, 0, 0, 0), r.setDepthWriteEnabled(!0), r.setClearDepth(1), r.clear(r.gl.COLOR_BUFFER_BIT | r.gl.DEPTH_BUFFER_BIT), r.setDepthWriteEnabled(!1);else {\n      const e = this._getOutputFBO();\n\n      r.bindFramebuffer(e);\n    }\n    r.setDepthWriteEnabled(!1), r.setDepthTestEnabled(!1), r.setStencilTestEnabled(!0), r.setClearStencil(t), r.setStencilWriteMask(255), r.clear(r.gl.STENCIL_BUFFER_BIT);\n  }\n\n  compositeLayer(s, r) {\n    const {\n      context: i,\n      blendMode: n,\n      effects: a,\n      requireFBO: h,\n      drawPhase: f\n    } = s;\n\n    if (h || N(f, n, a, r)) {\n      e(a) && a.length > 0 && f === o.MAP && this._applyEffects(s, a);\n\n      const h = this._getOutputFBO();\n\n      i.bindFramebuffer(h), i.setStencilTestEnabled(!1), i.setStencilWriteMask(0), i.setBlendingEnabled(!0), i.setBlendFunctionSeparate(C.ONE, C.ONE_MINUS_SRC_ALPHA, C.ONE, C.ONE_MINUS_SRC_ALPHA), i.setColorMask(!0, !0, !0, !0);\n      const l = t(n) || f === o.HIGHLIGHT ? \"normal\" : n;\n\n      this._blendEffect.draw(s, this._fbos.blend.colorTexture, T.NEAREST, l, r);\n    }\n  }\n\n  renderLayers(e) {\n    if (e.bindFramebuffer(this._prevFBO), !this._fbos) return;\n\n    const t = this._getOutputFBO();\n\n    e.setStencilTestEnabled(!1), e.setStencilWriteMask(0), this.blitTexture(e, t.colorTexture, T.NEAREST);\n  }\n\n  dispose() {\n    if (this.materialManager.dispose(), this.textureManager.dispose(), this._blitRenderer && (this._blitRenderer.dispose(), this._blitRenderer = null), this._brushCache && (this._brushCache.forEach(e => e.dispose()), this._brushCache.clear(), this._brushCache = null), this._fbos) for (const e in this._fbos) this._fbos[e] && this._fbos[e].dispose();\n\n    for (const e of this._fboPool) e.dispose();\n\n    if (this._fboPool.length = 0, this.effects) for (const e in this.effects) this.effects[e] && this.effects[e].dispose();\n    this._effectsManager.dispose(), this._vtlMaterialManager && (this._vtlMaterialManager.dispose(), this._vtlMaterialManager = null), this._prevFBO = null;\n  }\n\n  getGeometryBrush(e) {\n    const t = S[e];\n\n    let s = this._brushCache.get(t);\n\n    return void 0 === s && (s = new t(), this._brushCache.set(t, s)), this._brushCache.get(t);\n  }\n\n  renderObject(e, t, r, i) {\n    const n = s[r];\n    if (!n) return null;\n\n    let o = this._brushCache.get(n);\n\n    void 0 === o && (o = new n(), this._brushCache.set(n, o)), o.prepareState(e, t, i), o.draw(e, t, i);\n  }\n\n  renderObjects(e, t, r, i) {\n    const n = s[r];\n    if (!n) return null;\n\n    let o = this._brushCache.get(n);\n\n    void 0 === o && (o = new n(), this._brushCache.set(n, o)), o.drawMany(e, t, i);\n  }\n\n  registerRenderPass(e) {\n    const t = e.brushes.map(e => (this._brushCache.has(e) || this._brushCache.set(e, new e()), this._brushCache.get(e)));\n    return new u(t, e);\n  }\n\n  setHighlightOptions(e) {\n    this.effects.highlight.setHighlightOptions(e);\n  }\n\n  blitTexture(e, t, s) {\n    let r = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 1;\n    e.setBlendingEnabled(!0), e.setBlendFunctionSeparate(C.ONE, C.ONE_MINUS_SRC_ALPHA, C.ONE, C.ONE_MINUS_SRC_ALPHA), e.setColorMask(!0, !0, !0, !0), this._blitRenderer.render(e, t, s, r);\n  }\n\n  getPostProcessingEffects(e) {\n    return this._effectsManager.getPostProcessingEffects(e);\n  }\n\n  _getOutputFBO() {\n    return null != this._renderTarget ? this._renderTarget : this._fbos.output;\n  }\n\n  _applyEffects(e, t) {\n    const {\n      context: s\n    } = e,\n          r = this._effectsManager.getPostProcessingEffects(t);\n\n    for (const {\n      postProcessingEffect: i,\n      effect: n\n    } of r) s.bindFramebuffer(this._fbos.blend), i.draw(e, this._fbos.blend, n);\n  }\n\n}\n\nfunction N(t, s, r, i) {\n  return t !== o.HIGHLIGHT && (1 !== i || e(s) && \"normal\" !== s || e(r) && r.length > 0);\n}\n\nexport { P as default };","map":{"version":3,"sources":["D:/Github/CUSP_DataBase/CUSP_DB/src/main/gis/node_modules/@arcgis/core/views/2d/engine/webgl/Painter.js"],"names":["isSome","e","isNone","t","brushes","s","r","BitBlitRenderer","i","WGLGeometryType","n","WGLDrawPhase","o","a","h","AnimationEffect","f","BlendEffect","l","FeatureEffect","c","_","HittestEffect","d","HittestEffectVTL","b","EffectManager","g","u","TextureType","E","PixelFormat","p","PixelType","m","TextureSamplingMode","T","TextureWrapMode","M","TargetType","F","DepthStencilTargetType","R","RenderbufferFormat","w","BlendFactor","C","FramebufferObject","B","Renderbuffer","O","S","FILL","fill","LINE","line","MARKER","marker","TEXT","text","P","constructor","context","_blitRenderer","_brushCache","Map","_vtlMaterialManager","_blendEffect","_fboPool","effects","highlight","hittest","hittestVTL","integrate","insideEffect","outsideEffect","materialManager","textureManager","_effectsManager","vectorTilesMaterialManager","getRenderTarget","_renderTarget","setRenderTarget","getFbos","_lastWidth","_lastHeight","_fbos","resize","target","TEXTURE_2D","pixelFormat","RGBA","dataType","UNSIGNED_BYTE","samplingMode","NEAREST","wrapMode","CLAMP_TO_EDGE","width","height","colorTarget","TEXTURE","depthStencilTarget","DEPTH_STENCIL_RENDER_BUFFER","internalFormat","DEPTH_STENCIL","_stencilBuf","output","blend","effect0","acquireFbo","length","pop","descriptor","releaseFbo","push","getSharedStencilBuffer","beforeRenderLayers","getViewport","_prevFBO","getBoundFramebufferObject","bindFramebuffer","setColorMask","setDepthWriteEnabled","color","setClearColor","setClearDepth","clear","gl","COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","beforeRenderLayer","blendMode","requireFBO","drawPhase","N","_getOutputFBO","setDepthTestEnabled","setStencilTestEnabled","setClearStencil","setStencilWriteMask","STENCIL_BUFFER_BIT","compositeLayer","MAP","_applyEffects","setBlendingEnabled","setBlendFunctionSeparate","ONE","ONE_MINUS_SRC_ALPHA","HIGHLIGHT","draw","colorTexture","renderLayers","blitTexture","dispose","forEach","getGeometryBrush","get","set","renderObject","prepareState","renderObjects","drawMany","registerRenderPass","map","has","setHighlightOptions","render","getPostProcessingEffects","postProcessingEffect","effect","default"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport{isSome as e,isNone as t}from\"../../../../core/maybe.js\";import{brushes as s}from\"../brushes.js\";import r from\"../vectorTiles/shaders/VTLMaterialManager.js\";import{BitBlitRenderer as i}from\"./BitBlitRenderer.js\";import{WGLGeometryType as n,WGLDrawPhase as o}from\"./enums.js\";import a from\"./MaterialManager.js\";import h from\"./TextureManager.js\";import{AnimationEffect as f}from\"./effects/AnimationEffect.js\";import{BlendEffect as l}from\"./effects/BlendEffect.js\";import{FeatureEffect as c}from\"./effects/FeatureEffect.js\";import _ from\"./effects/HighlightEffect.js\";import{HittestEffect as d}from\"./effects/HittestEffect.js\";import{HittestEffectVTL as b}from\"./effects/HittestEffectVTL.js\";import{EffectManager as g}from\"./effects/post-processing/EffectManager.js\";import u from\"./painter/RenderPass.js\";import{TextureType as E,PixelFormat as p,PixelType as m,TextureSamplingMode as T,TextureWrapMode as M,TargetType as F,DepthStencilTargetType as R,RenderbufferFormat as w,BlendFactor as C}from\"../../../webgl/enums.js\";import{FramebufferObject as B}from\"../../../webgl/FramebufferObject.js\";import{Renderbuffer as O}from\"../../../webgl/Renderbuffer.js\";const S={[n.FILL]:s.fill,[n.LINE]:s.line,[n.MARKER]:s.marker,[n.TEXT]:s.text};class P{constructor(e,t,s){this.context=e,this._blitRenderer=new i,this._brushCache=new Map,this._vtlMaterialManager=new r,this._blendEffect=new l,this._fboPool=[],this.effects={highlight:new _,hittest:new d,hittestVTL:new b,integrate:new f,insideEffect:new c(\"inside\"),outsideEffect:new c(\"outside\")},this.materialManager=new a(e),this.textureManager=new h(t,s),this._effectsManager=new g(t)}get vectorTilesMaterialManager(){return this._vtlMaterialManager}getRenderTarget(){return this._renderTarget}setRenderTarget(e){this._renderTarget=e}getFbos(e,t){if(e!==this._lastWidth||t!==this._lastHeight){if(this._lastWidth=e,this._lastHeight=t,this._fbos){for(const s in this._fbos)this._fbos[s].resize(e,t);return this._fbos}const s={target:E.TEXTURE_2D,pixelFormat:p.RGBA,dataType:m.UNSIGNED_BYTE,samplingMode:T.NEAREST,wrapMode:M.CLAMP_TO_EDGE,width:e,height:t},r={colorTarget:F.TEXTURE,depthStencilTarget:R.DEPTH_STENCIL_RENDER_BUFFER},i=new O(this.context,{width:e,height:t,internalFormat:w.DEPTH_STENCIL});this._stencilBuf=i,this._fbos={output:new B(this.context,r,s,i),blend:new B(this.context,r,s,i),effect0:new B(this.context,r,s,i)}}return this._fbos}acquireFbo(e,t){let s;s=this._fboPool.length>0?this._fboPool.pop():new B(this.context,{colorTarget:F.TEXTURE,depthStencilTarget:R.DEPTH_STENCIL_RENDER_BUFFER},{target:E.TEXTURE_2D,pixelFormat:p.RGBA,dataType:m.UNSIGNED_BYTE,samplingMode:T.NEAREST,wrapMode:M.CLAMP_TO_EDGE,width:e,height:t},this._stencilBuf);const r=s.descriptor;return r.width===e&&r.height===t||s.resize(e,t),s}releaseFbo(e){this._fboPool.push(e)}getSharedStencilBuffer(){return this._stencilBuf}beforeRenderLayers(t,s=null){const{width:r,height:i}=t.getViewport();this._prevFBO=t.getBoundFramebufferObject();const n=this.getFbos(r,i);if(t.bindFramebuffer(n.output),t.setColorMask(!0,!0,!0,!0),t.setDepthWriteEnabled(!0),e(s)){const{r:e,g:r,b:i,a:n}=s.color;t.setClearColor(n*e/255,n*r/255,n*i/255,n)}else t.setClearColor(0,0,0,0);t.setClearDepth(1),t.clear(t.gl.COLOR_BUFFER_BIT|t.gl.DEPTH_BUFFER_BIT),t.setDepthWriteEnabled(!1)}beforeRenderLayer(e,t,s){const{context:r,blendMode:i,effects:n,requireFBO:o,drawPhase:a}=e;if(o||N(a,i,n,s))r.bindFramebuffer(this._fbos.blend),r.setColorMask(!0,!0,!0,!0),r.setClearColor(0,0,0,0),r.setDepthWriteEnabled(!0),r.setClearDepth(1),r.clear(r.gl.COLOR_BUFFER_BIT|r.gl.DEPTH_BUFFER_BIT),r.setDepthWriteEnabled(!1);else{const e=this._getOutputFBO();r.bindFramebuffer(e)}r.setDepthWriteEnabled(!1),r.setDepthTestEnabled(!1),r.setStencilTestEnabled(!0),r.setClearStencil(t),r.setStencilWriteMask(255),r.clear(r.gl.STENCIL_BUFFER_BIT)}compositeLayer(s,r){const{context:i,blendMode:n,effects:a,requireFBO:h,drawPhase:f}=s;if(h||N(f,n,a,r)){e(a)&&a.length>0&&f===o.MAP&&this._applyEffects(s,a);const h=this._getOutputFBO();i.bindFramebuffer(h),i.setStencilTestEnabled(!1),i.setStencilWriteMask(0),i.setBlendingEnabled(!0),i.setBlendFunctionSeparate(C.ONE,C.ONE_MINUS_SRC_ALPHA,C.ONE,C.ONE_MINUS_SRC_ALPHA),i.setColorMask(!0,!0,!0,!0);const l=t(n)||f===o.HIGHLIGHT?\"normal\":n;this._blendEffect.draw(s,this._fbos.blend.colorTexture,T.NEAREST,l,r)}}renderLayers(e){if(e.bindFramebuffer(this._prevFBO),!this._fbos)return;const t=this._getOutputFBO();e.setStencilTestEnabled(!1),e.setStencilWriteMask(0),this.blitTexture(e,t.colorTexture,T.NEAREST)}dispose(){if(this.materialManager.dispose(),this.textureManager.dispose(),this._blitRenderer&&(this._blitRenderer.dispose(),this._blitRenderer=null),this._brushCache&&(this._brushCache.forEach((e=>e.dispose())),this._brushCache.clear(),this._brushCache=null),this._fbos)for(const e in this._fbos)this._fbos[e]&&this._fbos[e].dispose();for(const e of this._fboPool)e.dispose();if(this._fboPool.length=0,this.effects)for(const e in this.effects)this.effects[e]&&this.effects[e].dispose();this._effectsManager.dispose(),this._vtlMaterialManager&&(this._vtlMaterialManager.dispose(),this._vtlMaterialManager=null),this._prevFBO=null}getGeometryBrush(e){const t=S[e];let s=this._brushCache.get(t);return void 0===s&&(s=new t,this._brushCache.set(t,s)),this._brushCache.get(t)}renderObject(e,t,r,i){const n=s[r];if(!n)return null;let o=this._brushCache.get(n);void 0===o&&(o=new n,this._brushCache.set(n,o)),o.prepareState(e,t,i),o.draw(e,t,i)}renderObjects(e,t,r,i){const n=s[r];if(!n)return null;let o=this._brushCache.get(n);void 0===o&&(o=new n,this._brushCache.set(n,o)),o.drawMany(e,t,i)}registerRenderPass(e){const t=e.brushes.map((e=>(this._brushCache.has(e)||this._brushCache.set(e,new e),this._brushCache.get(e))));return new u(t,e)}setHighlightOptions(e){this.effects.highlight.setHighlightOptions(e)}blitTexture(e,t,s,r=1){e.setBlendingEnabled(!0),e.setBlendFunctionSeparate(C.ONE,C.ONE_MINUS_SRC_ALPHA,C.ONE,C.ONE_MINUS_SRC_ALPHA),e.setColorMask(!0,!0,!0,!0),this._blitRenderer.render(e,t,s,r)}getPostProcessingEffects(e){return this._effectsManager.getPostProcessingEffects(e)}_getOutputFBO(){return null!=this._renderTarget?this._renderTarget:this._fbos.output}_applyEffects(e,t){const{context:s}=e,r=this._effectsManager.getPostProcessingEffects(t);for(const{postProcessingEffect:i,effect:n}of r)s.bindFramebuffer(this._fbos.blend),i.draw(e,this._fbos.blend,n)}}function N(t,s,r,i){return t!==o.HIGHLIGHT&&(1!==i||e(s)&&\"normal\"!==s||e(r)&&r.length>0)}export{P as default};\n"]},"metadata":{},"sourceType":"module"}