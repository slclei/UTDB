{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport { BucketType as e } from \"../enums.js\";\nimport t from \"./BaseBucket.js\";\nimport { LineTessellation as i } from \"../../webgl/TurboLine.js\";\nconst n = 65535;\n\nclass s extends t {\n  constructor(t, n, s, a, o) {\n    super(t, n, s), this.type = e.LINE, this._tessellationOptions = {\n      pixelCoordRatio: 8,\n      halfWidth: 0,\n      offset: 0\n    }, this._patternMap = new Map(), this.tessellationProperties = {\n      _lineVertexBuffer: null,\n      _lineIndexBuffer: null,\n      _ddValues: null\n    }, this.tessellationProperties._lineVertexBuffer = a, this.tessellationProperties._lineIndexBuffer = o, this._lineTessellator = new i(l(this.tessellationProperties), r(this.tessellationProperties), t.canUseThinTessellation);\n  }\n\n  get lineIndexStart() {\n    return this._lineIndexStart;\n  }\n\n  get lineIndexCount() {\n    return this._lineIndexCount;\n  }\n\n  getResources(e, t, i) {\n    const n = this.layer,\n          s = this.zoom,\n          l = n.hasDataDrivenLine,\n          r = n.getPaintProperty(\"line-pattern\"),\n          a = n.getPaintProperty(\"line-dasharray\"),\n          o = n.getLayoutProperty(\"line-cap\");\n    if (!r && !a) return;\n    const u = (null == o ? void 0 : o.getValue(s)) || 0,\n          f = null == o ? void 0 : o.isDataDriven;\n\n    if (l) {\n      const e = null == r ? void 0 : r.isDataDriven,\n            i = null == a ? void 0 : a.isDataDriven;\n      if (!e && !i) return;\n\n      for (const l of this._features) t(e ? r.getValue(s, l) : this._getDashArrayKey(l, s, n, a, f, o, u));\n    } else if (r) t(r.getValue(s));else if (a) {\n      const e = a.getValue(s);\n      t(n.getDashKey(e, u));\n    }\n  }\n\n  processFeatures(e) {\n    var t, i, n, s, l, r;\n    this._lineIndexStart = 3 * this.tessellationProperties._lineIndexBuffer.index, this._lineIndexCount = 0;\n    const a = this.layer,\n          o = this.zoom,\n          u = this._features,\n          f = this._tessellationOptions,\n          {\n      hasDataDrivenLine: h,\n      lineMaterial: p\n    } = a;\n    e && e.setExtent(this.layerExtent);\n    const d = a.getPaintProperty(\"line-pattern\"),\n          g = a.getPaintProperty(\"line-dasharray\"),\n          y = null == d ? void 0 : d.isDataDriven,\n          c = null == g ? void 0 : g.isDataDriven;\n\n    let _;\n\n    _ = a.getLayoutProperty(\"line-cap\");\n    const x = null != (t = _) && t.isDataDriven ? _ : null,\n          D = x ? null : a.getLayoutValue(\"line-cap\", o),\n          m = D || 0,\n          V = !!x;\n    _ = a.getLayoutProperty(\"line-join\");\n    const P = null != (i = _) && i.isDataDriven ? _ : null,\n          I = P ? null : a.getLayoutValue(\"line-join\", o);\n    _ = a.getLayoutProperty(\"line-miter-limit\");\n    const L = null != (n = _) && n.isDataDriven ? _ : null,\n          v = L ? null : a.getLayoutValue(\"line-miter-limit\", o);\n    _ = a.getLayoutProperty(\"line-round-limit\");\n    const B = null != (s = _) && s.isDataDriven ? _ : null,\n          T = B ? null : a.getLayoutValue(\"line-round-limit\", o);\n    _ = a.getPaintProperty(\"line-width\");\n    const j = null != (l = _) && l.isDataDriven ? _ : null,\n          A = j ? null : a.getPaintValue(\"line-width\", o);\n    _ = a.getPaintProperty(\"line-offset\");\n    const b = null != (r = _) && r.isDataDriven ? _ : null,\n          w = b ? null : a.getPaintValue(\"line-offset\", o);\n\n    if (y || c) {\n      const t = [];\n\n      for (const i of u) {\n        const n = y ? d.getValue(o, i) : this._getDashArrayKey(i, o, a, g, V, x, m),\n              s = this._spriteInfo[n];\n        if (!s || !s.rect) continue;\n        const l = p.encodeAttributes(i, o, a, s),\n              r = i.getGeometry(e);\n        t.push({\n          ddAttributes: l,\n          page: s.page,\n          cap: x ? x.getValue(o, i) : D,\n          join: P ? P.getValue(o, i) : I,\n          miterLimit: L ? L.getValue(o, i) : v,\n          roundLimit: B ? B.getValue(o, i) : T,\n          halfWidth: .5 * (j ? j.getValue(o, i) : A),\n          offset: b ? b.getValue(o, i) : w,\n          geometry: r\n        });\n      }\n\n      t.sort((e, t) => e.page - t.page), f.textured = !0;\n\n      for (const {\n        ddAttributes: e,\n        page: i,\n        cap: n,\n        join: s,\n        miterLimit: l,\n        roundLimit: r,\n        halfWidth: a,\n        offset: o,\n        geometry: u\n      } of t) f.capType = n, f.joinType = s, f.miterLimit = l, f.roundLimit = r, f.halfWidth = a, f.offset = o, this._processFeature(u, e, i);\n    } else {\n      f.textured = !(!d && !g), f.capType = D, f.joinType = I, f.miterLimit = v, f.roundLimit = T, f.halfWidth = .5 * A, f.offset = w;\n\n      for (const t of u) {\n        const i = h ? p.encodeAttributes(t, o, a) : null;\n        x && (f.capType = x.getValue(o, t)), P && (f.joinType = P.getValue(o, t)), L && (f.miterLimit = L.getValue(o, t)), B && (f.roundLimit = B.getValue(o, t)), j && (f.halfWidth = .5 * j.getValue(o, t)), b && (f.offset = b.getValue(o, t));\n        const n = t.getGeometry(e);\n\n        this._processFeature(n, i);\n      }\n    }\n  }\n\n  serialize() {\n    let e = 6;\n    e += this.layerUIDs.length, e += this.tessellationProperties._lineVertexBuffer.array.length, e += this.tessellationProperties._lineIndexBuffer.array.length, e += 3 * this._patternMap.size + 1;\n    const t = new Uint32Array(e),\n          i = new Int32Array(t.buffer);\n    let n = 0;\n    t[n++] = this.type, t[n++] = this.layerUIDs.length;\n\n    for (let r = 0; r < this.layerUIDs.length; r++) t[n++] = this.layerUIDs[r];\n\n    t[n++] = this._lineIndexStart, t[n++] = this._lineIndexCount;\n    const s = this._patternMap,\n          l = s.size;\n    if (t[n++] = l, l > 0) for (const [r, [a, o]] of s) t[n++] = r, t[n++] = a, t[n++] = o;\n    t[n++] = this.tessellationProperties._lineVertexBuffer.array.length;\n\n    for (let r = 0; r < this.tessellationProperties._lineVertexBuffer.array.length; r++) i[n++] = this.tessellationProperties._lineVertexBuffer.array[r];\n\n    t[n++] = this.tessellationProperties._lineIndexBuffer.array.length;\n\n    for (let r = 0; r < this.tessellationProperties._lineIndexBuffer.array.length; r++) t[n++] = this.tessellationProperties._lineIndexBuffer.array[r];\n\n    return t.buffer;\n  }\n\n  _processFeature(e, t, i) {\n    if (!e) return;\n    const n = e.length;\n\n    for (let s = 0; s < n; s++) this._processGeometry(e[s], t, i);\n  }\n\n  _processGeometry(e, t, i) {\n    if (e.length < 2) return;\n    const s = .001;\n    let l,\n        r,\n        a = e[0],\n        o = 1;\n\n    for (; o < e.length;) l = e[o].x - a.x, r = e[o].y - a.y, l * l + r * r < s * s ? e.splice(o, 1) : (a = e[o], ++o);\n\n    if (e.length < 2) return;\n    const u = this.tessellationProperties._lineIndexBuffer,\n          f = 3 * u.index;\n    this._tessellationOptions.initialDistance = 0, this._tessellationOptions.wrapDistance = n, this.tessellationProperties._ddValues = t, this._lineTessellator.tessellate(e, this._tessellationOptions);\n    const h = 3 * u.index - f;\n\n    if (void 0 !== i) {\n      const e = this._patternMap,\n            t = e.get(i);\n      t ? t[1] += h : e.set(i, [f + this._lineIndexCount, h]);\n    }\n\n    this._lineIndexCount += h;\n  }\n\n  _getDashArrayKey(e, t, i, n, s, l, r) {\n    const a = s ? l.getValue(t, e) : r,\n          o = n.getValue(t, e);\n    return i.getDashKey(o, a);\n  }\n\n}\n\nconst l = e => (t, i, n, s, l, r, a, o, u, f, h) => (e._lineVertexBuffer.add(t, i, a, o, n, s, l, r, u, f, h, e._ddValues), e._lineVertexBuffer.index - 1),\n      r = e => (t, i, n) => {\n  e._lineIndexBuffer.add(t, i, n);\n};\n\nexport { s as default };","map":{"version":3,"sources":["D:/Github/CUSP_DataBase/CUSP_DB/src/main/gis/node_modules/@arcgis/core/views/2d/engine/vectorTiles/buckets/LineBucket.js"],"names":["BucketType","e","t","LineTessellation","i","n","s","constructor","a","o","type","LINE","_tessellationOptions","pixelCoordRatio","halfWidth","offset","_patternMap","Map","tessellationProperties","_lineVertexBuffer","_lineIndexBuffer","_ddValues","_lineTessellator","l","r","canUseThinTessellation","lineIndexStart","_lineIndexStart","lineIndexCount","_lineIndexCount","getResources","layer","zoom","hasDataDrivenLine","getPaintProperty","getLayoutProperty","u","getValue","f","isDataDriven","_features","_getDashArrayKey","getDashKey","processFeatures","index","h","lineMaterial","p","setExtent","layerExtent","d","g","y","c","_","x","D","getLayoutValue","m","V","P","I","L","v","B","T","j","A","getPaintValue","b","w","_spriteInfo","rect","encodeAttributes","getGeometry","push","ddAttributes","page","cap","join","miterLimit","roundLimit","geometry","sort","textured","capType","joinType","_processFeature","serialize","layerUIDs","length","array","size","Uint32Array","Int32Array","buffer","_processGeometry","splice","initialDistance","wrapDistance","tessellate","get","set","add","default"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport{BucketType as e}from\"../enums.js\";import t from\"./BaseBucket.js\";import{LineTessellation as i}from\"../../webgl/TurboLine.js\";const n=65535;class s extends t{constructor(t,n,s,a,o){super(t,n,s),this.type=e.LINE,this._tessellationOptions={pixelCoordRatio:8,halfWidth:0,offset:0},this._patternMap=new Map,this.tessellationProperties={_lineVertexBuffer:null,_lineIndexBuffer:null,_ddValues:null},this.tessellationProperties._lineVertexBuffer=a,this.tessellationProperties._lineIndexBuffer=o,this._lineTessellator=new i(l(this.tessellationProperties),r(this.tessellationProperties),t.canUseThinTessellation)}get lineIndexStart(){return this._lineIndexStart}get lineIndexCount(){return this._lineIndexCount}getResources(e,t,i){const n=this.layer,s=this.zoom,l=n.hasDataDrivenLine,r=n.getPaintProperty(\"line-pattern\"),a=n.getPaintProperty(\"line-dasharray\"),o=n.getLayoutProperty(\"line-cap\");if(!r&&!a)return;const u=(null==o?void 0:o.getValue(s))||0,f=null==o?void 0:o.isDataDriven;if(l){const e=null==r?void 0:r.isDataDriven,i=null==a?void 0:a.isDataDriven;if(!e&&!i)return;for(const l of this._features)t(e?r.getValue(s,l):this._getDashArrayKey(l,s,n,a,f,o,u))}else if(r)t(r.getValue(s));else if(a){const e=a.getValue(s);t(n.getDashKey(e,u))}}processFeatures(e){var t,i,n,s,l,r;this._lineIndexStart=3*this.tessellationProperties._lineIndexBuffer.index,this._lineIndexCount=0;const a=this.layer,o=this.zoom,u=this._features,f=this._tessellationOptions,{hasDataDrivenLine:h,lineMaterial:p}=a;e&&e.setExtent(this.layerExtent);const d=a.getPaintProperty(\"line-pattern\"),g=a.getPaintProperty(\"line-dasharray\"),y=null==d?void 0:d.isDataDriven,c=null==g?void 0:g.isDataDriven;let _;_=a.getLayoutProperty(\"line-cap\");const x=null!=(t=_)&&t.isDataDriven?_:null,D=x?null:a.getLayoutValue(\"line-cap\",o),m=D||0,V=!!x;_=a.getLayoutProperty(\"line-join\");const P=null!=(i=_)&&i.isDataDriven?_:null,I=P?null:a.getLayoutValue(\"line-join\",o);_=a.getLayoutProperty(\"line-miter-limit\");const L=null!=(n=_)&&n.isDataDriven?_:null,v=L?null:a.getLayoutValue(\"line-miter-limit\",o);_=a.getLayoutProperty(\"line-round-limit\");const B=null!=(s=_)&&s.isDataDriven?_:null,T=B?null:a.getLayoutValue(\"line-round-limit\",o);_=a.getPaintProperty(\"line-width\");const j=null!=(l=_)&&l.isDataDriven?_:null,A=j?null:a.getPaintValue(\"line-width\",o);_=a.getPaintProperty(\"line-offset\");const b=null!=(r=_)&&r.isDataDriven?_:null,w=b?null:a.getPaintValue(\"line-offset\",o);if(y||c){const t=[];for(const i of u){const n=y?d.getValue(o,i):this._getDashArrayKey(i,o,a,g,V,x,m),s=this._spriteInfo[n];if(!s||!s.rect)continue;const l=p.encodeAttributes(i,o,a,s),r=i.getGeometry(e);t.push({ddAttributes:l,page:s.page,cap:x?x.getValue(o,i):D,join:P?P.getValue(o,i):I,miterLimit:L?L.getValue(o,i):v,roundLimit:B?B.getValue(o,i):T,halfWidth:.5*(j?j.getValue(o,i):A),offset:b?b.getValue(o,i):w,geometry:r})}t.sort(((e,t)=>e.page-t.page)),f.textured=!0;for(const{ddAttributes:e,page:i,cap:n,join:s,miterLimit:l,roundLimit:r,halfWidth:a,offset:o,geometry:u}of t)f.capType=n,f.joinType=s,f.miterLimit=l,f.roundLimit=r,f.halfWidth=a,f.offset=o,this._processFeature(u,e,i)}else{f.textured=!(!d&&!g),f.capType=D,f.joinType=I,f.miterLimit=v,f.roundLimit=T,f.halfWidth=.5*A,f.offset=w;for(const t of u){const i=h?p.encodeAttributes(t,o,a):null;x&&(f.capType=x.getValue(o,t)),P&&(f.joinType=P.getValue(o,t)),L&&(f.miterLimit=L.getValue(o,t)),B&&(f.roundLimit=B.getValue(o,t)),j&&(f.halfWidth=.5*j.getValue(o,t)),b&&(f.offset=b.getValue(o,t));const n=t.getGeometry(e);this._processFeature(n,i)}}}serialize(){let e=6;e+=this.layerUIDs.length,e+=this.tessellationProperties._lineVertexBuffer.array.length,e+=this.tessellationProperties._lineIndexBuffer.array.length,e+=3*this._patternMap.size+1;const t=new Uint32Array(e),i=new Int32Array(t.buffer);let n=0;t[n++]=this.type,t[n++]=this.layerUIDs.length;for(let r=0;r<this.layerUIDs.length;r++)t[n++]=this.layerUIDs[r];t[n++]=this._lineIndexStart,t[n++]=this._lineIndexCount;const s=this._patternMap,l=s.size;if(t[n++]=l,l>0)for(const[r,[a,o]]of s)t[n++]=r,t[n++]=a,t[n++]=o;t[n++]=this.tessellationProperties._lineVertexBuffer.array.length;for(let r=0;r<this.tessellationProperties._lineVertexBuffer.array.length;r++)i[n++]=this.tessellationProperties._lineVertexBuffer.array[r];t[n++]=this.tessellationProperties._lineIndexBuffer.array.length;for(let r=0;r<this.tessellationProperties._lineIndexBuffer.array.length;r++)t[n++]=this.tessellationProperties._lineIndexBuffer.array[r];return t.buffer}_processFeature(e,t,i){if(!e)return;const n=e.length;for(let s=0;s<n;s++)this._processGeometry(e[s],t,i)}_processGeometry(e,t,i){if(e.length<2)return;const s=.001;let l,r,a=e[0],o=1;for(;o<e.length;)l=e[o].x-a.x,r=e[o].y-a.y,l*l+r*r<s*s?e.splice(o,1):(a=e[o],++o);if(e.length<2)return;const u=this.tessellationProperties._lineIndexBuffer,f=3*u.index;this._tessellationOptions.initialDistance=0,this._tessellationOptions.wrapDistance=n,this.tessellationProperties._ddValues=t,this._lineTessellator.tessellate(e,this._tessellationOptions);const h=3*u.index-f;if(void 0!==i){const e=this._patternMap,t=e.get(i);t?t[1]+=h:e.set(i,[f+this._lineIndexCount,h])}this._lineIndexCount+=h}_getDashArrayKey(e,t,i,n,s,l,r){const a=s?l.getValue(t,e):r,o=n.getValue(t,e);return i.getDashKey(o,a)}}const l=e=>(t,i,n,s,l,r,a,o,u,f,h)=>(e._lineVertexBuffer.add(t,i,a,o,n,s,l,r,u,f,h,e._ddValues),e._lineVertexBuffer.index-1),r=e=>(t,i,n)=>{e._lineIndexBuffer.add(t,i,n)};export{s as default};\n"]},"metadata":{},"sourceType":"module"}