{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport { disposeMaybe as t, isSome as e, isNone as o } from \"../../../../../core/maybe.js\";\nimport r from \"../../../../../core/RandomLCG.js\";\nimport { TEXTURE_BINDING_RENDERER_0 as i, TEXTURE_BINDING_RENDERER_1 as s, TILE_SIZE as a } from \"../definitions.js\";\nimport { WGLGeometryType as n } from \"../enums.js\";\nimport { createProgramDescriptor as d } from \"../Utils.js\";\nimport l from \"./WGLGeometryBrush.js\";\nimport { FillMaterialKey as m } from \"../materialKey/MaterialKey.js\";\nimport { BufferObject as _ } from \"../../../../webgl/BufferObject.js\";\nimport { PrimitiveType as u, DataType as c, TextureType as f, PixelFormat as h, PixelType as T, TextureSamplingMode as p, TextureWrapMode as y, TargetType as x, DepthStencilTargetType as D, RenderbufferFormat as g, Usage as E } from \"../../../../webgl/enums.js\";\nimport { FramebufferObject as S } from \"../../../../webgl/FramebufferObject.js\";\nimport { Renderbuffer as w } from \"../../../../webgl/Renderbuffer.js\";\nimport { Texture as U } from \"../../../../webgl/Texture.js\";\nimport { VertexArrayObject as O } from \"../../../../webgl/VertexArrayObject.js\";\n\nconst b = t => {\n  const e = {\n    geometry: [{\n      location: 0,\n      name: \"a_pos\",\n      count: 2,\n      type: c.SHORT\n    }, {\n      location: 1,\n      name: \"a_id\",\n      count: 3,\n      type: c.UNSIGNED_BYTE\n    }, {\n      location: 2,\n      name: \"a_bitset\",\n      count: 1,\n      type: c.UNSIGNED_BYTE\n    }]\n  };\n  return t.dotDensity ? (e.geometry.push({\n    location: 3,\n    name: \"a_inverseArea\",\n    count: 1,\n    type: c.FLOAT\n  }), d(t.data, e)) : (e.geometry.push({\n    location: 3,\n    name: \"a_color\",\n    count: 4,\n    type: c.UNSIGNED_BYTE,\n    normalized: !0\n  }), t.simple || e.geometry.push({\n    location: 4,\n    name: \"a_aux1\",\n    count: 4,\n    type: c.UNSIGNED_SHORT\n  }), e.geometry.push({\n    location: 5,\n    name: \"a_aux2\",\n    count: 4,\n    type: c.UNSIGNED_BYTE\n  }, {\n    location: 6,\n    name: \"a_aux3\",\n    count: 4,\n    type: c.UNSIGNED_BYTE\n  }), t.simple || e.geometry.push({\n    location: 7,\n    name: \"a_zoomRange\",\n    count: 2,\n    type: c.UNSIGNED_SHORT\n  }), d(t.data, e));\n};\n\nclass N extends l {\n  constructor() {\n    super(...arguments), this._dotTextureSize = 0, this._dotTextures = null, this._dotSamplers = new Int32Array([i, s]), this._dotVAO = null, this._dotDesc = {\n      vsPath: \"dot/dot\",\n      fsPath: \"dot/dot\",\n      attributes: new Map([[\"a_pos\", 0]])\n    };\n  }\n\n  dispose() {\n    this._disposeTextures(), this._dotFBO = t(this._dotFBO), this._dotVAO = t(this._dotVAO);\n  }\n\n  getGeometryType() {\n    return n.FILL;\n  }\n\n  drawGeometry(t, o, r, i) {\n    const {\n      context: s,\n      painter: a,\n      rendererInfo: n,\n      requiredLevel: d,\n      passOptions: l\n    } = t,\n          _ = m.load(r.materialKey),\n          f = a.materialManager;\n\n    let h = u.TRIANGLES,\n        T = b(_);\n    e(l) && \"hittest\" === l.type && (T = this._getTriangleDesc(r.materialKey, T), h = u.POINTS);\n    const {\n      attributes: p,\n      bufferLayouts: y\n    } = T,\n          x = f.getMaterialProgram(t, _, \"materials/fill\", p, i);\n\n    if (s.useProgram(x), this._setSharedUniforms(x, t, o), x.setUniform2f(\"u_tileOffset\", 512 * o.key.col, 512 * o.key.row), _.textureBinding) {\n      a.textureManager.bindTextures(s, x, _);\n      const e = 1 / 2 ** (d - o.key.level) / t.pixelRatio;\n      x.setUniform1f(\"u_zoomFactor\", e);\n    }\n\n    const D = 1 / t.pixelRatio;\n    x.setUniform1f(\"u_blur\", D), x.setUniform1f(\"u_antialiasing\", D), this._setSizeVVUniforms(_, x, n, o), this._setColorAndOpacityVVUniforms(_, x, n);\n    const g = e(l) && \"hittest\" === l.type,\n          E = r.target.getVAO(s, y, p, g);\n    let S = r.indexCount,\n        w = r.indexFrom * Uint32Array.BYTES_PER_ELEMENT;\n    if (g && (S /= 3, w /= 3), s.bindVAO(E), !_.dotDensity || g) s.drawElements(h, S, c.UNSIGNED_INT, w);else {\n      const e = this._drawDotLocations(t, o, x, S, w);\n\n      this._drawDotDensity(t, o, e);\n    }\n  }\n\n  _drawDotDensity(t, e, o) {\n    const {\n      context: r,\n      painter: i,\n      rendererInfo: s\n    } = t,\n          a = i.materialManager.getProgram(t, this._dotDesc),\n          n = this._createDotDensityMesh(r, this._dotDesc.attributes, {\n      geometry: [{\n        name: \"a_pos\",\n        count: 2,\n        type: c.SHORT,\n        divisor: 0,\n        normalized: !1,\n        offset: 0,\n        stride: 4\n      }]\n    });\n\n    r.setStencilTestEnabled(!0), r.useProgram(a), a.setUniform1f(\"u_tileZoomFactor\", 1), a.setUniform1i(\"u_texture\", this._dotSamplers[0]), a.setUniform1f(\"u_dotSize\", Math.max(s.ddDotSize, 1)), a.setUniform1f(\"u_pixelRatio\", window.devicePixelRatio), this._setSharedUniforms(a, t, e), r.bindTexture(o, this._dotSamplers[0]), r.bindVAO(n), r.drawArrays(u.POINTS, 0, 262144);\n  }\n\n  _drawDotLocations(t, e, o, r, i) {\n    const {\n      context: s,\n      rendererInfo: n,\n      requiredLevel: d\n    } = t,\n          l = s.getViewport();\n    s.setViewport(0, 0, 512, 512);\n\n    const m = s.getBoundFramebufferObject(),\n          _ = this._createFBO(s);\n\n    s.bindFramebuffer(_), s.setClearColor(0, 0, 0, 0), s.clear(s.gl.COLOR_BUFFER_BIT | s.gl.STENCIL_BUFFER_BIT), s.setStencilTestEnabled(!1);\n    const f = 1 / 2 ** (d - e.key.level),\n          h = a,\n          T = h * window.devicePixelRatio * h * window.devicePixelRatio,\n          p = 1 / f * (1 / f),\n          y = n.ddDotScale ? t.state.scale / n.ddDotScale : 1;\n    return o.setUniform1f(\"u_tileZoomFactor\", f), o.setUniform1f(\"u_tileDotsOverArea\", T / (a * window.devicePixelRatio * a * window.devicePixelRatio)), o.setUniformMatrix4fv(\"u_dotColors\", n.ddColors), o.setUniform4fv(\"u_isActive\", n.ddActiveDots), o.setUniform4fv(\"u_dotBackgroundColor\", n.ddBackgroundColor), o.setUniform1f(\"u_dotValue\", Math.max(1, n.ddDotValue * y * p)), this._bindDotDensityTextures(s, o, n, h), s.drawElements(u.TRIANGLES, r, c.UNSIGNED_INT, i), s.setViewport(l.x, l.y, l.width, l.height), s.bindFramebuffer(m), _.colorTexture;\n  }\n\n  _createFBO(t) {\n    if (o(this._dotFBO)) {\n      const e = 512,\n            o = 512,\n            r = {\n        target: f.TEXTURE_2D,\n        pixelFormat: h.RGBA,\n        dataType: T.UNSIGNED_BYTE,\n        samplingMode: p.NEAREST,\n        wrapMode: y.CLAMP_TO_EDGE,\n        width: e,\n        height: o\n      },\n            i = {\n        colorTarget: x.TEXTURE,\n        depthStencilTarget: D.DEPTH_STENCIL_RENDER_BUFFER\n      },\n            s = new w(t, {\n        width: e,\n        height: o,\n        internalFormat: g.DEPTH_STENCIL\n      });\n      this._dotFBO = new S(t, i, r, s);\n    }\n\n    return this._dotFBO;\n  }\n\n  _disposeTextures() {\n    if (this._dotTextures) {\n      for (let t = 0; t < this._dotTextures.length; t++) this._dotTextures[t].dispose();\n\n      this._dotTextures = null;\n    }\n  }\n\n  _bindDotDensityTextures(t, e, o, r) {\n    const i = this._createDotDensityTextures(t, r, o.ddSeed);\n\n    e.setUniform1iv(\"u_dotTextures\", this._dotSamplers);\n\n    for (let s = 0; s < i.length; s++) t.bindTexture(i[s], this._dotSamplers[s]);\n  }\n\n  _createDotDensityMesh(t, e, r) {\n    if (o(this._dotVAO)) {\n      const o = 2,\n            i = new Int16Array(262144 * o);\n\n      for (let t = 0; t < 512; t++) for (let e = 0; e < 512; e++) i[o * (e + 512 * t)] = e, i[o * (e + 512 * t) + 1] = t;\n\n      const s = _.createVertex(t, E.STATIC_DRAW, i);\n\n      this._dotVAO = new O(t, e, r, {\n        geometry: s\n      }, null);\n    }\n\n    return this._dotVAO;\n  }\n\n  _createDotDensityTextures(t, e, o) {\n    if (this._dotTextureSize === e && this._seed === o || (this._disposeTextures(), this._dotTextureSize = e, this._seed = o), null === this._dotTextures) {\n      const i = new r(o);\n      this._dotTextures = [this._allocDotDensityTexture(t, e, i), this._allocDotDensityTexture(t, e, i)];\n    }\n\n    return this._dotTextures;\n  }\n\n  _allocDotDensityTexture(t, e, o) {\n    const r = new Float32Array(e * e * 4);\n\n    for (let i = 0; i < r.length; i++) r[i] = o.getFloat();\n\n    return new U(t, {\n      wrapMode: y.REPEAT,\n      pixelFormat: h.RGBA,\n      dataType: T.FLOAT,\n      samplingMode: p.NEAREST,\n      width: e,\n      height: e\n    }, r);\n  }\n\n}\n\nexport { N as default };","map":{"version":3,"sources":["D:/Github/CUSP_DataBase/CUSP_DB/src/main/gis/node_modules/@arcgis/core/views/2d/engine/webgl/brushes/WGLGeometryBrushFill.js"],"names":["disposeMaybe","t","isSome","e","isNone","o","r","TEXTURE_BINDING_RENDERER_0","i","TEXTURE_BINDING_RENDERER_1","s","TILE_SIZE","a","WGLGeometryType","n","createProgramDescriptor","d","l","FillMaterialKey","m","BufferObject","_","PrimitiveType","u","DataType","c","TextureType","f","PixelFormat","h","PixelType","T","TextureSamplingMode","p","TextureWrapMode","y","TargetType","x","DepthStencilTargetType","D","RenderbufferFormat","g","Usage","E","FramebufferObject","S","Renderbuffer","w","Texture","U","VertexArrayObject","O","b","geometry","location","name","count","type","SHORT","UNSIGNED_BYTE","dotDensity","push","FLOAT","data","normalized","simple","UNSIGNED_SHORT","N","constructor","arguments","_dotTextureSize","_dotTextures","_dotSamplers","Int32Array","_dotVAO","_dotDesc","vsPath","fsPath","attributes","Map","dispose","_disposeTextures","_dotFBO","getGeometryType","FILL","drawGeometry","context","painter","rendererInfo","requiredLevel","passOptions","load","materialKey","materialManager","TRIANGLES","_getTriangleDesc","POINTS","bufferLayouts","getMaterialProgram","useProgram","_setSharedUniforms","setUniform2f","key","col","row","textureBinding","textureManager","bindTextures","level","pixelRatio","setUniform1f","_setSizeVVUniforms","_setColorAndOpacityVVUniforms","target","getVAO","indexCount","indexFrom","Uint32Array","BYTES_PER_ELEMENT","bindVAO","drawElements","UNSIGNED_INT","_drawDotLocations","_drawDotDensity","getProgram","_createDotDensityMesh","divisor","offset","stride","setStencilTestEnabled","setUniform1i","Math","max","ddDotSize","window","devicePixelRatio","bindTexture","drawArrays","getViewport","setViewport","getBoundFramebufferObject","_createFBO","bindFramebuffer","setClearColor","clear","gl","COLOR_BUFFER_BIT","STENCIL_BUFFER_BIT","ddDotScale","state","scale","setUniformMatrix4fv","ddColors","setUniform4fv","ddActiveDots","ddBackgroundColor","ddDotValue","_bindDotDensityTextures","width","height","colorTexture","TEXTURE_2D","pixelFormat","RGBA","dataType","samplingMode","NEAREST","wrapMode","CLAMP_TO_EDGE","colorTarget","TEXTURE","depthStencilTarget","DEPTH_STENCIL_RENDER_BUFFER","internalFormat","DEPTH_STENCIL","length","_createDotDensityTextures","ddSeed","setUniform1iv","Int16Array","createVertex","STATIC_DRAW","_seed","_allocDotDensityTexture","Float32Array","getFloat","REPEAT","default"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport{disposeMaybe as t,isSome as e,isNone as o}from\"../../../../../core/maybe.js\";import r from\"../../../../../core/RandomLCG.js\";import{TEXTURE_BINDING_RENDERER_0 as i,TEXTURE_BINDING_RENDERER_1 as s,TILE_SIZE as a}from\"../definitions.js\";import{WGLGeometryType as n}from\"../enums.js\";import{createProgramDescriptor as d}from\"../Utils.js\";import l from\"./WGLGeometryBrush.js\";import{FillMaterialKey as m}from\"../materialKey/MaterialKey.js\";import{BufferObject as _}from\"../../../../webgl/BufferObject.js\";import{PrimitiveType as u,DataType as c,TextureType as f,PixelFormat as h,PixelType as T,TextureSamplingMode as p,TextureWrapMode as y,TargetType as x,DepthStencilTargetType as D,RenderbufferFormat as g,Usage as E}from\"../../../../webgl/enums.js\";import{FramebufferObject as S}from\"../../../../webgl/FramebufferObject.js\";import{Renderbuffer as w}from\"../../../../webgl/Renderbuffer.js\";import{Texture as U}from\"../../../../webgl/Texture.js\";import{VertexArrayObject as O}from\"../../../../webgl/VertexArrayObject.js\";const b=t=>{const e={geometry:[{location:0,name:\"a_pos\",count:2,type:c.SHORT},{location:1,name:\"a_id\",count:3,type:c.UNSIGNED_BYTE},{location:2,name:\"a_bitset\",count:1,type:c.UNSIGNED_BYTE}]};return t.dotDensity?(e.geometry.push({location:3,name:\"a_inverseArea\",count:1,type:c.FLOAT}),d(t.data,e)):(e.geometry.push({location:3,name:\"a_color\",count:4,type:c.UNSIGNED_BYTE,normalized:!0}),t.simple||e.geometry.push({location:4,name:\"a_aux1\",count:4,type:c.UNSIGNED_SHORT}),e.geometry.push({location:5,name:\"a_aux2\",count:4,type:c.UNSIGNED_BYTE},{location:6,name:\"a_aux3\",count:4,type:c.UNSIGNED_BYTE}),t.simple||e.geometry.push({location:7,name:\"a_zoomRange\",count:2,type:c.UNSIGNED_SHORT}),d(t.data,e))};class N extends l{constructor(){super(...arguments),this._dotTextureSize=0,this._dotTextures=null,this._dotSamplers=new Int32Array([i,s]),this._dotVAO=null,this._dotDesc={vsPath:\"dot/dot\",fsPath:\"dot/dot\",attributes:new Map([[\"a_pos\",0]])}}dispose(){this._disposeTextures(),this._dotFBO=t(this._dotFBO),this._dotVAO=t(this._dotVAO)}getGeometryType(){return n.FILL}drawGeometry(t,o,r,i){const{context:s,painter:a,rendererInfo:n,requiredLevel:d,passOptions:l}=t,_=m.load(r.materialKey),f=a.materialManager;let h=u.TRIANGLES,T=b(_);e(l)&&\"hittest\"===l.type&&(T=this._getTriangleDesc(r.materialKey,T),h=u.POINTS);const{attributes:p,bufferLayouts:y}=T,x=f.getMaterialProgram(t,_,\"materials/fill\",p,i);if(s.useProgram(x),this._setSharedUniforms(x,t,o),x.setUniform2f(\"u_tileOffset\",512*o.key.col,512*o.key.row),_.textureBinding){a.textureManager.bindTextures(s,x,_);const e=1/2**(d-o.key.level)/t.pixelRatio;x.setUniform1f(\"u_zoomFactor\",e)}const D=1/t.pixelRatio;x.setUniform1f(\"u_blur\",D),x.setUniform1f(\"u_antialiasing\",D),this._setSizeVVUniforms(_,x,n,o),this._setColorAndOpacityVVUniforms(_,x,n);const g=e(l)&&\"hittest\"===l.type,E=r.target.getVAO(s,y,p,g);let S=r.indexCount,w=r.indexFrom*Uint32Array.BYTES_PER_ELEMENT;if(g&&(S/=3,w/=3),s.bindVAO(E),!_.dotDensity||g)s.drawElements(h,S,c.UNSIGNED_INT,w);else{const e=this._drawDotLocations(t,o,x,S,w);this._drawDotDensity(t,o,e)}}_drawDotDensity(t,e,o){const{context:r,painter:i,rendererInfo:s}=t,a=i.materialManager.getProgram(t,this._dotDesc),n=this._createDotDensityMesh(r,this._dotDesc.attributes,{geometry:[{name:\"a_pos\",count:2,type:c.SHORT,divisor:0,normalized:!1,offset:0,stride:4}]});r.setStencilTestEnabled(!0),r.useProgram(a),a.setUniform1f(\"u_tileZoomFactor\",1),a.setUniform1i(\"u_texture\",this._dotSamplers[0]),a.setUniform1f(\"u_dotSize\",Math.max(s.ddDotSize,1)),a.setUniform1f(\"u_pixelRatio\",window.devicePixelRatio),this._setSharedUniforms(a,t,e),r.bindTexture(o,this._dotSamplers[0]),r.bindVAO(n),r.drawArrays(u.POINTS,0,262144)}_drawDotLocations(t,e,o,r,i){const{context:s,rendererInfo:n,requiredLevel:d}=t,l=s.getViewport();s.setViewport(0,0,512,512);const m=s.getBoundFramebufferObject(),_=this._createFBO(s);s.bindFramebuffer(_),s.setClearColor(0,0,0,0),s.clear(s.gl.COLOR_BUFFER_BIT|s.gl.STENCIL_BUFFER_BIT),s.setStencilTestEnabled(!1);const f=1/2**(d-e.key.level),h=a,T=h*window.devicePixelRatio*h*window.devicePixelRatio,p=1/f*(1/f),y=n.ddDotScale?t.state.scale/n.ddDotScale:1;return o.setUniform1f(\"u_tileZoomFactor\",f),o.setUniform1f(\"u_tileDotsOverArea\",T/(a*window.devicePixelRatio*a*window.devicePixelRatio)),o.setUniformMatrix4fv(\"u_dotColors\",n.ddColors),o.setUniform4fv(\"u_isActive\",n.ddActiveDots),o.setUniform4fv(\"u_dotBackgroundColor\",n.ddBackgroundColor),o.setUniform1f(\"u_dotValue\",Math.max(1,n.ddDotValue*y*p)),this._bindDotDensityTextures(s,o,n,h),s.drawElements(u.TRIANGLES,r,c.UNSIGNED_INT,i),s.setViewport(l.x,l.y,l.width,l.height),s.bindFramebuffer(m),_.colorTexture}_createFBO(t){if(o(this._dotFBO)){const e=512,o=512,r={target:f.TEXTURE_2D,pixelFormat:h.RGBA,dataType:T.UNSIGNED_BYTE,samplingMode:p.NEAREST,wrapMode:y.CLAMP_TO_EDGE,width:e,height:o},i={colorTarget:x.TEXTURE,depthStencilTarget:D.DEPTH_STENCIL_RENDER_BUFFER},s=new w(t,{width:e,height:o,internalFormat:g.DEPTH_STENCIL});this._dotFBO=new S(t,i,r,s)}return this._dotFBO}_disposeTextures(){if(this._dotTextures){for(let t=0;t<this._dotTextures.length;t++)this._dotTextures[t].dispose();this._dotTextures=null}}_bindDotDensityTextures(t,e,o,r){const i=this._createDotDensityTextures(t,r,o.ddSeed);e.setUniform1iv(\"u_dotTextures\",this._dotSamplers);for(let s=0;s<i.length;s++)t.bindTexture(i[s],this._dotSamplers[s])}_createDotDensityMesh(t,e,r){if(o(this._dotVAO)){const o=2,i=new Int16Array(262144*o);for(let t=0;t<512;t++)for(let e=0;e<512;e++)i[o*(e+512*t)]=e,i[o*(e+512*t)+1]=t;const s=_.createVertex(t,E.STATIC_DRAW,i);this._dotVAO=new O(t,e,r,{geometry:s},null)}return this._dotVAO}_createDotDensityTextures(t,e,o){if(this._dotTextureSize===e&&this._seed===o||(this._disposeTextures(),this._dotTextureSize=e,this._seed=o),null===this._dotTextures){const i=new r(o);this._dotTextures=[this._allocDotDensityTexture(t,e,i),this._allocDotDensityTexture(t,e,i)]}return this._dotTextures}_allocDotDensityTexture(t,e,o){const r=new Float32Array(e*e*4);for(let i=0;i<r.length;i++)r[i]=o.getFloat();return new U(t,{wrapMode:y.REPEAT,pixelFormat:h.RGBA,dataType:T.FLOAT,samplingMode:p.NEAREST,width:e,height:e},r)}}export{N as default};\n"]},"metadata":{},"sourceType":"module"}