{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport { applySome as t, isNone as i, unwrapOrThrow as e } from \"../../../../../core/maybe.js\";\nimport { TypedBuffer as r } from \"../BufferPool.js\";\nimport { FreeList as s } from \"./FreeList.js\";\nimport { BufferObject as h } from \"../../../../webgl/BufferObject.js\";\nimport { Usage as n } from \"../../../../webgl/enums.js\";\nconst a = 1.25,\n      u = 32767,\n      d = u << 16 | u;\n\nclass f {\n  constructor(t, i, e) {\n    const s = r.create(i * e * Uint32Array.BYTES_PER_ELEMENT);\n    this.size = i, this.strideInt = e, this.bufferType = t, this.dirty = {\n      start: 1 / 0,\n      end: 0\n    }, this._gpu = null, this._cpu = s, this.clear();\n  }\n\n  get elementSize() {\n    return this._cpu.length / this.strideInt;\n  }\n\n  get invalidated() {\n    return this.bufferSize && !this._gpu;\n  }\n\n  invalidate() {\n    this._invalidateTriangleBuffer(), t(this._gpu, t => t.dispose()), this._gpu = null;\n  }\n\n  _invalidateTriangleBuffer() {\n    t(this._gpuComputeTriangles, t => t.dispose()), this._gpuComputeTriangles = null;\n  }\n\n  destroy() {\n    t(this._gpu, t => t.dispose()), t(this._gpuComputeTriangles, t => t.dispose()), t(this._cpu, t => t.destroy()), t(this._cpu2, t => t.destroy());\n  }\n\n  clear() {\n    this.dirty.start = 1 / 0, this.dirty.end = 0, this.freeList = new s({\n      start: 0,\n      end: this._cpu.length / this.strideInt\n    }), this.fillPointer = 0;\n  }\n\n  ensure(t) {\n    if (this.maxAvailableSpace() >= t) return;\n\n    if (t * this.strideInt > this._cpu.length - this.fillPointer) {\n      this.invalidate();\n      const i = this._cpu.length / this.strideInt,\n            e = Math.round((i + t) * a),\n            r = e * this.strideInt;\n      this._cpu.expand(r * Uint32Array.BYTES_PER_ELEMENT), this.freeList.free(i, e - i);\n    }\n  }\n\n  set(t, i) {\n    this._cpu.array[t] !== i && (this._cpu.array[t] = i, this.dirty.start = Math.min(t, this.dirty.start), this.dirty.end = Math.max(t, this.dirty.end));\n  }\n\n  getGPUBuffer(t) {\n    let e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : !1;\n    if (!this.bufferSize) return null;\n\n    if (e) {\n      if (\"index\" !== this.bufferType) throw new Error(\"Tired to get triangle buffer, but target is not an index buffer\");\n      return i(this._gpuComputeTriangles) && (this._gpuComputeTriangles = this._createComputeBuffer(t)), this._gpuComputeTriangles;\n    }\n\n    return i(this._gpu) && (this._gpu = this._createBuffer(t)), this._gpu;\n  }\n\n  getCPUBuffer() {\n    if (!this._cpu2) {\n      const t = this._cpu.slice();\n\n      this._cpu2 = t;\n    }\n\n    return this._cpu2.length !== this._cpu.length && this._cpu2.expand(this._cpu.length * this._cpu.array.BYTES_PER_ELEMENT), this._cpu2.set(this._cpu), this._cpu2;\n  }\n\n  get bufferSize() {\n    return this._cpu.length / this.strideInt;\n  }\n\n  maxAvailableSpace() {\n    return this.freeList.maxAvailableSpace();\n  }\n\n  insert(t, i, r, s) {\n    const h = r * this.strideInt;\n    if (!h) return 0;\n    const n = i * this.strideInt * Uint32Array.BYTES_PER_ELEMENT,\n          a = new Uint32Array(t, n, h),\n          u = e(this.freeList.firstFit(r), \"First fit region must be defined\") * this.strideInt,\n          d = h,\n          f = u / this.strideInt - i;\n    if (0 !== s) for (let e = 0; e < a.length; e++) a[e] += s;\n    return this._cpu.array.set(a, u), this.dirty.start = Math.min(this.dirty.start, u), this.dirty.end = Math.max(this.dirty.end, u + d), this.fillPointer = Math.max(this.fillPointer, u + d), f;\n  }\n\n  free(t, i, e) {\n    const r = t * this.strideInt,\n          s = (t + i) * this.strideInt;\n    if (!0 === e) for (let h = t; h !== t + i; h++) this._cpu.array[h * this.strideInt] = d;\n    this.dirty.start = Math.min(this.dirty.start, r), this.dirty.end = Math.max(this.dirty.end, s), this.freeList.free(t, i);\n  }\n\n  upload() {\n    if (this.dirty.end) {\n      if (this._invalidateTriangleBuffer(), i(this._gpu)) return this.dirty.start = 1 / 0, void (this.dirty.end = 0);\n      this._gpu.setSubDataFromView(this._cpu.array, this.dirty.start, this.dirty.start, this.dirty.end), this.dirty.start = 1 / 0, this.dirty.end = 0;\n    }\n  }\n\n  _createBuffer(t) {\n    const i = n.DYNAMIC_DRAW;\n    return \"index\" === this.bufferType ? h.createIndex(t, i, this._cpu.array) : h.createVertex(t, i, this._cpu.array);\n  }\n\n  _createComputeBuffer(t) {\n    const i = n.DYNAMIC_DRAW,\n          e = new Uint32Array(this.fillPointer / 3);\n\n    for (let r = 0; r < this.fillPointer; r += 3) e[r / 3] = this._cpu.array[r];\n\n    return h.createIndex(t, i, e);\n  }\n\n}\n\nexport { f as Buffer };","map":{"version":3,"sources":["D:/Github/CUSP_DataBase/CUSP_DB/src/main/gis/node_modules/@arcgis/core/views/2d/engine/webgl/cpuMapped/Buffer.js"],"names":["applySome","t","isNone","i","unwrapOrThrow","e","TypedBuffer","r","FreeList","s","BufferObject","h","Usage","n","a","u","d","f","constructor","create","Uint32Array","BYTES_PER_ELEMENT","size","strideInt","bufferType","dirty","start","end","_gpu","_cpu","clear","elementSize","length","invalidated","bufferSize","invalidate","_invalidateTriangleBuffer","dispose","_gpuComputeTriangles","destroy","_cpu2","freeList","fillPointer","ensure","maxAvailableSpace","Math","round","expand","free","set","array","min","max","getGPUBuffer","Error","_createComputeBuffer","_createBuffer","getCPUBuffer","slice","insert","firstFit","upload","setSubDataFromView","DYNAMIC_DRAW","createIndex","createVertex","Buffer"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport{applySome as t,isNone as i,unwrapOrThrow as e}from\"../../../../../core/maybe.js\";import{TypedBuffer as r}from\"../BufferPool.js\";import{FreeList as s}from\"./FreeList.js\";import{BufferObject as h}from\"../../../../webgl/BufferObject.js\";import{Usage as n}from\"../../../../webgl/enums.js\";const a=1.25,u=32767,d=u<<16|u;class f{constructor(t,i,e){const s=r.create(i*e*Uint32Array.BYTES_PER_ELEMENT);this.size=i,this.strideInt=e,this.bufferType=t,this.dirty={start:1/0,end:0},this._gpu=null,this._cpu=s,this.clear()}get elementSize(){return this._cpu.length/this.strideInt}get invalidated(){return this.bufferSize&&!this._gpu}invalidate(){this._invalidateTriangleBuffer(),t(this._gpu,(t=>t.dispose())),this._gpu=null}_invalidateTriangleBuffer(){t(this._gpuComputeTriangles,(t=>t.dispose())),this._gpuComputeTriangles=null}destroy(){t(this._gpu,(t=>t.dispose())),t(this._gpuComputeTriangles,(t=>t.dispose())),t(this._cpu,(t=>t.destroy())),t(this._cpu2,(t=>t.destroy()))}clear(){this.dirty.start=1/0,this.dirty.end=0,this.freeList=new s({start:0,end:this._cpu.length/this.strideInt}),this.fillPointer=0}ensure(t){if(this.maxAvailableSpace()>=t)return;if(t*this.strideInt>this._cpu.length-this.fillPointer){this.invalidate();const i=this._cpu.length/this.strideInt,e=Math.round((i+t)*a),r=e*this.strideInt;this._cpu.expand(r*Uint32Array.BYTES_PER_ELEMENT),this.freeList.free(i,e-i)}}set(t,i){this._cpu.array[t]!==i&&(this._cpu.array[t]=i,this.dirty.start=Math.min(t,this.dirty.start),this.dirty.end=Math.max(t,this.dirty.end))}getGPUBuffer(t,e=!1){if(!this.bufferSize)return null;if(e){if(\"index\"!==this.bufferType)throw new Error(\"Tired to get triangle buffer, but target is not an index buffer\");return i(this._gpuComputeTriangles)&&(this._gpuComputeTriangles=this._createComputeBuffer(t)),this._gpuComputeTriangles}return i(this._gpu)&&(this._gpu=this._createBuffer(t)),this._gpu}getCPUBuffer(){if(!this._cpu2){const t=this._cpu.slice();this._cpu2=t}return this._cpu2.length!==this._cpu.length&&this._cpu2.expand(this._cpu.length*this._cpu.array.BYTES_PER_ELEMENT),this._cpu2.set(this._cpu),this._cpu2}get bufferSize(){return this._cpu.length/this.strideInt}maxAvailableSpace(){return this.freeList.maxAvailableSpace()}insert(t,i,r,s){const h=r*this.strideInt;if(!h)return 0;const n=i*this.strideInt*Uint32Array.BYTES_PER_ELEMENT,a=new Uint32Array(t,n,h),u=e(this.freeList.firstFit(r),\"First fit region must be defined\")*this.strideInt,d=h,f=u/this.strideInt-i;if(0!==s)for(let e=0;e<a.length;e++)a[e]+=s;return this._cpu.array.set(a,u),this.dirty.start=Math.min(this.dirty.start,u),this.dirty.end=Math.max(this.dirty.end,u+d),this.fillPointer=Math.max(this.fillPointer,u+d),f}free(t,i,e){const r=t*this.strideInt,s=(t+i)*this.strideInt;if(!0===e)for(let h=t;h!==t+i;h++)this._cpu.array[h*this.strideInt]=d;this.dirty.start=Math.min(this.dirty.start,r),this.dirty.end=Math.max(this.dirty.end,s),this.freeList.free(t,i)}upload(){if(this.dirty.end){if(this._invalidateTriangleBuffer(),i(this._gpu))return this.dirty.start=1/0,void(this.dirty.end=0);this._gpu.setSubDataFromView(this._cpu.array,this.dirty.start,this.dirty.start,this.dirty.end),this.dirty.start=1/0,this.dirty.end=0}}_createBuffer(t){const i=n.DYNAMIC_DRAW;return\"index\"===this.bufferType?h.createIndex(t,i,this._cpu.array):h.createVertex(t,i,this._cpu.array)}_createComputeBuffer(t){const i=n.DYNAMIC_DRAW,e=new Uint32Array(this.fillPointer/3);for(let r=0;r<this.fillPointer;r+=3)e[r/3]=this._cpu.array[r];return h.createIndex(t,i,e)}}export{f as Buffer};\n"]},"metadata":{},"sourceType":"module"}