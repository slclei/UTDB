{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../../chunks/tslib.es6.js\";\nimport \"../../../geometry.js\";\nimport t from \"../../../core/Error.js\";\nimport r from \"../../../core/has.js\";\nimport o from \"../../../core/Loadable.js\";\nimport s from \"../../../core/Logger.js\";\nimport { isSome as i, isNone as n } from \"../../../core/maybe.js\";\nimport { debounce as a } from \"../../../core/promiseUtils.js\";\nimport { open as u } from \"../../../core/workers/workers.js\";\nimport { property as l } from \"../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../core/arrayUtils.js\";\nimport \"../../../core/accessorSupport/ensureType.js\";\nimport { subclass as c } from \"../../../core/accessorSupport/decorators/subclass.js\";\nimport { createCapabilities as d } from \"./support/clientSideDefaults.js\";\nimport p from \"../../../rest/support/FeatureSet.js\";\nimport h from \"../../../geometry/Extent.js\";\nimport m from \"../../../geometry/Polygon.js\";\nimport { featureGeometryTypeKebabDictionary as y } from \"../../../geometry/support/typeUtils.js\";\nconst f = s.getLogger(\"esri.layers.graphics.sources.GeoJSONSource\");\nlet g = class extends o {\n  constructor() {\n    super(...arguments), this.type = \"geojson\", this.refresh = a(async e => {\n      await this.load();\n      const {\n        extent: t,\n        timeExtent: r\n      } = await this._connection.invoke(\"refresh\", e);\n      return this.sourceJSON.extent = t, r && (this.sourceJSON.timeInfo.timeExtent = [r.start, r.end]), {\n        dataChanged: !0,\n        updates: {\n          extent: this.sourceJSON.extent,\n          timeInfo: this.sourceJSON.timeInfo\n        }\n      };\n    });\n  }\n\n  load(e) {\n    const t = i(e) ? e.signal : null;\n    return this.addResolvingPromise(this._startWorker(t)), Promise.resolve(this);\n  }\n\n  destroy() {\n    var e;\n    null == (e = this._connection) || e.close(), this._connection = null;\n  }\n\n  applyEdits(e) {\n    return this.load().then(() => this._applyEdits(e));\n  }\n\n  openPorts() {\n    return this.load().then(() => this._connection.openPorts());\n  }\n\n  queryFeatures(e) {\n    let t = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    return this.load(t).then(() => this._connection.invoke(\"queryFeatures\", e ? e.toJSON() : null, t)).then(e => p.fromJSON(e));\n  }\n\n  queryFeaturesJSON(e) {\n    let t = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    return this.load(t).then(() => this._connection.invoke(\"queryFeatures\", e ? e.toJSON() : null, t));\n  }\n\n  queryFeatureCount(e) {\n    let t = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    return this.load(t).then(() => this._connection.invoke(\"queryFeatureCount\", e ? e.toJSON() : null, t));\n  }\n\n  queryObjectIds(e) {\n    let t = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    return this.load(t).then(() => this._connection.invoke(\"queryObjectIds\", e ? e.toJSON() : null, t));\n  }\n\n  queryExtent(e) {\n    let t = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    return this.load(t).then(() => this._connection.invoke(\"queryExtent\", e ? e.toJSON() : null, t)).then(e => ({\n      count: e.count,\n      extent: h.fromJSON(e.extent)\n    }));\n  }\n\n  querySnapping(e) {\n    let t = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    return this.load(t).then(() => this._connection.invoke(\"querySnapping\", e, t));\n  }\n\n  _applyEdits(e) {\n    if (!this._connection) throw new t(\"geojson-layer-source:edit-failure\", \"Memory source not loaded\");\n    const r = this.layer.objectIdField,\n          o = [],\n          s = [],\n          i = [];\n    if (e.addFeatures) for (const t of e.addFeatures) o.push(this._serializeFeature(t));\n    if (e.deleteFeatures) for (const t of e.deleteFeatures) \"objectId\" in t && null != t.objectId ? s.push(t.objectId) : \"attributes\" in t && null != t.attributes[r] && s.push(t.attributes[r]);\n    if (e.updateFeatures) for (const t of e.updateFeatures) i.push(this._serializeFeature(t));\n    return this._connection.invoke(\"applyEdits\", {\n      adds: o,\n      updates: i,\n      deletes: s\n    }).then(_ref => {\n      let {\n        extent: e,\n        timeExtent: t,\n        featureEditResults: r\n      } = _ref;\n      return this.sourceJSON.extent = e, t && (this.sourceJSON.timeInfo.timeExtent = [t.start, t.end]), this._createEditsResult(r);\n    });\n  }\n\n  _createEditsResult(e) {\n    return {\n      addFeatureResults: e.addResults ? e.addResults.map(this._createFeatureEditResult, this) : [],\n      updateFeatureResults: e.updateResults ? e.updateResults.map(this._createFeatureEditResult, this) : [],\n      deleteFeatureResults: e.deleteResults ? e.deleteResults.map(this._createFeatureEditResult, this) : [],\n      addAttachmentResults: [],\n      updateAttachmentResults: [],\n      deleteAttachmentResults: []\n    };\n  }\n\n  _createFeatureEditResult(e) {\n    const r = !0 === e.success ? null : e.error || {\n      code: void 0,\n      description: void 0\n    };\n    return {\n      objectId: e.objectId,\n      globalId: e.globalId,\n      error: r ? new t(\"geojson-layer-source:edit-failure\", r.description, {\n        code: r.code\n      }) : null\n    };\n  }\n\n  _serializeFeature(e) {\n    const {\n      attributes: t\n    } = e,\n          r = this._geometryForSerialization(e);\n\n    return r ? {\n      geometry: r.toJSON(),\n      attributes: t\n    } : {\n      attributes: t\n    };\n  }\n\n  _geometryForSerialization(e) {\n    const {\n      geometry: t\n    } = e;\n    return n(t) ? null : \"mesh\" === t.type || \"extent\" === t.type ? m.fromExtent(t.extent) : t;\n  }\n\n  async _startWorker(e) {\n    this._connection = await u(\"GeoJSONSourceWorker\", {\n      strategy: r(\"feature-layers-workers\") ? \"dedicated\" : \"local\",\n      signal: e\n    });\n    const {\n      fields: t,\n      spatialReference: o,\n      hasZ: s,\n      geometryType: i,\n      objectIdField: n,\n      url: a,\n      timeInfo: l,\n      customParameters: c\n    } = this.layer,\n          p = \"defaults\" === this.layer.originOf(\"spatialReference\"),\n          h = {\n      url: a,\n      customParameters: c,\n      fields: t && t.map(e => e.toJSON()),\n      geometryType: y.toJSON(i),\n      hasZ: s,\n      objectIdField: n,\n      timeInfo: l ? l.toJSON() : null,\n      spatialReference: p ? null : o && o.toJSON()\n    },\n          m = await this._connection.invoke(\"load\", h, {\n      signal: e\n    });\n\n    for (const r of m.warnings) f.warn(r.message, {\n      layer: this.layer,\n      warning: r\n    });\n\n    m.featureErrors.length && f.warn(`Encountered ${m.featureErrors.length} validation errors while loading features`, m.featureErrors), this.sourceJSON = m.layerDefinition, this.capabilities = d(this.sourceJSON.hasZ, !0);\n  }\n\n};\ne([l()], g.prototype, \"capabilities\", void 0), e([l()], g.prototype, \"type\", void 0), e([l({\n  constructOnly: !0\n})], g.prototype, \"layer\", void 0), e([l()], g.prototype, \"sourceJSON\", void 0), g = e([c(\"esri.layers.graphics.sources.GeoJSONSource\")], g);\nconst S = g;\nexport { g as GeoJSONSource, S as default };","map":{"version":3,"sources":["D:/Github/CUSP_DataBase/CUSP_DB/src/main/gis/node_modules/@arcgis/core/layers/graphics/sources/GeoJSONSource.js"],"names":["_","e","t","r","o","s","isSome","i","isNone","n","debounce","a","open","u","property","l","subclass","c","createCapabilities","d","p","h","m","featureGeometryTypeKebabDictionary","y","f","getLogger","g","constructor","arguments","type","refresh","load","extent","timeExtent","_connection","invoke","sourceJSON","timeInfo","start","end","dataChanged","updates","signal","addResolvingPromise","_startWorker","Promise","resolve","destroy","close","applyEdits","then","_applyEdits","openPorts","queryFeatures","toJSON","fromJSON","queryFeaturesJSON","queryFeatureCount","queryObjectIds","queryExtent","count","querySnapping","layer","objectIdField","addFeatures","push","_serializeFeature","deleteFeatures","objectId","attributes","updateFeatures","adds","deletes","featureEditResults","_createEditsResult","addFeatureResults","addResults","map","_createFeatureEditResult","updateFeatureResults","updateResults","deleteFeatureResults","deleteResults","addAttachmentResults","updateAttachmentResults","deleteAttachmentResults","success","error","code","description","globalId","_geometryForSerialization","geometry","fromExtent","strategy","fields","spatialReference","hasZ","geometryType","url","customParameters","originOf","warnings","warn","message","warning","featureErrors","length","layerDefinition","capabilities","prototype","constructOnly","S","GeoJSONSource","default"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import\"../../../geometry.js\";import t from\"../../../core/Error.js\";import r from\"../../../core/has.js\";import o from\"../../../core/Loadable.js\";import s from\"../../../core/Logger.js\";import{isSome as i,isNone as n}from\"../../../core/maybe.js\";import{debounce as a}from\"../../../core/promiseUtils.js\";import{open as u}from\"../../../core/workers/workers.js\";import{property as l}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/arrayUtils.js\";import\"../../../core/accessorSupport/ensureType.js\";import{subclass as c}from\"../../../core/accessorSupport/decorators/subclass.js\";import{createCapabilities as d}from\"./support/clientSideDefaults.js\";import p from\"../../../rest/support/FeatureSet.js\";import h from\"../../../geometry/Extent.js\";import m from\"../../../geometry/Polygon.js\";import{featureGeometryTypeKebabDictionary as y}from\"../../../geometry/support/typeUtils.js\";const f=s.getLogger(\"esri.layers.graphics.sources.GeoJSONSource\");let g=class extends o{constructor(){super(...arguments),this.type=\"geojson\",this.refresh=a((async e=>{await this.load();const{extent:t,timeExtent:r}=await this._connection.invoke(\"refresh\",e);return this.sourceJSON.extent=t,r&&(this.sourceJSON.timeInfo.timeExtent=[r.start,r.end]),{dataChanged:!0,updates:{extent:this.sourceJSON.extent,timeInfo:this.sourceJSON.timeInfo}}}))}load(e){const t=i(e)?e.signal:null;return this.addResolvingPromise(this._startWorker(t)),Promise.resolve(this)}destroy(){var e;null==(e=this._connection)||e.close(),this._connection=null}applyEdits(e){return this.load().then((()=>this._applyEdits(e)))}openPorts(){return this.load().then((()=>this._connection.openPorts()))}queryFeatures(e,t={}){return this.load(t).then((()=>this._connection.invoke(\"queryFeatures\",e?e.toJSON():null,t))).then((e=>p.fromJSON(e)))}queryFeaturesJSON(e,t={}){return this.load(t).then((()=>this._connection.invoke(\"queryFeatures\",e?e.toJSON():null,t)))}queryFeatureCount(e,t={}){return this.load(t).then((()=>this._connection.invoke(\"queryFeatureCount\",e?e.toJSON():null,t)))}queryObjectIds(e,t={}){return this.load(t).then((()=>this._connection.invoke(\"queryObjectIds\",e?e.toJSON():null,t)))}queryExtent(e,t={}){return this.load(t).then((()=>this._connection.invoke(\"queryExtent\",e?e.toJSON():null,t))).then((e=>({count:e.count,extent:h.fromJSON(e.extent)})))}querySnapping(e,t={}){return this.load(t).then((()=>this._connection.invoke(\"querySnapping\",e,t)))}_applyEdits(e){if(!this._connection)throw new t(\"geojson-layer-source:edit-failure\",\"Memory source not loaded\");const r=this.layer.objectIdField,o=[],s=[],i=[];if(e.addFeatures)for(const t of e.addFeatures)o.push(this._serializeFeature(t));if(e.deleteFeatures)for(const t of e.deleteFeatures)\"objectId\"in t&&null!=t.objectId?s.push(t.objectId):\"attributes\"in t&&null!=t.attributes[r]&&s.push(t.attributes[r]);if(e.updateFeatures)for(const t of e.updateFeatures)i.push(this._serializeFeature(t));return this._connection.invoke(\"applyEdits\",{adds:o,updates:i,deletes:s}).then((({extent:e,timeExtent:t,featureEditResults:r})=>(this.sourceJSON.extent=e,t&&(this.sourceJSON.timeInfo.timeExtent=[t.start,t.end]),this._createEditsResult(r))))}_createEditsResult(e){return{addFeatureResults:e.addResults?e.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:e.updateResults?e.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:e.deleteResults?e.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:[],updateAttachmentResults:[],deleteAttachmentResults:[]}}_createFeatureEditResult(e){const r=!0===e.success?null:e.error||{code:void 0,description:void 0};return{objectId:e.objectId,globalId:e.globalId,error:r?new t(\"geojson-layer-source:edit-failure\",r.description,{code:r.code}):null}}_serializeFeature(e){const{attributes:t}=e,r=this._geometryForSerialization(e);return r?{geometry:r.toJSON(),attributes:t}:{attributes:t}}_geometryForSerialization(e){const{geometry:t}=e;return n(t)?null:\"mesh\"===t.type||\"extent\"===t.type?m.fromExtent(t.extent):t}async _startWorker(e){this._connection=await u(\"GeoJSONSourceWorker\",{strategy:r(\"feature-layers-workers\")?\"dedicated\":\"local\",signal:e});const{fields:t,spatialReference:o,hasZ:s,geometryType:i,objectIdField:n,url:a,timeInfo:l,customParameters:c}=this.layer,p=\"defaults\"===this.layer.originOf(\"spatialReference\"),h={url:a,customParameters:c,fields:t&&t.map((e=>e.toJSON())),geometryType:y.toJSON(i),hasZ:s,objectIdField:n,timeInfo:l?l.toJSON():null,spatialReference:p?null:o&&o.toJSON()},m=await this._connection.invoke(\"load\",h,{signal:e});for(const r of m.warnings)f.warn(r.message,{layer:this.layer,warning:r});m.featureErrors.length&&f.warn(`Encountered ${m.featureErrors.length} validation errors while loading features`,m.featureErrors),this.sourceJSON=m.layerDefinition,this.capabilities=d(this.sourceJSON.hasZ,!0)}};e([l()],g.prototype,\"capabilities\",void 0),e([l()],g.prototype,\"type\",void 0),e([l({constructOnly:!0})],g.prototype,\"layer\",void 0),e([l()],g.prototype,\"sourceJSON\",void 0),g=e([c(\"esri.layers.graphics.sources.GeoJSONSource\")],g);const S=g;export{g as GeoJSONSource,S as default};\n"]},"metadata":{},"sourceType":"module"}