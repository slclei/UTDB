{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../../chunks/tslib.es6.js\";\nimport i from \"../../../Graphic.js\";\nimport s from \"../../../core/Collection.js\";\nimport { isSome as t, isNone as r } from \"../../../core/maybe.js\";\nimport { init as h, on as a } from \"../../../core/watchUtils.js\";\nimport \"../../../core/Logger.js\";\nimport \"../../../core/accessorSupport/ensureType.js\";\nimport \"../../../core/arrayUtils.js\";\nimport \"../../../core/has.js\";\nimport \"../../../core/accessorSupport/set.js\";\nimport { subclass as o } from \"../../../core/accessorSupport/decorators/subclass.js\";\nimport { LayerView2DMixin as c } from \"./LayerView2D.js\";\nimport p from \"./graphics/GraphicContainer.js\";\nimport n from \"./graphics/GraphicsView2D.js\";\nimport l from \"../../layers/LayerView.js\";\nconst g = \"sublayers\",\n      d = \"layerView\",\n      u = Object.freeze({\n  remove() {},\n\n  pause() {},\n\n  resume() {}\n\n});\nlet f = class extends c(l) {\n  constructor() {\n    super(...arguments), this._highlightIds = new Map();\n  }\n\n  async fetchPopupFeatures(e) {\n    return Array.from(this.graphicsViews(), i => i.hitTest(e).filter(e => !!e.popupTemplate)).flat();\n  }\n\n  *graphicsViews() {\n    t(this._graphicsViewsFeatureCollectionMap) ? yield* this._graphicsViewsFeatureCollectionMap.keys() : t(this._graphicsViews) ? yield* this._graphicsViews : yield* [];\n  }\n\n  async hitTest(e, i) {\n    const s = Array.from(this.graphicsViews(), async i => {\n      const s = await i.hitTest(e);\n\n      if (t(this._graphicsViewsFeatureCollectionMap)) {\n        const e = this._graphicsViewsFeatureCollectionMap.get(i);\n\n        for (const i of s) !i.popupTemplate && e.popupTemplate && (i.popupTemplate = e.popupTemplate);\n      }\n\n      return s;\n    });\n    return (await Promise.all(s)).flat();\n  }\n\n  highlight(e) {\n    let t;\n    return \"number\" == typeof e ? t = [e] : e instanceof i ? t = [e.uid] : Array.isArray(e) && e.length > 0 ? t = \"number\" == typeof e[0] ? e : e.map(e => e && e.uid) : s.isCollection(e) && (t = e.map(e => e && e.uid).toArray()), t = t.filter(e => null != e), t.length ? (this._addHighlight(t), {\n      remove: () => {\n        this._removeHighlight(t);\n      }\n    }) : u;\n  }\n\n  update(e) {\n    for (const i of this.graphicsViews()) i.processUpdate(e);\n  }\n\n  attach() {\n    const e = this.view,\n          i = () => this.requestUpdate(),\n          s = this.layer.featureCollections;\n\n    if (t(s) && s.length) {\n      this._graphicsViewsFeatureCollectionMap = new Map();\n\n      for (const t of s) {\n        const s = new p(this.view.featuresTilingScheme);\n        s.fadeTransitionEnabled = !0;\n        const r = new n({\n          view: e,\n          graphics: t.source,\n          renderer: t.renderer,\n          requestUpdateCallback: i,\n          container: s\n        });\n        this._graphicsViewsFeatureCollectionMap.set(r, t), this.container.addChild(r.container), this.handles.add([h(t, \"visible\", e => r.container.visible = e), h(r, \"updating\", () => this.notifyChange(\"updating\"))], d);\n      }\n\n      this._updateHighlight();\n    } else t(this.layer.sublayers) && this.handles.add(a(this.layer, \"sublayers\", \"change\", () => this._createGraphicsViews(), () => this._createGraphicsViews(), () => this._destroyGraphicsViews()), g);\n  }\n\n  detach() {\n    this._destroyGraphicsViews(), this.handles.remove(g);\n  }\n\n  moveStart() {}\n\n  moveEnd() {}\n\n  viewChange() {\n    for (const e of this.graphicsViews()) e.viewChange();\n  }\n\n  isUpdating() {\n    for (const e of this.graphicsViews()) if (e.updating) return !0;\n\n    return !1;\n  }\n\n  _destroyGraphicsViews() {\n    this.container.removeAllChildren(), this.handles.remove(d);\n\n    for (const e of this.graphicsViews()) e.destroy();\n\n    this._graphicsViews = null, this._graphicsViewsFeatureCollectionMap = null;\n  }\n\n  _createGraphicsViews() {\n    if (this._destroyGraphicsViews(), r(this.layer.sublayers)) return;\n\n    const e = [],\n          i = this.view,\n          s = () => this.requestUpdate();\n\n    for (const t of this.layer.sublayers) {\n      const r = new p(this.view.featuresTilingScheme);\n      r.fadeTransitionEnabled = !0;\n      const a = new n({\n        view: i,\n        graphics: t.graphics,\n        requestUpdateCallback: s,\n        container: r\n      });\n      this.handles.add([t.on(\"graphic-update\", a.graphicUpdateHandler), h(t, \"visible\", e => a.container.visible = e), h(a, \"updating\", () => this.notifyChange(\"updating\"))], d), this.container.addChild(a.container), e.push(a);\n    }\n\n    this._graphicsViews = e, this._updateHighlight();\n  }\n\n  _addHighlight(e) {\n    for (const i of e) if (this._highlightIds.has(i)) {\n      const e = this._highlightIds.get(i);\n\n      this._highlightIds.set(i, e + 1);\n    } else this._highlightIds.set(i, 1);\n\n    this._updateHighlight();\n  }\n\n  _removeHighlight(e) {\n    for (const i of e) if (this._highlightIds.has(i)) {\n      const e = this._highlightIds.get(i) - 1;\n      0 === e ? this._highlightIds.delete(i) : this._highlightIds.set(i, e);\n    }\n\n    this._updateHighlight();\n  }\n\n  _updateHighlight() {\n    const e = Array.from(this._highlightIds.keys());\n\n    for (const i of this.graphicsViews()) i.setHighlight(e);\n  }\n\n};\nf = e([o(\"esri.views.2d.layers.MapNotesLayerView2D\")], f);\nconst m = f;\nexport { m as default };","map":{"version":3,"sources":["D:/Github/CUSP_DataBase/CUSP_DB/src/main/gis/node_modules/@arcgis/core/views/2d/layers/MapNotesLayerView2D.js"],"names":["_","e","i","s","isSome","t","isNone","r","init","h","on","a","subclass","o","LayerView2DMixin","c","p","n","l","g","d","u","Object","freeze","remove","pause","resume","f","constructor","arguments","_highlightIds","Map","fetchPopupFeatures","Array","from","graphicsViews","hitTest","filter","popupTemplate","flat","_graphicsViewsFeatureCollectionMap","keys","_graphicsViews","get","Promise","all","highlight","uid","isArray","length","map","isCollection","toArray","_addHighlight","_removeHighlight","update","processUpdate","attach","view","requestUpdate","layer","featureCollections","featuresTilingScheme","fadeTransitionEnabled","graphics","source","renderer","requestUpdateCallback","container","set","addChild","handles","add","visible","notifyChange","_updateHighlight","sublayers","_createGraphicsViews","_destroyGraphicsViews","detach","moveStart","moveEnd","viewChange","isUpdating","updating","removeAllChildren","destroy","graphicUpdateHandler","push","has","delete","setHighlight","m","default"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import i from\"../../../Graphic.js\";import s from\"../../../core/Collection.js\";import{isSome as t,isNone as r}from\"../../../core/maybe.js\";import{init as h,on as a}from\"../../../core/watchUtils.js\";import\"../../../core/Logger.js\";import\"../../../core/accessorSupport/ensureType.js\";import\"../../../core/arrayUtils.js\";import\"../../../core/has.js\";import\"../../../core/accessorSupport/set.js\";import{subclass as o}from\"../../../core/accessorSupport/decorators/subclass.js\";import{LayerView2DMixin as c}from\"./LayerView2D.js\";import p from\"./graphics/GraphicContainer.js\";import n from\"./graphics/GraphicsView2D.js\";import l from\"../../layers/LayerView.js\";const g=\"sublayers\",d=\"layerView\",u=Object.freeze({remove(){},pause(){},resume(){}});let f=class extends(c(l)){constructor(){super(...arguments),this._highlightIds=new Map}async fetchPopupFeatures(e){return Array.from(this.graphicsViews(),(i=>i.hitTest(e).filter((e=>!!e.popupTemplate)))).flat()}*graphicsViews(){t(this._graphicsViewsFeatureCollectionMap)?yield*this._graphicsViewsFeatureCollectionMap.keys():t(this._graphicsViews)?yield*this._graphicsViews:yield*[]}async hitTest(e,i){const s=Array.from(this.graphicsViews(),(async i=>{const s=await i.hitTest(e);if(t(this._graphicsViewsFeatureCollectionMap)){const e=this._graphicsViewsFeatureCollectionMap.get(i);for(const i of s)!i.popupTemplate&&e.popupTemplate&&(i.popupTemplate=e.popupTemplate)}return s}));return(await Promise.all(s)).flat()}highlight(e){let t;return\"number\"==typeof e?t=[e]:e instanceof i?t=[e.uid]:Array.isArray(e)&&e.length>0?t=\"number\"==typeof e[0]?e:e.map((e=>e&&e.uid)):s.isCollection(e)&&(t=e.map((e=>e&&e.uid)).toArray()),t=t.filter((e=>null!=e)),t.length?(this._addHighlight(t),{remove:()=>{this._removeHighlight(t)}}):u}update(e){for(const i of this.graphicsViews())i.processUpdate(e)}attach(){const e=this.view,i=()=>this.requestUpdate(),s=this.layer.featureCollections;if(t(s)&&s.length){this._graphicsViewsFeatureCollectionMap=new Map;for(const t of s){const s=new p(this.view.featuresTilingScheme);s.fadeTransitionEnabled=!0;const r=new n({view:e,graphics:t.source,renderer:t.renderer,requestUpdateCallback:i,container:s});this._graphicsViewsFeatureCollectionMap.set(r,t),this.container.addChild(r.container),this.handles.add([h(t,\"visible\",(e=>r.container.visible=e)),h(r,\"updating\",(()=>this.notifyChange(\"updating\")))],d)}this._updateHighlight()}else t(this.layer.sublayers)&&this.handles.add(a(this.layer,\"sublayers\",\"change\",(()=>this._createGraphicsViews()),(()=>this._createGraphicsViews()),(()=>this._destroyGraphicsViews())),g)}detach(){this._destroyGraphicsViews(),this.handles.remove(g)}moveStart(){}moveEnd(){}viewChange(){for(const e of this.graphicsViews())e.viewChange()}isUpdating(){for(const e of this.graphicsViews())if(e.updating)return!0;return!1}_destroyGraphicsViews(){this.container.removeAllChildren(),this.handles.remove(d);for(const e of this.graphicsViews())e.destroy();this._graphicsViews=null,this._graphicsViewsFeatureCollectionMap=null}_createGraphicsViews(){if(this._destroyGraphicsViews(),r(this.layer.sublayers))return;const e=[],i=this.view,s=()=>this.requestUpdate();for(const t of this.layer.sublayers){const r=new p(this.view.featuresTilingScheme);r.fadeTransitionEnabled=!0;const a=new n({view:i,graphics:t.graphics,requestUpdateCallback:s,container:r});this.handles.add([t.on(\"graphic-update\",a.graphicUpdateHandler),h(t,\"visible\",(e=>a.container.visible=e)),h(a,\"updating\",(()=>this.notifyChange(\"updating\")))],d),this.container.addChild(a.container),e.push(a)}this._graphicsViews=e,this._updateHighlight()}_addHighlight(e){for(const i of e)if(this._highlightIds.has(i)){const e=this._highlightIds.get(i);this._highlightIds.set(i,e+1)}else this._highlightIds.set(i,1);this._updateHighlight()}_removeHighlight(e){for(const i of e)if(this._highlightIds.has(i)){const e=this._highlightIds.get(i)-1;0===e?this._highlightIds.delete(i):this._highlightIds.set(i,e)}this._updateHighlight()}_updateHighlight(){const e=Array.from(this._highlightIds.keys());for(const i of this.graphicsViews())i.setHighlight(e)}};f=e([o(\"esri.views.2d.layers.MapNotesLayerView2D\")],f);const m=f;export{m as default};\n"]},"metadata":{},"sourceType":"module"}