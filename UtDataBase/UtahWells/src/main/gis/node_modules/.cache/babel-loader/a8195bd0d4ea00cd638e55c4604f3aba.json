{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport { SymbolHelper as t } from \"../../../../symbols/cim/CIMSymbolHelper.js\";\nimport i from \"./RectangleBinPack.js\";\nimport e from \"../webgl/Rect.js\";\nimport { PixelFormat as s, PixelType as h, TextureWrapMode as a } from \"../../../webgl/enums.js\";\nimport { Texture as r } from \"../../../webgl/Texture.js\";\nconst o = \"dasharray-\";\n\nclass _ {\n  constructor(t, e) {\n    let s = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n    this._size = [], this._mosaicsData = [], this._textures = [], this._dirties = [], this._maxItemSize = 0, this._currentPage = 0, this._pageWidth = 0, this._pageHeight = 0, this._mosaicRects = {}, this.pixelRatio = 1, (t <= 0 || e <= 0) && console.error(\"Sprites mosaic defaultWidth and defaultHeight must be greater than zero!\"), this._pageWidth = t, this._pageHeight = e, s > 0 && (this._maxItemSize = s), this._binPack = new i(t - 4, e - 4);\n  }\n\n  dispose() {\n    this._binPack = null, this._mosaicRects = {};\n\n    for (const t of this._textures) t && t.dispose();\n\n    this._textures.length = 0;\n  }\n\n  getWidth(t) {\n    return t >= this._size.length ? -1 : this._size[t][0];\n  }\n\n  getHeight(t) {\n    return t >= this._size.length ? -1 : this._size[t][1];\n  }\n\n  getPageSize(t) {\n    return t >= this._size.length ? null : this._size[t];\n  }\n\n  setSpriteSource(t) {\n    if (this.dispose(), this.pixelRatio = t.devicePixelRatio, 0 === this._mosaicsData.length) {\n      this._binPack = new i(this._pageWidth - 4, this._pageHeight - 4);\n      const t = Math.floor(this._pageWidth),\n            e = Math.floor(this._pageHeight),\n            s = new Uint32Array(t * e);\n      this._mosaicsData[0] = s, this._dirties.push(!0), this._size.push([this._pageWidth, this._pageHeight]), this._textures.push(void 0);\n    }\n\n    this._sprites = t;\n  }\n\n  getSpriteItem(t) {\n    let i = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : !1;\n    let e,\n        s,\n        h = this._mosaicRects[t];\n    if (h) return h;\n    if (!this._sprites || \"loaded\" !== this._sprites.loadStatus) return null;\n    if (t && t.startsWith(o) ? ([e, s] = this._rasterizeDash(t), i = !0) : e = this._sprites.getSpriteInfo(t), !e || !e.width || !e.height || e.width < 0 || e.height < 0) return null;\n\n    const a = e.width,\n          r = e.height,\n          [_, n, g] = this._allocateImage(a, r);\n\n    return _.width <= 0 ? null : (this._copy(_, e, n, g, i, s), h = {\n      rect: _,\n      width: a,\n      height: r,\n      sdf: e.sdf,\n      simplePattern: !1,\n      pixelRatio: e.pixelRatio,\n      page: n\n    }, this._mosaicRects[t] = h, h);\n  }\n\n  getSpriteItems(t) {\n    const i = {};\n\n    for (const e of t) i[e.name] = this.getSpriteItem(e.name, e.repeat);\n\n    return i;\n  }\n\n  getMosaicItemPosition(t, i) {\n    const e = this.getSpriteItem(t, i),\n          s = e && e.rect;\n    if (!s) return null;\n    s.width = e.width, s.height = e.height;\n    const h = e.width,\n          a = e.height,\n          r = 2;\n    return {\n      tl: [s.x + r, s.y + r],\n      br: [s.x + r + h, s.y + r + a],\n      page: e.page\n    };\n  }\n\n  bind(t, i) {\n    let e = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n    let o = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0;\n    this._textures[e] || (this._textures[e] = new r(t, {\n      pixelFormat: s.RGBA,\n      dataType: h.UNSIGNED_BYTE,\n      wrapMode: a.CLAMP_TO_EDGE,\n      width: this._size[e][0],\n      height: this._size[e][1]\n    }, new Uint8Array(this._mosaicsData[e].buffer)));\n    const _ = this._textures[e];\n    _.setSamplingMode(i), this._dirties[e] && _.setData(new Uint8Array(this._mosaicsData[e].buffer)), t.bindTexture(_, o), this._dirties[e] = !1;\n  }\n\n  static _copyBits(t, i, e, s, h, a, r, o, _, n, g) {\n    let p = s * i + e,\n        c = o * a + r;\n\n    if (g) {\n      c -= a;\n\n      for (let r = -1; r <= n; r++, p = ((r + n) % n + s) * i + e, c += a) for (let i = -1; i <= _; i++) h[c + i] = t[p + (i + _) % _];\n    } else for (let l = 0; l < n; l++) {\n      for (let i = 0; i < _; i++) h[c + i] = t[p + i];\n\n      p += i, c += a;\n    }\n  }\n\n  _copy(t, i, e, s, h, a) {\n    if (!this._sprites || \"loaded\" !== this._sprites.loadStatus || e >= this._mosaicsData.length) return;\n    const r = new Uint32Array(a ? a.buffer : this._sprites.image.buffer),\n          o = this._mosaicsData[e];\n    o && r || console.error(\"Source or target images are uninitialized!\");\n    const n = 2,\n          g = a ? i.width : this._sprites.width;\n    _._copyBits(r, g, i.x, i.y, o, s[0], t.x + n, t.y + n, i.width, i.height, h), this._dirties[e] = !0;\n  }\n\n  _allocateImage(t, s) {\n    t += 2, s += 2;\n    const h = Math.max(t, s);\n\n    if (this._maxItemSize && this._maxItemSize < h) {\n      const i = new e(0, 0, t, s);\n      return this._mosaicsData.push(new Uint32Array(t * s)), this._dirties.push(!0), this._size.push([t, s]), this._textures.push(void 0), [i, this._mosaicsData.length - 1, [t, s]];\n    }\n\n    let a = t % 4 ? 4 - t % 4 : 4,\n        r = s % 4 ? 4 - s % 4 : 4;\n    1 === a && (a = 5), 1 === r && (r = 5);\n\n    const o = this._binPack.allocate(t + a, s + r);\n\n    return o.width <= 0 ? (this._dirties[this._currentPage] || (this._mosaicsData[this._currentPage] = null), this._currentPage = this._mosaicsData.length, this._mosaicsData.push(new Uint32Array(this._pageWidth * this._pageHeight)), this._dirties.push(!0), this._size.push([this._pageWidth, this._pageHeight]), this._textures.push(void 0), this._binPack = new i(this._pageWidth - 4, this._pageHeight - 4), this._allocateImage(t, s)) : [o, this._currentPage, [this._pageWidth, this._pageHeight]];\n  }\n\n  _rasterizeDash(i) {\n    const e = /\\[(.*?)\\]/,\n          s = i.match(e);\n    if (!s) return null;\n    const h = s[1].split(\",\").map(Number),\n          a = i.slice(i.lastIndexOf(\"-\") + 1),\n          [r, o, _] = t.rasterizeDash(h, a);\n    return [{\n      x: 0,\n      y: 0,\n      width: o,\n      height: _,\n      sdf: !0,\n      pixelRatio: 1\n    }, new Uint8Array(r.buffer)];\n  }\n\n}\n\nexport { _ as default };","map":{"version":3,"sources":["D:/Github/CUSP_DataBase/CUSP_DB/src/main/gis/node_modules/@arcgis/core/views/2d/engine/vectorTiles/SpriteMosaic.js"],"names":["SymbolHelper","t","i","e","PixelFormat","s","PixelType","h","TextureWrapMode","a","Texture","r","o","_","constructor","_size","_mosaicsData","_textures","_dirties","_maxItemSize","_currentPage","_pageWidth","_pageHeight","_mosaicRects","pixelRatio","console","error","_binPack","dispose","length","getWidth","getHeight","getPageSize","setSpriteSource","devicePixelRatio","Math","floor","Uint32Array","push","_sprites","getSpriteItem","loadStatus","startsWith","_rasterizeDash","getSpriteInfo","width","height","n","g","_allocateImage","_copy","rect","sdf","simplePattern","page","getSpriteItems","name","repeat","getMosaicItemPosition","tl","x","y","br","bind","pixelFormat","RGBA","dataType","UNSIGNED_BYTE","wrapMode","CLAMP_TO_EDGE","Uint8Array","buffer","setSamplingMode","setData","bindTexture","_copyBits","p","c","l","image","max","allocate","match","split","map","Number","slice","lastIndexOf","rasterizeDash","default"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport{SymbolHelper as t}from\"../../../../symbols/cim/CIMSymbolHelper.js\";import i from\"./RectangleBinPack.js\";import e from\"../webgl/Rect.js\";import{PixelFormat as s,PixelType as h,TextureWrapMode as a}from\"../../../webgl/enums.js\";import{Texture as r}from\"../../../webgl/Texture.js\";const o=\"dasharray-\";class _{constructor(t,e,s=0){this._size=[],this._mosaicsData=[],this._textures=[],this._dirties=[],this._maxItemSize=0,this._currentPage=0,this._pageWidth=0,this._pageHeight=0,this._mosaicRects={},this.pixelRatio=1,(t<=0||e<=0)&&console.error(\"Sprites mosaic defaultWidth and defaultHeight must be greater than zero!\"),this._pageWidth=t,this._pageHeight=e,s>0&&(this._maxItemSize=s),this._binPack=new i(t-4,e-4)}dispose(){this._binPack=null,this._mosaicRects={};for(const t of this._textures)t&&t.dispose();this._textures.length=0}getWidth(t){return t>=this._size.length?-1:this._size[t][0]}getHeight(t){return t>=this._size.length?-1:this._size[t][1]}getPageSize(t){return t>=this._size.length?null:this._size[t]}setSpriteSource(t){if(this.dispose(),this.pixelRatio=t.devicePixelRatio,0===this._mosaicsData.length){this._binPack=new i(this._pageWidth-4,this._pageHeight-4);const t=Math.floor(this._pageWidth),e=Math.floor(this._pageHeight),s=new Uint32Array(t*e);this._mosaicsData[0]=s,this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0)}this._sprites=t}getSpriteItem(t,i=!1){let e,s,h=this._mosaicRects[t];if(h)return h;if(!this._sprites||\"loaded\"!==this._sprites.loadStatus)return null;if(t&&t.startsWith(o)?([e,s]=this._rasterizeDash(t),i=!0):e=this._sprites.getSpriteInfo(t),!e||!e.width||!e.height||e.width<0||e.height<0)return null;const a=e.width,r=e.height,[_,n,g]=this._allocateImage(a,r);return _.width<=0?null:(this._copy(_,e,n,g,i,s),h={rect:_,width:a,height:r,sdf:e.sdf,simplePattern:!1,pixelRatio:e.pixelRatio,page:n},this._mosaicRects[t]=h,h)}getSpriteItems(t){const i={};for(const e of t)i[e.name]=this.getSpriteItem(e.name,e.repeat);return i}getMosaicItemPosition(t,i){const e=this.getSpriteItem(t,i),s=e&&e.rect;if(!s)return null;s.width=e.width,s.height=e.height;const h=e.width,a=e.height,r=2;return{tl:[s.x+r,s.y+r],br:[s.x+r+h,s.y+r+a],page:e.page}}bind(t,i,e=0,o=0){this._textures[e]||(this._textures[e]=new r(t,{pixelFormat:s.RGBA,dataType:h.UNSIGNED_BYTE,wrapMode:a.CLAMP_TO_EDGE,width:this._size[e][0],height:this._size[e][1]},new Uint8Array(this._mosaicsData[e].buffer)));const _=this._textures[e];_.setSamplingMode(i),this._dirties[e]&&_.setData(new Uint8Array(this._mosaicsData[e].buffer)),t.bindTexture(_,o),this._dirties[e]=!1}static _copyBits(t,i,e,s,h,a,r,o,_,n,g){let p=s*i+e,c=o*a+r;if(g){c-=a;for(let r=-1;r<=n;r++,p=((r+n)%n+s)*i+e,c+=a)for(let i=-1;i<=_;i++)h[c+i]=t[p+(i+_)%_]}else for(let l=0;l<n;l++){for(let i=0;i<_;i++)h[c+i]=t[p+i];p+=i,c+=a}}_copy(t,i,e,s,h,a){if(!this._sprites||\"loaded\"!==this._sprites.loadStatus||e>=this._mosaicsData.length)return;const r=new Uint32Array(a?a.buffer:this._sprites.image.buffer),o=this._mosaicsData[e];o&&r||console.error(\"Source or target images are uninitialized!\");const n=2,g=a?i.width:this._sprites.width;_._copyBits(r,g,i.x,i.y,o,s[0],t.x+n,t.y+n,i.width,i.height,h),this._dirties[e]=!0}_allocateImage(t,s){t+=2,s+=2;const h=Math.max(t,s);if(this._maxItemSize&&this._maxItemSize<h){const i=new e(0,0,t,s);return this._mosaicsData.push(new Uint32Array(t*s)),this._dirties.push(!0),this._size.push([t,s]),this._textures.push(void 0),[i,this._mosaicsData.length-1,[t,s]]}let a=t%4?4-t%4:4,r=s%4?4-s%4:4;1===a&&(a=5),1===r&&(r=5);const o=this._binPack.allocate(t+a,s+r);return o.width<=0?(this._dirties[this._currentPage]||(this._mosaicsData[this._currentPage]=null),this._currentPage=this._mosaicsData.length,this._mosaicsData.push(new Uint32Array(this._pageWidth*this._pageHeight)),this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0),this._binPack=new i(this._pageWidth-4,this._pageHeight-4),this._allocateImage(t,s)):[o,this._currentPage,[this._pageWidth,this._pageHeight]]}_rasterizeDash(i){const e=/\\[(.*?)\\]/,s=i.match(e);if(!s)return null;const h=s[1].split(\",\").map(Number),a=i.slice(i.lastIndexOf(\"-\")+1),[r,o,_]=t.rasterizeDash(h,a);return[{x:0,y:0,width:o,height:_,sdf:!0,pixelRatio:1},new Uint8Array(r.buffer)]}}export{_ as default};\n"]},"metadata":{},"sourceType":"module"}