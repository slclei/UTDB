{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport { isSome as t } from \"../../../../../core/maybe.js\";\nimport { HITTEST_RADIUS as e } from \"../definitions.js\";\nimport { Effect as s } from \"./Effect.js\";\nimport { PixelFormat as o, PixelType as r } from \"../../../../webgl/enums.js\";\n\nclass i extends s {\n  constructor() {\n    super(...arguments), this.name = this.constructor.name, this.defines = [\"id\"], this._lastSize = 0;\n  }\n\n  dispose() {\n    t(this._fbo) && this._fbo.dispose();\n  }\n\n  bind(_ref) {\n    let {\n      context: t,\n      painter: e\n    } = _ref;\n    const {\n      width: s,\n      height: o\n    } = t.getViewport();\n    this._boundFBO = t.getBoundFramebufferObject();\n    const r = e.getFbos(s, o).effect0;\n    t.bindFramebuffer(r), t.setColorMask(!0, !0, !0, !0), t.setClearColor(0, 0, 0, 0), t.clear(t.gl.COLOR_BUFFER_BIT);\n  }\n\n  unbind(_ref2) {\n    let {\n      context: t\n    } = _ref2;\n    t.bindFramebuffer(this._boundFBO), this._boundFBO = null;\n  }\n\n  draw(_ref3, n) {\n    let {\n      context: t,\n      state: s,\n      pixelRatio: i\n    } = _ref3;\n    let f = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 2 * e;\n    const a = t.getBoundFramebufferObject(),\n          h = s.size[1] * i,\n          u = Math.round(f * i),\n          b = u / 2,\n          c = u / 2;\n    this._ensureBuffer(u), n.forEach((t, e) => {\n      const s = new Map(),\n            f = Math.floor(e.x * i - u / 2),\n            l = Math.floor(h - e.y * i - u / 2);\n      a.readPixels(f, l, u, u, o.RGBA, r.UNSIGNED_BYTE, this._buf);\n\n      for (let o = 0; o < this._buf32.length; o++) {\n        const t = this._buf32[o];\n\n        if (4294967295 !== t && 0 !== t) {\n          const e = o % u,\n                r = u - Math.floor(o / u),\n                i = (b - e) * (b - e) + (c - r) * (c - r),\n                n = s.has(t) ? s.get(t) : 4294967295;\n          s.set(t, Math.min(i, n));\n        }\n      }\n\n      const d = Array.from(s).sort((t, e) => t[1] - e[1]).map(t => t[0]);\n      t.resolve(d), n.delete(e);\n    });\n  }\n\n  _ensureBuffer(t) {\n    this._lastSize !== t && (this._lastSize = t, this._buf = new Uint8Array(4 * t * t), this._buf32 = new Uint32Array(this._buf.buffer));\n  }\n\n}\n\nexport { i as HittestEffectVTL };","map":{"version":3,"sources":["D:/Github/CUSP_DataBase/CUSP_DB/src/main/gis/node_modules/@arcgis/core/views/2d/engine/webgl/effects/HittestEffectVTL.js"],"names":["isSome","t","HITTEST_RADIUS","e","Effect","s","PixelFormat","o","PixelType","r","i","constructor","arguments","name","defines","_lastSize","dispose","_fbo","bind","context","painter","width","height","getViewport","_boundFBO","getBoundFramebufferObject","getFbos","effect0","bindFramebuffer","setColorMask","setClearColor","clear","gl","COLOR_BUFFER_BIT","unbind","draw","n","state","pixelRatio","f","a","h","size","u","Math","round","b","c","_ensureBuffer","forEach","Map","floor","x","l","y","readPixels","RGBA","UNSIGNED_BYTE","_buf","_buf32","length","has","get","set","min","d","Array","from","sort","map","resolve","delete","Uint8Array","Uint32Array","buffer","HittestEffectVTL"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport{isSome as t}from\"../../../../../core/maybe.js\";import{HITTEST_RADIUS as e}from\"../definitions.js\";import{Effect as s}from\"./Effect.js\";import{PixelFormat as o,PixelType as r}from\"../../../../webgl/enums.js\";class i extends s{constructor(){super(...arguments),this.name=this.constructor.name,this.defines=[\"id\"],this._lastSize=0}dispose(){t(this._fbo)&&this._fbo.dispose()}bind({context:t,painter:e}){const{width:s,height:o}=t.getViewport();this._boundFBO=t.getBoundFramebufferObject();const r=e.getFbos(s,o).effect0;t.bindFramebuffer(r),t.setColorMask(!0,!0,!0,!0),t.setClearColor(0,0,0,0),t.clear(t.gl.COLOR_BUFFER_BIT)}unbind({context:t}){t.bindFramebuffer(this._boundFBO),this._boundFBO=null}draw({context:t,state:s,pixelRatio:i},n,f=2*e){const a=t.getBoundFramebufferObject(),h=s.size[1]*i,u=Math.round(f*i),b=u/2,c=u/2;this._ensureBuffer(u),n.forEach(((t,e)=>{const s=new Map,f=Math.floor(e.x*i-u/2),l=Math.floor(h-e.y*i-u/2);a.readPixels(f,l,u,u,o.RGBA,r.UNSIGNED_BYTE,this._buf);for(let o=0;o<this._buf32.length;o++){const t=this._buf32[o];if(4294967295!==t&&0!==t){const e=o%u,r=u-Math.floor(o/u),i=(b-e)*(b-e)+(c-r)*(c-r),n=s.has(t)?s.get(t):4294967295;s.set(t,Math.min(i,n))}}const d=Array.from(s).sort(((t,e)=>t[1]-e[1])).map((t=>t[0]));t.resolve(d),n.delete(e)}))}_ensureBuffer(t){this._lastSize!==t&&(this._lastSize=t,this._buf=new Uint8Array(4*t*t),this._buf32=new Uint32Array(this._buf.buffer))}}export{i as HittestEffectVTL};\n"]},"metadata":{},"sourceType":"module"}