{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport { neverReached as t } from \"../../../core/compilerUtils.js\";\nimport { isNone as e } from \"../../../core/maybe.js\";\nimport { generateUID as r } from \"../../../core/uid.js\";\nimport o from \"../../../geometry/SpatialReference.js\";\nimport { getGeometryZScaler as s } from \"../../../geometry/support/zscale.js\";\nimport { DehydratedFeatureSetClass as i, DehydratedFeatureClass as n } from \"../../../layers/graphics/dehydratedFeatures.js\";\nimport { unquantizeOptimizedGeometry as a, convertToGeometry as h } from \"../../../layers/graphics/featureConversionUtils.js\";\nimport l from \"../../../layers/support/Field.js\";\n\nfunction u(t, e) {\n  return e;\n}\n\nfunction p(t, e, r, o) {\n  switch (r) {\n    case 0:\n      return m(t, e + o, 0);\n\n    case 1:\n      return \"lowerLeft\" === t.originPosition ? m(t, e + o, 1) : y(t, e + o, 1);\n  }\n}\n\nfunction c(t, e, r, o) {\n  return 2 === r ? m(t, e, 2) : p(t, e, r, o);\n}\n\nfunction d(t, e, r, o) {\n  return 2 === r ? m(t, e, 3) : p(t, e, r, o);\n}\n\nfunction f(t, e, r, o) {\n  return 3 === r ? m(t, e, 3) : c(t, e, r, o);\n}\n\nfunction m(_ref, r, o) {\n  let {\n    translate: t,\n    scale: e\n  } = _ref;\n  return t[o] + r * e[o];\n}\n\nfunction y(_ref2, r, o) {\n  let {\n    translate: t,\n    scale: e\n  } = _ref2;\n  return t[o] - r * e[o];\n}\n\nclass g {\n  constructor(t) {\n    this.options = t, this.geometryTypes = [\"point\", \"multipoint\", \"polyline\", \"polygon\"], this.previousCoordinate = [0, 0], this.transform = null, this.applyTransform = u, this.lengths = [], this.currentLengthIndex = 0, this.toAddInCurrentPath = 0, this.vertexDimension = 0, this.coordinateBuffer = null, this.coordinateBufferPtr = 0, this._attributesConstructor = function () {};\n  }\n\n  createFeatureResult() {\n    return new i();\n  }\n\n  finishFeatureResult(t) {\n    if (this.options.applyTransform && (t.transform = null), this._attributesConstructor = function () {}, this.coordinateBuffer = null, this.lengths.length = 0, !t.hasZ) return;\n    const r = s(t.geometryType, this.options.sourceSpatialReference, t.spatialReference);\n    if (!e(r)) for (const e of t.features) r(e.geometry);\n  }\n\n  createSpatialReference() {\n    return new o();\n  }\n\n  addField(t, e) {\n    t.fields.push(l.fromJSON(e));\n    const r = t.fields.map(t => t.name);\n\n    this._attributesConstructor = function () {\n      for (const t of r) this[t] = null;\n    };\n  }\n\n  addFeature(t, e) {\n    const r = this.options.maxStringAttributeLength ? this.options.maxStringAttributeLength : 0;\n    if (r > 0) for (const o in e.attributes) {\n      const t = e.attributes[o];\n      \"string\" == typeof t && t.length > r && (e.attributes[o] = \"\");\n    }\n    t.features.push(e);\n  }\n\n  addQueryGeometry(t, e) {\n    const {\n      queryGeometry: r,\n      queryGeometryType: o\n    } = e,\n          s = a(r.clone(), r, !1, !1, this.transform),\n          i = h(s, o, !1, !1);\n    let n = null;\n\n    switch (o) {\n      case \"esriGeometryPoint\":\n        n = \"point\";\n        break;\n\n      case \"esriGeometryPolygon\":\n        n = \"polygon\";\n        break;\n\n      case \"esriGeometryPolyline\":\n        n = \"polyline\";\n        break;\n\n      case \"esriGeometryMultipoint\":\n        n = \"multipoint\";\n    }\n\n    i.type = n, t.queryGeometryType = o, t.queryGeometry = i;\n  }\n\n  prepareFeatures(e) {\n    switch (this.transform = e.transform, this.options.applyTransform && e.transform && (this.applyTransform = this._deriveApplyTransform(e)), this.vertexDimension = 2, e.hasZ && this.vertexDimension++, e.hasM && this.vertexDimension++, e.geometryType) {\n      case \"point\":\n        this.addCoordinate = (t, e, r) => this.addCoordinatePoint(t, e, r), this.createGeometry = t => this.createPointGeometry(t);\n        break;\n\n      case \"polygon\":\n        this.addCoordinate = (t, e, r) => this._addCoordinatePolygon(t, e, r), this.createGeometry = t => this._createPolygonGeometry(t);\n        break;\n\n      case \"polyline\":\n        this.addCoordinate = (t, e, r) => this._addCoordinatePolyline(t, e, r), this.createGeometry = t => this._createPolylineGeometry(t);\n        break;\n\n      case \"multipoint\":\n        this.addCoordinate = (t, e, r) => this._addCoordinateMultipoint(t, e, r), this.createGeometry = t => this._createMultipointGeometry(t);\n        break;\n\n      case \"mesh\":\n      case \"extent\":\n        break;\n\n      default:\n        t(e.geometryType);\n    }\n  }\n\n  createFeature() {\n    return this.lengths.length = 0, this.currentLengthIndex = 0, this.previousCoordinate[0] = 0, this.previousCoordinate[1] = 0, new n(r(), null, new this._attributesConstructor());\n  }\n\n  allocateCoordinates() {\n    const t = this.lengths.reduce((t, e) => t + e, 0);\n    this.coordinateBuffer = new Float64Array(t * this.vertexDimension), this.coordinateBufferPtr = 0;\n  }\n\n  addLength(t, e, r) {\n    0 === this.lengths.length && (this.toAddInCurrentPath = e), this.lengths.push(e);\n  }\n\n  createPointGeometry(t) {\n    const e = {\n      type: \"point\",\n      x: 0,\n      y: 0,\n      spatialReference: t.spatialReference,\n      hasZ: !!t.hasZ,\n      hasM: !!t.hasM\n    };\n    return e.hasZ && (e.z = 0), e.hasM && (e.m = 0), e;\n  }\n\n  addCoordinatePoint(t, e, r) {\n    switch (e = this.applyTransform(this.transform, e, r, 0), r) {\n      case 0:\n        t.x = e;\n        break;\n\n      case 1:\n        t.y = e;\n        break;\n\n      case 2:\n        t.hasZ ? t.z = e : t.m = e;\n        break;\n\n      case 3:\n        t.m = e;\n    }\n  }\n\n  _transformPathLikeValue(t, e) {\n    let r = 0;\n    return e <= 1 && (r = this.previousCoordinate[e], this.previousCoordinate[e] += t), this.applyTransform(this.transform, t, e, r);\n  }\n\n  _addCoordinatePolyline(t, e, r) {\n    this._dehydratedAddPointsCoordinate(t.paths, e, r);\n  }\n\n  _addCoordinatePolygon(t, e, r) {\n    this._dehydratedAddPointsCoordinate(t.rings, e, r);\n  }\n\n  _addCoordinateMultipoint(t, e, r) {\n    0 === r && t.points.push([]);\n\n    const o = this._transformPathLikeValue(e, r);\n\n    t.points[t.points.length - 1].push(o);\n  }\n\n  _createPolygonGeometry(t) {\n    return {\n      type: \"polygon\",\n      rings: [[]],\n      spatialReference: t.spatialReference,\n      hasZ: !!t.hasZ,\n      hasM: !!t.hasM\n    };\n  }\n\n  _createPolylineGeometry(t) {\n    return {\n      type: \"polyline\",\n      paths: [[]],\n      spatialReference: t.spatialReference,\n      hasZ: !!t.hasZ,\n      hasM: !!t.hasM\n    };\n  }\n\n  _createMultipointGeometry(t) {\n    return {\n      type: \"multipoint\",\n      points: [],\n      spatialReference: t.spatialReference,\n      hasZ: !!t.hasZ,\n      hasM: !!t.hasM\n    };\n  }\n\n  _dehydratedAddPointsCoordinate(t, e, r) {\n    0 === r && 0 == this.toAddInCurrentPath-- && (t.push([]), this.toAddInCurrentPath = this.lengths[++this.currentLengthIndex] - 1, this.previousCoordinate[0] = 0, this.previousCoordinate[1] = 0);\n\n    const o = this._transformPathLikeValue(e, r),\n          s = t[t.length - 1];\n\n    0 === r && s.push(new Float64Array(this.coordinateBuffer.buffer, this.coordinateBufferPtr * Float64Array.BYTES_PER_ELEMENT, this.vertexDimension)), this.coordinateBuffer[this.coordinateBufferPtr++] = o;\n  }\n\n  _deriveApplyTransform(t) {\n    const {\n      hasZ: e,\n      hasM: r\n    } = t;\n    return e && r ? f : e ? c : r ? d : p;\n  }\n\n}\n\nexport { g as DehydratedFeatureSetParserContext };","map":{"version":3,"sources":["D:/Github/CUSP_DataBase/CUSP_DB/src/main/gis/node_modules/@arcgis/core/rest/query/operations/pbfDehydratedFeatureSet.js"],"names":["neverReached","t","isNone","e","generateUID","r","o","getGeometryZScaler","s","DehydratedFeatureSetClass","i","DehydratedFeatureClass","n","unquantizeOptimizedGeometry","a","convertToGeometry","h","l","u","p","m","originPosition","y","c","d","f","translate","scale","g","constructor","options","geometryTypes","previousCoordinate","transform","applyTransform","lengths","currentLengthIndex","toAddInCurrentPath","vertexDimension","coordinateBuffer","coordinateBufferPtr","_attributesConstructor","createFeatureResult","finishFeatureResult","length","hasZ","geometryType","sourceSpatialReference","spatialReference","features","geometry","createSpatialReference","addField","fields","push","fromJSON","map","name","addFeature","maxStringAttributeLength","attributes","addQueryGeometry","queryGeometry","queryGeometryType","clone","type","prepareFeatures","_deriveApplyTransform","hasM","addCoordinate","addCoordinatePoint","createGeometry","createPointGeometry","_addCoordinatePolygon","_createPolygonGeometry","_addCoordinatePolyline","_createPolylineGeometry","_addCoordinateMultipoint","_createMultipointGeometry","createFeature","allocateCoordinates","reduce","Float64Array","addLength","x","z","_transformPathLikeValue","_dehydratedAddPointsCoordinate","paths","rings","points","buffer","BYTES_PER_ELEMENT","DehydratedFeatureSetParserContext"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport{neverReached as t}from\"../../../core/compilerUtils.js\";import{isNone as e}from\"../../../core/maybe.js\";import{generateUID as r}from\"../../../core/uid.js\";import o from\"../../../geometry/SpatialReference.js\";import{getGeometryZScaler as s}from\"../../../geometry/support/zscale.js\";import{DehydratedFeatureSetClass as i,DehydratedFeatureClass as n}from\"../../../layers/graphics/dehydratedFeatures.js\";import{unquantizeOptimizedGeometry as a,convertToGeometry as h}from\"../../../layers/graphics/featureConversionUtils.js\";import l from\"../../../layers/support/Field.js\";function u(t,e){return e}function p(t,e,r,o){switch(r){case 0:return m(t,e+o,0);case 1:return\"lowerLeft\"===t.originPosition?m(t,e+o,1):y(t,e+o,1)}}function c(t,e,r,o){return 2===r?m(t,e,2):p(t,e,r,o)}function d(t,e,r,o){return 2===r?m(t,e,3):p(t,e,r,o)}function f(t,e,r,o){return 3===r?m(t,e,3):c(t,e,r,o)}function m({translate:t,scale:e},r,o){return t[o]+r*e[o]}function y({translate:t,scale:e},r,o){return t[o]-r*e[o]}class g{constructor(t){this.options=t,this.geometryTypes=[\"point\",\"multipoint\",\"polyline\",\"polygon\"],this.previousCoordinate=[0,0],this.transform=null,this.applyTransform=u,this.lengths=[],this.currentLengthIndex=0,this.toAddInCurrentPath=0,this.vertexDimension=0,this.coordinateBuffer=null,this.coordinateBufferPtr=0,this._attributesConstructor=function(){}}createFeatureResult(){return new i}finishFeatureResult(t){if(this.options.applyTransform&&(t.transform=null),this._attributesConstructor=function(){},this.coordinateBuffer=null,this.lengths.length=0,!t.hasZ)return;const r=s(t.geometryType,this.options.sourceSpatialReference,t.spatialReference);if(!e(r))for(const e of t.features)r(e.geometry)}createSpatialReference(){return new o}addField(t,e){t.fields.push(l.fromJSON(e));const r=t.fields.map((t=>t.name));this._attributesConstructor=function(){for(const t of r)this[t]=null}}addFeature(t,e){const r=this.options.maxStringAttributeLength?this.options.maxStringAttributeLength:0;if(r>0)for(const o in e.attributes){const t=e.attributes[o];\"string\"==typeof t&&t.length>r&&(e.attributes[o]=\"\")}t.features.push(e)}addQueryGeometry(t,e){const{queryGeometry:r,queryGeometryType:o}=e,s=a(r.clone(),r,!1,!1,this.transform),i=h(s,o,!1,!1);let n=null;switch(o){case\"esriGeometryPoint\":n=\"point\";break;case\"esriGeometryPolygon\":n=\"polygon\";break;case\"esriGeometryPolyline\":n=\"polyline\";break;case\"esriGeometryMultipoint\":n=\"multipoint\"}i.type=n,t.queryGeometryType=o,t.queryGeometry=i}prepareFeatures(e){switch(this.transform=e.transform,this.options.applyTransform&&e.transform&&(this.applyTransform=this._deriveApplyTransform(e)),this.vertexDimension=2,e.hasZ&&this.vertexDimension++,e.hasM&&this.vertexDimension++,e.geometryType){case\"point\":this.addCoordinate=(t,e,r)=>this.addCoordinatePoint(t,e,r),this.createGeometry=t=>this.createPointGeometry(t);break;case\"polygon\":this.addCoordinate=(t,e,r)=>this._addCoordinatePolygon(t,e,r),this.createGeometry=t=>this._createPolygonGeometry(t);break;case\"polyline\":this.addCoordinate=(t,e,r)=>this._addCoordinatePolyline(t,e,r),this.createGeometry=t=>this._createPolylineGeometry(t);break;case\"multipoint\":this.addCoordinate=(t,e,r)=>this._addCoordinateMultipoint(t,e,r),this.createGeometry=t=>this._createMultipointGeometry(t);break;case\"mesh\":case\"extent\":break;default:t(e.geometryType)}}createFeature(){return this.lengths.length=0,this.currentLengthIndex=0,this.previousCoordinate[0]=0,this.previousCoordinate[1]=0,new n(r(),null,new this._attributesConstructor)}allocateCoordinates(){const t=this.lengths.reduce(((t,e)=>t+e),0);this.coordinateBuffer=new Float64Array(t*this.vertexDimension),this.coordinateBufferPtr=0}addLength(t,e,r){0===this.lengths.length&&(this.toAddInCurrentPath=e),this.lengths.push(e)}createPointGeometry(t){const e={type:\"point\",x:0,y:0,spatialReference:t.spatialReference,hasZ:!!t.hasZ,hasM:!!t.hasM};return e.hasZ&&(e.z=0),e.hasM&&(e.m=0),e}addCoordinatePoint(t,e,r){switch(e=this.applyTransform(this.transform,e,r,0),r){case 0:t.x=e;break;case 1:t.y=e;break;case 2:t.hasZ?t.z=e:t.m=e;break;case 3:t.m=e}}_transformPathLikeValue(t,e){let r=0;return e<=1&&(r=this.previousCoordinate[e],this.previousCoordinate[e]+=t),this.applyTransform(this.transform,t,e,r)}_addCoordinatePolyline(t,e,r){this._dehydratedAddPointsCoordinate(t.paths,e,r)}_addCoordinatePolygon(t,e,r){this._dehydratedAddPointsCoordinate(t.rings,e,r)}_addCoordinateMultipoint(t,e,r){0===r&&t.points.push([]);const o=this._transformPathLikeValue(e,r);t.points[t.points.length-1].push(o)}_createPolygonGeometry(t){return{type:\"polygon\",rings:[[]],spatialReference:t.spatialReference,hasZ:!!t.hasZ,hasM:!!t.hasM}}_createPolylineGeometry(t){return{type:\"polyline\",paths:[[]],spatialReference:t.spatialReference,hasZ:!!t.hasZ,hasM:!!t.hasM}}_createMultipointGeometry(t){return{type:\"multipoint\",points:[],spatialReference:t.spatialReference,hasZ:!!t.hasZ,hasM:!!t.hasM}}_dehydratedAddPointsCoordinate(t,e,r){0===r&&0==this.toAddInCurrentPath--&&(t.push([]),this.toAddInCurrentPath=this.lengths[++this.currentLengthIndex]-1,this.previousCoordinate[0]=0,this.previousCoordinate[1]=0);const o=this._transformPathLikeValue(e,r),s=t[t.length-1];0===r&&s.push(new Float64Array(this.coordinateBuffer.buffer,this.coordinateBufferPtr*Float64Array.BYTES_PER_ELEMENT,this.vertexDimension)),this.coordinateBuffer[this.coordinateBufferPtr++]=o}_deriveApplyTransform(t){const{hasZ:e,hasM:r}=t;return e&&r?f:e?c:r?d:p}}export{g as DehydratedFeatureSetParserContext};\n"]},"metadata":{},"sourceType":"module"}