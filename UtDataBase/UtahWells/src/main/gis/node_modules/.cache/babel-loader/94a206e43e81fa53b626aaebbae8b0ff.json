{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../chunks/tslib.es6.js\";\nimport r from \"../../core/Collection.js\";\nimport s from \"../../core/CollectionFlattener.js\";\nimport t from \"../../core/Error.js\";\nimport o from \"../../core/Logger.js\";\nimport { property as a } from \"../../core/accessorSupport/decorators/property.js\";\nimport \"../../core/arrayUtils.js\";\nimport \"../../core/has.js\";\nimport { getProperties as l } from \"../../core/accessorSupport/utils.js\";\nimport \"../../core/accessorSupport/ensureType.js\";\nimport { subclass as i } from \"../../core/accessorSupport/decorators/subclass.js\";\nimport { OriginId as n, nameToId as u, idToName as y } from \"../../core/accessorSupport/PropertyOrigin.js\";\nimport c from \"../support/Sublayer.js\";\nimport { isSublayerOverhaul as b } from \"../support/sublayerUtils.js\";\nconst p = o.getLogger(\"esri.layers.TileLayer\");\n\nfunction d(e, r) {\n  const s = [],\n        t = {};\n  return e ? (e.forEach(e => {\n    const o = new c();\n\n    if (o.read(e, r), t[o.id] = o, null != e.parentLayerId && -1 !== e.parentLayerId) {\n      const r = t[e.parentLayerId];\n      r.sublayers || (r.sublayers = []), r.sublayers.unshift(o);\n    } else s.unshift(o);\n  }), s) : s;\n}\n\nconst h = r.ofType(c);\n\nfunction f(e, r) {\n  e && e.forEach(e => {\n    r(e), e.sublayers && e.sublayers.length && f(e.sublayers, r);\n  });\n}\n\nconst S = o => {\n  let S = class extends o {\n    constructor() {\n      super(...arguments), this.allSublayers = new s({\n        getCollections: () => [this.sublayers],\n        getChildrenFunction: e => e.sublayers\n      }), this.sublayersSourceJSON = {\n        [n.SERVICE]: {},\n        [n.PORTAL_ITEM]: {},\n        [n.WEB_SCENE]: {},\n        [n.WEB_MAP]: {}\n      }, this.handles.add(this.watch(\"sublayers\", (e, r) => this._handleSublayersChange(e, r), !0));\n    }\n\n    readSublayers(e, r) {\n      if (!r || !e) return;\n      const {\n        sublayersSourceJSON: s\n      } = this,\n            t = u(r.origin);\n      if (t < n.SERVICE) return;\n      if (s[t] = {\n        context: r,\n        visibleLayers: e.visibleLayers || s[t].visibleLayers,\n        layers: e.layers || s[t].layers\n      }, t > n.SERVICE) return;\n\n      this._set(\"serviceSublayers\", this.createSublayersForOrigin(\"service\").sublayers);\n\n      const {\n        sublayers: o,\n        origin: a\n      } = this.createSublayersForOrigin(\"web-document\"),\n            i = l(this);\n      i.setDefaultOrigin(a), this._set(\"sublayers\", new h(o)), i.setDefaultOrigin(\"user\");\n    }\n\n    findSublayerById(e) {\n      return this.allSublayers.find(r => r.id === e);\n    }\n\n    createServiceSublayers() {\n      return this.createSublayersForOrigin(\"service\").sublayers;\n    }\n\n    createSublayersForOrigin(e) {\n      const r = u(\"web-document\" === e ? \"web-map\" : e);\n      let s = n.SERVICE,\n          t = this.sublayersSourceJSON[n.SERVICE].layers,\n          o = this.sublayersSourceJSON[n.SERVICE].context,\n          a = null;\n      const l = [n.PORTAL_ITEM, n.WEB_SCENE, n.WEB_MAP].filter(e => e <= r);\n\n      for (const n of l) {\n        const e = this.sublayersSourceJSON[n];\n        b(e.layers) && (s = n, t = e.layers, o = e.context, e.visibleLayers && (a = {\n          visibleLayers: e.visibleLayers,\n          context: e.context\n        }));\n      }\n\n      const i = [n.PORTAL_ITEM, n.WEB_SCENE, n.WEB_MAP].filter(e => e > s && e <= r);\n      let c = null;\n\n      for (const n of i) {\n        const {\n          layers: e,\n          visibleLayers: r,\n          context: s\n        } = this.sublayersSourceJSON[n];\n        e && (c = {\n          layers: e,\n          context: s\n        }), r && (a = {\n          visibleLayers: r,\n          context: s\n        });\n      }\n\n      const p = d(t, o),\n            S = new Map(),\n            m = new Set();\n      if (c) for (const n of c.layers) S.set(n.id, n);\n      if (a) for (const n of a.visibleLayers) m.add(n);\n      return f(p, e => {\n        c && e.read(S.get(e.id), c.context), a && e.read({\n          defaultVisibility: m.has(e.id)\n        }, a.context);\n      }), {\n        origin: y(s),\n        sublayers: new h({\n          items: p\n        })\n      };\n    }\n\n    read(e, r) {\n      super.read(e, r), this.readSublayers(e, r);\n    }\n\n    _handleSublayersChange(e, r) {\n      r && (r.forEach(e => {\n        e.parent = null, e.layer = null;\n      }), this.handles.remove(\"sublayers-owner\")), e && (e.forEach(e => {\n        e.parent = this, e.layer = this;\n      }), this.handles.add([e.on(\"after-add\", _ref => {\n        let {\n          item: e\n        } = _ref;\n        e.parent = this, e.layer = this;\n      }), e.on(\"after-remove\", _ref2 => {\n        let {\n          item: e\n        } = _ref2;\n        e.parent = null, e.layer = null;\n      })], \"sublayers-owner\"), \"tile\" === this.type && this.handles.add(e.on(\"before-changes\", e => {\n        p.error(new t(\"tilelayer:sublayers-non-modifiable\", \"ISublayer can't be added, moved, or removed from the layer's sublayers\", {\n          layer: this\n        })), e.preventDefault();\n      }), \"sublayers-owner\"));\n    }\n\n  };\n  return e([a({\n    readOnly: !0\n  })], S.prototype, \"allSublayers\", void 0), e([a({\n    readOnly: !0,\n    type: r.ofType(c)\n  })], S.prototype, \"serviceSublayers\", void 0), e([a({\n    value: null,\n    type: h,\n    json: {\n      read: !1,\n      write: {\n        allowNull: !0,\n        ignoreOrigin: !0\n      }\n    }\n  })], S.prototype, \"sublayers\", void 0), e([a({\n    readOnly: !0\n  })], S.prototype, \"sublayersSourceJSON\", void 0), S = e([i(\"esri.layers.mixins.SublayersOwner\")], S), S;\n};\n\nexport { S as SublayersOwner, f as forEachSublayer };","map":{"version":3,"sources":["D:/Github/CUSP_DataBase/CUSP_DB/src/main/gis/node_modules/@arcgis/core/layers/mixins/SublayersOwner.js"],"names":["_","e","r","s","t","o","property","a","getProperties","l","subclass","i","OriginId","n","nameToId","u","idToName","y","c","isSublayerOverhaul","b","p","getLogger","d","forEach","read","id","parentLayerId","sublayers","unshift","h","ofType","f","length","S","constructor","allSublayers","getCollections","getChildrenFunction","sublayersSourceJSON","SERVICE","PORTAL_ITEM","WEB_SCENE","WEB_MAP","handles","add","watch","_handleSublayersChange","readSublayers","origin","context","visibleLayers","layers","_set","createSublayersForOrigin","setDefaultOrigin","findSublayerById","find","createServiceSublayers","filter","Map","m","Set","set","get","defaultVisibility","has","items","parent","layer","remove","on","item","type","error","preventDefault","readOnly","prototype","value","json","write","allowNull","ignoreOrigin","SublayersOwner","forEachSublayer"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import r from\"../../core/Collection.js\";import s from\"../../core/CollectionFlattener.js\";import t from\"../../core/Error.js\";import o from\"../../core/Logger.js\";import{property as a}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/arrayUtils.js\";import\"../../core/has.js\";import{getProperties as l}from\"../../core/accessorSupport/utils.js\";import\"../../core/accessorSupport/ensureType.js\";import{subclass as i}from\"../../core/accessorSupport/decorators/subclass.js\";import{OriginId as n,nameToId as u,idToName as y}from\"../../core/accessorSupport/PropertyOrigin.js\";import c from\"../support/Sublayer.js\";import{isSublayerOverhaul as b}from\"../support/sublayerUtils.js\";const p=o.getLogger(\"esri.layers.TileLayer\");function d(e,r){const s=[],t={};return e?(e.forEach((e=>{const o=new c;if(o.read(e,r),t[o.id]=o,null!=e.parentLayerId&&-1!==e.parentLayerId){const r=t[e.parentLayerId];r.sublayers||(r.sublayers=[]),r.sublayers.unshift(o)}else s.unshift(o)})),s):s}const h=r.ofType(c);function f(e,r){e&&e.forEach((e=>{r(e),e.sublayers&&e.sublayers.length&&f(e.sublayers,r)}))}const S=o=>{let S=class extends o{constructor(...e){super(...e),this.allSublayers=new s({getCollections:()=>[this.sublayers],getChildrenFunction:e=>e.sublayers}),this.sublayersSourceJSON={[n.SERVICE]:{},[n.PORTAL_ITEM]:{},[n.WEB_SCENE]:{},[n.WEB_MAP]:{}},this.handles.add(this.watch(\"sublayers\",((e,r)=>this._handleSublayersChange(e,r)),!0))}readSublayers(e,r){if(!r||!e)return;const{sublayersSourceJSON:s}=this,t=u(r.origin);if(t<n.SERVICE)return;if(s[t]={context:r,visibleLayers:e.visibleLayers||s[t].visibleLayers,layers:e.layers||s[t].layers},t>n.SERVICE)return;this._set(\"serviceSublayers\",this.createSublayersForOrigin(\"service\").sublayers);const{sublayers:o,origin:a}=this.createSublayersForOrigin(\"web-document\"),i=l(this);i.setDefaultOrigin(a),this._set(\"sublayers\",new h(o)),i.setDefaultOrigin(\"user\")}findSublayerById(e){return this.allSublayers.find((r=>r.id===e))}createServiceSublayers(){return this.createSublayersForOrigin(\"service\").sublayers}createSublayersForOrigin(e){const r=u(\"web-document\"===e?\"web-map\":e);let s=n.SERVICE,t=this.sublayersSourceJSON[n.SERVICE].layers,o=this.sublayersSourceJSON[n.SERVICE].context,a=null;const l=[n.PORTAL_ITEM,n.WEB_SCENE,n.WEB_MAP].filter((e=>e<=r));for(const n of l){const e=this.sublayersSourceJSON[n];b(e.layers)&&(s=n,t=e.layers,o=e.context,e.visibleLayers&&(a={visibleLayers:e.visibleLayers,context:e.context}))}const i=[n.PORTAL_ITEM,n.WEB_SCENE,n.WEB_MAP].filter((e=>e>s&&e<=r));let c=null;for(const n of i){const{layers:e,visibleLayers:r,context:s}=this.sublayersSourceJSON[n];e&&(c={layers:e,context:s}),r&&(a={visibleLayers:r,context:s})}const p=d(t,o),S=new Map,m=new Set;if(c)for(const n of c.layers)S.set(n.id,n);if(a)for(const n of a.visibleLayers)m.add(n);return f(p,(e=>{c&&e.read(S.get(e.id),c.context),a&&e.read({defaultVisibility:m.has(e.id)},a.context)})),{origin:y(s),sublayers:new h({items:p})}}read(e,r){super.read(e,r),this.readSublayers(e,r)}_handleSublayersChange(e,r){r&&(r.forEach((e=>{e.parent=null,e.layer=null})),this.handles.remove(\"sublayers-owner\")),e&&(e.forEach((e=>{e.parent=this,e.layer=this})),this.handles.add([e.on(\"after-add\",(({item:e})=>{e.parent=this,e.layer=this})),e.on(\"after-remove\",(({item:e})=>{e.parent=null,e.layer=null}))],\"sublayers-owner\"),\"tile\"===this.type&&this.handles.add(e.on(\"before-changes\",(e=>{p.error(new t(\"tilelayer:sublayers-non-modifiable\",\"ISublayer can't be added, moved, or removed from the layer's sublayers\",{layer:this})),e.preventDefault()})),\"sublayers-owner\"))}};return e([a({readOnly:!0})],S.prototype,\"allSublayers\",void 0),e([a({readOnly:!0,type:r.ofType(c)})],S.prototype,\"serviceSublayers\",void 0),e([a({value:null,type:h,json:{read:!1,write:{allowNull:!0,ignoreOrigin:!0}}})],S.prototype,\"sublayers\",void 0),e([a({readOnly:!0})],S.prototype,\"sublayersSourceJSON\",void 0),S=e([i(\"esri.layers.mixins.SublayersOwner\")],S),S};export{S as SublayersOwner,f as forEachSublayer};\n"]},"metadata":{},"sourceType":"module"}