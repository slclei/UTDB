{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport { isNone as t } from \"../../../../../core/maybe.js\";\nimport e from \"../MemoryBuffer.js\";\nimport { EncodingType as n, AttributeStatus as o } from \"./enums.js\";\nimport { DataType as s } from \"../../../../webgl/enums.js\";\nimport { VertexElementDescriptor as r } from \"../../../../webgl/VertexElementDescriptor.js\";\n\nclass i {\n  constructor(t) {\n    this._locations = new Map(), this._key = t;\n  }\n\n  get key() {\n    return this._key;\n  }\n\n  get type() {\n    return 7 & this._key;\n  }\n\n  defines() {\n    return [];\n  }\n\n  getStride() {\n    return this._layoutInfo || this._buildAttributesInfo(), this._stride;\n  }\n\n  getAttributeLocations() {\n    return 0 === this._locations.size && this._buildAttributesInfo(), this._locations;\n  }\n\n  getLayoutInfo() {\n    return this._layoutInfo || this._buildAttributesInfo(), this._layoutInfo;\n  }\n\n  getEncodingInfos() {\n    return this._propertyEncodingInfo || this._buildAttributesInfo(), this._propertyEncodingInfo;\n  }\n\n  getUniforms() {\n    return this._uniforms || this._buildAttributesInfo(), this._uniforms;\n  }\n\n  getShaderHeader() {\n    return this._shaderHeader || this._buildAttributesInfo(), this._shaderHeader;\n  }\n\n  getShaderMain() {\n    return this._shaderMain || this._buildAttributesInfo(), this._shaderMain;\n  }\n\n  setDataUniforms(t, e, n, o, s) {\n    const r = this.getUniforms();\n\n    for (const i of r) {\n      const {\n        name: r,\n        type: a,\n        getValue: c\n      } = i,\n            u = c(n, e, o, s);\n      if (null !== u) switch (a) {\n        case \"float\":\n          t.setUniform1f(r, u);\n          break;\n\n        case \"vec2\":\n          t.setUniform2fv(r, u);\n          break;\n\n        case \"vec4\":\n          t.setUniform4fv(r, u);\n      }\n    }\n  }\n\n  encodeAttributes(t, e, o, s) {\n    const r = this.attributesInfo(),\n          i = this.getEncodingInfos(),\n          a = [];\n    let c = 0,\n        u = 0;\n\n    for (const _ of Object.keys(i)) {\n      var f;\n      const h = i[_],\n            {\n        type: l,\n        precisionFactor: d,\n        isLayout: y\n      } = r[_],\n            I = y ? o.getLayoutProperty(_) : o.getPaintProperty(_),\n            m = null == (f = I.interpolator) ? void 0 : f.getInterpolationRange(e);\n      let E = 0;\n\n      for (const o of h) {\n        const {\n          offset: r,\n          bufferElementsToAdd: i\n        } = o;\n\n        if (i > 0) {\n          for (let t = 0; t < i; t++) a.push(0);\n\n          c += u, u = o.bufferElementsToAdd;\n        }\n\n        const f = null != s ? s : I.getValue(m ? m[E] : e, t);\n\n        switch (l) {\n          case n.R8_SIGNED:\n          case n.R8_UNSIGNED:\n            a[c] |= this._encodeByte(f * (d || 1), 8 * r);\n            break;\n\n          case n.R16_SIGNED:\n          case n.R16_UNSIGNED:\n            a[c] |= this._encodeShort(f * (d || 1), 8 * r);\n            break;\n\n          case n.R8G8_SIGNED:\n          case n.R8G8_UNSIGNED:\n            a[c] |= this._encodeByte(f * (d || 1), 8 * r), a[c] |= this._encodeByte(f * (d || 1), 8 * r + 8);\n            break;\n\n          case n.R16G16_SIGNED:\n          case n.R16G16_UNSIGNED:\n            a[c] |= this._encodeShort(f * (d || 1), 8 * r), a[c] |= this._encodeShort(f * (d || 1), 8 * r + 16);\n            break;\n\n          case n.R8G8B8A8_SIGNED:\n          case n.R8G8B8A8_UNSIGNED:\n            a[c] |= this._encodeByte(f * (d || 1), 8 * r), a[c] |= this._encodeByte(f * (d || 1), 8 * r + 8), a[c] |= this._encodeByte(f * (d || 1), 8 * r + 16), a[c] |= this._encodeByte(f * (d || 1), 8 * r + 24);\n            break;\n\n          case n.R8G8B8A8_COLOR:\n            a[c] = this._encodeColor(f);\n            break;\n\n          case n.R16G16B16A16_DASHARRAY:\n          case n.R16G16B16A16_PATTERN:\n            this._encodePattern(c, a, f);\n\n            break;\n\n          default:\n            throw new Error(\"Unsupported encoding type\");\n        }\n\n        E++;\n      }\n    }\n\n    return a;\n  }\n\n  getAtributeState(t) {\n    let e = 0;\n    const n = 3 + 2 * t;\n    return e |= this._bit(n), e |= this._bit(n + 1) << 1, e;\n  }\n\n  _buildAttributesInfo() {\n    const t = [],\n          e = {},\n          n = {};\n    let r = -1;\n    const a = this.attributesInfo(),\n          c = this.attributes();\n    let u = -1;\n\n    for (const s of c) {\n      u++;\n      const c = this.getAtributeState(u);\n      if (c === o.UNIFORM || c === o.UNUSED) continue;\n      const f = a[s],\n            _ = [];\n      e[s] = _;\n      const h = f.type;\n\n      for (let e = 0; e < c; e++) {\n        const {\n          dataType: e,\n          bytesPerElement: o,\n          count: s,\n          normalized: a\n        } = i._encodingInfo[h],\n              c = o * s;\n        let u = n[e],\n            f = 0;\n        if (!u || u.count + s > 4) r++, u = {\n          dataIndex: r,\n          count: 0,\n          offset: 0\n        }, 4 !== s && (n[e] = u), t.push({\n          location: -1,\n          name: \"a_data_\" + r,\n          count: s,\n          type: e,\n          normalized: a\n        }), f = Math.ceil(Math.max(c / 4, 1));else {\n          const e = t[u.dataIndex];\n          e.count += s;\n          f = Math.ceil(Math.max(e.count * o / 4, 1)) - Math.ceil(Math.max(u.offset / 4, 1));\n        }\n        _.push({\n          dataIndex: u.dataIndex,\n          offset: u.offset,\n          bufferElementsToAdd: f\n        }), u.offset += c, u.count += s;\n      }\n    }\n\n    for (const o of t) switch (o.type) {\n      case s.BYTE:\n      case s.UNSIGNED_BYTE:\n        o.count = 4;\n\n      case s.SHORT:\n      case s.UNSIGNED_SHORT:\n        o.count += o.count % 2;\n    }\n\n    this._buildVertexBufferLayout(t);\n\n    let f = 0;\n    const _ = this._layoutInfo.geometry;\n\n    for (const o of _) this._locations.set(o.name, f++);\n\n    const h = this._layoutInfo.opacity;\n    if (h) for (const o of h) this._locations.set(o.name, f++);\n    this._buildShaderInfo(t, e), this._propertyEncodingInfo = e;\n  }\n\n  _buildVertexBufferLayout(t) {\n    const e = {},\n          n = this.geometryInfo();\n    let o = n[0].stride;\n    if (0 === t.length) e.geometry = n;else {\n      const s = [];\n      let i = o;\n\n      for (const e of t) o += a(e.type) * e.count;\n\n      for (const t of n) {\n        const e = { ...t\n        };\n        e.stride = o, s.push(e);\n      }\n\n      for (const e of t) s.push(new r(e.name, e.count, e.type, i, o)), i += a(e.type) * e.count;\n\n      e.geometry = s;\n    }\n    this.opacityInfo() && (e.opacity = this.opacityInfo()), this._layoutInfo = e, this._stride = o;\n  }\n\n  _buildShaderInfo(e, s) {\n    let r = \"\\n\",\n        a = \"\\n\";\n    const u = [];\n\n    for (const t of e) r += `attribute ${this._getType(t.count)} ${t.name};\\n`;\n\n    const f = this.attributes(),\n          _ = this.attributesInfo();\n\n    let h = -1;\n\n    for (const l of f) {\n      h++;\n\n      const {\n        name: e,\n        type: f,\n        precisionFactor: d,\n        isLayout: y\n      } = _[l],\n            I = d && 1 !== d ? \" * \" + 1 / d : \"\",\n            {\n        bytesPerElement: m,\n        count: E\n      } = i._encodingInfo[f],\n            p = t => `a_data_${t.dataIndex}${c(E, t.offset, m)}`;\n\n      switch (this.getAtributeState(h)) {\n        case o.UNIFORM:\n          {\n            const o = this._getType(E),\n                  s = `u_${e}`;\n\n            u.push({\n              name: s,\n              type: o,\n              getValue: (e, o, s, r) => {\n                const i = y ? e.getLayoutValue(l, o) : e.getPaintValue(l, o);\n\n                if (f === n.R16G16B16A16_DASHARRAY) {\n                  const n = e.getDashKey(i, e.getLayoutValue(\"line-cap\", o)),\n                        s = r.getMosaicItemPosition(n, !1);\n                  if (t(s)) return null;\n                  const {\n                    tl: a,\n                    br: c\n                  } = s;\n                  return [a[0], c[1], c[0], a[1]];\n                }\n\n                if (f === n.R16G16B16A16_PATTERN) {\n                  const e = r.getMosaicItemPosition(i, -1 === l.indexOf(\"line-\"));\n                  if (t(e)) return null;\n                  const {\n                    tl: n,\n                    br: o\n                  } = e;\n                  return [n[0], o[1], o[0], n[1]];\n                }\n\n                if (f === n.R8G8B8A8_COLOR) {\n                  const t = i[3];\n                  return [t * i[0], t * i[1], t * i[2], t];\n                }\n\n                return i;\n              }\n            }), r += `uniform ${o} ${s};\\n`, a += `${o} ${e} = ${s};\\n`;\n          }\n          break;\n\n        case o.DATA_DRIVEN:\n          {\n            const t = p(s[l][0]);\n            a += `${this._getType(E)} ${e} = ${t}${I};\\n`;\n          }\n          break;\n\n        case o.INTERPOLATED_DATA_DRIVEN:\n          {\n            const t = `u_t_${e}`;\n            u.push({\n              name: t,\n              type: \"float\",\n              getValue: (t, e, n, o) => (y ? t.getLayoutProperty(l) : t.getPaintProperty(l)).interpolator.interpolationUniformValue(n, e)\n            }), r += `uniform float ${t};\\n`;\n            const n = p(s[l][0]),\n                  o = p(s[l][1]);\n            a += `${this._getType(E)} ${e} = mix(${n}${I}, ${o}${I}, ${t});\\n`;\n          }\n      }\n    }\n\n    this._shaderHeader = r, this._shaderMain = a, this._uniforms = u;\n  }\n\n  _bit(t) {\n    return (this._key & 1 << t) >> t;\n  }\n\n  _getType(t) {\n    switch (t) {\n      case 1:\n        return \"float\";\n\n      case 2:\n        return \"vec2\";\n\n      case 3:\n        return \"vec3\";\n\n      case 4:\n        return \"vec4\";\n    }\n\n    throw new Error(\"Invalid count\");\n  }\n\n  _encodeColor(t) {\n    const n = 255 * t[3];\n    return e.i8888to32(t[0] * n, t[1] * n, t[2] * n, n);\n  }\n\n  _encodePattern(t, e, n) {\n    if (!n || !n.rect) return;\n    const o = 2,\n          s = n.rect,\n          r = n.width,\n          i = n.height;\n    e[t] = this._encodeShort(s.x + o, 0), e[t] |= this._encodeShort(s.y + o + i, 16), e[t + 1] = this._encodeShort(s.x + o + r, 0), e[t + 1] |= this._encodeShort(s.y + o, 16);\n  }\n\n  _encodeByte(t, e) {\n    return (255 & t) << e;\n  }\n\n  _encodeShort(t, e) {\n    return (65535 & t) << e;\n  }\n\n}\n\ni._encodingInfo = {\n  [n.R8_SIGNED]: {\n    dataType: s.BYTE,\n    bytesPerElement: 1,\n    count: 1,\n    normalized: !1\n  },\n  [n.R8_UNSIGNED]: {\n    dataType: s.UNSIGNED_BYTE,\n    bytesPerElement: 1,\n    count: 1,\n    normalized: !1\n  },\n  [n.R16_SIGNED]: {\n    dataType: s.SHORT,\n    bytesPerElement: 2,\n    count: 1,\n    normalized: !1\n  },\n  [n.R16_UNSIGNED]: {\n    dataType: s.UNSIGNED_SHORT,\n    bytesPerElement: 2,\n    count: 1,\n    normalized: !1\n  },\n  [n.R8G8_SIGNED]: {\n    dataType: s.BYTE,\n    bytesPerElement: 1,\n    count: 2,\n    normalized: !1\n  },\n  [n.R8G8_UNSIGNED]: {\n    dataType: s.UNSIGNED_BYTE,\n    bytesPerElement: 1,\n    count: 2,\n    normalized: !1\n  },\n  [n.R16G16_SIGNED]: {\n    dataType: s.SHORT,\n    bytesPerElement: 2,\n    count: 2,\n    normalized: !1\n  },\n  [n.R16G16_UNSIGNED]: {\n    dataType: s.UNSIGNED_SHORT,\n    bytesPerElement: 2,\n    count: 2,\n    normalized: !1\n  },\n  [n.R8G8B8A8_SIGNED]: {\n    dataType: s.BYTE,\n    bytesPerElement: 1,\n    count: 4,\n    normalized: !1\n  },\n  [n.R8G8B8A8_UNSIGNED]: {\n    dataType: s.UNSIGNED_BYTE,\n    bytesPerElement: 1,\n    count: 4,\n    normalized: !1\n  },\n  [n.R8G8B8A8_COLOR]: {\n    dataType: s.UNSIGNED_BYTE,\n    bytesPerElement: 1,\n    count: 4,\n    normalized: !0\n  },\n  [n.R16G16B16A16_DASHARRAY]: {\n    dataType: s.UNSIGNED_SHORT,\n    bytesPerElement: 2,\n    count: 4,\n    normalized: !1\n  },\n  [n.R16G16B16A16_PATTERN]: {\n    dataType: s.UNSIGNED_SHORT,\n    bytesPerElement: 2,\n    count: 4,\n    normalized: !1\n  }\n};\n\nconst a = t => {\n  switch (t) {\n    case s.FLOAT:\n    case s.INT:\n    case s.UNSIGNED_INT:\n      return 4;\n\n    case s.SHORT:\n    case s.UNSIGNED_SHORT:\n      return 2;\n\n    case s.BYTE:\n    case s.UNSIGNED_BYTE:\n      return 1;\n  }\n},\n      c = (t, e, n) => {\n  const o = e / n;\n  if (1 === t) switch (o) {\n    case 0:\n      return \".x\";\n\n    case 1:\n      return \".y\";\n\n    case 2:\n      return \".z\";\n\n    case 3:\n      return \".w\";\n  } else if (2 === t) switch (o) {\n    case 0:\n      return \".xy\";\n\n    case 1:\n      return \".yz\";\n\n    case 2:\n      return \".zw\";\n  } else if (3 === t) switch (o) {\n    case 0:\n      return \".xyz\";\n\n    case 1:\n      return \".yzw\";\n  }\n  return \"\";\n};\n\nexport { i as VTLMaterial };","map":{"version":3,"sources":["D:/Github/CUSP_DataBase/CUSP_DB/src/main/gis/node_modules/@arcgis/core/views/2d/engine/vectorTiles/shaders/VTLMaterial.js"],"names":["isNone","t","e","EncodingType","n","AttributeStatus","o","DataType","s","VertexElementDescriptor","r","i","constructor","_locations","Map","_key","key","type","defines","getStride","_layoutInfo","_buildAttributesInfo","_stride","getAttributeLocations","size","getLayoutInfo","getEncodingInfos","_propertyEncodingInfo","getUniforms","_uniforms","getShaderHeader","_shaderHeader","getShaderMain","_shaderMain","setDataUniforms","name","a","getValue","c","u","setUniform1f","setUniform2fv","setUniform4fv","encodeAttributes","attributesInfo","_","Object","keys","f","h","l","precisionFactor","d","isLayout","y","I","getLayoutProperty","getPaintProperty","m","interpolator","getInterpolationRange","E","offset","bufferElementsToAdd","push","R8_SIGNED","R8_UNSIGNED","_encodeByte","R16_SIGNED","R16_UNSIGNED","_encodeShort","R8G8_SIGNED","R8G8_UNSIGNED","R16G16_SIGNED","R16G16_UNSIGNED","R8G8B8A8_SIGNED","R8G8B8A8_UNSIGNED","R8G8B8A8_COLOR","_encodeColor","R16G16B16A16_DASHARRAY","R16G16B16A16_PATTERN","_encodePattern","Error","getAtributeState","_bit","attributes","UNIFORM","UNUSED","dataType","bytesPerElement","count","normalized","_encodingInfo","dataIndex","location","Math","ceil","max","BYTE","UNSIGNED_BYTE","SHORT","UNSIGNED_SHORT","_buildVertexBufferLayout","geometry","set","opacity","_buildShaderInfo","geometryInfo","stride","length","opacityInfo","_getType","p","getLayoutValue","getPaintValue","getDashKey","getMosaicItemPosition","tl","br","indexOf","DATA_DRIVEN","INTERPOLATED_DATA_DRIVEN","interpolationUniformValue","i8888to32","rect","width","height","x","FLOAT","INT","UNSIGNED_INT","VTLMaterial"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport{isNone as t}from\"../../../../../core/maybe.js\";import e from\"../MemoryBuffer.js\";import{EncodingType as n,AttributeStatus as o}from\"./enums.js\";import{DataType as s}from\"../../../../webgl/enums.js\";import{VertexElementDescriptor as r}from\"../../../../webgl/VertexElementDescriptor.js\";class i{constructor(t){this._locations=new Map,this._key=t}get key(){return this._key}get type(){return 7&this._key}defines(){return[]}getStride(){return this._layoutInfo||this._buildAttributesInfo(),this._stride}getAttributeLocations(){return 0===this._locations.size&&this._buildAttributesInfo(),this._locations}getLayoutInfo(){return this._layoutInfo||this._buildAttributesInfo(),this._layoutInfo}getEncodingInfos(){return this._propertyEncodingInfo||this._buildAttributesInfo(),this._propertyEncodingInfo}getUniforms(){return this._uniforms||this._buildAttributesInfo(),this._uniforms}getShaderHeader(){return this._shaderHeader||this._buildAttributesInfo(),this._shaderHeader}getShaderMain(){return this._shaderMain||this._buildAttributesInfo(),this._shaderMain}setDataUniforms(t,e,n,o,s){const r=this.getUniforms();for(const i of r){const{name:r,type:a,getValue:c}=i,u=c(n,e,o,s);if(null!==u)switch(a){case\"float\":t.setUniform1f(r,u);break;case\"vec2\":t.setUniform2fv(r,u);break;case\"vec4\":t.setUniform4fv(r,u)}}}encodeAttributes(t,e,o,s){const r=this.attributesInfo(),i=this.getEncodingInfos(),a=[];let c=0,u=0;for(const _ of Object.keys(i)){var f;const h=i[_],{type:l,precisionFactor:d,isLayout:y}=r[_],I=y?o.getLayoutProperty(_):o.getPaintProperty(_),m=null==(f=I.interpolator)?void 0:f.getInterpolationRange(e);let E=0;for(const o of h){const{offset:r,bufferElementsToAdd:i}=o;if(i>0){for(let t=0;t<i;t++)a.push(0);c+=u,u=o.bufferElementsToAdd}const f=null!=s?s:I.getValue(m?m[E]:e,t);switch(l){case n.R8_SIGNED:case n.R8_UNSIGNED:a[c]|=this._encodeByte(f*(d||1),8*r);break;case n.R16_SIGNED:case n.R16_UNSIGNED:a[c]|=this._encodeShort(f*(d||1),8*r);break;case n.R8G8_SIGNED:case n.R8G8_UNSIGNED:a[c]|=this._encodeByte(f*(d||1),8*r),a[c]|=this._encodeByte(f*(d||1),8*r+8);break;case n.R16G16_SIGNED:case n.R16G16_UNSIGNED:a[c]|=this._encodeShort(f*(d||1),8*r),a[c]|=this._encodeShort(f*(d||1),8*r+16);break;case n.R8G8B8A8_SIGNED:case n.R8G8B8A8_UNSIGNED:a[c]|=this._encodeByte(f*(d||1),8*r),a[c]|=this._encodeByte(f*(d||1),8*r+8),a[c]|=this._encodeByte(f*(d||1),8*r+16),a[c]|=this._encodeByte(f*(d||1),8*r+24);break;case n.R8G8B8A8_COLOR:a[c]=this._encodeColor(f);break;case n.R16G16B16A16_DASHARRAY:case n.R16G16B16A16_PATTERN:this._encodePattern(c,a,f);break;default:throw new Error(\"Unsupported encoding type\")}E++}}return a}getAtributeState(t){let e=0;const n=3+2*t;return e|=this._bit(n),e|=this._bit(n+1)<<1,e}_buildAttributesInfo(){const t=[],e={},n={};let r=-1;const a=this.attributesInfo(),c=this.attributes();let u=-1;for(const s of c){u++;const c=this.getAtributeState(u);if(c===o.UNIFORM||c===o.UNUSED)continue;const f=a[s],_=[];e[s]=_;const h=f.type;for(let e=0;e<c;e++){const{dataType:e,bytesPerElement:o,count:s,normalized:a}=i._encodingInfo[h],c=o*s;let u=n[e],f=0;if(!u||u.count+s>4)r++,u={dataIndex:r,count:0,offset:0},4!==s&&(n[e]=u),t.push({location:-1,name:\"a_data_\"+r,count:s,type:e,normalized:a}),f=Math.ceil(Math.max(c/4,1));else{const e=t[u.dataIndex];e.count+=s;f=Math.ceil(Math.max(e.count*o/4,1))-Math.ceil(Math.max(u.offset/4,1))}_.push({dataIndex:u.dataIndex,offset:u.offset,bufferElementsToAdd:f}),u.offset+=c,u.count+=s}}for(const o of t)switch(o.type){case s.BYTE:case s.UNSIGNED_BYTE:o.count=4;case s.SHORT:case s.UNSIGNED_SHORT:o.count+=o.count%2}this._buildVertexBufferLayout(t);let f=0;const _=this._layoutInfo.geometry;for(const o of _)this._locations.set(o.name,f++);const h=this._layoutInfo.opacity;if(h)for(const o of h)this._locations.set(o.name,f++);this._buildShaderInfo(t,e),this._propertyEncodingInfo=e}_buildVertexBufferLayout(t){const e={},n=this.geometryInfo();let o=n[0].stride;if(0===t.length)e.geometry=n;else{const s=[];let i=o;for(const e of t)o+=a(e.type)*e.count;for(const t of n){const e={...t};e.stride=o,s.push(e)}for(const e of t)s.push(new r(e.name,e.count,e.type,i,o)),i+=a(e.type)*e.count;e.geometry=s}this.opacityInfo()&&(e.opacity=this.opacityInfo()),this._layoutInfo=e,this._stride=o}_buildShaderInfo(e,s){let r=\"\\n\",a=\"\\n\";const u=[];for(const t of e)r+=`attribute ${this._getType(t.count)} ${t.name};\\n`;const f=this.attributes(),_=this.attributesInfo();let h=-1;for(const l of f){h++;const{name:e,type:f,precisionFactor:d,isLayout:y}=_[l],I=d&&1!==d?\" * \"+1/d:\"\",{bytesPerElement:m,count:E}=i._encodingInfo[f],p=t=>`a_data_${t.dataIndex}${c(E,t.offset,m)}`;switch(this.getAtributeState(h)){case o.UNIFORM:{const o=this._getType(E),s=`u_${e}`;u.push({name:s,type:o,getValue:(e,o,s,r)=>{const i=y?e.getLayoutValue(l,o):e.getPaintValue(l,o);if(f===n.R16G16B16A16_DASHARRAY){const n=e.getDashKey(i,e.getLayoutValue(\"line-cap\",o)),s=r.getMosaicItemPosition(n,!1);if(t(s))return null;const{tl:a,br:c}=s;return[a[0],c[1],c[0],a[1]]}if(f===n.R16G16B16A16_PATTERN){const e=r.getMosaicItemPosition(i,-1===l.indexOf(\"line-\"));if(t(e))return null;const{tl:n,br:o}=e;return[n[0],o[1],o[0],n[1]]}if(f===n.R8G8B8A8_COLOR){const t=i[3];return[t*i[0],t*i[1],t*i[2],t]}return i}}),r+=`uniform ${o} ${s};\\n`,a+=`${o} ${e} = ${s};\\n`}break;case o.DATA_DRIVEN:{const t=p(s[l][0]);a+=`${this._getType(E)} ${e} = ${t}${I};\\n`}break;case o.INTERPOLATED_DATA_DRIVEN:{const t=`u_t_${e}`;u.push({name:t,type:\"float\",getValue:(t,e,n,o)=>(y?t.getLayoutProperty(l):t.getPaintProperty(l)).interpolator.interpolationUniformValue(n,e)}),r+=`uniform float ${t};\\n`;const n=p(s[l][0]),o=p(s[l][1]);a+=`${this._getType(E)} ${e} = mix(${n}${I}, ${o}${I}, ${t});\\n`}}}this._shaderHeader=r,this._shaderMain=a,this._uniforms=u}_bit(t){return(this._key&1<<t)>>t}_getType(t){switch(t){case 1:return\"float\";case 2:return\"vec2\";case 3:return\"vec3\";case 4:return\"vec4\"}throw new Error(\"Invalid count\")}_encodeColor(t){const n=255*t[3];return e.i8888to32(t[0]*n,t[1]*n,t[2]*n,n)}_encodePattern(t,e,n){if(!n||!n.rect)return;const o=2,s=n.rect,r=n.width,i=n.height;e[t]=this._encodeShort(s.x+o,0),e[t]|=this._encodeShort(s.y+o+i,16),e[t+1]=this._encodeShort(s.x+o+r,0),e[t+1]|=this._encodeShort(s.y+o,16)}_encodeByte(t,e){return(255&t)<<e}_encodeShort(t,e){return(65535&t)<<e}}i._encodingInfo={[n.R8_SIGNED]:{dataType:s.BYTE,bytesPerElement:1,count:1,normalized:!1},[n.R8_UNSIGNED]:{dataType:s.UNSIGNED_BYTE,bytesPerElement:1,count:1,normalized:!1},[n.R16_SIGNED]:{dataType:s.SHORT,bytesPerElement:2,count:1,normalized:!1},[n.R16_UNSIGNED]:{dataType:s.UNSIGNED_SHORT,bytesPerElement:2,count:1,normalized:!1},[n.R8G8_SIGNED]:{dataType:s.BYTE,bytesPerElement:1,count:2,normalized:!1},[n.R8G8_UNSIGNED]:{dataType:s.UNSIGNED_BYTE,bytesPerElement:1,count:2,normalized:!1},[n.R16G16_SIGNED]:{dataType:s.SHORT,bytesPerElement:2,count:2,normalized:!1},[n.R16G16_UNSIGNED]:{dataType:s.UNSIGNED_SHORT,bytesPerElement:2,count:2,normalized:!1},[n.R8G8B8A8_SIGNED]:{dataType:s.BYTE,bytesPerElement:1,count:4,normalized:!1},[n.R8G8B8A8_UNSIGNED]:{dataType:s.UNSIGNED_BYTE,bytesPerElement:1,count:4,normalized:!1},[n.R8G8B8A8_COLOR]:{dataType:s.UNSIGNED_BYTE,bytesPerElement:1,count:4,normalized:!0},[n.R16G16B16A16_DASHARRAY]:{dataType:s.UNSIGNED_SHORT,bytesPerElement:2,count:4,normalized:!1},[n.R16G16B16A16_PATTERN]:{dataType:s.UNSIGNED_SHORT,bytesPerElement:2,count:4,normalized:!1}};const a=t=>{switch(t){case s.FLOAT:case s.INT:case s.UNSIGNED_INT:return 4;case s.SHORT:case s.UNSIGNED_SHORT:return 2;case s.BYTE:case s.UNSIGNED_BYTE:return 1}},c=(t,e,n)=>{const o=e/n;if(1===t)switch(o){case 0:return\".x\";case 1:return\".y\";case 2:return\".z\";case 3:return\".w\"}else if(2===t)switch(o){case 0:return\".xy\";case 1:return\".yz\";case 2:return\".zw\"}else if(3===t)switch(o){case 0:return\".xyz\";case 1:return\".yzw\"}return\"\"};export{i as VTLMaterial};\n"]},"metadata":{},"sourceType":"module"}