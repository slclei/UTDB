{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../../../chunks/tslib.es6.js\";\nimport r from \"../../../../core/Accessor.js\";\nimport { property as s } from \"../../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../../core/arrayUtils.js\";\nimport \"../../../../core/has.js\";\nimport \"../../../../core/accessorSupport/ensureType.js\";\nimport { subclass as t } from \"../../../../core/accessorSupport/decorators/subclass.js\";\nimport { QueueProcessor as o } from \"../../../support/QueueProcessor.js\";\n\nfunction n(e) {\n  return e.some(e => e.globalId);\n}\n\nfunction a(e) {\n  return e.filter(e => !e.error).map(e => {\n    var r;\n    return null != (r = e.objectId) ? r : e.globalId;\n  });\n}\n\nfunction d(e, r) {\n  const s = new Set(e);\n\n  for (const t of r.values()) s.add(t);\n\n  return s;\n}\n\nfunction i(e, r) {\n  const s = new Set(e);\n\n  for (const t of r.values()) s.delete(t);\n\n  return s;\n}\n\nlet u = class extends r {\n  constructor(e) {\n    super(e), this._hasGlobalIds = !1;\n  }\n\n  normalizeCtorArgs(e) {\n    return this._queueProcessor = new o({\n      concurrency: 1,\n      process: e.process\n    }), {};\n  }\n\n  destroy() {\n    this.clear();\n  }\n\n  get updating() {\n    return this._queueProcessor.length > 0;\n  }\n\n  clear() {\n    this._queueProcessor.clear();\n  }\n\n  push(e) {\n    const r = this._queueProcessor,\n          s = r.last();\n\n    switch (e.type) {\n      case \"update\":\n      case \"refresh\":\n        if ((null == s ? void 0 : s.type) === e.type) return;\n        r.push(e).finally(() => this.notifyChange(\"updating\"));\n        break;\n\n      case \"edit\":\n        {\n          const t = \"processed-edit\" === (null == s ? void 0 : s.type) ? s : null;\n          t && r.popLast();\n\n          const o = this._mergeEdits(t, e);\n\n          for (const e of o) r.push(e).finally(() => this.notifyChange(\"updating\"));\n\n          break;\n        }\n    }\n\n    this.notifyChange(\"updating\");\n  }\n\n  _mergeEdits(e, r) {\n    var s, t;\n    const {\n      addedFeatures: o,\n      deletedFeatures: u,\n      updatedFeatures: c\n    } = r.edits;\n\n    if (this._hasGlobalIds = this._hasGlobalIds || n(o) || n(c) || n(u), this._hasGlobalIds) {\n      return [e, {\n        type: \"processed-edit\",\n        edits: {\n          addOrModified: [...o, ...c],\n          removed: u\n        }\n      }];\n    }\n\n    const l = new Set(a(null != (s = null == e ? void 0 : e.edits.addOrModified) ? s : [])),\n          p = new Set(a(null != (t = null == e ? void 0 : e.edits.removed) ? t : [])),\n          f = new Set([...a(o), ...a(c)]),\n          h = new Set(a(u));\n    return [{\n      type: \"processed-edit\",\n      edits: {\n        addOrModified: Array.from(d(i(l, h), f)).map(e => ({\n          objectId: e\n        })),\n        removed: Array.from(d(i(p, f), h)).map(e => ({\n          objectId: e\n        }))\n      }\n    }];\n  }\n\n};\ne([s({\n  readOnly: !0\n})], u.prototype, \"updating\", null), u = e([t(\"esri.views.2d.layers.support.FeatureCommandQueue\")], u);\nconst c = u;\nexport { c as default };","map":{"version":3,"sources":["D:/Github/CUSP_DataBase/CUSP_DB/src/main/gis/node_modules/@arcgis/core/views/2d/layers/support/FeatureCommandQueue.js"],"names":["_","e","r","property","s","subclass","t","QueueProcessor","o","n","some","globalId","a","filter","error","map","objectId","d","Set","values","add","i","delete","u","constructor","_hasGlobalIds","normalizeCtorArgs","_queueProcessor","concurrency","process","destroy","clear","updating","length","push","last","type","finally","notifyChange","popLast","_mergeEdits","addedFeatures","deletedFeatures","updatedFeatures","c","edits","addOrModified","removed","l","p","f","h","Array","from","readOnly","prototype","default"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import r from\"../../../../core/Accessor.js\";import{property as s}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/arrayUtils.js\";import\"../../../../core/has.js\";import\"../../../../core/accessorSupport/ensureType.js\";import{subclass as t}from\"../../../../core/accessorSupport/decorators/subclass.js\";import{QueueProcessor as o}from\"../../../support/QueueProcessor.js\";function n(e){return e.some((e=>e.globalId))}function a(e){return e.filter((e=>!e.error)).map((e=>{var r;return null!=(r=e.objectId)?r:e.globalId}))}function d(e,r){const s=new Set(e);for(const t of r.values())s.add(t);return s}function i(e,r){const s=new Set(e);for(const t of r.values())s.delete(t);return s}let u=class extends r{constructor(e){super(e),this._hasGlobalIds=!1}normalizeCtorArgs(e){return this._queueProcessor=new o({concurrency:1,process:e.process}),{}}destroy(){this.clear()}get updating(){return this._queueProcessor.length>0}clear(){this._queueProcessor.clear()}push(e){const r=this._queueProcessor,s=r.last();switch(e.type){case\"update\":case\"refresh\":if((null==s?void 0:s.type)===e.type)return;r.push(e).finally((()=>this.notifyChange(\"updating\")));break;case\"edit\":{const t=\"processed-edit\"===(null==s?void 0:s.type)?s:null;t&&r.popLast();const o=this._mergeEdits(t,e);for(const e of o)r.push(e).finally((()=>this.notifyChange(\"updating\")));break}}this.notifyChange(\"updating\")}_mergeEdits(e,r){var s,t;const{addedFeatures:o,deletedFeatures:u,updatedFeatures:c}=r.edits;if(this._hasGlobalIds=this._hasGlobalIds||n(o)||n(c)||n(u),this._hasGlobalIds){return[e,{type:\"processed-edit\",edits:{addOrModified:[...o,...c],removed:u}}]}const l=new Set(a(null!=(s=null==e?void 0:e.edits.addOrModified)?s:[])),p=new Set(a(null!=(t=null==e?void 0:e.edits.removed)?t:[])),f=new Set([...a(o),...a(c)]),h=new Set(a(u));return[{type:\"processed-edit\",edits:{addOrModified:Array.from(d(i(l,h),f)).map((e=>({objectId:e}))),removed:Array.from(d(i(p,f),h)).map((e=>({objectId:e})))}}]}};e([s({readOnly:!0})],u.prototype,\"updating\",null),u=e([t(\"esri.views.2d.layers.support.FeatureCommandQueue\")],u);const c=u;export{c as default};\n"]},"metadata":{},"sourceType":"module"}