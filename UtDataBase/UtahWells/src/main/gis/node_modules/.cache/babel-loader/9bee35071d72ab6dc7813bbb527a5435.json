{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport { isNone as e, isSome as t } from \"../../../../core/maybe.js\";\nimport { pt2px as r } from \"../../../../core/screenUtils.js\";\nimport { r as i } from \"../../../../chunks/rbush.js\";\nimport { create as s, intersects as o, clone as n } from \"../../../../geometry/support/aaBoundingRect.js\";\nimport { getBoundsXY as h } from \"../../../../geometry/support/boundsUtils.js\";\nimport { normalizeMapX as u } from \"../../../../geometry/support/normalizeUtils.js\";\nimport { getSpatialReferenceMinMaxX as a } from \"../../../../geometry/support/normalizeUtilsCommon.js\";\nimport { HittestDrawHelper as l } from \"../../../../symbols/cim/CIMSymbolDrawHelper.js\";\nimport { CIMSimbolInflatedSizeHelper as c } from \"../../../../symbols/cim/CIMSymbolHelper.js\";\nimport m from \"./GraphicStoreItem.js\";\nimport { PIXEL_BUFFER as d, graphicGeometryToNumber as p } from \"./graphicsUtils.js\";\nconst g = {\n  minX: 0,\n  minY: 0,\n  maxX: 0,\n  maxY: 0\n},\n      f = s(),\n      _ = 1e-5;\n\nfunction b(e, t, r, i, s) {\n  return g.minX = t, g.minY = r, g.maxX = i, g.maxY = s, e.search(g);\n}\n\nfunction y(e) {\n  return {\n    minX: e.bounds[0],\n    minY: e.bounds[1],\n    maxX: e.bounds[2],\n    maxY: e.bounds[3]\n  };\n}\n\nclass I {\n  constructor(e, t, r, s, o, n, h) {\n    this._graphics = s, this._onAdd = o, this._onRemove = n, this._hashToCIM = h, this._index = i(9, y), this._itemByGraphic = new Map(), this._inflatedSizeHelper = new c(), this._tileInfoView = e, this._uidFieldName = r;\n    const u = e.getClosestInfoForScale(t);\n    u && (this._resolution = this._tileInfoView.getTileResolution(u.level));\n  }\n\n  setResourceManager(e) {\n    this._cimResourceManager = e, this._hittestDrawHelper = new l(e);\n  }\n\n  hitTest(e, t, r, i, n) {\n    e = u(e, this._tileInfoView.spatialReference);\n    const h = .5 * i * window.devicePixelRatio * r;\n    f[0] = e - h, f[1] = t - h, f[2] = e + h, f[3] = t + h;\n    const a = .5 * i * (r + d),\n          l = b(this._index, e - a, t - a, e + a, t + a);\n    if (!l || 0 === l.length) return [];\n    const c = [],\n          m = s(),\n          p = s();\n\n    for (const s of l) {\n      const {\n        geometry: e,\n        symbolResource: t\n      } = s;\n      this._getSymbolBounds(m, t, e, p, n), p[3] = p[2] = p[1] = p[0] = 0, o(m, f) && s.graphic.visible && c.push(s);\n    }\n\n    if (0 === c.length) return [];\n    const g = this._hittestDrawHelper,\n          _ = [];\n\n    for (const s of c) {\n      const {\n        geometry: e,\n        symbolResource: t\n      } = s,\n            {\n        hash: r,\n        textInfo: o\n      } = t,\n            h = this._hashToCIM.get(r);\n\n      h && g.hitTest(f, h.symbol, e, o, n, i) && _.push(s);\n    }\n\n    return _.sort(z), _.map(e => e.graphic);\n  }\n\n  getGraphicsData(e, t, r) {\n    const i = this._searchForItems(t);\n\n    if (0 === i.length || 0 === r.length) return [];\n    i.sort((e, t) => e.zorder - t.zorder), i[0].insertAfter = -1;\n\n    for (let l = 1; l < i.length; l++) i[l].insertAfter = i[l - 1].graphic.uid;\n\n    i.sort((e, t) => e.graphic.uid - t.graphic.uid), r.sort((e, t) => e.uid - t.uid);\n    let s,\n        o = 0,\n        n = 0;\n    const h = t.resolution,\n          u = [],\n          a = {\n      originPosition: \"upperLeft\",\n      scale: [h, h],\n      translate: [t.bounds[0], t.bounds[3]]\n    };\n\n    for (const l of r) {\n      for (n = -2; o < i.length;) if (s = i[o], o++, l.uid === s.graphic.uid) {\n        n = s.insertAfter;\n        break;\n      }\n\n      if (!s.geometry || -2 === n) continue;\n      const r = s.getGeometryQuantized(a, t.bounds, this._tileInfoView.spatialReference, h),\n            c = { ...s.graphic.attributes\n      };\n      c[this._uidFieldName] = l.uid, null == s.groupId && (s.groupId = e.createTemplateGroup(s.symbol, null)), u.push({\n        centroid: m.getCentroidQuantized(s, a),\n        geometry: r,\n        attributes: c,\n        symbol: s.symbol,\n        groupId: s.groupId,\n        insertAfter: n,\n        zorder: s.zorder\n      });\n    }\n\n    return u.sort((e, t) => e.zorder - t.zorder), u;\n  }\n\n  queryTileData(e, t) {\n    if (0 === this._graphics.length) return [];\n\n    const {\n      bounds: r,\n      resolution: i\n    } = t,\n          s = this._searchForItems(t),\n          o = [];\n\n    return 0 === s.length || this._createTileGraphics(o, e, s, {\n      originPosition: \"upperLeft\",\n      scale: [i, i],\n      translate: [r[0], r[3]]\n    }, t), o;\n  }\n\n  has(e) {\n    return this._itemByGraphic.has(e);\n  }\n\n  getBounds(e) {\n    const t = this._itemByGraphic.get(e);\n\n    return t ? t.bounds : null;\n  }\n\n  getAllBounds() {\n    return Array.from(this._itemByGraphic.values()).filter(e => e.graphic.visible).map(e => e.bounds);\n  }\n\n  addOrModify(r, i, s) {\n    if (!r || e(i)) return;\n    this.has(r) && this.remove(r), this._onAdd(r);\n\n    const o = [0, 0, 0, 0],\n          n = this._getSymbolBounds(null, i, s, o, 0),\n          h = m.acquire(r, i, s, t(n) ? n : null, o);\n\n    return this._itemByGraphic.set(r, h), s && this._index.insert(h), h.bounds;\n  }\n\n  remove(e) {\n    if (!this._itemByGraphic.has(e)) return;\n\n    this._onRemove(e);\n\n    const t = this._itemByGraphic.get(e);\n\n    t.bounds && this._index.remove(t), this._itemByGraphic.delete(e);\n  }\n\n  updateZ() {\n    const e = this._graphics.items;\n    let t, r;\n\n    for (let i = 0; i < e.length; i++) r = e[i], t = this._itemByGraphic.get(r), t && (t.zorder = i);\n  }\n\n  update(e, r, i) {\n    const s = this._itemByGraphic.get(e);\n\n    s.groupId = null;\n    const o = n(s.bounds);\n\n    this._index.remove(s);\n\n    const h = this._getSymbolBounds(s.bounds, r, i, s.size, 0);\n\n    return t(h) && s.set(e, r, i, h, s.size), i && this._index.insert(s), {\n      oldBounds: o,\n      newBounds: s.bounds\n    };\n  }\n\n  updateLevel(e) {\n    if (this._resolution === e) return;\n    this._resolution = e, this._index.clear();\n    const r = this._itemByGraphic,\n          i = [];\n\n    for (const [s, o] of r) {\n      const e = this._getSymbolBounds(o.bounds, o.symbolResource, o.geometry, o.size, 0);\n\n      o.geometry && t(e) && (o.bounds = e, i.push(o));\n    }\n\n    this._index.load(i);\n  }\n\n  clear() {\n    this._itemByGraphic.clear(), this._index.clear();\n  }\n\n  _createTileGraphics(e, t, r, i, s) {\n    const o = this._uidFieldName,\n          n = this._tileInfoView.spatialReference,\n          {\n      bounds: h,\n      resolution: u\n    } = s;\n    let a, l, c, d;\n    r.sort((e, t) => e.zorder - t.zorder);\n\n    for (let p = 0; p < r.length; p++) {\n      c = r[p], a = c.graphic, l = c.getGeometryQuantized(i, h, n, u), d = 0 === p ? -1 : r[p - 1].graphic.uid;\n      const s = { ...c.graphic.attributes\n      };\n      s[o] = a.uid, null == c.groupId && (c.groupId = t.createTemplateGroup(c.symbol, null)), e.push({\n        centroid: m.getCentroidQuantized(c, i),\n        geometry: l,\n        attributes: s,\n        symbol: c.symbol,\n        groupId: c.groupId,\n        insertAfter: d,\n        zorder: c.zorder\n      });\n    }\n  }\n\n  _searchForItems(e) {\n    const t = this._tileInfoView.spatialReference,\n          r = e.bounds;\n\n    if (t.isWrappable) {\n      const [i, o] = a(t),\n            n = Math.abs(r[2] - o) < _,\n            h = Math.abs(r[0] - i) < _;\n\n      if ((!n || !h) && (n || h)) {\n        const t = e.resolution;\n        let h;\n        h = s(n ? [i, r[1], i + t * d, r[3]] : [o - t * d, r[1], o, r[3]]);\n        const u = b(this._index, r[0], r[1], r[2], r[3]),\n              a = b(this._index, h[0], h[1], h[2], h[3]);\n        return [...new Set([...u, ...a])];\n      }\n    }\n\n    return b(this._index, r[0], r[1], r[2], r[3]);\n  }\n\n  _getSymbolBounds(e, t, i, o, n) {\n    if (!t || !t.symbol || !i) return null;\n\n    if (e || (e = s()), h(e, i), !o || 0 === o[0] && 0 === o[1] && 0 === o[2] && 0 === o[3]) {\n      const {\n        hash: e,\n        textInfo: i\n      } = t,\n            s = this._hashToCIM.get(e);\n\n      if (!s) return null;\n      o || (o = [0, 0, 0, 0]);\n\n      const h = this._inflatedSizeHelper.getSymbolInflateSize(o, s.symbol, this._cimResourceManager, n, i);\n\n      o[0] = r(h[0]), o[1] = r(h[1]), o[2] = r(h[2]), o[3] = r(h[3]);\n    }\n\n    const u = this._resolution,\n          a = c.safeSize(o);\n    return e[0] -= a * u, e[1] -= a * u, e[2] += a * u, e[3] += a * u, e;\n  }\n\n}\n\nconst z = (e, t) => {\n  const r = p(e.graphic),\n        i = p(t.graphic);\n  return r === i ? t.zorder - e.zorder : r - i;\n};\n\nexport { I as default };","map":{"version":3,"sources":["D:/Github/CUSP_DataBase/CUSP_DB/src/main/gis/node_modules/@arcgis/core/views/2d/layers/graphics/GraphicStore.js"],"names":["isNone","e","isSome","t","pt2px","r","i","create","s","intersects","o","clone","n","getBoundsXY","h","normalizeMapX","u","getSpatialReferenceMinMaxX","a","HittestDrawHelper","l","CIMSimbolInflatedSizeHelper","c","m","PIXEL_BUFFER","d","graphicGeometryToNumber","p","g","minX","minY","maxX","maxY","f","_","b","search","y","bounds","I","constructor","_graphics","_onAdd","_onRemove","_hashToCIM","_index","_itemByGraphic","Map","_inflatedSizeHelper","_tileInfoView","_uidFieldName","getClosestInfoForScale","_resolution","getTileResolution","level","setResourceManager","_cimResourceManager","_hittestDrawHelper","hitTest","spatialReference","window","devicePixelRatio","length","geometry","symbolResource","_getSymbolBounds","graphic","visible","push","hash","textInfo","get","symbol","sort","z","map","getGraphicsData","_searchForItems","zorder","insertAfter","uid","resolution","originPosition","scale","translate","getGeometryQuantized","attributes","groupId","createTemplateGroup","centroid","getCentroidQuantized","queryTileData","_createTileGraphics","has","getBounds","getAllBounds","Array","from","values","filter","addOrModify","remove","acquire","set","insert","delete","updateZ","items","update","size","oldBounds","newBounds","updateLevel","clear","load","isWrappable","Math","abs","Set","getSymbolInflateSize","safeSize","default"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport{isNone as e,isSome as t}from\"../../../../core/maybe.js\";import{pt2px as r}from\"../../../../core/screenUtils.js\";import{r as i}from\"../../../../chunks/rbush.js\";import{create as s,intersects as o,clone as n}from\"../../../../geometry/support/aaBoundingRect.js\";import{getBoundsXY as h}from\"../../../../geometry/support/boundsUtils.js\";import{normalizeMapX as u}from\"../../../../geometry/support/normalizeUtils.js\";import{getSpatialReferenceMinMaxX as a}from\"../../../../geometry/support/normalizeUtilsCommon.js\";import{HittestDrawHelper as l}from\"../../../../symbols/cim/CIMSymbolDrawHelper.js\";import{CIMSimbolInflatedSizeHelper as c}from\"../../../../symbols/cim/CIMSymbolHelper.js\";import m from\"./GraphicStoreItem.js\";import{PIXEL_BUFFER as d,graphicGeometryToNumber as p}from\"./graphicsUtils.js\";const g={minX:0,minY:0,maxX:0,maxY:0},f=s(),_=1e-5;function b(e,t,r,i,s){return g.minX=t,g.minY=r,g.maxX=i,g.maxY=s,e.search(g)}function y(e){return{minX:e.bounds[0],minY:e.bounds[1],maxX:e.bounds[2],maxY:e.bounds[3]}}class I{constructor(e,t,r,s,o,n,h){this._graphics=s,this._onAdd=o,this._onRemove=n,this._hashToCIM=h,this._index=i(9,y),this._itemByGraphic=new Map,this._inflatedSizeHelper=new c,this._tileInfoView=e,this._uidFieldName=r;const u=e.getClosestInfoForScale(t);u&&(this._resolution=this._tileInfoView.getTileResolution(u.level))}setResourceManager(e){this._cimResourceManager=e,this._hittestDrawHelper=new l(e)}hitTest(e,t,r,i,n){e=u(e,this._tileInfoView.spatialReference);const h=.5*i*window.devicePixelRatio*r;f[0]=e-h,f[1]=t-h,f[2]=e+h,f[3]=t+h;const a=.5*i*(r+d),l=b(this._index,e-a,t-a,e+a,t+a);if(!l||0===l.length)return[];const c=[],m=s(),p=s();for(const s of l){const{geometry:e,symbolResource:t}=s;this._getSymbolBounds(m,t,e,p,n),p[3]=p[2]=p[1]=p[0]=0,o(m,f)&&s.graphic.visible&&c.push(s)}if(0===c.length)return[];const g=this._hittestDrawHelper,_=[];for(const s of c){const{geometry:e,symbolResource:t}=s,{hash:r,textInfo:o}=t,h=this._hashToCIM.get(r);h&&(g.hitTest(f,h.symbol,e,o,n,i)&&_.push(s))}return _.sort(z),_.map((e=>e.graphic))}getGraphicsData(e,t,r){const i=this._searchForItems(t);if(0===i.length||0===r.length)return[];i.sort(((e,t)=>e.zorder-t.zorder)),i[0].insertAfter=-1;for(let l=1;l<i.length;l++)i[l].insertAfter=i[l-1].graphic.uid;i.sort(((e,t)=>e.graphic.uid-t.graphic.uid)),r.sort(((e,t)=>e.uid-t.uid));let s,o=0,n=0;const h=t.resolution,u=[],a={originPosition:\"upperLeft\",scale:[h,h],translate:[t.bounds[0],t.bounds[3]]};for(const l of r){for(n=-2;o<i.length;)if(s=i[o],o++,l.uid===s.graphic.uid){n=s.insertAfter;break}if(!s.geometry||-2===n)continue;const r=s.getGeometryQuantized(a,t.bounds,this._tileInfoView.spatialReference,h),c={...s.graphic.attributes};c[this._uidFieldName]=l.uid,null==s.groupId&&(s.groupId=e.createTemplateGroup(s.symbol,null)),u.push({centroid:m.getCentroidQuantized(s,a),geometry:r,attributes:c,symbol:s.symbol,groupId:s.groupId,insertAfter:n,zorder:s.zorder})}return u.sort(((e,t)=>e.zorder-t.zorder)),u}queryTileData(e,t){if(0===this._graphics.length)return[];const{bounds:r,resolution:i}=t,s=this._searchForItems(t),o=[];return 0===s.length||this._createTileGraphics(o,e,s,{originPosition:\"upperLeft\",scale:[i,i],translate:[r[0],r[3]]},t),o}has(e){return this._itemByGraphic.has(e)}getBounds(e){const t=this._itemByGraphic.get(e);return t?t.bounds:null}getAllBounds(){return Array.from(this._itemByGraphic.values()).filter((e=>e.graphic.visible)).map((e=>e.bounds))}addOrModify(r,i,s){if(!r||e(i))return;this.has(r)&&this.remove(r),this._onAdd(r);const o=[0,0,0,0],n=this._getSymbolBounds(null,i,s,o,0),h=m.acquire(r,i,s,t(n)?n:null,o);return this._itemByGraphic.set(r,h),s&&this._index.insert(h),h.bounds}remove(e){if(!this._itemByGraphic.has(e))return;this._onRemove(e);const t=this._itemByGraphic.get(e);t.bounds&&this._index.remove(t),this._itemByGraphic.delete(e)}updateZ(){const e=this._graphics.items;let t,r;for(let i=0;i<e.length;i++)r=e[i],t=this._itemByGraphic.get(r),t&&(t.zorder=i)}update(e,r,i){const s=this._itemByGraphic.get(e);s.groupId=null;const o=n(s.bounds);this._index.remove(s);const h=this._getSymbolBounds(s.bounds,r,i,s.size,0);return t(h)&&s.set(e,r,i,h,s.size),i&&this._index.insert(s),{oldBounds:o,newBounds:s.bounds}}updateLevel(e){if(this._resolution===e)return;this._resolution=e,this._index.clear();const r=this._itemByGraphic,i=[];for(const[s,o]of r){const e=this._getSymbolBounds(o.bounds,o.symbolResource,o.geometry,o.size,0);o.geometry&&t(e)&&(o.bounds=e,i.push(o))}this._index.load(i)}clear(){this._itemByGraphic.clear(),this._index.clear()}_createTileGraphics(e,t,r,i,s){const o=this._uidFieldName,n=this._tileInfoView.spatialReference,{bounds:h,resolution:u}=s;let a,l,c,d;r.sort(((e,t)=>e.zorder-t.zorder));for(let p=0;p<r.length;p++){c=r[p],a=c.graphic,l=c.getGeometryQuantized(i,h,n,u),d=0===p?-1:r[p-1].graphic.uid;const s={...c.graphic.attributes};s[o]=a.uid,null==c.groupId&&(c.groupId=t.createTemplateGroup(c.symbol,null)),e.push({centroid:m.getCentroidQuantized(c,i),geometry:l,attributes:s,symbol:c.symbol,groupId:c.groupId,insertAfter:d,zorder:c.zorder})}}_searchForItems(e){const t=this._tileInfoView.spatialReference,r=e.bounds;if(t.isWrappable){const[i,o]=a(t),n=Math.abs(r[2]-o)<_,h=Math.abs(r[0]-i)<_;if((!n||!h)&&(n||h)){const t=e.resolution;let h;h=s(n?[i,r[1],i+t*d,r[3]]:[o-t*d,r[1],o,r[3]]);const u=b(this._index,r[0],r[1],r[2],r[3]),a=b(this._index,h[0],h[1],h[2],h[3]);return[...new Set([...u,...a])]}}return b(this._index,r[0],r[1],r[2],r[3])}_getSymbolBounds(e,t,i,o,n){if(!t||!t.symbol||!i)return null;if(e||(e=s()),h(e,i),!o||0===o[0]&&0===o[1]&&0===o[2]&&0===o[3]){const{hash:e,textInfo:i}=t,s=this._hashToCIM.get(e);if(!s)return null;o||(o=[0,0,0,0]);const h=this._inflatedSizeHelper.getSymbolInflateSize(o,s.symbol,this._cimResourceManager,n,i);o[0]=r(h[0]),o[1]=r(h[1]),o[2]=r(h[2]),o[3]=r(h[3])}const u=this._resolution,a=c.safeSize(o);return e[0]-=a*u,e[1]-=a*u,e[2]+=a*u,e[3]+=a*u,e}}const z=(e,t)=>{const r=p(e.graphic),i=p(t.graphic);return r===i?t.zorder-e.zorder:r-i};export{I as default};\n"]},"metadata":{},"sourceType":"module"}