{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../chunks/tslib.es6.js\";\nimport { toHSV as t } from \"../../core/colorUtils.js\";\nimport { JSONSupport as r } from \"../../core/JSONSupport.js\";\nimport s from \"../../core/Logger.js\";\nimport { unwrap as o, isSome as a } from \"../../core/maybe.js\";\nimport { property as n } from \"../../core/accessorSupport/decorators/property.js\";\nimport \"../../core/arrayUtils.js\";\nimport \"../../core/has.js\";\nimport \"../../core/accessorSupport/ensureType.js\";\nimport { subclass as i } from \"../../core/accessorSupport/decorators/subclass.js\";\nimport l from \"../../layers/support/RasterInfo.js\";\nimport { isValidPixelBlock as u, extractBands as c, stretch as p, colorize as d, remapColor as h, lookupPixels as m, createStretchLUT as f, createColormapLUT as g, createHistogramEqualizationLUT as y, estimateStatisticsHistograms as b } from \"../../layers/support/rasterFunctions/pixelUtils.js\";\nimport { hillshade as S, tintHillshade as v, calculateHillshadeParams as x } from \"../../layers/support/rasterFunctions/surfaceUtils.js\";\nimport { convertColorRampToColormap as k } from \"./colorRampUtils.js\";\nconst R = s.getLogger(\"esri.renderers.support.RasterSymbolizer\");\n\nfunction C(e, t) {\n  const {\n    attributeTable: r,\n    bandCount: s\n  } = e;\n  if (!a(r) || s > 1) return !1;\n\n  if (t) {\n    if (null == r.fields.find(e => e.name.toLowerCase() === t.toLowerCase())) return !1;\n  }\n\n  return !0;\n}\n\nfunction _(e) {\n  return \"elevation\" === e.dataType;\n}\n\nfunction O(e) {\n  const {\n    bandCount: t,\n    colormap: r\n  } = e;\n  return a(r) && r.length && 1 === t;\n}\n\nconst I = {\n  u1: [0, 1],\n  u2: [0, 3],\n  u4: [0, 15],\n  u8: [0, 255],\n  s8: [-128, 127],\n  u16: [0, 65535],\n  s16: [-32768, 32767],\n  u32: [0, 4294967295],\n  s32: [-2147483648, 2147483647],\n  f32: [-34e38, 34e38],\n  f64: [-Number.MAX_VALUE, Number.MAX_VALUE]\n};\nlet L = class extends r {\n  constructor(e) {\n    super(e);\n  }\n\n  bind() {\n    const {\n      rendererJSON: e\n    } = this;\n    if (!e) return {\n      success: !1\n    };\n    let t;\n\n    switch (this.lookup = {\n      rendererJSON: {}\n    }, e.type) {\n      case \"uniqueValue\":\n        t = this._updateUVRenderer(e);\n        break;\n\n      case \"rasterColormap\":\n        t = this._updateColormapRenderer(e);\n        break;\n\n      case \"rasterStretch\":\n        t = this._updateStretchRenderer(e);\n        break;\n\n      case \"classBreaks\":\n        t = this._updateClassBreaksRenderer(e);\n        break;\n\n      case \"rasterShadedRelief\":\n        t = this._updateShadedReliefRenderer(e);\n        break;\n\n      case \"vectorField\":\n        t = this._updateVectorFieldRenderer();\n        break;\n\n      case \"flowRenderer\":\n        t = this._updateFlowRenderer();\n    }\n\n    return t;\n  }\n\n  symbolize(e) {\n    let t = e && e.pixelBlock;\n    if (!V(t)) return t;\n    if (e.simpleStretchParams && \"rasterStretch\" === this.rendererJSON.type) return this.simpleStretch(t, e.simpleStretchParams);\n\n    try {\n      let r;\n\n      switch (t.pixels.length > 3 && (t = c(t, [0, 1, 2])), this.rendererJSON.type) {\n        case \"uniqueValue\":\n        case \"rasterColormap\":\n          r = this._symbolizeColormap(t);\n          break;\n\n        case \"classBreaks\":\n          r = this._symbolizeClassBreaks(t);\n          break;\n\n        case \"rasterStretch\":\n          r = this._symbolizeStretch(t, e.bandIds);\n          break;\n\n        case \"rasterShadedRelief\":\n          {\n            const {\n              extent: s\n            } = e,\n                  o = s.spatialReference.isGeographic,\n                  a = {\n              x: (s.xmax - s.xmin) / t.width,\n              y: (s.ymax - s.ymin) / t.height\n            };\n            r = this._symbolizeShadedRelief(t, {\n              isGCS: o,\n              resolution: a\n            });\n            break;\n          }\n      }\n\n      return r;\n    } catch (r) {\n      return R.error(\"symbolize\", r.message), t;\n    }\n  }\n\n  simpleStretch(e, t) {\n    if (!V(e)) return e;\n\n    try {\n      return e.pixels.length > 3 && (e = c(e, [0, 1, 2])), p(e, t);\n    } catch (r) {\n      return R.error(\"symbolize\", r.message), e;\n    }\n  }\n\n  generateWebGLParameters(e) {\n    if ([\"uniqueValue\", \"rasterColormap\", \"classBreaks\"].indexOf(this.rendererJSON.type) > -1) {\n      var t;\n      const {\n        indexedColormap: e,\n        offset: r\n      } = (null == (t = this.lookup) ? void 0 : t.colormapLut) || {};\n      return {\n        colormap: e,\n        colormapOffset: r,\n        type: \"lut\"\n      };\n    }\n\n    const {\n      pixelBlock: r,\n      isGCS: s,\n      resolution: o,\n      bandIds: a\n    } = e,\n          {\n      rendererJSON: n\n    } = this;\n    return \"rasterStretch\" === n.type ? this._generateStretchWebGLParams(r, n, a) : \"rasterShadedRelief\" === n.type ? this._generateShadedReliefWebGLParams(n, s, o) : \"vectorField\" === n.type ? this._generateVectorFieldWebGLParams(n) : null;\n  }\n\n  _isLUTChanged(e) {\n    if (!this.lookup || !this.lookup.rendererJSON) return !0;\n\n    if (\"colorRamp\" in this.rendererJSON) {\n      const t = this.rendererJSON.colorRamp;\n      return e ? JSON.stringify(t) !== JSON.stringify(this.lookup.rendererJSON.colorRamp) : (this.rendererJSON, this.lookup.rendererJSON, JSON.stringify(this.rendererJSON) !== JSON.stringify(this.lookup.rendererJSON));\n    }\n\n    return JSON.stringify(this.rendererJSON) !== JSON.stringify(this.lookup.rendererJSON);\n  }\n\n  _symbolizeColormap(e) {\n    if (this._isLUTChanged()) {\n      if (!this.bind().success) return e;\n    }\n\n    return d(e, this.lookup.colormapLut);\n  }\n\n  _symbolizeClassBreaks(e) {\n    const t = this.rasterInfo.pixelType,\n          r = [\"u8\", \"u16\", \"s8\", \"s16\"].indexOf(t) > -1;\n\n    if (this._isLUTChanged()) {\n      if (!this.bind().success) return e;\n    }\n\n    return r ? d(e, this.lookup.colormapLut) : h(e, this.lookup.remapLut);\n  }\n\n  _symbolizeStretch(e, t) {\n    const {\n      pixelType: r,\n      bandCount: s\n    } = this.rasterInfo,\n          a = this.rendererJSON,\n          n = [\"u8\", \"u16\", \"s8\", \"s16\"].indexOf(r) > -1;\n    let i, l;\n    const {\n      dra: u\n    } = a,\n          c = a.useGamma ? a.gamma : null;\n\n    if (\"histogramEqualization\" === a.stretchType) {\n      const r = u ? null : this.lookup.histogramLut,\n            s = this._getStretchCutoff(a, e, t, !r),\n            o = p(e, { ...s,\n        gamma: c\n      });\n\n      l = m(o, {\n        lut: u ? s.histogramLut : r,\n        offset: 0\n      });\n    } else if (n) {\n      var h, g;\n\n      if (u) {\n        const s = this._getStretchCutoff(a, e, t);\n\n        i = f({\n          pixelType: r,\n          ...s,\n          gamma: c\n        });\n      } else if (this._isLUTChanged()) {\n        if (!this.bind().success) return e;\n        i = this.lookup ? this.lookup.stretchLut : null;\n      } else i = this.lookup ? this.lookup.stretchLut : null;\n\n      if (!i) return e;\n      s > 1 && (null == t ? void 0 : t.length) === (null == (h = o(e)) ? void 0 : h.pixels.length) && (null == (g = i) ? void 0 : g.lut.length) === s && (i = {\n        lut: t.map(e => i.lut[e]),\n        offset: i.offset\n      }), l = m(e, i);\n    } else {\n      const r = this._getStretchCutoff(a, e, t);\n\n      l = p(e, { ...r,\n        gamma: c\n      });\n    }\n\n    if (a.colorRamp) {\n      if (this._isLUTChanged(!0)) {\n        if (!this.bind().success) return e;\n      }\n\n      l = d(l, this.lookup.colormapLut);\n    }\n\n    return l;\n  }\n\n  _symbolizeShadedRelief(e, t) {\n    var r, s;\n    const a = this.rendererJSON,\n          n = { ...a,\n      ...t\n    },\n          i = S(e, n);\n    if (!a.colorRamp) return i;\n    let l;\n\n    if (this._isLUTChanged(!0)) {\n      if (!this.bind().success) return i;\n      l = this.lookup ? this.lookup.hsvMap : null;\n    } else l = this.lookup ? this.lookup.hsvMap : null;\n\n    if (!l) return i;\n    const u = null != (r = null == (s = o(this.rasterInfo.statistics)) ? void 0 : s[0]) ? r : {\n      min: 0,\n      max: 8e3\n    };\n    return v(i, e, l, u), i;\n  }\n\n  _isVectorFieldData() {\n    const {\n      bandCount: e,\n      dataType: t\n    } = this.rasterInfo;\n    return 2 === e && (\"vector-magdir\" === t || \"vector-uv\" === t);\n  }\n\n  _updateVectorFieldRenderer() {\n    return this._isVectorFieldData() ? {\n      success: !0\n    } : {\n      success: !1,\n      error: `Unsupported data type \"${this.rasterInfo.dataType}\"; VectorFieldRenderer only supports \"vector-magdir\" and \"vector-uv\".`\n    };\n  }\n\n  _updateFlowRenderer() {\n    return this._isVectorFieldData() ? {\n      success: !0\n    } : {\n      success: !1,\n      error: `Unsupported data type \"${this.rasterInfo.dataType}\"; FlowRenderer only supports \"vector-magdir\" and \"vector-uv\".`\n    };\n  }\n\n  _updateUVRenderer(e) {\n    const {\n      bandCount: t,\n      attributeTable: r,\n      pixelType: s\n    } = this.rasterInfo,\n          o = e.field1;\n    if (!o) return {\n      success: !1,\n      error: \"Unsupported renderer; missing UniqueValueRenderer.field.\"\n    };\n    const a = e.defaultSymbol,\n          n = 1 === t && [\"u8\", \"s8\"].includes(s);\n    if (!C(this.rasterInfo, o) && !n) return {\n      success: !1,\n      error: \"Unsupported data; UniqueValueRenderer is only supported on single band data with a valid raster attribute table.\"\n    };\n    const i = [];\n\n    if (r) {\n      const t = r.fields.find(e => \"value\" === e.name.toLowerCase());\n      if (!t) return {\n        success: !1,\n        error: \"Unsupported data; the data's raster attribute table does not have a value field.\"\n      };\n      r.features.forEach(r => {\n        var s;\n        const n = e.uniqueValueInfos.find(e => String(e.value) === String(r.attributes[o])),\n              l = null == n || null == (s = n.symbol) ? void 0 : s.color;\n        l ? i.push([r.attributes[t.name]].concat(l)) : a && i.push([r.attributes[t.name]].concat(a.color));\n      });\n    } else {\n      if (\"value\" !== o.toLowerCase()) return {\n        success: !1,\n        error: 'Unsupported renderer; UniqueValueRenderer.field must be \"Value\" when raster attribute table is not availalbe.'\n      };\n      e.uniqueValueInfos.forEach(e => {\n        var t;\n        const r = null == e || null == (t = e.symbol) ? void 0 : t.color;\n        r ? i.push([parseInt(\"\" + e.value, 10)].concat(r)) : a && i.push([parseInt(\"\" + e.value, 10)].concat(a.color));\n      });\n    }\n\n    if (0 === i.length) return {\n      success: !1,\n      error: \"Invalid UniqueValueRenderer. Cannot find matching records in the raster attribute table.\"\n    };\n    const l = g({\n      colormap: i\n    });\n    return this.lookup = {\n      rendererJSON: e,\n      colormapLut: l\n    }, this.canRenderInWebGL = !0, {\n      success: !0\n    };\n  }\n\n  _updateColormapRenderer(e) {\n    if (!O(this.rasterInfo)) return {\n      success: !1,\n      error: \"Unsupported data; the data source does not have a colormap.\"\n    };\n    const t = e.colormapInfos.map(e => [e.value].concat(e.color)).sort((e, t) => e[0] - t[0]);\n    if (!t || 0 === t.length) return {\n      success: !1,\n      error: \"Unsupported renderer; ColormapRenderer must have meaningful colormapInfos.\"\n    };\n    const r = g({\n      colormap: t\n    });\n    return this.lookup = {\n      rendererJSON: e,\n      colormapLut: r\n    }, this.canRenderInWebGL = !0, {\n      success: !0\n    };\n  }\n\n  _updateShadedReliefRenderer(e) {\n    if (!_(this.rasterInfo)) return {\n      success: !1,\n      error: `Unsupported data type \"${this.rasterInfo.dataType}\"; ShadedReliefRenderer only supports \"elevation\".`\n    };\n\n    if (e.colorRamp) {\n      const r = k(e.colorRamp, 256, !0),\n            s = g({\n        colormap: r\n      }),\n            o = [],\n            a = s.indexedColormap;\n\n      for (let e = 0; e < a.length; e += 4) {\n        const r = t({\n          r: a[e],\n          g: a[e + 1],\n          b: a[e + 2]\n        });\n        o.push([r.h / 60, r.s / 100, 255 * r.v / 100]);\n      }\n\n      this.lookup = {\n        rendererJSON: e,\n        colormapLut: s,\n        hsvMap: o\n      };\n    } else this.lookup = null;\n\n    return this.canRenderInWebGL = !0, {\n      success: !0\n    };\n  }\n\n  _updateClassBreaksRenderer(e) {\n    const t = this.rasterInfo.pixelType,\n          r = [\"u8\", \"u16\", \"s8\", \"s16\"].indexOf(t) > -1,\n          s = e.classBreakInfos;\n    if (null == s || !s.length) return {\n      success: !1,\n      error: \"Unsupported renderer; missing or invalid ClassBreaksRenderer.classBreakInfos.\"\n    };\n    const o = s.sort((e, t) => e.classMaxValue - t.classMaxValue),\n          a = o[o.length - 1];\n    let n = e.minValue;\n\n    if (!r) {\n      const t = [];\n\n      for (let e = 0; e < o.length; e++) {\n        var i;\n        t.push({\n          value: null != (i = o[e].classMinValue) ? i : n,\n          mappedColor: o[e].symbol.color\n        }), n = o[e].classMaxValue;\n      }\n\n      return t.push({\n        value: a.classMaxValue,\n        mappedColor: a.symbol.color\n      }), this.lookup = {\n        rendererJSON: e,\n        remapLut: t\n      }, this.canRenderInWebGL = !1, {\n        success: !0\n      };\n    }\n\n    const l = [];\n    n = Math.floor(e.minValue);\n\n    for (let c = 0; c < o.length; c++) {\n      const e = o[c];\n\n      for (let t = n; t < e.classMaxValue; t++) l.push([t].concat(e.symbol.color));\n\n      n = Math.ceil(e.classMaxValue);\n    }\n\n    a.classMaxValue === n && l.push([a.classMaxValue].concat(a.symbol.color));\n    const u = g({\n      colormap: l,\n      fillUnspecified: !1\n    });\n    return this.lookup = {\n      rendererJSON: e,\n      colormapLut: u\n    }, this.canRenderInWebGL = !0, {\n      success: !0\n    };\n  }\n\n  _isHistogramRequired(e) {\n    return \"percentClip\" === e || \"histogramEqualization\" === e;\n  }\n\n  _isValidRasterStatistics(e) {\n    return a(e) && e.length > 0 && null != e[0].min && null != e[0].max;\n  }\n\n  _updateStretchRenderer(e) {\n    var t;\n    let {\n      stretchType: r,\n      dra: s\n    } = e;\n    if (!(\"none\" === r || null != (t = e.statistics) && t.length || this._isValidRasterStatistics(this.rasterInfo.statistics) || s)) return {\n      success: !1,\n      error: \"Unsupported renderer; StretchRenderer.statistics is required when dynamic range adjustment is not used.\"\n    };\n    const a = o(e.histograms || this.rasterInfo.histograms);\n    !this._isHistogramRequired(e.stretchType) || null != a && a.length || s || (r = \"minMax\");\n    const {\n      gamma: n,\n      useGamma: i,\n      colorRamp: l\n    } = e,\n          u = this.rasterInfo.pixelType,\n          c = !s && [\"u8\", \"u16\", \"s8\", \"s16\"].indexOf(u) > -1;\n\n    if (\"histogramEqualization\" === r) {\n      const t = a.map(e => y(e));\n      this.lookup = {\n        rendererJSON: e,\n        histogramLut: t\n      };\n    } else if (c) {\n      const t = this._getStretchCutoff(e),\n            r = f({\n        pixelType: u,\n        ...t,\n        gamma: i ? n : null\n      });\n\n      this.lookup = {\n        rendererJSON: e,\n        stretchLut: r\n      };\n    }\n\n    if (l) {\n      const t = k(l, 256, !0);\n      this.lookup || (this.lookup = {\n        rendererJSON: e\n      }), this.lookup.colormapLut = g({\n        colormap: t\n      }), this.lookup.rendererJSON = e;\n    }\n\n    return this.canRenderInWebGL = !0, {\n      success: !0\n    };\n  }\n\n  _getStretchCutoff(e) {\n    let t = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n    let r = arguments.length > 2 ? arguments[2] : undefined;\n    let s = arguments.length > 3 ? arguments[3] : undefined;\n    var n, i, l;\n    let u,\n        c,\n        p = e.stretchType;\n    var d;\n    if (e.dra) {\n      if (\"minMax\" === p && a(t) && t.statistics) u = t.statistics.map(e => [e.minValue, e.maxValue, 0, 0]);else {\n        const e = b(t);\n        u = a(e) ? e.statistics : null, c = a(e) ? e.histograms : null;\n      }\n    } else u = (null == (d = e.statistics) ? void 0 : d.length) > 0 ? e.statistics : o(this.rasterInfo.statistics), c = e.histograms || o(this.rasterInfo.histograms);\n    !this._isHistogramRequired(p) || null != (n = c) && n.length || (p = \"minMax\");\n    const h = (null == (i = u) ? void 0 : i.length) || (null == (l = c) ? void 0 : l.length) || this.rasterInfo.bandCount,\n          m = [],\n          f = [];\n\n    let g, S, v, x, k, R, C, _, O, L, V, T;\n\n    switch (u && !Array.isArray(u[0]) && (u = u.map(e => [e.min, e.max, e.avg, e.stddev])), p) {\n      case \"none\":\n        {\n          const e = I[this.rasterInfo.pixelType] || I.f32;\n\n          for (_ = 0; _ < h; _++) m[_] = e[0], f[_] = e[1];\n        }\n        break;\n\n      case \"minMax\":\n        for (_ = 0; _ < h; _++) m[_] = u[_][0], f[_] = u[_][1];\n\n        break;\n\n      case \"standardDeviation\":\n        for (_ = 0; _ < h; _++) m[_] = u[_][2] - e.numberOfStandardDeviations * u[_][3], f[_] = u[_][2] + e.numberOfStandardDeviations * u[_][3], m[_] < u[_][0] && (m[_] = u[_][0]), f[_] > u[_][1] && (f[_] = u[_][1]);\n\n        break;\n\n      case \"histogramEqualization\":\n        for (_ = 0; _ < h; _++) m[_] = c[_].min, f[_] = c[_].max;\n\n        break;\n\n      case \"percentClip\":\n        for (_ = 0; _ < c.length; _++) {\n          for (g = c[_], k = new Uint32Array(g.size), x = [...g.counts], x.length >= 20 && (x[0] = x[1] = x[2] = x[x.length - 1] = x[x.length - 2] = 0), v = 0, S = (g.max - g.min) / g.size, C = -.5 === g.min && 1 === S ? .5 : 0, O = 0; O < g.size; O++) v += x[O], k[O] = v;\n\n          for (R = (e.minPercent || 0) * v / 100, O = 0; O < g.size; O++) if (k[O] > R) {\n            m[_] = g.min + S * (O + C);\n            break;\n          }\n\n          for (R = (1 - (e.maxPercent || 0) / 100) * v, O = g.size - 2; O >= 0; O--) if (k[O] < R) {\n            f[_] = g.min + S * (O + 2 - C);\n            break;\n          }\n        }\n\n        break;\n\n      default:\n        for (_ = 0; _ < h; _++) m[_] = u[_][0], f[_] = u[_][1];\n\n    }\n\n    \"histogramEqualization\" === p ? (V = c[0].size || 256, L = 0, s && (T = c.map(e => y(e)))) : (V = e.max || 255, L = e.min || 0);\n    const N = {\n      minCutOff: m,\n      maxCutOff: f,\n      outMax: V,\n      outMin: L,\n      histogramLut: T\n    };\n    return this._getSelectedBandCutoffs(N, r);\n  }\n\n  _getSelectedBandCutoffs(e, t) {\n    if (null == t || 0 === t.length) return e;\n    const r = Math.max.apply(null, t),\n          {\n      minCutOff: s,\n      maxCutOff: o,\n      outMin: a,\n      outMax: n,\n      histogramLut: i\n    } = e;\n    return s.length === t.length || s.length <= r ? e : {\n      minCutOff: t.map(e => s[e]),\n      maxCutOff: t.map(e => o[e]),\n      histogramLut: i ? t.map(e => i[e]) : null,\n      outMin: a,\n      outMax: n\n    };\n  }\n\n  _generateStretchWebGLParams(e, t, r) {\n    let s = null,\n        o = null;\n    const n = this.lookup && this.lookup.colormapLut;\n    t.colorRamp && n && (s = n.indexedColormap, o = n.offset), \"histogramEqualization\" === t.stretchType && (t = { ...t,\n      stretchType: \"minMax\"\n    });\n\n    const {\n      gamma: i\n    } = t,\n          l = !!(t.useGamma && i && i.some(e => 1 !== e)),\n          {\n      minCutOff: u,\n      maxCutOff: c,\n      outMin: p,\n      outMax: d\n    } = this._getStretchCutoff(t, e, r);\n\n    let h = 0;\n    a(e) && (h = e.getPlaneCount(), 2 === h && ((e = e.clone()).statistics = [e.statistics[0]], e.pixels = [e.pixels[0]]));\n    const m = Math.min(3, (null == r ? void 0 : r.length) || h || this.rasterInfo.bandCount),\n          f = new Float32Array(m),\n          g = s || l ? 1 : 255;\n    let y;\n\n    for (y = 0; y < m; y++) f[y] = (d - p) / (c[y] - u[y]) / g;\n\n    const b = new Float32Array(m);\n    if (l) for (y = 0; y < m; y++) i[y] > 1 ? i[y] > 2 ? b[y] = 6.5 + (i[y] - 2) ** 2.5 : b[y] = 6.5 + 100 * (2 - i[y]) ** 4 : b[y] = 1;\n    return {\n      bandCount: m,\n      outMin: p / g,\n      outMax: d / g,\n      minCutOff: u,\n      maxCutOff: c,\n      factor: f,\n      useGamma: l,\n      gamma: l ? i : [1, 1, 1],\n      gammaCorrection: l ? b : [1, 1, 1],\n      colormap: s,\n      colormapOffset: o,\n      stretchType: t.stretchType,\n      type: \"stretch\"\n    };\n  }\n\n  _generateShadedReliefWebGLParams(e, t, r) {\n    var s, a, n;\n    let i = null,\n        l = null;\n    const u = this.lookup && this.lookup.colormapLut;\n    e.colorRamp && u && (i = u.indexedColormap, l = u.offset);\n    const c = { ...e,\n      isGCS: t,\n      resolution: r\n    },\n          p = x(c),\n          d = null == (s = o(this.rasterInfo.statistics)) ? void 0 : s[0];\n    return { ...p,\n      minValue: null != (a = null == d ? void 0 : d.min) ? a : 0,\n      maxValue: null != (n = null == d ? void 0 : d.max) ? n : 8e3,\n      hillshadeType: \"traditional\" === e.hillshadeType ? 0 : 1,\n      type: \"hillshade\",\n      colormap: i,\n      colormapOffset: l\n    };\n  }\n\n  _generateVectorFieldWebGLParams(e) {\n    var t, r, s, o, n, i, l, u;\n    const {\n      style: c,\n      inputUnit: p,\n      outputUnit: d,\n      visualVariables: h,\n      symbolTileSize: m,\n      flowRepresentation: f\n    } = e;\n    let g;\n    const y = null != (t = null == (r = this.rasterInfo.statistics) ? void 0 : r[0].min) ? t : 0,\n          b = null != (s = null == (o = this.rasterInfo.statistics) ? void 0 : o[0].max) ? s : 50,\n          S = null != (n = null == h ? void 0 : h.find(e => \"sizeInfo\" === e.type)) ? n : {\n      type: \"sizeInfo\",\n      field: \"Magnitude\",\n      maxDataValue: b,\n      maxSize: .8 * m,\n      minDataValue: y,\n      minSize: .2 * m\n    },\n          v = null != (i = S.minDataValue) ? i : y,\n          x = null != (l = S.maxDataValue) ? l : b,\n          k = a(S.maxSize) && a(S.minSize) ? [S.minSize / m, S.maxSize / m] : [.2, .8];\n\n    if (\"wind_speed\" === c) {\n      const e = (k[0] + k[1]) / 2;\n      k[0] = k[1] = e;\n    }\n\n    const R = a(v) && a(x) ? [v, x] : null;\n    if (\"classified_arrow\" === c) if (a(v) && a(x) && a(S)) {\n      g = [];\n      const e = (S.maxDataValue - S.minDataValue) / 5;\n\n      for (let t = 0; t < 6; t++) g.push(S.minDataValue + e * t);\n    } else g = [0, 1e-6, 3.5, 7, 10.5, 14];\n\n    const C = \"flow_to\" === f === (\"ocean_current_kn\" === c || \"ocean_current_m\" === c) ? 0 : Math.PI,\n          _ = null == h ? void 0 : h.find(e => \"rotationInfo\" === e.type);\n\n    return {\n      breakValues: g,\n      dataRange: R,\n      inputUnit: p,\n      outputUnit: d,\n      symbolTileSize: m,\n      symbolPercentRange: k,\n      style: c || \"single_arrow\",\n      rotation: C,\n      rotationType: (null == (u = this.rasterInfo.storageInfo) ? void 0 : u.tileInfo) && \"vector-uv\" === this.rasterInfo.dataType ? \"geographic\" : (null == _ ? void 0 : _.rotationType) || e.rotationType,\n      type: \"vectorField\"\n    };\n  }\n\n};\n\nfunction V(e) {\n  return u(e) && 0 !== e.validPixelCount;\n}\n\ne([n({\n  json: {\n    write: !0\n  }\n})], L.prototype, \"rendererJSON\", void 0), e([n({\n  type: l,\n  json: {\n    write: !0\n  }\n})], L.prototype, \"rasterInfo\", void 0), e([n({\n  json: {\n    write: !0\n  }\n})], L.prototype, \"lookup\", void 0), e([n()], L.prototype, \"canRenderInWebGL\", void 0), L = e([i(\"esri.renderers.support.RasterSymbolizer\")], L);\nconst T = L;\nexport { T as default };","map":{"version":3,"sources":["D:/Github/CUSP_DataBase/CUSP_DB/src/main/gis/node_modules/@arcgis/core/renderers/support/RasterSymbolizer.js"],"names":["_","e","toHSV","t","JSONSupport","r","s","unwrap","o","isSome","a","property","n","subclass","i","l","isValidPixelBlock","u","extractBands","c","stretch","p","colorize","d","remapColor","h","lookupPixels","m","createStretchLUT","f","createColormapLUT","g","createHistogramEqualizationLUT","y","estimateStatisticsHistograms","b","hillshade","S","tintHillshade","v","calculateHillshadeParams","x","convertColorRampToColormap","k","R","getLogger","C","attributeTable","bandCount","fields","find","name","toLowerCase","dataType","O","colormap","length","I","u1","u2","u4","u8","s8","u16","s16","u32","s32","f32","f64","Number","MAX_VALUE","L","constructor","bind","rendererJSON","success","lookup","type","_updateUVRenderer","_updateColormapRenderer","_updateStretchRenderer","_updateClassBreaksRenderer","_updateShadedReliefRenderer","_updateVectorFieldRenderer","_updateFlowRenderer","symbolize","pixelBlock","V","simpleStretchParams","simpleStretch","pixels","_symbolizeColormap","_symbolizeClassBreaks","_symbolizeStretch","bandIds","extent","spatialReference","isGeographic","xmax","xmin","width","ymax","ymin","height","_symbolizeShadedRelief","isGCS","resolution","error","message","generateWebGLParameters","indexOf","indexedColormap","offset","colormapLut","colormapOffset","_generateStretchWebGLParams","_generateShadedReliefWebGLParams","_generateVectorFieldWebGLParams","_isLUTChanged","colorRamp","JSON","stringify","rasterInfo","pixelType","remapLut","dra","useGamma","gamma","stretchType","histogramLut","_getStretchCutoff","lut","stretchLut","map","hsvMap","statistics","min","max","_isVectorFieldData","field1","defaultSymbol","includes","features","forEach","uniqueValueInfos","String","value","attributes","symbol","color","push","concat","parseInt","canRenderInWebGL","colormapInfos","sort","classBreakInfos","classMaxValue","minValue","classMinValue","mappedColor","Math","floor","ceil","fillUnspecified","_isHistogramRequired","_isValidRasterStatistics","histograms","maxValue","T","Array","isArray","avg","stddev","numberOfStandardDeviations","Uint32Array","size","counts","minPercent","maxPercent","N","minCutOff","maxCutOff","outMax","outMin","_getSelectedBandCutoffs","apply","some","getPlaneCount","clone","Float32Array","factor","gammaCorrection","hillshadeType","style","inputUnit","outputUnit","visualVariables","symbolTileSize","flowRepresentation","field","maxDataValue","maxSize","minDataValue","minSize","PI","breakValues","dataRange","symbolPercentRange","rotation","rotationType","storageInfo","tileInfo","validPixelCount","json","write","prototype","default"],"mappings":"AAAA;AACA;AACA;AACA;AACA,SAAOA,CAAC,IAAIC,CAAZ,QAAkB,2BAAlB;AAA8C,SAAOC,KAAK,IAAIC,CAAhB,QAAsB,0BAAtB;AAAiD,SAAOC,WAAW,IAAIC,CAAtB,QAA4B,2BAA5B;AAAwD,OAAOC,CAAP,MAAa,sBAAb;AAAoC,SAAOC,MAAM,IAAIC,CAAjB,EAAmBC,MAAM,IAAIC,CAA7B,QAAmC,qBAAnC;AAAyD,SAAOC,QAAQ,IAAIC,CAAnB,QAAyB,mDAAzB;AAA6E,OAAM,0BAAN;AAAiC,OAAM,mBAAN;AAA0B,OAAM,0CAAN;AAAiD,SAAOC,QAAQ,IAAIC,CAAnB,QAAyB,mDAAzB;AAA6E,OAAOC,CAAP,MAAa,oCAAb;AAAkD,SAAOC,iBAAiB,IAAIC,CAA5B,EAA8BC,YAAY,IAAIC,CAA9C,EAAgDC,OAAO,IAAIC,CAA3D,EAA6DC,QAAQ,IAAIC,CAAzE,EAA2EC,UAAU,IAAIC,CAAzF,EAA2FC,YAAY,IAAIC,CAA3G,EAA6GC,gBAAgB,IAAIC,CAAjI,EAAmIC,iBAAiB,IAAIC,CAAxJ,EAA0JC,8BAA8B,IAAIC,CAA5L,EAA8LC,4BAA4B,IAAIC,CAA9N,QAAoO,oDAApO;AAAyR,SAAOC,SAAS,IAAIC,CAApB,EAAsBC,aAAa,IAAIC,CAAvC,EAAyCC,wBAAwB,IAAIC,CAArE,QAA2E,sDAA3E;AAAkI,SAAOC,0BAA0B,IAAIC,CAArC,QAA2C,qBAA3C;AAAiE,MAAMC,CAAC,GAACtC,CAAC,CAACuC,SAAF,CAAY,yCAAZ,CAAR;;AAA+D,SAASC,CAAT,CAAW7C,CAAX,EAAaE,CAAb,EAAe;AAAC,QAAK;AAAC4C,IAAAA,cAAc,EAAC1C,CAAhB;AAAkB2C,IAAAA,SAAS,EAAC1C;AAA5B,MAA+BL,CAApC;AAAsC,MAAG,CAACS,CAAC,CAACL,CAAD,CAAF,IAAOC,CAAC,GAAC,CAAZ,EAAc,OAAM,CAAC,CAAP;;AAAS,MAAGH,CAAH,EAAK;AAAC,QAAG,QAAME,CAAC,CAAC4C,MAAF,CAASC,IAAT,CAAejD,CAAC,IAAEA,CAAC,CAACkD,IAAF,CAAOC,WAAP,OAAuBjD,CAAC,CAACiD,WAAF,EAAzC,CAAT,EAAoE,OAAM,CAAC,CAAP;AAAS;;AAAA,SAAM,CAAC,CAAP;AAAS;;AAAA,SAASpD,CAAT,CAAWC,CAAX,EAAa;AAAC,SAAM,gBAAcA,CAAC,CAACoD,QAAtB;AAA+B;;AAAA,SAASC,CAAT,CAAWrD,CAAX,EAAa;AAAC,QAAK;AAAC+C,IAAAA,SAAS,EAAC7C,CAAX;AAAaoD,IAAAA,QAAQ,EAAClD;AAAtB,MAAyBJ,CAA9B;AAAgC,SAAOS,CAAC,CAACL,CAAD,CAAD,IAAMA,CAAC,CAACmD,MAAR,IAAgB,MAAIrD,CAA3B;AAA6B;;AAAA,MAAMsD,CAAC,GAAC;AAACC,EAAAA,EAAE,EAAC,CAAC,CAAD,EAAG,CAAH,CAAJ;AAAUC,EAAAA,EAAE,EAAC,CAAC,CAAD,EAAG,CAAH,CAAb;AAAmBC,EAAAA,EAAE,EAAC,CAAC,CAAD,EAAG,EAAH,CAAtB;AAA6BC,EAAAA,EAAE,EAAC,CAAC,CAAD,EAAG,GAAH,CAAhC;AAAwCC,EAAAA,EAAE,EAAC,CAAC,CAAC,GAAF,EAAM,GAAN,CAA3C;AAAsDC,EAAAA,GAAG,EAAC,CAAC,CAAD,EAAG,KAAH,CAA1D;AAAoEC,EAAAA,GAAG,EAAC,CAAC,CAAC,KAAF,EAAQ,KAAR,CAAxE;AAAuFC,EAAAA,GAAG,EAAC,CAAC,CAAD,EAAG,UAAH,CAA3F;AAA0GC,EAAAA,GAAG,EAAC,CAAC,CAAC,UAAF,EAAa,UAAb,CAA9G;AAAuIC,EAAAA,GAAG,EAAC,CAAC,CAAC,KAAF,EAAQ,KAAR,CAA3I;AAA0JC,EAAAA,GAAG,EAAC,CAAC,CAACC,MAAM,CAACC,SAAT,EAAmBD,MAAM,CAACC,SAA1B;AAA9J,CAAR;AAA4M,IAAIC,CAAC,GAAC,cAAclE,CAAd,CAAe;AAACmE,EAAAA,WAAW,CAACvE,CAAD,EAAG;AAAC,UAAMA,CAAN;AAAS;;AAAAwE,EAAAA,IAAI,GAAE;AAAC,UAAK;AAACC,MAAAA,YAAY,EAACzE;AAAd,QAAiB,IAAtB;AAA2B,QAAG,CAACA,CAAJ,EAAM,OAAM;AAAC0E,MAAAA,OAAO,EAAC,CAAC;AAAV,KAAN;AAAmB,QAAIxE,CAAJ;;AAAM,YAAO,KAAKyE,MAAL,GAAY;AAACF,MAAAA,YAAY,EAAC;AAAd,KAAZ,EAA8BzE,CAAC,CAAC4E,IAAvC;AAA6C,WAAI,aAAJ;AAAkB1E,QAAAA,CAAC,GAAC,KAAK2E,iBAAL,CAAuB7E,CAAvB,CAAF;AAA4B;;AAAM,WAAI,gBAAJ;AAAqBE,QAAAA,CAAC,GAAC,KAAK4E,uBAAL,CAA6B9E,CAA7B,CAAF;AAAkC;;AAAM,WAAI,eAAJ;AAAoBE,QAAAA,CAAC,GAAC,KAAK6E,sBAAL,CAA4B/E,CAA5B,CAAF;AAAiC;;AAAM,WAAI,aAAJ;AAAkBE,QAAAA,CAAC,GAAC,KAAK8E,0BAAL,CAAgChF,CAAhC,CAAF;AAAqC;;AAAM,WAAI,oBAAJ;AAAyBE,QAAAA,CAAC,GAAC,KAAK+E,2BAAL,CAAiCjF,CAAjC,CAAF;AAAsC;;AAAM,WAAI,aAAJ;AAAkBE,QAAAA,CAAC,GAAC,KAAKgF,0BAAL,EAAF;AAAoC;;AAAM,WAAI,cAAJ;AAAmBhF,QAAAA,CAAC,GAAC,KAAKiF,mBAAL,EAAF;AAA1a;;AAAuc,WAAOjF,CAAP;AAAS;;AAAAkF,EAAAA,SAAS,CAACpF,CAAD,EAAG;AAAC,QAAIE,CAAC,GAACF,CAAC,IAAEA,CAAC,CAACqF,UAAX;AAAsB,QAAG,CAACC,CAAC,CAACpF,CAAD,CAAL,EAAS,OAAOA,CAAP;AAAS,QAAGF,CAAC,CAACuF,mBAAF,IAAuB,oBAAkB,KAAKd,YAAL,CAAkBG,IAA9D,EAAmE,OAAO,KAAKY,aAAL,CAAmBtF,CAAnB,EAAqBF,CAAC,CAACuF,mBAAvB,CAAP;;AAAmD,QAAG;AAAC,UAAInF,CAAJ;;AAAM,cAAOF,CAAC,CAACuF,MAAF,CAASlC,MAAT,GAAgB,CAAhB,KAAoBrD,CAAC,GAACgB,CAAC,CAAChB,CAAD,EAAG,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,CAAH,CAAvB,GAAoC,KAAKuE,YAAL,CAAkBG,IAA7D;AAAmE,aAAI,aAAJ;AAAkB,aAAI,gBAAJ;AAAqBxE,UAAAA,CAAC,GAAC,KAAKsF,kBAAL,CAAwBxF,CAAxB,CAAF;AAA6B;;AAAM,aAAI,aAAJ;AAAkBE,UAAAA,CAAC,GAAC,KAAKuF,qBAAL,CAA2BzF,CAA3B,CAAF;AAAgC;;AAAM,aAAI,eAAJ;AAAoBE,UAAAA,CAAC,GAAC,KAAKwF,iBAAL,CAAuB1F,CAAvB,EAAyBF,CAAC,CAAC6F,OAA3B,CAAF;AAAsC;;AAAM,aAAI,oBAAJ;AAAyB;AAAC,kBAAK;AAACC,cAAAA,MAAM,EAACzF;AAAR,gBAAWL,CAAhB;AAAA,kBAAkBO,CAAC,GAACF,CAAC,CAAC0F,gBAAF,CAAmBC,YAAvC;AAAA,kBAAoDvF,CAAC,GAAC;AAAC+B,cAAAA,CAAC,EAAC,CAACnC,CAAC,CAAC4F,IAAF,GAAO5F,CAAC,CAAC6F,IAAV,IAAgBhG,CAAC,CAACiG,KAArB;AAA2BnE,cAAAA,CAAC,EAAC,CAAC3B,CAAC,CAAC+F,IAAF,GAAO/F,CAAC,CAACgG,IAAV,IAAgBnG,CAAC,CAACoG;AAA/C,aAAtD;AAA6GlG,YAAAA,CAAC,GAAC,KAAKmG,sBAAL,CAA4BrG,CAA5B,EAA8B;AAACsG,cAAAA,KAAK,EAACjG,CAAP;AAASkG,cAAAA,UAAU,EAAChG;AAApB,aAA9B,CAAF;AAAwD;AAAM;AAA1c;;AAA2c,aAAOL,CAAP;AAAS,KAA9d,CAA8d,OAAMA,CAAN,EAAQ;AAAC,aAAOuC,CAAC,CAAC+D,KAAF,CAAQ,WAAR,EAAoBtG,CAAC,CAACuG,OAAtB,GAA+BzG,CAAtC;AAAwC;AAAC;;AAAAsF,EAAAA,aAAa,CAACxF,CAAD,EAAGE,CAAH,EAAK;AAAC,QAAG,CAACoF,CAAC,CAACtF,CAAD,CAAL,EAAS,OAAOA,CAAP;;AAAS,QAAG;AAAC,aAAOA,CAAC,CAACyF,MAAF,CAASlC,MAAT,GAAgB,CAAhB,KAAoBvD,CAAC,GAACkB,CAAC,CAAClB,CAAD,EAAG,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,CAAH,CAAvB,GAAoCoB,CAAC,CAACpB,CAAD,EAAGE,CAAH,CAA5C;AAAkD,KAAtD,CAAsD,OAAME,CAAN,EAAQ;AAAC,aAAOuC,CAAC,CAAC+D,KAAF,CAAQ,WAAR,EAAoBtG,CAAC,CAACuG,OAAtB,GAA+B3G,CAAtC;AAAwC;AAAC;;AAAA4G,EAAAA,uBAAuB,CAAC5G,CAAD,EAAG;AAAC,QAAG,CAAC,aAAD,EAAe,gBAAf,EAAgC,aAAhC,EAA+C6G,OAA/C,CAAuD,KAAKpC,YAAL,CAAkBG,IAAzE,IAA+E,CAAC,CAAnF,EAAqF;AAAC,UAAI1E,CAAJ;AAAM,YAAK;AAAC4G,QAAAA,eAAe,EAAC9G,CAAjB;AAAmB+G,QAAAA,MAAM,EAAC3G;AAA1B,UAA6B,CAAC,SAAOF,CAAC,GAAC,KAAKyE,MAAd,IAAsB,KAAK,CAA3B,GAA6BzE,CAAC,CAAC8G,WAAhC,KAA8C,EAAhF;AAAmF,aAAM;AAAC1D,QAAAA,QAAQ,EAACtD,CAAV;AAAYiH,QAAAA,cAAc,EAAC7G,CAA3B;AAA6BwE,QAAAA,IAAI,EAAC;AAAlC,OAAN;AAA+C;;AAAA,UAAK;AAACS,MAAAA,UAAU,EAACjF,CAAZ;AAAcoG,MAAAA,KAAK,EAACnG,CAApB;AAAsBoG,MAAAA,UAAU,EAAClG,CAAjC;AAAmCsF,MAAAA,OAAO,EAACpF;AAA3C,QAA8CT,CAAnD;AAAA,UAAqD;AAACyE,MAAAA,YAAY,EAAC9D;AAAd,QAAiB,IAAtE;AAA2E,WAAM,oBAAkBA,CAAC,CAACiE,IAApB,GAAyB,KAAKsC,2BAAL,CAAiC9G,CAAjC,EAAmCO,CAAnC,EAAqCF,CAArC,CAAzB,GAAiE,yBAAuBE,CAAC,CAACiE,IAAzB,GAA8B,KAAKuC,gCAAL,CAAsCxG,CAAtC,EAAwCN,CAAxC,EAA0CE,CAA1C,CAA9B,GAA2E,kBAAgBI,CAAC,CAACiE,IAAlB,GAAuB,KAAKwC,+BAAL,CAAqCzG,CAArC,CAAvB,GAA+D,IAAjN;AAAsN;;AAAA0G,EAAAA,aAAa,CAACrH,CAAD,EAAG;AAAC,QAAG,CAAC,KAAK2E,MAAN,IAAc,CAAC,KAAKA,MAAL,CAAYF,YAA9B,EAA2C,OAAM,CAAC,CAAP;;AAAS,QAAG,eAAc,KAAKA,YAAtB,EAAmC;AAAC,YAAMvE,CAAC,GAAC,KAAKuE,YAAL,CAAkB6C,SAA1B;AAAoC,aAAOtH,CAAC,GAACuH,IAAI,CAACC,SAAL,CAAetH,CAAf,MAAoBqH,IAAI,CAACC,SAAL,CAAe,KAAK7C,MAAL,CAAYF,YAAZ,CAAyB6C,SAAxC,CAArB,IAAyE,KAAK7C,YAAL,EAAkB,KAAKE,MAAL,CAAYF,YAA9B,EAA2C8C,IAAI,CAACC,SAAL,CAAe,KAAK/C,YAApB,MAAoC8C,IAAI,CAACC,SAAL,CAAe,KAAK7C,MAAL,CAAYF,YAA3B,CAAxJ,CAAR;AAA0M;;AAAA,WAAO8C,IAAI,CAACC,SAAL,CAAe,KAAK/C,YAApB,MAAoC8C,IAAI,CAACC,SAAL,CAAe,KAAK7C,MAAL,CAAYF,YAA3B,CAA3C;AAAoF;;AAAAiB,EAAAA,kBAAkB,CAAC1F,CAAD,EAAG;AAAC,QAAG,KAAKqH,aAAL,EAAH,EAAwB;AAAC,UAAG,CAAC,KAAK7C,IAAL,GAAYE,OAAhB,EAAwB,OAAO1E,CAAP;AAAS;;AAAA,WAAOsB,CAAC,CAACtB,CAAD,EAAG,KAAK2E,MAAL,CAAYqC,WAAf,CAAR;AAAoC;;AAAArB,EAAAA,qBAAqB,CAAC3F,CAAD,EAAG;AAAC,UAAME,CAAC,GAAC,KAAKuH,UAAL,CAAgBC,SAAxB;AAAA,UAAkCtH,CAAC,GAAC,CAAC,IAAD,EAAM,KAAN,EAAY,IAAZ,EAAiB,KAAjB,EAAwByG,OAAxB,CAAgC3G,CAAhC,IAAmC,CAAC,CAAxE;;AAA0E,QAAG,KAAKmH,aAAL,EAAH,EAAwB;AAAC,UAAG,CAAC,KAAK7C,IAAL,GAAYE,OAAhB,EAAwB,OAAO1E,CAAP;AAAS;;AAAA,WAAOI,CAAC,GAACkB,CAAC,CAACtB,CAAD,EAAG,KAAK2E,MAAL,CAAYqC,WAAf,CAAF,GAA8BxF,CAAC,CAACxB,CAAD,EAAG,KAAK2E,MAAL,CAAYgD,QAAf,CAAvC;AAAgE;;AAAA/B,EAAAA,iBAAiB,CAAC5F,CAAD,EAAGE,CAAH,EAAK;AAAC,UAAK;AAACwH,MAAAA,SAAS,EAACtH,CAAX;AAAa2C,MAAAA,SAAS,EAAC1C;AAAvB,QAA0B,KAAKoH,UAApC;AAAA,UAA+ChH,CAAC,GAAC,KAAKgE,YAAtD;AAAA,UAAmE9D,CAAC,GAAC,CAAC,IAAD,EAAM,KAAN,EAAY,IAAZ,EAAiB,KAAjB,EAAwBkG,OAAxB,CAAgCzG,CAAhC,IAAmC,CAAC,CAAzG;AAA2G,QAAIS,CAAJ,EAAMC,CAAN;AAAQ,UAAK;AAAC8G,MAAAA,GAAG,EAAC5G;AAAL,QAAQP,CAAb;AAAA,UAAeS,CAAC,GAACT,CAAC,CAACoH,QAAF,GAAWpH,CAAC,CAACqH,KAAb,GAAmB,IAApC;;AAAyC,QAAG,4BAA0BrH,CAAC,CAACsH,WAA/B,EAA2C;AAAC,YAAM3H,CAAC,GAACY,CAAC,GAAC,IAAD,GAAM,KAAK2D,MAAL,CAAYqD,YAA3B;AAAA,YAAwC3H,CAAC,GAAC,KAAK4H,iBAAL,CAAuBxH,CAAvB,EAAyBT,CAAzB,EAA2BE,CAA3B,EAA6B,CAACE,CAA9B,CAA1C;AAAA,YAA2EG,CAAC,GAACa,CAAC,CAACpB,CAAD,EAAG,EAAC,GAAGK,CAAJ;AAAMyH,QAAAA,KAAK,EAAC5G;AAAZ,OAAH,CAA9E;;AAAiGJ,MAAAA,CAAC,GAACY,CAAC,CAACnB,CAAD,EAAG;AAAC2H,QAAAA,GAAG,EAAClH,CAAC,GAACX,CAAC,CAAC2H,YAAH,GAAgB5H,CAAtB;AAAwB2G,QAAAA,MAAM,EAAC;AAA/B,OAAH,CAAH;AAAyC,KAAtL,MAA2L,IAAGpG,CAAH,EAAK;AAAC,UAAIa,CAAJ,EAAMM,CAAN;;AAAQ,UAAGd,CAAH,EAAK;AAAC,cAAMX,CAAC,GAAC,KAAK4H,iBAAL,CAAuBxH,CAAvB,EAAyBT,CAAzB,EAA2BE,CAA3B,CAAR;;AAAsCW,QAAAA,CAAC,GAACe,CAAC,CAAC;AAAC8F,UAAAA,SAAS,EAACtH,CAAX;AAAa,aAAGC,CAAhB;AAAkByH,UAAAA,KAAK,EAAC5G;AAAxB,SAAD,CAAH;AAAgC,OAA5E,MAAiF,IAAG,KAAKmG,aAAL,EAAH,EAAwB;AAAC,YAAG,CAAC,KAAK7C,IAAL,GAAYE,OAAhB,EAAwB,OAAO1E,CAAP;AAASa,QAAAA,CAAC,GAAC,KAAK8D,MAAL,GAAY,KAAKA,MAAL,CAAYwD,UAAxB,GAAmC,IAArC;AAA0C,OAApG,MAAyGtH,CAAC,GAAC,KAAK8D,MAAL,GAAY,KAAKA,MAAL,CAAYwD,UAAxB,GAAmC,IAArC;;AAA0C,UAAG,CAACtH,CAAJ,EAAM,OAAOb,CAAP;AAASK,MAAAA,CAAC,GAAC,CAAF,IAAK,CAAC,QAAMH,CAAN,GAAQ,KAAK,CAAb,GAAeA,CAAC,CAACqD,MAAlB,OAA6B,SAAO/B,CAAC,GAACjB,CAAC,CAACP,CAAD,CAAV,IAAe,KAAK,CAApB,GAAsBwB,CAAC,CAACiE,MAAF,CAASlC,MAA5D,CAAL,IAA0E,CAAC,SAAOzB,CAAC,GAACjB,CAAT,IAAY,KAAK,CAAjB,GAAmBiB,CAAC,CAACoG,GAAF,CAAM3E,MAA1B,MAAoClD,CAA9G,KAAkHQ,CAAC,GAAC;AAACqH,QAAAA,GAAG,EAAChI,CAAC,CAACkI,GAAF,CAAOpI,CAAC,IAAEa,CAAC,CAACqH,GAAF,CAAMlI,CAAN,CAAV,CAAL;AAA0B+G,QAAAA,MAAM,EAAClG,CAAC,CAACkG;AAAnC,OAApH,GAAgKjG,CAAC,GAACY,CAAC,CAAC1B,CAAD,EAAGa,CAAH,CAAnK;AAAyK,KAA1a,MAA8a;AAAC,YAAMT,CAAC,GAAC,KAAK6H,iBAAL,CAAuBxH,CAAvB,EAAyBT,CAAzB,EAA2BE,CAA3B,CAAR;;AAAsCY,MAAAA,CAAC,GAACM,CAAC,CAACpB,CAAD,EAAG,EAAC,GAAGI,CAAJ;AAAM0H,QAAAA,KAAK,EAAC5G;AAAZ,OAAH,CAAH;AAAsB;;AAAA,QAAGT,CAAC,CAAC6G,SAAL,EAAe;AAAC,UAAG,KAAKD,aAAL,CAAmB,CAAC,CAApB,CAAH,EAA0B;AAAC,YAAG,CAAC,KAAK7C,IAAL,GAAYE,OAAhB,EAAwB,OAAO1E,CAAP;AAAS;;AAAAc,MAAAA,CAAC,GAACQ,CAAC,CAACR,CAAD,EAAG,KAAK6D,MAAL,CAAYqC,WAAf,CAAH;AAA+B;;AAAA,WAAOlG,CAAP;AAAS;;AAAAyF,EAAAA,sBAAsB,CAACvG,CAAD,EAAGE,CAAH,EAAK;AAAC,QAAIE,CAAJ,EAAMC,CAAN;AAAQ,UAAMI,CAAC,GAAC,KAAKgE,YAAb;AAAA,UAA0B9D,CAAC,GAAC,EAAC,GAAGF,CAAJ;AAAM,SAAGP;AAAT,KAA5B;AAAA,UAAwCW,CAAC,GAACuB,CAAC,CAACpC,CAAD,EAAGW,CAAH,CAA3C;AAAiD,QAAG,CAACF,CAAC,CAAC6G,SAAN,EAAgB,OAAOzG,CAAP;AAAS,QAAIC,CAAJ;;AAAM,QAAG,KAAKuG,aAAL,CAAmB,CAAC,CAApB,CAAH,EAA0B;AAAC,UAAG,CAAC,KAAK7C,IAAL,GAAYE,OAAhB,EAAwB,OAAO7D,CAAP;AAASC,MAAAA,CAAC,GAAC,KAAK6D,MAAL,GAAY,KAAKA,MAAL,CAAY0D,MAAxB,GAA+B,IAAjC;AAAsC,KAAlG,MAAuGvH,CAAC,GAAC,KAAK6D,MAAL,GAAY,KAAKA,MAAL,CAAY0D,MAAxB,GAA+B,IAAjC;;AAAsC,QAAG,CAACvH,CAAJ,EAAM,OAAOD,CAAP;AAAS,UAAMG,CAAC,GAAC,SAAOZ,CAAC,GAAC,SAAOC,CAAC,GAACE,CAAC,CAAC,KAAKkH,UAAL,CAAgBa,UAAjB,CAAV,IAAwC,KAAK,CAA7C,GAA+CjI,CAAC,CAAC,CAAD,CAAzD,IAA8DD,CAA9D,GAAgE;AAACmI,MAAAA,GAAG,EAAC,CAAL;AAAOC,MAAAA,GAAG,EAAC;AAAX,KAAxE;AAAwF,WAAOlG,CAAC,CAACzB,CAAD,EAAGb,CAAH,EAAKc,CAAL,EAAOE,CAAP,CAAD,EAAWH,CAAlB;AAAoB;;AAAA4H,EAAAA,kBAAkB,GAAE;AAAC,UAAK;AAAC1F,MAAAA,SAAS,EAAC/C,CAAX;AAAaoD,MAAAA,QAAQ,EAAClD;AAAtB,QAAyB,KAAKuH,UAAnC;AAA8C,WAAO,MAAIzH,CAAJ,KAAQ,oBAAkBE,CAAlB,IAAqB,gBAAcA,CAA3C,CAAP;AAAqD;;AAAAgF,EAAAA,0BAA0B,GAAE;AAAC,WAAO,KAAKuD,kBAAL,KAA0B;AAAC/D,MAAAA,OAAO,EAAC,CAAC;AAAV,KAA1B,GAAuC;AAACA,MAAAA,OAAO,EAAC,CAAC,CAAV;AAAYgC,MAAAA,KAAK,EAAE,0BAAyB,KAAKe,UAAL,CAAgBrE,QAAS;AAArE,KAA9C;AAA2L;;AAAA+B,EAAAA,mBAAmB,GAAE;AAAC,WAAO,KAAKsD,kBAAL,KAA0B;AAAC/D,MAAAA,OAAO,EAAC,CAAC;AAAV,KAA1B,GAAuC;AAACA,MAAAA,OAAO,EAAC,CAAC,CAAV;AAAYgC,MAAAA,KAAK,EAAE,0BAAyB,KAAKe,UAAL,CAAgBrE,QAAS;AAArE,KAA9C;AAAoL;;AAAAyB,EAAAA,iBAAiB,CAAC7E,CAAD,EAAG;AAAC,UAAK;AAAC+C,MAAAA,SAAS,EAAC7C,CAAX;AAAa4C,MAAAA,cAAc,EAAC1C,CAA5B;AAA8BsH,MAAAA,SAAS,EAACrH;AAAxC,QAA2C,KAAKoH,UAArD;AAAA,UAAgElH,CAAC,GAACP,CAAC,CAAC0I,MAApE;AAA2E,QAAG,CAACnI,CAAJ,EAAM,OAAM;AAACmE,MAAAA,OAAO,EAAC,CAAC,CAAV;AAAYgC,MAAAA,KAAK,EAAC;AAAlB,KAAN;AAAoF,UAAMjG,CAAC,GAACT,CAAC,CAAC2I,aAAV;AAAA,UAAwBhI,CAAC,GAAC,MAAIT,CAAJ,IAAO,CAAC,IAAD,EAAM,IAAN,EAAY0I,QAAZ,CAAqBvI,CAArB,CAAjC;AAAyD,QAAG,CAACwC,CAAC,CAAC,KAAK4E,UAAN,EAAiBlH,CAAjB,CAAF,IAAuB,CAACI,CAA3B,EAA6B,OAAM;AAAC+D,MAAAA,OAAO,EAAC,CAAC,CAAV;AAAYgC,MAAAA,KAAK,EAAC;AAAlB,KAAN;AAA4I,UAAM7F,CAAC,GAAC,EAAR;;AAAW,QAAGT,CAAH,EAAK;AAAC,YAAMF,CAAC,GAACE,CAAC,CAAC4C,MAAF,CAASC,IAAT,CAAejD,CAAC,IAAE,YAAUA,CAAC,CAACkD,IAAF,CAAOC,WAAP,EAA5B,CAAR;AAA2D,UAAG,CAACjD,CAAJ,EAAM,OAAM;AAACwE,QAAAA,OAAO,EAAC,CAAC,CAAV;AAAYgC,QAAAA,KAAK,EAAC;AAAlB,OAAN;AAA4GtG,MAAAA,CAAC,CAACyI,QAAF,CAAWC,OAAX,CAAoB1I,CAAC,IAAE;AAAC,YAAIC,CAAJ;AAAM,cAAMM,CAAC,GAACX,CAAC,CAAC+I,gBAAF,CAAmB9F,IAAnB,CAAyBjD,CAAC,IAAEgJ,MAAM,CAAChJ,CAAC,CAACiJ,KAAH,CAAN,KAAkBD,MAAM,CAAC5I,CAAC,CAAC8I,UAAF,CAAa3I,CAAb,CAAD,CAApD,CAAR;AAAA,cAAgFO,CAAC,GAAC,QAAMH,CAAN,IAAS,SAAON,CAAC,GAACM,CAAC,CAACwI,MAAX,CAAT,GAA4B,KAAK,CAAjC,GAAmC9I,CAAC,CAAC+I,KAAvH;AAA6HtI,QAAAA,CAAC,GAACD,CAAC,CAACwI,IAAF,CAAO,CAACjJ,CAAC,CAAC8I,UAAF,CAAahJ,CAAC,CAACgD,IAAf,CAAD,EAAuBoG,MAAvB,CAA8BxI,CAA9B,CAAP,CAAD,GAA0CL,CAAC,IAAEI,CAAC,CAACwI,IAAF,CAAO,CAACjJ,CAAC,CAAC8I,UAAF,CAAahJ,CAAC,CAACgD,IAAf,CAAD,EAAuBoG,MAAvB,CAA8B7I,CAAC,CAAC2I,KAAhC,CAAP,CAA9C;AAA6F,OAAxP;AAA2P,KAA9a,MAAkb;AAAC,UAAG,YAAU7I,CAAC,CAAC4C,WAAF,EAAb,EAA6B,OAAM;AAACuB,QAAAA,OAAO,EAAC,CAAC,CAAV;AAAYgC,QAAAA,KAAK,EAAC;AAAlB,OAAN;AAAyI1G,MAAAA,CAAC,CAAC+I,gBAAF,CAAmBD,OAAnB,CAA4B9I,CAAC,IAAE;AAAC,YAAIE,CAAJ;AAAM,cAAME,CAAC,GAAC,QAAMJ,CAAN,IAAS,SAAOE,CAAC,GAACF,CAAC,CAACmJ,MAAX,CAAT,GAA4B,KAAK,CAAjC,GAAmCjJ,CAAC,CAACkJ,KAA7C;AAAmDhJ,QAAAA,CAAC,GAACS,CAAC,CAACwI,IAAF,CAAO,CAACE,QAAQ,CAAC,KAAGvJ,CAAC,CAACiJ,KAAN,EAAY,EAAZ,CAAT,EAA0BK,MAA1B,CAAiClJ,CAAjC,CAAP,CAAD,GAA6CK,CAAC,IAAEI,CAAC,CAACwI,IAAF,CAAO,CAACE,QAAQ,CAAC,KAAGvJ,CAAC,CAACiJ,KAAN,EAAY,EAAZ,CAAT,EAA0BK,MAA1B,CAAiC7I,CAAC,CAAC2I,KAAnC,CAAP,CAAjD;AAAmG,OAA5L;AAA+L;;AAAA,QAAG,MAAIvI,CAAC,CAAC0C,MAAT,EAAgB,OAAM;AAACmB,MAAAA,OAAO,EAAC,CAAC,CAAV;AAAYgC,MAAAA,KAAK,EAAC;AAAlB,KAAN;AAAoH,UAAM5F,CAAC,GAACgB,CAAC,CAAC;AAACwB,MAAAA,QAAQ,EAACzC;AAAV,KAAD,CAAT;AAAwB,WAAO,KAAK8D,MAAL,GAAY;AAACF,MAAAA,YAAY,EAACzE,CAAd;AAAgBgH,MAAAA,WAAW,EAAClG;AAA5B,KAAZ,EAA2C,KAAK0I,gBAAL,GAAsB,CAAC,CAAlE,EAAoE;AAAC9E,MAAAA,OAAO,EAAC,CAAC;AAAV,KAA3E;AAAwF;;AAAAI,EAAAA,uBAAuB,CAAC9E,CAAD,EAAG;AAAC,QAAG,CAACqD,CAAC,CAAC,KAAKoE,UAAN,CAAL,EAAuB,OAAM;AAAC/C,MAAAA,OAAO,EAAC,CAAC,CAAV;AAAYgC,MAAAA,KAAK,EAAC;AAAlB,KAAN;AAAuF,UAAMxG,CAAC,GAACF,CAAC,CAACyJ,aAAF,CAAgBrB,GAAhB,CAAqBpI,CAAC,IAAE,CAACA,CAAC,CAACiJ,KAAH,EAAUK,MAAV,CAAiBtJ,CAAC,CAACoJ,KAAnB,CAAxB,EAAoDM,IAApD,CAA0D,CAAC1J,CAAD,EAAGE,CAAH,KAAOF,CAAC,CAAC,CAAD,CAAD,GAAKE,CAAC,CAAC,CAAD,CAAvE,CAAR;AAAqF,QAAG,CAACA,CAAD,IAAI,MAAIA,CAAC,CAACqD,MAAb,EAAoB,OAAM;AAACmB,MAAAA,OAAO,EAAC,CAAC,CAAV;AAAYgC,MAAAA,KAAK,EAAC;AAAlB,KAAN;AAAsG,UAAMtG,CAAC,GAAC0B,CAAC,CAAC;AAACwB,MAAAA,QAAQ,EAACpD;AAAV,KAAD,CAAT;AAAwB,WAAO,KAAKyE,MAAL,GAAY;AAACF,MAAAA,YAAY,EAACzE,CAAd;AAAgBgH,MAAAA,WAAW,EAAC5G;AAA5B,KAAZ,EAA2C,KAAKoJ,gBAAL,GAAsB,CAAC,CAAlE,EAAoE;AAAC9E,MAAAA,OAAO,EAAC,CAAC;AAAV,KAA3E;AAAwF;;AAAAO,EAAAA,2BAA2B,CAACjF,CAAD,EAAG;AAAC,QAAG,CAACD,CAAC,CAAC,KAAK0H,UAAN,CAAL,EAAuB,OAAM;AAAC/C,MAAAA,OAAO,EAAC,CAAC,CAAV;AAAYgC,MAAAA,KAAK,EAAE,0BAAyB,KAAKe,UAAL,CAAgBrE,QAAS;AAArE,KAAN;;AAAgI,QAAGpD,CAAC,CAACsH,SAAL,EAAe;AAAC,YAAMlH,CAAC,GAACsC,CAAC,CAAC1C,CAAC,CAACsH,SAAH,EAAa,GAAb,EAAiB,CAAC,CAAlB,CAAT;AAAA,YAA8BjH,CAAC,GAACyB,CAAC,CAAC;AAACwB,QAAAA,QAAQ,EAAClD;AAAV,OAAD,CAAjC;AAAA,YAAgDG,CAAC,GAAC,EAAlD;AAAA,YAAqDE,CAAC,GAACJ,CAAC,CAACyG,eAAzD;;AAAyE,WAAI,IAAI9G,CAAC,GAAC,CAAV,EAAYA,CAAC,GAACS,CAAC,CAAC8C,MAAhB,EAAuBvD,CAAC,IAAE,CAA1B,EAA4B;AAAC,cAAMI,CAAC,GAACF,CAAC,CAAC;AAACE,UAAAA,CAAC,EAACK,CAAC,CAACT,CAAD,CAAJ;AAAQ8B,UAAAA,CAAC,EAACrB,CAAC,CAACT,CAAC,GAAC,CAAH,CAAX;AAAiBkC,UAAAA,CAAC,EAACzB,CAAC,CAACT,CAAC,GAAC,CAAH;AAApB,SAAD,CAAT;AAAsCO,QAAAA,CAAC,CAAC8I,IAAF,CAAO,CAACjJ,CAAC,CAACoB,CAAF,GAAI,EAAL,EAAQpB,CAAC,CAACC,CAAF,GAAI,GAAZ,EAAgB,MAAID,CAAC,CAACkC,CAAN,GAAQ,GAAxB,CAAP;AAAqC;;AAAA,WAAKqC,MAAL,GAAY;AAACF,QAAAA,YAAY,EAACzE,CAAd;AAAgBgH,QAAAA,WAAW,EAAC3G,CAA5B;AAA8BgI,QAAAA,MAAM,EAAC9H;AAArC,OAAZ;AAAoD,KAArP,MAA0P,KAAKoE,MAAL,GAAY,IAAZ;;AAAiB,WAAO,KAAK6E,gBAAL,GAAsB,CAAC,CAAvB,EAAyB;AAAC9E,MAAAA,OAAO,EAAC,CAAC;AAAV,KAAhC;AAA6C;;AAAAM,EAAAA,0BAA0B,CAAChF,CAAD,EAAG;AAAC,UAAME,CAAC,GAAC,KAAKuH,UAAL,CAAgBC,SAAxB;AAAA,UAAkCtH,CAAC,GAAC,CAAC,IAAD,EAAM,KAAN,EAAY,IAAZ,EAAiB,KAAjB,EAAwByG,OAAxB,CAAgC3G,CAAhC,IAAmC,CAAC,CAAxE;AAAA,UAA0EG,CAAC,GAACL,CAAC,CAAC2J,eAA9E;AAA8F,QAAG,QAAMtJ,CAAN,IAAS,CAACA,CAAC,CAACkD,MAAf,EAAsB,OAAM;AAACmB,MAAAA,OAAO,EAAC,CAAC,CAAV;AAAYgC,MAAAA,KAAK,EAAC;AAAlB,KAAN;AAAyG,UAAMnG,CAAC,GAACF,CAAC,CAACqJ,IAAF,CAAQ,CAAC1J,CAAD,EAAGE,CAAH,KAAOF,CAAC,CAAC4J,aAAF,GAAgB1J,CAAC,CAAC0J,aAAjC,CAAR;AAAA,UAAyDnJ,CAAC,GAACF,CAAC,CAACA,CAAC,CAACgD,MAAF,GAAS,CAAV,CAA5D;AAAyE,QAAI5C,CAAC,GAACX,CAAC,CAAC6J,QAAR;;AAAiB,QAAG,CAACzJ,CAAJ,EAAM;AAAC,YAAMF,CAAC,GAAC,EAAR;;AAAW,WAAI,IAAIF,CAAC,GAAC,CAAV,EAAYA,CAAC,GAACO,CAAC,CAACgD,MAAhB,EAAuBvD,CAAC,EAAxB,EAA2B;AAAC,YAAIa,CAAJ;AAAMX,QAAAA,CAAC,CAACmJ,IAAF,CAAO;AAACJ,UAAAA,KAAK,EAAC,SAAOpI,CAAC,GAACN,CAAC,CAACP,CAAD,CAAD,CAAK8J,aAAd,IAA6BjJ,CAA7B,GAA+BF,CAAtC;AAAwCoJ,UAAAA,WAAW,EAACxJ,CAAC,CAACP,CAAD,CAAD,CAAKmJ,MAAL,CAAYC;AAAhE,SAAP,GAA+EzI,CAAC,GAACJ,CAAC,CAACP,CAAD,CAAD,CAAK4J,aAAtF;AAAoG;;AAAA,aAAO1J,CAAC,CAACmJ,IAAF,CAAO;AAACJ,QAAAA,KAAK,EAACxI,CAAC,CAACmJ,aAAT;AAAuBG,QAAAA,WAAW,EAACtJ,CAAC,CAAC0I,MAAF,CAASC;AAA5C,OAAP,GAA2D,KAAKzE,MAAL,GAAY;AAACF,QAAAA,YAAY,EAACzE,CAAd;AAAgB2H,QAAAA,QAAQ,EAACzH;AAAzB,OAAvE,EAAmG,KAAKsJ,gBAAL,GAAsB,CAAC,CAA1H,EAA4H;AAAC9E,QAAAA,OAAO,EAAC,CAAC;AAAV,OAAnI;AAAgJ;;AAAA,UAAM5D,CAAC,GAAC,EAAR;AAAWH,IAAAA,CAAC,GAACqJ,IAAI,CAACC,KAAL,CAAWjK,CAAC,CAAC6J,QAAb,CAAF;;AAAyB,SAAI,IAAI3I,CAAC,GAAC,CAAV,EAAYA,CAAC,GAACX,CAAC,CAACgD,MAAhB,EAAuBrC,CAAC,EAAxB,EAA2B;AAAC,YAAMlB,CAAC,GAACO,CAAC,CAACW,CAAD,CAAT;;AAAa,WAAI,IAAIhB,CAAC,GAACS,CAAV,EAAYT,CAAC,GAACF,CAAC,CAAC4J,aAAhB,EAA8B1J,CAAC,EAA/B,EAAkCY,CAAC,CAACuI,IAAF,CAAO,CAACnJ,CAAD,EAAIoJ,MAAJ,CAAWtJ,CAAC,CAACmJ,MAAF,CAASC,KAApB,CAAP;;AAAmCzI,MAAAA,CAAC,GAACqJ,IAAI,CAACE,IAAL,CAAUlK,CAAC,CAAC4J,aAAZ,CAAF;AAA6B;;AAAAnJ,IAAAA,CAAC,CAACmJ,aAAF,KAAkBjJ,CAAlB,IAAqBG,CAAC,CAACuI,IAAF,CAAO,CAAC5I,CAAC,CAACmJ,aAAH,EAAkBN,MAAlB,CAAyB7I,CAAC,CAAC0I,MAAF,CAASC,KAAlC,CAAP,CAArB;AAAsE,UAAMpI,CAAC,GAACc,CAAC,CAAC;AAACwB,MAAAA,QAAQ,EAACxC,CAAV;AAAYqJ,MAAAA,eAAe,EAAC,CAAC;AAA7B,KAAD,CAAT;AAA2C,WAAO,KAAKxF,MAAL,GAAY;AAACF,MAAAA,YAAY,EAACzE,CAAd;AAAgBgH,MAAAA,WAAW,EAAChG;AAA5B,KAAZ,EAA2C,KAAKwI,gBAAL,GAAsB,CAAC,CAAlE,EAAoE;AAAC9E,MAAAA,OAAO,EAAC,CAAC;AAAV,KAA3E;AAAwF;;AAAA0F,EAAAA,oBAAoB,CAACpK,CAAD,EAAG;AAAC,WAAM,kBAAgBA,CAAhB,IAAmB,4BAA0BA,CAAnD;AAAqD;;AAAAqK,EAAAA,wBAAwB,CAACrK,CAAD,EAAG;AAAC,WAAOS,CAAC,CAACT,CAAD,CAAD,IAAMA,CAAC,CAACuD,MAAF,GAAS,CAAf,IAAkB,QAAMvD,CAAC,CAAC,CAAD,CAAD,CAAKuI,GAA7B,IAAkC,QAAMvI,CAAC,CAAC,CAAD,CAAD,CAAKwI,GAApD;AAAwD;;AAAAzD,EAAAA,sBAAsB,CAAC/E,CAAD,EAAG;AAAC,QAAIE,CAAJ;AAAM,QAAG;AAAC6H,MAAAA,WAAW,EAAC3H,CAAb;AAAewH,MAAAA,GAAG,EAACvH;AAAnB,QAAsBL,CAAzB;AAA2B,QAAG,EAAE,WAASI,CAAT,IAAY,SAAOF,CAAC,GAACF,CAAC,CAACsI,UAAX,KAAwBpI,CAAC,CAACqD,MAAtC,IAA8C,KAAK8G,wBAAL,CAA8B,KAAK5C,UAAL,CAAgBa,UAA9C,CAA9C,IAAyGjI,CAA3G,CAAH,EAAiH,OAAM;AAACqE,MAAAA,OAAO,EAAC,CAAC,CAAV;AAAYgC,MAAAA,KAAK,EAAC;AAAlB,KAAN;AAAmI,UAAMjG,CAAC,GAACF,CAAC,CAACP,CAAC,CAACsK,UAAF,IAAc,KAAK7C,UAAL,CAAgB6C,UAA/B,CAAT;AAAoD,KAAC,KAAKF,oBAAL,CAA0BpK,CAAC,CAAC+H,WAA5B,CAAD,IAA2C,QAAMtH,CAAN,IAASA,CAAC,CAAC8C,MAAtD,IAA8DlD,CAA9D,KAAkED,CAAC,GAAC,QAApE;AAA8E,UAAK;AAAC0H,MAAAA,KAAK,EAACnH,CAAP;AAASkH,MAAAA,QAAQ,EAAChH,CAAlB;AAAoByG,MAAAA,SAAS,EAACxG;AAA9B,QAAiCd,CAAtC;AAAA,UAAwCgB,CAAC,GAAC,KAAKyG,UAAL,CAAgBC,SAA1D;AAAA,UAAoExG,CAAC,GAAC,CAACb,CAAD,IAAI,CAAC,IAAD,EAAM,KAAN,EAAY,IAAZ,EAAiB,KAAjB,EAAwBwG,OAAxB,CAAgC7F,CAAhC,IAAmC,CAAC,CAA9G;;AAAgH,QAAG,4BAA0BZ,CAA7B,EAA+B;AAAC,YAAMF,CAAC,GAACO,CAAC,CAAC2H,GAAF,CAAOpI,CAAC,IAAEgC,CAAC,CAAChC,CAAD,CAAX,CAAR;AAAyB,WAAK2E,MAAL,GAAY;AAACF,QAAAA,YAAY,EAACzE,CAAd;AAAgBgI,QAAAA,YAAY,EAAC9H;AAA7B,OAAZ;AAA4C,KAArG,MAA0G,IAAGgB,CAAH,EAAK;AAAC,YAAMhB,CAAC,GAAC,KAAK+H,iBAAL,CAAuBjI,CAAvB,CAAR;AAAA,YAAkCI,CAAC,GAACwB,CAAC,CAAC;AAAC8F,QAAAA,SAAS,EAAC1G,CAAX;AAAa,WAAGd,CAAhB;AAAkB4H,QAAAA,KAAK,EAACjH,CAAC,GAACF,CAAD,GAAG;AAA5B,OAAD,CAArC;;AAAyE,WAAKgE,MAAL,GAAY;AAACF,QAAAA,YAAY,EAACzE,CAAd;AAAgBmI,QAAAA,UAAU,EAAC/H;AAA3B,OAAZ;AAA0C;;AAAA,QAAGU,CAAH,EAAK;AAAC,YAAMZ,CAAC,GAACwC,CAAC,CAAC5B,CAAD,EAAG,GAAH,EAAO,CAAC,CAAR,CAAT;AAAoB,WAAK6D,MAAL,KAAc,KAAKA,MAAL,GAAY;AAACF,QAAAA,YAAY,EAACzE;AAAd,OAA1B,GAA4C,KAAK2E,MAAL,CAAYqC,WAAZ,GAAwBlF,CAAC,CAAC;AAACwB,QAAAA,QAAQ,EAACpD;AAAV,OAAD,CAArE,EAAoF,KAAKyE,MAAL,CAAYF,YAAZ,GAAyBzE,CAA7G;AAA+G;;AAAA,WAAO,KAAKwJ,gBAAL,GAAsB,CAAC,CAAvB,EAAyB;AAAC9E,MAAAA,OAAO,EAAC,CAAC;AAAV,KAAhC;AAA6C;;AAAAuD,EAAAA,iBAAiB,CAACjI,CAAD,EAAc;AAAA,QAAXE,CAAW,uEAAT,IAAS;AAAA,QAAJE,CAAI;AAAA,QAAFC,CAAE;AAAC,QAAIM,CAAJ,EAAME,CAAN,EAAQC,CAAR;AAAU,QAAIE,CAAJ;AAAA,QAAME,CAAN;AAAA,QAAQE,CAAC,GAACpB,CAAC,CAAC+H,WAAZ;AAAwB,QAAIzG,CAAJ;AAAM,QAAGtB,CAAC,CAAC4H,GAAL;AAAS,UAAG,aAAWxG,CAAX,IAAcX,CAAC,CAACP,CAAD,CAAf,IAAoBA,CAAC,CAACoI,UAAzB,EAAoCtH,CAAC,GAACd,CAAC,CAACoI,UAAF,CAAaF,GAAb,CAAkBpI,CAAC,IAAE,CAACA,CAAC,CAAC6J,QAAH,EAAY7J,CAAC,CAACuK,QAAd,EAAuB,CAAvB,EAAyB,CAAzB,CAArB,CAAF,CAApC,KAA6F;AAAC,cAAMvK,CAAC,GAACkC,CAAC,CAAChC,CAAD,CAAT;AAAac,QAAAA,CAAC,GAACP,CAAC,CAACT,CAAD,CAAD,GAAKA,CAAC,CAACsI,UAAP,GAAkB,IAApB,EAAyBpH,CAAC,GAACT,CAAC,CAACT,CAAD,CAAD,GAAKA,CAAC,CAACsK,UAAP,GAAkB,IAA7C;AAAkD;AAAtK,WAA2KtJ,CAAC,GAAC,CAAC,SAAOM,CAAC,GAACtB,CAAC,CAACsI,UAAX,IAAuB,KAAK,CAA5B,GAA8BhH,CAAC,CAACiC,MAAjC,IAAyC,CAAzC,GAA2CvD,CAAC,CAACsI,UAA7C,GAAwD/H,CAAC,CAAC,KAAKkH,UAAL,CAAgBa,UAAjB,CAA3D,EAAwFpH,CAAC,GAAClB,CAAC,CAACsK,UAAF,IAAc/J,CAAC,CAAC,KAAKkH,UAAL,CAAgB6C,UAAjB,CAAzG;AAAsI,KAAC,KAAKF,oBAAL,CAA0BhJ,CAA1B,CAAD,IAA+B,SAAOT,CAAC,GAACO,CAAT,KAAaP,CAAC,CAAC4C,MAA9C,KAAuDnC,CAAC,GAAC,QAAzD;AAAmE,UAAMI,CAAC,GAAC,CAAC,SAAOX,CAAC,GAACG,CAAT,IAAY,KAAK,CAAjB,GAAmBH,CAAC,CAAC0C,MAAtB,MAAgC,SAAOzC,CAAC,GAACI,CAAT,IAAY,KAAK,CAAjB,GAAmBJ,CAAC,CAACyC,MAArD,KAA8D,KAAKkE,UAAL,CAAgB1E,SAAtF;AAAA,UAAgGrB,CAAC,GAAC,EAAlG;AAAA,UAAqGE,CAAC,GAAC,EAAvG;;AAA0G,QAAIE,CAAJ,EAAMM,CAAN,EAAQE,CAAR,EAAUE,CAAV,EAAYE,CAAZ,EAAcC,CAAd,EAAgBE,CAAhB,EAAkB9C,CAAlB,EAAoBsD,CAApB,EAAsBiB,CAAtB,EAAwBgB,CAAxB,EAA0BkF,CAA1B;;AAA4B,YAAOxJ,CAAC,IAAE,CAACyJ,KAAK,CAACC,OAAN,CAAc1J,CAAC,CAAC,CAAD,CAAf,CAAJ,KAA0BA,CAAC,GAACA,CAAC,CAACoH,GAAF,CAAOpI,CAAC,IAAE,CAACA,CAAC,CAACuI,GAAH,EAAOvI,CAAC,CAACwI,GAAT,EAAaxI,CAAC,CAAC2K,GAAf,EAAmB3K,CAAC,CAAC4K,MAArB,CAAV,CAA5B,GAAsExJ,CAA7E;AAAgF,WAAI,MAAJ;AAAW;AAAC,gBAAMpB,CAAC,GAACwD,CAAC,CAAC,KAAKiE,UAAL,CAAgBC,SAAjB,CAAD,IAA8BlE,CAAC,CAACU,GAAxC;;AAA4C,eAAInE,CAAC,GAAC,CAAN,EAAQA,CAAC,GAACyB,CAAV,EAAYzB,CAAC,EAAb,EAAgB2B,CAAC,CAAC3B,CAAD,CAAD,GAAKC,CAAC,CAAC,CAAD,CAAN,EAAU4B,CAAC,CAAC7B,CAAD,CAAD,GAAKC,CAAC,CAAC,CAAD,CAAhB;AAAoB;AAAA;;AAAM,WAAI,QAAJ;AAAa,aAAID,CAAC,GAAC,CAAN,EAAQA,CAAC,GAACyB,CAAV,EAAYzB,CAAC,EAAb,EAAgB2B,CAAC,CAAC3B,CAAD,CAAD,GAAKiB,CAAC,CAACjB,CAAD,CAAD,CAAK,CAAL,CAAL,EAAa6B,CAAC,CAAC7B,CAAD,CAAD,GAAKiB,CAAC,CAACjB,CAAD,CAAD,CAAK,CAAL,CAAlB;;AAA0B;;AAAM,WAAI,mBAAJ;AAAwB,aAAIA,CAAC,GAAC,CAAN,EAAQA,CAAC,GAACyB,CAAV,EAAYzB,CAAC,EAAb,EAAgB2B,CAAC,CAAC3B,CAAD,CAAD,GAAKiB,CAAC,CAACjB,CAAD,CAAD,CAAK,CAAL,IAAQC,CAAC,CAAC6K,0BAAF,GAA6B7J,CAAC,CAACjB,CAAD,CAAD,CAAK,CAAL,CAA1C,EAAkD6B,CAAC,CAAC7B,CAAD,CAAD,GAAKiB,CAAC,CAACjB,CAAD,CAAD,CAAK,CAAL,IAAQC,CAAC,CAAC6K,0BAAF,GAA6B7J,CAAC,CAACjB,CAAD,CAAD,CAAK,CAAL,CAA5F,EAAoG2B,CAAC,CAAC3B,CAAD,CAAD,GAAKiB,CAAC,CAACjB,CAAD,CAAD,CAAK,CAAL,CAAL,KAAe2B,CAAC,CAAC3B,CAAD,CAAD,GAAKiB,CAAC,CAACjB,CAAD,CAAD,CAAK,CAAL,CAApB,CAApG,EAAiI6B,CAAC,CAAC7B,CAAD,CAAD,GAAKiB,CAAC,CAACjB,CAAD,CAAD,CAAK,CAAL,CAAL,KAAe6B,CAAC,CAAC7B,CAAD,CAAD,GAAKiB,CAAC,CAACjB,CAAD,CAAD,CAAK,CAAL,CAApB,CAAjI;;AAA8J;;AAAM,WAAI,uBAAJ;AAA4B,aAAIA,CAAC,GAAC,CAAN,EAAQA,CAAC,GAACyB,CAAV,EAAYzB,CAAC,EAAb,EAAgB2B,CAAC,CAAC3B,CAAD,CAAD,GAAKmB,CAAC,CAACnB,CAAD,CAAD,CAAKwI,GAAV,EAAc3G,CAAC,CAAC7B,CAAD,CAAD,GAAKmB,CAAC,CAACnB,CAAD,CAAD,CAAKyI,GAAxB;;AAA4B;;AAAM,WAAI,aAAJ;AAAkB,aAAIzI,CAAC,GAAC,CAAN,EAAQA,CAAC,GAACmB,CAAC,CAACqC,MAAZ,EAAmBxD,CAAC,EAApB,EAAuB;AAAC,eAAI+B,CAAC,GAACZ,CAAC,CAACnB,CAAD,CAAH,EAAO2C,CAAC,GAAC,IAAIoI,WAAJ,CAAgBhJ,CAAC,CAACiJ,IAAlB,CAAT,EAAiCvI,CAAC,GAAC,CAAC,GAAGV,CAAC,CAACkJ,MAAN,CAAnC,EAAiDxI,CAAC,CAACe,MAAF,IAAU,EAAV,KAAef,CAAC,CAAC,CAAD,CAAD,GAAKA,CAAC,CAAC,CAAD,CAAD,GAAKA,CAAC,CAAC,CAAD,CAAD,GAAKA,CAAC,CAACA,CAAC,CAACe,MAAF,GAAS,CAAV,CAAD,GAAcf,CAAC,CAACA,CAAC,CAACe,MAAF,GAAS,CAAV,CAAD,GAAc,CAA1D,CAAjD,EAA8GjB,CAAC,GAAC,CAAhH,EAAkHF,CAAC,GAAC,CAACN,CAAC,CAAC0G,GAAF,GAAM1G,CAAC,CAACyG,GAAT,IAAczG,CAAC,CAACiJ,IAApI,EAAyIlI,CAAC,GAAC,CAAC,EAAD,KAAMf,CAAC,CAACyG,GAAR,IAAa,MAAInG,CAAjB,GAAmB,EAAnB,GAAsB,CAAjK,EAAmKiB,CAAC,GAAC,CAAzK,EAA2KA,CAAC,GAACvB,CAAC,CAACiJ,IAA/K,EAAoL1H,CAAC,EAArL,EAAwLf,CAAC,IAAEE,CAAC,CAACa,CAAD,CAAJ,EAAQX,CAAC,CAACW,CAAD,CAAD,GAAKf,CAAb;;AAAe,eAAIK,CAAC,GAAC,CAAC3C,CAAC,CAACiL,UAAF,IAAc,CAAf,IAAkB3I,CAAlB,GAAoB,GAAtB,EAA0Be,CAAC,GAAC,CAAhC,EAAkCA,CAAC,GAACvB,CAAC,CAACiJ,IAAtC,EAA2C1H,CAAC,EAA5C,EAA+C,IAAGX,CAAC,CAACW,CAAD,CAAD,GAAKV,CAAR,EAAU;AAACjB,YAAAA,CAAC,CAAC3B,CAAD,CAAD,GAAK+B,CAAC,CAACyG,GAAF,GAAMnG,CAAC,IAAEiB,CAAC,GAACR,CAAJ,CAAZ;AAAmB;AAAM;;AAAA,eAAIF,CAAC,GAAC,CAAC,IAAE,CAAC3C,CAAC,CAACkL,UAAF,IAAc,CAAf,IAAkB,GAArB,IAA0B5I,CAA5B,EAA8Be,CAAC,GAACvB,CAAC,CAACiJ,IAAF,GAAO,CAA3C,EAA6C1H,CAAC,IAAE,CAAhD,EAAkDA,CAAC,EAAnD,EAAsD,IAAGX,CAAC,CAACW,CAAD,CAAD,GAAKV,CAAR,EAAU;AAACf,YAAAA,CAAC,CAAC7B,CAAD,CAAD,GAAK+B,CAAC,CAACyG,GAAF,GAAMnG,CAAC,IAAEiB,CAAC,GAAC,CAAF,GAAIR,CAAN,CAAZ;AAAqB;AAAM;AAAC;;AAAA;;AAAM;AAAQ,aAAI9C,CAAC,GAAC,CAAN,EAAQA,CAAC,GAACyB,CAAV,EAAYzB,CAAC,EAAb,EAAgB2B,CAAC,CAAC3B,CAAD,CAAD,GAAKiB,CAAC,CAACjB,CAAD,CAAD,CAAK,CAAL,CAAL,EAAa6B,CAAC,CAAC7B,CAAD,CAAD,GAAKiB,CAAC,CAACjB,CAAD,CAAD,CAAK,CAAL,CAAlB;;AAAx8B;;AAAk+B,gCAA0BqB,CAA1B,IAA6BkE,CAAC,GAACpE,CAAC,CAAC,CAAD,CAAD,CAAK6J,IAAL,IAAW,GAAb,EAAiBzG,CAAC,GAAC,CAAnB,EAAqBjE,CAAC,KAAGmK,CAAC,GAACtJ,CAAC,CAACkH,GAAF,CAAOpI,CAAC,IAAEgC,CAAC,CAAChC,CAAD,CAAX,CAAL,CAAnD,KAA4EsF,CAAC,GAACtF,CAAC,CAACwI,GAAF,IAAO,GAAT,EAAalE,CAAC,GAACtE,CAAC,CAACuI,GAAF,IAAO,CAAlG;AAAqG,UAAM4C,CAAC,GAAC;AAACC,MAAAA,SAAS,EAAC1J,CAAX;AAAa2J,MAAAA,SAAS,EAACzJ,CAAvB;AAAyB0J,MAAAA,MAAM,EAAChG,CAAhC;AAAkCiG,MAAAA,MAAM,EAACjH,CAAzC;AAA2C0D,MAAAA,YAAY,EAACwC;AAAxD,KAAR;AAAmE,WAAO,KAAKgB,uBAAL,CAA6BL,CAA7B,EAA+B/K,CAA/B,CAAP;AAAyC;;AAAAoL,EAAAA,uBAAuB,CAACxL,CAAD,EAAGE,CAAH,EAAK;AAAC,QAAG,QAAMA,CAAN,IAAS,MAAIA,CAAC,CAACqD,MAAlB,EAAyB,OAAOvD,CAAP;AAAS,UAAMI,CAAC,GAAC4J,IAAI,CAACxB,GAAL,CAASiD,KAAT,CAAe,IAAf,EAAoBvL,CAApB,CAAR;AAAA,UAA+B;AAACkL,MAAAA,SAAS,EAAC/K,CAAX;AAAagL,MAAAA,SAAS,EAAC9K,CAAvB;AAAyBgL,MAAAA,MAAM,EAAC9K,CAAhC;AAAkC6K,MAAAA,MAAM,EAAC3K,CAAzC;AAA2CqH,MAAAA,YAAY,EAACnH;AAAxD,QAA2Db,CAA1F;AAA4F,WAAOK,CAAC,CAACkD,MAAF,KAAWrD,CAAC,CAACqD,MAAb,IAAqBlD,CAAC,CAACkD,MAAF,IAAUnD,CAA/B,GAAiCJ,CAAjC,GAAmC;AAACoL,MAAAA,SAAS,EAAClL,CAAC,CAACkI,GAAF,CAAOpI,CAAC,IAAEK,CAAC,CAACL,CAAD,CAAX,CAAX;AAA4BqL,MAAAA,SAAS,EAACnL,CAAC,CAACkI,GAAF,CAAOpI,CAAC,IAAEO,CAAC,CAACP,CAAD,CAAX,CAAtC;AAAuDgI,MAAAA,YAAY,EAACnH,CAAC,GAACX,CAAC,CAACkI,GAAF,CAAOpI,CAAC,IAAEa,CAAC,CAACb,CAAD,CAAX,CAAD,GAAkB,IAAvF;AAA4FuL,MAAAA,MAAM,EAAC9K,CAAnG;AAAqG6K,MAAAA,MAAM,EAAC3K;AAA5G,KAA1C;AAAyJ;;AAAAuG,EAAAA,2BAA2B,CAAClH,CAAD,EAAGE,CAAH,EAAKE,CAAL,EAAO;AAAC,QAAIC,CAAC,GAAC,IAAN;AAAA,QAAWE,CAAC,GAAC,IAAb;AAAkB,UAAMI,CAAC,GAAC,KAAKgE,MAAL,IAAa,KAAKA,MAAL,CAAYqC,WAAjC;AAA6C9G,IAAAA,CAAC,CAACoH,SAAF,IAAa3G,CAAb,KAAiBN,CAAC,GAACM,CAAC,CAACmG,eAAJ,EAAoBvG,CAAC,GAACI,CAAC,CAACoG,MAAzC,GAAiD,4BAA0B7G,CAAC,CAAC6H,WAA5B,KAA0C7H,CAAC,GAAC,EAAC,GAAGA,CAAJ;AAAM6H,MAAAA,WAAW,EAAC;AAAlB,KAA5C,CAAjD;;AAA0H,UAAK;AAACD,MAAAA,KAAK,EAACjH;AAAP,QAAUX,CAAf;AAAA,UAAiBY,CAAC,GAAC,CAAC,EAAEZ,CAAC,CAAC2H,QAAF,IAAYhH,CAAZ,IAAeA,CAAC,CAAC6K,IAAF,CAAQ1L,CAAC,IAAE,MAAIA,CAAf,CAAjB,CAApB;AAAA,UAAyD;AAACoL,MAAAA,SAAS,EAACpK,CAAX;AAAaqK,MAAAA,SAAS,EAACnK,CAAvB;AAAyBqK,MAAAA,MAAM,EAACnK,CAAhC;AAAkCkK,MAAAA,MAAM,EAAChK;AAAzC,QAA4C,KAAK2G,iBAAL,CAAuB/H,CAAvB,EAAyBF,CAAzB,EAA2BI,CAA3B,CAArG;;AAAmI,QAAIoB,CAAC,GAAC,CAAN;AAAQf,IAAAA,CAAC,CAACT,CAAD,CAAD,KAAOwB,CAAC,GAACxB,CAAC,CAAC2L,aAAF,EAAF,EAAoB,MAAInK,CAAJ,KAAQ,CAACxB,CAAC,GAACA,CAAC,CAAC4L,KAAF,EAAH,EAActD,UAAd,GAAyB,CAACtI,CAAC,CAACsI,UAAF,CAAa,CAAb,CAAD,CAAzB,EAA2CtI,CAAC,CAACyF,MAAF,GAAS,CAACzF,CAAC,CAACyF,MAAF,CAAS,CAAT,CAAD,CAA5D,CAA3B;AAAuG,UAAM/D,CAAC,GAACsI,IAAI,CAACzB,GAAL,CAAS,CAAT,EAAW,CAAC,QAAMnI,CAAN,GAAQ,KAAK,CAAb,GAAeA,CAAC,CAACmD,MAAlB,KAA2B/B,CAA3B,IAA8B,KAAKiG,UAAL,CAAgB1E,SAAzD,CAAR;AAAA,UAA4EnB,CAAC,GAAC,IAAIiK,YAAJ,CAAiBnK,CAAjB,CAA9E;AAAA,UAAkGI,CAAC,GAACzB,CAAC,IAAES,CAAH,GAAK,CAAL,GAAO,GAA3G;AAA+G,QAAIkB,CAAJ;;AAAM,SAAIA,CAAC,GAAC,CAAN,EAAQA,CAAC,GAACN,CAAV,EAAYM,CAAC,EAAb,EAAgBJ,CAAC,CAACI,CAAD,CAAD,GAAK,CAACV,CAAC,GAACF,CAAH,KAAOF,CAAC,CAACc,CAAD,CAAD,GAAKhB,CAAC,CAACgB,CAAD,CAAb,IAAkBF,CAAvB;;AAAyB,UAAMI,CAAC,GAAC,IAAI2J,YAAJ,CAAiBnK,CAAjB,CAAR;AAA4B,QAAGZ,CAAH,EAAK,KAAIkB,CAAC,GAAC,CAAN,EAAQA,CAAC,GAACN,CAAV,EAAYM,CAAC,EAAb,EAAgBnB,CAAC,CAACmB,CAAD,CAAD,GAAK,CAAL,GAAOnB,CAAC,CAACmB,CAAD,CAAD,GAAK,CAAL,GAAOE,CAAC,CAACF,CAAD,CAAD,GAAK,MAAI,CAACnB,CAAC,CAACmB,CAAD,CAAD,GAAK,CAAN,KAAU,GAA1B,GAA8BE,CAAC,CAACF,CAAD,CAAD,GAAK,MAAI,MAAI,CAAC,IAAEnB,CAAC,CAACmB,CAAD,CAAJ,KAAU,CAA5D,GAA8DE,CAAC,CAACF,CAAD,CAAD,GAAK,CAAnE;AAAqE,WAAM;AAACe,MAAAA,SAAS,EAACrB,CAAX;AAAa6J,MAAAA,MAAM,EAACnK,CAAC,GAACU,CAAtB;AAAwBwJ,MAAAA,MAAM,EAAChK,CAAC,GAACQ,CAAjC;AAAmCsJ,MAAAA,SAAS,EAACpK,CAA7C;AAA+CqK,MAAAA,SAAS,EAACnK,CAAzD;AAA2D4K,MAAAA,MAAM,EAAClK,CAAlE;AAAoEiG,MAAAA,QAAQ,EAAC/G,CAA7E;AAA+EgH,MAAAA,KAAK,EAAChH,CAAC,GAACD,CAAD,GAAG,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,CAAzF;AAAiGkL,MAAAA,eAAe,EAACjL,CAAC,GAACoB,CAAD,GAAG,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,CAArH;AAA6HoB,MAAAA,QAAQ,EAACjD,CAAtI;AAAwI4G,MAAAA,cAAc,EAAC1G,CAAvJ;AAAyJwH,MAAAA,WAAW,EAAC7H,CAAC,CAAC6H,WAAvK;AAAmLnD,MAAAA,IAAI,EAAC;AAAxL,KAAN;AAAyM;;AAAAuC,EAAAA,gCAAgC,CAACnH,CAAD,EAAGE,CAAH,EAAKE,CAAL,EAAO;AAAC,QAAIC,CAAJ,EAAMI,CAAN,EAAQE,CAAR;AAAU,QAAIE,CAAC,GAAC,IAAN;AAAA,QAAWC,CAAC,GAAC,IAAb;AAAkB,UAAME,CAAC,GAAC,KAAK2D,MAAL,IAAa,KAAKA,MAAL,CAAYqC,WAAjC;AAA6ChH,IAAAA,CAAC,CAACsH,SAAF,IAAatG,CAAb,KAAiBH,CAAC,GAACG,CAAC,CAAC8F,eAAJ,EAAoBhG,CAAC,GAACE,CAAC,CAAC+F,MAAzC;AAAiD,UAAM7F,CAAC,GAAC,EAAC,GAAGlB,CAAJ;AAAMwG,MAAAA,KAAK,EAACtG,CAAZ;AAAcuG,MAAAA,UAAU,EAACrG;AAAzB,KAAR;AAAA,UAAoCgB,CAAC,GAACoB,CAAC,CAACtB,CAAD,CAAvC;AAAA,UAA2CI,CAAC,GAAC,SAAOjB,CAAC,GAACE,CAAC,CAAC,KAAKkH,UAAL,CAAgBa,UAAjB,CAAV,IAAwC,KAAK,CAA7C,GAA+CjI,CAAC,CAAC,CAAD,CAA7F;AAAiG,WAAM,EAAC,GAAGe,CAAJ;AAAMyI,MAAAA,QAAQ,EAAC,SAAOpJ,CAAC,GAAC,QAAMa,CAAN,GAAQ,KAAK,CAAb,GAAeA,CAAC,CAACiH,GAA1B,IAA+B9H,CAA/B,GAAiC,CAAhD;AAAkD8J,MAAAA,QAAQ,EAAC,SAAO5J,CAAC,GAAC,QAAMW,CAAN,GAAQ,KAAK,CAAb,GAAeA,CAAC,CAACkH,GAA1B,IAA+B7H,CAA/B,GAAiC,GAA5F;AAAgGqL,MAAAA,aAAa,EAAC,kBAAgBhM,CAAC,CAACgM,aAAlB,GAAgC,CAAhC,GAAkC,CAAhJ;AAAkJpH,MAAAA,IAAI,EAAC,WAAvJ;AAAmKtB,MAAAA,QAAQ,EAACzC,CAA5K;AAA8KoG,MAAAA,cAAc,EAACnG;AAA7L,KAAN;AAAsM;;AAAAsG,EAAAA,+BAA+B,CAACpH,CAAD,EAAG;AAAC,QAAIE,CAAJ,EAAME,CAAN,EAAQC,CAAR,EAAUE,CAAV,EAAYI,CAAZ,EAAcE,CAAd,EAAgBC,CAAhB,EAAkBE,CAAlB;AAAoB,UAAK;AAACiL,MAAAA,KAAK,EAAC/K,CAAP;AAASgL,MAAAA,SAAS,EAAC9K,CAAnB;AAAqB+K,MAAAA,UAAU,EAAC7K,CAAhC;AAAkC8K,MAAAA,eAAe,EAAC5K,CAAlD;AAAoD6K,MAAAA,cAAc,EAAC3K,CAAnE;AAAqE4K,MAAAA,kBAAkB,EAAC1K;AAAxF,QAA2F5B,CAAhG;AAAkG,QAAI8B,CAAJ;AAAM,UAAME,CAAC,GAAC,SAAO9B,CAAC,GAAC,SAAOE,CAAC,GAAC,KAAKqH,UAAL,CAAgBa,UAAzB,IAAqC,KAAK,CAA1C,GAA4ClI,CAAC,CAAC,CAAD,CAAD,CAAKmI,GAA1D,IAA+DrI,CAA/D,GAAiE,CAAzE;AAAA,UAA2EgC,CAAC,GAAC,SAAO7B,CAAC,GAAC,SAAOE,CAAC,GAAC,KAAKkH,UAAL,CAAgBa,UAAzB,IAAqC,KAAK,CAA1C,GAA4C/H,CAAC,CAAC,CAAD,CAAD,CAAKiI,GAA1D,IAA+DnI,CAA/D,GAAiE,EAA9I;AAAA,UAAiJ+B,CAAC,GAAC,SAAOzB,CAAC,GAAC,QAAMa,CAAN,GAAQ,KAAK,CAAb,GAAeA,CAAC,CAACyB,IAAF,CAAQjD,CAAC,IAAE,eAAaA,CAAC,CAAC4E,IAA1B,CAAxB,IAA0DjE,CAA1D,GAA4D;AAACiE,MAAAA,IAAI,EAAC,UAAN;AAAiB2H,MAAAA,KAAK,EAAC,WAAvB;AAAmCC,MAAAA,YAAY,EAACtK,CAAhD;AAAkDuK,MAAAA,OAAO,EAAC,KAAG/K,CAA7D;AAA+DgL,MAAAA,YAAY,EAAC1K,CAA5E;AAA8E2K,MAAAA,OAAO,EAAC,KAAGjL;AAAzF,KAA/M;AAAA,UAA2SY,CAAC,GAAC,SAAOzB,CAAC,GAACuB,CAAC,CAACsK,YAAX,IAAyB7L,CAAzB,GAA2BmB,CAAxU;AAAA,UAA0UQ,CAAC,GAAC,SAAO1B,CAAC,GAACsB,CAAC,CAACoK,YAAX,IAAyB1L,CAAzB,GAA2BoB,CAAvW;AAAA,UAAyWQ,CAAC,GAACjC,CAAC,CAAC2B,CAAC,CAACqK,OAAH,CAAD,IAAchM,CAAC,CAAC2B,CAAC,CAACuK,OAAH,CAAf,GAA2B,CAACvK,CAAC,CAACuK,OAAF,GAAUjL,CAAX,EAAaU,CAAC,CAACqK,OAAF,GAAU/K,CAAvB,CAA3B,GAAqD,CAAC,EAAD,EAAI,EAAJ,CAAha;;AAAwa,QAAG,iBAAeR,CAAlB,EAAoB;AAAC,YAAMlB,CAAC,GAAC,CAAC0C,CAAC,CAAC,CAAD,CAAD,GAAKA,CAAC,CAAC,CAAD,CAAP,IAAY,CAApB;AAAsBA,MAAAA,CAAC,CAAC,CAAD,CAAD,GAAKA,CAAC,CAAC,CAAD,CAAD,GAAK1C,CAAV;AAAY;;AAAA,UAAM2C,CAAC,GAAClC,CAAC,CAAC6B,CAAD,CAAD,IAAM7B,CAAC,CAAC+B,CAAD,CAAP,GAAW,CAACF,CAAD,EAAGE,CAAH,CAAX,GAAiB,IAAzB;AAA8B,QAAG,uBAAqBtB,CAAxB,EAA0B,IAAGT,CAAC,CAAC6B,CAAD,CAAD,IAAM7B,CAAC,CAAC+B,CAAD,CAAP,IAAY/B,CAAC,CAAC2B,CAAD,CAAhB,EAAoB;AAACN,MAAAA,CAAC,GAAC,EAAF;AAAK,YAAM9B,CAAC,GAAC,CAACoC,CAAC,CAACoK,YAAF,GAAepK,CAAC,CAACsK,YAAlB,IAAgC,CAAxC;;AAA0C,WAAI,IAAIxM,CAAC,GAAC,CAAV,EAAYA,CAAC,GAAC,CAAd,EAAgBA,CAAC,EAAjB,EAAoB4B,CAAC,CAACuH,IAAF,CAAOjH,CAAC,CAACsK,YAAF,GAAe1M,CAAC,GAACE,CAAxB;AAA2B,KAAnH,MAAwH4B,CAAC,GAAC,CAAC,CAAD,EAAG,IAAH,EAAQ,GAAR,EAAY,CAAZ,EAAc,IAAd,EAAmB,EAAnB,CAAF;;AAAyB,UAAMe,CAAC,GAAC,cAAYjB,CAAZ,MAAiB,uBAAqBV,CAArB,IAAwB,sBAAoBA,CAA7D,IAAgE,CAAhE,GAAkE8I,IAAI,CAAC4C,EAA/E;AAAA,UAAkF7M,CAAC,GAAC,QAAMyB,CAAN,GAAQ,KAAK,CAAb,GAAeA,CAAC,CAACyB,IAAF,CAAQjD,CAAC,IAAE,mBAAiBA,CAAC,CAAC4E,IAA9B,CAAnG;;AAAwI,WAAM;AAACiI,MAAAA,WAAW,EAAC/K,CAAb;AAAegL,MAAAA,SAAS,EAACnK,CAAzB;AAA2BuJ,MAAAA,SAAS,EAAC9K,CAArC;AAAuC+K,MAAAA,UAAU,EAAC7K,CAAlD;AAAoD+K,MAAAA,cAAc,EAAC3K,CAAnE;AAAqEqL,MAAAA,kBAAkB,EAACrK,CAAxF;AAA0FuJ,MAAAA,KAAK,EAAC/K,CAAC,IAAE,cAAnG;AAAkH8L,MAAAA,QAAQ,EAACnK,CAA3H;AAA6HoK,MAAAA,YAAY,EAAC,CAAC,SAAOjM,CAAC,GAAC,KAAKyG,UAAL,CAAgByF,WAAzB,IAAsC,KAAK,CAA3C,GAA6ClM,CAAC,CAACmM,QAAhD,KAA2D,gBAAc,KAAK1F,UAAL,CAAgBrE,QAAzF,GAAkG,YAAlG,GAA+G,CAAC,QAAMrD,CAAN,GAAQ,KAAK,CAAb,GAAeA,CAAC,CAACkN,YAAlB,KAAiCjN,CAAC,CAACiN,YAA5R;AAAySrI,MAAAA,IAAI,EAAC;AAA9S,KAAN;AAAmU;;AAAnlb,CAArB;;AAA0mb,SAASU,CAAT,CAAWtF,CAAX,EAAa;AAAC,SAAOgB,CAAC,CAAChB,CAAD,CAAD,IAAM,MAAIA,CAAC,CAACoN,eAAnB;AAAmC;;AAAApN,CAAC,CAAC,CAACW,CAAC,CAAC;AAAC0M,EAAAA,IAAI,EAAC;AAACC,IAAAA,KAAK,EAAC,CAAC;AAAR;AAAN,CAAD,CAAF,CAAD,EAAwBhJ,CAAC,CAACiJ,SAA1B,EAAoC,cAApC,EAAmD,KAAK,CAAxD,CAAD,EAA4DvN,CAAC,CAAC,CAACW,CAAC,CAAC;AAACiE,EAAAA,IAAI,EAAC9D,CAAN;AAAQuM,EAAAA,IAAI,EAAC;AAACC,IAAAA,KAAK,EAAC,CAAC;AAAR;AAAb,CAAD,CAAF,CAAD,EAA+BhJ,CAAC,CAACiJ,SAAjC,EAA2C,YAA3C,EAAwD,KAAK,CAA7D,CAA7D,EAA6HvN,CAAC,CAAC,CAACW,CAAC,CAAC;AAAC0M,EAAAA,IAAI,EAAC;AAACC,IAAAA,KAAK,EAAC,CAAC;AAAR;AAAN,CAAD,CAAF,CAAD,EAAwBhJ,CAAC,CAACiJ,SAA1B,EAAoC,QAApC,EAA6C,KAAK,CAAlD,CAA9H,EAAmLvN,CAAC,CAAC,CAACW,CAAC,EAAF,CAAD,EAAO2D,CAAC,CAACiJ,SAAT,EAAmB,kBAAnB,EAAsC,KAAK,CAA3C,CAApL,EAAkOjJ,CAAC,GAACtE,CAAC,CAAC,CAACa,CAAC,CAAC,yCAAD,CAAF,CAAD,EAAgDyD,CAAhD,CAArO;AAAwR,MAAMkG,CAAC,GAAClG,CAAR;AAAU,SAAOkG,CAAC,IAAIgD,OAAZ","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import{toHSV as t}from\"../../core/colorUtils.js\";import{JSONSupport as r}from\"../../core/JSONSupport.js\";import s from\"../../core/Logger.js\";import{unwrap as o,isSome as a}from\"../../core/maybe.js\";import{property as n}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/arrayUtils.js\";import\"../../core/has.js\";import\"../../core/accessorSupport/ensureType.js\";import{subclass as i}from\"../../core/accessorSupport/decorators/subclass.js\";import l from\"../../layers/support/RasterInfo.js\";import{isValidPixelBlock as u,extractBands as c,stretch as p,colorize as d,remapColor as h,lookupPixels as m,createStretchLUT as f,createColormapLUT as g,createHistogramEqualizationLUT as y,estimateStatisticsHistograms as b}from\"../../layers/support/rasterFunctions/pixelUtils.js\";import{hillshade as S,tintHillshade as v,calculateHillshadeParams as x}from\"../../layers/support/rasterFunctions/surfaceUtils.js\";import{convertColorRampToColormap as k}from\"./colorRampUtils.js\";const R=s.getLogger(\"esri.renderers.support.RasterSymbolizer\");function C(e,t){const{attributeTable:r,bandCount:s}=e;if(!a(r)||s>1)return!1;if(t){if(null==r.fields.find((e=>e.name.toLowerCase()===t.toLowerCase())))return!1}return!0}function _(e){return\"elevation\"===e.dataType}function O(e){const{bandCount:t,colormap:r}=e;return a(r)&&r.length&&1===t}const I={u1:[0,1],u2:[0,3],u4:[0,15],u8:[0,255],s8:[-128,127],u16:[0,65535],s16:[-32768,32767],u32:[0,4294967295],s32:[-2147483648,2147483647],f32:[-34e38,34e38],f64:[-Number.MAX_VALUE,Number.MAX_VALUE]};let L=class extends r{constructor(e){super(e)}bind(){const{rendererJSON:e}=this;if(!e)return{success:!1};let t;switch(this.lookup={rendererJSON:{}},e.type){case\"uniqueValue\":t=this._updateUVRenderer(e);break;case\"rasterColormap\":t=this._updateColormapRenderer(e);break;case\"rasterStretch\":t=this._updateStretchRenderer(e);break;case\"classBreaks\":t=this._updateClassBreaksRenderer(e);break;case\"rasterShadedRelief\":t=this._updateShadedReliefRenderer(e);break;case\"vectorField\":t=this._updateVectorFieldRenderer();break;case\"flowRenderer\":t=this._updateFlowRenderer()}return t}symbolize(e){let t=e&&e.pixelBlock;if(!V(t))return t;if(e.simpleStretchParams&&\"rasterStretch\"===this.rendererJSON.type)return this.simpleStretch(t,e.simpleStretchParams);try{let r;switch(t.pixels.length>3&&(t=c(t,[0,1,2])),this.rendererJSON.type){case\"uniqueValue\":case\"rasterColormap\":r=this._symbolizeColormap(t);break;case\"classBreaks\":r=this._symbolizeClassBreaks(t);break;case\"rasterStretch\":r=this._symbolizeStretch(t,e.bandIds);break;case\"rasterShadedRelief\":{const{extent:s}=e,o=s.spatialReference.isGeographic,a={x:(s.xmax-s.xmin)/t.width,y:(s.ymax-s.ymin)/t.height};r=this._symbolizeShadedRelief(t,{isGCS:o,resolution:a});break}}return r}catch(r){return R.error(\"symbolize\",r.message),t}}simpleStretch(e,t){if(!V(e))return e;try{return e.pixels.length>3&&(e=c(e,[0,1,2])),p(e,t)}catch(r){return R.error(\"symbolize\",r.message),e}}generateWebGLParameters(e){if([\"uniqueValue\",\"rasterColormap\",\"classBreaks\"].indexOf(this.rendererJSON.type)>-1){var t;const{indexedColormap:e,offset:r}=(null==(t=this.lookup)?void 0:t.colormapLut)||{};return{colormap:e,colormapOffset:r,type:\"lut\"}}const{pixelBlock:r,isGCS:s,resolution:o,bandIds:a}=e,{rendererJSON:n}=this;return\"rasterStretch\"===n.type?this._generateStretchWebGLParams(r,n,a):\"rasterShadedRelief\"===n.type?this._generateShadedReliefWebGLParams(n,s,o):\"vectorField\"===n.type?this._generateVectorFieldWebGLParams(n):null}_isLUTChanged(e){if(!this.lookup||!this.lookup.rendererJSON)return!0;if(\"colorRamp\"in this.rendererJSON){const t=this.rendererJSON.colorRamp;return e?JSON.stringify(t)!==JSON.stringify(this.lookup.rendererJSON.colorRamp):(this.rendererJSON,this.lookup.rendererJSON,JSON.stringify(this.rendererJSON)!==JSON.stringify(this.lookup.rendererJSON))}return JSON.stringify(this.rendererJSON)!==JSON.stringify(this.lookup.rendererJSON)}_symbolizeColormap(e){if(this._isLUTChanged()){if(!this.bind().success)return e}return d(e,this.lookup.colormapLut)}_symbolizeClassBreaks(e){const t=this.rasterInfo.pixelType,r=[\"u8\",\"u16\",\"s8\",\"s16\"].indexOf(t)>-1;if(this._isLUTChanged()){if(!this.bind().success)return e}return r?d(e,this.lookup.colormapLut):h(e,this.lookup.remapLut)}_symbolizeStretch(e,t){const{pixelType:r,bandCount:s}=this.rasterInfo,a=this.rendererJSON,n=[\"u8\",\"u16\",\"s8\",\"s16\"].indexOf(r)>-1;let i,l;const{dra:u}=a,c=a.useGamma?a.gamma:null;if(\"histogramEqualization\"===a.stretchType){const r=u?null:this.lookup.histogramLut,s=this._getStretchCutoff(a,e,t,!r),o=p(e,{...s,gamma:c});l=m(o,{lut:u?s.histogramLut:r,offset:0})}else if(n){var h,g;if(u){const s=this._getStretchCutoff(a,e,t);i=f({pixelType:r,...s,gamma:c})}else if(this._isLUTChanged()){if(!this.bind().success)return e;i=this.lookup?this.lookup.stretchLut:null}else i=this.lookup?this.lookup.stretchLut:null;if(!i)return e;s>1&&(null==t?void 0:t.length)===(null==(h=o(e))?void 0:h.pixels.length)&&(null==(g=i)?void 0:g.lut.length)===s&&(i={lut:t.map((e=>i.lut[e])),offset:i.offset}),l=m(e,i)}else{const r=this._getStretchCutoff(a,e,t);l=p(e,{...r,gamma:c})}if(a.colorRamp){if(this._isLUTChanged(!0)){if(!this.bind().success)return e}l=d(l,this.lookup.colormapLut)}return l}_symbolizeShadedRelief(e,t){var r,s;const a=this.rendererJSON,n={...a,...t},i=S(e,n);if(!a.colorRamp)return i;let l;if(this._isLUTChanged(!0)){if(!this.bind().success)return i;l=this.lookup?this.lookup.hsvMap:null}else l=this.lookup?this.lookup.hsvMap:null;if(!l)return i;const u=null!=(r=null==(s=o(this.rasterInfo.statistics))?void 0:s[0])?r:{min:0,max:8e3};return v(i,e,l,u),i}_isVectorFieldData(){const{bandCount:e,dataType:t}=this.rasterInfo;return 2===e&&(\"vector-magdir\"===t||\"vector-uv\"===t)}_updateVectorFieldRenderer(){return this._isVectorFieldData()?{success:!0}:{success:!1,error:`Unsupported data type \"${this.rasterInfo.dataType}\"; VectorFieldRenderer only supports \"vector-magdir\" and \"vector-uv\".`}}_updateFlowRenderer(){return this._isVectorFieldData()?{success:!0}:{success:!1,error:`Unsupported data type \"${this.rasterInfo.dataType}\"; FlowRenderer only supports \"vector-magdir\" and \"vector-uv\".`}}_updateUVRenderer(e){const{bandCount:t,attributeTable:r,pixelType:s}=this.rasterInfo,o=e.field1;if(!o)return{success:!1,error:\"Unsupported renderer; missing UniqueValueRenderer.field.\"};const a=e.defaultSymbol,n=1===t&&[\"u8\",\"s8\"].includes(s);if(!C(this.rasterInfo,o)&&!n)return{success:!1,error:\"Unsupported data; UniqueValueRenderer is only supported on single band data with a valid raster attribute table.\"};const i=[];if(r){const t=r.fields.find((e=>\"value\"===e.name.toLowerCase()));if(!t)return{success:!1,error:\"Unsupported data; the data's raster attribute table does not have a value field.\"};r.features.forEach((r=>{var s;const n=e.uniqueValueInfos.find((e=>String(e.value)===String(r.attributes[o]))),l=null==n||null==(s=n.symbol)?void 0:s.color;l?i.push([r.attributes[t.name]].concat(l)):a&&i.push([r.attributes[t.name]].concat(a.color))}))}else{if(\"value\"!==o.toLowerCase())return{success:!1,error:'Unsupported renderer; UniqueValueRenderer.field must be \"Value\" when raster attribute table is not availalbe.'};e.uniqueValueInfos.forEach((e=>{var t;const r=null==e||null==(t=e.symbol)?void 0:t.color;r?i.push([parseInt(\"\"+e.value,10)].concat(r)):a&&i.push([parseInt(\"\"+e.value,10)].concat(a.color))}))}if(0===i.length)return{success:!1,error:\"Invalid UniqueValueRenderer. Cannot find matching records in the raster attribute table.\"};const l=g({colormap:i});return this.lookup={rendererJSON:e,colormapLut:l},this.canRenderInWebGL=!0,{success:!0}}_updateColormapRenderer(e){if(!O(this.rasterInfo))return{success:!1,error:\"Unsupported data; the data source does not have a colormap.\"};const t=e.colormapInfos.map((e=>[e.value].concat(e.color))).sort(((e,t)=>e[0]-t[0]));if(!t||0===t.length)return{success:!1,error:\"Unsupported renderer; ColormapRenderer must have meaningful colormapInfos.\"};const r=g({colormap:t});return this.lookup={rendererJSON:e,colormapLut:r},this.canRenderInWebGL=!0,{success:!0}}_updateShadedReliefRenderer(e){if(!_(this.rasterInfo))return{success:!1,error:`Unsupported data type \"${this.rasterInfo.dataType}\"; ShadedReliefRenderer only supports \"elevation\".`};if(e.colorRamp){const r=k(e.colorRamp,256,!0),s=g({colormap:r}),o=[],a=s.indexedColormap;for(let e=0;e<a.length;e+=4){const r=t({r:a[e],g:a[e+1],b:a[e+2]});o.push([r.h/60,r.s/100,255*r.v/100])}this.lookup={rendererJSON:e,colormapLut:s,hsvMap:o}}else this.lookup=null;return this.canRenderInWebGL=!0,{success:!0}}_updateClassBreaksRenderer(e){const t=this.rasterInfo.pixelType,r=[\"u8\",\"u16\",\"s8\",\"s16\"].indexOf(t)>-1,s=e.classBreakInfos;if(null==s||!s.length)return{success:!1,error:\"Unsupported renderer; missing or invalid ClassBreaksRenderer.classBreakInfos.\"};const o=s.sort(((e,t)=>e.classMaxValue-t.classMaxValue)),a=o[o.length-1];let n=e.minValue;if(!r){const t=[];for(let e=0;e<o.length;e++){var i;t.push({value:null!=(i=o[e].classMinValue)?i:n,mappedColor:o[e].symbol.color}),n=o[e].classMaxValue}return t.push({value:a.classMaxValue,mappedColor:a.symbol.color}),this.lookup={rendererJSON:e,remapLut:t},this.canRenderInWebGL=!1,{success:!0}}const l=[];n=Math.floor(e.minValue);for(let c=0;c<o.length;c++){const e=o[c];for(let t=n;t<e.classMaxValue;t++)l.push([t].concat(e.symbol.color));n=Math.ceil(e.classMaxValue)}a.classMaxValue===n&&l.push([a.classMaxValue].concat(a.symbol.color));const u=g({colormap:l,fillUnspecified:!1});return this.lookup={rendererJSON:e,colormapLut:u},this.canRenderInWebGL=!0,{success:!0}}_isHistogramRequired(e){return\"percentClip\"===e||\"histogramEqualization\"===e}_isValidRasterStatistics(e){return a(e)&&e.length>0&&null!=e[0].min&&null!=e[0].max}_updateStretchRenderer(e){var t;let{stretchType:r,dra:s}=e;if(!(\"none\"===r||null!=(t=e.statistics)&&t.length||this._isValidRasterStatistics(this.rasterInfo.statistics)||s))return{success:!1,error:\"Unsupported renderer; StretchRenderer.statistics is required when dynamic range adjustment is not used.\"};const a=o(e.histograms||this.rasterInfo.histograms);!this._isHistogramRequired(e.stretchType)||null!=a&&a.length||s||(r=\"minMax\");const{gamma:n,useGamma:i,colorRamp:l}=e,u=this.rasterInfo.pixelType,c=!s&&[\"u8\",\"u16\",\"s8\",\"s16\"].indexOf(u)>-1;if(\"histogramEqualization\"===r){const t=a.map((e=>y(e)));this.lookup={rendererJSON:e,histogramLut:t}}else if(c){const t=this._getStretchCutoff(e),r=f({pixelType:u,...t,gamma:i?n:null});this.lookup={rendererJSON:e,stretchLut:r}}if(l){const t=k(l,256,!0);this.lookup||(this.lookup={rendererJSON:e}),this.lookup.colormapLut=g({colormap:t}),this.lookup.rendererJSON=e}return this.canRenderInWebGL=!0,{success:!0}}_getStretchCutoff(e,t=null,r,s){var n,i,l;let u,c,p=e.stretchType;var d;if(e.dra)if(\"minMax\"===p&&a(t)&&t.statistics)u=t.statistics.map((e=>[e.minValue,e.maxValue,0,0]));else{const e=b(t);u=a(e)?e.statistics:null,c=a(e)?e.histograms:null}else u=(null==(d=e.statistics)?void 0:d.length)>0?e.statistics:o(this.rasterInfo.statistics),c=e.histograms||o(this.rasterInfo.histograms);!this._isHistogramRequired(p)||null!=(n=c)&&n.length||(p=\"minMax\");const h=(null==(i=u)?void 0:i.length)||(null==(l=c)?void 0:l.length)||this.rasterInfo.bandCount,m=[],f=[];let g,S,v,x,k,R,C,_,O,L,V,T;switch(u&&!Array.isArray(u[0])&&(u=u.map((e=>[e.min,e.max,e.avg,e.stddev]))),p){case\"none\":{const e=I[this.rasterInfo.pixelType]||I.f32;for(_=0;_<h;_++)m[_]=e[0],f[_]=e[1]}break;case\"minMax\":for(_=0;_<h;_++)m[_]=u[_][0],f[_]=u[_][1];break;case\"standardDeviation\":for(_=0;_<h;_++)m[_]=u[_][2]-e.numberOfStandardDeviations*u[_][3],f[_]=u[_][2]+e.numberOfStandardDeviations*u[_][3],m[_]<u[_][0]&&(m[_]=u[_][0]),f[_]>u[_][1]&&(f[_]=u[_][1]);break;case\"histogramEqualization\":for(_=0;_<h;_++)m[_]=c[_].min,f[_]=c[_].max;break;case\"percentClip\":for(_=0;_<c.length;_++){for(g=c[_],k=new Uint32Array(g.size),x=[...g.counts],x.length>=20&&(x[0]=x[1]=x[2]=x[x.length-1]=x[x.length-2]=0),v=0,S=(g.max-g.min)/g.size,C=-.5===g.min&&1===S?.5:0,O=0;O<g.size;O++)v+=x[O],k[O]=v;for(R=(e.minPercent||0)*v/100,O=0;O<g.size;O++)if(k[O]>R){m[_]=g.min+S*(O+C);break}for(R=(1-(e.maxPercent||0)/100)*v,O=g.size-2;O>=0;O--)if(k[O]<R){f[_]=g.min+S*(O+2-C);break}}break;default:for(_=0;_<h;_++)m[_]=u[_][0],f[_]=u[_][1]}\"histogramEqualization\"===p?(V=c[0].size||256,L=0,s&&(T=c.map((e=>y(e))))):(V=e.max||255,L=e.min||0);const N={minCutOff:m,maxCutOff:f,outMax:V,outMin:L,histogramLut:T};return this._getSelectedBandCutoffs(N,r)}_getSelectedBandCutoffs(e,t){if(null==t||0===t.length)return e;const r=Math.max.apply(null,t),{minCutOff:s,maxCutOff:o,outMin:a,outMax:n,histogramLut:i}=e;return s.length===t.length||s.length<=r?e:{minCutOff:t.map((e=>s[e])),maxCutOff:t.map((e=>o[e])),histogramLut:i?t.map((e=>i[e])):null,outMin:a,outMax:n}}_generateStretchWebGLParams(e,t,r){let s=null,o=null;const n=this.lookup&&this.lookup.colormapLut;t.colorRamp&&n&&(s=n.indexedColormap,o=n.offset),\"histogramEqualization\"===t.stretchType&&(t={...t,stretchType:\"minMax\"});const{gamma:i}=t,l=!!(t.useGamma&&i&&i.some((e=>1!==e))),{minCutOff:u,maxCutOff:c,outMin:p,outMax:d}=this._getStretchCutoff(t,e,r);let h=0;a(e)&&(h=e.getPlaneCount(),2===h&&((e=e.clone()).statistics=[e.statistics[0]],e.pixels=[e.pixels[0]]));const m=Math.min(3,(null==r?void 0:r.length)||h||this.rasterInfo.bandCount),f=new Float32Array(m),g=s||l?1:255;let y;for(y=0;y<m;y++)f[y]=(d-p)/(c[y]-u[y])/g;const b=new Float32Array(m);if(l)for(y=0;y<m;y++)i[y]>1?i[y]>2?b[y]=6.5+(i[y]-2)**2.5:b[y]=6.5+100*(2-i[y])**4:b[y]=1;return{bandCount:m,outMin:p/g,outMax:d/g,minCutOff:u,maxCutOff:c,factor:f,useGamma:l,gamma:l?i:[1,1,1],gammaCorrection:l?b:[1,1,1],colormap:s,colormapOffset:o,stretchType:t.stretchType,type:\"stretch\"}}_generateShadedReliefWebGLParams(e,t,r){var s,a,n;let i=null,l=null;const u=this.lookup&&this.lookup.colormapLut;e.colorRamp&&u&&(i=u.indexedColormap,l=u.offset);const c={...e,isGCS:t,resolution:r},p=x(c),d=null==(s=o(this.rasterInfo.statistics))?void 0:s[0];return{...p,minValue:null!=(a=null==d?void 0:d.min)?a:0,maxValue:null!=(n=null==d?void 0:d.max)?n:8e3,hillshadeType:\"traditional\"===e.hillshadeType?0:1,type:\"hillshade\",colormap:i,colormapOffset:l}}_generateVectorFieldWebGLParams(e){var t,r,s,o,n,i,l,u;const{style:c,inputUnit:p,outputUnit:d,visualVariables:h,symbolTileSize:m,flowRepresentation:f}=e;let g;const y=null!=(t=null==(r=this.rasterInfo.statistics)?void 0:r[0].min)?t:0,b=null!=(s=null==(o=this.rasterInfo.statistics)?void 0:o[0].max)?s:50,S=null!=(n=null==h?void 0:h.find((e=>\"sizeInfo\"===e.type)))?n:{type:\"sizeInfo\",field:\"Magnitude\",maxDataValue:b,maxSize:.8*m,minDataValue:y,minSize:.2*m},v=null!=(i=S.minDataValue)?i:y,x=null!=(l=S.maxDataValue)?l:b,k=a(S.maxSize)&&a(S.minSize)?[S.minSize/m,S.maxSize/m]:[.2,.8];if(\"wind_speed\"===c){const e=(k[0]+k[1])/2;k[0]=k[1]=e}const R=a(v)&&a(x)?[v,x]:null;if(\"classified_arrow\"===c)if(a(v)&&a(x)&&a(S)){g=[];const e=(S.maxDataValue-S.minDataValue)/5;for(let t=0;t<6;t++)g.push(S.minDataValue+e*t)}else g=[0,1e-6,3.5,7,10.5,14];const C=\"flow_to\"===f===(\"ocean_current_kn\"===c||\"ocean_current_m\"===c)?0:Math.PI,_=null==h?void 0:h.find((e=>\"rotationInfo\"===e.type));return{breakValues:g,dataRange:R,inputUnit:p,outputUnit:d,symbolTileSize:m,symbolPercentRange:k,style:c||\"single_arrow\",rotation:C,rotationType:(null==(u=this.rasterInfo.storageInfo)?void 0:u.tileInfo)&&\"vector-uv\"===this.rasterInfo.dataType?\"geographic\":(null==_?void 0:_.rotationType)||e.rotationType,type:\"vectorField\"}}};function V(e){return u(e)&&0!==e.validPixelCount}e([n({json:{write:!0}})],L.prototype,\"rendererJSON\",void 0),e([n({type:l,json:{write:!0}})],L.prototype,\"rasterInfo\",void 0),e([n({json:{write:!0}})],L.prototype,\"lookup\",void 0),e([n()],L.prototype,\"canRenderInWebGL\",void 0),L=e([i(\"esri.renderers.support.RasterSymbolizer\")],L);const T=L;export{T as default};\n"]},"metadata":{},"sourceType":"module"}