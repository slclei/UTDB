{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport e from \"../request.js\";\nimport { isSome as t } from \"../core/maybe.js\";\nimport { createQueryParamsHelper as r } from \"../core/queryUtils.js\";\nimport { normalizeCentralMeridian as s } from \"../geometry/support/normalizeUtils.js\";\nimport { collectGeometries as i, isInputGeometryZAware as o, fetchServiceDescription as a, dropZValuesOffInputGeometry as n } from \"./networkService.js\";\nimport { parseUrl as l } from \"./utils.js\";\nimport u from \"./support/RouteSolveResult.js\";\nconst f = r({\n  accumulateAttributes: {\n    name: \"accumulateAttributeNames\"\n  },\n  attributeParameterValues: !0,\n  directionsTimeAttribute: {\n    name: \"directionsTimeAttributeName\"\n  },\n  impedanceAttribute: {\n    name: \"impedanceAttributeName\"\n  },\n  outSpatialReference: {\n    name: \"outSR\",\n    getter: e => e.outSpatialReference.wkid\n  },\n  pointBarriers: {\n    name: \"barriers\"\n  },\n  polylineBarriers: !0,\n  polygonBarriers: !0,\n  restrictionAttributes: {\n    name: \"restrictionAttributeNames\"\n  },\n  stops: !0,\n  travelMode: !0\n});\n\nfunction c(e) {\n  return \"esri.rest.support.FeatureSet\" === (null == e ? void 0 : e.declaredClass);\n}\n\nasync function p(t, r, u) {\n  const p = [],\n        d = [],\n        y = {},\n        g = {},\n        R = l(t),\n        {\n    path: v\n  } = R;\n  c(r.stops) && i(r.stops.features, d, \"stops.features\", y), c(r.pointBarriers) && i(r.pointBarriers.features, d, \"pointBarriers.features\", y), c(r.polylineBarriers) && i(r.polylineBarriers.features, d, \"polylineBarriers.features\", y), c(r.polygonBarriers) && i(r.polygonBarriers.features, d, \"polygonBarriers.features\", y);\n  const b = await s(d);\n\n  for (const e in y) {\n    const t = y[e];\n    p.push(e), g[e] = b.slice(t[0], t[1]);\n  }\n\n  if (o(g, p)) {\n    let e = null;\n\n    try {\n      e = await a(v, r.apiKey, u);\n    } catch {}\n\n    e && !e.hasZ && n(g, p);\n  }\n\n  for (const e in g) g[e].forEach((t, s) => {\n    r.get(e)[s].geometry = t;\n  });\n\n  const h = { ...u,\n    query: { ...R.query,\n      ...f.toQueryParams(r),\n      f: \"json\"\n    }\n  },\n        A = v.endsWith(\"/solve\") ? v : `${v}/solve`,\n        {\n    data: B\n  } = await e(A, h);\n  return m(B);\n}\n\nfunction m(e) {\n  var r, s, i, o, a;\n  const n = new Map(),\n        {\n    directionLines: l,\n    directionPoints: f,\n    directions: c,\n    routes: p,\n    stops: m,\n    barriers: d,\n    polygonBarriers: y,\n    polylineBarriers: g,\n    messages: R\n  } = e,\n        v = null != (r = null != (s = null != (i = null != (o = null == p ? void 0 : p.spatialReference) ? o : null == m ? void 0 : m.spatialReference) ? i : null == d ? void 0 : d.spatialReference) ? s : null == y ? void 0 : y.spatialReference) ? r : null == g ? void 0 : g.spatialReference;\n  null == p || p.features.forEach(e => {\n    const r = e.attributes.Name,\n          s = e.attributes.ObjectID;\n    n.has(r) ? (n.get(r).route = e, n.get(r).routeId = s) : n.set(r, {\n      route: e,\n      routeId: s,\n      routeName: r\n    }), t(e.geometry) && (e.geometry.spatialReference = v);\n  }), null == c || c.forEach(e => {\n    const t = e.routeName;\n    n.has(t) ? n.get(t).directions = e : n.set(t, {\n      routeName: t,\n      directions: e\n    });\n  }), null == m || m.features.forEach(e => {\n    var r;\n    const s = null != (r = e.attributes.RouteName) ? r : null;\n    n.has(s) ? n.get(s).stops ? n.get(s).stops.push(e) : n.get(s).stops = [e] : n.set(s, {\n      stops: [e],\n      routeName: s\n    }), t(e.geometry) && (e.geometry.spatialReference = v);\n  });\n  const b = null == (a = null == m ? void 0 : m.features.every(e => null == e.attributes.RouteName)) || a;\n\n  if ((null == m ? void 0 : m.features.length) > 0 && b) {\n    const e = Array.from(n.keys())[0];\n    n.get(e).stops = n.get(null).stops, n.delete(null);\n  }\n\n  null == l || l.features.forEach(e => {\n    var t;\n    const r = e.attributes.RouteID,\n          s = null == (t = Array.from(n.values()).find(e => e.routeId === r)) ? void 0 : t.routeName;\n    if (s) if (n.has(s)) {\n      if (n.get(s).directionLines) n.get(s).directionLines.features.push(e);else {\n        const {\n          fieldAliases: t,\n          geometryType: r,\n          spatialReference: i\n        } = l;\n        n.get(s).directionLines = {\n          features: [e],\n          fieldAliases: t,\n          geometryType: r,\n          spatialReference: i\n        };\n      }\n    } else {\n      const {\n        fieldAliases: t,\n        geometryType: r,\n        spatialReference: i\n      } = l;\n      n.set(s, {\n        routeName: s,\n        directionLines: {\n          features: [e],\n          fieldAliases: t,\n          geometryType: r,\n          spatialReference: i\n        }\n      });\n    }\n  }), null == f || f.features.forEach(e => {\n    var t;\n    const r = e.attributes.RouteID,\n          s = null == (t = Array.from(n.values()).find(e => e.routeId === r)) ? void 0 : t.routeName;\n    if (s) if (n.has(s)) {\n      if (n.get(s).directionPoints) n.get(s).directionPoints.features.push(e);else {\n        const {\n          fieldAliases: t,\n          geometryType: r,\n          spatialReference: i\n        } = f;\n        n.get(s).directionPoints = {\n          features: [e],\n          fieldAliases: t,\n          geometryType: r,\n          spatialReference: i\n        };\n      }\n    } else {\n      const {\n        fieldAliases: t,\n        geometryType: r,\n        spatialReference: i\n      } = f;\n      n.set(s, {\n        routeName: s,\n        directionPoints: {\n          features: [e],\n          fieldAliases: t,\n          geometryType: r,\n          spatialReference: i\n        }\n      });\n    }\n  });\n  const h = Array.from(n.values());\n  return u.fromJSON({\n    routeResults: h,\n    barriers: d,\n    polygonBarriers: y,\n    polylineBarriers: g,\n    messages: R\n  });\n}\n\nexport { p as solve };","map":{"version":3,"sources":["D:/Github/CUSP_DataBase/CUSP_DB/src/main/gis/node_modules/@arcgis/core/rest/route.js"],"names":["e","isSome","t","createQueryParamsHelper","r","normalizeCentralMeridian","s","collectGeometries","i","isInputGeometryZAware","o","fetchServiceDescription","a","dropZValuesOffInputGeometry","n","parseUrl","l","u","f","accumulateAttributes","name","attributeParameterValues","directionsTimeAttribute","impedanceAttribute","outSpatialReference","getter","wkid","pointBarriers","polylineBarriers","polygonBarriers","restrictionAttributes","stops","travelMode","c","declaredClass","p","d","y","g","R","path","v","features","b","push","slice","apiKey","hasZ","forEach","get","geometry","h","query","toQueryParams","A","endsWith","data","B","m","Map","directionLines","directionPoints","directions","routes","barriers","messages","spatialReference","attributes","Name","ObjectID","has","route","routeId","set","routeName","RouteName","every","length","Array","from","keys","delete","RouteID","values","find","fieldAliases","geometryType","fromJSON","routeResults","solve"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport e from\"../request.js\";import{isSome as t}from\"../core/maybe.js\";import{createQueryParamsHelper as r}from\"../core/queryUtils.js\";import{normalizeCentralMeridian as s}from\"../geometry/support/normalizeUtils.js\";import{collectGeometries as i,isInputGeometryZAware as o,fetchServiceDescription as a,dropZValuesOffInputGeometry as n}from\"./networkService.js\";import{parseUrl as l}from\"./utils.js\";import u from\"./support/RouteSolveResult.js\";const f=r({accumulateAttributes:{name:\"accumulateAttributeNames\"},attributeParameterValues:!0,directionsTimeAttribute:{name:\"directionsTimeAttributeName\"},impedanceAttribute:{name:\"impedanceAttributeName\"},outSpatialReference:{name:\"outSR\",getter:e=>e.outSpatialReference.wkid},pointBarriers:{name:\"barriers\"},polylineBarriers:!0,polygonBarriers:!0,restrictionAttributes:{name:\"restrictionAttributeNames\"},stops:!0,travelMode:!0});function c(e){return\"esri.rest.support.FeatureSet\"===(null==e?void 0:e.declaredClass)}async function p(t,r,u){const p=[],d=[],y={},g={},R=l(t),{path:v}=R;c(r.stops)&&i(r.stops.features,d,\"stops.features\",y),c(r.pointBarriers)&&i(r.pointBarriers.features,d,\"pointBarriers.features\",y),c(r.polylineBarriers)&&i(r.polylineBarriers.features,d,\"polylineBarriers.features\",y),c(r.polygonBarriers)&&i(r.polygonBarriers.features,d,\"polygonBarriers.features\",y);const b=await s(d);for(const e in y){const t=y[e];p.push(e),g[e]=b.slice(t[0],t[1])}if(o(g,p)){let e=null;try{e=await a(v,r.apiKey,u)}catch{}e&&!e.hasZ&&n(g,p)}for(const e in g)g[e].forEach(((t,s)=>{r.get(e)[s].geometry=t}));const h={...u,query:{...R.query,...f.toQueryParams(r),f:\"json\"}},A=v.endsWith(\"/solve\")?v:`${v}/solve`,{data:B}=await e(A,h);return m(B)}function m(e){var r,s,i,o,a;const n=new Map,{directionLines:l,directionPoints:f,directions:c,routes:p,stops:m,barriers:d,polygonBarriers:y,polylineBarriers:g,messages:R}=e,v=null!=(r=null!=(s=null!=(i=null!=(o=null==p?void 0:p.spatialReference)?o:null==m?void 0:m.spatialReference)?i:null==d?void 0:d.spatialReference)?s:null==y?void 0:y.spatialReference)?r:null==g?void 0:g.spatialReference;null==p||p.features.forEach((e=>{const r=e.attributes.Name,s=e.attributes.ObjectID;n.has(r)?(n.get(r).route=e,n.get(r).routeId=s):n.set(r,{route:e,routeId:s,routeName:r}),t(e.geometry)&&(e.geometry.spatialReference=v)})),null==c||c.forEach((e=>{const t=e.routeName;n.has(t)?n.get(t).directions=e:n.set(t,{routeName:t,directions:e})})),null==m||m.features.forEach((e=>{var r;const s=null!=(r=e.attributes.RouteName)?r:null;n.has(s)?n.get(s).stops?n.get(s).stops.push(e):n.get(s).stops=[e]:n.set(s,{stops:[e],routeName:s}),t(e.geometry)&&(e.geometry.spatialReference=v)}));const b=null==(a=null==m?void 0:m.features.every((e=>null==e.attributes.RouteName)))||a;if((null==m?void 0:m.features.length)>0&&b){const e=Array.from(n.keys())[0];n.get(e).stops=n.get(null).stops,n.delete(null)}null==l||l.features.forEach((e=>{var t;const r=e.attributes.RouteID,s=null==(t=Array.from(n.values()).find((e=>e.routeId===r)))?void 0:t.routeName;if(s)if(n.has(s))if(n.get(s).directionLines)n.get(s).directionLines.features.push(e);else{const{fieldAliases:t,geometryType:r,spatialReference:i}=l;n.get(s).directionLines={features:[e],fieldAliases:t,geometryType:r,spatialReference:i}}else{const{fieldAliases:t,geometryType:r,spatialReference:i}=l;n.set(s,{routeName:s,directionLines:{features:[e],fieldAliases:t,geometryType:r,spatialReference:i}})}})),null==f||f.features.forEach((e=>{var t;const r=e.attributes.RouteID,s=null==(t=Array.from(n.values()).find((e=>e.routeId===r)))?void 0:t.routeName;if(s)if(n.has(s))if(n.get(s).directionPoints)n.get(s).directionPoints.features.push(e);else{const{fieldAliases:t,geometryType:r,spatialReference:i}=f;n.get(s).directionPoints={features:[e],fieldAliases:t,geometryType:r,spatialReference:i}}else{const{fieldAliases:t,geometryType:r,spatialReference:i}=f;n.set(s,{routeName:s,directionPoints:{features:[e],fieldAliases:t,geometryType:r,spatialReference:i}})}}));const h=Array.from(n.values());return u.fromJSON({routeResults:h,barriers:d,polygonBarriers:y,polylineBarriers:g,messages:R})}export{p as solve};\n"]},"metadata":{},"sourceType":"module"}