{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../chunks/tslib.es6.js\";\nimport { deprecatedProperty as t } from \"../../core/deprecate.js\";\nimport r from \"../../core/Error.js\";\nimport i from \"../../core/Logger.js\";\nimport { isSome as s, isNone as o } from \"../../core/maybe.js\";\nimport { eachAlways as a } from \"../../core/promiseUtils.js\";\nimport { init as n, on as l } from \"../../core/watchUtils.js\";\nimport { property as u } from \"../../core/accessorSupport/decorators/property.js\";\nimport \"../../core/arrayUtils.js\";\nimport \"../../core/has.js\";\nimport \"../../core/accessorSupport/ensureType.js\";\nimport { subclass as p } from \"../../core/accessorSupport/decorators/subclass.js\";\nimport { combinedViewLayerTimeExtentProperty as f } from \"../../layers/support/commonProperties.js\";\nimport d from \"../../layers/support/FeatureEffect.js\";\nimport c from \"../../layers/support/FeatureFilter.js\";\nimport { fixFields as m, unpackFieldNames as y, collectLabelingFields as h, collectElevationFields as F, collectFilterFields as w, collectFeatureReductionFields as g, collectOrderByInfos as E, collectFields as x, collectField as v, featureHasFields as b } from \"../../layers/support/fieldUtils.js\";\nimport j from \"../../rest/support/Query.js\";\nimport { loadArcade as R } from \"../../support/arcadeOnDemand.js\";\nimport { getFetchPopupTemplate as q, getRequiredFields as I } from \"./support/popupUtils.js\";\nimport { getFloorFilterClause as _ } from \"../support/floorFilterUtils.js\";\n\nconst P = i.getLogger(\"esri.views.layers.FeatureLayerView\"),\n      O = i => {\n  let O = class extends i {\n    constructor() {\n      super(...arguments), this._updatingRequiredFieldsPromise = null, this.filter = null, this.timeExtent = null, this.layer = null, this.requiredFields = [], this.view = null;\n    }\n\n    initialize() {\n      n(this, [\"layer.renderer\", \"layer.labelingInfo\", \"layer.elevationInfo.featureExpressionInfo\", \"layer.displayField\", \"filter\", \"featureEffect\", \"layer.timeInfo\", \"layer.floorInfo\", \"timeExtent\"], () => this._handleRequiredFieldsChange(), !0), l(this, \"view.floors\", \"change\", () => this._handleRequiredFieldsChange()), l(this, \"layer.sublayer\", \"change\", () => this._handleRequiredFieldsChange());\n    }\n\n    get availableFields() {\n      const {\n        layer: e,\n        layer: {\n          fieldsIndex: t\n        },\n        requiredFields: r\n      } = this;\n      return \"outFields\" in e && e.outFields ? m(t, [...y(t, e.outFields), ...r]) : m(t, r);\n    }\n\n    set effect(e) {\n      t(P, \"effect\", {\n        replacement: \"featureEffect\",\n        version: \"4.22\"\n      }), this.featureEffect = e;\n    }\n\n    get effect() {\n      return t(P, \"effect\", {\n        replacement: \"featureEffect\",\n        version: \"4.22\"\n      }), this.featureEffect;\n    }\n\n    get featureEffect() {\n      return this.layer && \"featureEffect\" in this.layer ? this.layer.featureEffect : null;\n    }\n\n    set featureEffect(e) {\n      void 0 !== e ? this._override(\"featureEffect\", e) : this._clearOverride(\"featureEffect\");\n    }\n\n    get maximumNumberOfFeatures() {\n      return 0;\n    }\n\n    set maximumNumberOfFeatures(e) {\n      P.error(\"#maximumNumberOfFeatures=\", \"Setting maximum number of features is not supported\");\n    }\n\n    get maximumNumberOfFeaturesExceeded() {\n      return !1;\n    }\n\n    highlight(e) {\n      throw new Error(\"missing implementation\");\n    }\n\n    createQuery() {\n      const e = {\n        outFields: [\"*\"],\n        returnGeometry: !0,\n        outSpatialReference: this.view.spatialReference\n      },\n            t = s(this.filter) ? this.filter.createQuery(e) : new j(e);\n\n      if (\"feature\" === this.layer.type) {\n        const e = _(this);\n\n        s(e) && (t.where = t.where ? `(${t.where}) AND (${e})` : e);\n      }\n\n      return s(this.timeExtent) && (t.timeExtent = s(t.timeExtent) ? t.timeExtent.intersection(this.timeExtent) : this.timeExtent.clone()), t;\n    }\n\n    queryFeatures(e, t) {\n      throw new Error(\"missing implementation\");\n    }\n\n    queryObjectIds(e, t) {\n      throw new Error(\"missing implementation\");\n    }\n\n    queryFeatureCount(e, t) {\n      throw new Error(\"missing implementation\");\n    }\n\n    queryExtent(e, t) {\n      throw new Error(\"missing implementation\");\n    }\n\n    async fetchPopupFeatures(e, t) {\n      const r = this.validateFetchPopupFeatures(t);\n      if (r) throw r;\n      return this.fetchClientPopupFeatures(t);\n    }\n\n    _loadArcadeModules(e) {\n      if (e.get(\"expressionInfos.length\") || Array.isArray(e.content) && e.content.some(e => \"expression\" === e.type)) return R();\n    }\n\n    _handleRequiredFieldsChange() {\n      const e = this._updateRequiredFields();\n\n      this._set(\"_updatingRequiredFieldsPromise\", e), e.then(() => {\n        this._updatingRequiredFieldsPromise === e && this._set(\"_updatingRequiredFieldsPromise\", null);\n      });\n    }\n\n    async _updateRequiredFields() {\n      if (!this.layer || !this.view) return;\n      const e = \"3d\" === this.view.type,\n            {\n        layer: t,\n        layer: {\n          fieldsIndex: r,\n          objectIdField: i\n        }\n      } = this,\n            o = \"renderer\" in t && t.renderer,\n            n = \"orderBy\" in t && t.orderBy,\n            l = t.featureReduction,\n            u = new Set(),\n            p = await a([o ? o.collectRequiredFields(u, r) : null, h(u, t), e ? F(u, t) : null, s(this.filter) ? w(u, t, this.filter) : null, s(this.featureEffect) ? w(u, t, this.featureEffect.filter) : null, l ? g(u, t, l) : null, n ? E(u, t, n) : null]);\n\n      if (t.timeInfo && this.timeExtent && x(u, t.fieldsIndex, [t.timeInfo.startField, t.timeInfo.endField]), \"feature\" === t.type && t.floorInfo && x(u, t.fieldsIndex, [t.floorInfo.floorField]), \"subtype-group\" === t.type) {\n        v(u, r, t.subtypeField);\n        const e = t.sublayers.map(e => {\n          var t;\n          return Promise.all([null == (t = e.renderer) ? void 0 : t.collectRequiredFields(u, r), h(u, e)]);\n        });\n        await a(e);\n      }\n\n      for (const s of p) s.error && P.error(s.error);\n\n      v(u, r, i), e && \"displayField\" in t && t.displayField && v(u, r, t.displayField);\n      const f = Array.from(u).sort();\n\n      this._set(\"requiredFields\", f);\n    }\n\n    validateFetchPopupFeatures(e) {\n      if (o(e)) return null;\n\n      for (const t of e.clientGraphics) {\n        const i = t.layer;\n        if (\"popupEnabled\" in i && !i.popupEnabled) return new r(\"featurelayerview:fetchPopupFeatures\", \"Popups are disabled\", {\n          layer: i\n        });\n\n        if (\"popupTemplate\" in i) {\n          if (!q(i, e)) return new r(\"featurelayerview:fetchPopupFeatures\", \"Layer does not define a popup template\", {\n            layer: i\n          });\n        }\n\n        if (t.isAggregate && !(i.featureReduction && \"popupTemplate\" in i.featureReduction && i.featureReduction.popupEnabled && i.featureReduction.popupTemplate)) return new r(\"featurelayerview:fetchPopupFeatures\", \"Popups are disabled\", {\n          layer: i\n        });\n      }\n    }\n\n    async fetchClientPopupFeatures(e) {\n      const t = s(e) ? e.clientGraphics : null;\n      if (!t || 0 === t.length) return [];\n      const r = new Array(t.length),\n            i = new Map(),\n            o = await this.createPopupQuery(e);\n\n      for (let a = 0; a < t.length; a++) {\n        const n = t[a];\n\n        if (n.isAggregate) {\n          r[a] = n;\n          continue;\n        }\n\n        const {\n          layer: l\n        } = n;\n        if (!(\"popupEnabled\" in l)) continue;\n        const u = y(this.layer.fieldsIndex, o.outFields),\n              p = q(l, e);\n        if (!s(p)) continue;\n        const f = await this._loadArcadeModules(p);\n        f && f.arcadeUtils.hasGeometryOperations(p) || !b(u, n) ? i.set(n.getObjectId(), a) : r[a] = n;\n      }\n\n      if (\"stream\" === this.layer.type || 0 === i.size) return r.filter(Boolean);\n      o.objectIds = Array.from(i.keys());\n\n      try {\n        const e = await this.layer.queryFeatures(o);\n\n        for (const t of e.features) {\n          r[i.get(t.getObjectId())] = t;\n        }\n      } catch {}\n\n      return r.filter(Boolean);\n    }\n\n    async createPopupQuery(e) {\n      const t = this.layer.createQuery(),\n            r = new Set();\n      let i = !1;\n      const o = s(e) && e.clientGraphics ? e.clientGraphics.map(e => e.layer) : [this.layer];\n\n      for (const a of o) {\n        if (!(\"popupEnabled\" in a)) continue;\n        const t = q(a, e);\n        if (!s(t)) continue;\n        const o = await this._loadArcadeModules(t),\n              n = o && o.arcadeUtils.hasGeometryOperations(t);\n        i = !(\"point\" !== this.layer.geometryType && !n);\n        const l = await I(this.layer, t);\n\n        for (const e of l) r.add(e);\n      }\n\n      if (t.returnGeometry = i, t.returnZ = i, t.returnM = i, t.outFields = Array.from(r), t.outSpatialReference = this.view.spatialReference, \"feature\" === this.layer.type) {\n        const e = _(this);\n\n        s(e) && (t.where = t.where ? `(${t.where}) AND (${e})` : e);\n      }\n\n      return t;\n    }\n\n    canResume() {\n      return !!super.canResume() && (!s(this.timeExtent) || !this.timeExtent.isEmpty);\n    }\n\n  };\n  return e([u()], O.prototype, \"_updatingRequiredFieldsPromise\", void 0), e([u({\n    readOnly: !0\n  })], O.prototype, \"availableFields\", null), e([u()], O.prototype, \"effect\", null), e([u({\n    type: d\n  })], O.prototype, \"featureEffect\", null), e([u({\n    type: c\n  })], O.prototype, \"filter\", void 0), e([u(f)], O.prototype, \"timeExtent\", void 0), e([u()], O.prototype, \"layer\", void 0), e([u({\n    type: Number\n  })], O.prototype, \"maximumNumberOfFeatures\", null), e([u({\n    readOnly: !0,\n    type: Boolean\n  })], O.prototype, \"maximumNumberOfFeaturesExceeded\", null), e([u({\n    readOnly: !0\n  })], O.prototype, \"requiredFields\", void 0), e([u()], O.prototype, \"suspended\", void 0), e([u()], O.prototype, \"view\", void 0), O = e([p(\"esri.views.layers.FeatureLayerView\")], O), O;\n};\n\nexport { O as FeatureLayerView, O as default };","map":{"version":3,"sources":["D:/Github/CUSP_DataBase/CUSP_DB/src/main/gis/node_modules/@arcgis/core/views/layers/FeatureLayerView.js"],"names":["_","e","deprecatedProperty","t","r","i","isSome","s","isNone","o","eachAlways","a","init","n","on","l","property","u","subclass","p","combinedViewLayerTimeExtentProperty","f","d","c","fixFields","m","unpackFieldNames","y","collectLabelingFields","h","collectElevationFields","F","collectFilterFields","w","collectFeatureReductionFields","g","collectOrderByInfos","E","collectFields","x","collectField","v","featureHasFields","b","j","loadArcade","R","getFetchPopupTemplate","q","getRequiredFields","I","getFloorFilterClause","P","getLogger","O","constructor","_updatingRequiredFieldsPromise","filter","timeExtent","layer","requiredFields","view","initialize","_handleRequiredFieldsChange","availableFields","fieldsIndex","outFields","effect","replacement","version","featureEffect","_override","_clearOverride","maximumNumberOfFeatures","error","maximumNumberOfFeaturesExceeded","highlight","Error","createQuery","returnGeometry","outSpatialReference","spatialReference","type","where","intersection","clone","queryFeatures","queryObjectIds","queryFeatureCount","queryExtent","fetchPopupFeatures","validateFetchPopupFeatures","fetchClientPopupFeatures","_loadArcadeModules","get","Array","isArray","content","some","_updateRequiredFields","_set","then","objectIdField","renderer","orderBy","featureReduction","Set","collectRequiredFields","timeInfo","startField","endField","floorInfo","floorField","subtypeField","sublayers","map","Promise","all","displayField","from","sort","clientGraphics","popupEnabled","isAggregate","popupTemplate","length","Map","createPopupQuery","arcadeUtils","hasGeometryOperations","set","getObjectId","size","Boolean","objectIds","keys","features","geometryType","add","returnZ","returnM","canResume","isEmpty","prototype","readOnly","Number","FeatureLayerView","default"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import{deprecatedProperty as t}from\"../../core/deprecate.js\";import r from\"../../core/Error.js\";import i from\"../../core/Logger.js\";import{isSome as s,isNone as o}from\"../../core/maybe.js\";import{eachAlways as a}from\"../../core/promiseUtils.js\";import{init as n,on as l}from\"../../core/watchUtils.js\";import{property as u}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/arrayUtils.js\";import\"../../core/has.js\";import\"../../core/accessorSupport/ensureType.js\";import{subclass as p}from\"../../core/accessorSupport/decorators/subclass.js\";import{combinedViewLayerTimeExtentProperty as f}from\"../../layers/support/commonProperties.js\";import d from\"../../layers/support/FeatureEffect.js\";import c from\"../../layers/support/FeatureFilter.js\";import{fixFields as m,unpackFieldNames as y,collectLabelingFields as h,collectElevationFields as F,collectFilterFields as w,collectFeatureReductionFields as g,collectOrderByInfos as E,collectFields as x,collectField as v,featureHasFields as b}from\"../../layers/support/fieldUtils.js\";import j from\"../../rest/support/Query.js\";import{loadArcade as R}from\"../../support/arcadeOnDemand.js\";import{getFetchPopupTemplate as q,getRequiredFields as I}from\"./support/popupUtils.js\";import{getFloorFilterClause as _}from\"../support/floorFilterUtils.js\";const P=i.getLogger(\"esri.views.layers.FeatureLayerView\"),O=i=>{let O=class extends i{constructor(...e){super(...e),this._updatingRequiredFieldsPromise=null,this.filter=null,this.timeExtent=null,this.layer=null,this.requiredFields=[],this.view=null}initialize(){n(this,[\"layer.renderer\",\"layer.labelingInfo\",\"layer.elevationInfo.featureExpressionInfo\",\"layer.displayField\",\"filter\",\"featureEffect\",\"layer.timeInfo\",\"layer.floorInfo\",\"timeExtent\"],(()=>this._handleRequiredFieldsChange()),!0),l(this,\"view.floors\",\"change\",(()=>this._handleRequiredFieldsChange())),l(this,\"layer.sublayer\",\"change\",(()=>this._handleRequiredFieldsChange()))}get availableFields(){const{layer:e,layer:{fieldsIndex:t},requiredFields:r}=this;return\"outFields\"in e&&e.outFields?m(t,[...y(t,e.outFields),...r]):m(t,r)}set effect(e){t(P,\"effect\",{replacement:\"featureEffect\",version:\"4.22\"}),this.featureEffect=e}get effect(){return t(P,\"effect\",{replacement:\"featureEffect\",version:\"4.22\"}),this.featureEffect}get featureEffect(){return this.layer&&\"featureEffect\"in this.layer?this.layer.featureEffect:null}set featureEffect(e){void 0!==e?this._override(\"featureEffect\",e):this._clearOverride(\"featureEffect\")}get maximumNumberOfFeatures(){return 0}set maximumNumberOfFeatures(e){P.error(\"#maximumNumberOfFeatures=\",\"Setting maximum number of features is not supported\")}get maximumNumberOfFeaturesExceeded(){return!1}highlight(e){throw new Error(\"missing implementation\")}createQuery(){const e={outFields:[\"*\"],returnGeometry:!0,outSpatialReference:this.view.spatialReference},t=s(this.filter)?this.filter.createQuery(e):new j(e);if(\"feature\"===this.layer.type){const e=_(this);s(e)&&(t.where=t.where?`(${t.where}) AND (${e})`:e)}return s(this.timeExtent)&&(t.timeExtent=s(t.timeExtent)?t.timeExtent.intersection(this.timeExtent):this.timeExtent.clone()),t}queryFeatures(e,t){throw new Error(\"missing implementation\")}queryObjectIds(e,t){throw new Error(\"missing implementation\")}queryFeatureCount(e,t){throw new Error(\"missing implementation\")}queryExtent(e,t){throw new Error(\"missing implementation\")}async fetchPopupFeatures(e,t){const r=this.validateFetchPopupFeatures(t);if(r)throw r;return this.fetchClientPopupFeatures(t)}_loadArcadeModules(e){if(e.get(\"expressionInfos.length\")||Array.isArray(e.content)&&e.content.some((e=>\"expression\"===e.type)))return R()}_handleRequiredFieldsChange(){const e=this._updateRequiredFields();this._set(\"_updatingRequiredFieldsPromise\",e),e.then((()=>{this._updatingRequiredFieldsPromise===e&&this._set(\"_updatingRequiredFieldsPromise\",null)}))}async _updateRequiredFields(){if(!this.layer||!this.view)return;const e=\"3d\"===this.view.type,{layer:t,layer:{fieldsIndex:r,objectIdField:i}}=this,o=\"renderer\"in t&&t.renderer,n=\"orderBy\"in t&&t.orderBy,l=t.featureReduction,u=new Set,p=await a([o?o.collectRequiredFields(u,r):null,h(u,t),e?F(u,t):null,s(this.filter)?w(u,t,this.filter):null,s(this.featureEffect)?w(u,t,this.featureEffect.filter):null,l?g(u,t,l):null,n?E(u,t,n):null]);if(t.timeInfo&&this.timeExtent&&x(u,t.fieldsIndex,[t.timeInfo.startField,t.timeInfo.endField]),\"feature\"===t.type&&t.floorInfo&&x(u,t.fieldsIndex,[t.floorInfo.floorField]),\"subtype-group\"===t.type){v(u,r,t.subtypeField);const e=t.sublayers.map((e=>{var t;return Promise.all([null==(t=e.renderer)?void 0:t.collectRequiredFields(u,r),h(u,e)])}));await a(e)}for(const s of p)s.error&&P.error(s.error);v(u,r,i),e&&\"displayField\"in t&&t.displayField&&v(u,r,t.displayField);const f=Array.from(u).sort();this._set(\"requiredFields\",f)}validateFetchPopupFeatures(e){if(o(e))return null;for(const t of e.clientGraphics){const i=t.layer;if(\"popupEnabled\"in i&&!i.popupEnabled)return new r(\"featurelayerview:fetchPopupFeatures\",\"Popups are disabled\",{layer:i});if(\"popupTemplate\"in i){if(!q(i,e))return new r(\"featurelayerview:fetchPopupFeatures\",\"Layer does not define a popup template\",{layer:i})}if(t.isAggregate&&!(i.featureReduction&&\"popupTemplate\"in i.featureReduction&&i.featureReduction.popupEnabled&&i.featureReduction.popupTemplate))return new r(\"featurelayerview:fetchPopupFeatures\",\"Popups are disabled\",{layer:i})}}async fetchClientPopupFeatures(e){const t=s(e)?e.clientGraphics:null;if(!t||0===t.length)return[];const r=new Array(t.length),i=new Map,o=await this.createPopupQuery(e);for(let a=0;a<t.length;a++){const n=t[a];if(n.isAggregate){r[a]=n;continue}const{layer:l}=n;if(!(\"popupEnabled\"in l))continue;const u=y(this.layer.fieldsIndex,o.outFields),p=q(l,e);if(!s(p))continue;const f=await this._loadArcadeModules(p);f&&f.arcadeUtils.hasGeometryOperations(p)||!b(u,n)?i.set(n.getObjectId(),a):r[a]=n}if(\"stream\"===this.layer.type||0===i.size)return r.filter(Boolean);o.objectIds=Array.from(i.keys());try{const e=await this.layer.queryFeatures(o);for(const t of e.features){r[i.get(t.getObjectId())]=t}}catch{}return r.filter(Boolean)}async createPopupQuery(e){const t=this.layer.createQuery(),r=new Set;let i=!1;const o=s(e)&&e.clientGraphics?e.clientGraphics.map((e=>e.layer)):[this.layer];for(const a of o){if(!(\"popupEnabled\"in a))continue;const t=q(a,e);if(!s(t))continue;const o=await this._loadArcadeModules(t),n=o&&o.arcadeUtils.hasGeometryOperations(t);i=!(\"point\"!==this.layer.geometryType&&!n);const l=await I(this.layer,t);for(const e of l)r.add(e)}if(t.returnGeometry=i,t.returnZ=i,t.returnM=i,t.outFields=Array.from(r),t.outSpatialReference=this.view.spatialReference,\"feature\"===this.layer.type){const e=_(this);s(e)&&(t.where=t.where?`(${t.where}) AND (${e})`:e)}return t}canResume(){return!!super.canResume()&&(!s(this.timeExtent)||!this.timeExtent.isEmpty)}};return e([u()],O.prototype,\"_updatingRequiredFieldsPromise\",void 0),e([u({readOnly:!0})],O.prototype,\"availableFields\",null),e([u()],O.prototype,\"effect\",null),e([u({type:d})],O.prototype,\"featureEffect\",null),e([u({type:c})],O.prototype,\"filter\",void 0),e([u(f)],O.prototype,\"timeExtent\",void 0),e([u()],O.prototype,\"layer\",void 0),e([u({type:Number})],O.prototype,\"maximumNumberOfFeatures\",null),e([u({readOnly:!0,type:Boolean})],O.prototype,\"maximumNumberOfFeaturesExceeded\",null),e([u({readOnly:!0})],O.prototype,\"requiredFields\",void 0),e([u()],O.prototype,\"suspended\",void 0),e([u()],O.prototype,\"view\",void 0),O=e([p(\"esri.views.layers.FeatureLayerView\")],O),O};export{O as FeatureLayerView,O as default};\n"]},"metadata":{},"sourceType":"module"}