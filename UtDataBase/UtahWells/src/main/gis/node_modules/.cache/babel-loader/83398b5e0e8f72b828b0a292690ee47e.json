{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport \"../../../../../geometry.js\";\nimport e from \"../../../../../core/has.js\";\nimport { isSome as t, isNone as r, unwrapOr as s } from \"../../../../../core/maybe.js\";\nimport { getCentroidOptimizedGeometry as i } from \"../../../../../layers/graphics/centroid.js\";\nimport { convertToGeometry as o } from \"../../../../../layers/graphics/featureConversionUtils.js\";\nimport n from \"../../../../../layers/graphics/OptimizedGeometry.js\";\nimport { StaticBitSet as a } from \"./StaticBitSet.js\";\nimport { fromJSON as d } from \"../../../../../geometry/support/jsonUtils.js\";\nvar h, u, l;\nlet c = 0;\nconst m = null != (h = e(\"featurelayer-simplify-thresholds\")) ? h : [.5, .5, .5, .5],\n      g = m[0],\n      _ = m[1],\n      y = m[2],\n      p = m[3],\n      f = null != (u = e(\"featurelayer-simplify-payload-size-factors\")) ? u : [1, 2, 4],\n      I = f[0],\n      x = f[1],\n      A = f[2],\n      S = null != (l = e(\"featurelayer-simplify-mobile-factor\")) ? l : 2,\n      b = e(\"esri-mobile\");\n\nclass j {\n  constructor(e, t) {\n    this.type = \"FeatureSetReader\", this.arcadeDeclaredClass = \"esri.arcade.Feature\", this.seen = !1, this.instance = 0, this._tx = 0, this._ty = 0, this._sx = 1, this._sy = 1, this._deleted = null, this._joined = [], this._objectIdToIndex = null, this._level = 0, this.instance = e, this._layerSchema = t;\n  }\n\n  static createInstance() {\n    return c++, c = c > 65535 ? 0 : c, c;\n  }\n\n  get isEmpty() {\n    return t(this._deleted) && this._deleted.countSet() === this.getSize();\n  }\n\n  set level(e) {\n    this._level = e;\n  }\n\n  getAreaSimplificationThreshold(e, t) {\n    let r = 1;\n    const s = b ? S : 1;\n    t > 4e6 ? r = A * s : t > 1e6 ? r = x * s : t > 5e5 ? r = I * s : t > 1e5 && (r = s);\n    let i = 0;\n    e > 4e3 ? i = p * r : e > 2e3 ? i = y * r : e > 100 ? i = _ : e > 15 && (i = g);\n    let o = 8;\n    return this._level < 4 ? o = 1 : this._level < 5 ? o = 2 : this._level < 6 && (o = 4), i * o;\n  }\n\n  setArcadeSpatialReference(e) {\n    this._arcadeSpatialReference = e;\n  }\n\n  attachStorage(e) {\n    this._storage = e;\n  }\n\n  getQuantizationTransform() {\n    throw new Error(\"Unable to find transform for featureSet\");\n  }\n\n  getStorage() {\n    return this._storage;\n  }\n\n  getComputedNumeric(e) {\n    return this.getComputedNumericAtIndex(0);\n  }\n\n  setComputedNumeric(e, t) {\n    return this.setComputedNumericAtIndex(t, 0);\n  }\n\n  getComputedString(e) {\n    return this.getComputedStringAtIndex(0);\n  }\n\n  setComputedString(e, t) {\n    return this.setComputedStringAtIndex(0, t);\n  }\n\n  getComputedNumericAtIndex(e) {\n    return this._storage.getComputedNumericAtIndex(this.getDisplayId(), e);\n  }\n\n  setComputedNumericAtIndex(e, t) {\n    this._storage.setComputedNumericAtIndex(this.getDisplayId(), e, t);\n  }\n\n  getComputedStringAtIndex(e) {\n    return this._storage.getComputedStringAtIndex(this.getDisplayId(), e);\n  }\n\n  setComputedStringAtIndex(e, t) {\n    return this._storage.setComputedStringAtIndex(this.getDisplayId(), e, t);\n  }\n\n  transform(e, t, r, s) {\n    const i = this.copy();\n    return i._tx += e, i._ty += t, i._sx *= r, i._sy *= s, i;\n  }\n\n  readAttribute(e) {\n    let t = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : !1;\n\n    const r = this._readAttribute(e, t);\n\n    if (void 0 !== r) return r;\n\n    for (const s of this._joined) {\n      s.setIndex(this.getIndex());\n\n      const r = s._readAttribute(e, t);\n\n      if (void 0 !== r) return r;\n    }\n  }\n\n  readAttributes() {\n    const e = this._readAttributes();\n\n    for (const t of this._joined) {\n      t.setIndex(this.getIndex());\n\n      const r = t._readAttributes();\n\n      for (const t of Object.keys(r)) e[t] = r[t];\n    }\n\n    return e;\n  }\n\n  joinAttributes(e) {\n    this._joined.push(e);\n  }\n\n  readArcadeFeature() {\n    return this;\n  }\n\n  geometry() {\n    const e = this.readHydratedGeometry(),\n          t = o(e, this.geometryType, this.hasZ, this.hasM),\n          r = d(t);\n    return r && (r.spatialReference = this._arcadeSpatialReference), r;\n  }\n\n  field(e) {\n    if (this.hasField(e)) return this.readAttribute(e, !0);\n\n    for (const t of this._joined) if (t.setIndex(this.getIndex()), t.hasField(e)) {\n      return t._readAttribute(e, !0);\n    }\n\n    throw new Error(`Field ${e} does not exist`);\n  }\n\n  setField(e, t) {\n    throw new Error(\"Unable to update feature attribute values, feature is readonly\");\n  }\n\n  keys() {\n    return this.getFieldNames();\n  }\n\n  castToText() {\n    return JSON.stringify(this.readLegacyFeature());\n  }\n\n  gdbVersion() {\n    return null;\n  }\n\n  fullSchema() {\n    return this._layerSchema;\n  }\n\n  castAsJson() {\n    let e = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;\n    return {\n      attributes: this._readAttributes(),\n      geometry: !0 === (null == e ? void 0 : e.keepGeometryType) ? this.geometry() : this.geometry().toJSON()\n    };\n  }\n\n  castAsJsonAsync() {\n    let e = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;\n    let t = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n    return Promise.resolve(this.castAsJson(t));\n  }\n\n  removeIds(e) {\n    if (r(this._objectIdToIndex)) {\n      const e = new Map(),\n            t = this.getCursor();\n\n      for (; t.next();) e.set(t.getObjectId(), t.getIndex());\n\n      this._objectIdToIndex = e;\n    }\n\n    const t = this._objectIdToIndex;\n\n    for (const r of e) t.has(r) && this.removeAtIndex(t.get(r));\n  }\n\n  removeAtIndex(e) {\n    r(this._deleted) && (this._deleted = a.create(this.getSize())), this._deleted.set(e);\n  }\n\n  readGeometryForDisplay() {\n    return this.readUnquantizedGeometry(!0);\n  }\n\n  readLegacyGeometryForDisplay() {\n    return this.readLegacyGeometry(!0);\n  }\n\n  *features() {\n    const e = this.getCursor();\n\n    for (; e.next();) yield e.readOptimizedFeature();\n  }\n\n  _getExists() {\n    return r(this._deleted) || !this._deleted.has(this.getIndex());\n  }\n\n  _computeCentroid() {\n    if (\"esriGeometryPolygon\" !== this.geometryType) return null;\n    const e = this.readUnquantizedGeometry();\n    if (!e || e.hasIndeterminateRingOrder) return null;\n    const t = s(this.getQuantizationTransform(), null);\n    return i(new n(), e, this.hasM, this.hasZ, t);\n  }\n\n  copyInto(e) {\n    e.seen = this.seen, e._storage = this._storage, e._arcadeSpatialReference = this._arcadeSpatialReference, e._joined = this._joined, e._tx = this._tx, e._ty = this._ty, e._sx = this._sx, e._sy = this._sy, e._deleted = this._deleted, e._objectIdToIndex = this._objectIdToIndex;\n  }\n\n}\n\nexport { j as FeatureSetReader };","map":{"version":3,"sources":["D:/Github/CUSP_DataBase/CUSP_DB/src/main/gis/node_modules/@arcgis/core/views/2d/layers/features/support/FeatureSetReader.js"],"names":["e","isSome","t","isNone","r","unwrapOr","s","getCentroidOptimizedGeometry","i","convertToGeometry","o","n","StaticBitSet","a","fromJSON","d","h","u","l","c","m","g","_","y","p","f","I","x","A","S","b","j","constructor","type","arcadeDeclaredClass","seen","instance","_tx","_ty","_sx","_sy","_deleted","_joined","_objectIdToIndex","_level","_layerSchema","createInstance","isEmpty","countSet","getSize","level","getAreaSimplificationThreshold","setArcadeSpatialReference","_arcadeSpatialReference","attachStorage","_storage","getQuantizationTransform","Error","getStorage","getComputedNumeric","getComputedNumericAtIndex","setComputedNumeric","setComputedNumericAtIndex","getComputedString","getComputedStringAtIndex","setComputedString","setComputedStringAtIndex","getDisplayId","transform","copy","readAttribute","_readAttribute","setIndex","getIndex","readAttributes","_readAttributes","Object","keys","joinAttributes","push","readArcadeFeature","geometry","readHydratedGeometry","geometryType","hasZ","hasM","spatialReference","field","hasField","setField","getFieldNames","castToText","JSON","stringify","readLegacyFeature","gdbVersion","fullSchema","castAsJson","attributes","keepGeometryType","toJSON","castAsJsonAsync","Promise","resolve","removeIds","Map","getCursor","next","set","getObjectId","has","removeAtIndex","get","create","readGeometryForDisplay","readUnquantizedGeometry","readLegacyGeometryForDisplay","readLegacyGeometry","features","readOptimizedFeature","_getExists","_computeCentroid","hasIndeterminateRingOrder","copyInto","FeatureSetReader"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport\"../../../../../geometry.js\";import e from\"../../../../../core/has.js\";import{isSome as t,isNone as r,unwrapOr as s}from\"../../../../../core/maybe.js\";import{getCentroidOptimizedGeometry as i}from\"../../../../../layers/graphics/centroid.js\";import{convertToGeometry as o}from\"../../../../../layers/graphics/featureConversionUtils.js\";import n from\"../../../../../layers/graphics/OptimizedGeometry.js\";import{StaticBitSet as a}from\"./StaticBitSet.js\";import{fromJSON as d}from\"../../../../../geometry/support/jsonUtils.js\";var h,u,l;let c=0;const m=null!=(h=e(\"featurelayer-simplify-thresholds\"))?h:[.5,.5,.5,.5],g=m[0],_=m[1],y=m[2],p=m[3],f=null!=(u=e(\"featurelayer-simplify-payload-size-factors\"))?u:[1,2,4],I=f[0],x=f[1],A=f[2],S=null!=(l=e(\"featurelayer-simplify-mobile-factor\"))?l:2,b=e(\"esri-mobile\");class j{constructor(e,t){this.type=\"FeatureSetReader\",this.arcadeDeclaredClass=\"esri.arcade.Feature\",this.seen=!1,this.instance=0,this._tx=0,this._ty=0,this._sx=1,this._sy=1,this._deleted=null,this._joined=[],this._objectIdToIndex=null,this._level=0,this.instance=e,this._layerSchema=t}static createInstance(){return c++,c=c>65535?0:c,c}get isEmpty(){return t(this._deleted)&&this._deleted.countSet()===this.getSize()}set level(e){this._level=e}getAreaSimplificationThreshold(e,t){let r=1;const s=b?S:1;t>4e6?r=A*s:t>1e6?r=x*s:t>5e5?r=I*s:t>1e5&&(r=s);let i=0;e>4e3?i=p*r:e>2e3?i=y*r:e>100?i=_:e>15&&(i=g);let o=8;return this._level<4?o=1:this._level<5?o=2:this._level<6&&(o=4),i*o}setArcadeSpatialReference(e){this._arcadeSpatialReference=e}attachStorage(e){this._storage=e}getQuantizationTransform(){throw new Error(\"Unable to find transform for featureSet\")}getStorage(){return this._storage}getComputedNumeric(e){return this.getComputedNumericAtIndex(0)}setComputedNumeric(e,t){return this.setComputedNumericAtIndex(t,0)}getComputedString(e){return this.getComputedStringAtIndex(0)}setComputedString(e,t){return this.setComputedStringAtIndex(0,t)}getComputedNumericAtIndex(e){return this._storage.getComputedNumericAtIndex(this.getDisplayId(),e)}setComputedNumericAtIndex(e,t){this._storage.setComputedNumericAtIndex(this.getDisplayId(),e,t)}getComputedStringAtIndex(e){return this._storage.getComputedStringAtIndex(this.getDisplayId(),e)}setComputedStringAtIndex(e,t){return this._storage.setComputedStringAtIndex(this.getDisplayId(),e,t)}transform(e,t,r,s){const i=this.copy();return i._tx+=e,i._ty+=t,i._sx*=r,i._sy*=s,i}readAttribute(e,t=!1){const r=this._readAttribute(e,t);if(void 0!==r)return r;for(const s of this._joined){s.setIndex(this.getIndex());const r=s._readAttribute(e,t);if(void 0!==r)return r}}readAttributes(){const e=this._readAttributes();for(const t of this._joined){t.setIndex(this.getIndex());const r=t._readAttributes();for(const t of Object.keys(r))e[t]=r[t]}return e}joinAttributes(e){this._joined.push(e)}readArcadeFeature(){return this}geometry(){const e=this.readHydratedGeometry(),t=o(e,this.geometryType,this.hasZ,this.hasM),r=d(t);return r&&(r.spatialReference=this._arcadeSpatialReference),r}field(e){if(this.hasField(e))return this.readAttribute(e,!0);for(const t of this._joined)if(t.setIndex(this.getIndex()),t.hasField(e)){return t._readAttribute(e,!0)}throw new Error(`Field ${e} does not exist`)}setField(e,t){throw new Error(\"Unable to update feature attribute values, feature is readonly\")}keys(){return this.getFieldNames()}castToText(){return JSON.stringify(this.readLegacyFeature())}gdbVersion(){return null}fullSchema(){return this._layerSchema}castAsJson(e=null){return{attributes:this._readAttributes(),geometry:!0===(null==e?void 0:e.keepGeometryType)?this.geometry():this.geometry().toJSON()}}castAsJsonAsync(e=null,t=null){return Promise.resolve(this.castAsJson(t))}removeIds(e){if(r(this._objectIdToIndex)){const e=new Map,t=this.getCursor();for(;t.next();)e.set(t.getObjectId(),t.getIndex());this._objectIdToIndex=e}const t=this._objectIdToIndex;for(const r of e)t.has(r)&&this.removeAtIndex(t.get(r))}removeAtIndex(e){r(this._deleted)&&(this._deleted=a.create(this.getSize())),this._deleted.set(e)}readGeometryForDisplay(){return this.readUnquantizedGeometry(!0)}readLegacyGeometryForDisplay(){return this.readLegacyGeometry(!0)}*features(){const e=this.getCursor();for(;e.next();)yield e.readOptimizedFeature()}_getExists(){return r(this._deleted)||!this._deleted.has(this.getIndex())}_computeCentroid(){if(\"esriGeometryPolygon\"!==this.geometryType)return null;const e=this.readUnquantizedGeometry();if(!e||e.hasIndeterminateRingOrder)return null;const t=s(this.getQuantizationTransform(),null);return i(new n,e,this.hasM,this.hasZ,t)}copyInto(e){e.seen=this.seen,e._storage=this._storage,e._arcadeSpatialReference=this._arcadeSpatialReference,e._joined=this._joined,e._tx=this._tx,e._ty=this._ty,e._sx=this._sx,e._sy=this._sy,e._deleted=this._deleted,e._objectIdToIndex=this._objectIdToIndex}}export{j as FeatureSetReader};\n"]},"metadata":{},"sourceType":"module"}