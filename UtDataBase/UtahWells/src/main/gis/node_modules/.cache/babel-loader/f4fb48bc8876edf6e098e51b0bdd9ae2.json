{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport { neverReached as t } from \"../../../../core/compilerUtils.js\";\nimport e from \"../../../../core/Error.js\";\nimport r from \"../../../../core/Evented.js\";\nimport { isPowerOfTwo as i, nextHighestPowerOfTwo as s } from \"../../../../core/mathUtils.js\";\nimport { isNone as a, isSome as o, removeMaybe as n } from \"../../../../core/maybe.js\";\nimport { throwIfAborted as m, onAbort as h, createAbortError as l } from \"../../../../core/promiseUtils.js\";\nimport { isArrayBuffer as p, isUint8Array as d } from \"../../../../core/typedArrayUtil.js\";\nimport { isBlobProtocol as _, isDataProtocol as c } from \"../../../../core/urlUtils.js\";\nimport { requestImage as u } from \"../../../../support/requestImageUtils.js\";\nimport { loadImageAsync as T } from \"../../../../support/requestUtils.js\";\nimport { PowerOfTwoResizeMode as g } from \"./basicInterfaces.js\";\nimport { estimateMemoryKTX2 as f, estimateMemoryBasis as w, createTextureKTX2 as E, createTextureBasis as A } from \"./BasisUtil.js\";\nimport { ContentObject as x } from \"./ContentObject.js\";\nimport { ContentObjectType as D } from \"./ContentObjectType.js\";\nimport { createDDSTexture as I } from \"./DDSUtil.js\";\nimport { createQuadVAO as M } from \"./glUtil3D.js\";\nimport { assert as F } from \"./Util.js\";\nimport { TextureWrapMode as O, TextureType as N, PixelFormat as y, PixelType as R, TextureSamplingMode as U, TargetType as C, DepthStencilTargetType as b, PrimitiveType as P } from \"../../../webgl/enums.js\";\nimport { FramebufferObject as S } from \"../../../webgl/FramebufferObject.js\";\nimport { Texture as H } from \"../../../webgl/Texture.js\";\nimport { vertexCount as V } from \"../../../webgl/Util.js\";\nimport j from \"../../../webgl/capabilities/isWebGL2Context.js\";\n\nclass v extends x {\n  constructor(t, e) {\n    super(), this.data = t, this.type = D.Texture, this._glTexture = null, this._powerOfTwoStretchInfo = null, this._loadingPromise = null, this._loadingController = null, this.events = new r(), this.params = e || {}, this.params.mipmap = !1 !== this.params.mipmap, this.params.noUnpackFlip = this.params.noUnpackFlip || !1, this.params.preMultiplyAlpha = this.params.preMultiplyAlpha || !1, this.params.wrap = this.params.wrap || {\n      s: O.REPEAT,\n      t: O.REPEAT\n    }, this.params.powerOfTwoResizeMode = this.params.powerOfTwoResizeMode || g.STRETCH, this.estimatedTexMemRequired = v._estimateTexMemRequired(this.data, this.params), this._startPreload();\n  }\n\n  _startPreload() {\n    const t = this.data;\n    a(t) || (t instanceof HTMLVideoElement ? this._startPreloadVideoElement(t) : t instanceof HTMLImageElement && this._startPreloadImageElement(t));\n  }\n\n  _startPreloadVideoElement(t) {\n    _(t.src) || \"auto\" === t.preload && t.crossOrigin || (t.preload = \"auto\", t.crossOrigin = \"anonymous\", t.src = t.src);\n  }\n\n  _startPreloadImageElement(t) {\n    c(t.src) || _(t.src) || t.crossOrigin || (t.crossOrigin = \"anonymous\", t.src = t.src);\n  }\n\n  static _getDataDimensions(t) {\n    return t instanceof HTMLVideoElement ? {\n      width: t.videoWidth,\n      height: t.videoHeight\n    } : t;\n  }\n\n  static _estimateTexMemRequired(t, e) {\n    if (a(t)) return 0;\n    if (p(t) || d(t)) return e.encoding === v.KTX2_ENCODING ? f(t, e.mipmap) : e.encoding === v.BASIS_ENCODING ? w(t, e.mipmap) : t.byteLength;\n    const {\n      width: r,\n      height: i\n    } = t instanceof Image || t instanceof ImageData || t instanceof HTMLCanvasElement || t instanceof HTMLVideoElement ? v._getDataDimensions(t) : e;\n    return (e.mipmap ? 4 / 3 : 1) * r * i * (e.components || 4) || 0;\n  }\n\n  dispose() {\n    this.data = void 0;\n  }\n\n  get width() {\n    return this.params.width;\n  }\n\n  get height() {\n    return this.params.height;\n  }\n\n  _createDescriptor(t) {\n    var e;\n    return {\n      target: N.TEXTURE_2D,\n      pixelFormat: y.RGBA,\n      dataType: R.UNSIGNED_BYTE,\n      wrapMode: this.params.wrap,\n      flipped: !this.params.noUnpackFlip,\n      samplingMode: this.params.mipmap ? U.LINEAR_MIPMAP_LINEAR : U.LINEAR,\n      hasMipmap: this.params.mipmap,\n      preMultiplyAlpha: this.params.preMultiplyAlpha,\n      maxAnisotropy: null != (e = this.params.maxAnisotropy) ? e : this.params.mipmap ? t.parameters.maxMaxAnisotropy : 1\n    };\n  }\n\n  get glTexture() {\n    return this._glTexture;\n  }\n\n  load(t, e) {\n    if (o(this._glTexture)) return this._glTexture;\n    if (o(this._loadingPromise)) return this._loadingPromise;\n    const r = this.data;\n    return a(r) ? (this._glTexture = new H(t, this._createDescriptor(t), null), this._glTexture) : \"string\" == typeof r ? this._loadFromURL(t, e, r) : r instanceof Image ? this._loadFromImageElement(t, e, r) : r instanceof HTMLVideoElement ? this._loadFromVideoElement(t, e, r) : r instanceof ImageData || r instanceof HTMLCanvasElement ? this._loadFromImage(t, r, e) : (p(r) || d(r)) && this.params.encoding === v.DDS_ENCODING ? (this.data = void 0, this._loadFromDDSData(t, r)) : (p(r) || d(r)) && this.params.encoding === v.KTX2_ENCODING ? (this.data = void 0, this._loadFromKTX2(t, r)) : (p(r) || d(r)) && this.params.encoding === v.BASIS_ENCODING ? (this.data = void 0, this._loadFromBasis(t, r)) : d(r) ? this._loadFromPixelData(t, r) : p(r) ? this._loadFromPixelData(t, new Uint8Array(r)) : null;\n  }\n\n  get requiresFrameUpdates() {\n    return this.data instanceof HTMLVideoElement;\n  }\n\n  frameUpdate(t, e, r) {\n    if (!(this.data instanceof HTMLVideoElement) || a(this._glTexture)) return r;\n    if (this.data.readyState < L.HAVE_CURRENT_DATA || r === this.data.currentTime) return r;\n\n    if (o(this._powerOfTwoStretchInfo)) {\n      const {\n        framebuffer: r,\n        vao: i,\n        sourceTexture: s\n      } = this._powerOfTwoStretchInfo;\n      s.setData(this.data), this._drawStretchedTexture(t, e, r, i, s, this._glTexture);\n    } else {\n      const {\n        width: t,\n        height: e\n      } = this.data,\n            {\n        width: r,\n        height: i\n      } = this._glTexture.descriptor;\n      t !== r || e !== i ? this._glTexture.updateData(0, 0, 0, Math.min(t, r), Math.min(e, i), this.data) : this._glTexture.setData(this.data);\n    }\n\n    return this._glTexture.descriptor.hasMipmap && this._glTexture.generateMipmap(), this.data.currentTime;\n  }\n\n  _loadFromDDSData(t, e) {\n    return this._glTexture = I(t, this._createDescriptor(t), e), this._glTexture;\n  }\n\n  _loadFromKTX2(t, e) {\n    return this._loadAsync(() => E(t, this._createDescriptor(t), e).then(t => (this._glTexture = t, t)));\n  }\n\n  _loadFromBasis(t, e) {\n    return this._loadAsync(() => A(t, this._createDescriptor(t), e).then(t => (this._glTexture = t, t)));\n  }\n\n  _loadFromPixelData(t, e) {\n    F(this.params.width > 0 && this.params.height > 0);\n\n    const r = this._createDescriptor(t);\n\n    return r.pixelFormat = 1 === this.params.components ? y.LUMINANCE : 3 === this.params.components ? y.RGB : y.RGBA, r.width = this.params.width, r.height = this.params.height, this._glTexture = new H(t, r, e), this._glTexture;\n  }\n\n  _loadFromURL(t, e, r) {\n    return this._loadAsync(async i => {\n      const s = await u(r, {\n        signal: i\n      });\n      return m(i), this._loadFromImage(t, s, e);\n    });\n  }\n\n  _loadFromImageElement(t, e, r) {\n    return r.complete ? this._loadFromImage(t, r, e) : this._loadAsync(async i => {\n      const s = await T(r, r.src, !1, i);\n      return m(i), this._loadFromImage(t, s, e);\n    });\n  }\n\n  _loadFromVideoElement(t, e, r) {\n    return r.readyState >= L.HAVE_CURRENT_DATA ? this._loadFromImage(t, r, e) : this._loadFromVideoElementAsync(t, e, r);\n  }\n\n  _loadFromVideoElementAsync(t, r, i) {\n    return this._loadAsync(s => new Promise((a, o) => {\n      const m = () => {\n        i.removeEventListener(\"loadeddata\", p), i.removeEventListener(\"error\", d), n(_);\n      },\n            p = () => {\n        i.readyState >= L.HAVE_CURRENT_DATA && (m(), a(this._loadFromImage(t, i, r)));\n      },\n            d = t => {\n        m(), o(t || new e(\"Failed to load video\"));\n      };\n\n      i.addEventListener(\"loadeddata\", p), i.addEventListener(\"error\", d);\n\n      const _ = h(s, () => d(l()));\n    }));\n  }\n\n  _loadFromImage(t, e, r) {\n    const s = v._getDataDimensions(e);\n\n    this.params.width = s.width, this.params.height = s.height;\n\n    const a = this._createDescriptor(t);\n\n    return a.pixelFormat = 3 === this.params.components ? y.RGB : y.RGBA, !this._requiresPowerOfTwo(t, a) || i(s.width) && i(s.height) ? (a.width = s.width, a.height = s.height, this._glTexture = new H(t, a, e), this._glTexture) : (this._glTexture = this._makePowerOfTwoTexture(t, e, s, a, r), this._glTexture);\n  }\n\n  _loadAsync(t) {\n    const e = new AbortController();\n    this._loadingController = e;\n    const r = t(e.signal);\n    this._loadingPromise = r;\n\n    const i = () => {\n      this._loadingController === e && (this._loadingController = null), this._loadingPromise === r && (this._loadingPromise = null);\n    };\n\n    return r.then(i, i), r;\n  }\n\n  _requiresPowerOfTwo(t, e) {\n    const r = O.CLAMP_TO_EDGE,\n          i = \"number\" == typeof e.wrapMode ? e.wrapMode === r : e.wrapMode.s === r && e.wrapMode.t === r;\n    return !j(t.gl) && (e.hasMipmap || !i);\n  }\n\n  _makePowerOfTwoTexture(e, r, i, a, o) {\n    const {\n      width: n,\n      height: m\n    } = i,\n          h = s(n),\n          l = s(m);\n    let p;\n\n    switch (a.width = h, a.height = l, this.params.powerOfTwoResizeMode) {\n      case g.PAD:\n        a.textureCoordinateScaleFactor = [n / h, m / l], p = new H(e, a), p.updateData(0, 0, 0, n, m, r);\n        break;\n\n      case g.STRETCH:\n      case null:\n      case void 0:\n        p = this._stretchToPowerOfTwo(e, r, a, o());\n        break;\n\n      default:\n        t(this.params.powerOfTwoResizeMode);\n    }\n\n    return a.hasMipmap && p.generateMipmap(), p;\n  }\n\n  _stretchToPowerOfTwo(t, e, r, i) {\n    const s = new H(t, r),\n          a = new S(t, {\n      colorTarget: C.TEXTURE,\n      depthStencilTarget: b.NONE\n    }, s),\n          o = new H(t, {\n      target: N.TEXTURE_2D,\n      pixelFormat: r.pixelFormat,\n      dataType: R.UNSIGNED_BYTE,\n      wrapMode: O.CLAMP_TO_EDGE,\n      samplingMode: U.LINEAR,\n      flipped: !!r.flipped,\n      maxAnisotropy: 8,\n      preMultiplyAlpha: r.preMultiplyAlpha\n    }, e),\n          n = M(t),\n          m = t.getBoundFramebufferObject();\n    return this._drawStretchedTexture(t, i, a, n, o, s), this.requiresFrameUpdates ? this._powerOfTwoStretchInfo = {\n      vao: n,\n      sourceTexture: o,\n      framebuffer: a\n    } : (n.dispose(!0), o.dispose(), a.detachColorTexture(), a.dispose()), t.bindFramebuffer(m), s;\n  }\n\n  _drawStretchedTexture(t, e, r, i, s, a) {\n    t.bindFramebuffer(r);\n    const o = t.getViewport();\n    t.setViewport(0, 0, a.descriptor.width, a.descriptor.height);\n    const n = t.useTechnique(e);\n    n.setUniform4f(\"uColor\", 1, 1, 1, 1), n.bindTexture(s, \"tex\"), t.bindVAO(i), t.drawArrays(P.TRIANGLE_STRIP, 0, V(i, \"geometry\")), t.bindFramebuffer(null), t.setViewport(o.x, o.y, o.width, o.height);\n  }\n\n  unload() {\n    if (o(this._powerOfTwoStretchInfo)) {\n      const {\n        framebuffer: t,\n        vao: e,\n        sourceTexture: r\n      } = this._powerOfTwoStretchInfo;\n      e.dispose(!0), r.dispose(), t.dispose(), this._glTexture = null, this._powerOfTwoStretchInfo = null;\n    }\n\n    if (o(this._glTexture) && (this._glTexture.dispose(), this._glTexture = null), o(this._loadingController)) {\n      const t = this._loadingController;\n      this._loadingController = null, this._loadingPromise = null, t.abort();\n    }\n\n    this.events.emit(\"unloaded\");\n  }\n\n}\n\nvar L;\nv.DDS_ENCODING = \"image/vnd-ms.dds\", v.KTX2_ENCODING = \"image/ktx2\", v.BASIS_ENCODING = \"image/x.basis\", function (t) {\n  t[t.HAVE_NOTHING = 0] = \"HAVE_NOTHING\", t[t.HAVE_METADATA = 1] = \"HAVE_METADATA\", t[t.HAVE_CURRENT_DATA = 2] = \"HAVE_CURRENT_DATA\", t[t.HAVE_FUTURE_DATA = 3] = \"HAVE_FUTURE_DATA\", t[t.HAVE_ENOUGH_DATA = 4] = \"HAVE_ENOUGH_DATA\";\n}(L || (L = {}));\nexport { v as Texture };","map":{"version":3,"sources":["D:/Github/CUSP_DataBase/CUSP_DB/src/main/gis/node_modules/@arcgis/core/views/3d/webgl-engine/lib/Texture.js"],"names":["neverReached","t","e","r","isPowerOfTwo","i","nextHighestPowerOfTwo","s","isNone","a","isSome","o","removeMaybe","n","throwIfAborted","m","onAbort","h","createAbortError","l","isArrayBuffer","p","isUint8Array","d","isBlobProtocol","_","isDataProtocol","c","requestImage","u","loadImageAsync","T","PowerOfTwoResizeMode","g","estimateMemoryKTX2","f","estimateMemoryBasis","w","createTextureKTX2","E","createTextureBasis","A","ContentObject","x","ContentObjectType","D","createDDSTexture","I","createQuadVAO","M","assert","F","TextureWrapMode","O","TextureType","N","PixelFormat","y","PixelType","R","TextureSamplingMode","U","TargetType","C","DepthStencilTargetType","b","PrimitiveType","P","FramebufferObject","S","Texture","H","vertexCount","V","j","v","constructor","data","type","_glTexture","_powerOfTwoStretchInfo","_loadingPromise","_loadingController","events","params","mipmap","noUnpackFlip","preMultiplyAlpha","wrap","REPEAT","powerOfTwoResizeMode","STRETCH","estimatedTexMemRequired","_estimateTexMemRequired","_startPreload","HTMLVideoElement","_startPreloadVideoElement","HTMLImageElement","_startPreloadImageElement","src","preload","crossOrigin","_getDataDimensions","width","videoWidth","height","videoHeight","encoding","KTX2_ENCODING","BASIS_ENCODING","byteLength","Image","ImageData","HTMLCanvasElement","components","dispose","_createDescriptor","target","TEXTURE_2D","pixelFormat","RGBA","dataType","UNSIGNED_BYTE","wrapMode","flipped","samplingMode","LINEAR_MIPMAP_LINEAR","LINEAR","hasMipmap","maxAnisotropy","parameters","maxMaxAnisotropy","glTexture","load","_loadFromURL","_loadFromImageElement","_loadFromVideoElement","_loadFromImage","DDS_ENCODING","_loadFromDDSData","_loadFromKTX2","_loadFromBasis","_loadFromPixelData","Uint8Array","requiresFrameUpdates","frameUpdate","readyState","L","HAVE_CURRENT_DATA","currentTime","framebuffer","vao","sourceTexture","setData","_drawStretchedTexture","descriptor","updateData","Math","min","generateMipmap","_loadAsync","then","LUMINANCE","RGB","signal","complete","_loadFromVideoElementAsync","Promise","removeEventListener","addEventListener","_requiresPowerOfTwo","_makePowerOfTwoTexture","AbortController","CLAMP_TO_EDGE","gl","PAD","textureCoordinateScaleFactor","_stretchToPowerOfTwo","colorTarget","TEXTURE","depthStencilTarget","NONE","getBoundFramebufferObject","detachColorTexture","bindFramebuffer","getViewport","setViewport","useTechnique","setUniform4f","bindTexture","bindVAO","drawArrays","TRIANGLE_STRIP","unload","abort","emit","HAVE_NOTHING","HAVE_METADATA","HAVE_FUTURE_DATA","HAVE_ENOUGH_DATA"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport{neverReached as t}from\"../../../../core/compilerUtils.js\";import e from\"../../../../core/Error.js\";import r from\"../../../../core/Evented.js\";import{isPowerOfTwo as i,nextHighestPowerOfTwo as s}from\"../../../../core/mathUtils.js\";import{isNone as a,isSome as o,removeMaybe as n}from\"../../../../core/maybe.js\";import{throwIfAborted as m,onAbort as h,createAbortError as l}from\"../../../../core/promiseUtils.js\";import{isArrayBuffer as p,isUint8Array as d}from\"../../../../core/typedArrayUtil.js\";import{isBlobProtocol as _,isDataProtocol as c}from\"../../../../core/urlUtils.js\";import{requestImage as u}from\"../../../../support/requestImageUtils.js\";import{loadImageAsync as T}from\"../../../../support/requestUtils.js\";import{PowerOfTwoResizeMode as g}from\"./basicInterfaces.js\";import{estimateMemoryKTX2 as f,estimateMemoryBasis as w,createTextureKTX2 as E,createTextureBasis as A}from\"./BasisUtil.js\";import{ContentObject as x}from\"./ContentObject.js\";import{ContentObjectType as D}from\"./ContentObjectType.js\";import{createDDSTexture as I}from\"./DDSUtil.js\";import{createQuadVAO as M}from\"./glUtil3D.js\";import{assert as F}from\"./Util.js\";import{TextureWrapMode as O,TextureType as N,PixelFormat as y,PixelType as R,TextureSamplingMode as U,TargetType as C,DepthStencilTargetType as b,PrimitiveType as P}from\"../../../webgl/enums.js\";import{FramebufferObject as S}from\"../../../webgl/FramebufferObject.js\";import{Texture as H}from\"../../../webgl/Texture.js\";import{vertexCount as V}from\"../../../webgl/Util.js\";import j from\"../../../webgl/capabilities/isWebGL2Context.js\";class v extends x{constructor(t,e){super(),this.data=t,this.type=D.Texture,this._glTexture=null,this._powerOfTwoStretchInfo=null,this._loadingPromise=null,this._loadingController=null,this.events=new r,this.params=e||{},this.params.mipmap=!1!==this.params.mipmap,this.params.noUnpackFlip=this.params.noUnpackFlip||!1,this.params.preMultiplyAlpha=this.params.preMultiplyAlpha||!1,this.params.wrap=this.params.wrap||{s:O.REPEAT,t:O.REPEAT},this.params.powerOfTwoResizeMode=this.params.powerOfTwoResizeMode||g.STRETCH,this.estimatedTexMemRequired=v._estimateTexMemRequired(this.data,this.params),this._startPreload()}_startPreload(){const t=this.data;a(t)||(t instanceof HTMLVideoElement?this._startPreloadVideoElement(t):t instanceof HTMLImageElement&&this._startPreloadImageElement(t))}_startPreloadVideoElement(t){_(t.src)||\"auto\"===t.preload&&t.crossOrigin||(t.preload=\"auto\",t.crossOrigin=\"anonymous\",t.src=t.src)}_startPreloadImageElement(t){c(t.src)||_(t.src)||t.crossOrigin||(t.crossOrigin=\"anonymous\",t.src=t.src)}static _getDataDimensions(t){return t instanceof HTMLVideoElement?{width:t.videoWidth,height:t.videoHeight}:t}static _estimateTexMemRequired(t,e){if(a(t))return 0;if(p(t)||d(t))return e.encoding===v.KTX2_ENCODING?f(t,e.mipmap):e.encoding===v.BASIS_ENCODING?w(t,e.mipmap):t.byteLength;const{width:r,height:i}=t instanceof Image||t instanceof ImageData||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement?v._getDataDimensions(t):e;return(e.mipmap?4/3:1)*r*i*(e.components||4)||0}dispose(){this.data=void 0}get width(){return this.params.width}get height(){return this.params.height}_createDescriptor(t){var e;return{target:N.TEXTURE_2D,pixelFormat:y.RGBA,dataType:R.UNSIGNED_BYTE,wrapMode:this.params.wrap,flipped:!this.params.noUnpackFlip,samplingMode:this.params.mipmap?U.LINEAR_MIPMAP_LINEAR:U.LINEAR,hasMipmap:this.params.mipmap,preMultiplyAlpha:this.params.preMultiplyAlpha,maxAnisotropy:null!=(e=this.params.maxAnisotropy)?e:this.params.mipmap?t.parameters.maxMaxAnisotropy:1}}get glTexture(){return this._glTexture}load(t,e){if(o(this._glTexture))return this._glTexture;if(o(this._loadingPromise))return this._loadingPromise;const r=this.data;return a(r)?(this._glTexture=new H(t,this._createDescriptor(t),null),this._glTexture):\"string\"==typeof r?this._loadFromURL(t,e,r):r instanceof Image?this._loadFromImageElement(t,e,r):r instanceof HTMLVideoElement?this._loadFromVideoElement(t,e,r):r instanceof ImageData||r instanceof HTMLCanvasElement?this._loadFromImage(t,r,e):(p(r)||d(r))&&this.params.encoding===v.DDS_ENCODING?(this.data=void 0,this._loadFromDDSData(t,r)):(p(r)||d(r))&&this.params.encoding===v.KTX2_ENCODING?(this.data=void 0,this._loadFromKTX2(t,r)):(p(r)||d(r))&&this.params.encoding===v.BASIS_ENCODING?(this.data=void 0,this._loadFromBasis(t,r)):d(r)?this._loadFromPixelData(t,r):p(r)?this._loadFromPixelData(t,new Uint8Array(r)):null}get requiresFrameUpdates(){return this.data instanceof HTMLVideoElement}frameUpdate(t,e,r){if(!(this.data instanceof HTMLVideoElement)||a(this._glTexture))return r;if(this.data.readyState<L.HAVE_CURRENT_DATA||r===this.data.currentTime)return r;if(o(this._powerOfTwoStretchInfo)){const{framebuffer:r,vao:i,sourceTexture:s}=this._powerOfTwoStretchInfo;s.setData(this.data),this._drawStretchedTexture(t,e,r,i,s,this._glTexture)}else{const{width:t,height:e}=this.data,{width:r,height:i}=this._glTexture.descriptor;t!==r||e!==i?this._glTexture.updateData(0,0,0,Math.min(t,r),Math.min(e,i),this.data):this._glTexture.setData(this.data)}return this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap(),this.data.currentTime}_loadFromDDSData(t,e){return this._glTexture=I(t,this._createDescriptor(t),e),this._glTexture}_loadFromKTX2(t,e){return this._loadAsync((()=>E(t,this._createDescriptor(t),e).then((t=>(this._glTexture=t,t)))))}_loadFromBasis(t,e){return this._loadAsync((()=>A(t,this._createDescriptor(t),e).then((t=>(this._glTexture=t,t)))))}_loadFromPixelData(t,e){F(this.params.width>0&&this.params.height>0);const r=this._createDescriptor(t);return r.pixelFormat=1===this.params.components?y.LUMINANCE:3===this.params.components?y.RGB:y.RGBA,r.width=this.params.width,r.height=this.params.height,this._glTexture=new H(t,r,e),this._glTexture}_loadFromURL(t,e,r){return this._loadAsync((async i=>{const s=await u(r,{signal:i});return m(i),this._loadFromImage(t,s,e)}))}_loadFromImageElement(t,e,r){return r.complete?this._loadFromImage(t,r,e):this._loadAsync((async i=>{const s=await T(r,r.src,!1,i);return m(i),this._loadFromImage(t,s,e)}))}_loadFromVideoElement(t,e,r){return r.readyState>=L.HAVE_CURRENT_DATA?this._loadFromImage(t,r,e):this._loadFromVideoElementAsync(t,e,r)}_loadFromVideoElementAsync(t,r,i){return this._loadAsync((s=>new Promise(((a,o)=>{const m=()=>{i.removeEventListener(\"loadeddata\",p),i.removeEventListener(\"error\",d),n(_)},p=()=>{i.readyState>=L.HAVE_CURRENT_DATA&&(m(),a(this._loadFromImage(t,i,r)))},d=t=>{m(),o(t||new e(\"Failed to load video\"))};i.addEventListener(\"loadeddata\",p),i.addEventListener(\"error\",d);const _=h(s,(()=>d(l())))}))))}_loadFromImage(t,e,r){const s=v._getDataDimensions(e);this.params.width=s.width,this.params.height=s.height;const a=this._createDescriptor(t);return a.pixelFormat=3===this.params.components?y.RGB:y.RGBA,!this._requiresPowerOfTwo(t,a)||i(s.width)&&i(s.height)?(a.width=s.width,a.height=s.height,this._glTexture=new H(t,a,e),this._glTexture):(this._glTexture=this._makePowerOfTwoTexture(t,e,s,a,r),this._glTexture)}_loadAsync(t){const e=new AbortController;this._loadingController=e;const r=t(e.signal);this._loadingPromise=r;const i=()=>{this._loadingController===e&&(this._loadingController=null),this._loadingPromise===r&&(this._loadingPromise=null)};return r.then(i,i),r}_requiresPowerOfTwo(t,e){const r=O.CLAMP_TO_EDGE,i=\"number\"==typeof e.wrapMode?e.wrapMode===r:e.wrapMode.s===r&&e.wrapMode.t===r;return!j(t.gl)&&(e.hasMipmap||!i)}_makePowerOfTwoTexture(e,r,i,a,o){const{width:n,height:m}=i,h=s(n),l=s(m);let p;switch(a.width=h,a.height=l,this.params.powerOfTwoResizeMode){case g.PAD:a.textureCoordinateScaleFactor=[n/h,m/l],p=new H(e,a),p.updateData(0,0,0,n,m,r);break;case g.STRETCH:case null:case void 0:p=this._stretchToPowerOfTwo(e,r,a,o());break;default:t(this.params.powerOfTwoResizeMode)}return a.hasMipmap&&p.generateMipmap(),p}_stretchToPowerOfTwo(t,e,r,i){const s=new H(t,r),a=new S(t,{colorTarget:C.TEXTURE,depthStencilTarget:b.NONE},s),o=new H(t,{target:N.TEXTURE_2D,pixelFormat:r.pixelFormat,dataType:R.UNSIGNED_BYTE,wrapMode:O.CLAMP_TO_EDGE,samplingMode:U.LINEAR,flipped:!!r.flipped,maxAnisotropy:8,preMultiplyAlpha:r.preMultiplyAlpha},e),n=M(t),m=t.getBoundFramebufferObject();return this._drawStretchedTexture(t,i,a,n,o,s),this.requiresFrameUpdates?this._powerOfTwoStretchInfo={vao:n,sourceTexture:o,framebuffer:a}:(n.dispose(!0),o.dispose(),a.detachColorTexture(),a.dispose()),t.bindFramebuffer(m),s}_drawStretchedTexture(t,e,r,i,s,a){t.bindFramebuffer(r);const o=t.getViewport();t.setViewport(0,0,a.descriptor.width,a.descriptor.height);const n=t.useTechnique(e);n.setUniform4f(\"uColor\",1,1,1,1),n.bindTexture(s,\"tex\"),t.bindVAO(i),t.drawArrays(P.TRIANGLE_STRIP,0,V(i,\"geometry\")),t.bindFramebuffer(null),t.setViewport(o.x,o.y,o.width,o.height)}unload(){if(o(this._powerOfTwoStretchInfo)){const{framebuffer:t,vao:e,sourceTexture:r}=this._powerOfTwoStretchInfo;e.dispose(!0),r.dispose(),t.dispose(),this._glTexture=null,this._powerOfTwoStretchInfo=null}if(o(this._glTexture)&&(this._glTexture.dispose(),this._glTexture=null),o(this._loadingController)){const t=this._loadingController;this._loadingController=null,this._loadingPromise=null,t.abort()}this.events.emit(\"unloaded\")}}var L;v.DDS_ENCODING=\"image/vnd-ms.dds\",v.KTX2_ENCODING=\"image/ktx2\",v.BASIS_ENCODING=\"image/x.basis\",function(t){t[t.HAVE_NOTHING=0]=\"HAVE_NOTHING\",t[t.HAVE_METADATA=1]=\"HAVE_METADATA\",t[t.HAVE_CURRENT_DATA=2]=\"HAVE_CURRENT_DATA\",t[t.HAVE_FUTURE_DATA=3]=\"HAVE_FUTURE_DATA\",t[t.HAVE_ENOUGH_DATA=4]=\"HAVE_ENOUGH_DATA\"}(L||(L={}));export{v as Texture};\n"]},"metadata":{},"sourceType":"module"}