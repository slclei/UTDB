{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../chunks/tslib.es6.js\";\nimport t from \"../../core/Accessor.js\";\nimport a from \"../../core/Logger.js\";\nimport { abortMaybe as i, isSome as n, unwrap as s, isNone as l } from \"../../core/maybe.js\";\nimport { createTask as r, isAborted as o } from \"../../core/promiseUtils.js\";\nimport { property as p } from \"../../core/accessorSupport/decorators/property.js\";\nimport \"../../core/arrayUtils.js\";\nimport \"../../core/has.js\";\nimport \"../../core/accessorSupport/ensureType.js\";\nimport { subclass as d } from \"../../core/accessorSupport/decorators/subclass.js\";\nimport { mayHaveHeightModelInfo as u, deriveHeightModelInfoFromLayer as c } from \"../../geometry/support/heightModelInfoUtils.js\";\nimport { stringFromViewingMode as f, ViewingMode as h } from \"../ViewingMode.js\";\nimport { projectWithEngineOrService as g } from \"./projectionUtils.js\";\nconst y = a.getLogger(\"esri.views.support.DefaultsFromMap\");\ny.level = \"info\";\n\nlet _ = class extends t {\n  constructor(e) {\n    super(e), this.required = {\n      tileInfo: !1,\n      heightModelInfo: !1,\n      extent: !1\n    }, this.defaultSpatialReference = null, this.userSpatialReference = null, this.sourcePreloadCount = 10, this.priorityCollection = null, this.logDebugInformation = !1, this.requiresExtentInSpatialReference = !0, this.suspended = !1, this._projectExtentTask = {\n      task: null,\n      input: null,\n      output: null,\n      spatialReference: null\n    };\n  }\n\n  destroy() {\n    this._projectExtentTask.task && (this._debug(\"Aborting project extent task\"), this._projectExtentTask.task = i(this._projectExtentTask.task)), this._set(\"map\", null);\n  }\n\n  get ready() {\n    return !this._spatialReferenceTask.updating && !this._tileInfoTask.updating && !this._extentTask.updating;\n  }\n\n  get heightModelInfoReady() {\n    return !this._heightModelInfoTask.updating;\n  }\n\n  get spatialReference() {\n    return n(this.userSpatialReference) ? this.userSpatialReference : s(this._spatialReferenceTask.spatialReference);\n  }\n\n  get extent() {\n    return s(this._extentTask.extent);\n  }\n\n  get heightModelInfo() {\n    return s(this._heightModelInfoTask.heightModelInfo);\n  }\n\n  get vcsWkid() {\n    return s(this._heightModelInfoTask.vcsWkid);\n  }\n\n  get latestVcsWkid() {\n    return s(this._heightModelInfoTask.latestVcsWkid);\n  }\n\n  get viewingMode() {\n    return l(this.userSpatialReference) || this.userSpatialReference.equals(s(this._spatialReferenceTask.spatialReference)) ? s(this._spatialReferenceTask.viewingMode) : null;\n  }\n\n  get tileInfo() {\n    return s(this._tileInfoTask.tileInfo);\n  }\n\n  get mapCollections() {\n    var e, t, a, i;\n    const s = null == (e = this.map) ? void 0 : e.call(this),\n          l = [];\n    return n(this.priorityCollection) && l.push(this.priorityCollection), l.push({\n      parent: null == s ? void 0 : s.basemap,\n      layers: null == s || null == (t = s.basemap) ? void 0 : t.baseLayers\n    }, {\n      layers: null == s ? void 0 : s.layers\n    }, {\n      parent: null == s ? void 0 : s.ground,\n      layers: null == s || null == (a = s.ground) ? void 0 : a.layers\n    }, {\n      parent: null == s ? void 0 : s.basemap,\n      layers: null == s || null == (i = s.basemap) ? void 0 : i.referenceLayers\n    }), l;\n  }\n\n  get _allLayers() {\n    var e, t;\n\n    const a = this._collectLayers(this.mapCollections);\n\n    return this._debug(\"Collected\", null != (e = null == (t = a.layers) ? void 0 : t.length) ? e : 0, \"layers, updating\", a.updating), a;\n  }\n\n  get _spatialReferenceTask() {\n    var e, t;\n    if (this.suspended) return null != (t = this._get(\"_spatialReferenceTask\")) ? t : {\n      updating: !1\n    };\n    const {\n      layers: a,\n      updating: i\n    } = this._allLayers,\n          s = {\n      candidates: null\n    };\n\n    for (const n of a) if (this._processSpatialReferenceCandidates(n, s), s.candidates && 1 === s.candidates.length) break;\n\n    if (1 !== (null == (e = s.candidates) ? void 0 : e.length) && i) return {\n      updating: !0\n    };\n\n    const l = this._pickSpatialReferenceCandidate(s.candidates);\n\n    return this._debug(\"Finished spatial reference\", n(l) ? `${l.spatialReference.wkid}:${n(l.viewingMode) ? f(l.viewingMode) : \"global/local\"}` : \"none available\"), {\n      spatialReference: n(l) ? l.spatialReference : null,\n      viewingMode: n(l) ? l.viewingMode : null,\n      updating: !1\n    };\n  }\n\n  get _tileInfoTask() {\n    var e, t, a, i, n, s, l, r;\n    if (!this.required.tileInfo) return null != (r = this._get(\"_tileInfoTask\")) ? r : {\n      updating: !1\n    };\n    if (!this.spatialReference) return {\n      updating: this._spatialReferenceTask.updating\n    };\n\n    const {\n      layers: o,\n      updating: p\n    } = this._collectLayers([{\n      parent: null == (e = this.map) || null == (t = e.call(this)) ? void 0 : t.basemap,\n      layers: null == (a = this.map) || null == (i = a.call(this)) || null == (n = i.basemap) ? void 0 : n.baseLayers\n    }, {\n      layers: null == (s = this.map) || null == (l = s.call(this)) ? void 0 : l.layers\n    }]);\n\n    if (o && o.length > 0 && \"tileInfo\" in o[0]) {\n      const e = o[0].tileInfo;\n      return {\n        tileInfo: e && e.spatialReference.equals(this.spatialReference) ? e : null,\n        updating: !1\n      };\n    }\n\n    return {\n      updating: p\n    };\n  }\n\n  get _heightModelInfoTask() {\n    var e, t;\n    if (!this.required.heightModelInfo || this.suspended && null != (e = this._get(\"_heightModelInfoTask\")) && e.heightModelInfo) return null != (t = this._get(\"_heightModelInfoTask\")) ? t : {\n      updating: !1\n    };\n    const {\n      layers: a,\n      updating: i\n    } = this._allLayers;\n\n    for (const o of a) {\n      var n, s;\n\n      if (this._debug(\"Considering\", null != (n = null != (s = o.title) ? s : o.id) ? n : o.declaredClass, \"for height model info\"), u(o)) {\n        const e = c(o);\n        var l, r;\n        if (e) return this._debug(\"Derived height model info\", e), {\n          heightModelInfo: e,\n          vcsWkid: null == (l = o.spatialReference) ? void 0 : l.vcsWkid,\n          latestVcsWkid: null == (r = o.spatialReference) ? void 0 : r.latestVcsWkid,\n          updating: !1\n        };\n      }\n\n      this._debug(\"Layer does not support height models\");\n    }\n\n    return this._debug(\"No height model info found,\", \"updating\", i), {\n      updating: i\n    };\n  }\n\n  get _extentCandidatesTask() {\n    var e;\n    if (this.suspended || !this.required.extent) return null != (e = this._get(\"_extentCandidatesTask\")) ? e : {\n      updating: !1\n    };\n    if (!this.spatialReference) return {\n      updating: this._spatialReferenceTask.updating\n    };\n    const t = this._allLayers,\n          a = t.updating,\n          i = [];\n\n    for (const l of t.layers) {\n      var s;\n      const e = \"fullExtents\" in l && l.fullExtents || (n(l.fullExtent) ? [l.fullExtent] : []),\n            t = this.requiresExtentInSpatialReference ? null : e[0],\n            a = null != (s = e.find(e => e.spatialReference.equals(this.spatialReference))) ? s : t;\n      if (a) return {\n        candidates: [{\n          extent: a,\n          layer: l\n        }],\n        updating: !1\n      };\n      if (this._getSupportedSpatialReferences(l).length > 0) for (const n of e) i.push({\n        extent: n,\n        layer: l\n      });\n    }\n\n    return {\n      candidates: i,\n      updating: a\n    };\n  }\n\n  get _extentTask() {\n    const {\n      candidates: e,\n      updating: t\n    } = this._extentCandidatesTask;\n    if (t) return {\n      updating: t\n    };\n    if (l(e) || 0 === e.length) return {\n      updating: !1\n    };\n    if (!this.spatialReference) return {\n      updating: this._spatialReferenceTask.updating\n    };\n\n    const a = this._pickExtentCandidate(e),\n          s = this.spatialReference;\n\n    return a.extent.equals(this._projectExtentTask.input) && s.equals(this._projectExtentTask.spatialReference) ? {\n      extent: this._projectExtentTask.output,\n      updating: n(this._projectExtentTask.task) && !this._projectExtentTask.task.finished\n    } : (n(this._projectExtentTask.task) && (this._debug(\"Aborting project extent task\"), this._projectExtentTask.task = i(this._projectExtentTask.task)), this._debug(\"Starting project extent task for\", a.extent), this._projectExtentTask = {\n      input: a.extent.clone(),\n      output: null,\n      spatialReference: s.clone(),\n      task: r(async e => {\n        try {\n          const t = await g(a.extent, s, a.layer.portalItem, e);\n          this._debug(\"Project extent task finished\", t), this._projectExtentTask = { ...this._projectExtentTask,\n            task: null,\n            output: t\n          };\n        } catch (t) {\n          if (o(e)) return;\n          this._projectExtentTask = { ...this._projectExtentTask,\n            task: null\n          };\n        }\n      })\n    }, {\n      updating: !0\n    });\n  }\n\n  _processSpatialReferenceCandidates(e, t) {\n    var a;\n\n    const i = this._getSupportedSpatialReferences(e);\n\n    if (0 !== i.length) if (this._debug(\"Spatial reference candidates from\", null != (a = e.title) ? a : e.id, \":\", i.map(e => `${e.spatialReference.wkid}:${n(e.viewingMode) ? f(e.viewingMode) : \"global/local\"}`).join(\", \")), t.candidates) {\n      const e = [],\n            a = (e, t) => l(e.viewingMode) ? t.viewingMode : (l(t.viewingMode) || e.viewingMode === t.viewingMode) && e.viewingMode;\n\n      for (const n of t.candidates) for (const t of i) {\n        if (!n.spatialReference.equals(t.spatialReference)) continue;\n        const i = a(n, t);\n\n        if (!1 !== i) {\n          e.push({\n            spatialReference: n.spatialReference,\n            viewingMode: i\n          });\n          break;\n        }\n      }\n\n      e.length > 0 && (t.candidates = e);\n    } else t.candidates = i;\n  }\n\n  _pickSpatialReferenceCandidate(e) {\n    const t = this.defaultSpatialReference;\n    return !e || e.length < 1 ? n(t) ? {\n      spatialReference: t,\n      viewingMode: null\n    } : null : (n(t) && e.length > 1 && e.some(_ref => {\n      let {\n        spatialReference: e\n      } = _ref;\n      return e.equals(t);\n    }) && (e = e.filter(_ref2 => {\n      let {\n        spatialReference: e\n      } = _ref2;\n      return e.equals(t);\n    })), e.length > 1 && e.some(_ref3 => {\n      let {\n        viewingMode: e\n      } = _ref3;\n      return e !== h.Local;\n    }) && (e = e.filter(_ref4 => {\n      let {\n        viewingMode: e\n      } = _ref4;\n      return e !== h.Local;\n    })), e[0]);\n  }\n\n  _getSupportedSpatialReferences(e) {\n    const t = \"supportedSpatialReferences\" in e && e.supportedSpatialReferences || (e.spatialReference ? [e.spatialReference] : []);\n    if (0 === t.length) return [];\n    const a = [];\n\n    for (const i of t) {\n      const t = this.getSpatialReferenceSupport({\n        spatialReference: i,\n        layer: e\n      });\n\n      if (n(t)) {\n        const e = n(t.constraints) ? t.constraints : [{\n          spatialReference: i\n        }];\n\n        for (const {\n          spatialReference: t,\n          viewingMode: i\n        } of e) (!this.requiresExtentInSpatialReference || l(this.userSpatialReference) || t.equals(this.userSpatialReference)) && a.push({\n          spatialReference: t,\n          viewingMode: i\n        });\n      }\n    }\n\n    return a;\n  }\n\n  _pickExtentCandidate(e) {\n    const t = this.spatialReference;\n    return e.find(_ref5 => {\n      let {\n        extent: e\n      } = _ref5;\n      return t.equals(e.spatialReference);\n    }) || e[0];\n  }\n\n  _collectLayers(e) {\n    var t;\n    if (\"loaded\" !== this._loadMaybe(null == (t = this.map) ? void 0 : t.call(this))) return {\n      layers: [],\n      updating: !0\n    };\n    const a = {\n      layers: [],\n      preloading: -1,\n      updating: !1\n    };\n\n    for (const i of e) if (this._collectCollection(i, a), a.preloading === this.sourcePreloadCount) break;\n\n    return {\n      layers: a.layers,\n      updating: a.updating\n    };\n  }\n\n  _collectCollection(e, t) {\n    if (e.layers) {\n      switch (this._loadMaybe(e.parent)) {\n        case \"loading\":\n          return t.updating = !0, void ++t.preloading;\n\n        case \"failed\":\n          return;\n      }\n\n      for (const n of e.layers) {\n        switch (this._loadMaybe(n)) {\n          case \"failed\":\n            continue;\n\n          case \"loading\":\n            t.updating = !0, ++t.preloading;\n            break;\n\n          case \"loaded\":\n            var a, i;\n            if (!t.updating) this._debug(\"Considering layer\", null != (a = null != (i = n.title) ? i : n.id) ? a : n.declaredClass), t.layers.push(n);\n            \"layers\" in n && this._collectCollection({\n              layers: n.layers\n            }, t);\n        }\n\n        if (t.preloading === this.sourcePreloadCount) break;\n      }\n    }\n  }\n\n  _loadMaybe(e) {\n    return e && \"loadStatus\" in e ? \"not-loaded\" === e.loadStatus ? (this._debug(\"Triggering load\", null != (t = null != (a = e.title) ? a : e.id) ? t : e.declaredClass), e.load(), \"loading\") : e.loadStatus : \"loaded\";\n    var t, a;\n  }\n\n  _debug() {\n    this.logDebugInformation && y.info(...arguments);\n  }\n\n};\n\ne([p()], _.prototype, \"required\", void 0), e([p({\n  constructOnly: !0\n})], _.prototype, \"map\", void 0), e([p({\n  constructOnly: !0\n})], _.prototype, \"getSpatialReferenceSupport\", void 0), e([p()], _.prototype, \"defaultSpatialReference\", void 0), e([p()], _.prototype, \"userSpatialReference\", void 0), e([p()], _.prototype, \"sourcePreloadCount\", void 0), e([p()], _.prototype, \"priorityCollection\", void 0), e([p()], _.prototype, \"logDebugInformation\", void 0), e([p()], _.prototype, \"requiresExtentInSpatialReference\", void 0), e([p()], _.prototype, \"suspended\", void 0), e([p({\n  readOnly: !0\n})], _.prototype, \"ready\", null), e([p({\n  readOnly: !0\n})], _.prototype, \"heightModelInfoReady\", null), e([p({\n  readOnly: !0\n})], _.prototype, \"spatialReference\", null), e([p({\n  readOnly: !0\n})], _.prototype, \"extent\", null), e([p({\n  readOnly: !0\n})], _.prototype, \"heightModelInfo\", null), e([p({\n  readOnly: !0\n})], _.prototype, \"vcsWkid\", null), e([p({\n  readOnly: !0\n})], _.prototype, \"latestVcsWkid\", null), e([p({\n  readOnly: !0\n})], _.prototype, \"viewingMode\", null), e([p({\n  readOnly: !0\n})], _.prototype, \"tileInfo\", null), e([p({\n  readOnly: !0\n})], _.prototype, \"mapCollections\", null), e([p({\n  readOnly: !0\n})], _.prototype, \"_allLayers\", null), e([p({\n  readOnly: !0\n})], _.prototype, \"_spatialReferenceTask\", null), e([p({\n  readOnly: !0\n})], _.prototype, \"_tileInfoTask\", null), e([p({\n  readOnly: !0\n})], _.prototype, \"_heightModelInfoTask\", null), e([p({\n  readOnly: !0\n})], _.prototype, \"_extentCandidatesTask\", null), e([p()], _.prototype, \"_extentTask\", null), e([p()], _.prototype, \"_projectExtentTask\", void 0), _ = e([d(\"esri.views.support.DefaultsFromMap\")], _);\nconst k = _;\nexport { k as default };","map":{"version":3,"sources":["D:/Github/CUSP_DataBase/CUSP_DB/src/main/gis/node_modules/@arcgis/core/views/support/DefaultsFromMap.js"],"names":["_","e","t","a","abortMaybe","i","isSome","n","unwrap","s","isNone","l","createTask","r","isAborted","o","property","p","subclass","d","mayHaveHeightModelInfo","u","deriveHeightModelInfoFromLayer","c","stringFromViewingMode","f","ViewingMode","h","projectWithEngineOrService","g","y","getLogger","level","constructor","required","tileInfo","heightModelInfo","extent","defaultSpatialReference","userSpatialReference","sourcePreloadCount","priorityCollection","logDebugInformation","requiresExtentInSpatialReference","suspended","_projectExtentTask","task","input","output","spatialReference","destroy","_debug","_set","ready","_spatialReferenceTask","updating","_tileInfoTask","_extentTask","heightModelInfoReady","_heightModelInfoTask","vcsWkid","latestVcsWkid","viewingMode","equals","mapCollections","map","call","push","parent","basemap","layers","baseLayers","ground","referenceLayers","_allLayers","_collectLayers","length","_get","candidates","_processSpatialReferenceCandidates","_pickSpatialReferenceCandidate","wkid","title","id","declaredClass","_extentCandidatesTask","fullExtents","fullExtent","find","layer","_getSupportedSpatialReferences","_pickExtentCandidate","finished","clone","portalItem","join","some","filter","Local","supportedSpatialReferences","getSpatialReferenceSupport","constraints","_loadMaybe","preloading","_collectCollection","loadStatus","load","info","prototype","constructOnly","readOnly","k","default"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import t from\"../../core/Accessor.js\";import a from\"../../core/Logger.js\";import{abortMaybe as i,isSome as n,unwrap as s,isNone as l}from\"../../core/maybe.js\";import{createTask as r,isAborted as o}from\"../../core/promiseUtils.js\";import{property as p}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/arrayUtils.js\";import\"../../core/has.js\";import\"../../core/accessorSupport/ensureType.js\";import{subclass as d}from\"../../core/accessorSupport/decorators/subclass.js\";import{mayHaveHeightModelInfo as u,deriveHeightModelInfoFromLayer as c}from\"../../geometry/support/heightModelInfoUtils.js\";import{stringFromViewingMode as f,ViewingMode as h}from\"../ViewingMode.js\";import{projectWithEngineOrService as g}from\"./projectionUtils.js\";const y=a.getLogger(\"esri.views.support.DefaultsFromMap\");y.level=\"info\";let _=class extends t{constructor(e){super(e),this.required={tileInfo:!1,heightModelInfo:!1,extent:!1},this.defaultSpatialReference=null,this.userSpatialReference=null,this.sourcePreloadCount=10,this.priorityCollection=null,this.logDebugInformation=!1,this.requiresExtentInSpatialReference=!0,this.suspended=!1,this._projectExtentTask={task:null,input:null,output:null,spatialReference:null}}destroy(){this._projectExtentTask.task&&(this._debug(\"Aborting project extent task\"),this._projectExtentTask.task=i(this._projectExtentTask.task)),this._set(\"map\",null)}get ready(){return!this._spatialReferenceTask.updating&&!this._tileInfoTask.updating&&!this._extentTask.updating}get heightModelInfoReady(){return!this._heightModelInfoTask.updating}get spatialReference(){return n(this.userSpatialReference)?this.userSpatialReference:s(this._spatialReferenceTask.spatialReference)}get extent(){return s(this._extentTask.extent)}get heightModelInfo(){return s(this._heightModelInfoTask.heightModelInfo)}get vcsWkid(){return s(this._heightModelInfoTask.vcsWkid)}get latestVcsWkid(){return s(this._heightModelInfoTask.latestVcsWkid)}get viewingMode(){return l(this.userSpatialReference)||this.userSpatialReference.equals(s(this._spatialReferenceTask.spatialReference))?s(this._spatialReferenceTask.viewingMode):null}get tileInfo(){return s(this._tileInfoTask.tileInfo)}get mapCollections(){var e,t,a,i;const s=null==(e=this.map)?void 0:e.call(this),l=[];return n(this.priorityCollection)&&l.push(this.priorityCollection),l.push({parent:null==s?void 0:s.basemap,layers:null==s||null==(t=s.basemap)?void 0:t.baseLayers},{layers:null==s?void 0:s.layers},{parent:null==s?void 0:s.ground,layers:null==s||null==(a=s.ground)?void 0:a.layers},{parent:null==s?void 0:s.basemap,layers:null==s||null==(i=s.basemap)?void 0:i.referenceLayers}),l}get _allLayers(){var e,t;const a=this._collectLayers(this.mapCollections);return this._debug(\"Collected\",null!=(e=null==(t=a.layers)?void 0:t.length)?e:0,\"layers, updating\",a.updating),a}get _spatialReferenceTask(){var e,t;if(this.suspended)return null!=(t=this._get(\"_spatialReferenceTask\"))?t:{updating:!1};const{layers:a,updating:i}=this._allLayers,s={candidates:null};for(const n of a)if(this._processSpatialReferenceCandidates(n,s),s.candidates&&1===s.candidates.length)break;if(1!==(null==(e=s.candidates)?void 0:e.length)&&i)return{updating:!0};const l=this._pickSpatialReferenceCandidate(s.candidates);return this._debug(\"Finished spatial reference\",n(l)?`${l.spatialReference.wkid}:${n(l.viewingMode)?f(l.viewingMode):\"global/local\"}`:\"none available\"),{spatialReference:n(l)?l.spatialReference:null,viewingMode:n(l)?l.viewingMode:null,updating:!1}}get _tileInfoTask(){var e,t,a,i,n,s,l,r;if(!this.required.tileInfo)return null!=(r=this._get(\"_tileInfoTask\"))?r:{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const{layers:o,updating:p}=this._collectLayers([{parent:null==(e=this.map)||null==(t=e.call(this))?void 0:t.basemap,layers:null==(a=this.map)||null==(i=a.call(this))||null==(n=i.basemap)?void 0:n.baseLayers},{layers:null==(s=this.map)||null==(l=s.call(this))?void 0:l.layers}]);if(o&&o.length>0&&\"tileInfo\"in o[0]){const e=o[0].tileInfo;return{tileInfo:e&&e.spatialReference.equals(this.spatialReference)?e:null,updating:!1}}return{updating:p}}get _heightModelInfoTask(){var e,t;if(!this.required.heightModelInfo||this.suspended&&null!=(e=this._get(\"_heightModelInfoTask\"))&&e.heightModelInfo)return null!=(t=this._get(\"_heightModelInfoTask\"))?t:{updating:!1};const{layers:a,updating:i}=this._allLayers;for(const o of a){var n,s;if(this._debug(\"Considering\",null!=(n=null!=(s=o.title)?s:o.id)?n:o.declaredClass,\"for height model info\"),u(o)){const e=c(o);var l,r;if(e)return this._debug(\"Derived height model info\",e),{heightModelInfo:e,vcsWkid:null==(l=o.spatialReference)?void 0:l.vcsWkid,latestVcsWkid:null==(r=o.spatialReference)?void 0:r.latestVcsWkid,updating:!1}}this._debug(\"Layer does not support height models\")}return this._debug(\"No height model info found,\",\"updating\",i),{updating:i}}get _extentCandidatesTask(){var e;if(this.suspended||!this.required.extent)return null!=(e=this._get(\"_extentCandidatesTask\"))?e:{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const t=this._allLayers,a=t.updating,i=[];for(const l of t.layers){var s;const e=\"fullExtents\"in l&&l.fullExtents||(n(l.fullExtent)?[l.fullExtent]:[]),t=this.requiresExtentInSpatialReference?null:e[0],a=null!=(s=e.find((e=>e.spatialReference.equals(this.spatialReference))))?s:t;if(a)return{candidates:[{extent:a,layer:l}],updating:!1};if(this._getSupportedSpatialReferences(l).length>0)for(const n of e)i.push({extent:n,layer:l})}return{candidates:i,updating:a}}get _extentTask(){const{candidates:e,updating:t}=this._extentCandidatesTask;if(t)return{updating:t};if(l(e)||0===e.length)return{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const a=this._pickExtentCandidate(e),s=this.spatialReference;return a.extent.equals(this._projectExtentTask.input)&&s.equals(this._projectExtentTask.spatialReference)?{extent:this._projectExtentTask.output,updating:n(this._projectExtentTask.task)&&!this._projectExtentTask.task.finished}:(n(this._projectExtentTask.task)&&(this._debug(\"Aborting project extent task\"),this._projectExtentTask.task=i(this._projectExtentTask.task)),this._debug(\"Starting project extent task for\",a.extent),this._projectExtentTask={input:a.extent.clone(),output:null,spatialReference:s.clone(),task:r((async e=>{try{const t=await g(a.extent,s,a.layer.portalItem,e);this._debug(\"Project extent task finished\",t),this._projectExtentTask={...this._projectExtentTask,task:null,output:t}}catch(t){if(o(e))return;this._projectExtentTask={...this._projectExtentTask,task:null}}}))},{updating:!0})}_processSpatialReferenceCandidates(e,t){var a;const i=this._getSupportedSpatialReferences(e);if(0!==i.length)if(this._debug(\"Spatial reference candidates from\",null!=(a=e.title)?a:e.id,\":\",i.map((e=>`${e.spatialReference.wkid}:${n(e.viewingMode)?f(e.viewingMode):\"global/local\"}`)).join(\", \")),t.candidates){const e=[],a=(e,t)=>l(e.viewingMode)?t.viewingMode:(l(t.viewingMode)||e.viewingMode===t.viewingMode)&&e.viewingMode;for(const n of t.candidates)for(const t of i){if(!n.spatialReference.equals(t.spatialReference))continue;const i=a(n,t);if(!1!==i){e.push({spatialReference:n.spatialReference,viewingMode:i});break}}e.length>0&&(t.candidates=e)}else t.candidates=i}_pickSpatialReferenceCandidate(e){const t=this.defaultSpatialReference;return!e||e.length<1?n(t)?{spatialReference:t,viewingMode:null}:null:(n(t)&&e.length>1&&e.some((({spatialReference:e})=>e.equals(t)))&&(e=e.filter((({spatialReference:e})=>e.equals(t)))),e.length>1&&e.some((({viewingMode:e})=>e!==h.Local))&&(e=e.filter((({viewingMode:e})=>e!==h.Local))),e[0])}_getSupportedSpatialReferences(e){const t=\"supportedSpatialReferences\"in e&&e.supportedSpatialReferences||(e.spatialReference?[e.spatialReference]:[]);if(0===t.length)return[];const a=[];for(const i of t){const t=this.getSpatialReferenceSupport({spatialReference:i,layer:e});if(n(t)){const e=n(t.constraints)?t.constraints:[{spatialReference:i}];for(const{spatialReference:t,viewingMode:i}of e)(!this.requiresExtentInSpatialReference||l(this.userSpatialReference)||t.equals(this.userSpatialReference))&&a.push({spatialReference:t,viewingMode:i})}}return a}_pickExtentCandidate(e){const t=this.spatialReference;return e.find((({extent:e})=>t.equals(e.spatialReference)))||e[0]}_collectLayers(e){var t;if(\"loaded\"!==this._loadMaybe(null==(t=this.map)?void 0:t.call(this)))return{layers:[],updating:!0};const a={layers:[],preloading:-1,updating:!1};for(const i of e)if(this._collectCollection(i,a),a.preloading===this.sourcePreloadCount)break;return{layers:a.layers,updating:a.updating}}_collectCollection(e,t){if(e.layers){switch(this._loadMaybe(e.parent)){case\"loading\":return t.updating=!0,void++t.preloading;case\"failed\":return}for(const n of e.layers){switch(this._loadMaybe(n)){case\"failed\":continue;case\"loading\":t.updating=!0,++t.preloading;break;case\"loaded\":var a,i;if(!t.updating)this._debug(\"Considering layer\",null!=(a=null!=(i=n.title)?i:n.id)?a:n.declaredClass),t.layers.push(n);\"layers\"in n&&this._collectCollection({layers:n.layers},t)}if(t.preloading===this.sourcePreloadCount)break}}}_loadMaybe(e){return e&&\"loadStatus\"in e?\"not-loaded\"===e.loadStatus?(this._debug(\"Triggering load\",null!=(t=null!=(a=e.title)?a:e.id)?t:e.declaredClass),e.load(),\"loading\"):e.loadStatus:\"loaded\";var t,a}_debug(...e){this.logDebugInformation&&y.info(...e)}};e([p()],_.prototype,\"required\",void 0),e([p({constructOnly:!0})],_.prototype,\"map\",void 0),e([p({constructOnly:!0})],_.prototype,\"getSpatialReferenceSupport\",void 0),e([p()],_.prototype,\"defaultSpatialReference\",void 0),e([p()],_.prototype,\"userSpatialReference\",void 0),e([p()],_.prototype,\"sourcePreloadCount\",void 0),e([p()],_.prototype,\"priorityCollection\",void 0),e([p()],_.prototype,\"logDebugInformation\",void 0),e([p()],_.prototype,\"requiresExtentInSpatialReference\",void 0),e([p()],_.prototype,\"suspended\",void 0),e([p({readOnly:!0})],_.prototype,\"ready\",null),e([p({readOnly:!0})],_.prototype,\"heightModelInfoReady\",null),e([p({readOnly:!0})],_.prototype,\"spatialReference\",null),e([p({readOnly:!0})],_.prototype,\"extent\",null),e([p({readOnly:!0})],_.prototype,\"heightModelInfo\",null),e([p({readOnly:!0})],_.prototype,\"vcsWkid\",null),e([p({readOnly:!0})],_.prototype,\"latestVcsWkid\",null),e([p({readOnly:!0})],_.prototype,\"viewingMode\",null),e([p({readOnly:!0})],_.prototype,\"tileInfo\",null),e([p({readOnly:!0})],_.prototype,\"mapCollections\",null),e([p({readOnly:!0})],_.prototype,\"_allLayers\",null),e([p({readOnly:!0})],_.prototype,\"_spatialReferenceTask\",null),e([p({readOnly:!0})],_.prototype,\"_tileInfoTask\",null),e([p({readOnly:!0})],_.prototype,\"_heightModelInfoTask\",null),e([p({readOnly:!0})],_.prototype,\"_extentCandidatesTask\",null),e([p()],_.prototype,\"_extentTask\",null),e([p()],_.prototype,\"_projectExtentTask\",void 0),_=e([d(\"esri.views.support.DefaultsFromMap\")],_);const k=_;export{k as default};\n"]},"metadata":{},"sourceType":"module"}