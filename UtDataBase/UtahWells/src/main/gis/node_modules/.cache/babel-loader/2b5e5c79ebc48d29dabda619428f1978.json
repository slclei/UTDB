{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport { hasSource as e } from \"./RasterBitmap.js\";\nimport t from \"../webgl/VertexStream.js\";\nimport r from \"../webgl/brushes/WGLBrush.js\";\nimport { BlendFactor as s, CompareFunction as a } from \"../../../webgl/enums.js\";\nimport { setTextures as i, getCommonUniforms as o, setUniforms as n, getColormapUniforms as h, getStretchUniforms as l, getShadedReliefUniforms as c, getUniformLocationInfos as p, getBasicGridUniforms as d } from \"../../../webgl/rasterUtils.js\";\n\nclass u extends r {\n  constructor() {\n    super(...arguments), this._desc = {\n      lut: {\n        vsPath: \"raster/lut\",\n        fsPath: \"raster/lut\",\n        attributes: new Map([[\"a_position\", 0], [\"a_texcoord\", 1]])\n      },\n      stretch: {\n        vsPath: \"raster/stretch\",\n        fsPath: \"raster/stretch\",\n        attributes: new Map([[\"a_position\", 0], [\"a_texcoord\", 1]])\n      },\n      hillshade: {\n        vsPath: \"raster/hillshade\",\n        fsPath: \"raster/hillshade\",\n        attributes: new Map([[\"a_position\", 0], [\"a_texcoord\", 1]])\n      }\n    }, this._rendererUniformInfos = new Map();\n  }\n\n  dispose() {\n    this._quad && this._quad.dispose();\n  }\n\n  prepareState(_ref, t) {\n    let {\n      context: e\n    } = _ref;\n    e.setBlendingEnabled(!0), e.setBlendFunctionSeparate(s.ONE, s.ONE_MINUS_SRC_ALPHA, s.ONE, s.ONE_MINUS_SRC_ALPHA), e.setColorMask(!0, !0, !0, !0), e.setStencilWriteMask(0), e.setStencilTestEnabled(!0), e.setStencilFunction(a.EQUAL, t.stencilRef, 255);\n  }\n\n  draw(t, r) {\n    var s;\n    if (!e(r) || r.suspended) return;\n    t.timeline.begin(this.name);\n    const a = !(null != (s = t.context.capabilities.textureFloat) && s.textureFloatLinear);\n    r.updateTexture(t);\n\n    const i = this._getShaderVariations(r, a),\n          o = t.painter.materialManager.getProgram(t, this._desc[r.symbolizerParameters.type], i);\n\n    this._drawWithProgram(t.context, o, r), t.timeline.end(this.name);\n  }\n\n  _drawWithProgram(e, r, s) {\n    let a = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 1;\n    let p = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : [0, 0];\n    let u = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : !1;\n    this._quad || (this._quad = new t(e, [0, 0, 1, 0, 0, 1, 1, 1]));\n    const {\n      symbolizerParameters: m,\n      transformGrid: f,\n      width: _,\n      height: g,\n      opacity: b\n    } = s,\n          P = m.type;\n    e.useProgram(r);\n\n    const S = this._getShaderVariations(s),\n          w = this._getUniformInfos(P, e, r, S),\n          {\n      names: x,\n      textures: y\n    } = s.getTextures();\n\n    i(e, r, x, y);\n    const M = d(a, p),\n          U = o(f, [_, g], [s.source.width, s.source.height], b, u);\n\n    if (n(r, w, {\n      u_coordScale: s.coordScale,\n      u_dvsMat3: s.transforms.dvs,\n      ...M,\n      ...U\n    }), m.colormap) {\n      const {\n        colormap: e,\n        colormapOffset: t\n      } = m,\n            s = h(e, t);\n      n(r, w, s);\n    }\n\n    if (\"stretch\" === m.type) {\n      const e = l(m);\n      n(r, w, e);\n    } else if (\"hillshade\" === m.type) {\n      const e = c(m);\n      n(r, w, e);\n    }\n\n    this._quad.draw();\n  }\n\n  _getUniformInfos(e, t, r, s) {\n    const a = s.length > 0 ? e + \"-\" + s.join(\"-\") : e;\n    if (this._rendererUniformInfos.has(a)) return this._rendererUniformInfos.get(a);\n    const i = p(t, r);\n    return this._rendererUniformInfos.set(a, i), i;\n  }\n\n  _getShaderVariations(e) {\n    let t = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : !1;\n    const r = [],\n          {\n      interpolation: s\n    } = e,\n          {\n      type: a,\n      colormap: i\n    } = e.symbolizerParameters;\n    return \"cubic\" === s ? r.push(\"bicubic\") : \"bilinear\" === s && \"stretch\" === a && null != i ? (r.push(\"bilinear\"), r.push(\"nnedge\")) : t && \"bilinear\" === s && r.push(\"bilinear\"), e.isRendereredSource ? r.push(\"noop\") : i && r.push(\"applyColormap\"), e.transformGrid && (r.push(\"applyProjection\"), 1 === e.transformGrid.spacing[0] && r.push(\"lookupProjection\")), r;\n  }\n\n}\n\nexport { u as default };","map":{"version":3,"sources":["D:/Github/CUSP_DataBase/CUSP_DB/src/main/gis/node_modules/@arcgis/core/views/2d/engine/imagery/BrushRasterBitmap.js"],"names":["hasSource","e","t","r","BlendFactor","s","CompareFunction","a","setTextures","i","getCommonUniforms","o","setUniforms","n","getColormapUniforms","h","getStretchUniforms","l","getShadedReliefUniforms","c","getUniformLocationInfos","p","getBasicGridUniforms","d","u","constructor","arguments","_desc","lut","vsPath","fsPath","attributes","Map","stretch","hillshade","_rendererUniformInfos","dispose","_quad","prepareState","context","setBlendingEnabled","setBlendFunctionSeparate","ONE","ONE_MINUS_SRC_ALPHA","setColorMask","setStencilWriteMask","setStencilTestEnabled","setStencilFunction","EQUAL","stencilRef","draw","suspended","timeline","begin","name","capabilities","textureFloat","textureFloatLinear","updateTexture","_getShaderVariations","painter","materialManager","getProgram","symbolizerParameters","type","_drawWithProgram","end","m","transformGrid","f","width","_","height","g","opacity","b","P","useProgram","S","w","_getUniformInfos","names","x","textures","y","getTextures","M","U","source","u_coordScale","coordScale","u_dvsMat3","transforms","dvs","colormap","colormapOffset","length","join","has","get","set","interpolation","push","isRendereredSource","spacing","default"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport{hasSource as e}from\"./RasterBitmap.js\";import t from\"../webgl/VertexStream.js\";import r from\"../webgl/brushes/WGLBrush.js\";import{BlendFactor as s,CompareFunction as a}from\"../../../webgl/enums.js\";import{setTextures as i,getCommonUniforms as o,setUniforms as n,getColormapUniforms as h,getStretchUniforms as l,getShadedReliefUniforms as c,getUniformLocationInfos as p,getBasicGridUniforms as d}from\"../../../webgl/rasterUtils.js\";class u extends r{constructor(){super(...arguments),this._desc={lut:{vsPath:\"raster/lut\",fsPath:\"raster/lut\",attributes:new Map([[\"a_position\",0],[\"a_texcoord\",1]])},stretch:{vsPath:\"raster/stretch\",fsPath:\"raster/stretch\",attributes:new Map([[\"a_position\",0],[\"a_texcoord\",1]])},hillshade:{vsPath:\"raster/hillshade\",fsPath:\"raster/hillshade\",attributes:new Map([[\"a_position\",0],[\"a_texcoord\",1]])}},this._rendererUniformInfos=new Map}dispose(){this._quad&&this._quad.dispose()}prepareState({context:e},t){e.setBlendingEnabled(!0),e.setBlendFunctionSeparate(s.ONE,s.ONE_MINUS_SRC_ALPHA,s.ONE,s.ONE_MINUS_SRC_ALPHA),e.setColorMask(!0,!0,!0,!0),e.setStencilWriteMask(0),e.setStencilTestEnabled(!0),e.setStencilFunction(a.EQUAL,t.stencilRef,255)}draw(t,r){var s;if(!e(r)||r.suspended)return;t.timeline.begin(this.name);const a=!(null!=(s=t.context.capabilities.textureFloat)&&s.textureFloatLinear);r.updateTexture(t);const i=this._getShaderVariations(r,a),o=t.painter.materialManager.getProgram(t,this._desc[r.symbolizerParameters.type],i);this._drawWithProgram(t.context,o,r),t.timeline.end(this.name)}_drawWithProgram(e,r,s,a=1,p=[0,0],u=!1){this._quad||(this._quad=new t(e,[0,0,1,0,0,1,1,1]));const{symbolizerParameters:m,transformGrid:f,width:_,height:g,opacity:b}=s,P=m.type;e.useProgram(r);const S=this._getShaderVariations(s),w=this._getUniformInfos(P,e,r,S),{names:x,textures:y}=s.getTextures();i(e,r,x,y);const M=d(a,p),U=o(f,[_,g],[s.source.width,s.source.height],b,u);if(n(r,w,{u_coordScale:s.coordScale,u_dvsMat3:s.transforms.dvs,...M,...U}),m.colormap){const{colormap:e,colormapOffset:t}=m,s=h(e,t);n(r,w,s)}if(\"stretch\"===m.type){const e=l(m);n(r,w,e)}else if(\"hillshade\"===m.type){const e=c(m);n(r,w,e)}this._quad.draw()}_getUniformInfos(e,t,r,s){const a=s.length>0?e+\"-\"+s.join(\"-\"):e;if(this._rendererUniformInfos.has(a))return this._rendererUniformInfos.get(a);const i=p(t,r);return this._rendererUniformInfos.set(a,i),i}_getShaderVariations(e,t=!1){const r=[],{interpolation:s}=e,{type:a,colormap:i}=e.symbolizerParameters;return\"cubic\"===s?r.push(\"bicubic\"):\"bilinear\"===s&&\"stretch\"===a&&null!=i?(r.push(\"bilinear\"),r.push(\"nnedge\")):t&&\"bilinear\"===s&&r.push(\"bilinear\"),e.isRendereredSource?r.push(\"noop\"):i&&r.push(\"applyColormap\"),e.transformGrid&&(r.push(\"applyProjection\"),1===e.transformGrid.spacing[0]&&r.push(\"lookupProjection\")),r}}export{u as default};\n"]},"metadata":{},"sourceType":"module"}