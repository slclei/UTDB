{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport \"../../geometry.js\";\nimport e from \"../../request.js\";\nimport t from \"../../core/Error.js\";\nimport i from \"../../core/Logger.js\";\nimport { isNone as n, unwrapOr as r, isSome as a } from \"../../core/maybe.js\";\nimport { WGS84 as s } from \"../../geometry/support/spatialReferenceUtils.js\";\nimport { project as o } from \"../../geometry/support/webMercatorUtils.js\";\nimport { convertToFeatureSet as l, convertToGeometry as c, convertFromGeometry as d } from \"../graphics/featureConversionUtils.js\";\nimport u from \"../graphics/OptimizedFeatureSet.js\";\nimport { validateGeoJSON as p, inferLayerProperties as m, createOptimizedFeatures as f } from \"../graphics/sources/geojson/geojson.js\";\nimport { createDrawingInfo as g } from \"../graphics/sources/support/clientSideDefaults.js\";\nimport y from \"../support/FieldsIndex.js\";\nimport { kebabDict as w } from \"../support/fieldType.js\";\nimport h from \"../../geometry/SpatialReference.js\";\nconst b = i.getLogger(\"esri.layers.graphics.sources.ogcfeature\"),\n      j = \"http://www.opengis.net/def/crs/\",\n      F = `${j}OGC/1.3/CRS84`;\n\nasync function I(i, r) {\n  let a = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n  let s = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 5;\n  const {\n    links: o\n  } = i,\n        l = G(o, \"items\", \"application/geo+json\") || G(o, \"http://www.opengis.net/def/rel/ogc/1.0/items\", \"application/geo+json\");\n  if (n(l)) throw new t(\"ogc-feature-layer:missing-items-page\", \"Missing items url\");\n  const {\n    data: c\n  } = await e(l.href, {\n    signal: a.signal,\n    query: {\n      limit: s,\n      ...a.customParameters,\n      token: a.apiKey\n    },\n    headers: {\n      accept: \"application/geo+json\"\n    }\n  });\n  await p(c);\n  const d = m(c, {\n    geometryType: r.geometryType\n  }),\n        u = r.fields || d.fields || [],\n        f = null != r.hasZ ? r.hasZ : d.hasZ,\n        h = d.geometryType,\n        j = r.objectIdField || d.objectIdFieldName || \"OBJECTID\";\n  let F = r.timeInfo;\n  const I = u.find(e => e.name === j);\n\n  if (!I) {\n    if (!d.objectIdFieldType) throw new t(\"ogc-feature-layer:missing-feature-id\", \"Collection geojson require a feature id as a unique identifier\");\n    u.unshift({\n      name: j,\n      alias: j,\n      type: \"esriFieldTypeOID\",\n      editable: !1,\n      nullable: !1\n    });\n  } else I.type = \"esriFieldTypeOID\", I.editable = !1, I.nullable = !1;\n\n  if (j !== d.objectIdFieldName) {\n    const e = u.find(e => e.name === d.objectIdFieldName);\n    e && (e.type = \"esriFieldTypeInteger\");\n  }\n\n  u === d.fields && d.unknownFields.length > 0 && b.warn({\n    name: \"ogc-feature-layer:unknown-field-types\",\n    message: \"Some fields types couldn't be inferred from the features and were dropped\",\n    details: {\n      unknownFields: d.unknownFields\n    }\n  });\n\n  for (const e of u) {\n    if (null == e.name && (e.name = e.alias), null == e.alias && (e.alias = e.name), \"esriFieldTypeOID\" !== e.type && \"esriFieldTypeGlobalID\" !== e.type && (e.editable = null == e.editable || !!e.editable, e.nullable = null == e.nullable || !!e.nullable), !e.name) throw new t(\"ogc-feature-layer:invalid-field-name\", \"field name is missing\", {\n      field: e\n    });\n    if (-1 === w.jsonValues.indexOf(e.type)) throw new t(\"ogc-feature-layer:invalid-field-type\", `invalid type for field \"${e.name}\"`, {\n      field: e\n    });\n  }\n\n  if (F) {\n    const e = new y(u);\n\n    if (F.startTimeField) {\n      const t = e.get(F.startTimeField);\n      t ? (F.startTimeField = t.name, t.type = \"esriFieldTypeDate\") : F.startTimeField = null;\n    }\n\n    if (F.endTimeField) {\n      const t = e.get(F.endTimeField);\n      t ? (F.endTimeField = t.name, t.type = \"esriFieldTypeDate\") : F.endTimeField = null;\n    }\n\n    if (F.trackIdField) {\n      const t = e.get(F.trackIdField);\n      t ? F.trackIdField = t.name : (F.trackIdField = null, b.warn({\n        name: \"ogc-feature-layer:invalid-timeInfo-trackIdField\",\n        message: \"trackIdField is missing\",\n        details: {\n          timeInfo: F\n        }\n      }));\n    }\n\n    F.startTimeField || F.endTimeField || (b.warn({\n      name: \"ogc-feature-layer:invalid-timeInfo\",\n      message: \"startTimeField and endTimeField are missing\",\n      details: {\n        timeInfo: F\n      }\n    }), F = null);\n  }\n\n  return {\n    drawingInfo: h ? g(h) : null,\n    geometryType: h,\n    fields: u,\n    hasZ: !!f,\n    objectIdField: j,\n    timeInfo: F\n  };\n}\n\nasync function T(i) {\n  let r = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  const {\n    links: a\n  } = i,\n        s = G(a, \"data\", \"application/json\") || G(a, \"http://www.opengis.net/def/rel/ogc/1.0/data\", \"application/json\");\n  if (n(s)) throw new t(\"ogc-feature-layer:missing-collections-page\", \"Missing collections url\");\n  const {\n    apiKey: o,\n    customParameters: l,\n    signal: c\n  } = r,\n        {\n    data: d\n  } = await e(s.href, {\n    signal: c,\n    headers: {\n      accept: \"application/json\"\n    },\n    query: { ...l,\n      token: o\n    }\n  });\n  return d;\n}\n\nasync function k(i) {\n  let r = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  const {\n    links: a\n  } = i,\n        s = G(a, \"conformance\", \"application/json\") || G(a, \"http://www.opengis.net/def/rel/ogc/1.0/conformance\", \"application/json\");\n  if (n(s)) throw new t(\"ogc-feature-layer:missing-conformance-page\", \"Missing conformance url\");\n  const {\n    apiKey: o,\n    customParameters: l,\n    signal: c\n  } = r,\n        {\n    data: d\n  } = await e(s.href, {\n    signal: c,\n    headers: {\n      accept: \"application/json\"\n    },\n    query: { ...l,\n      token: o\n    }\n  });\n  return d;\n}\n\nasync function x(t) {\n  let i = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  const {\n    apiKey: n,\n    customParameters: r,\n    signal: a\n  } = i,\n        {\n    data: s\n  } = await e(t, {\n    signal: a,\n    headers: {\n      accept: \"application/json\"\n    },\n    query: { ...r,\n      token: n\n    }\n  });\n  return s;\n}\n\nasync function S(t) {\n  let i = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  const r = \"application/vnd.oai.openapi+json;version=3.0\",\n        a = G(t.links, \"service-desc\", r);\n  if (n(a)) return b.warn(\"ogc-feature-layer:missing-openapi-page\", \"The OGC API-Features server does not have an OpenAPI page.\"), null;\n  const {\n    apiKey: s,\n    customParameters: o,\n    signal: l\n  } = i,\n        {\n    data: c\n  } = await e(a.href, {\n    signal: l,\n    headers: {\n      accept: r\n    },\n    query: { ...o,\n      token: s\n    }\n  });\n  return c;\n}\n\nfunction v(e) {\n  const t = /^http:\\/\\/www\\.opengis.net\\/def\\/crs\\/(?<authority>.*)\\/(?<version>.*)\\/(?<code>.*)$/i.exec(e),\n        i = null == t ? void 0 : t.groups;\n  if (!i) return null;\n  const {\n    authority: n,\n    code: r\n  } = i;\n\n  switch (n.toLowerCase()) {\n    case \"ogc\":\n      switch (r.toLowerCase()) {\n        case \"crs27\":\n          return h.GCS_NAD_1927.wkid;\n\n        case \"crs83\":\n          return 4269;\n\n        case \"crs84\":\n        case \"crs84h\":\n          return h.WGS84.wkid;\n\n        default:\n          return null;\n      }\n\n    case \"esri\":\n    case \"epsg\":\n      {\n        const e = Number.parseInt(r, 10);\n        return Number.isNaN(e) ? null : e;\n      }\n\n    default:\n      return null;\n  }\n}\n\nasync function N(e, t, i) {\n  const n = await q(e, t, i);\n  return l(n);\n}\n\nasync function q(i, l, p) {\n  const {\n    capabilities: {\n      query: {\n        maxRecordCount: m\n      }\n    },\n    collection: g,\n    layerDefinition: y,\n    queryParameters: {\n      apiKey: w,\n      customParameters: b\n    },\n    spatialReference: j,\n    supportedCrs: F\n  } = i,\n        {\n    links: I\n  } = g,\n        T = G(I, \"items\", \"application/geo+json\") || G(I, \"http://www.opengis.net/def/rel/ogc/1.0/items\", \"application/geo+json\");\n  if (n(T)) throw new t(\"ogc-feature-layer:missing-items-page\", \"Missing items url\");\n  const {\n    geometry: k,\n    num: x,\n    start: S,\n    timeExtent: v,\n    where: N\n  } = l;\n  if (l.objectIds) throw new t(\"ogc-feature-layer:query-by-objectids-not-supported\", \"Queries with objectids are not supported\");\n  const q = h.fromJSON(j),\n        M = r(l.outSpatialReference, q),\n        C = M.isWGS84 ? null : O(M, F),\n        P = D(k, F),\n        W = R(v),\n        Z = $(N),\n        K = null != x ? x : null != S && void 0 !== S ? 10 : m,\n        {\n    data: L\n  } = await e(T.href, { ...p,\n    query: { ...b,\n      ...P,\n      crs: C,\n      datetime: W,\n      query: Z,\n      limit: K,\n      startindex: S,\n      token: w\n    },\n    headers: {\n      accept: \"application/geo+json\"\n    }\n  });\n  let A = !1;\n\n  if (L.links) {\n    const e = L.links.find(e => \"next\" === e.rel);\n    A = !!e;\n  }\n\n  !A && Number.isInteger(L.numberMatched) && Number.isInteger(L.numberReturned) && (A = L.numberReturned < L.numberMatched);\n  const {\n    fields: E,\n    globalIdField: J,\n    hasM: U,\n    hasZ: _,\n    objectIdField: z\n  } = y,\n        B = y.geometryType,\n        Q = f(L, {\n    geometryType: B,\n    hasZ: _,\n    objectIdField: z\n  });\n  if (!C && M.isWebMercator) for (const e of Q) if (a(e.geometry)) {\n    const t = c(e.geometry, B, _, !1);\n    t.spatialReference = h.WGS84, e.geometry = d(o(t, M));\n  }\n\n  for (const e of Q) e.objectId = e.attributes[z];\n\n  const V = C || !C && M.isWebMercator ? M.toJSON() : s,\n        H = new u();\n  return H.exceededTransferLimit = A, H.features = Q, H.fields = E, H.geometryType = B, H.globalIdFieldName = J, H.hasM = U, H.hasZ = _, H.objectIdFieldName = z, H.spatialReference = V, H;\n}\n\nfunction M(e) {\n  return a(e) && \"extent\" === e.type;\n}\n\nfunction O(e, t) {\n  var i, n, r;\n  const {\n    isWebMercator: a,\n    wkid: s\n  } = e;\n  if (!s) return null;\n  const o = a ? null != (i = null != (n = null != (r = t[3857]) ? r : t[102100]) ? n : t[102113]) ? i : t[900913] : t[e.wkid];\n  return o ? `${j}${o}` : null;\n}\n\nfunction C(e) {\n  if (n(e)) return \"\";\n  const {\n    xmin: t,\n    ymin: i,\n    xmax: r,\n    ymax: a\n  } = e;\n  return `${t},${i},${r},${a}`;\n}\n\nfunction R(e) {\n  if (n(e)) return null;\n  const {\n    start: t,\n    end: i\n  } = e;\n  return `${a(t) ? t.toISOString() : \"..\"}/${a(i) ? i.toISOString() : \"..\"}`;\n}\n\nfunction $(e) {\n  return n(e) || !e || \"1=1\" === e ? null : e;\n}\n\nfunction D(e, t) {\n  if (!M(e)) return null;\n  const {\n    spatialReference: i\n  } = e;\n  if (!i || i.isWGS84) return {\n    bbox: C(e)\n  };\n  const n = O(i, t);\n  return a(n) ? {\n    bbox: C(e),\n    \"bbox-crs\": n\n  } : i.isWebMercator ? {\n    bbox: C(o(e, h.WGS84))\n  } : null;\n}\n\nfunction G(e, t, i) {\n  return e.find(e => e.rel === t && e.type === i) || e.find(e => e.rel === t && !e.type);\n}\n\nexport { F as crsDefault, j as crsPrefix, I as getCollectionDefinition, T as getServerCollections, k as getServerConformance, x as getServerLandingPage, S as getServerOpenApi, v as getSpatialReferenceWkid, N as queryFeatureSetJSON, q as queryOptimizedFeatureSet };","map":{"version":3,"sources":["D:/Github/CUSP_DataBase/CUSP_DB/src/main/gis/node_modules/@arcgis/core/layers/ogc/ogcFeatureUtils.js"],"names":["e","t","i","isNone","n","unwrapOr","r","isSome","a","WGS84","s","project","o","convertToFeatureSet","l","convertToGeometry","c","convertFromGeometry","d","u","validateGeoJSON","p","inferLayerProperties","m","createOptimizedFeatures","f","createDrawingInfo","g","y","kebabDict","w","h","b","getLogger","j","F","I","links","G","data","href","signal","query","limit","customParameters","token","apiKey","headers","accept","geometryType","fields","hasZ","objectIdField","objectIdFieldName","timeInfo","find","name","objectIdFieldType","unshift","alias","type","editable","nullable","unknownFields","length","warn","message","details","field","jsonValues","indexOf","startTimeField","get","endTimeField","trackIdField","drawingInfo","T","k","x","S","v","exec","groups","authority","code","toLowerCase","GCS_NAD_1927","wkid","Number","parseInt","isNaN","N","q","capabilities","maxRecordCount","collection","layerDefinition","queryParameters","spatialReference","supportedCrs","geometry","num","start","timeExtent","where","objectIds","fromJSON","M","outSpatialReference","C","isWGS84","O","P","D","W","R","Z","$","K","L","crs","datetime","startindex","A","rel","isInteger","numberMatched","numberReturned","E","globalIdField","J","hasM","U","_","z","B","Q","isWebMercator","objectId","attributes","V","toJSON","H","exceededTransferLimit","features","globalIdFieldName","xmin","ymin","xmax","ymax","end","toISOString","bbox","crsDefault","crsPrefix","getCollectionDefinition","getServerCollections","getServerConformance","getServerLandingPage","getServerOpenApi","getSpatialReferenceWkid","queryFeatureSetJSON","queryOptimizedFeatureSet"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport\"../../geometry.js\";import e from\"../../request.js\";import t from\"../../core/Error.js\";import i from\"../../core/Logger.js\";import{isNone as n,unwrapOr as r,isSome as a}from\"../../core/maybe.js\";import{WGS84 as s}from\"../../geometry/support/spatialReferenceUtils.js\";import{project as o}from\"../../geometry/support/webMercatorUtils.js\";import{convertToFeatureSet as l,convertToGeometry as c,convertFromGeometry as d}from\"../graphics/featureConversionUtils.js\";import u from\"../graphics/OptimizedFeatureSet.js\";import{validateGeoJSON as p,inferLayerProperties as m,createOptimizedFeatures as f}from\"../graphics/sources/geojson/geojson.js\";import{createDrawingInfo as g}from\"../graphics/sources/support/clientSideDefaults.js\";import y from\"../support/FieldsIndex.js\";import{kebabDict as w}from\"../support/fieldType.js\";import h from\"../../geometry/SpatialReference.js\";const b=i.getLogger(\"esri.layers.graphics.sources.ogcfeature\"),j=\"http://www.opengis.net/def/crs/\",F=`${j}OGC/1.3/CRS84`;async function I(i,r,a={},s=5){const{links:o}=i,l=G(o,\"items\",\"application/geo+json\")||G(o,\"http://www.opengis.net/def/rel/ogc/1.0/items\",\"application/geo+json\");if(n(l))throw new t(\"ogc-feature-layer:missing-items-page\",\"Missing items url\");const{data:c}=await e(l.href,{signal:a.signal,query:{limit:s,...a.customParameters,token:a.apiKey},headers:{accept:\"application/geo+json\"}});await p(c);const d=m(c,{geometryType:r.geometryType}),u=r.fields||d.fields||[],f=null!=r.hasZ?r.hasZ:d.hasZ,h=d.geometryType,j=r.objectIdField||d.objectIdFieldName||\"OBJECTID\";let F=r.timeInfo;const I=u.find((e=>e.name===j));if(!I){if(!d.objectIdFieldType)throw new t(\"ogc-feature-layer:missing-feature-id\",\"Collection geojson require a feature id as a unique identifier\");u.unshift({name:j,alias:j,type:\"esriFieldTypeOID\",editable:!1,nullable:!1})}else I.type=\"esriFieldTypeOID\",I.editable=!1,I.nullable=!1;if(j!==d.objectIdFieldName){const e=u.find((e=>e.name===d.objectIdFieldName));e&&(e.type=\"esriFieldTypeInteger\")}u===d.fields&&d.unknownFields.length>0&&b.warn({name:\"ogc-feature-layer:unknown-field-types\",message:\"Some fields types couldn't be inferred from the features and were dropped\",details:{unknownFields:d.unknownFields}});for(const e of u){if(null==e.name&&(e.name=e.alias),null==e.alias&&(e.alias=e.name),\"esriFieldTypeOID\"!==e.type&&\"esriFieldTypeGlobalID\"!==e.type&&(e.editable=null==e.editable||!!e.editable,e.nullable=null==e.nullable||!!e.nullable),!e.name)throw new t(\"ogc-feature-layer:invalid-field-name\",\"field name is missing\",{field:e});if(-1===w.jsonValues.indexOf(e.type))throw new t(\"ogc-feature-layer:invalid-field-type\",`invalid type for field \"${e.name}\"`,{field:e})}if(F){const e=new y(u);if(F.startTimeField){const t=e.get(F.startTimeField);t?(F.startTimeField=t.name,t.type=\"esriFieldTypeDate\"):F.startTimeField=null}if(F.endTimeField){const t=e.get(F.endTimeField);t?(F.endTimeField=t.name,t.type=\"esriFieldTypeDate\"):F.endTimeField=null}if(F.trackIdField){const t=e.get(F.trackIdField);t?F.trackIdField=t.name:(F.trackIdField=null,b.warn({name:\"ogc-feature-layer:invalid-timeInfo-trackIdField\",message:\"trackIdField is missing\",details:{timeInfo:F}}))}F.startTimeField||F.endTimeField||(b.warn({name:\"ogc-feature-layer:invalid-timeInfo\",message:\"startTimeField and endTimeField are missing\",details:{timeInfo:F}}),F=null)}return{drawingInfo:h?g(h):null,geometryType:h,fields:u,hasZ:!!f,objectIdField:j,timeInfo:F}}async function T(i,r={}){const{links:a}=i,s=G(a,\"data\",\"application/json\")||G(a,\"http://www.opengis.net/def/rel/ogc/1.0/data\",\"application/json\");if(n(s))throw new t(\"ogc-feature-layer:missing-collections-page\",\"Missing collections url\");const{apiKey:o,customParameters:l,signal:c}=r,{data:d}=await e(s.href,{signal:c,headers:{accept:\"application/json\"},query:{...l,token:o}});return d}async function k(i,r={}){const{links:a}=i,s=G(a,\"conformance\",\"application/json\")||G(a,\"http://www.opengis.net/def/rel/ogc/1.0/conformance\",\"application/json\");if(n(s))throw new t(\"ogc-feature-layer:missing-conformance-page\",\"Missing conformance url\");const{apiKey:o,customParameters:l,signal:c}=r,{data:d}=await e(s.href,{signal:c,headers:{accept:\"application/json\"},query:{...l,token:o}});return d}async function x(t,i={}){const{apiKey:n,customParameters:r,signal:a}=i,{data:s}=await e(t,{signal:a,headers:{accept:\"application/json\"},query:{...r,token:n}});return s}async function S(t,i={}){const r=\"application/vnd.oai.openapi+json;version=3.0\",a=G(t.links,\"service-desc\",r);if(n(a))return b.warn(\"ogc-feature-layer:missing-openapi-page\",\"The OGC API-Features server does not have an OpenAPI page.\"),null;const{apiKey:s,customParameters:o,signal:l}=i,{data:c}=await e(a.href,{signal:l,headers:{accept:r},query:{...o,token:s}});return c}function v(e){const t=/^http:\\/\\/www\\.opengis.net\\/def\\/crs\\/(?<authority>.*)\\/(?<version>.*)\\/(?<code>.*)$/i.exec(e),i=null==t?void 0:t.groups;if(!i)return null;const{authority:n,code:r}=i;switch(n.toLowerCase()){case\"ogc\":switch(r.toLowerCase()){case\"crs27\":return h.GCS_NAD_1927.wkid;case\"crs83\":return 4269;case\"crs84\":case\"crs84h\":return h.WGS84.wkid;default:return null}case\"esri\":case\"epsg\":{const e=Number.parseInt(r,10);return Number.isNaN(e)?null:e}default:return null}}async function N(e,t,i){const n=await q(e,t,i);return l(n)}async function q(i,l,p){const{capabilities:{query:{maxRecordCount:m}},collection:g,layerDefinition:y,queryParameters:{apiKey:w,customParameters:b},spatialReference:j,supportedCrs:F}=i,{links:I}=g,T=G(I,\"items\",\"application/geo+json\")||G(I,\"http://www.opengis.net/def/rel/ogc/1.0/items\",\"application/geo+json\");if(n(T))throw new t(\"ogc-feature-layer:missing-items-page\",\"Missing items url\");const{geometry:k,num:x,start:S,timeExtent:v,where:N}=l;if(l.objectIds)throw new t(\"ogc-feature-layer:query-by-objectids-not-supported\",\"Queries with objectids are not supported\");const q=h.fromJSON(j),M=r(l.outSpatialReference,q),C=M.isWGS84?null:O(M,F),P=D(k,F),W=R(v),Z=$(N),K=null!=x?x:null!=S&&void 0!==S?10:m,{data:L}=await e(T.href,{...p,query:{...b,...P,crs:C,datetime:W,query:Z,limit:K,startindex:S,token:w},headers:{accept:\"application/geo+json\"}});let A=!1;if(L.links){const e=L.links.find((e=>\"next\"===e.rel));A=!!e}!A&&Number.isInteger(L.numberMatched)&&Number.isInteger(L.numberReturned)&&(A=L.numberReturned<L.numberMatched);const{fields:E,globalIdField:J,hasM:U,hasZ:_,objectIdField:z}=y,B=y.geometryType,Q=f(L,{geometryType:B,hasZ:_,objectIdField:z});if(!C&&M.isWebMercator)for(const e of Q)if(a(e.geometry)){const t=c(e.geometry,B,_,!1);t.spatialReference=h.WGS84,e.geometry=d(o(t,M))}for(const e of Q)e.objectId=e.attributes[z];const V=C||!C&&M.isWebMercator?M.toJSON():s,H=new u;return H.exceededTransferLimit=A,H.features=Q,H.fields=E,H.geometryType=B,H.globalIdFieldName=J,H.hasM=U,H.hasZ=_,H.objectIdFieldName=z,H.spatialReference=V,H}function M(e){return a(e)&&\"extent\"===e.type}function O(e,t){var i,n,r;const{isWebMercator:a,wkid:s}=e;if(!s)return null;const o=a?null!=(i=null!=(n=null!=(r=t[3857])?r:t[102100])?n:t[102113])?i:t[900913]:t[e.wkid];return o?`${j}${o}`:null}function C(e){if(n(e))return\"\";const{xmin:t,ymin:i,xmax:r,ymax:a}=e;return`${t},${i},${r},${a}`}function R(e){if(n(e))return null;const{start:t,end:i}=e;return`${a(t)?t.toISOString():\"..\"}/${a(i)?i.toISOString():\"..\"}`}function $(e){return n(e)||!e||\"1=1\"===e?null:e}function D(e,t){if(!M(e))return null;const{spatialReference:i}=e;if(!i||i.isWGS84)return{bbox:C(e)};const n=O(i,t);return a(n)?{bbox:C(e),\"bbox-crs\":n}:i.isWebMercator?{bbox:C(o(e,h.WGS84))}:null}function G(e,t,i){return e.find((e=>e.rel===t&&e.type===i))||e.find((e=>e.rel===t&&!e.type))}export{F as crsDefault,j as crsPrefix,I as getCollectionDefinition,T as getServerCollections,k as getServerConformance,x as getServerLandingPage,S as getServerOpenApi,v as getSpatialReferenceWkid,N as queryFeatureSetJSON,q as queryOptimizedFeatureSet};\n"]},"metadata":{},"sourceType":"module"}