{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport e from \"../../../core/Error.js\";\nimport { on as t } from \"../../../core/events.js\";\nimport i from \"../../../core/has.js\";\nimport { isSome as r } from \"../../../core/maybe.js\";\nimport { addFrameTask as s } from \"../../../core/scheduling.js\";\nimport { init as n } from \"../../../core/watchUtils.js\";\nimport { t as a } from \"../../../chunks/common.js\";\nimport { a as o, r as h } from \"../../../chunks/mat2d.js\";\nimport { c as l } from \"../../../chunks/mat2df64.js\";\nimport { c as d } from \"../../../chunks/mat3f32.js\";\nimport { s as c, t as p } from \"../../../chunks/vec2.js\";\nimport { a as m } from \"../../../chunks/vec2f64.js\";\nimport u from \"../../../symbols/cim/CIMResourceManager.js\";\nimport { Container as _ } from \"./Container.js\";\nimport { WGLDrawPhase as g } from \"./webgl/enums.js\";\nimport f from \"./webgl/Painter.js\";\nimport { Profiler as b } from \"./webgl/Profiler.js\";\nimport { stencil as R } from \"./webgl/shaders/StencilPrograms.js\";\nimport { Timeline as w } from \"../support/Timeline.js\";\nimport { resampleHermite as O, encodeResult as E, createEmptyImageData as F } from \"../../support/screenshotUtils.js\";\nimport { BufferObject as T } from \"../../webgl/BufferObject.js\";\nimport { createContextOrErrorHTML as y } from \"../../webgl/context-util.js\";\nimport { TargetType as C, DepthStencilTargetType as x, StencilOperation as B, CompareFunction as P, PrimitiveType as S, DataType as j, TextureSamplingMode as L, PixelFormat as A, PixelType as v, Usage as D } from \"../../webgl/enums.js\";\nimport { FramebufferObject as k } from \"../../webgl/FramebufferObject.js\";\nimport { createProgram as M } from \"../../webgl/ProgramTemplate.js\";\nimport { RenderingContext as H } from \"../../webgl/RenderingContext.js\";\nimport { VertexArrayObject as I } from \"../../webgl/VertexArrayObject.js\";\nimport { VertexElementDescriptor as U } from \"../../webgl/VertexElementDescriptor.js\";\nconst q = 2e3;\n\nclass W extends _ {\n  constructor(n, a) {\n    super(), this._trash = new Set(), this._clipData = new Float32Array(8), this._upperLeft = m(), this._upperRight = m(), this._lowerLeft = m(), this._lowerRight = m(), this._mat2 = l(), this._clipRendererInitialized = !1, this._renderRemainingTime = 0, this._lastFrameRenderTime = 0, this.renderRequested = !1, this.stage = this, this._stationary = !0;\n    const {\n      canvas: o = document.createElement(\"canvas\"),\n      alpha: h = !0,\n      stencil: d = !0,\n      contextOptions: c = {}\n    } = a;\n    this._canvas = o;\n    const p = y(\"2d\", o, {\n      alpha: h,\n      antialias: !1,\n      depth: !0,\n      stencil: d\n    });\n    this.context = new H(r(p) ? p : null, c), this.resourceManager = new u(), this.painter = new f(this.context, this, this.resourceManager), i(\"esri-2d-profiler\") && (this._debugOutput = document.createElement(\"div\"), this._debugOutput.setAttribute(\"style\", \"margin: 24px 64px; position: absolute; color: red;\"), n.appendChild(this._debugOutput)), this._renderParameters = {\n      drawPhase: 0,\n      state: this.state,\n      pixelRatio: window.devicePixelRatio,\n      stationary: !1,\n      globalOpacity: 1,\n      blendMode: null,\n      deltaTime: -1,\n      time: 0,\n      inFadeTransition: !1,\n      effects: null,\n      context: this.context,\n      painter: this.painter,\n      timeline: a.timeline || new w(),\n      renderingOptions: a.renderingOptions,\n      requireFBO: !1,\n      profiler: new b(this.context, this._debugOutput),\n      dataUploadCounter: 0\n    }, this._taskHandle = s({\n      render: e => this.renderFrame(e)\n    }), this._taskHandle.pause(), this._lostWebGLContextHandle = t(o, \"webglcontextlost\", () => {\n      this.emit(\"webgl-error\", {\n        error: new e(\"webgl-context-lost\")\n      });\n    }), o.setAttribute(\"style\", \"width: 100%; height:100%; display:block;\"), n.appendChild(o);\n  }\n\n  destroy() {\n    this.removeAllChildren(), this._emptyTrash(), this._taskHandle.remove(), this._taskHandle = null, this._boundFBO = null, this._clipFBO && (this._clipFBO.dispose(), this._clipFBO = null), this._clipVAO && (this._clipVAO.dispose(), this._clipVAO = null, this._clipVBO = null), this._clipStencilProgram && (this._clipStencilProgram.dispose(), this._clipStencilProgram = null), this._lostWebGLContextHandle && (this._lostWebGLContextHandle.remove(), this._lostWebGLContextHandle = null), this._canvas.parentNode && this._canvas.parentNode.removeChild(this._canvas), this._debugOutput && this._debugOutput.parentNode && this._debugOutput.parentNode.removeChild(this._debugOutput), this.highlightOptions = null, this.resourceManager.destroy(), this.painter.dispose(), this.context.dispose(), this._canvas = null;\n  }\n\n  get background() {\n    return this._background;\n  }\n\n  set background(e) {\n    this._background = e, this.requestRender();\n  }\n\n  get highlightOptions() {\n    return this._highlightOptions;\n  }\n\n  set highlightOptions(e) {\n    this._highlightOptionsHandle && (this._highlightOptionsHandle.remove(), this._highlightOptionsHandle = null), this._highlightOptions = e, this._highlightOptions && (this._highlightOptionsHandle = n(this._highlightOptions, \"version\", () => {\n      this.painter.setHighlightOptions(e), this.requestRender();\n    }));\n  }\n\n  get renderingOptions() {\n    return this._renderingOptions;\n  }\n\n  set renderingOptions(e) {\n    this._renderingOptions = e, this.requestRender();\n  }\n\n  get state() {\n    return this._state;\n  }\n\n  set state(e) {\n    this._state = e, this.requestRender();\n  }\n\n  get stationary() {\n    return this._stationary;\n  }\n\n  set stationary(e) {\n    this._stationary !== e && (this._stationary = e, this.requestRender());\n  }\n\n  trashDisplayObject(e) {\n    this._trash.add(e), this.requestRender();\n  }\n\n  untrashDisplayObject(e) {\n    return this._trash.delete(e);\n  }\n\n  requestRender() {\n    this._renderRemainingTime = q, this.renderRequested || (this.renderRequested = !0, this.emit(\"will-render\"), this._taskHandle.resume());\n  }\n\n  renderFrame(e) {\n    const t = this._lastFrameRenderTime ? e.time - this._lastFrameRenderTime : 0;\n    this._renderRemainingTime -= t, this._renderRemainingTime <= 0 && this._taskHandle.pause(), this._lastFrameRenderTime = e.time, this.renderRequested = !1, this._renderParameters.state = this._state, this._renderParameters.stationary = this.stationary, this._renderParameters.pixelRatio = window.devicePixelRatio, this._renderParameters.globalOpacity = 1, this._renderParameters.time = e.time, this._renderParameters.deltaTime = e.deltaTime, this._renderParameters.effects = null, this.processRender(this._renderParameters), this._emptyTrash(), this.emit(\"post-render\");\n  }\n\n  _createTransforms() {\n    return {\n      dvs: d()\n    };\n  }\n\n  renderChildren(e) {\n    for (const t of this.children) t.beforeRender(e);\n\n    this._renderChildren(this.children, e);\n\n    for (const t of this.children) t.afterRender(e);\n  }\n\n  _renderChildren(e, t) {\n    const r = this.context;\n    t.profiler.recordStart(\"drawLayers\"), t.dataUploadCounter = 0, this._beforeRenderChildren(t), t.drawPhase = g.MAP, this.painter.beforeRenderLayers(r, this.background);\n\n    for (const i of e) i.processRender(t);\n\n    this.painter.renderLayers(r), t.drawPhase = g.HIGHLIGHT, this.painter.beforeRenderLayers(r);\n\n    for (const i of e) i.processRender(t);\n\n    this.painter.renderLayers(r);\n\n    if (this._isLabelDrawPhaseRequired(e)) {\n      t.drawPhase = g.LABEL, this.painter.beforeRenderLayers(r);\n\n      for (const i of e) i.processRender(t);\n\n      this.painter.renderLayers(r);\n    }\n\n    if (i(\"esri-tiles-debug\")) {\n      t.drawPhase = g.DEBUG, this.painter.beforeRenderLayers(r);\n\n      for (const i of e) i.processRender(t);\n\n      this.painter.renderLayers(r);\n    }\n\n    t.profiler.recordEnd(\"drawLayers\"), this._afterRenderChildren();\n  }\n\n  _beforeRenderChildren(e) {\n    const {\n      context: t\n    } = this,\n          {\n      state: i,\n      pixelRatio: r\n    } = e;\n    t.setClearDepth(1), t.setClearColor(0, 0, 0, 0), t.clear(t.gl.COLOR_BUFFER_BIT | t.gl.DEPTH_BUFFER_BIT);\n    const {\n      size: s,\n      rotation: n\n    } = i,\n          l = Math.round(s[0] * r),\n          d = Math.round(s[1] * r);\n    this._boundFBO = t.getBoundFramebufferObject();\n    if (!i.spatialReference.isWrappable) return void (this._clipFrame = !1);\n\n    const m = a(n),\n          u = Math.abs(Math.cos(m)),\n          _ = Math.abs(Math.sin(m)),\n          g = Math.round(l * u + d * _),\n          f = Math.round(i.worldScreenWidth);\n\n    if (g <= f) return void (this._clipFrame = !1);\n    this._clipFBO && this._clipFBO.width === l && this._clipFBO.height === d || (this._clipFBO = new k(t, {\n      colorTarget: C.TEXTURE,\n      depthStencilTarget: x.DEPTH_STENCIL_RENDER_BUFFER,\n      width: l,\n      height: d\n    }));\n    const b = (this.state.padding.left - this.state.padding.right) / 2,\n          R = (this.state.padding.bottom - this.state.padding.top) / 2,\n          w = .5 * l,\n          O = .5 * d,\n          E = 1 / l,\n          F = 1 / d,\n          T = f * r * .5,\n          y = .5 * (l * _ + d * u),\n          B = this._upperLeft,\n          P = this._upperRight,\n          S = this._lowerLeft,\n          j = this._lowerRight;\n    c(B, -T, -y), c(P, T, -y), c(S, -T, y), c(j, T, y), o(this._mat2, [w + b, O - R]), 0 !== n && h(this._mat2, this._mat2, m), p(B, B, this._mat2), p(P, P, this._mat2), p(S, S, this._mat2), p(j, j, this._mat2);\n    const L = this._clipData;\n    L.set([2 * S[0] * E - 1, 2 * (d - S[1]) * F - 1, 2 * j[0] * E - 1, 2 * (d - j[1]) * F - 1, 2 * B[0] * E - 1, 2 * (d - B[1]) * F - 1, 2 * P[0] * E - 1, 2 * (d - P[1]) * F - 1]), this._clipRendererInitialized || this._initializeClipRenderer(t), this._clipVBO.setData(L), this._boundFBO = t.getBoundFramebufferObject(), t.bindFramebuffer(this._clipFBO), t.setDepthWriteEnabled(!0), t.setStencilWriteMask(255), t.setClearColor(0, 0, 0, 0), t.setClearDepth(1), t.setClearStencil(0), t.clear(t.gl.COLOR_BUFFER_BIT | t.gl.DEPTH_BUFFER_BIT | t.gl.STENCIL_BUFFER_BIT), t.setDepthWriteEnabled(!1), this._clipFrame = !0;\n  }\n\n  _afterRenderChildren() {\n    const e = this.context;\n\n    if (e.logIno(), this._clipFrame && this._clipRendererInitialized) {\n      if (e.bindFramebuffer(this._boundFBO), this._boundFBO = null, e.bindVAO(this._clipVAO), e.useProgram(this._clipStencilProgram), e.setDepthWriteEnabled(!1), e.setDepthTestEnabled(!1), e.setStencilTestEnabled(!0), e.setBlendingEnabled(!1), e.setColorMask(!1, !1, !1, !1), e.setStencilOp(B.KEEP, B.KEEP, B.REPLACE), e.setStencilWriteMask(255), e.setStencilFunction(P.ALWAYS, 1, 255), e.drawElements(S.TRIANGLES, 6, j.UNSIGNED_SHORT, 0), e.bindVAO(), e.setColorMask(!0, !0, !0, !0), null != this.background) {\n        const {\n          r: t,\n          g: i,\n          b: r,\n          a: s\n        } = this.background.color;\n        e.setClearColor(s * t / 255, s * i / 255, s * r / 255, s);\n      } else e.setClearColor(0, 0, 0, 0);\n\n      e.clear(e.gl.COLOR_BUFFER_BIT), e.setBlendingEnabled(!0), e.setStencilFunction(P.EQUAL, 1, 255), this.painter.blitTexture(e, this._clipFBO.colorTexture, L.NEAREST, 1), e.setStencilTestEnabled(!1);\n    }\n  }\n\n  doRender(e) {\n    const t = this.context,\n          {\n      state: i,\n      pixelRatio: r\n    } = e;\n    this._resizeCanvas(e), t.setViewport(0, 0, r * i.size[0], r * i.size[1]), t.setDepthWriteEnabled(!0), t.setStencilWriteMask(255), super.doRender(e);\n  }\n\n  async takeScreenshot(e) {\n    const {\n      framebufferWidth: t,\n      framebufferHeight: i\n    } = {\n      framebufferWidth: Math.round(this._renderParameters.state.size[0] * e.resolutionScale),\n      framebufferHeight: Math.round(this._renderParameters.state.size[1] * e.resolutionScale)\n    },\n          r = 1,\n          s = this.context,\n          n = this._state.clone();\n\n    if (null != e.rotation) {\n      const t = n.viewpoint;\n      n.viewpoint.rotation = e.rotation, n.viewpoint = t;\n    }\n\n    const a = { ...this._renderParameters,\n      drawPhase: null,\n      globalOpacity: 1,\n      stationary: !0,\n      state: n,\n      pixelRatio: r,\n      time: performance.now(),\n      deltaTime: 0,\n      blendMode: null,\n      effects: null,\n      inFadeTransition: !1\n    },\n          o = new k(s, {\n      colorTarget: C.TEXTURE,\n      depthStencilTarget: x.DEPTH_STENCIL_RENDER_BUFFER,\n      width: t,\n      height: i\n    }),\n          h = s.getBoundFramebufferObject(),\n          l = s.getViewport();\n    s.bindFramebuffer(o), s.setViewport(0, 0, t, i), this._renderChildren(e.children, a);\n\n    const d = this._readbackScreenshot(o, { ...e.cropArea,\n      y: i - (e.cropArea.y + e.cropArea.height)\n    });\n\n    s.bindFramebuffer(h), s.setViewport(l.x, l.y, l.width, l.height), this.requestRender();\n    const c = await d;\n    let p;\n    1 === e.outputScale ? p = c : (p = new ImageData(Math.round(c.width * e.outputScale), Math.round(c.height * e.outputScale)), O(c, p, !0));\n    return E(p, {\n      format: e.format,\n      quality: e.quality,\n      rotation: 0,\n      disableDecorations: !1\n    }, document.createElement(\"canvas\"), {\n      flipY: !0,\n      premultipliedAlpha: !0\n    });\n  }\n\n  async _readbackScreenshot(e, t) {\n    const i = F(t.width, t.height, document.createElement(\"canvas\"));\n    return await e.readPixelsAsync(t.x, t.y, t.width, t.height, A.RGBA, v.UNSIGNED_BYTE, new Uint8Array(i.data.buffer)), i;\n  }\n\n  _resizeCanvas(e) {\n    const t = this._canvas,\n          i = t.style,\n          {\n      state: {\n        size: r\n      },\n      pixelRatio: s\n    } = e,\n          n = r[0],\n          a = r[1],\n          o = Math.round(n * s),\n          h = Math.round(a * s);\n    t.width === o && t.height === h || (t.width = o, t.height = h), i.width = n + \"px\", i.height = a + \"px\";\n  }\n\n  _initializeClipRenderer(e) {\n    if (this._clipRendererInitialized) return !0;\n    const t = M(e, R);\n    if (!t) return !1;\n    const i = T.createVertex(e, D.STREAM_DRAW, this._clipData),\n          r = new Uint16Array([0, 1, 2, 2, 1, 3]),\n          s = T.createIndex(e, D.STATIC_DRAW, r),\n          n = R.attributes,\n          a = {\n      geometry: [new U(\"a_pos\", 2, j.FLOAT, 0, 8)]\n    },\n          o = new I(e, n, a, {\n      geometry: i\n    }, s);\n    return this._clipStencilProgram = t, this._clipVBO = i, this._clipVAO = o, this._clipRendererInitialized = !0, !0;\n  }\n\n  _emptyTrash() {\n    for (; this._trash.size > 0;) {\n      const e = Array.from(this._trash);\n\n      this._trash.clear();\n\n      for (const t of e) t.processDetach();\n    }\n  }\n\n  _isLabelDrawPhaseRequired(e) {\n    let t = !1;\n\n    for (const i of e) {\n      if (!(i instanceof _)) {\n        t = t || !1;\n        break;\n      }\n\n      if (i.hasLabels) return !0;\n      t = t || this._isLabelDrawPhaseRequired(i.children);\n    }\n\n    return t;\n  }\n\n}\n\nexport { q as EXTRA_RENDER_TIME, W as Stage };","map":{"version":3,"sources":["D:/Github/CUSP_DataBase/CUSP_DB/src/main/gis/node_modules/@arcgis/core/views/2d/engine/Stage.js"],"names":["e","on","t","i","isSome","r","addFrameTask","s","init","n","a","o","h","c","l","d","p","m","u","Container","_","WGLDrawPhase","g","f","Profiler","b","stencil","R","Timeline","w","resampleHermite","O","encodeResult","E","createEmptyImageData","F","BufferObject","T","createContextOrErrorHTML","y","TargetType","C","DepthStencilTargetType","x","StencilOperation","B","CompareFunction","P","PrimitiveType","S","DataType","j","TextureSamplingMode","L","PixelFormat","A","PixelType","v","Usage","D","FramebufferObject","k","createProgram","M","RenderingContext","H","VertexArrayObject","I","VertexElementDescriptor","U","q","W","constructor","_trash","Set","_clipData","Float32Array","_upperLeft","_upperRight","_lowerLeft","_lowerRight","_mat2","_clipRendererInitialized","_renderRemainingTime","_lastFrameRenderTime","renderRequested","stage","_stationary","canvas","document","createElement","alpha","contextOptions","_canvas","antialias","depth","context","resourceManager","painter","_debugOutput","setAttribute","appendChild","_renderParameters","drawPhase","state","pixelRatio","window","devicePixelRatio","stationary","globalOpacity","blendMode","deltaTime","time","inFadeTransition","effects","timeline","renderingOptions","requireFBO","profiler","dataUploadCounter","_taskHandle","render","renderFrame","pause","_lostWebGLContextHandle","emit","error","destroy","removeAllChildren","_emptyTrash","remove","_boundFBO","_clipFBO","dispose","_clipVAO","_clipVBO","_clipStencilProgram","parentNode","removeChild","highlightOptions","background","_background","requestRender","_highlightOptions","_highlightOptionsHandle","setHighlightOptions","_renderingOptions","_state","trashDisplayObject","add","untrashDisplayObject","delete","resume","processRender","_createTransforms","dvs","renderChildren","children","beforeRender","_renderChildren","afterRender","recordStart","_beforeRenderChildren","MAP","beforeRenderLayers","renderLayers","HIGHLIGHT","_isLabelDrawPhaseRequired","LABEL","DEBUG","recordEnd","_afterRenderChildren","setClearDepth","setClearColor","clear","gl","COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","size","rotation","Math","round","getBoundFramebufferObject","spatialReference","isWrappable","_clipFrame","abs","cos","sin","worldScreenWidth","width","height","colorTarget","TEXTURE","depthStencilTarget","DEPTH_STENCIL_RENDER_BUFFER","padding","left","right","bottom","top","set","_initializeClipRenderer","setData","bindFramebuffer","setDepthWriteEnabled","setStencilWriteMask","setClearStencil","STENCIL_BUFFER_BIT","logIno","bindVAO","useProgram","setDepthTestEnabled","setStencilTestEnabled","setBlendingEnabled","setColorMask","setStencilOp","KEEP","REPLACE","setStencilFunction","ALWAYS","drawElements","TRIANGLES","UNSIGNED_SHORT","color","EQUAL","blitTexture","colorTexture","NEAREST","doRender","_resizeCanvas","setViewport","takeScreenshot","framebufferWidth","framebufferHeight","resolutionScale","clone","viewpoint","performance","now","getViewport","_readbackScreenshot","cropArea","outputScale","ImageData","format","quality","disableDecorations","flipY","premultipliedAlpha","readPixelsAsync","RGBA","UNSIGNED_BYTE","Uint8Array","data","buffer","style","createVertex","STREAM_DRAW","Uint16Array","createIndex","STATIC_DRAW","attributes","geometry","FLOAT","Array","from","processDetach","hasLabels","EXTRA_RENDER_TIME","Stage"],"mappings":"AAAA;AACA;AACA;AACA;AACA,OAAOA,CAAP,MAAa,wBAAb;AAAsC,SAAOC,EAAE,IAAIC,CAAb,QAAmB,yBAAnB;AAA6C,OAAOC,CAAP,MAAa,sBAAb;AAAoC,SAAOC,MAAM,IAAIC,CAAjB,QAAuB,wBAAvB;AAAgD,SAAOC,YAAY,IAAIC,CAAvB,QAA6B,6BAA7B;AAA2D,SAAOC,IAAI,IAAIC,CAAf,QAAqB,6BAArB;AAAmD,SAAOP,CAAC,IAAIQ,CAAZ,QAAkB,2BAAlB;AAA8C,SAAOA,CAAC,IAAIC,CAAZ,EAAcN,CAAC,IAAIO,CAAnB,QAAyB,0BAAzB;AAAoD,SAAOC,CAAC,IAAIC,CAAZ,QAAkB,6BAAlB;AAAgD,SAAOD,CAAC,IAAIE,CAAZ,QAAkB,4BAAlB;AAA+C,SAAOR,CAAC,IAAIM,CAAZ,EAAcX,CAAC,IAAIc,CAAnB,QAAyB,yBAAzB;AAAmD,SAAON,CAAC,IAAIO,CAAZ,QAAkB,4BAAlB;AAA+C,OAAOC,CAAP,MAAa,4CAAb;AAA0D,SAAOC,SAAS,IAAIC,CAApB,QAA0B,gBAA1B;AAA2C,SAAOC,YAAY,IAAIC,CAAvB,QAA6B,kBAA7B;AAAgD,OAAOC,CAAP,MAAa,oBAAb;AAAkC,SAAOC,QAAQ,IAAIC,CAAnB,QAAyB,qBAAzB;AAA+C,SAAOC,OAAO,IAAIC,CAAlB,QAAwB,oCAAxB;AAA6D,SAAOC,QAAQ,IAAIC,CAAnB,QAAyB,wBAAzB;AAAkD,SAAOC,eAAe,IAAIC,CAA1B,EAA4BC,YAAY,IAAIC,CAA5C,EAA8CC,oBAAoB,IAAIC,CAAtE,QAA4E,kCAA5E;AAA+G,SAAOC,YAAY,IAAIC,CAAvB,QAA6B,6BAA7B;AAA2D,SAAOC,wBAAwB,IAAIC,CAAnC,QAAyC,6BAAzC;AAAuE,SAAOC,UAAU,IAAIC,CAArB,EAAuBC,sBAAsB,IAAIC,CAAjD,EAAmDC,gBAAgB,IAAIC,CAAvE,EAAyEC,eAAe,IAAIC,CAA5F,EAA8FC,aAAa,IAAIC,CAA/G,EAAiHC,QAAQ,IAAIC,CAA7H,EAA+HC,mBAAmB,IAAIC,CAAtJ,EAAwJC,WAAW,IAAIC,CAAvK,EAAyKC,SAAS,IAAIC,CAAtL,EAAwLC,KAAK,IAAIC,CAAjM,QAAuM,sBAAvM;AAA8N,SAAOC,iBAAiB,IAAIC,CAA5B,QAAkC,kCAAlC;AAAqE,SAAOC,aAAa,IAAIC,CAAxB,QAA8B,gCAA9B;AAA+D,SAAOC,gBAAgB,IAAIC,CAA3B,QAAiC,iCAAjC;AAAmE,SAAOC,iBAAiB,IAAIC,CAA5B,QAAkC,kCAAlC;AAAqE,SAAOC,uBAAuB,IAAIC,CAAlC,QAAwC,wCAAxC;AAAiF,MAAMC,CAAC,GAAC,GAAR;;AAAY,MAAMC,CAAN,SAAgBnD,CAAhB,CAAiB;AAACoD,EAAAA,WAAW,CAAC/D,CAAD,EAAGC,CAAH,EAAK;AAAC,aAAQ,KAAK+D,MAAL,GAAY,IAAIC,GAAJ,EAApB,EAA4B,KAAKC,SAAL,GAAe,IAAIC,YAAJ,CAAiB,CAAjB,CAA3C,EAA+D,KAAKC,UAAL,GAAgB5D,CAAC,EAAhF,EAAmF,KAAK6D,WAAL,GAAiB7D,CAAC,EAArG,EAAwG,KAAK8D,UAAL,GAAgB9D,CAAC,EAAzH,EAA4H,KAAK+D,WAAL,GAAiB/D,CAAC,EAA9I,EAAiJ,KAAKgE,KAAL,GAAWnE,CAAC,EAA7J,EAAgK,KAAKoE,wBAAL,GAA8B,CAAC,CAA/L,EAAiM,KAAKC,oBAAL,GAA0B,CAA3N,EAA6N,KAAKC,oBAAL,GAA0B,CAAvP,EAAyP,KAAKC,eAAL,GAAqB,CAAC,CAA/Q,EAAiR,KAAKC,KAAL,GAAW,IAA5R,EAAiS,KAAKC,WAAL,GAAiB,CAAC,CAAnT;AAAqT,UAAK;AAACC,MAAAA,MAAM,EAAC7E,CAAC,GAAC8E,QAAQ,CAACC,aAAT,CAAuB,QAAvB,CAAV;AAA2CC,MAAAA,KAAK,EAAC/E,CAAC,GAAC,CAAC,CAApD;AAAsDc,MAAAA,OAAO,EAACX,CAAC,GAAC,CAAC,CAAjE;AAAmE6E,MAAAA,cAAc,EAAC/E,CAAC,GAAC;AAApF,QAAwFH,CAA7F;AAA+F,SAAKmF,OAAL,GAAalF,CAAb;AAAe,UAAMK,CAAC,GAACuB,CAAC,CAAC,IAAD,EAAM5B,CAAN,EAAQ;AAACgF,MAAAA,KAAK,EAAC/E,CAAP;AAASkF,MAAAA,SAAS,EAAC,CAAC,CAApB;AAAsBC,MAAAA,KAAK,EAAC,CAAC,CAA7B;AAA+BrE,MAAAA,OAAO,EAACX;AAAvC,KAAR,CAAT;AAA4D,SAAKiF,OAAL,GAAa,IAAI/B,CAAJ,CAAM5D,CAAC,CAACW,CAAD,CAAD,GAAKA,CAAL,GAAO,IAAb,EAAkBH,CAAlB,CAAb,EAAkC,KAAKoF,eAAL,GAAqB,IAAI/E,CAAJ,EAAvD,EAA6D,KAAKgF,OAAL,GAAa,IAAI3E,CAAJ,CAAM,KAAKyE,OAAX,EAAmB,IAAnB,EAAwB,KAAKC,eAA7B,CAA1E,EAAwH9F,CAAC,CAAC,kBAAD,CAAD,KAAwB,KAAKgG,YAAL,GAAkBV,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAlB,EAAgD,KAAKS,YAAL,CAAkBC,YAAlB,CAA+B,OAA/B,EAAuC,oDAAvC,CAAhD,EAA6I3F,CAAC,CAAC4F,WAAF,CAAc,KAAKF,YAAnB,CAArK,CAAxH,EAA+T,KAAKG,iBAAL,GAAuB;AAACC,MAAAA,SAAS,EAAC,CAAX;AAAaC,MAAAA,KAAK,EAAC,KAAKA,KAAxB;AAA8BC,MAAAA,UAAU,EAACC,MAAM,CAACC,gBAAhD;AAAiEC,MAAAA,UAAU,EAAC,CAAC,CAA7E;AAA+EC,MAAAA,aAAa,EAAC,CAA7F;AAA+FC,MAAAA,SAAS,EAAC,IAAzG;AAA8GC,MAAAA,SAAS,EAAC,CAAC,CAAzH;AAA2HC,MAAAA,IAAI,EAAC,CAAhI;AAAkIC,MAAAA,gBAAgB,EAAC,CAAC,CAApJ;AAAsJC,MAAAA,OAAO,EAAC,IAA9J;AAAmKlB,MAAAA,OAAO,EAAC,KAAKA,OAAhL;AAAwLE,MAAAA,OAAO,EAAC,KAAKA,OAArM;AAA6MiB,MAAAA,QAAQ,EAACzG,CAAC,CAACyG,QAAF,IAAY,IAAItF,CAAJ,EAAlO;AAAwOuF,MAAAA,gBAAgB,EAAC1G,CAAC,CAAC0G,gBAA3P;AAA4QC,MAAAA,UAAU,EAAC,CAAC,CAAxR;AAA0RC,MAAAA,QAAQ,EAAC,IAAI7F,CAAJ,CAAM,KAAKuE,OAAX,EAAmB,KAAKG,YAAxB,CAAnS;AAAyUoB,MAAAA,iBAAiB,EAAC;AAA3V,KAAtV,EAAorB,KAAKC,WAAL,GAAiBjH,CAAC,CAAC;AAACkH,MAAAA,MAAM,EAACzH,CAAC,IAAE,KAAK0H,WAAL,CAAiB1H,CAAjB;AAAX,KAAD,CAAtsB,EAAwuB,KAAKwH,WAAL,CAAiBG,KAAjB,EAAxuB,EAAiwB,KAAKC,uBAAL,GAA6B1H,CAAC,CAACS,CAAD,EAAG,kBAAH,EAAuB,MAAI;AAAC,WAAKkH,IAAL,CAAU,aAAV,EAAwB;AAACC,QAAAA,KAAK,EAAC,IAAI9H,CAAJ,CAAM,oBAAN;AAAP,OAAxB;AAA6D,KAAzF,CAA/xB,EAA23BW,CAAC,CAACyF,YAAF,CAAe,OAAf,EAAuB,0CAAvB,CAA33B,EAA87B3F,CAAC,CAAC4F,WAAF,CAAc1F,CAAd,CAA97B;AAA+8B;;AAAAoH,EAAAA,OAAO,GAAE;AAAC,SAAKC,iBAAL,IAAyB,KAAKC,WAAL,EAAzB,EAA4C,KAAKT,WAAL,CAAiBU,MAAjB,EAA5C,EAAsE,KAAKV,WAAL,GAAiB,IAAvF,EAA4F,KAAKW,SAAL,GAAe,IAA3G,EAAgH,KAAKC,QAAL,KAAgB,KAAKA,QAAL,CAAcC,OAAd,IAAwB,KAAKD,QAAL,GAAc,IAAtD,CAAhH,EAA4K,KAAKE,QAAL,KAAgB,KAAKA,QAAL,CAAcD,OAAd,IAAwB,KAAKC,QAAL,GAAc,IAAtC,EAA2C,KAAKC,QAAL,GAAc,IAAzE,CAA5K,EAA2P,KAAKC,mBAAL,KAA2B,KAAKA,mBAAL,CAAyBH,OAAzB,IAAmC,KAAKG,mBAAL,GAAyB,IAAvF,CAA3P,EAAwV,KAAKZ,uBAAL,KAA+B,KAAKA,uBAAL,CAA6BM,MAA7B,IAAsC,KAAKN,uBAAL,GAA6B,IAAlG,CAAxV,EAAgc,KAAK/B,OAAL,CAAa4C,UAAb,IAAyB,KAAK5C,OAAL,CAAa4C,UAAb,CAAwBC,WAAxB,CAAoC,KAAK7C,OAAzC,CAAzd,EAA2gB,KAAKM,YAAL,IAAmB,KAAKA,YAAL,CAAkBsC,UAArC,IAAiD,KAAKtC,YAAL,CAAkBsC,UAAlB,CAA6BC,WAA7B,CAAyC,KAAKvC,YAA9C,CAA5jB,EAAwnB,KAAKwC,gBAAL,GAAsB,IAA9oB,EAAmpB,KAAK1C,eAAL,CAAqB8B,OAArB,EAAnpB,EAAkrB,KAAK7B,OAAL,CAAamC,OAAb,EAAlrB,EAAysB,KAAKrC,OAAL,CAAaqC,OAAb,EAAzsB,EAAguB,KAAKxC,OAAL,GAAa,IAA7uB;AAAkvB;;AAAc,MAAV+C,UAAU,GAAE;AAAC,WAAO,KAAKC,WAAZ;AAAwB;;AAAc,MAAVD,UAAU,CAAC5I,CAAD,EAAG;AAAC,SAAK6I,WAAL,GAAiB7I,CAAjB,EAAmB,KAAK8I,aAAL,EAAnB;AAAwC;;AAAoB,MAAhBH,gBAAgB,GAAE;AAAC,WAAO,KAAKI,iBAAZ;AAA8B;;AAAoB,MAAhBJ,gBAAgB,CAAC3I,CAAD,EAAG;AAAC,SAAKgJ,uBAAL,KAA+B,KAAKA,uBAAL,CAA6Bd,MAA7B,IAAsC,KAAKc,uBAAL,GAA6B,IAAlG,GAAwG,KAAKD,iBAAL,GAAuB/I,CAA/H,EAAiI,KAAK+I,iBAAL,KAAyB,KAAKC,uBAAL,GAA6BvI,CAAC,CAAC,KAAKsI,iBAAN,EAAwB,SAAxB,EAAmC,MAAI;AAAC,WAAK7C,OAAL,CAAa+C,mBAAb,CAAiCjJ,CAAjC,GAAoC,KAAK8I,aAAL,EAApC;AAAyD,KAAjG,CAAvD,CAAjI;AAA6R;;AAAoB,MAAhB1B,gBAAgB,GAAE;AAAC,WAAO,KAAK8B,iBAAZ;AAA8B;;AAAoB,MAAhB9B,gBAAgB,CAACpH,CAAD,EAAG;AAAC,SAAKkJ,iBAAL,GAAuBlJ,CAAvB,EAAyB,KAAK8I,aAAL,EAAzB;AAA8C;;AAAS,MAALtC,KAAK,GAAE;AAAC,WAAO,KAAK2C,MAAZ;AAAmB;;AAAS,MAAL3C,KAAK,CAACxG,CAAD,EAAG;AAAC,SAAKmJ,MAAL,GAAYnJ,CAAZ,EAAc,KAAK8I,aAAL,EAAd;AAAmC;;AAAc,MAAVlC,UAAU,GAAE;AAAC,WAAO,KAAKrB,WAAZ;AAAwB;;AAAc,MAAVqB,UAAU,CAAC5G,CAAD,EAAG;AAAC,SAAKuF,WAAL,KAAmBvF,CAAnB,KAAuB,KAAKuF,WAAL,GAAiBvF,CAAjB,EAAmB,KAAK8I,aAAL,EAA1C;AAAgE;;AAAAM,EAAAA,kBAAkB,CAACpJ,CAAD,EAAG;AAAC,SAAKyE,MAAL,CAAY4E,GAAZ,CAAgBrJ,CAAhB,GAAmB,KAAK8I,aAAL,EAAnB;AAAwC;;AAAAQ,EAAAA,oBAAoB,CAACtJ,CAAD,EAAG;AAAC,WAAO,KAAKyE,MAAL,CAAY8E,MAAZ,CAAmBvJ,CAAnB,CAAP;AAA6B;;AAAA8I,EAAAA,aAAa,GAAE;AAAC,SAAK3D,oBAAL,GAA0Bb,CAA1B,EAA4B,KAAKe,eAAL,KAAuB,KAAKA,eAAL,GAAqB,CAAC,CAAtB,EAAwB,KAAKwC,IAAL,CAAU,aAAV,CAAxB,EAAiD,KAAKL,WAAL,CAAiBgC,MAAjB,EAAxE,CAA5B;AAA+H;;AAAA9B,EAAAA,WAAW,CAAC1H,CAAD,EAAG;AAAC,UAAME,CAAC,GAAC,KAAKkF,oBAAL,GAA0BpF,CAAC,CAACgH,IAAF,GAAO,KAAK5B,oBAAtC,GAA2D,CAAnE;AAAqE,SAAKD,oBAAL,IAA2BjF,CAA3B,EAA6B,KAAKiF,oBAAL,IAA2B,CAA3B,IAA8B,KAAKqC,WAAL,CAAiBG,KAAjB,EAA3D,EAAoF,KAAKvC,oBAAL,GAA0BpF,CAAC,CAACgH,IAAhH,EAAqH,KAAK3B,eAAL,GAAqB,CAAC,CAA3I,EAA6I,KAAKiB,iBAAL,CAAuBE,KAAvB,GAA6B,KAAK2C,MAA/K,EAAsL,KAAK7C,iBAAL,CAAuBM,UAAvB,GAAkC,KAAKA,UAA7N,EAAwO,KAAKN,iBAAL,CAAuBG,UAAvB,GAAkCC,MAAM,CAACC,gBAAjR,EAAkS,KAAKL,iBAAL,CAAuBO,aAAvB,GAAqC,CAAvU,EAAyU,KAAKP,iBAAL,CAAuBU,IAAvB,GAA4BhH,CAAC,CAACgH,IAAvW,EAA4W,KAAKV,iBAAL,CAAuBS,SAAvB,GAAiC/G,CAAC,CAAC+G,SAA/Y,EAAyZ,KAAKT,iBAAL,CAAuBY,OAAvB,GAA+B,IAAxb,EAA6b,KAAKuC,aAAL,CAAmB,KAAKnD,iBAAxB,CAA7b,EAAwe,KAAK2B,WAAL,EAAxe,EAA2f,KAAKJ,IAAL,CAAU,aAAV,CAA3f;AAAohB;;AAAA6B,EAAAA,iBAAiB,GAAE;AAAC,WAAM;AAACC,MAAAA,GAAG,EAAC5I,CAAC;AAAN,KAAN;AAAgB;;AAAA6I,EAAAA,cAAc,CAAC5J,CAAD,EAAG;AAAC,SAAI,MAAME,CAAV,IAAe,KAAK2J,QAApB,EAA6B3J,CAAC,CAAC4J,YAAF,CAAe9J,CAAf;;AAAkB,SAAK+J,eAAL,CAAqB,KAAKF,QAA1B,EAAmC7J,CAAnC;;AAAsC,SAAI,MAAME,CAAV,IAAe,KAAK2J,QAApB,EAA6B3J,CAAC,CAAC8J,WAAF,CAAchK,CAAd;AAAiB;;AAAA+J,EAAAA,eAAe,CAAC/J,CAAD,EAAGE,CAAH,EAAK;AAAC,UAAMG,CAAC,GAAC,KAAK2F,OAAb;AAAqB9F,IAAAA,CAAC,CAACoH,QAAF,CAAW2C,WAAX,CAAuB,YAAvB,GAAqC/J,CAAC,CAACqH,iBAAF,GAAoB,CAAzD,EAA2D,KAAK2C,qBAAL,CAA2BhK,CAA3B,CAA3D,EAAyFA,CAAC,CAACqG,SAAF,GAAYjF,CAAC,CAAC6I,GAAvG,EAA2G,KAAKjE,OAAL,CAAakE,kBAAb,CAAgC/J,CAAhC,EAAkC,KAAKuI,UAAvC,CAA3G;;AAA8J,SAAI,MAAMzI,CAAV,IAAeH,CAAf,EAAiBG,CAAC,CAACsJ,aAAF,CAAgBvJ,CAAhB;;AAAmB,SAAKgG,OAAL,CAAamE,YAAb,CAA0BhK,CAA1B,GAA6BH,CAAC,CAACqG,SAAF,GAAYjF,CAAC,CAACgJ,SAA3C,EAAqD,KAAKpE,OAAL,CAAakE,kBAAb,CAAgC/J,CAAhC,CAArD;;AAAwF,SAAI,MAAMF,CAAV,IAAeH,CAAf,EAAiBG,CAAC,CAACsJ,aAAF,CAAgBvJ,CAAhB;;AAAmB,SAAKgG,OAAL,CAAamE,YAAb,CAA0BhK,CAA1B;;AAA6B,QAAG,KAAKkK,yBAAL,CAA+BvK,CAA/B,CAAH,EAAqC;AAACE,MAAAA,CAAC,CAACqG,SAAF,GAAYjF,CAAC,CAACkJ,KAAd,EAAoB,KAAKtE,OAAL,CAAakE,kBAAb,CAAgC/J,CAAhC,CAApB;;AAAuD,WAAI,MAAMF,CAAV,IAAeH,CAAf,EAAiBG,CAAC,CAACsJ,aAAF,CAAgBvJ,CAAhB;;AAAmB,WAAKgG,OAAL,CAAamE,YAAb,CAA0BhK,CAA1B;AAA6B;;AAAA,QAAGF,CAAC,CAAC,kBAAD,CAAJ,EAAyB;AAACD,MAAAA,CAAC,CAACqG,SAAF,GAAYjF,CAAC,CAACmJ,KAAd,EAAoB,KAAKvE,OAAL,CAAakE,kBAAb,CAAgC/J,CAAhC,CAApB;;AAAuD,WAAI,MAAMF,CAAV,IAAeH,CAAf,EAAiBG,CAAC,CAACsJ,aAAF,CAAgBvJ,CAAhB;;AAAmB,WAAKgG,OAAL,CAAamE,YAAb,CAA0BhK,CAA1B;AAA6B;;AAAAH,IAAAA,CAAC,CAACoH,QAAF,CAAWoD,SAAX,CAAqB,YAArB,GAAmC,KAAKC,oBAAL,EAAnC;AAA+D;;AAAAT,EAAAA,qBAAqB,CAAClK,CAAD,EAAG;AAAC,UAAK;AAACgG,MAAAA,OAAO,EAAC9F;AAAT,QAAY,IAAjB;AAAA,UAAsB;AAACsG,MAAAA,KAAK,EAACrG,CAAP;AAASsG,MAAAA,UAAU,EAACpG;AAApB,QAAuBL,CAA7C;AAA+CE,IAAAA,CAAC,CAAC0K,aAAF,CAAgB,CAAhB,GAAmB1K,CAAC,CAAC2K,aAAF,CAAgB,CAAhB,EAAkB,CAAlB,EAAoB,CAApB,EAAsB,CAAtB,CAAnB,EAA4C3K,CAAC,CAAC4K,KAAF,CAAQ5K,CAAC,CAAC6K,EAAF,CAAKC,gBAAL,GAAsB9K,CAAC,CAAC6K,EAAF,CAAKE,gBAAnC,CAA5C;AAAiG,UAAK;AAACC,MAAAA,IAAI,EAAC3K,CAAN;AAAQ4K,MAAAA,QAAQ,EAAC1K;AAAjB,QAAoBN,CAAzB;AAAA,UAA2BW,CAAC,GAACsK,IAAI,CAACC,KAAL,CAAW9K,CAAC,CAAC,CAAD,CAAD,GAAKF,CAAhB,CAA7B;AAAA,UAAgDU,CAAC,GAACqK,IAAI,CAACC,KAAL,CAAW9K,CAAC,CAAC,CAAD,CAAD,GAAKF,CAAhB,CAAlD;AAAqE,SAAK8H,SAAL,GAAejI,CAAC,CAACoL,yBAAF,EAAf;AAA6C,QAAG,CAACnL,CAAC,CAACoL,gBAAF,CAAmBC,WAAvB,EAAmC,OAAO,MAAK,KAAKC,UAAL,GAAgB,CAAC,CAAtB,CAAP;;AAAgC,UAAMxK,CAAC,GAACP,CAAC,CAACD,CAAD,CAAT;AAAA,UAAaS,CAAC,GAACkK,IAAI,CAACM,GAAL,CAASN,IAAI,CAACO,GAAL,CAAS1K,CAAT,CAAT,CAAf;AAAA,UAAqCG,CAAC,GAACgK,IAAI,CAACM,GAAL,CAASN,IAAI,CAACQ,GAAL,CAAS3K,CAAT,CAAT,CAAvC;AAAA,UAA6DK,CAAC,GAAC8J,IAAI,CAACC,KAAL,CAAWvK,CAAC,GAACI,CAAF,GAAIH,CAAC,GAACK,CAAjB,CAA/D;AAAA,UAAmFG,CAAC,GAAC6J,IAAI,CAACC,KAAL,CAAWlL,CAAC,CAAC0L,gBAAb,CAArF;;AAAoH,QAAGvK,CAAC,IAAEC,CAAN,EAAQ,OAAO,MAAK,KAAKkK,UAAL,GAAgB,CAAC,CAAtB,CAAP;AAAgC,SAAKrD,QAAL,IAAe,KAAKA,QAAL,CAAc0D,KAAd,KAAsBhL,CAArC,IAAwC,KAAKsH,QAAL,CAAc2D,MAAd,KAAuBhL,CAA/D,KAAmE,KAAKqH,QAAL,GAAc,IAAIvE,CAAJ,CAAM3D,CAAN,EAAQ;AAAC8L,MAAAA,WAAW,EAACvJ,CAAC,CAACwJ,OAAf;AAAuBC,MAAAA,kBAAkB,EAACvJ,CAAC,CAACwJ,2BAA5C;AAAwEL,MAAAA,KAAK,EAAChL,CAA9E;AAAgFiL,MAAAA,MAAM,EAAChL;AAAvF,KAAR,CAAjF;AAAqL,UAAMU,CAAC,GAAC,CAAC,KAAK+E,KAAL,CAAW4F,OAAX,CAAmBC,IAAnB,GAAwB,KAAK7F,KAAL,CAAW4F,OAAX,CAAmBE,KAA5C,IAAmD,CAA3D;AAAA,UAA6D3K,CAAC,GAAC,CAAC,KAAK6E,KAAL,CAAW4F,OAAX,CAAmBG,MAAnB,GAA0B,KAAK/F,KAAL,CAAW4F,OAAX,CAAmBI,GAA9C,IAAmD,CAAlH;AAAA,UAAoH3K,CAAC,GAAC,KAAGf,CAAzH;AAAA,UAA2HiB,CAAC,GAAC,KAAGhB,CAAhI;AAAA,UAAkIkB,CAAC,GAAC,IAAEnB,CAAtI;AAAA,UAAwIqB,CAAC,GAAC,IAAEpB,CAA5I;AAAA,UAA8IsB,CAAC,GAACd,CAAC,GAAClB,CAAF,GAAI,EAApJ;AAAA,UAAuJkC,CAAC,GAAC,MAAIzB,CAAC,GAACM,CAAF,GAAIL,CAAC,GAACG,CAAV,CAAzJ;AAAA,UAAsK2B,CAAC,GAAC,KAAKgC,UAA7K;AAAA,UAAwL9B,CAAC,GAAC,KAAK+B,WAA/L;AAAA,UAA2M7B,CAAC,GAAC,KAAK8B,UAAlN;AAAA,UAA6N5B,CAAC,GAAC,KAAK6B,WAApO;AAAgPnE,IAAAA,CAAC,CAACgC,CAAD,EAAG,CAACR,CAAJ,EAAM,CAACE,CAAP,CAAD,EAAW1B,CAAC,CAACkC,CAAD,EAAGV,CAAH,EAAK,CAACE,CAAN,CAAZ,EAAqB1B,CAAC,CAACoC,CAAD,EAAG,CAACZ,CAAJ,EAAME,CAAN,CAAtB,EAA+B1B,CAAC,CAACsC,CAAD,EAAGd,CAAH,EAAKE,CAAL,CAAhC,EAAwC5B,CAAC,CAAC,KAAKsE,KAAN,EAAY,CAACpD,CAAC,GAACJ,CAAH,EAAKM,CAAC,GAACJ,CAAP,CAAZ,CAAzC,EAAgE,MAAIlB,CAAJ,IAAOG,CAAC,CAAC,KAAKqE,KAAN,EAAY,KAAKA,KAAjB,EAAuBhE,CAAvB,CAAxE,EAAkGD,CAAC,CAAC6B,CAAD,EAAGA,CAAH,EAAK,KAAKoC,KAAV,CAAnG,EAAoHjE,CAAC,CAAC+B,CAAD,EAAGA,CAAH,EAAK,KAAKkC,KAAV,CAArH,EAAsIjE,CAAC,CAACiC,CAAD,EAAGA,CAAH,EAAK,KAAKgC,KAAV,CAAvI,EAAwJjE,CAAC,CAACmC,CAAD,EAAGA,CAAH,EAAK,KAAK8B,KAAV,CAAzJ;AAA0K,UAAM5B,CAAC,GAAC,KAAKsB,SAAb;AAAuBtB,IAAAA,CAAC,CAACoJ,GAAF,CAAM,CAAC,IAAExJ,CAAC,CAAC,CAAD,CAAH,GAAOhB,CAAP,GAAS,CAAV,EAAY,KAAGlB,CAAC,GAACkC,CAAC,CAAC,CAAD,CAAN,IAAWd,CAAX,GAAa,CAAzB,EAA2B,IAAEgB,CAAC,CAAC,CAAD,CAAH,GAAOlB,CAAP,GAAS,CAApC,EAAsC,KAAGlB,CAAC,GAACoC,CAAC,CAAC,CAAD,CAAN,IAAWhB,CAAX,GAAa,CAAnD,EAAqD,IAAEU,CAAC,CAAC,CAAD,CAAH,GAAOZ,CAAP,GAAS,CAA9D,EAAgE,KAAGlB,CAAC,GAAC8B,CAAC,CAAC,CAAD,CAAN,IAAWV,CAAX,GAAa,CAA7E,EAA+E,IAAEY,CAAC,CAAC,CAAD,CAAH,GAAOd,CAAP,GAAS,CAAxF,EAA0F,KAAGlB,CAAC,GAACgC,CAAC,CAAC,CAAD,CAAN,IAAWZ,CAAX,GAAa,CAAvG,CAAN,GAAiH,KAAK+C,wBAAL,IAA+B,KAAKwH,uBAAL,CAA6BxM,CAA7B,CAAhJ,EAAgL,KAAKqI,QAAL,CAAcoE,OAAd,CAAsBtJ,CAAtB,CAAhL,EAAyM,KAAK8E,SAAL,GAAejI,CAAC,CAACoL,yBAAF,EAAxN,EAAsPpL,CAAC,CAAC0M,eAAF,CAAkB,KAAKxE,QAAvB,CAAtP,EAAuRlI,CAAC,CAAC2M,oBAAF,CAAuB,CAAC,CAAxB,CAAvR,EAAkT3M,CAAC,CAAC4M,mBAAF,CAAsB,GAAtB,CAAlT,EAA6U5M,CAAC,CAAC2K,aAAF,CAAgB,CAAhB,EAAkB,CAAlB,EAAoB,CAApB,EAAsB,CAAtB,CAA7U,EAAsW3K,CAAC,CAAC0K,aAAF,CAAgB,CAAhB,CAAtW,EAAyX1K,CAAC,CAAC6M,eAAF,CAAkB,CAAlB,CAAzX,EAA8Y7M,CAAC,CAAC4K,KAAF,CAAQ5K,CAAC,CAAC6K,EAAF,CAAKC,gBAAL,GAAsB9K,CAAC,CAAC6K,EAAF,CAAKE,gBAA3B,GAA4C/K,CAAC,CAAC6K,EAAF,CAAKiC,kBAAzD,CAA9Y,EAA2d9M,CAAC,CAAC2M,oBAAF,CAAuB,CAAC,CAAxB,CAA3d,EAAsf,KAAKpB,UAAL,GAAgB,CAAC,CAAvgB;AAAygB;;AAAAd,EAAAA,oBAAoB,GAAE;AAAC,UAAM3K,CAAC,GAAC,KAAKgG,OAAb;;AAAqB,QAAGhG,CAAC,CAACiN,MAAF,IAAW,KAAKxB,UAAL,IAAiB,KAAKvG,wBAApC,EAA6D;AAAC,UAAGlF,CAAC,CAAC4M,eAAF,CAAkB,KAAKzE,SAAvB,GAAkC,KAAKA,SAAL,GAAe,IAAjD,EAAsDnI,CAAC,CAACkN,OAAF,CAAU,KAAK5E,QAAf,CAAtD,EAA+EtI,CAAC,CAACmN,UAAF,CAAa,KAAK3E,mBAAlB,CAA/E,EAAsHxI,CAAC,CAAC6M,oBAAF,CAAuB,CAAC,CAAxB,CAAtH,EAAiJ7M,CAAC,CAACoN,mBAAF,CAAsB,CAAC,CAAvB,CAAjJ,EAA2KpN,CAAC,CAACqN,qBAAF,CAAwB,CAAC,CAAzB,CAA3K,EAAuMrN,CAAC,CAACsN,kBAAF,CAAqB,CAAC,CAAtB,CAAvM,EAAgOtN,CAAC,CAACuN,YAAF,CAAe,CAAC,CAAhB,EAAkB,CAAC,CAAnB,EAAqB,CAAC,CAAtB,EAAwB,CAAC,CAAzB,CAAhO,EAA4PvN,CAAC,CAACwN,YAAF,CAAe3K,CAAC,CAAC4K,IAAjB,EAAsB5K,CAAC,CAAC4K,IAAxB,EAA6B5K,CAAC,CAAC6K,OAA/B,CAA5P,EAAoS1N,CAAC,CAAC8M,mBAAF,CAAsB,GAAtB,CAApS,EAA+T9M,CAAC,CAAC2N,kBAAF,CAAqB5K,CAAC,CAAC6K,MAAvB,EAA8B,CAA9B,EAAgC,GAAhC,CAA/T,EAAoW5N,CAAC,CAAC6N,YAAF,CAAe5K,CAAC,CAAC6K,SAAjB,EAA2B,CAA3B,EAA6B3K,CAAC,CAAC4K,cAA/B,EAA8C,CAA9C,CAApW,EAAqZ/N,CAAC,CAACkN,OAAF,EAArZ,EAAialN,CAAC,CAACuN,YAAF,CAAe,CAAC,CAAhB,EAAkB,CAAC,CAAnB,EAAqB,CAAC,CAAtB,EAAwB,CAAC,CAAzB,CAAja,EAA6b,QAAM,KAAK3E,UAA3c,EAAsd;AAAC,cAAK;AAACvI,UAAAA,CAAC,EAACH,CAAH;AAAKoB,UAAAA,CAAC,EAACnB,CAAP;AAASsB,UAAAA,CAAC,EAACpB,CAAX;AAAaK,UAAAA,CAAC,EAACH;AAAf,YAAkB,KAAKqI,UAAL,CAAgBoF,KAAvC;AAA6ChO,QAAAA,CAAC,CAAC6K,aAAF,CAAgBtK,CAAC,GAACL,CAAF,GAAI,GAApB,EAAwBK,CAAC,GAACJ,CAAF,GAAI,GAA5B,EAAgCI,CAAC,GAACF,CAAF,GAAI,GAApC,EAAwCE,CAAxC;AAA2C,OAA/iB,MAAojBP,CAAC,CAAC6K,aAAF,CAAgB,CAAhB,EAAkB,CAAlB,EAAoB,CAApB,EAAsB,CAAtB;;AAAyB7K,MAAAA,CAAC,CAAC8K,KAAF,CAAQ9K,CAAC,CAAC+K,EAAF,CAAKC,gBAAb,GAA+BhL,CAAC,CAACsN,kBAAF,CAAqB,CAAC,CAAtB,CAA/B,EAAwDtN,CAAC,CAAC2N,kBAAF,CAAqB5K,CAAC,CAACkL,KAAvB,EAA6B,CAA7B,EAA+B,GAA/B,CAAxD,EAA4F,KAAK/H,OAAL,CAAagI,WAAb,CAAyBlO,CAAzB,EAA2B,KAAKoI,QAAL,CAAc+F,YAAzC,EAAsD9K,CAAC,CAAC+K,OAAxD,EAAgE,CAAhE,CAA5F,EAA+JpO,CAAC,CAACqN,qBAAF,CAAwB,CAAC,CAAzB,CAA/J;AAA2L;AAAC;;AAAAgB,EAAAA,QAAQ,CAACrO,CAAD,EAAG;AAAC,UAAME,CAAC,GAAC,KAAK8F,OAAb;AAAA,UAAqB;AAACQ,MAAAA,KAAK,EAACrG,CAAP;AAASsG,MAAAA,UAAU,EAACpG;AAApB,QAAuBL,CAA5C;AAA8C,SAAKsO,aAAL,CAAmBtO,CAAnB,GAAsBE,CAAC,CAACqO,WAAF,CAAc,CAAd,EAAgB,CAAhB,EAAkBlO,CAAC,GAACF,CAAC,CAAC+K,IAAF,CAAO,CAAP,CAApB,EAA8B7K,CAAC,GAACF,CAAC,CAAC+K,IAAF,CAAO,CAAP,CAAhC,CAAtB,EAAiEhL,CAAC,CAAC2M,oBAAF,CAAuB,CAAC,CAAxB,CAAjE,EAA4F3M,CAAC,CAAC4M,mBAAF,CAAsB,GAAtB,CAA5F,EAAuH,MAAMuB,QAAN,CAAerO,CAAf,CAAvH;AAAyI;;AAAoB,QAAdwO,cAAc,CAACxO,CAAD,EAAG;AAAC,UAAK;AAACyO,MAAAA,gBAAgB,EAACvO,CAAlB;AAAoBwO,MAAAA,iBAAiB,EAACvO;AAAtC,QAAyC;AAACsO,MAAAA,gBAAgB,EAACrD,IAAI,CAACC,KAAL,CAAW,KAAK/E,iBAAL,CAAuBE,KAAvB,CAA6B0E,IAA7B,CAAkC,CAAlC,IAAqClL,CAAC,CAAC2O,eAAlD,CAAlB;AAAqFD,MAAAA,iBAAiB,EAACtD,IAAI,CAACC,KAAL,CAAW,KAAK/E,iBAAL,CAAuBE,KAAvB,CAA6B0E,IAA7B,CAAkC,CAAlC,IAAqClL,CAAC,CAAC2O,eAAlD;AAAvG,KAA9C;AAAA,UAAyNtO,CAAC,GAAC,CAA3N;AAAA,UAA6NE,CAAC,GAAC,KAAKyF,OAApO;AAAA,UAA4OvF,CAAC,GAAC,KAAK0I,MAAL,CAAYyF,KAAZ,EAA9O;;AAAkQ,QAAG,QAAM5O,CAAC,CAACmL,QAAX,EAAoB;AAAC,YAAMjL,CAAC,GAACO,CAAC,CAACoO,SAAV;AAAoBpO,MAAAA,CAAC,CAACoO,SAAF,CAAY1D,QAAZ,GAAqBnL,CAAC,CAACmL,QAAvB,EAAgC1K,CAAC,CAACoO,SAAF,GAAY3O,CAA5C;AAA8C;;AAAA,UAAMQ,CAAC,GAAC,EAAC,GAAG,KAAK4F,iBAAT;AAA2BC,MAAAA,SAAS,EAAC,IAArC;AAA0CM,MAAAA,aAAa,EAAC,CAAxD;AAA0DD,MAAAA,UAAU,EAAC,CAAC,CAAtE;AAAwEJ,MAAAA,KAAK,EAAC/F,CAA9E;AAAgFgG,MAAAA,UAAU,EAACpG,CAA3F;AAA6F2G,MAAAA,IAAI,EAAC8H,WAAW,CAACC,GAAZ,EAAlG;AAAoHhI,MAAAA,SAAS,EAAC,CAA9H;AAAgID,MAAAA,SAAS,EAAC,IAA1I;AAA+II,MAAAA,OAAO,EAAC,IAAvJ;AAA4JD,MAAAA,gBAAgB,EAAC,CAAC;AAA9K,KAAR;AAAA,UAAyLtG,CAAC,GAAC,IAAIkD,CAAJ,CAAMtD,CAAN,EAAQ;AAACyL,MAAAA,WAAW,EAACvJ,CAAC,CAACwJ,OAAf;AAAuBC,MAAAA,kBAAkB,EAACvJ,CAAC,CAACwJ,2BAA5C;AAAwEL,MAAAA,KAAK,EAAC5L,CAA9E;AAAgF6L,MAAAA,MAAM,EAAC5L;AAAvF,KAAR,CAA3L;AAAA,UAA8RS,CAAC,GAACL,CAAC,CAAC+K,yBAAF,EAAhS;AAAA,UAA8TxK,CAAC,GAACP,CAAC,CAACyO,WAAF,EAAhU;AAAgVzO,IAAAA,CAAC,CAACqM,eAAF,CAAkBjM,CAAlB,GAAqBJ,CAAC,CAACgO,WAAF,CAAc,CAAd,EAAgB,CAAhB,EAAkBrO,CAAlB,EAAoBC,CAApB,CAArB,EAA4C,KAAK4J,eAAL,CAAqB/J,CAAC,CAAC6J,QAAvB,EAAgCnJ,CAAhC,CAA5C;;AAA+E,UAAMK,CAAC,GAAC,KAAKkO,mBAAL,CAAyBtO,CAAzB,EAA2B,EAAC,GAAGX,CAAC,CAACkP,QAAN;AAAe3M,MAAAA,CAAC,EAACpC,CAAC,IAAEH,CAAC,CAACkP,QAAF,CAAW3M,CAAX,GAAavC,CAAC,CAACkP,QAAF,CAAWnD,MAA1B;AAAlB,KAA3B,CAAR;;AAAyFxL,IAAAA,CAAC,CAACqM,eAAF,CAAkBhM,CAAlB,GAAqBL,CAAC,CAACgO,WAAF,CAAczN,CAAC,CAAC6B,CAAhB,EAAkB7B,CAAC,CAACyB,CAApB,EAAsBzB,CAAC,CAACgL,KAAxB,EAA8BhL,CAAC,CAACiL,MAAhC,CAArB,EAA6D,KAAKjD,aAAL,EAA7D;AAAkF,UAAMjI,CAAC,GAAC,MAAME,CAAd;AAAgB,QAAIC,CAAJ;AAAM,UAAIhB,CAAC,CAACmP,WAAN,GAAkBnO,CAAC,GAACH,CAApB,IAAuBG,CAAC,GAAC,IAAIoO,SAAJ,CAAchE,IAAI,CAACC,KAAL,CAAWxK,CAAC,CAACiL,KAAF,GAAQ9L,CAAC,CAACmP,WAArB,CAAd,EAAgD/D,IAAI,CAACC,KAAL,CAAWxK,CAAC,CAACkL,MAAF,GAAS/L,CAAC,CAACmP,WAAtB,CAAhD,CAAF,EAAsFpN,CAAC,CAAClB,CAAD,EAAGG,CAAH,EAAK,CAAC,CAAN,CAA9G;AAAwH,WAAOiB,CAAC,CAACjB,CAAD,EAAG;AAACqO,MAAAA,MAAM,EAACrP,CAAC,CAACqP,MAAV;AAAiBC,MAAAA,OAAO,EAACtP,CAAC,CAACsP,OAA3B;AAAmCnE,MAAAA,QAAQ,EAAC,CAA5C;AAA8CoE,MAAAA,kBAAkB,EAAC,CAAC;AAAlE,KAAH,EAAwE9J,QAAQ,CAACC,aAAT,CAAuB,QAAvB,CAAxE,EAAyG;AAAC8J,MAAAA,KAAK,EAAC,CAAC,CAAR;AAAUC,MAAAA,kBAAkB,EAAC,CAAC;AAA9B,KAAzG,CAAR;AAAmJ;;AAAyB,QAAnBR,mBAAmB,CAACjP,CAAD,EAAGE,CAAH,EAAK;AAAC,UAAMC,CAAC,GAACgC,CAAC,CAACjC,CAAC,CAAC4L,KAAH,EAAS5L,CAAC,CAAC6L,MAAX,EAAkBtG,QAAQ,CAACC,aAAT,CAAuB,QAAvB,CAAlB,CAAT;AAA6D,WAAO,MAAM1F,CAAC,CAAC0P,eAAF,CAAkBxP,CAAC,CAACyC,CAApB,EAAsBzC,CAAC,CAACqC,CAAxB,EAA0BrC,CAAC,CAAC4L,KAA5B,EAAkC5L,CAAC,CAAC6L,MAApC,EAA2CxI,CAAC,CAACoM,IAA7C,EAAkDlM,CAAC,CAACmM,aAApD,EAAkE,IAAIC,UAAJ,CAAe1P,CAAC,CAAC2P,IAAF,CAAOC,MAAtB,CAAlE,CAAN,EAAuG5P,CAA9G;AAAgH;;AAAAmO,EAAAA,aAAa,CAACtO,CAAD,EAAG;AAAC,UAAME,CAAC,GAAC,KAAK2F,OAAb;AAAA,UAAqB1F,CAAC,GAACD,CAAC,CAAC8P,KAAzB;AAAA,UAA+B;AAACxJ,MAAAA,KAAK,EAAC;AAAC0E,QAAAA,IAAI,EAAC7K;AAAN,OAAP;AAAgBoG,MAAAA,UAAU,EAAClG;AAA3B,QAA8BP,CAA7D;AAAA,UAA+DS,CAAC,GAACJ,CAAC,CAAC,CAAD,CAAlE;AAAA,UAAsEK,CAAC,GAACL,CAAC,CAAC,CAAD,CAAzE;AAAA,UAA6EM,CAAC,GAACyK,IAAI,CAACC,KAAL,CAAW5K,CAAC,GAACF,CAAb,CAA/E;AAAA,UAA+FK,CAAC,GAACwK,IAAI,CAACC,KAAL,CAAW3K,CAAC,GAACH,CAAb,CAAjG;AAAiHL,IAAAA,CAAC,CAAC4L,KAAF,KAAUnL,CAAV,IAAaT,CAAC,CAAC6L,MAAF,KAAWnL,CAAxB,KAA4BV,CAAC,CAAC4L,KAAF,GAAQnL,CAAR,EAAUT,CAAC,CAAC6L,MAAF,GAASnL,CAA/C,GAAkDT,CAAC,CAAC2L,KAAF,GAAQrL,CAAC,GAAC,IAA5D,EAAiEN,CAAC,CAAC4L,MAAF,GAASrL,CAAC,GAAC,IAA5E;AAAiF;;AAAAgM,EAAAA,uBAAuB,CAAC1M,CAAD,EAAG;AAAC,QAAG,KAAKkF,wBAAR,EAAiC,OAAM,CAAC,CAAP;AAAS,UAAMhF,CAAC,GAAC6D,CAAC,CAAC/D,CAAD,EAAG2B,CAAH,CAAT;AAAe,QAAG,CAACzB,CAAJ,EAAM,OAAM,CAAC,CAAP;AAAS,UAAMC,CAAC,GAACkC,CAAC,CAAC4N,YAAF,CAAejQ,CAAf,EAAiB2D,CAAC,CAACuM,WAAnB,EAA+B,KAAKvL,SAApC,CAAR;AAAA,UAAuDtE,CAAC,GAAC,IAAI8P,WAAJ,CAAgB,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,EAAO,CAAP,EAAS,CAAT,EAAW,CAAX,CAAhB,CAAzD;AAAA,UAAwF5P,CAAC,GAAC8B,CAAC,CAAC+N,WAAF,CAAcpQ,CAAd,EAAgB2D,CAAC,CAAC0M,WAAlB,EAA8BhQ,CAA9B,CAA1F;AAAA,UAA2HI,CAAC,GAACkB,CAAC,CAAC2O,UAA/H;AAAA,UAA0I5P,CAAC,GAAC;AAAC6P,MAAAA,QAAQ,EAAC,CAAC,IAAIlM,CAAJ,CAAM,OAAN,EAAc,CAAd,EAAgBlB,CAAC,CAACqN,KAAlB,EAAwB,CAAxB,EAA0B,CAA1B,CAAD;AAAV,KAA5I;AAAA,UAAsL7P,CAAC,GAAC,IAAIwD,CAAJ,CAAMnE,CAAN,EAAQS,CAAR,EAAUC,CAAV,EAAY;AAAC6P,MAAAA,QAAQ,EAACpQ;AAAV,KAAZ,EAAyBI,CAAzB,CAAxL;AAAoN,WAAO,KAAKiI,mBAAL,GAAyBtI,CAAzB,EAA2B,KAAKqI,QAAL,GAAcpI,CAAzC,EAA2C,KAAKmI,QAAL,GAAc3H,CAAzD,EAA2D,KAAKuE,wBAAL,GAA8B,CAAC,CAA1F,EAA4F,CAAC,CAApG;AAAsG;;AAAA+C,EAAAA,WAAW,GAAE;AAAC,WAAK,KAAKxD,MAAL,CAAYyG,IAAZ,GAAiB,CAAtB,GAAyB;AAAC,YAAMlL,CAAC,GAACyQ,KAAK,CAACC,IAAN,CAAW,KAAKjM,MAAhB,CAAR;;AAAgC,WAAKA,MAAL,CAAYqG,KAAZ;;AAAoB,WAAI,MAAM5K,CAAV,IAAeF,CAAf,EAAiBE,CAAC,CAACyQ,aAAF;AAAkB;AAAC;;AAAApG,EAAAA,yBAAyB,CAACvK,CAAD,EAAG;AAAC,QAAIE,CAAC,GAAC,CAAC,CAAP;;AAAS,SAAI,MAAMC,CAAV,IAAeH,CAAf,EAAiB;AAAC,UAAG,EAAEG,CAAC,YAAYiB,CAAf,CAAH,EAAqB;AAAClB,QAAAA,CAAC,GAACA,CAAC,IAAE,CAAC,CAAN;AAAQ;AAAM;;AAAA,UAAGC,CAAC,CAACyQ,SAAL,EAAe,OAAM,CAAC,CAAP;AAAS1Q,MAAAA,CAAC,GAACA,CAAC,IAAE,KAAKqK,yBAAL,CAA+BpK,CAAC,CAAC0J,QAAjC,CAAL;AAAgD;;AAAA,WAAO3J,CAAP;AAAS;;AAAzsT;;AAA0sT,SAAOoE,CAAC,IAAIuM,iBAAZ,EAA8BtM,CAAC,IAAIuM,KAAnC","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport e from\"../../../core/Error.js\";import{on as t}from\"../../../core/events.js\";import i from\"../../../core/has.js\";import{isSome as r}from\"../../../core/maybe.js\";import{addFrameTask as s}from\"../../../core/scheduling.js\";import{init as n}from\"../../../core/watchUtils.js\";import{t as a}from\"../../../chunks/common.js\";import{a as o,r as h}from\"../../../chunks/mat2d.js\";import{c as l}from\"../../../chunks/mat2df64.js\";import{c as d}from\"../../../chunks/mat3f32.js\";import{s as c,t as p}from\"../../../chunks/vec2.js\";import{a as m}from\"../../../chunks/vec2f64.js\";import u from\"../../../symbols/cim/CIMResourceManager.js\";import{Container as _}from\"./Container.js\";import{WGLDrawPhase as g}from\"./webgl/enums.js\";import f from\"./webgl/Painter.js\";import{Profiler as b}from\"./webgl/Profiler.js\";import{stencil as R}from\"./webgl/shaders/StencilPrograms.js\";import{Timeline as w}from\"../support/Timeline.js\";import{resampleHermite as O,encodeResult as E,createEmptyImageData as F}from\"../../support/screenshotUtils.js\";import{BufferObject as T}from\"../../webgl/BufferObject.js\";import{createContextOrErrorHTML as y}from\"../../webgl/context-util.js\";import{TargetType as C,DepthStencilTargetType as x,StencilOperation as B,CompareFunction as P,PrimitiveType as S,DataType as j,TextureSamplingMode as L,PixelFormat as A,PixelType as v,Usage as D}from\"../../webgl/enums.js\";import{FramebufferObject as k}from\"../../webgl/FramebufferObject.js\";import{createProgram as M}from\"../../webgl/ProgramTemplate.js\";import{RenderingContext as H}from\"../../webgl/RenderingContext.js\";import{VertexArrayObject as I}from\"../../webgl/VertexArrayObject.js\";import{VertexElementDescriptor as U}from\"../../webgl/VertexElementDescriptor.js\";const q=2e3;class W extends _{constructor(n,a){super(),this._trash=new Set,this._clipData=new Float32Array(8),this._upperLeft=m(),this._upperRight=m(),this._lowerLeft=m(),this._lowerRight=m(),this._mat2=l(),this._clipRendererInitialized=!1,this._renderRemainingTime=0,this._lastFrameRenderTime=0,this.renderRequested=!1,this.stage=this,this._stationary=!0;const{canvas:o=document.createElement(\"canvas\"),alpha:h=!0,stencil:d=!0,contextOptions:c={}}=a;this._canvas=o;const p=y(\"2d\",o,{alpha:h,antialias:!1,depth:!0,stencil:d});this.context=new H(r(p)?p:null,c),this.resourceManager=new u,this.painter=new f(this.context,this,this.resourceManager),i(\"esri-2d-profiler\")&&(this._debugOutput=document.createElement(\"div\"),this._debugOutput.setAttribute(\"style\",\"margin: 24px 64px; position: absolute; color: red;\"),n.appendChild(this._debugOutput)),this._renderParameters={drawPhase:0,state:this.state,pixelRatio:window.devicePixelRatio,stationary:!1,globalOpacity:1,blendMode:null,deltaTime:-1,time:0,inFadeTransition:!1,effects:null,context:this.context,painter:this.painter,timeline:a.timeline||new w,renderingOptions:a.renderingOptions,requireFBO:!1,profiler:new b(this.context,this._debugOutput),dataUploadCounter:0},this._taskHandle=s({render:e=>this.renderFrame(e)}),this._taskHandle.pause(),this._lostWebGLContextHandle=t(o,\"webglcontextlost\",(()=>{this.emit(\"webgl-error\",{error:new e(\"webgl-context-lost\")})})),o.setAttribute(\"style\",\"width: 100%; height:100%; display:block;\"),n.appendChild(o)}destroy(){this.removeAllChildren(),this._emptyTrash(),this._taskHandle.remove(),this._taskHandle=null,this._boundFBO=null,this._clipFBO&&(this._clipFBO.dispose(),this._clipFBO=null),this._clipVAO&&(this._clipVAO.dispose(),this._clipVAO=null,this._clipVBO=null),this._clipStencilProgram&&(this._clipStencilProgram.dispose(),this._clipStencilProgram=null),this._lostWebGLContextHandle&&(this._lostWebGLContextHandle.remove(),this._lostWebGLContextHandle=null),this._canvas.parentNode&&this._canvas.parentNode.removeChild(this._canvas),this._debugOutput&&this._debugOutput.parentNode&&this._debugOutput.parentNode.removeChild(this._debugOutput),this.highlightOptions=null,this.resourceManager.destroy(),this.painter.dispose(),this.context.dispose(),this._canvas=null}get background(){return this._background}set background(e){this._background=e,this.requestRender()}get highlightOptions(){return this._highlightOptions}set highlightOptions(e){this._highlightOptionsHandle&&(this._highlightOptionsHandle.remove(),this._highlightOptionsHandle=null),this._highlightOptions=e,this._highlightOptions&&(this._highlightOptionsHandle=n(this._highlightOptions,\"version\",(()=>{this.painter.setHighlightOptions(e),this.requestRender()})))}get renderingOptions(){return this._renderingOptions}set renderingOptions(e){this._renderingOptions=e,this.requestRender()}get state(){return this._state}set state(e){this._state=e,this.requestRender()}get stationary(){return this._stationary}set stationary(e){this._stationary!==e&&(this._stationary=e,this.requestRender())}trashDisplayObject(e){this._trash.add(e),this.requestRender()}untrashDisplayObject(e){return this._trash.delete(e)}requestRender(){this._renderRemainingTime=q,this.renderRequested||(this.renderRequested=!0,this.emit(\"will-render\"),this._taskHandle.resume())}renderFrame(e){const t=this._lastFrameRenderTime?e.time-this._lastFrameRenderTime:0;this._renderRemainingTime-=t,this._renderRemainingTime<=0&&this._taskHandle.pause(),this._lastFrameRenderTime=e.time,this.renderRequested=!1,this._renderParameters.state=this._state,this._renderParameters.stationary=this.stationary,this._renderParameters.pixelRatio=window.devicePixelRatio,this._renderParameters.globalOpacity=1,this._renderParameters.time=e.time,this._renderParameters.deltaTime=e.deltaTime,this._renderParameters.effects=null,this.processRender(this._renderParameters),this._emptyTrash(),this.emit(\"post-render\")}_createTransforms(){return{dvs:d()}}renderChildren(e){for(const t of this.children)t.beforeRender(e);this._renderChildren(this.children,e);for(const t of this.children)t.afterRender(e)}_renderChildren(e,t){const r=this.context;t.profiler.recordStart(\"drawLayers\"),t.dataUploadCounter=0,this._beforeRenderChildren(t),t.drawPhase=g.MAP,this.painter.beforeRenderLayers(r,this.background);for(const i of e)i.processRender(t);this.painter.renderLayers(r),t.drawPhase=g.HIGHLIGHT,this.painter.beforeRenderLayers(r);for(const i of e)i.processRender(t);this.painter.renderLayers(r);if(this._isLabelDrawPhaseRequired(e)){t.drawPhase=g.LABEL,this.painter.beforeRenderLayers(r);for(const i of e)i.processRender(t);this.painter.renderLayers(r)}if(i(\"esri-tiles-debug\")){t.drawPhase=g.DEBUG,this.painter.beforeRenderLayers(r);for(const i of e)i.processRender(t);this.painter.renderLayers(r)}t.profiler.recordEnd(\"drawLayers\"),this._afterRenderChildren()}_beforeRenderChildren(e){const{context:t}=this,{state:i,pixelRatio:r}=e;t.setClearDepth(1),t.setClearColor(0,0,0,0),t.clear(t.gl.COLOR_BUFFER_BIT|t.gl.DEPTH_BUFFER_BIT);const{size:s,rotation:n}=i,l=Math.round(s[0]*r),d=Math.round(s[1]*r);this._boundFBO=t.getBoundFramebufferObject();if(!i.spatialReference.isWrappable)return void(this._clipFrame=!1);const m=a(n),u=Math.abs(Math.cos(m)),_=Math.abs(Math.sin(m)),g=Math.round(l*u+d*_),f=Math.round(i.worldScreenWidth);if(g<=f)return void(this._clipFrame=!1);this._clipFBO&&this._clipFBO.width===l&&this._clipFBO.height===d||(this._clipFBO=new k(t,{colorTarget:C.TEXTURE,depthStencilTarget:x.DEPTH_STENCIL_RENDER_BUFFER,width:l,height:d}));const b=(this.state.padding.left-this.state.padding.right)/2,R=(this.state.padding.bottom-this.state.padding.top)/2,w=.5*l,O=.5*d,E=1/l,F=1/d,T=f*r*.5,y=.5*(l*_+d*u),B=this._upperLeft,P=this._upperRight,S=this._lowerLeft,j=this._lowerRight;c(B,-T,-y),c(P,T,-y),c(S,-T,y),c(j,T,y),o(this._mat2,[w+b,O-R]),0!==n&&h(this._mat2,this._mat2,m),p(B,B,this._mat2),p(P,P,this._mat2),p(S,S,this._mat2),p(j,j,this._mat2);const L=this._clipData;L.set([2*S[0]*E-1,2*(d-S[1])*F-1,2*j[0]*E-1,2*(d-j[1])*F-1,2*B[0]*E-1,2*(d-B[1])*F-1,2*P[0]*E-1,2*(d-P[1])*F-1]),this._clipRendererInitialized||this._initializeClipRenderer(t),this._clipVBO.setData(L),this._boundFBO=t.getBoundFramebufferObject(),t.bindFramebuffer(this._clipFBO),t.setDepthWriteEnabled(!0),t.setStencilWriteMask(255),t.setClearColor(0,0,0,0),t.setClearDepth(1),t.setClearStencil(0),t.clear(t.gl.COLOR_BUFFER_BIT|t.gl.DEPTH_BUFFER_BIT|t.gl.STENCIL_BUFFER_BIT),t.setDepthWriteEnabled(!1),this._clipFrame=!0}_afterRenderChildren(){const e=this.context;if(e.logIno(),this._clipFrame&&this._clipRendererInitialized){if(e.bindFramebuffer(this._boundFBO),this._boundFBO=null,e.bindVAO(this._clipVAO),e.useProgram(this._clipStencilProgram),e.setDepthWriteEnabled(!1),e.setDepthTestEnabled(!1),e.setStencilTestEnabled(!0),e.setBlendingEnabled(!1),e.setColorMask(!1,!1,!1,!1),e.setStencilOp(B.KEEP,B.KEEP,B.REPLACE),e.setStencilWriteMask(255),e.setStencilFunction(P.ALWAYS,1,255),e.drawElements(S.TRIANGLES,6,j.UNSIGNED_SHORT,0),e.bindVAO(),e.setColorMask(!0,!0,!0,!0),null!=this.background){const{r:t,g:i,b:r,a:s}=this.background.color;e.setClearColor(s*t/255,s*i/255,s*r/255,s)}else e.setClearColor(0,0,0,0);e.clear(e.gl.COLOR_BUFFER_BIT),e.setBlendingEnabled(!0),e.setStencilFunction(P.EQUAL,1,255),this.painter.blitTexture(e,this._clipFBO.colorTexture,L.NEAREST,1),e.setStencilTestEnabled(!1)}}doRender(e){const t=this.context,{state:i,pixelRatio:r}=e;this._resizeCanvas(e),t.setViewport(0,0,r*i.size[0],r*i.size[1]),t.setDepthWriteEnabled(!0),t.setStencilWriteMask(255),super.doRender(e)}async takeScreenshot(e){const{framebufferWidth:t,framebufferHeight:i}={framebufferWidth:Math.round(this._renderParameters.state.size[0]*e.resolutionScale),framebufferHeight:Math.round(this._renderParameters.state.size[1]*e.resolutionScale)},r=1,s=this.context,n=this._state.clone();if(null!=e.rotation){const t=n.viewpoint;n.viewpoint.rotation=e.rotation,n.viewpoint=t}const a={...this._renderParameters,drawPhase:null,globalOpacity:1,stationary:!0,state:n,pixelRatio:r,time:performance.now(),deltaTime:0,blendMode:null,effects:null,inFadeTransition:!1},o=new k(s,{colorTarget:C.TEXTURE,depthStencilTarget:x.DEPTH_STENCIL_RENDER_BUFFER,width:t,height:i}),h=s.getBoundFramebufferObject(),l=s.getViewport();s.bindFramebuffer(o),s.setViewport(0,0,t,i),this._renderChildren(e.children,a);const d=this._readbackScreenshot(o,{...e.cropArea,y:i-(e.cropArea.y+e.cropArea.height)});s.bindFramebuffer(h),s.setViewport(l.x,l.y,l.width,l.height),this.requestRender();const c=await d;let p;1===e.outputScale?p=c:(p=new ImageData(Math.round(c.width*e.outputScale),Math.round(c.height*e.outputScale)),O(c,p,!0));return E(p,{format:e.format,quality:e.quality,rotation:0,disableDecorations:!1},document.createElement(\"canvas\"),{flipY:!0,premultipliedAlpha:!0})}async _readbackScreenshot(e,t){const i=F(t.width,t.height,document.createElement(\"canvas\"));return await e.readPixelsAsync(t.x,t.y,t.width,t.height,A.RGBA,v.UNSIGNED_BYTE,new Uint8Array(i.data.buffer)),i}_resizeCanvas(e){const t=this._canvas,i=t.style,{state:{size:r},pixelRatio:s}=e,n=r[0],a=r[1],o=Math.round(n*s),h=Math.round(a*s);t.width===o&&t.height===h||(t.width=o,t.height=h),i.width=n+\"px\",i.height=a+\"px\"}_initializeClipRenderer(e){if(this._clipRendererInitialized)return!0;const t=M(e,R);if(!t)return!1;const i=T.createVertex(e,D.STREAM_DRAW,this._clipData),r=new Uint16Array([0,1,2,2,1,3]),s=T.createIndex(e,D.STATIC_DRAW,r),n=R.attributes,a={geometry:[new U(\"a_pos\",2,j.FLOAT,0,8)]},o=new I(e,n,a,{geometry:i},s);return this._clipStencilProgram=t,this._clipVBO=i,this._clipVAO=o,this._clipRendererInitialized=!0,!0}_emptyTrash(){for(;this._trash.size>0;){const e=Array.from(this._trash);this._trash.clear();for(const t of e)t.processDetach()}}_isLabelDrawPhaseRequired(e){let t=!1;for(const i of e){if(!(i instanceof _)){t=t||!1;break}if(i.hasLabels)return!0;t=t||this._isLabelDrawPhaseRequired(i.children)}return t}}export{q as EXTRA_RENDER_TIME,W as Stage};\n"]},"metadata":{},"sourceType":"module"}