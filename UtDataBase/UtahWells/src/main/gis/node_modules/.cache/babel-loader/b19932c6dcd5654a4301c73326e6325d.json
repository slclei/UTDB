{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport t from \"../PixelBlock.js\";\nimport { isValidPixelBlock as e } from \"./pixelUtils.js\";\n\nfunction i(t) {\n  let {\n    altitude: e,\n    azimuth: i\n  } = t;\n  const {\n    hillshadeType: s,\n    pixelSizePower: n,\n    pixelSizeFactor: a,\n    scalingType: l,\n    isGCS: o,\n    resolution: r\n  } = t,\n        c = \"multi-directional\" === s ? 2 * t.zFactor : t.zFactor,\n        {\n    x: h,\n    y: f\n  } = r;\n  let u = c / (8 * h),\n      d = c / (8 * f);\n  if (o && c > .001 && (u /= 111e3, d /= 111e3), \"adjusted\" === l) if (o) {\n    const t = 111e3 * h,\n          e = 111e3 * f;\n    u = (c + t ** n * a) / (8 * t), d = (c + e ** n * a) / (8 * e);\n  } else u = (c + h ** n * a) / (8 * h), d = (c + f ** n * a) / (8 * f);\n  let p = (90 - e) * Math.PI / 180,\n      m = Math.cos(p),\n      M = (360 - i + 90) * Math.PI / 180,\n      x = Math.sin(p) * Math.cos(M),\n      A = Math.sin(p) * Math.sin(M);\n  const w = [315, 270, 225, 360, 180, 0],\n        y = [60, 60, 60, 60, 60, 90],\n        g = new Float32Array([3, 5, 3, 2, 1, 4]),\n        Z = g.reduce((t, e) => t + e),\n        k = g.map(t => t / Z),\n        P = \"multi-directional\" === s ? w.length : 1,\n        F = new Float32Array(6),\n        b = new Float32Array(6),\n        C = new Float32Array(6);\n  if (\"multi-directional\" === s) for (let U = 0; U < P; U++) e = y[U], i = w[U], p = (90 - e) * Math.PI / 180, m = Math.cos(p), M = (360 - i + 90) * Math.PI / 180, x = Math.sin(p) * Math.cos(M), A = Math.sin(p) * Math.sin(M), F[U] = m, b[U] = x, C[U] = A;else F.fill(m), b.fill(x), C.fill(A);\n  return {\n    resolution: r,\n    factor: [u, d],\n    sinZcosA: x,\n    sinZsinA: A,\n    cosZ: m,\n    sinZcosAs: b,\n    sinZsinAs: C,\n    cosZs: F,\n    weights: k,\n    hillshadeType: [\"traditional\", \"multi-directional\"].indexOf(s)\n  };\n}\n\nfunction s(s, n) {\n  if (!e(s)) return s;\n  const {\n    width: a,\n    height: l,\n    mask: o\n  } = s,\n        r = new Uint8Array(a * l);\n  o && r.set(o);\n  const {\n    factor: c,\n    sinZcosA: h,\n    sinZsinA: f,\n    cosZ: u,\n    sinZcosAs: d,\n    sinZsinAs: p,\n    cosZs: m,\n    weights: M\n  } = i(n),\n        [x, A] = c,\n        {\n    hillshadeType: w\n  } = n,\n        y = s.pixels[0],\n        g = new Uint8Array(a * l);\n  let Z, k, P, F, b, C, U, z;\n  const T = 1;\n\n  for (let t = T; t < l - T; t++) {\n    const e = t * a;\n\n    for (let t = T; t < a - T; t++) {\n      if (o && !o[e + t]) {\n        g[e + t] = 0;\n        continue;\n      }\n\n      let i = 8;\n\n      if (o && (i = o[e - a + t - 1] + o[e - a + t] + o[e - a + t + 1] + o[e + t - 1] + o[e + t + 1] + o[e + a + t - 1] + o[e + a + t] + o[e + a + t + 1], i < 7)) {\n        g[e + t] = 0, r[e + t] = 0;\n        continue;\n      }\n\n      7 === i ? (Z = o[e - a + t - 1] ? y[e - a + t - 1] : y[e + t], k = o[e - a + t] ? y[e - a + t] : y[e + t], P = o[e - a + t + 1] ? y[e - a + t + 1] : y[e + t], F = o[e + t - 1] ? y[e + t - 1] : y[e + t], b = o[e + t + 1] ? y[e + t + 1] : y[e + t], C = o[e + a + t - 1] ? y[e + a + t - 1] : y[e + t], U = o[e + a + t] ? y[e + a + t] : y[e + t], z = o[e + a + t + 1] ? y[e + a + t + 1] : y[e + t]) : (Z = y[e - a + t - 1], k = y[e - a + t], P = y[e - a + t + 1], F = y[e + t - 1], b = y[e + t + 1], C = y[e + a + t - 1], U = y[e + a + t], z = y[e + a + t + 1]);\n      const s = (P + b + b + z - (Z + F + F + C)) * x,\n            n = (C + U + U + z - (Z + k + k + P)) * A,\n            l = Math.sqrt(1 + s * s + n * n);\n      let c = 0;\n\n      if (\"traditional\" === w) {\n        let t = 255 * (u + f * n - h * s) / l;\n        t < 0 && (t = 0), c = t;\n      } else {\n        const t = p.length;\n\n        for (let e = 0; e < t; e++) {\n          let t = 255 * (m[e] + p[e] * n - d[e] * s) / l;\n          t < 0 && (t = 0), c += t * M[e];\n        }\n      }\n\n      g[e + t] = 255 & c;\n    }\n  }\n\n  for (let t = 0; t < l; t++) g[t * a] = g[t * a + 1], g[(t + 1) * a - 1] = g[(t + 1) * a - 2];\n\n  for (let t = 1; t < a - 1; t++) g[t] = g[t + a], g[t + (l - 1) * a] = g[t + (l - 2) * a];\n\n  return new t({\n    width: a,\n    height: l,\n    pixels: [g],\n    mask: o ? r : null,\n    pixelType: \"u8\",\n    validPixelCount: s.validPixelCount,\n    statistics: [{\n      minValue: 0,\n      maxValue: 255\n    }]\n  });\n}\n\nfunction n(t, i, s, n) {\n  if (!e(t) || !e(i)) return;\n  const {\n    min: a,\n    max: l\n  } = n,\n        o = t.pixels[0],\n        {\n    pixels: r,\n    mask: c\n  } = i,\n        h = r[0],\n        f = 255.00001 / (l - a),\n        u = new Uint8ClampedArray(h.length),\n        d = new Uint8ClampedArray(h.length),\n        p = new Uint8ClampedArray(h.length),\n        m = s.length - 1;\n\n  for (let e = 0; e < h.length; e++) {\n    if (c && 0 === c[e]) continue;\n    const t = Math.floor((h[e] - a) * f),\n          [i, n] = s[t < 0 ? 0 : t > m ? m : t],\n          l = o[e],\n          r = l * n,\n          M = r * (1 - Math.abs(i % 2 - 1)),\n          x = l - r;\n\n    switch (Math.floor(i)) {\n      case 0:\n        u[e] = r + x, d[e] = M + x, p[e] = x;\n        break;\n\n      case 1:\n        u[e] = M + x, d[e] = r + x, p[e] = x;\n        break;\n\n      case 2:\n        u[e] = x, d[e] = r + x, p[e] = M + x;\n        break;\n\n      case 3:\n        u[e] = x, d[e] = M + x, p[e] = r + x;\n        break;\n\n      case 4:\n        u[e] = M + x, d[e] = x, p[e] = r + x;\n        break;\n\n      case 5:\n      case 6:\n        u[e] = r + x, d[e] = x, p[e] = M + x;\n    }\n  }\n\n  t.pixels = [u, d, p], t.updateStatistics();\n}\n\nexport { i as calculateHillshadeParams, s as hillshade, n as tintHillshade };","map":{"version":3,"sources":["D:/Github/CUSP_DataBase/CUSP_DB/src/main/gis/node_modules/@arcgis/core/layers/support/rasterFunctions/surfaceUtils.js"],"names":["t","isValidPixelBlock","e","i","altitude","azimuth","hillshadeType","s","pixelSizePower","n","pixelSizeFactor","a","scalingType","l","isGCS","o","resolution","r","c","zFactor","x","h","y","f","u","d","p","Math","PI","m","cos","M","sin","A","w","g","Float32Array","Z","reduce","k","map","P","length","F","b","C","U","fill","factor","sinZcosA","sinZsinA","cosZ","sinZcosAs","sinZsinAs","cosZs","weights","indexOf","width","height","mask","Uint8Array","set","pixels","z","T","sqrt","pixelType","validPixelCount","statistics","minValue","maxValue","min","max","Uint8ClampedArray","floor","abs","updateStatistics","calculateHillshadeParams","hillshade","tintHillshade"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport t from\"../PixelBlock.js\";import{isValidPixelBlock as e}from\"./pixelUtils.js\";function i(t){let{altitude:e,azimuth:i}=t;const{hillshadeType:s,pixelSizePower:n,pixelSizeFactor:a,scalingType:l,isGCS:o,resolution:r}=t,c=\"multi-directional\"===s?2*t.zFactor:t.zFactor,{x:h,y:f}=r;let u=c/(8*h),d=c/(8*f);if(o&&c>.001&&(u/=111e3,d/=111e3),\"adjusted\"===l)if(o){const t=111e3*h,e=111e3*f;u=(c+t**n*a)/(8*t),d=(c+e**n*a)/(8*e)}else u=(c+h**n*a)/(8*h),d=(c+f**n*a)/(8*f);let p=(90-e)*Math.PI/180,m=Math.cos(p),M=(360-i+90)*Math.PI/180,x=Math.sin(p)*Math.cos(M),A=Math.sin(p)*Math.sin(M);const w=[315,270,225,360,180,0],y=[60,60,60,60,60,90],g=new Float32Array([3,5,3,2,1,4]),Z=g.reduce(((t,e)=>t+e)),k=g.map((t=>t/Z)),P=\"multi-directional\"===s?w.length:1,F=new Float32Array(6),b=new Float32Array(6),C=new Float32Array(6);if(\"multi-directional\"===s)for(let U=0;U<P;U++)e=y[U],i=w[U],p=(90-e)*Math.PI/180,m=Math.cos(p),M=(360-i+90)*Math.PI/180,x=Math.sin(p)*Math.cos(M),A=Math.sin(p)*Math.sin(M),F[U]=m,b[U]=x,C[U]=A;else F.fill(m),b.fill(x),C.fill(A);return{resolution:r,factor:[u,d],sinZcosA:x,sinZsinA:A,cosZ:m,sinZcosAs:b,sinZsinAs:C,cosZs:F,weights:k,hillshadeType:[\"traditional\",\"multi-directional\"].indexOf(s)}}function s(s,n){if(!e(s))return s;const{width:a,height:l,mask:o}=s,r=new Uint8Array(a*l);o&&r.set(o);const{factor:c,sinZcosA:h,sinZsinA:f,cosZ:u,sinZcosAs:d,sinZsinAs:p,cosZs:m,weights:M}=i(n),[x,A]=c,{hillshadeType:w}=n,y=s.pixels[0],g=new Uint8Array(a*l);let Z,k,P,F,b,C,U,z;const T=1;for(let t=T;t<l-T;t++){const e=t*a;for(let t=T;t<a-T;t++){if(o&&!o[e+t]){g[e+t]=0;continue}let i=8;if(o&&(i=o[e-a+t-1]+o[e-a+t]+o[e-a+t+1]+o[e+t-1]+o[e+t+1]+o[e+a+t-1]+o[e+a+t]+o[e+a+t+1],i<7)){g[e+t]=0,r[e+t]=0;continue}7===i?(Z=o[e-a+t-1]?y[e-a+t-1]:y[e+t],k=o[e-a+t]?y[e-a+t]:y[e+t],P=o[e-a+t+1]?y[e-a+t+1]:y[e+t],F=o[e+t-1]?y[e+t-1]:y[e+t],b=o[e+t+1]?y[e+t+1]:y[e+t],C=o[e+a+t-1]?y[e+a+t-1]:y[e+t],U=o[e+a+t]?y[e+a+t]:y[e+t],z=o[e+a+t+1]?y[e+a+t+1]:y[e+t]):(Z=y[e-a+t-1],k=y[e-a+t],P=y[e-a+t+1],F=y[e+t-1],b=y[e+t+1],C=y[e+a+t-1],U=y[e+a+t],z=y[e+a+t+1]);const s=(P+b+b+z-(Z+F+F+C))*x,n=(C+U+U+z-(Z+k+k+P))*A,l=Math.sqrt(1+s*s+n*n);let c=0;if(\"traditional\"===w){let t=255*(u+f*n-h*s)/l;t<0&&(t=0),c=t}else{const t=p.length;for(let e=0;e<t;e++){let t=255*(m[e]+p[e]*n-d[e]*s)/l;t<0&&(t=0),c+=t*M[e]}}g[e+t]=255&c}}for(let t=0;t<l;t++)g[t*a]=g[t*a+1],g[(t+1)*a-1]=g[(t+1)*a-2];for(let t=1;t<a-1;t++)g[t]=g[t+a],g[t+(l-1)*a]=g[t+(l-2)*a];return new t({width:a,height:l,pixels:[g],mask:o?r:null,pixelType:\"u8\",validPixelCount:s.validPixelCount,statistics:[{minValue:0,maxValue:255}]})}function n(t,i,s,n){if(!e(t)||!e(i))return;const{min:a,max:l}=n,o=t.pixels[0],{pixels:r,mask:c}=i,h=r[0],f=255.00001/(l-a),u=new Uint8ClampedArray(h.length),d=new Uint8ClampedArray(h.length),p=new Uint8ClampedArray(h.length),m=s.length-1;for(let e=0;e<h.length;e++){if(c&&0===c[e])continue;const t=Math.floor((h[e]-a)*f),[i,n]=s[t<0?0:t>m?m:t],l=o[e],r=l*n,M=r*(1-Math.abs(i%2-1)),x=l-r;switch(Math.floor(i)){case 0:u[e]=r+x,d[e]=M+x,p[e]=x;break;case 1:u[e]=M+x,d[e]=r+x,p[e]=x;break;case 2:u[e]=x,d[e]=r+x,p[e]=M+x;break;case 3:u[e]=x,d[e]=M+x,p[e]=r+x;break;case 4:u[e]=M+x,d[e]=x,p[e]=r+x;break;case 5:case 6:u[e]=r+x,d[e]=x,p[e]=M+x}}t.pixels=[u,d,p],t.updateStatistics()}export{i as calculateHillshadeParams,s as hillshade,n as tintHillshade};\n"]},"metadata":{},"sourceType":"module"}