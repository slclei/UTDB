{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport t from \"../../../../../../core/Error.js\";\nimport e from \"../../../../../../core/Logger.js\";\nimport { isSome as i, unwrapOr as s } from \"../../../../../../core/maybe.js\";\nimport { pt2px as r } from \"../../../../../../core/screenUtils.js\";\nimport { c as o } from \"../../../../../../chunks/mat2df32.js\";\nimport { c as a } from \"../../../../../../chunks/vec2f32.js\";\nimport { Alignment as h } from \"../../../../../../symbols/cim/enums.js\";\nimport { premultiplyAlphaRGBA as c } from \"../../color.js\";\nimport { MIN_MAX_ZOOM_PRECISION_FACTOR as n, SPRITE_PADDING as m } from \"../../definitions.js\";\nimport { i1616to32 as l, i8888to32 as f } from \"../../number.js\";\nimport { MarkerMaterialKey as _ } from \"../../materialKey/MaterialKey.js\";\nimport { isFunction as p, getMinMaxZoom as y } from \"./util.js\";\nimport d from \"./WGLBaseMarkerTemplate.js\";\nimport M from \"./WGLDynamicMeshTemplate.js\";\nimport { ok as u } from \"../../util/Result.js\";\nconst g = a(),\n      k = o(),\n      P = e.getLogger(\"esri.views.2d.engine.webgl.WGLDynamicMarkerTemplate\");\n\nclass L extends d(M) {\n  constructor(t, e, o) {\n    super(t), this._cimMarkerLayer = t, this._minMaxZoom = l(Math.round(e * n), Math.round(o * n));\n    const a = t.color;\n\n    if (p(a)) {\n      const t = (t, e, i) => c(a(t, e, i));\n\n      this._dynamicPropertyMap.set(\"_fillColor\", t);\n    } else this._fillColor = c(a);\n\n    const m = t.outlineColor;\n\n    if (p(m)) {\n      const t = (t, e, i) => c(m(t, e, i));\n\n      this._dynamicPropertyMap.set(\"_outlineColor\", t);\n    } else this._outlineColor = c(m);\n\n    const f = t.size;\n\n    if (p(f)) {\n      const t = (t, e, i) => r(f(t, e, i));\n\n      this._dynamicPropertyMap.set(\"_size\", t);\n    } else this._size = r(f) || 0;\n\n    const _ = t.scaleX;\n    p(_) ? this._dynamicPropertyMap.set(\"_scaleX\", _) : this._scaleX = _ || 1;\n    const y = t.offsetX;\n\n    if (p(y)) {\n      const t = (t, e, i) => r(y(t, e, i));\n\n      this._dynamicPropertyMap.set(\"xOffset\", t);\n    } else this.xOffset = r(y) || 0;\n\n    const d = t.offsetY;\n\n    if (p(d)) {\n      const t = (t, e, i) => r(d(t, e, i));\n\n      this._dynamicPropertyMap.set(\"yOffset\", t);\n    } else this.yOffset = r(d) || 0;\n\n    const M = t.outlineWidth;\n\n    if (p(M)) {\n      const t = (t, e, i) => r(M(t, e, i));\n\n      this._dynamicPropertyMap.set(\"_outlineWidth\", t);\n    } else this._outlineWidth = r(M) || 0;\n\n    const u = t.rotation;\n\n    if (p(u) ? this._dynamicPropertyMap.set(\"_angle\", u) : this._angle = u || 0, i(t.effects)) {\n      const e = t.effects;\n      p(e) ? this._dynamicPropertyMap.set(\"_effects\", e) : this._effects = e;\n    }\n\n    if (i(t.markerPlacement)) {\n      const e = t.markerPlacement;\n      p(e) ? this._dynamicPropertyMap.set(\"_markerPlacement\", e) : this._markerPlacement = e;\n    }\n\n    this._scaleFactor = s(t.scaleFactor, 1), this._bitSet = (t.alignment === h.MAP ? 1 : 0) | (t.colorLocked ? 1 : 0) << 1 | (t.scaleSymbolsProportionally ? 1 : 0) << 3, this._materialKey = t.materialKey;\n  }\n\n  static fromCIMMarker(t, e) {\n    const [i, s] = y(t.scaleInfo, e);\n    return new L(t, i, s);\n  }\n\n  bindFeature(e, i, s) {\n    const o = e.readLegacyFeature();\n\n    this._dynamicPropertyMap.forEach((t, e) => {\n      this[e] = t(o, i, s);\n    });\n\n    const a = this._cimMarkerLayer.materialHash,\n          h = \"function\" == typeof a ? a(o, i, s) : a,\n          c = this._materialCache.get(h);\n\n    if (!c || !u(c.spriteMosaicItem) || !c.spriteMosaicItem) return void P.error(new t(\"mapview-cim\", \"Encountered an error when binding feature\"));\n    const n = c.spriteMosaicItem,\n          p = this._cimMarkerLayer.sizeRatio,\n          y = n.width / n.height * this._scaleX,\n          d = this._cimMarkerLayer.rotateClockwise ? this._angle : -this._angle;\n    let M = this._size,\n        L = M * y;\n    const x = this.xOffset,\n          j = this.yOffset;\n    this.xOffset *= this._scaleFactor, this.yOffset *= this._scaleFactor;\n    const w = this._cimMarkerLayer.scaleSymbolsProportionally && this._cimMarkerLayer.frameHeight ? this._size / r(this._cimMarkerLayer.frameHeight) : 1,\n          b = this._outlineWidth * w,\n          z = r(this._cimMarkerLayer.referenceSize);\n    let O = 0,\n        W = 0;\n    const C = this._cimMarkerLayer.anchorPoint;\n    C && (this._cimMarkerLayer.isAbsoluteAnchorPoint ? this._size && (O = -C.x / (this._size * y), W = C.y / this._size) : (O = C.x, W = C.y)), this._sizeOutlineWidth = f(Math.round(Math.min(Math.sqrt(128 * L), 255)), Math.round(Math.min(Math.sqrt(128 * M), 255)), Math.round(Math.min(Math.sqrt(128 * b), 255)), Math.round(Math.min(Math.sqrt(128 * z), 255))), this.angle = d;\n    const F = Math.round(64 * p);\n    this._bitestAndDistRatio = l(this._bitSet, F);\n    const K = n.rect.x + m,\n          X = n.rect.y + m,\n          B = K + n.width,\n          I = X + n.height;\n    this._texUpperLeft = l(K, X), this._texUpperRight = l(B, X), this._texBottomLeft = l(K, I), this._texBottomRight = l(B, I);\n\n    const R = _.load(this._materialKey);\n\n    R.sdf = n.sdf, R.pattern = !0, R.textureBinding = n.textureBinding, this._materialKey = R.data, this._anchorX = .5 - (.5 + O) * n.width / n.width, this._anchorY = .5 - (.5 + W) * n.height / n.height, L *= p, M *= p, L *= this._scaleFactor, M *= this._scaleFactor, L *= n.rect.width / n.width, M *= n.rect.height / n.height, this._computedWidth = L, this._computedHeight = M, this._applyTransformation(k, g), this.xOffset = x, this.yOffset = j;\n  }\n\n}\n\nexport { L as default };","map":{"version":3,"sources":["D:/Github/CUSP_DataBase/CUSP_DB/src/main/gis/node_modules/@arcgis/core/views/2d/engine/webgl/mesh/templates/WGLDynamicMarkerTemplate.js"],"names":["t","e","isSome","i","unwrapOr","s","pt2px","r","c","o","a","Alignment","h","premultiplyAlphaRGBA","MIN_MAX_ZOOM_PRECISION_FACTOR","n","SPRITE_PADDING","m","i1616to32","l","i8888to32","f","MarkerMaterialKey","_","isFunction","p","getMinMaxZoom","y","d","M","ok","u","g","k","P","getLogger","L","constructor","_cimMarkerLayer","_minMaxZoom","Math","round","color","_dynamicPropertyMap","set","_fillColor","outlineColor","_outlineColor","size","_size","scaleX","_scaleX","offsetX","xOffset","offsetY","yOffset","outlineWidth","_outlineWidth","rotation","_angle","effects","_effects","markerPlacement","_markerPlacement","_scaleFactor","scaleFactor","_bitSet","alignment","MAP","colorLocked","scaleSymbolsProportionally","_materialKey","materialKey","fromCIMMarker","scaleInfo","bindFeature","readLegacyFeature","forEach","materialHash","_materialCache","get","spriteMosaicItem","error","sizeRatio","width","height","rotateClockwise","x","j","w","frameHeight","b","z","referenceSize","O","W","C","anchorPoint","isAbsoluteAnchorPoint","_sizeOutlineWidth","min","sqrt","angle","F","_bitestAndDistRatio","K","rect","X","B","I","_texUpperLeft","_texUpperRight","_texBottomLeft","_texBottomRight","R","load","sdf","pattern","textureBinding","data","_anchorX","_anchorY","_computedWidth","_computedHeight","_applyTransformation","default"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport t from\"../../../../../../core/Error.js\";import e from\"../../../../../../core/Logger.js\";import{isSome as i,unwrapOr as s}from\"../../../../../../core/maybe.js\";import{pt2px as r}from\"../../../../../../core/screenUtils.js\";import{c as o}from\"../../../../../../chunks/mat2df32.js\";import{c as a}from\"../../../../../../chunks/vec2f32.js\";import{Alignment as h}from\"../../../../../../symbols/cim/enums.js\";import{premultiplyAlphaRGBA as c}from\"../../color.js\";import{MIN_MAX_ZOOM_PRECISION_FACTOR as n,SPRITE_PADDING as m}from\"../../definitions.js\";import{i1616to32 as l,i8888to32 as f}from\"../../number.js\";import{MarkerMaterialKey as _}from\"../../materialKey/MaterialKey.js\";import{isFunction as p,getMinMaxZoom as y}from\"./util.js\";import d from\"./WGLBaseMarkerTemplate.js\";import M from\"./WGLDynamicMeshTemplate.js\";import{ok as u}from\"../../util/Result.js\";const g=a(),k=o(),P=e.getLogger(\"esri.views.2d.engine.webgl.WGLDynamicMarkerTemplate\");class L extends(d(M)){constructor(t,e,o){super(t),this._cimMarkerLayer=t,this._minMaxZoom=l(Math.round(e*n),Math.round(o*n));const a=t.color;if(p(a)){const t=(t,e,i)=>c(a(t,e,i));this._dynamicPropertyMap.set(\"_fillColor\",t)}else this._fillColor=c(a);const m=t.outlineColor;if(p(m)){const t=(t,e,i)=>c(m(t,e,i));this._dynamicPropertyMap.set(\"_outlineColor\",t)}else this._outlineColor=c(m);const f=t.size;if(p(f)){const t=(t,e,i)=>r(f(t,e,i));this._dynamicPropertyMap.set(\"_size\",t)}else this._size=r(f)||0;const _=t.scaleX;p(_)?this._dynamicPropertyMap.set(\"_scaleX\",_):this._scaleX=_||1;const y=t.offsetX;if(p(y)){const t=(t,e,i)=>r(y(t,e,i));this._dynamicPropertyMap.set(\"xOffset\",t)}else this.xOffset=r(y)||0;const d=t.offsetY;if(p(d)){const t=(t,e,i)=>r(d(t,e,i));this._dynamicPropertyMap.set(\"yOffset\",t)}else this.yOffset=r(d)||0;const M=t.outlineWidth;if(p(M)){const t=(t,e,i)=>r(M(t,e,i));this._dynamicPropertyMap.set(\"_outlineWidth\",t)}else this._outlineWidth=r(M)||0;const u=t.rotation;if(p(u)?this._dynamicPropertyMap.set(\"_angle\",u):this._angle=u||0,i(t.effects)){const e=t.effects;p(e)?this._dynamicPropertyMap.set(\"_effects\",e):this._effects=e}if(i(t.markerPlacement)){const e=t.markerPlacement;p(e)?this._dynamicPropertyMap.set(\"_markerPlacement\",e):this._markerPlacement=e}this._scaleFactor=s(t.scaleFactor,1),this._bitSet=(t.alignment===h.MAP?1:0)|(t.colorLocked?1:0)<<1|(t.scaleSymbolsProportionally?1:0)<<3,this._materialKey=t.materialKey}static fromCIMMarker(t,e){const[i,s]=y(t.scaleInfo,e);return new L(t,i,s)}bindFeature(e,i,s){const o=e.readLegacyFeature();this._dynamicPropertyMap.forEach(((t,e)=>{this[e]=t(o,i,s)}));const a=this._cimMarkerLayer.materialHash,h=\"function\"==typeof a?a(o,i,s):a,c=this._materialCache.get(h);if(!c||!u(c.spriteMosaicItem)||!c.spriteMosaicItem)return void P.error(new t(\"mapview-cim\",\"Encountered an error when binding feature\"));const n=c.spriteMosaicItem,p=this._cimMarkerLayer.sizeRatio,y=n.width/n.height*this._scaleX,d=this._cimMarkerLayer.rotateClockwise?this._angle:-this._angle;let M=this._size,L=M*y;const x=this.xOffset,j=this.yOffset;this.xOffset*=this._scaleFactor,this.yOffset*=this._scaleFactor;const w=this._cimMarkerLayer.scaleSymbolsProportionally&&this._cimMarkerLayer.frameHeight?this._size/r(this._cimMarkerLayer.frameHeight):1,b=this._outlineWidth*w,z=r(this._cimMarkerLayer.referenceSize);let O=0,W=0;const C=this._cimMarkerLayer.anchorPoint;C&&(this._cimMarkerLayer.isAbsoluteAnchorPoint?this._size&&(O=-C.x/(this._size*y),W=C.y/this._size):(O=C.x,W=C.y)),this._sizeOutlineWidth=f(Math.round(Math.min(Math.sqrt(128*L),255)),Math.round(Math.min(Math.sqrt(128*M),255)),Math.round(Math.min(Math.sqrt(128*b),255)),Math.round(Math.min(Math.sqrt(128*z),255))),this.angle=d;const F=Math.round(64*p);this._bitestAndDistRatio=l(this._bitSet,F);const K=n.rect.x+m,X=n.rect.y+m,B=K+n.width,I=X+n.height;this._texUpperLeft=l(K,X),this._texUpperRight=l(B,X),this._texBottomLeft=l(K,I),this._texBottomRight=l(B,I);const R=_.load(this._materialKey);R.sdf=n.sdf,R.pattern=!0,R.textureBinding=n.textureBinding,this._materialKey=R.data,this._anchorX=.5-(.5+O)*n.width/n.width,this._anchorY=.5-(.5+W)*n.height/n.height,L*=p,M*=p,L*=this._scaleFactor,M*=this._scaleFactor,L*=n.rect.width/n.width,M*=n.rect.height/n.height,this._computedWidth=L,this._computedHeight=M,this._applyTransformation(k,g),this.xOffset=x,this.yOffset=j}}export{L as default};\n"]},"metadata":{},"sourceType":"module"}