{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../chunks/tslib.es6.js\";\nimport r from \"../../core/Error.js\";\nimport { isSome as t } from \"../../core/maybe.js\";\nimport { eachAlways as o } from \"../../core/promiseUtils.js\";\nimport { property as s } from \"../../core/accessorSupport/decorators/property.js\";\nimport \"../../core/arrayUtils.js\";\nimport \"../../core/has.js\";\nimport \"../../core/accessorSupport/ensureType.js\";\nimport { subclass as a } from \"../../core/accessorSupport/decorators/subclass.js\";\nimport { combinedViewLayerTimeExtentProperty as i } from \"../../layers/support/commonProperties.js\";\nimport { ExportImageParameters as p } from \"../../layers/support/ExportImageParameters.js\";\nimport { calculateTolerance as l } from \"../../renderers/support/clickToleranceUtils.js\";\nimport { loadArcade as m } from \"../../support/arcadeOnDemand.js\";\nimport { getRequiredFields as n, getFetchPopupTemplate as c } from \"./support/popupUtils.js\";\nimport { getLayerFloorFilterClause as u } from \"../support/floorFilterUtils.js\";\n\nconst y = y => {\n  let d = class extends y {\n    initialize() {\n      this.exportImageParameters = new p({\n        layer: this.layer\n      });\n    }\n\n    destroy() {\n      this.exportImageParameters.destroy(), this.exportImageParameters = null;\n    }\n\n    get exportImageVersion() {\n      var e;\n      return null == (e = this.exportImageParameters) || e.commitProperty(\"version\"), this.commitProperty(\"timeExtent\"), (this._get(\"exportImageVersion\") || 0) + 1;\n    }\n\n    async fetchPopupFeatures(e, s) {\n      const {\n        layer: a\n      } = this;\n      if (!e) return Promise.reject(new r(\"mapimagelayerview:fetchPopupFeatures\", \"Nothing to fetch without area\", {\n        layer: a\n      }));\n\n      const i = this.get(\"view.scale\"),\n            p = [],\n            m = async e => {\n        const r = 0 === e.minScale || i <= e.minScale,\n              o = 0 === e.maxScale || i >= e.maxScale;\n        if (e.visible && r && o) if (e.sublayers) e.sublayers.forEach(m);else if (e.popupEnabled) {\n          const r = c(e, { ...s,\n            defaultPopupTemplateEnabled: !1\n          });\n          t(r) && p.unshift({\n            sublayer: e,\n            popupTemplate: r\n          });\n        }\n      },\n            y = a.sublayers.toArray().reverse().map(m);\n\n      await Promise.all(y);\n      const d = p.map(async _ref => {\n        let {\n          sublayer: r,\n          popupTemplate: o\n        } = _ref;\n        await r.load().catch(() => {});\n        const a = r.createQuery(),\n              i = t(s) ? s.event : null,\n              p = l({\n          renderer: r.renderer,\n          event: i\n        }),\n              m = this.createFetchPopupFeaturesQueryGeometry(e, p);\n\n        if (a.geometry = m, a.outFields = await n(r, o), \"map-image\" === this.layer.type && \"floors\" in this.view) {\n          var c, y;\n          const e = null == (c = this.view) || null == (y = c.floors) ? void 0 : y.clone(),\n                o = u(e, r);\n          t(o) && (a.where = a.where ? `(${a.where}) AND (${o})` : o);\n        }\n\n        const d = await this._loadArcadeModules(o);\n        d && d.arcadeUtils.hasGeometryOperations(o) || (a.maxAllowableOffset = m.width / p);\n        return (await r.queryFeatures(a)).features;\n      });\n      return (await o(d)).reduce((e, r) => r.value ? [...e, ...r.value] : e, []).filter(e => null != e);\n    }\n\n    canResume() {\n      var e;\n      return !!super.canResume() && (null == (e = this.timeExtent) || !e.isEmpty);\n    }\n\n    _loadArcadeModules(e) {\n      if (e.get(\"expressionInfos.length\") || Array.isArray(e.content) && e.content.some(e => \"expression\" === e.type)) return m();\n    }\n\n  };\n  return e([s()], d.prototype, \"exportImageParameters\", void 0), e([s({\n    readOnly: !0\n  })], d.prototype, \"exportImageVersion\", null), e([s()], d.prototype, \"layer\", void 0), e([s()], d.prototype, \"suspended\", void 0), e([s(i)], d.prototype, \"timeExtent\", void 0), d = e([a(\"esri.views.layers.MapImageLayerView\")], d), d;\n};\n\nexport { y as MapImageLayerView, y as default };","map":{"version":3,"sources":["D:/Github/CUSP_DataBase/CUSP_DB/src/main/gis/node_modules/@arcgis/core/views/layers/MapImageLayerView.js"],"names":["_","e","r","isSome","t","eachAlways","o","property","s","subclass","a","combinedViewLayerTimeExtentProperty","i","ExportImageParameters","p","calculateTolerance","l","loadArcade","m","getRequiredFields","n","getFetchPopupTemplate","c","getLayerFloorFilterClause","u","y","d","initialize","exportImageParameters","layer","destroy","exportImageVersion","commitProperty","_get","fetchPopupFeatures","Promise","reject","get","minScale","maxScale","visible","sublayers","forEach","popupEnabled","defaultPopupTemplateEnabled","unshift","sublayer","popupTemplate","toArray","reverse","map","all","load","catch","createQuery","event","renderer","createFetchPopupFeaturesQueryGeometry","geometry","outFields","type","view","floors","clone","where","_loadArcadeModules","arcadeUtils","hasGeometryOperations","maxAllowableOffset","width","queryFeatures","features","reduce","value","filter","canResume","timeExtent","isEmpty","Array","isArray","content","some","prototype","readOnly","MapImageLayerView","default"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import r from\"../../core/Error.js\";import{isSome as t}from\"../../core/maybe.js\";import{eachAlways as o}from\"../../core/promiseUtils.js\";import{property as s}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/arrayUtils.js\";import\"../../core/has.js\";import\"../../core/accessorSupport/ensureType.js\";import{subclass as a}from\"../../core/accessorSupport/decorators/subclass.js\";import{combinedViewLayerTimeExtentProperty as i}from\"../../layers/support/commonProperties.js\";import{ExportImageParameters as p}from\"../../layers/support/ExportImageParameters.js\";import{calculateTolerance as l}from\"../../renderers/support/clickToleranceUtils.js\";import{loadArcade as m}from\"../../support/arcadeOnDemand.js\";import{getRequiredFields as n,getFetchPopupTemplate as c}from\"./support/popupUtils.js\";import{getLayerFloorFilterClause as u}from\"../support/floorFilterUtils.js\";const y=y=>{let d=class extends y{initialize(){this.exportImageParameters=new p({layer:this.layer})}destroy(){this.exportImageParameters.destroy(),this.exportImageParameters=null}get exportImageVersion(){var e;return null==(e=this.exportImageParameters)||e.commitProperty(\"version\"),this.commitProperty(\"timeExtent\"),(this._get(\"exportImageVersion\")||0)+1}async fetchPopupFeatures(e,s){const{layer:a}=this;if(!e)return Promise.reject(new r(\"mapimagelayerview:fetchPopupFeatures\",\"Nothing to fetch without area\",{layer:a}));const i=this.get(\"view.scale\"),p=[],m=async e=>{const r=0===e.minScale||i<=e.minScale,o=0===e.maxScale||i>=e.maxScale;if(e.visible&&r&&o)if(e.sublayers)e.sublayers.forEach(m);else if(e.popupEnabled){const r=c(e,{...s,defaultPopupTemplateEnabled:!1});t(r)&&p.unshift({sublayer:e,popupTemplate:r})}},y=a.sublayers.toArray().reverse().map(m);await Promise.all(y);const d=p.map((async({sublayer:r,popupTemplate:o})=>{await r.load().catch((()=>{}));const a=r.createQuery(),i=t(s)?s.event:null,p=l({renderer:r.renderer,event:i}),m=this.createFetchPopupFeaturesQueryGeometry(e,p);if(a.geometry=m,a.outFields=await n(r,o),\"map-image\"===this.layer.type&&\"floors\"in this.view){var c,y;const e=null==(c=this.view)||null==(y=c.floors)?void 0:y.clone(),o=u(e,r);t(o)&&(a.where=a.where?`(${a.where}) AND (${o})`:o)}const d=await this._loadArcadeModules(o);d&&d.arcadeUtils.hasGeometryOperations(o)||(a.maxAllowableOffset=m.width/p);return(await r.queryFeatures(a)).features}));return(await o(d)).reduce(((e,r)=>r.value?[...e,...r.value]:e),[]).filter((e=>null!=e))}canResume(){var e;return!!super.canResume()&&(null==(e=this.timeExtent)||!e.isEmpty)}_loadArcadeModules(e){if(e.get(\"expressionInfos.length\")||Array.isArray(e.content)&&e.content.some((e=>\"expression\"===e.type)))return m()}};return e([s()],d.prototype,\"exportImageParameters\",void 0),e([s({readOnly:!0})],d.prototype,\"exportImageVersion\",null),e([s()],d.prototype,\"layer\",void 0),e([s()],d.prototype,\"suspended\",void 0),e([s(i)],d.prototype,\"timeExtent\",void 0),d=e([a(\"esri.views.layers.MapImageLayerView\")],d),d};export{y as MapImageLayerView,y as default};\n"]},"metadata":{},"sourceType":"module"}