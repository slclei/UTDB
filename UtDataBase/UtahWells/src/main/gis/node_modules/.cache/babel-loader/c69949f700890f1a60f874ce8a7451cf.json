{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport e from \"../../../../core/Error.js\";\nimport { clone as t } from \"../../../../core/lang.js\";\nimport n from \"../../../../core/Logger.js\";\nimport { decodeRGB as r, decodeIntensity as o } from \"./LEPCC.js\";\nimport { VertexAttribute as i } from \"../../webgl-engine/lib/VertexAttribute.js\";\nconst u = n.getLogger(\"esri.views.3d.layers.i3s.I3SBinaryReader\");\n\nfunction a(t, n, r) {\n  let o = \"\",\n      i = 0;\n\n  for (; i < r;) {\n    const u = t[n + i];\n    if (u < 128) o += String.fromCharCode(u), i++;else if (u >= 192 && u < 224) {\n      if (i + 1 >= r) throw new e(\"utf8-decode-error\", \"UTF-8 Decode failed. Two byte character was truncated.\");\n      const a = (31 & u) << 6 | 63 & t[n + i + 1];\n      o += String.fromCharCode(a), i += 2;\n    } else if (u >= 224 && u < 240) {\n      if (i + 2 >= r) throw new e(\"utf8-decode-error\", \"UTF-8 Decode failed. Multi byte character was truncated.\");\n      const a = (15 & u) << 12 | (63 & t[n + i + 1]) << 6 | 63 & t[n + i + 2];\n      o += String.fromCharCode(a), i += 3;\n    } else {\n      if (!(u >= 240 && u < 248)) throw new e(\"utf8-decode-error\", \"UTF-8 Decode failed. Invalid multi byte sequence.\");\n      {\n        if (i + 3 >= r) throw new e(\"utf8-decode-error\", \"UTF-8 Decode failed. Multi byte character was truncated.\");\n        const a = (7 & u) << 18 | (63 & t[n + i + 1]) << 12 | (63 & t[n + i + 2]) << 6 | 63 & t[n + i + 3];\n\n        if (a >= 65536) {\n          const e = 55296 + (a - 65536 >> 10),\n                t = 56320 + (1023 & a);\n          o += String.fromCharCode(e, t);\n        } else o += String.fromCharCode(a);\n\n        i += 4;\n      }\n    }\n  }\n\n  return o;\n}\n\nfunction s(e, t) {\n  const n = {\n    byteOffset: 0,\n    byteCount: 0,\n    fields: Object.create(null)\n  };\n  let r = 0;\n\n  for (let o = 0; o < t.length; o++) {\n    const i = t[o],\n          u = i.valueType || i.type,\n          a = h[u];\n    n.fields[i.property] = a(e, r), r += m[u].BYTES_PER_ELEMENT;\n  }\n\n  return n.byteCount = r, n;\n}\n\nfunction c(t, n, r) {\n  const o = [];\n  let i,\n      u,\n      s = 0;\n\n  for (u = 0; u < t; u += 1) {\n    if (i = n[u], i > 0) {\n      if (o.push(a(r, s, i - 1)), 0 !== r[s + i - 1]) throw new e(\"string-array-error\", \"Invalid string array: missing null termination.\");\n    } else o.push(null);\n\n    s += i;\n  }\n\n  return o;\n}\n\nfunction f(e, t) {\n  return new (0, m[t.valueType])(e, t.byteOffset, t.count * t.valuesPerElement);\n}\n\nfunction l(e, t) {\n  return new Uint8Array(e, t.byteOffset, t.byteCount);\n}\n\nfunction b(n, r, o) {\n  const i = null != r.header ? s(n, r.header) : {\n    byteOffset: 0,\n    byteCount: 0,\n    fields: {\n      count: o\n    }\n  },\n        u = {\n    header: i,\n    byteOffset: i.byteCount,\n    byteCount: 0,\n    entries: Object.create(null)\n  };\n  let a = i.byteCount;\n\n  for (let s = 0; s < r.ordering.length; s++) {\n    const n = r.ordering[s],\n          o = t(r[n]);\n\n    if (o.count = i.fields.count, \"String\" === o.valueType) {\n      if (o.byteOffset = a, o.byteCount = i.fields[n + \"ByteCount\"], \"UTF-8\" !== o.encoding) throw new e(\"unsupported-encoding\", \"Unsupported String encoding.\", {\n        encoding: o.encoding\n      });\n    } else {\n      if (!A(o.valueType)) throw new e(\"unsupported-value-type\", \"Unsupported binary valueType\", {\n        valueType: o.valueType\n      });\n      {\n        const e = O(o.valueType);\n        a += a % e != 0 ? e - a % e : 0, o.byteOffset = a, o.byteCount = e * o.valuesPerElement * o.count;\n      }\n    }\n\n    a += o.byteCount, u.entries[n] = o;\n  }\n\n  return u.byteCount = a - u.byteOffset, u;\n}\n\nfunction d(t, n, r) {\n  if (n !== t && u.error(`Invalid ${r} buffer size\\n expected: ${t}, actual: ${n})`), n < t) throw new e(\"buffer-too-small\", \"Binary buffer is too small\", {\n    expectedSize: t,\n    actualSize: n\n  });\n}\n\nfunction y(e) {\n  return {\n    isDraco: !1,\n    isLegacy: !1,\n    color: null != e.color,\n    normal: null != e.normal,\n    uv0: null != e.uv0,\n    uvRegion: null != e.uvRegion,\n    featureIndex: null != e.faceRange && null != e.featureId\n  };\n}\n\nfunction g(e, t) {\n  const n = s(e, t && t.header);\n  let r = n.byteCount;\n  const o = {\n    isDraco: !1,\n    header: n,\n    byteOffset: n.byteCount,\n    byteCount: 0,\n    vertexAttributes: {}\n  },\n        i = n.fields,\n        u = null != i.vertexCount ? i.vertexCount : i.count;\n\n  for (const s of t.ordering) {\n    if (!t.vertexAttributes[s]) continue;\n    const e = { ...t.vertexAttributes[s],\n      byteOffset: r,\n      count: u\n    },\n          n = C[s] ? C[s] : \"_\" + s;\n    o.vertexAttributes[n] = e, r += O(e.valueType) * e.valuesPerElement * u;\n  }\n\n  const a = i.faceCount;\n\n  if (t.faces && a) {\n    o.faces = {};\n\n    for (const e of t.ordering) {\n      if (!t.faces[e]) continue;\n      const n = { ...t.faces[e],\n        byteOffset: r,\n        count: a\n      };\n      o.faces[e] = n, r += O(n.valueType) * n.valuesPerElement * a;\n    }\n  }\n\n  const c = i.featureCount;\n\n  if (t.featureAttributes && t.featureAttributeOrder && c) {\n    o.featureAttributes = {};\n\n    for (const e of t.featureAttributeOrder) {\n      if (!t.featureAttributes[e]) continue;\n      const n = { ...t.featureAttributes[e],\n        byteOffset: r,\n        count: c\n      };\n      o.featureAttributes[e] = n;\n      r += (\"UInt64\" === n.valueType ? 8 : O(n.valueType)) * n.valuesPerElement * c;\n    }\n  }\n\n  return d(r, e.byteLength, \"geometry\"), o.byteCount = r - o.byteOffset, o;\n}\n\nfunction w(e, t) {\n  return !(!e || !e.compressedAttributes || \"draco\" !== e.compressedAttributes.encoding) ? v(e.compressedAttributes.attributes) : e ? y(e) : p(t);\n}\n\nfunction p(e) {\n  const t = {\n    isDraco: !1,\n    isLegacy: !0,\n    color: !1,\n    normal: !1,\n    uv0: !1,\n    uvRegion: !1,\n    featureIndex: !1\n  };\n\n  for (const n of e.ordering) if (e.vertexAttributes[n]) switch (n) {\n    case \"position\":\n      break;\n\n    case \"normal\":\n      t.normal = !0;\n      break;\n\n    case \"color\":\n      t.color = !0;\n      break;\n\n    case \"uv0\":\n      t.uv0 = !0;\n      break;\n\n    case \"region\":\n      t.uvRegion = !0;\n  }\n\n  return e.featureAttributes && e.featureAttributeOrder && (t.featureIndex = !0), t;\n}\n\nfunction v(e) {\n  const t = {\n    isDraco: !0,\n    isLegacy: !1,\n    color: !1,\n    normal: !1,\n    uv0: !1,\n    uvRegion: !1,\n    featureIndex: !1\n  };\n\n  for (const n of e) switch (n) {\n    case \"position\":\n      break;\n\n    case \"normal\":\n      t.normal = !0;\n      break;\n\n    case \"uv0\":\n      t.uv0 = !0;\n      break;\n\n    case \"color\":\n      t.color = !0;\n      break;\n\n    case \"uv-region\":\n      t.uvRegion = !0;\n      break;\n\n    case \"feature-index\":\n      t.featureIndex = !0;\n  }\n\n  return t;\n}\n\nconst C = {\n  position: i.POSITION,\n  normal: i.NORMAL,\n  color: i.COLOR,\n  uv0: i.UV0,\n  region: i.UVREGION\n};\n\nfunction I(t, n, i) {\n  if (\"lepcc-rgb\" === t.encoding) return r(n);\n  if (\"lepcc-intensity\" === t.encoding) return o(n);\n  if (null != t.encoding && \"\" !== t.encoding) throw new e(\"unknown-attribute-storage-info-encoding\", \"Unknown Attribute Storage Info Encoding\");\n  t[\"attributeByteCounts \"] && !t.attributeByteCounts && (u.warn(\"Warning: Trailing space in 'attributeByteCounts '.\"), t.attributeByteCounts = t[\"attributeByteCounts \"]), \"ObjectIds\" === t.ordering[0] && t.hasOwnProperty(\"objectIds\") && (u.warn(\"Warning: Case error in objectIds\"), t.ordering[0] = \"objectIds\");\n  const a = b(n, t, i);\n  d(a.byteOffset + a.byteCount, n.byteLength, \"attribute\");\n  const s = a.entries.attributeValues || a.entries.objectIds;\n\n  if (s) {\n    if (\"String\" === s.valueType) {\n      const e = a.entries.attributeByteCounts,\n            t = f(n, e),\n            r = l(n, s);\n      return c(e.count, t, r);\n    }\n\n    return f(n, s);\n  }\n\n  throw new e(\"bad-attribute-storage-info\", \"Bad attributeStorageInfo specification.\");\n}\n\nconst m = {\n  Float32: Float32Array,\n  Float64: Float64Array,\n  UInt8: Uint8Array,\n  Int8: Int8Array,\n  UInt16: Uint16Array,\n  Int16: Int16Array,\n  UInt32: Uint32Array,\n  Int32: Int32Array\n},\n      h = {\n  Float32: (e, t) => new DataView(e, 0).getFloat32(t, !0),\n  Float64: (e, t) => new DataView(e, 0).getFloat64(t, !0),\n  UInt8: (e, t) => new DataView(e, 0).getUint8(t),\n  Int8: (e, t) => new DataView(e, 0).getInt8(t),\n  UInt16: (e, t) => new DataView(e, 0).getUint16(t, !0),\n  Int16: (e, t) => new DataView(e, 0).getInt16(t, !0),\n  UInt32: (e, t) => new DataView(e, 0).getUint32(t, !0),\n  Int32: (e, t) => new DataView(e, 0).getInt32(t, !0)\n};\n\nfunction A(e) {\n  return m.hasOwnProperty(e);\n}\n\nfunction O(e) {\n  return A(e) ? m[e].BYTES_PER_ELEMENT : 0;\n}\n\nexport { b as createAttributeDataIndex, w as createGeometryDescriptor, v as createGeometryDescriptorForDraco, y as createGeometryDescriptorFromDefinition, p as createGeometryDescriptorFromSchema, g as createGeometryIndexFromSchema, l as createRawView, f as createTypedView, O as getBytesPerValue, A as isValueType, I as readBinaryAttribute, s as readHeader, c as readStringArray, h as valueType2ArrayBufferReader, m as valueType2TypedArrayClassMap };","map":{"version":3,"sources":["D:/Github/CUSP_DataBase/CUSP_DB/src/main/gis/node_modules/@arcgis/core/views/3d/layers/i3s/I3SBinaryReader.js"],"names":["e","clone","t","n","decodeRGB","r","decodeIntensity","o","VertexAttribute","i","u","getLogger","a","String","fromCharCode","s","byteOffset","byteCount","fields","Object","create","length","valueType","type","h","property","m","BYTES_PER_ELEMENT","c","push","f","count","valuesPerElement","l","Uint8Array","b","header","entries","ordering","encoding","A","O","d","error","expectedSize","actualSize","y","isDraco","isLegacy","color","normal","uv0","uvRegion","featureIndex","faceRange","featureId","g","vertexAttributes","vertexCount","C","faceCount","faces","featureCount","featureAttributes","featureAttributeOrder","byteLength","w","compressedAttributes","v","attributes","p","position","POSITION","NORMAL","COLOR","UV0","region","UVREGION","I","attributeByteCounts","warn","hasOwnProperty","attributeValues","objectIds","Float32","Float32Array","Float64","Float64Array","UInt8","Int8","Int8Array","UInt16","Uint16Array","Int16","Int16Array","UInt32","Uint32Array","Int32","Int32Array","DataView","getFloat32","getFloat64","getUint8","getInt8","getUint16","getInt16","getUint32","getInt32","createAttributeDataIndex","createGeometryDescriptor","createGeometryDescriptorForDraco","createGeometryDescriptorFromDefinition","createGeometryDescriptorFromSchema","createGeometryIndexFromSchema","createRawView","createTypedView","getBytesPerValue","isValueType","readBinaryAttribute","readHeader","readStringArray","valueType2ArrayBufferReader","valueType2TypedArrayClassMap"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport e from\"../../../../core/Error.js\";import{clone as t}from\"../../../../core/lang.js\";import n from\"../../../../core/Logger.js\";import{decodeRGB as r,decodeIntensity as o}from\"./LEPCC.js\";import{VertexAttribute as i}from\"../../webgl-engine/lib/VertexAttribute.js\";const u=n.getLogger(\"esri.views.3d.layers.i3s.I3SBinaryReader\");function a(t,n,r){let o=\"\",i=0;for(;i<r;){const u=t[n+i];if(u<128)o+=String.fromCharCode(u),i++;else if(u>=192&&u<224){if(i+1>=r)throw new e(\"utf8-decode-error\",\"UTF-8 Decode failed. Two byte character was truncated.\");const a=(31&u)<<6|63&t[n+i+1];o+=String.fromCharCode(a),i+=2}else if(u>=224&&u<240){if(i+2>=r)throw new e(\"utf8-decode-error\",\"UTF-8 Decode failed. Multi byte character was truncated.\");const a=(15&u)<<12|(63&t[n+i+1])<<6|63&t[n+i+2];o+=String.fromCharCode(a),i+=3}else{if(!(u>=240&&u<248))throw new e(\"utf8-decode-error\",\"UTF-8 Decode failed. Invalid multi byte sequence.\");{if(i+3>=r)throw new e(\"utf8-decode-error\",\"UTF-8 Decode failed. Multi byte character was truncated.\");const a=(7&u)<<18|(63&t[n+i+1])<<12|(63&t[n+i+2])<<6|63&t[n+i+3];if(a>=65536){const e=55296+(a-65536>>10),t=56320+(1023&a);o+=String.fromCharCode(e,t)}else o+=String.fromCharCode(a);i+=4}}}return o}function s(e,t){const n={byteOffset:0,byteCount:0,fields:Object.create(null)};let r=0;for(let o=0;o<t.length;o++){const i=t[o],u=i.valueType||i.type,a=h[u];n.fields[i.property]=a(e,r),r+=m[u].BYTES_PER_ELEMENT}return n.byteCount=r,n}function c(t,n,r){const o=[];let i,u,s=0;for(u=0;u<t;u+=1){if(i=n[u],i>0){if(o.push(a(r,s,i-1)),0!==r[s+i-1])throw new e(\"string-array-error\",\"Invalid string array: missing null termination.\")}else o.push(null);s+=i}return o}function f(e,t){return new(0,m[t.valueType])(e,t.byteOffset,t.count*t.valuesPerElement)}function l(e,t){return new Uint8Array(e,t.byteOffset,t.byteCount)}function b(n,r,o){const i=null!=r.header?s(n,r.header):{byteOffset:0,byteCount:0,fields:{count:o}},u={header:i,byteOffset:i.byteCount,byteCount:0,entries:Object.create(null)};let a=i.byteCount;for(let s=0;s<r.ordering.length;s++){const n=r.ordering[s],o=t(r[n]);if(o.count=i.fields.count,\"String\"===o.valueType){if(o.byteOffset=a,o.byteCount=i.fields[n+\"ByteCount\"],\"UTF-8\"!==o.encoding)throw new e(\"unsupported-encoding\",\"Unsupported String encoding.\",{encoding:o.encoding})}else{if(!A(o.valueType))throw new e(\"unsupported-value-type\",\"Unsupported binary valueType\",{valueType:o.valueType});{const e=O(o.valueType);a+=a%e!=0?e-a%e:0,o.byteOffset=a,o.byteCount=e*o.valuesPerElement*o.count}}a+=o.byteCount,u.entries[n]=o}return u.byteCount=a-u.byteOffset,u}function d(t,n,r){if(n!==t&&u.error(`Invalid ${r} buffer size\\n expected: ${t}, actual: ${n})`),n<t)throw new e(\"buffer-too-small\",\"Binary buffer is too small\",{expectedSize:t,actualSize:n})}function y(e){return{isDraco:!1,isLegacy:!1,color:null!=e.color,normal:null!=e.normal,uv0:null!=e.uv0,uvRegion:null!=e.uvRegion,featureIndex:null!=e.faceRange&&null!=e.featureId}}function g(e,t){const n=s(e,t&&t.header);let r=n.byteCount;const o={isDraco:!1,header:n,byteOffset:n.byteCount,byteCount:0,vertexAttributes:{}},i=n.fields,u=null!=i.vertexCount?i.vertexCount:i.count;for(const s of t.ordering){if(!t.vertexAttributes[s])continue;const e={...t.vertexAttributes[s],byteOffset:r,count:u},n=C[s]?C[s]:\"_\"+s;o.vertexAttributes[n]=e,r+=O(e.valueType)*e.valuesPerElement*u}const a=i.faceCount;if(t.faces&&a){o.faces={};for(const e of t.ordering){if(!t.faces[e])continue;const n={...t.faces[e],byteOffset:r,count:a};o.faces[e]=n,r+=O(n.valueType)*n.valuesPerElement*a}}const c=i.featureCount;if(t.featureAttributes&&t.featureAttributeOrder&&c){o.featureAttributes={};for(const e of t.featureAttributeOrder){if(!t.featureAttributes[e])continue;const n={...t.featureAttributes[e],byteOffset:r,count:c};o.featureAttributes[e]=n;r+=(\"UInt64\"===n.valueType?8:O(n.valueType))*n.valuesPerElement*c}}return d(r,e.byteLength,\"geometry\"),o.byteCount=r-o.byteOffset,o}function w(e,t){return!(!e||!e.compressedAttributes||\"draco\"!==e.compressedAttributes.encoding)?v(e.compressedAttributes.attributes):e?y(e):p(t)}function p(e){const t={isDraco:!1,isLegacy:!0,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const n of e.ordering)if(e.vertexAttributes[n])switch(n){case\"position\":break;case\"normal\":t.normal=!0;break;case\"color\":t.color=!0;break;case\"uv0\":t.uv0=!0;break;case\"region\":t.uvRegion=!0}return e.featureAttributes&&e.featureAttributeOrder&&(t.featureIndex=!0),t}function v(e){const t={isDraco:!0,isLegacy:!1,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const n of e)switch(n){case\"position\":break;case\"normal\":t.normal=!0;break;case\"uv0\":t.uv0=!0;break;case\"color\":t.color=!0;break;case\"uv-region\":t.uvRegion=!0;break;case\"feature-index\":t.featureIndex=!0}return t}const C={position:i.POSITION,normal:i.NORMAL,color:i.COLOR,uv0:i.UV0,region:i.UVREGION};function I(t,n,i){if(\"lepcc-rgb\"===t.encoding)return r(n);if(\"lepcc-intensity\"===t.encoding)return o(n);if(null!=t.encoding&&\"\"!==t.encoding)throw new e(\"unknown-attribute-storage-info-encoding\",\"Unknown Attribute Storage Info Encoding\");t[\"attributeByteCounts \"]&&!t.attributeByteCounts&&(u.warn(\"Warning: Trailing space in 'attributeByteCounts '.\"),t.attributeByteCounts=t[\"attributeByteCounts \"]),\"ObjectIds\"===t.ordering[0]&&t.hasOwnProperty(\"objectIds\")&&(u.warn(\"Warning: Case error in objectIds\"),t.ordering[0]=\"objectIds\");const a=b(n,t,i);d(a.byteOffset+a.byteCount,n.byteLength,\"attribute\");const s=a.entries.attributeValues||a.entries.objectIds;if(s){if(\"String\"===s.valueType){const e=a.entries.attributeByteCounts,t=f(n,e),r=l(n,s);return c(e.count,t,r)}return f(n,s)}throw new e(\"bad-attribute-storage-info\",\"Bad attributeStorageInfo specification.\")}const m={Float32:Float32Array,Float64:Float64Array,UInt8:Uint8Array,Int8:Int8Array,UInt16:Uint16Array,Int16:Int16Array,UInt32:Uint32Array,Int32:Int32Array},h={Float32:(e,t)=>new DataView(e,0).getFloat32(t,!0),Float64:(e,t)=>new DataView(e,0).getFloat64(t,!0),UInt8:(e,t)=>new DataView(e,0).getUint8(t),Int8:(e,t)=>new DataView(e,0).getInt8(t),UInt16:(e,t)=>new DataView(e,0).getUint16(t,!0),Int16:(e,t)=>new DataView(e,0).getInt16(t,!0),UInt32:(e,t)=>new DataView(e,0).getUint32(t,!0),Int32:(e,t)=>new DataView(e,0).getInt32(t,!0)};function A(e){return m.hasOwnProperty(e)}function O(e){return A(e)?m[e].BYTES_PER_ELEMENT:0}export{b as createAttributeDataIndex,w as createGeometryDescriptor,v as createGeometryDescriptorForDraco,y as createGeometryDescriptorFromDefinition,p as createGeometryDescriptorFromSchema,g as createGeometryIndexFromSchema,l as createRawView,f as createTypedView,O as getBytesPerValue,A as isValueType,I as readBinaryAttribute,s as readHeader,c as readStringArray,h as valueType2ArrayBufferReader,m as valueType2TypedArrayClassMap};\n"]},"metadata":{},"sourceType":"module"}