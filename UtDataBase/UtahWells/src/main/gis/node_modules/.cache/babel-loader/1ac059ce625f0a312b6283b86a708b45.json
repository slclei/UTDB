{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport { isSome as e, isNone as s } from \"../../core/maybe.js\";\nimport { onAbort as t, onAbortOrThrow as r, createDeferred as i, isPromiseLike as h, createAbortError as o } from \"../../core/promiseUtils.js\";\nimport c from \"../../core/Queue.js\";\nimport { schedule as n } from \"../../core/scheduling.js\";\n\nclass u {\n  constructor(e, s) {\n    this.item = e, this.controller = s, this.promise = null;\n  }\n\n}\n\nclass l {\n  constructor(s) {\n    this._deferreds = new Map(), this._controllers = new Map(), this._processingItems = new Map(), this._isPaused = !1, this._schedule = null, this._task = null, this.concurrency = 1, s.concurrency && (this.concurrency = s.concurrency), this._queue = new c(s.peeker), this.process = s.process;\n    const t = s.scheduler;\n    s.priority && e(t) && (this._task = t.registerTask(s.priority, this));\n  }\n\n  destroy() {\n    this.clear(), this._schedule && (this._schedule.remove(), this._schedule = null), this._task && (this._task.remove(), this._task = null);\n  }\n\n  get length() {\n    return this._processingItems.size + this._queue.length;\n  }\n\n  abort(e) {\n    const s = this._controllers.get(e);\n\n    s && s.abort();\n  }\n\n  clear() {\n    this._queue.clear();\n\n    const e = [];\n    this._controllers.forEach(s => e.push(s)), this._controllers.clear(), e.forEach(e => e.abort()), this._processingItems.clear(), this._cancelNext();\n  }\n\n  forEach(e) {\n    this._deferreds.forEach((s, t) => e(t));\n  }\n\n  get(e) {\n    const s = this._deferreds.get(e);\n\n    return s ? s.promise : void 0;\n  }\n\n  isOngoing(e) {\n    return this._processingItems.has(e);\n  }\n\n  has(e) {\n    return this._deferreds.has(e);\n  }\n\n  pause() {\n    this._isPaused || (this._isPaused = !0, this._cancelNext());\n  }\n\n  push(s, h) {\n    const c = this.get(s);\n    if (c) return c;\n    const n = new AbortController();\n    let u = null;\n    h && (u = t(h, () => n.abort()));\n\n    const l = () => {\n      const e = this._processingItems.get(s);\n\n      e && e.controller.abort(), _(), a.reject(o());\n    },\n          _ = () => {\n      p.remove(), e(u) && u.remove(), this._deferreds.delete(s), this._controllers.delete(s), this._queue.remove(s), this._processingItems.delete(s), this._scheduleNext();\n    },\n          p = r(n.signal, l),\n          a = i();\n\n    return this._deferreds.set(s, a), this._controllers.set(s, n), a.promise.then(_, _), this._queue.push(s), this._scheduleNext(), a.promise;\n  }\n\n  last() {\n    return this._queue.last();\n  }\n\n  peek() {\n    return this._queue.peek();\n  }\n\n  popLast() {\n    return this._queue.popLast();\n  }\n\n  reset() {\n    const e = [];\n    this._processingItems.forEach(s => e.push(s)), this._processingItems.clear();\n\n    for (const s of e) this._queue.push(s.item), s.controller.abort();\n\n    this._scheduleNext();\n  }\n\n  resume() {\n    this._isPaused && (this._isPaused = !1, this._scheduleNext());\n  }\n\n  takeAll() {\n    const e = [];\n\n    for (; this._queue.length;) e.push(this._queue.pop());\n\n    return this.clear(), e;\n  }\n\n  get running() {\n    return !this._isPaused && this._queue.length > 0 && this._processingItems.size < this.concurrency;\n  }\n\n  runTask(e) {\n    for (; !e.done && this._queue.length > 0 && this._processingItems.size < this.concurrency;) this._process(this._queue.pop()), e.madeProgress();\n  }\n\n  _scheduleNext() {\n    this._task || this._isPaused || this._schedule || (this._schedule = n(() => {\n      this._schedule = null, this._next();\n    }));\n  }\n\n  _next() {\n    for (; this._queue.length > 0 && this._processingItems.size < this.concurrency;) this._process(this._queue.pop());\n  }\n\n  _cancelNext() {\n    this._schedule && (this._schedule.remove(), this._schedule = null);\n  }\n\n  _processResult(e, s) {\n    this._canProcessFulfillment(e) && (this._scheduleNext(), this._deferreds.get(e.item).resolve(s));\n  }\n\n  _processError(e, s) {\n    this._canProcessFulfillment(e) && (this._scheduleNext(), this._deferreds.get(e.item).reject(s));\n  }\n\n  _canProcessFulfillment(e) {\n    return !!this._deferreds.get(e.item) && this._processingItems.get(e.item) === e;\n  }\n\n  _process(e) {\n    if (s(e)) return;\n    let t;\n    const r = new AbortController(),\n          i = new u(e, r);\n\n    this._processingItems.set(e, i);\n\n    try {\n      t = this.process(e, r.signal);\n    } catch (o) {\n      this._processError(i, o);\n    }\n\n    h(t) ? (i.promise = t, t.then(e => this._processResult(i, e), e => this._processError(i, e))) : this._processResult(i, t);\n  }\n\n  get test() {\n    return {\n      update: e => this.runTask(e)\n    };\n  }\n\n}\n\nexport { l as QueueProcessor };","map":{"version":3,"sources":["D:/Github/CUSP_DataBase/CUSP_DB/src/main/gis/node_modules/@arcgis/core/views/support/QueueProcessor.js"],"names":["isSome","e","isNone","s","onAbort","t","onAbortOrThrow","r","createDeferred","i","isPromiseLike","h","createAbortError","o","c","schedule","n","u","constructor","item","controller","promise","l","_deferreds","Map","_controllers","_processingItems","_isPaused","_schedule","_task","concurrency","_queue","peeker","process","scheduler","priority","registerTask","destroy","clear","remove","length","size","abort","get","forEach","push","_cancelNext","isOngoing","has","pause","AbortController","_","a","reject","p","delete","_scheduleNext","signal","set","then","last","peek","popLast","reset","resume","takeAll","pop","running","runTask","done","_process","madeProgress","_next","_processResult","_canProcessFulfillment","resolve","_processError","test","update","QueueProcessor"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport{isSome as e,isNone as s}from\"../../core/maybe.js\";import{onAbort as t,onAbortOrThrow as r,createDeferred as i,isPromiseLike as h,createAbortError as o}from\"../../core/promiseUtils.js\";import c from\"../../core/Queue.js\";import{schedule as n}from\"../../core/scheduling.js\";class u{constructor(e,s){this.item=e,this.controller=s,this.promise=null}}class l{constructor(s){this._deferreds=new Map,this._controllers=new Map,this._processingItems=new Map,this._isPaused=!1,this._schedule=null,this._task=null,this.concurrency=1,s.concurrency&&(this.concurrency=s.concurrency),this._queue=new c(s.peeker),this.process=s.process;const t=s.scheduler;s.priority&&e(t)&&(this._task=t.registerTask(s.priority,this))}destroy(){this.clear(),this._schedule&&(this._schedule.remove(),this._schedule=null),this._task&&(this._task.remove(),this._task=null)}get length(){return this._processingItems.size+this._queue.length}abort(e){const s=this._controllers.get(e);s&&s.abort()}clear(){this._queue.clear();const e=[];this._controllers.forEach((s=>e.push(s))),this._controllers.clear(),e.forEach((e=>e.abort())),this._processingItems.clear(),this._cancelNext()}forEach(e){this._deferreds.forEach(((s,t)=>e(t)))}get(e){const s=this._deferreds.get(e);return s?s.promise:void 0}isOngoing(e){return this._processingItems.has(e)}has(e){return this._deferreds.has(e)}pause(){this._isPaused||(this._isPaused=!0,this._cancelNext())}push(s,h){const c=this.get(s);if(c)return c;const n=new AbortController;let u=null;h&&(u=t(h,(()=>n.abort())));const l=()=>{const e=this._processingItems.get(s);e&&e.controller.abort(),_(),a.reject(o())},_=()=>{p.remove(),e(u)&&u.remove(),this._deferreds.delete(s),this._controllers.delete(s),this._queue.remove(s),this._processingItems.delete(s),this._scheduleNext()},p=r(n.signal,l),a=i();return this._deferreds.set(s,a),this._controllers.set(s,n),a.promise.then(_,_),this._queue.push(s),this._scheduleNext(),a.promise}last(){return this._queue.last()}peek(){return this._queue.peek()}popLast(){return this._queue.popLast()}reset(){const e=[];this._processingItems.forEach((s=>e.push(s))),this._processingItems.clear();for(const s of e)this._queue.push(s.item),s.controller.abort();this._scheduleNext()}resume(){this._isPaused&&(this._isPaused=!1,this._scheduleNext())}takeAll(){const e=[];for(;this._queue.length;)e.push(this._queue.pop());return this.clear(),e}get running(){return!this._isPaused&&this._queue.length>0&&this._processingItems.size<this.concurrency}runTask(e){for(;!e.done&&this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop()),e.madeProgress()}_scheduleNext(){this._task||this._isPaused||this._schedule||(this._schedule=n((()=>{this._schedule=null,this._next()})))}_next(){for(;this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop())}_cancelNext(){this._schedule&&(this._schedule.remove(),this._schedule=null)}_processResult(e,s){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).resolve(s))}_processError(e,s){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).reject(s))}_canProcessFulfillment(e){return!!this._deferreds.get(e.item)&&this._processingItems.get(e.item)===e}_process(e){if(s(e))return;let t;const r=new AbortController,i=new u(e,r);this._processingItems.set(e,i);try{t=this.process(e,r.signal)}catch(o){this._processError(i,o)}h(t)?(i.promise=t,t.then((e=>this._processResult(i,e)),(e=>this._processError(i,e)))):this._processResult(i,t)}get test(){return{update:e=>this.runTask(e)}}}export{l as QueueProcessor};\n"]},"metadata":{},"sourceType":"module"}