{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../chunks/tslib.es6.js\";\nimport r from \"../core/Collection.js\";\nimport t from \"../core/Error.js\";\nimport o from \"../core/Handles.js\";\nimport i from \"../core/Logger.js\";\nimport { destroyMaybe as s, isSome as n } from \"../core/maybe.js\";\nimport { MultiOriginJSONMixin as a } from \"../core/MultiOriginJSONSupport.js\";\nimport { throwIfAbortError as l } from \"../core/promiseUtils.js\";\nimport { watch as p } from \"../core/reactiveUtils.js\";\nimport { property as m } from \"../core/accessorSupport/decorators/property.js\";\nimport \"../core/arrayUtils.js\";\nimport \"../core/has.js\";\nimport \"../core/accessorSupport/ensureType.js\";\nimport { reader as d } from \"../core/accessorSupport/decorators/reader.js\";\nimport { subclass as c } from \"../core/accessorSupport/decorators/subclass.js\";\nimport { n as h } from \"../chunks/vec3.js\";\nimport { f as u } from \"../chunks/vec3f64.js\";\nimport y from \"./Layer.js\";\nimport v from \"./VoxelWasmManager.js\";\nimport { APIKeyMixin as b } from \"./mixins/APIKeyMixin.js\";\nimport { ArcGISService as f } from \"./mixins/ArcGISService.js\";\nimport { OperationalLayer as g } from \"./mixins/OperationalLayer.js\";\nimport { PortalLayer as V } from \"./mixins/PortalLayer.js\";\nimport { ScaleRangeLayer as S } from \"./mixins/ScaleRangeLayer.js\";\nimport { SceneService as _ } from \"./mixins/SceneService.js\";\nimport { sanitizeUrl as x } from \"./support/arcgisLayerUrl.js\";\nimport { popupEnabled as j, legendEnabled as I, url as w } from \"./support/commonProperties.js\";\nimport T from \"./support/VoxelDynamicSection.js\";\nimport L from \"./support/VoxelSection.js\";\nimport N from \"./support/VoxelSlice.js\";\nimport P from \"./support/VoxelStyle.js\";\nimport W from \"./support/VoxelVariable.js\";\nimport A from \"./support/VoxelVolume.js\";\nimport E from \"./support/VoxelVolumeIndex.js\";\nconst M = i.getLogger(\" esri.layers.VoxelLayer\");\nvar D;\n!function (e) {\n  e[e.API = 1] = \"API\", e[e.VerboseAPI = 2] = \"VerboseAPI\", e[e.Error = 3] = \"Error\";\n}(D || (D = {}));\nlet R = class extends _(f(g(V(S(a(b(y))))))) {\n  constructor(e) {\n    super(e), this.serviceRoot = \"\", this.popupEnabled = !0, this.operationalLayerType = \"Voxel\", this.legendEnabled = !0, this.title = null, this.sections = new r(), this.style = null, this.opacity = 1, this.variables = new r(), this.volumes = new r(), this.index = null, this.minScale = 0, this.maxScale = 0, this.type = \"voxel\", this._dbgFlags = new Set(), this._handles = new o(), this.version = {\n      major: Number.NaN,\n      minor: Number.NaN,\n      versionString: \"\"\n    };\n  }\n\n  set url(e) {\n    this._set(\"url\", x(e, M));\n  }\n\n  destroy() {\n    this._handles = s(this._handles);\n  }\n\n  _dbg(e, r) {\n    this._dbgFlags.has(e) && (e === D.Error ? M.error(r) : M.warn(r));\n  }\n\n  load(e) {\n    const r = n(e) ? e.signal : null,\n          t = this.loadFromPortal({\n      supportedTypes: [\"Scene Service\"]\n    }, e).catch(l).then(() => this._fetchService(r)).then(() => this.serviceRoot = this.url);\n    return this.addResolvingPromise(t), Promise.resolve(this);\n  }\n\n  getConfiguration() {\n    this._handles.add([p(() => this._getRenderMode(), e => this._pushRenderModeToWasm(e)), p(() => this._getCurrentVariableId(), e => this._pushCurrentVariableIdToWasm(e)), p(() => this._getDynamicSections(), e => this._pushDynamicSectionsToWasm(e)), p(() => this._getSlices(), e => this._pushSlicesToWasm(e)), p(() => this._getSections(), e => this._pushSectionsToWasm(e))]);\n\n    const e = {\n      layerType: this.operationalLayerType,\n      version: this.version.versionString,\n      name: this.title,\n      spatialReference: this.spatialReference,\n      fullExtent: this.fullExtent,\n      volumes: this.volumes.toJSON(),\n      variables: this.variables.toJSON(),\n      index: this.index.toJSON(),\n      sections: this.sections.toJSON(),\n      style: this.style\n    };\n    return e.index && this.index.isValid() ? JSON.stringify(e) : \"\";\n  }\n\n  readVersion(e, r) {\n    return super.parseVersionString(e);\n  }\n\n  _getSections() {\n    const e = [];\n\n    for (const r of this.sections) e.push(new L({\n      enabled: r.enabled,\n      href: r.href,\n      id: r.id,\n      label: r.label,\n      normal: r.normal,\n      point: r.point,\n      sizeInPixel: r.sizeInPixel,\n      slices: r.slices,\n      timeId: r.timeId,\n      variableId: r.variableId\n    }));\n\n    return e;\n  }\n\n  _pushSectionsToWasm(e) {\n    this._dbg(D.VerboseAPI, \"VoxelLayer._pushSectionsToWasm() called\");\n\n    v.getInstance().setLayerStaticSections(this, e) || this._dbg(D.Error, \"VoxelLayer._pushSectionsToWasm() failed!\");\n  }\n\n  _isPlaneValid(e, r, t) {\n    if (!e.point) return !1;\n    if (!Array.isArray(e.point) || 3 !== e.point.length) return !1;\n    if (!e.normal) return !1;\n    if (!Array.isArray(e.normal) || 3 !== e.normal.length) return !1;\n\n    for (let s = 0; s < 3; ++s) {\n      const o = e.point[s];\n      if (o < 0 || o >= t[r[s]].size) return !1;\n    }\n\n    const o = u(e.normal[0], e.normal[1], e.normal[2]);\n    h(o, o);\n    const i = 1e-6;\n    return !(Math.abs(o[0]) + Math.abs(o[1]) + Math.abs(o[2]) < i) && (e.normal[0] = o[0], e.normal[1] = o[1], e.normal[2] = o[2], !0);\n  }\n\n  getVariableStyle(e) {\n    let r = -1;\n    r = n(e) ? e : this._getCurrentVariableId();\n    if (!(null == this ? void 0 : this.style.variableStyles) || -1 === r) return null;\n    const t = this.style.variableStyles.findIndex(e => e.variableId === r);\n    return t < 0 ? null : this.style.variableStyles.getItemAt(t);\n  }\n\n  getVariable(e) {\n    let r = -1;\n    if (r = n(e) ? e : this._getCurrentVariableId(), !this.variables || -1 === r) return null;\n    const t = this.variables.findIndex(e => e.id === r);\n    return t < 0 ? null : this.variables.getItemAt(t);\n  }\n\n  getVolume(e) {\n    const r = this.getVariable(e);\n    return n(r) ? this.volumes.find(_ref => {\n      let {\n        id: e\n      } = _ref;\n      return e === r.volumeId;\n    }) : null;\n  }\n\n  validateLayer(e) {\n    if (e.layerType && e.layerType !== this.operationalLayerType) throw new t(\"voxel-layer:layer-type-not-supported\", \"VoxelLayer does not support this layer type\", {\n      layerType: e.layerType\n    });\n    if (isNaN(this.version.major) || isNaN(this.version.minor) || this.version.major < 3) throw new t(\"layer:service-version-not-supported\", \"Service version is not supported.\", {\n      serviceVersion: this.version.versionString,\n      supportedVersions: \"3.x\"\n    });\n    if (this.version.major > 3) throw new t(\"layer:service-version-too-new\", \"Service version is too new.\", {\n      serviceVersion: this.version.versionString,\n      supportedVersions: \"3.x\"\n    });\n  }\n\n  _getVolumeStyle(e) {\n    const r = this.getVariable(e);\n    return n(r) ? this.style.volumeStyles.find(_ref2 => {\n      let {\n        volumeId: e\n      } = _ref2;\n      return e === r.volumeId;\n    }) : null;\n  }\n\n  _getSlices() {\n    const e = [],\n          r = this.getVolume(null);\n    if (!n(r) || !r.isVolumeValid()) return e;\n\n    const t = this._getVolumeStyle(null);\n\n    if (!n(t)) return e;\n\n    for (const o of t.slices) this._isPlaneValid(o, [0, 1, r.getZDimension()], r.dimensions) ? e.push(new N({\n      enabled: o.enabled,\n      label: o.label,\n      point: o.point,\n      normal: o.normal\n    })) : e.push(new N({\n      enabled: !1,\n      label: \"invalid\",\n      point: o.point,\n      normal: o.normal\n    }));\n\n    return e;\n  }\n\n  _pushSlicesToWasm(e) {\n    this._dbg(D.VerboseAPI, \"VoxelLayer._pushSlicesToWasm() called!\");\n\n    v.getInstance().setLayerSlices(this, e) || this._dbg(D.Error, \"VoxelLayer._pushSlicesToWasm() failed!\");\n  }\n\n  _getDynamicSections() {\n    const e = [],\n          r = this.getVolume(null);\n    if (!n(r) || !r.isVolumeValid()) return e;\n\n    const t = this._getVolumeStyle(null);\n\n    if (!n(t)) return e;\n\n    for (const o of t.dynamicSections) this._isPlaneValid(o, [0, 1, r.getZDimension()], r.dimensions) ? e.push(new T({\n      enabled: o.enabled,\n      label: o.label,\n      point: o.point,\n      normal: o.normal\n    })) : e.push(new T({\n      enabled: !1,\n      label: \"invalid\",\n      point: o.point,\n      normal: o.normal\n    }));\n\n    return e;\n  }\n\n  _pushDynamicSectionsToWasm(e) {\n    this._dbg(D.VerboseAPI, \"VoxelLayer._pushDynamicSectionsToWasm() called!\");\n\n    v.getInstance().setLayerDynamicSections(this, e) || this._dbg(D.Error, \"VoxelLayer._updateDynamicSections() failed!\");\n  }\n\n  _getCurrentVariableId() {\n    return this.style ? this.style.currentVariableId : -1;\n  }\n\n  _pushCurrentVariableIdToWasm(e) {\n    this._dbg(D.VerboseAPI, \"VoxelLayer._pushCurrentVariableIdToWasm() called!\");\n\n    v.getInstance().setLayerCurrentVariable(this, e) || this._dbg(D.Error, \"VoxelLayer._pushCurrentVariableIdToWasm() failed!\");\n  }\n\n  _getRenderMode() {\n    return this.style ? this.style.renderMode : \"volume\";\n  }\n\n  _pushRenderModeToWasm(e) {\n    this._dbg(D.VerboseAPI, \"VoxelLayer._pushRenderModeToWasm() called!\");\n\n    v.getInstance().setLayerRenderMode(this, e) || this._dbg(D.Error, \"VoxelLayer.setLayerRenderMode() failed!\");\n  }\n\n};\ne([m(j)], R.prototype, \"popupEnabled\", void 0), e([m({\n  type: [\"Voxel\"]\n})], R.prototype, \"operationalLayerType\", void 0), e([m(I)], R.prototype, \"legendEnabled\", void 0), e([m({\n  json: {\n    write: !0\n  }\n})], R.prototype, \"title\", void 0), e([m(w)], R.prototype, \"url\", null), e([m({\n  type: r.ofType(L),\n  json: {\n    write: !0,\n    origins: {\n      \"web-scene\": {\n        name: \"layerDefinition.sections\",\n        write: !0\n      },\n      service: {\n        write: !1\n      }\n    }\n  }\n})], R.prototype, \"sections\", void 0), e([m({\n  type: P,\n  json: {\n    write: !0,\n    origins: {\n      \"web-scene\": {\n        name: \"layerDefinition.style\",\n        write: !0\n      },\n      service: {\n        write: !1\n      }\n    }\n  }\n})], R.prototype, \"style\", void 0), e([m({\n  type: [\"show\", \"hide\"]\n})], R.prototype, \"listMode\", void 0), e([m({\n  type: Number,\n  range: {\n    min: 0,\n    max: 1\n  },\n  nonNullable: !0,\n  json: {\n    read: !1,\n    write: !1,\n    origins: {\n      \"web-scene\": {\n        read: !1,\n        write: !1\n      },\n      \"portal-item\": {\n        read: !1,\n        write: !1\n      }\n    }\n  }\n})], R.prototype, \"opacity\", void 0), e([m({\n  type: r.ofType(W)\n})], R.prototype, \"variables\", void 0), e([m({\n  type: r.ofType(A)\n})], R.prototype, \"volumes\", void 0), e([m({\n  type: E\n})], R.prototype, \"index\", void 0), e([m({\n  type: Number,\n  json: {\n    name: \"layerDefinition.minScale\",\n    read: !1,\n    write: !1,\n    origins: {\n      service: {\n        read: !1,\n        write: !1\n      }\n    }\n  }\n})], R.prototype, \"minScale\", void 0), e([m({\n  type: Number,\n  json: {\n    name: \"layerDefinition.maxScale\",\n    read: !1,\n    write: !1,\n    origins: {\n      service: {\n        read: !1,\n        write: !1\n      }\n    }\n  }\n})], R.prototype, \"maxScale\", void 0), e([m({\n  json: {\n    read: !1\n  },\n  readOnly: !0\n})], R.prototype, \"type\", void 0), e([m({\n  readOnly: !0,\n  json: {\n    name: \"serviceVersion\"\n  }\n})], R.prototype, \"version\", void 0), e([d(\"service\", \"version\")], R.prototype, \"readVersion\", null), R = e([c(\"esri.layers.VoxelLayer\")], R);\nconst C = R;\nexport { C as default };","map":{"version":3,"sources":["D:/Github/CUSP_DataBase/CUSP_DB/src/main/gis/node_modules/@arcgis/core/layers/VoxelLayer.js"],"names":["_","e","r","t","o","i","destroyMaybe","s","isSome","n","MultiOriginJSONMixin","a","throwIfAbortError","l","watch","p","property","m","reader","d","subclass","c","h","f","u","y","v","APIKeyMixin","b","ArcGISService","OperationalLayer","g","PortalLayer","V","ScaleRangeLayer","S","SceneService","sanitizeUrl","x","popupEnabled","j","legendEnabled","I","url","w","T","L","N","P","W","A","E","M","getLogger","D","API","VerboseAPI","Error","R","constructor","serviceRoot","operationalLayerType","title","sections","style","opacity","variables","volumes","index","minScale","maxScale","type","_dbgFlags","Set","_handles","version","major","Number","NaN","minor","versionString","_set","destroy","_dbg","has","error","warn","load","signal","loadFromPortal","supportedTypes","catch","then","_fetchService","addResolvingPromise","Promise","resolve","getConfiguration","add","_getRenderMode","_pushRenderModeToWasm","_getCurrentVariableId","_pushCurrentVariableIdToWasm","_getDynamicSections","_pushDynamicSectionsToWasm","_getSlices","_pushSlicesToWasm","_getSections","_pushSectionsToWasm","layerType","name","spatialReference","fullExtent","toJSON","isValid","JSON","stringify","readVersion","parseVersionString","push","enabled","href","id","label","normal","point","sizeInPixel","slices","timeId","variableId","getInstance","setLayerStaticSections","_isPlaneValid","Array","isArray","length","size","Math","abs","getVariableStyle","variableStyles","findIndex","getItemAt","getVariable","getVolume","find","volumeId","validateLayer","isNaN","serviceVersion","supportedVersions","_getVolumeStyle","volumeStyles","isVolumeValid","getZDimension","dimensions","setLayerSlices","dynamicSections","setLayerDynamicSections","currentVariableId","setLayerCurrentVariable","renderMode","setLayerRenderMode","prototype","json","write","ofType","origins","service","range","min","max","nonNullable","read","readOnly","C","default"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../chunks/tslib.es6.js\";import r from\"../core/Collection.js\";import t from\"../core/Error.js\";import o from\"../core/Handles.js\";import i from\"../core/Logger.js\";import{destroyMaybe as s,isSome as n}from\"../core/maybe.js\";import{MultiOriginJSONMixin as a}from\"../core/MultiOriginJSONSupport.js\";import{throwIfAbortError as l}from\"../core/promiseUtils.js\";import{watch as p}from\"../core/reactiveUtils.js\";import{property as m}from\"../core/accessorSupport/decorators/property.js\";import\"../core/arrayUtils.js\";import\"../core/has.js\";import\"../core/accessorSupport/ensureType.js\";import{reader as d}from\"../core/accessorSupport/decorators/reader.js\";import{subclass as c}from\"../core/accessorSupport/decorators/subclass.js\";import{n as h}from\"../chunks/vec3.js\";import{f as u}from\"../chunks/vec3f64.js\";import y from\"./Layer.js\";import v from\"./VoxelWasmManager.js\";import{APIKeyMixin as b}from\"./mixins/APIKeyMixin.js\";import{ArcGISService as f}from\"./mixins/ArcGISService.js\";import{OperationalLayer as g}from\"./mixins/OperationalLayer.js\";import{PortalLayer as V}from\"./mixins/PortalLayer.js\";import{ScaleRangeLayer as S}from\"./mixins/ScaleRangeLayer.js\";import{SceneService as _}from\"./mixins/SceneService.js\";import{sanitizeUrl as x}from\"./support/arcgisLayerUrl.js\";import{popupEnabled as j,legendEnabled as I,url as w}from\"./support/commonProperties.js\";import T from\"./support/VoxelDynamicSection.js\";import L from\"./support/VoxelSection.js\";import N from\"./support/VoxelSlice.js\";import P from\"./support/VoxelStyle.js\";import W from\"./support/VoxelVariable.js\";import A from\"./support/VoxelVolume.js\";import E from\"./support/VoxelVolumeIndex.js\";const M=i.getLogger(\" esri.layers.VoxelLayer\");var D;!function(e){e[e.API=1]=\"API\",e[e.VerboseAPI=2]=\"VerboseAPI\",e[e.Error=3]=\"Error\"}(D||(D={}));let R=class extends(_(f(g(V(S(a(b(y)))))))){constructor(e){super(e),this.serviceRoot=\"\",this.popupEnabled=!0,this.operationalLayerType=\"Voxel\",this.legendEnabled=!0,this.title=null,this.sections=new r,this.style=null,this.opacity=1,this.variables=new r,this.volumes=new r,this.index=null,this.minScale=0,this.maxScale=0,this.type=\"voxel\",this._dbgFlags=new Set,this._handles=new o,this.version={major:Number.NaN,minor:Number.NaN,versionString:\"\"}}set url(e){this._set(\"url\",x(e,M))}destroy(){this._handles=s(this._handles)}_dbg(e,r){this._dbgFlags.has(e)&&(e===D.Error?M.error(r):M.warn(r))}load(e){const r=n(e)?e.signal:null,t=this.loadFromPortal({supportedTypes:[\"Scene Service\"]},e).catch(l).then((()=>this._fetchService(r))).then((()=>this.serviceRoot=this.url));return this.addResolvingPromise(t),Promise.resolve(this)}getConfiguration(){this._handles.add([p((()=>this._getRenderMode()),(e=>this._pushRenderModeToWasm(e))),p((()=>this._getCurrentVariableId()),(e=>this._pushCurrentVariableIdToWasm(e))),p((()=>this._getDynamicSections()),(e=>this._pushDynamicSectionsToWasm(e))),p((()=>this._getSlices()),(e=>this._pushSlicesToWasm(e))),p((()=>this._getSections()),(e=>this._pushSectionsToWasm(e)))]);const e={layerType:this.operationalLayerType,version:this.version.versionString,name:this.title,spatialReference:this.spatialReference,fullExtent:this.fullExtent,volumes:this.volumes.toJSON(),variables:this.variables.toJSON(),index:this.index.toJSON(),sections:this.sections.toJSON(),style:this.style};return e.index&&this.index.isValid()?JSON.stringify(e):\"\"}readVersion(e,r){return super.parseVersionString(e)}_getSections(){const e=[];for(const r of this.sections)e.push(new L({enabled:r.enabled,href:r.href,id:r.id,label:r.label,normal:r.normal,point:r.point,sizeInPixel:r.sizeInPixel,slices:r.slices,timeId:r.timeId,variableId:r.variableId}));return e}_pushSectionsToWasm(e){this._dbg(D.VerboseAPI,\"VoxelLayer._pushSectionsToWasm() called\");v.getInstance().setLayerStaticSections(this,e)||this._dbg(D.Error,\"VoxelLayer._pushSectionsToWasm() failed!\")}_isPlaneValid(e,r,t){if(!e.point)return!1;if(!Array.isArray(e.point)||3!==e.point.length)return!1;if(!e.normal)return!1;if(!Array.isArray(e.normal)||3!==e.normal.length)return!1;for(let s=0;s<3;++s){const o=e.point[s];if(o<0||o>=t[r[s]].size)return!1}const o=u(e.normal[0],e.normal[1],e.normal[2]);h(o,o);const i=1e-6;return!(Math.abs(o[0])+Math.abs(o[1])+Math.abs(o[2])<i)&&(e.normal[0]=o[0],e.normal[1]=o[1],e.normal[2]=o[2],!0)}getVariableStyle(e){let r=-1;r=n(e)?e:this._getCurrentVariableId();if(!(null==this?void 0:this.style.variableStyles)||-1===r)return null;const t=this.style.variableStyles.findIndex((e=>e.variableId===r));return t<0?null:this.style.variableStyles.getItemAt(t)}getVariable(e){let r=-1;if(r=n(e)?e:this._getCurrentVariableId(),!this.variables||-1===r)return null;const t=this.variables.findIndex((e=>e.id===r));return t<0?null:this.variables.getItemAt(t)}getVolume(e){const r=this.getVariable(e);return n(r)?this.volumes.find((({id:e})=>e===r.volumeId)):null}validateLayer(e){if(e.layerType&&e.layerType!==this.operationalLayerType)throw new t(\"voxel-layer:layer-type-not-supported\",\"VoxelLayer does not support this layer type\",{layerType:e.layerType});if(isNaN(this.version.major)||isNaN(this.version.minor)||this.version.major<3)throw new t(\"layer:service-version-not-supported\",\"Service version is not supported.\",{serviceVersion:this.version.versionString,supportedVersions:\"3.x\"});if(this.version.major>3)throw new t(\"layer:service-version-too-new\",\"Service version is too new.\",{serviceVersion:this.version.versionString,supportedVersions:\"3.x\"})}_getVolumeStyle(e){const r=this.getVariable(e);return n(r)?this.style.volumeStyles.find((({volumeId:e})=>e===r.volumeId)):null}_getSlices(){const e=[],r=this.getVolume(null);if(!n(r)||!r.isVolumeValid())return e;const t=this._getVolumeStyle(null);if(!n(t))return e;for(const o of t.slices)this._isPlaneValid(o,[0,1,r.getZDimension()],r.dimensions)?e.push(new N({enabled:o.enabled,label:o.label,point:o.point,normal:o.normal})):e.push(new N({enabled:!1,label:\"invalid\",point:o.point,normal:o.normal}));return e}_pushSlicesToWasm(e){this._dbg(D.VerboseAPI,\"VoxelLayer._pushSlicesToWasm() called!\");v.getInstance().setLayerSlices(this,e)||this._dbg(D.Error,\"VoxelLayer._pushSlicesToWasm() failed!\")}_getDynamicSections(){const e=[],r=this.getVolume(null);if(!n(r)||!r.isVolumeValid())return e;const t=this._getVolumeStyle(null);if(!n(t))return e;for(const o of t.dynamicSections)this._isPlaneValid(o,[0,1,r.getZDimension()],r.dimensions)?e.push(new T({enabled:o.enabled,label:o.label,point:o.point,normal:o.normal})):e.push(new T({enabled:!1,label:\"invalid\",point:o.point,normal:o.normal}));return e}_pushDynamicSectionsToWasm(e){this._dbg(D.VerboseAPI,\"VoxelLayer._pushDynamicSectionsToWasm() called!\");v.getInstance().setLayerDynamicSections(this,e)||this._dbg(D.Error,\"VoxelLayer._updateDynamicSections() failed!\")}_getCurrentVariableId(){return this.style?this.style.currentVariableId:-1}_pushCurrentVariableIdToWasm(e){this._dbg(D.VerboseAPI,\"VoxelLayer._pushCurrentVariableIdToWasm() called!\");v.getInstance().setLayerCurrentVariable(this,e)||this._dbg(D.Error,\"VoxelLayer._pushCurrentVariableIdToWasm() failed!\")}_getRenderMode(){return this.style?this.style.renderMode:\"volume\"}_pushRenderModeToWasm(e){this._dbg(D.VerboseAPI,\"VoxelLayer._pushRenderModeToWasm() called!\");v.getInstance().setLayerRenderMode(this,e)||this._dbg(D.Error,\"VoxelLayer.setLayerRenderMode() failed!\")}};e([m(j)],R.prototype,\"popupEnabled\",void 0),e([m({type:[\"Voxel\"]})],R.prototype,\"operationalLayerType\",void 0),e([m(I)],R.prototype,\"legendEnabled\",void 0),e([m({json:{write:!0}})],R.prototype,\"title\",void 0),e([m(w)],R.prototype,\"url\",null),e([m({type:r.ofType(L),json:{write:!0,origins:{\"web-scene\":{name:\"layerDefinition.sections\",write:!0},service:{write:!1}}}})],R.prototype,\"sections\",void 0),e([m({type:P,json:{write:!0,origins:{\"web-scene\":{name:\"layerDefinition.style\",write:!0},service:{write:!1}}}})],R.prototype,\"style\",void 0),e([m({type:[\"show\",\"hide\"]})],R.prototype,\"listMode\",void 0),e([m({type:Number,range:{min:0,max:1},nonNullable:!0,json:{read:!1,write:!1,origins:{\"web-scene\":{read:!1,write:!1},\"portal-item\":{read:!1,write:!1}}}})],R.prototype,\"opacity\",void 0),e([m({type:r.ofType(W)})],R.prototype,\"variables\",void 0),e([m({type:r.ofType(A)})],R.prototype,\"volumes\",void 0),e([m({type:E})],R.prototype,\"index\",void 0),e([m({type:Number,json:{name:\"layerDefinition.minScale\",read:!1,write:!1,origins:{service:{read:!1,write:!1}}}})],R.prototype,\"minScale\",void 0),e([m({type:Number,json:{name:\"layerDefinition.maxScale\",read:!1,write:!1,origins:{service:{read:!1,write:!1}}}})],R.prototype,\"maxScale\",void 0),e([m({json:{read:!1},readOnly:!0})],R.prototype,\"type\",void 0),e([m({readOnly:!0,json:{name:\"serviceVersion\"}})],R.prototype,\"version\",void 0),e([d(\"service\",\"version\")],R.prototype,\"readVersion\",null),R=e([c(\"esri.layers.VoxelLayer\")],R);const C=R;export{C as default};\n"]},"metadata":{},"sourceType":"module"}