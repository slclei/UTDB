{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport { _ as t } from \"../../../chunks/tslib.es6.js\";\nimport e from \"../../../core/Accessor.js\";\nimport { property as i } from \"../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../core/arrayUtils.js\";\nimport \"../../../core/has.js\";\nimport { cast as o } from \"../../../core/accessorSupport/decorators/cast.js\";\nimport { subclass as r } from \"../../../core/accessorSupport/decorators/subclass.js\";\nimport a from \"../../../popup/FieldInfo.js\";\nimport s from \"../../../popup/content/support/ChartMediaInfoValueSeries.js\";\nimport { substituteFieldsInLinksAndAttributes as l, fixTokens as n, substituteAttributes as d, getFixedFieldNames as p, getFixedFieldName as u, isRelatedField as f, formatValueToFieldInfo as c, getFieldInfo as m, getFieldInfoLabel as h } from \"../support/featureUtils.js\";\nimport { getRelatedFieldInfo as y } from \"../support/relatedFeatureUtils.js\";\nconst v = {\n  chartAnimation: !0\n};\nlet I = class extends e {\n  constructor(t) {\n    super(t), this.abilities = { ...v\n    }, this.activeMediaInfoIndex = 0, this.attributes = null, this.description = null, this.fieldInfoMap = null, this.formattedAttributes = null, this.expressionAttributes = null, this.layer = null, this.mediaInfos = null, this.popupTemplate = null, this.relatedInfos = null, this.title = null;\n  }\n\n  castAbilities(t) {\n    return { ...v,\n      ...t\n    };\n  }\n\n  get activeMediaInfo() {\n    return this.formattedMediaInfos[this.activeMediaInfoIndex] || null;\n  }\n\n  get formattedMediaInfos() {\n    return this._formatMediaInfos() || [];\n  }\n\n  get formattedMediaInfoCount() {\n    return this.formattedMediaInfos.length;\n  }\n\n  setActiveMedia(t) {\n    this._setContentElementMedia(t);\n  }\n\n  next() {\n    this._pageContentElementMedia(1);\n  }\n\n  previous() {\n    this._pageContentElementMedia(-1);\n  }\n\n  _setContentElementMedia(t) {\n    const {\n      formattedMediaInfoCount: e\n    } = this,\n          i = (t + e) % e;\n    this.activeMediaInfoIndex = i;\n  }\n\n  _pageContentElementMedia(t) {\n    const {\n      activeMediaInfoIndex: e\n    } = this,\n          i = e + t;\n\n    this._setContentElementMedia(i);\n  }\n\n  _formatMediaInfos() {\n    const {\n      attributes: t,\n      mediaInfos: e,\n      formattedAttributes: i,\n      expressionAttributes: o,\n      fieldInfoMap: r,\n      layer: a\n    } = this;\n    return null == e ? void 0 : e.map(e => {\n      const s = null == e ? void 0 : e.clone();\n      if (!s) return null;\n\n      if (s.title = l({\n        attributes: t,\n        fieldInfoMap: r,\n        globalAttributes: i,\n        expressionAttributes: o,\n        layer: a,\n        text: s.title\n      }), s.caption = l({\n        attributes: t,\n        fieldInfoMap: r,\n        globalAttributes: i,\n        expressionAttributes: o,\n        layer: a,\n        text: s.caption\n      }), s.altText = l({\n        attributes: t,\n        fieldInfoMap: r,\n        globalAttributes: i,\n        expressionAttributes: o,\n        layer: a,\n        text: s.altText\n      }), \"image\" === s.type) {\n        const {\n          value: t\n        } = s;\n        return this._setImageValue({\n          value: t,\n          formattedAttributes: i,\n          layer: a\n        }), s.value.sourceURL ? s : void 0;\n      }\n\n      if (\"pie-chart\" === s.type || \"line-chart\" === s.type || \"column-chart\" === s.type || \"bar-chart\" === s.type) {\n        const {\n          value: e\n        } = s;\n        return this._setChartValue({\n          value: e,\n          chartType: s.type,\n          attributes: t,\n          formattedAttributes: i,\n          layer: a\n        }), s;\n      }\n\n      return null;\n    }).filter(Boolean);\n  }\n\n  _setImageValue(t) {\n    const {\n      fieldInfoMap: e\n    } = this,\n          {\n      value: i,\n      formattedAttributes: o,\n      layer: r\n    } = t,\n          {\n      linkURL: a,\n      sourceURL: s\n    } = i;\n\n    if (s) {\n      const t = n(s, r);\n      i.sourceURL = d({\n        formattedAttributes: o,\n        template: t,\n        fieldInfoMap: e\n      });\n    }\n\n    if (a) {\n      const t = n(a, r);\n      i.linkURL = d({\n        formattedAttributes: o,\n        template: t,\n        fieldInfoMap: e\n      });\n    }\n  }\n\n  _setChartValue(t) {\n    const {\n      value: e,\n      attributes: i,\n      formattedAttributes: o,\n      chartType: r,\n      layer: a\n    } = t,\n          {\n      popupTemplate: s,\n      relatedInfos: l\n    } = this,\n          {\n      fields: n,\n      normalizeField: d\n    } = e;\n    e.fields = p(n, a), d && (e.normalizeField = u(d, a));\n    if (!n.some(t => !!(null != o[t] || f(t) && l.size))) return;\n    const c = null == s ? void 0 : s.fieldInfos;\n    n.forEach(t => {\n      if (f(t)) return void (e.series = [...e.series, ...this._getRelatedChartInfos({\n        fieldInfos: c,\n        fieldName: t,\n        formattedAttributes: o,\n        chartType: r,\n        value: e\n      })]);\n\n      const a = this._getChartOption({\n        value: e,\n        attributes: i,\n        chartType: r,\n        formattedAttributes: o,\n        fieldName: t,\n        fieldInfos: c\n      });\n\n      e.series.push(a);\n    });\n  }\n\n  _getRelatedChartInfos(t) {\n    var e;\n    const {\n      fieldInfos: i,\n      fieldName: o,\n      formattedAttributes: r,\n      chartType: a,\n      value: s\n    } = t,\n          l = [],\n          n = y(o),\n          {\n      layerId: d,\n      fieldName: p\n    } = n,\n          u = null == (e = this.relatedInfos) ? void 0 : e.get(d.toString());\n    if (!u) return l;\n    const {\n      relatedFeatures: f,\n      relation: c\n    } = u;\n    if (!c || !f) return l;\n    const {\n      cardinality: m\n    } = c;\n    f.forEach(t => {\n      const {\n        attributes: e\n      } = t;\n      e && Object.keys(e).forEach(t => {\n        t === p && l.push(this._getChartOption({\n          value: s,\n          attributes: e,\n          formattedAttributes: r,\n          fieldName: o,\n          chartType: a,\n          relatedFieldName: t,\n          fieldInfos: i\n        }));\n      });\n    });\n    return \"one-to-many\" === m || \"many-to-many\" === m ? l : [l[0]];\n  }\n\n  _getTooltip(_ref) {\n    let {\n      label: t,\n      value: e,\n      chartType: i\n    } = _ref;\n    return \"pie-chart\" === i ? t : `${t}: ${e}`;\n  }\n\n  _getChartOption(t) {\n    var e;\n\n    const {\n      value: i,\n      attributes: o,\n      formattedAttributes: r,\n      fieldName: l,\n      relatedFieldName: n,\n      fieldInfos: d,\n      chartType: p\n    } = t,\n          {\n      layer: v\n    } = this,\n          {\n      normalizeField: I,\n      tooltipField: b\n    } = i,\n          M = I ? f(I) ? o[y(I).fieldName] : o[I] : null,\n          A = n && void 0 !== o[n] ? o[n] : void 0 !== o[l] ? o[l] : r[l],\n          g = void 0 === A ? null : A && M ? A / M : A,\n          _ = new s({\n      value: g\n    });\n\n    if (f(l)) {\n      const t = y(l),\n            e = y(b),\n            i = e ? e.fieldName : null,\n            r = c(g, {\n        fieldInfos: d,\n        fieldName: n,\n        layer: v,\n        preventPlacesFormatting: !!M\n      }),\n            a = t ? t.label || t.fieldName : n,\n            s = i && void 0 !== o[i] ? o[i] : a;\n      return _.tooltip = this._getTooltip({\n        label: s,\n        value: r,\n        chartType: p\n      }), _;\n    }\n\n    const x = m(d, l),\n          T = u(l, v),\n          C = b && void 0 !== r[b] ? r[b] : h(x || new a({\n      fieldName: T\n    }), null == (e = this.popupTemplate) ? void 0 : e.expressionInfos),\n          F = r[T];\n    return _.tooltip = this._getTooltip({\n      label: C,\n      value: F,\n      chartType: p\n    }), _;\n  }\n\n};\nt([i()], I.prototype, \"abilities\", void 0), t([o(\"abilities\")], I.prototype, \"castAbilities\", null), t([i()], I.prototype, \"activeMediaInfoIndex\", void 0), t([i({\n  readOnly: !0\n})], I.prototype, \"activeMediaInfo\", null), t([i()], I.prototype, \"attributes\", void 0), t([i()], I.prototype, \"description\", void 0), t([i()], I.prototype, \"fieldInfoMap\", void 0), t([i()], I.prototype, \"formattedAttributes\", void 0), t([i()], I.prototype, \"expressionAttributes\", void 0), t([i({\n  readOnly: !0\n})], I.prototype, \"formattedMediaInfos\", null), t([i()], I.prototype, \"layer\", void 0), t([i({\n  readOnly: !0\n})], I.prototype, \"formattedMediaInfoCount\", null), t([i()], I.prototype, \"mediaInfos\", void 0), t([i()], I.prototype, \"popupTemplate\", void 0), t([i()], I.prototype, \"relatedInfos\", void 0), t([i()], I.prototype, \"title\", void 0), I = t([r(\"esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel\")], I);\nconst b = I;\nexport { b as default };","map":{"version":3,"sources":["D:/Github/CUSP_DataBase/CUSP_DB/src/main/gis/node_modules/@arcgis/core/widgets/Feature/FeatureMedia/FeatureMediaViewModel.js"],"names":["_","t","e","property","i","cast","o","subclass","r","a","s","substituteFieldsInLinksAndAttributes","l","fixTokens","n","substituteAttributes","d","getFixedFieldNames","p","getFixedFieldName","u","isRelatedField","f","formatValueToFieldInfo","c","getFieldInfo","m","getFieldInfoLabel","h","getRelatedFieldInfo","y","v","chartAnimation","I","constructor","abilities","activeMediaInfoIndex","attributes","description","fieldInfoMap","formattedAttributes","expressionAttributes","layer","mediaInfos","popupTemplate","relatedInfos","title","castAbilities","activeMediaInfo","formattedMediaInfos","_formatMediaInfos","formattedMediaInfoCount","length","setActiveMedia","_setContentElementMedia","next","_pageContentElementMedia","previous","map","clone","globalAttributes","text","caption","altText","type","value","_setImageValue","sourceURL","_setChartValue","chartType","filter","Boolean","linkURL","template","fields","normalizeField","some","size","fieldInfos","forEach","series","_getRelatedChartInfos","fieldName","_getChartOption","push","layerId","get","toString","relatedFeatures","relation","cardinality","Object","keys","relatedFieldName","_getTooltip","label","tooltipField","b","M","A","g","preventPlacesFormatting","tooltip","x","T","C","expressionInfos","F","prototype","readOnly","default"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport{_ as t}from\"../../../chunks/tslib.es6.js\";import e from\"../../../core/Accessor.js\";import{property as i}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/arrayUtils.js\";import\"../../../core/has.js\";import{cast as o}from\"../../../core/accessorSupport/decorators/cast.js\";import{subclass as r}from\"../../../core/accessorSupport/decorators/subclass.js\";import a from\"../../../popup/FieldInfo.js\";import s from\"../../../popup/content/support/ChartMediaInfoValueSeries.js\";import{substituteFieldsInLinksAndAttributes as l,fixTokens as n,substituteAttributes as d,getFixedFieldNames as p,getFixedFieldName as u,isRelatedField as f,formatValueToFieldInfo as c,getFieldInfo as m,getFieldInfoLabel as h}from\"../support/featureUtils.js\";import{getRelatedFieldInfo as y}from\"../support/relatedFeatureUtils.js\";const v={chartAnimation:!0};let I=class extends e{constructor(t){super(t),this.abilities={...v},this.activeMediaInfoIndex=0,this.attributes=null,this.description=null,this.fieldInfoMap=null,this.formattedAttributes=null,this.expressionAttributes=null,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null}castAbilities(t){return{...v,...t}}get activeMediaInfo(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}get formattedMediaInfos(){return this._formatMediaInfos()||[]}get formattedMediaInfoCount(){return this.formattedMediaInfos.length}setActiveMedia(t){this._setContentElementMedia(t)}next(){this._pageContentElementMedia(1)}previous(){this._pageContentElementMedia(-1)}_setContentElementMedia(t){const{formattedMediaInfoCount:e}=this,i=(t+e)%e;this.activeMediaInfoIndex=i}_pageContentElementMedia(t){const{activeMediaInfoIndex:e}=this,i=e+t;this._setContentElementMedia(i)}_formatMediaInfos(){const{attributes:t,mediaInfos:e,formattedAttributes:i,expressionAttributes:o,fieldInfoMap:r,layer:a}=this;return null==e?void 0:e.map((e=>{const s=null==e?void 0:e.clone();if(!s)return null;if(s.title=l({attributes:t,fieldInfoMap:r,globalAttributes:i,expressionAttributes:o,layer:a,text:s.title}),s.caption=l({attributes:t,fieldInfoMap:r,globalAttributes:i,expressionAttributes:o,layer:a,text:s.caption}),s.altText=l({attributes:t,fieldInfoMap:r,globalAttributes:i,expressionAttributes:o,layer:a,text:s.altText}),\"image\"===s.type){const{value:t}=s;return this._setImageValue({value:t,formattedAttributes:i,layer:a}),s.value.sourceURL?s:void 0}if(\"pie-chart\"===s.type||\"line-chart\"===s.type||\"column-chart\"===s.type||\"bar-chart\"===s.type){const{value:e}=s;return this._setChartValue({value:e,chartType:s.type,attributes:t,formattedAttributes:i,layer:a}),s}return null})).filter(Boolean)}_setImageValue(t){const{fieldInfoMap:e}=this,{value:i,formattedAttributes:o,layer:r}=t,{linkURL:a,sourceURL:s}=i;if(s){const t=n(s,r);i.sourceURL=d({formattedAttributes:o,template:t,fieldInfoMap:e})}if(a){const t=n(a,r);i.linkURL=d({formattedAttributes:o,template:t,fieldInfoMap:e})}}_setChartValue(t){const{value:e,attributes:i,formattedAttributes:o,chartType:r,layer:a}=t,{popupTemplate:s,relatedInfos:l}=this,{fields:n,normalizeField:d}=e;e.fields=p(n,a),d&&(e.normalizeField=u(d,a));if(!n.some((t=>!!(null!=o[t]||f(t)&&l.size))))return;const c=null==s?void 0:s.fieldInfos;n.forEach((t=>{if(f(t))return void(e.series=[...e.series,...this._getRelatedChartInfos({fieldInfos:c,fieldName:t,formattedAttributes:o,chartType:r,value:e})]);const a=this._getChartOption({value:e,attributes:i,chartType:r,formattedAttributes:o,fieldName:t,fieldInfos:c});e.series.push(a)}))}_getRelatedChartInfos(t){var e;const{fieldInfos:i,fieldName:o,formattedAttributes:r,chartType:a,value:s}=t,l=[],n=y(o),{layerId:d,fieldName:p}=n,u=null==(e=this.relatedInfos)?void 0:e.get(d.toString());if(!u)return l;const{relatedFeatures:f,relation:c}=u;if(!c||!f)return l;const{cardinality:m}=c;f.forEach((t=>{const{attributes:e}=t;e&&Object.keys(e).forEach((t=>{t===p&&l.push(this._getChartOption({value:s,attributes:e,formattedAttributes:r,fieldName:o,chartType:a,relatedFieldName:t,fieldInfos:i}))}))}));return\"one-to-many\"===m||\"many-to-many\"===m?l:[l[0]]}_getTooltip({label:t,value:e,chartType:i}){return\"pie-chart\"===i?t:`${t}: ${e}`}_getChartOption(t){var e;const{value:i,attributes:o,formattedAttributes:r,fieldName:l,relatedFieldName:n,fieldInfos:d,chartType:p}=t,{layer:v}=this,{normalizeField:I,tooltipField:b}=i,M=I?f(I)?o[y(I).fieldName]:o[I]:null,A=n&&void 0!==o[n]?o[n]:void 0!==o[l]?o[l]:r[l],g=void 0===A?null:A&&M?A/M:A,_=new s({value:g});if(f(l)){const t=y(l),e=y(b),i=e?e.fieldName:null,r=c(g,{fieldInfos:d,fieldName:n,layer:v,preventPlacesFormatting:!!M}),a=t?t.label||t.fieldName:n,s=i&&void 0!==o[i]?o[i]:a;return _.tooltip=this._getTooltip({label:s,value:r,chartType:p}),_}const x=m(d,l),T=u(l,v),C=b&&void 0!==r[b]?r[b]:h(x||new a({fieldName:T}),null==(e=this.popupTemplate)?void 0:e.expressionInfos),F=r[T];return _.tooltip=this._getTooltip({label:C,value:F,chartType:p}),_}};t([i()],I.prototype,\"abilities\",void 0),t([o(\"abilities\")],I.prototype,\"castAbilities\",null),t([i()],I.prototype,\"activeMediaInfoIndex\",void 0),t([i({readOnly:!0})],I.prototype,\"activeMediaInfo\",null),t([i()],I.prototype,\"attributes\",void 0),t([i()],I.prototype,\"description\",void 0),t([i()],I.prototype,\"fieldInfoMap\",void 0),t([i()],I.prototype,\"formattedAttributes\",void 0),t([i()],I.prototype,\"expressionAttributes\",void 0),t([i({readOnly:!0})],I.prototype,\"formattedMediaInfos\",null),t([i()],I.prototype,\"layer\",void 0),t([i({readOnly:!0})],I.prototype,\"formattedMediaInfoCount\",null),t([i()],I.prototype,\"mediaInfos\",void 0),t([i()],I.prototype,\"popupTemplate\",void 0),t([i()],I.prototype,\"relatedInfos\",void 0),t([i()],I.prototype,\"title\",void 0),I=t([r(\"esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel\")],I);const b=I;export{b as default};\n"]},"metadata":{},"sourceType":"module"}