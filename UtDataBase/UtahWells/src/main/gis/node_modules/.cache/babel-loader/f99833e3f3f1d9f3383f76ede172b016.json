{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport e from \"../config.js\";\nimport { id as t } from \"../kernel.js\";\nimport i from \"../request.js\";\nimport r from \"../core/Error.js\";\nimport { JSONMap as a } from \"../core/jsonMap.js\";\nimport { isSome as n } from \"../core/maybe.js\";\nimport { createScreenPoint as l, pt2px as s, px2pt as o } from \"../core/screenUtils.js\";\nimport { normalize as u, dataComponents as c } from \"../core/urlUtils.js\";\nimport y from \"../geometry/Polygon.js\";\nimport { collectLabelingFields as f } from \"../layers/support/fieldUtils.js\";\nimport { getSizeRangeAtScale as m } from \"../renderers/visualVariables/support/visualVariableUtils.js\";\nimport { execute as d } from \"./geoprocessor/execute.js\";\nimport { submitJob as p } from \"./geoprocessor/submitJob.js\";\nimport { toJSON as g } from \"./support/fileFormat.js\";\nimport { toJSON as b } from \"./support/layoutTemplate.js\";\nimport { getVisibleLayerViews as h, isGroupLayer as w, isScreenshotRequired as S, isBingMapsLayer as x, isCSVLayer as v, isFeatureLayer as D, isGeoJSONLayer as I, isGraphicsLayer as L, isImageryLayer as T, isImageryTileLayer as E, isKMLLayer as M, isMapImageLayer as V, isMapNotesLayer as O, isOpenStreetMapLayer as P, isStreamLayer as F, isTileLayer as N, isVectorTileLayer as R, isWebTileLayer as U, isWMSLayer as J, isWMTSLayer as j, isBlendLayer as A, applyVisualVariables as C, getContextBoundingBox as k, createPolygonLayer as z, createPolylineLayer as $, createPointLayer as K, createMultipointLayer as _ } from \"./support/printTaskUtils.js\";\nimport q from \"./support/PrintTemplate.js\";\nimport { supportsApiKey as W } from \"../support/apiKeyUtils.js\";\nimport { getFloorFilterClause as B } from \"../views/support/floorFilterUtils.js\";\nconst G = {\n  Feet: \"ft\",\n  Kilometers: \"km\",\n  Meters: \"m\",\n  Miles: \"mi\"\n},\n      Q = new a({\n  esriFeet: \"Feet\",\n  esriKilometers: \"Kilometers\",\n  esriMeters: \"Meters\",\n  esriMiles: \"Miles\"\n}),\n      H = new a({\n  esriExecutionTypeSynchronous: \"sync\",\n  esriExecutionTypeAsynchronous: \"async\"\n}),\n      X = new Map();\n\nasync function Y(e, t, r) {\n  const a = ie(e);\n  let n = X.get(a);\n  return Promise.resolve().then(() => n ? {\n    data: n.gpMetadata\n  } : (n = {\n    gpServerUrl: a,\n    is11xService: !1,\n    legendLayerNameMap: {},\n    legendLayers: []\n  }, i(a, {\n    query: {\n      f: \"json\"\n    }\n  }))).then(e => (n.gpMetadata = e.data, n.cimVersion = n.gpMetadata.cimVersion, n.is11xService = !!n.cimVersion, X.set(a, n), ee(t, n))).then(i => {\n    const a = Me(n);\n    let l;\n\n    const s = e => \"sync\" === a ? e.results && e.results[0] && e.results[0].value : l.fetchResultData(\"Output_File\", null, r).then(e => e.value);\n\n    return \"async\" === a ? p(e, i, null, r).then(e => (l = e, e.waitForJobCompletion({\n      interval: t.updateDelay\n    }).then(s))) : d(e, i, null, r).then(s);\n  });\n}\n\nasync function Z(e) {\n  const t = ie(e);\n  return Me(X.get(t));\n}\n\nasync function ee(e, t) {\n  t = t || {\n    is11xService: !1,\n    legendLayerNameMap: {},\n    legendLayers: []\n  };\n  const i = e.template || new q();\n  null == i.showLabels && (i.showLabels = !0);\n  const a = i.exportOptions;\n  let n;\n  const l = b(i.layout);\n\n  if (a) {\n    if (n = {\n      dpi: a.dpi\n    }, \"map_only\" === l.toLowerCase() || \"\" === l) {\n      const e = a.width,\n            t = a.height;\n      n.outputSize = [e, t];\n    }\n  }\n\n  const s = i.layoutOptions;\n  let o;\n\n  if (s) {\n    let e, t;\n    \"Miles\" === s.scalebarUnit || \"Kilometers\" === s.scalebarUnit ? (e = \"Kilometers\", t = \"Miles\") : \"Meters\" !== s.scalebarUnit && \"Feet\" !== s.scalebarUnit || (e = \"Meters\", t = \"Feet\"), o = {\n      titleText: s.titleText,\n      authorText: s.authorText,\n      copyrightText: s.copyrightText,\n      customTextElements: s.customTextElements,\n      scaleBarOptions: {\n        metricUnit: Q.toJSON(e),\n        metricLabel: G[e],\n        nonMetricUnit: Q.toJSON(t),\n        nonMetricLabel: G[t]\n      }\n    };\n  }\n\n  let u = null;\n  null != s && s.legendLayers && (u = s.legendLayers.map(e => {\n    t.legendLayerNameMap[e.layerId] = e.title;\n    const i = {\n      id: e.layerId\n    };\n    return e.subLayerIds && (i.subLayerIds = e.subLayerIds), i;\n  }));\n  const c = await te(e, i, t);\n\n  if (c.operationalLayers) {\n    const e = new RegExp(\"[\\\\u4E00-\\\\u9FFF\\\\u0E00-\\\\u0E7F\\\\u0900-\\\\u097F\\\\u3040-\\\\u309F\\\\u30A0-\\\\u30FF\\\\u31F0-\\\\u31FF]\"),\n          i = /[\\u0600-\\u06FF]/,\n          a = t => {\n      const r = t.text,\n            a = t.font,\n            n = a && a.family && a.family.toLowerCase();\n      r && a && (\"arial\" === n || \"arial unicode ms\" === n) && (a.family = e.test(r) ? \"Arial Unicode MS\" : \"Arial\", \"normal\" !== a.style && i.test(r) && (a.family = \"Arial Unicode MS\"));\n    },\n          n = () => {\n      throw new r(\"print:cim-symbol-unsupported\", \"CIMSymbol is not supported by a print service published from ArcMap\");\n    };\n\n    c.operationalLayers.forEach(e => {\n      var i, r, l;\n      null != (i = e.featureCollection) && i.layers ? e.featureCollection.layers.forEach(e => {\n        var i, r, l, s;\n\n        if (null != (i = e.layerDefinition) && null != (r = i.drawingInfo) && null != (l = r.renderer) && l.symbol) {\n          const i = e.layerDefinition.drawingInfo.renderer;\n          \"esriTS\" === i.symbol.type ? a(i.symbol) : \"CIMSymbolReference\" !== i.symbol.type || t.is11xService || n();\n        }\n\n        null != (s = e.featureSet) && s.features && e.featureSet.features.forEach(e => {\n          e.symbol && (\"esriTS\" === e.symbol.type ? a(e.symbol) : \"CIMSymbolReference\" !== e.symbol.type || t.is11xService || n());\n        });\n      }) : !t.is11xService && null != (r = e.layerDefinition) && null != (l = r.drawingInfo) && l.renderer && JSON.stringify(e.layerDefinition.drawingInfo.renderer).includes('\"type\":\"CIMSymbolReference\"') && n();\n    });\n  }\n\n  e.outSpatialReference && (c.mapOptions.spatialReference = e.outSpatialReference.toJSON()), Object.assign(c, {\n    exportOptions: n,\n    layoutOptions: o || {}\n  }), Object.assign(c.layoutOptions, {\n    legendOptions: {\n      operationalLayers: null != u ? u : t.legendLayers.slice()\n    }\n  }), t.legendLayers.length = 0, X.set(t.gpServerUrl, t);\n  const y = {\n    Web_Map_as_JSON: JSON.stringify(c),\n    Format: g(i.format),\n    Layout_Template: l\n  };\n  return e.extraParameters && Object.assign(y, e.extraParameters), y;\n}\n\nasync function te(e, t, i) {\n  const r = e.view;\n  let a = r.spatialReference;\n  const l = {\n    operationalLayers: await re(r, t, i)\n  };\n  let s = i.ssExtent || e.extent || r.extent;\n\n  if (a && a.isWrappable && (s = s.clone()._normalize(!0), a = s.spatialReference), l.mapOptions = {\n    extent: s && s.toJSON(),\n    spatialReference: a && a.toJSON(),\n    showAttribution: t.attributionVisible\n  }, i.ssExtent = null, r.background && (l.background = r.background.toJSON()), r.rotation && (l.mapOptions.rotation = -r.rotation), t.scalePreserved && (l.mapOptions.scale = t.outScale || r.scale), n(r.timeExtent)) {\n    const e = n(r.timeExtent.start) ? r.timeExtent.start.getTime() : null,\n          t = n(r.timeExtent.end) ? r.timeExtent.end.getTime() : null;\n    l.mapOptions.time = [e, t];\n  }\n\n  return l;\n}\n\nfunction ie(e) {\n  let t = e;\n  const i = t.lastIndexOf(\"/GPServer/\");\n  return i > 0 && (t = t.slice(0, i + 9)), t;\n}\n\nasync function re(e, t, i) {\n  const r = [],\n        a = {\n    layerView: null,\n    printTemplate: t,\n    view: e\n  };\n  let n = 0;\n  t.scalePreserved && (n = t.outScale || e.scale);\n  const l = h(e, n);\n\n  for (const s of l) {\n    const e = s.layer;\n    if (!e.loaded || w(e)) continue;\n    let t;\n    a.layerView = s, t = S(s) ? await ge(e, a, i) : x(e) ? ae(e) : v(e) ? await ne(e, a, i) : D(e) ? await se(e, a, i) : I(e) ? await oe(e, a, i) : L(e) ? await ue(e, a, i) : T(e) ? ce(e, i) : E(e) ? await ye(e, a, i) : M(e) ? await fe(e, a, i) : V(e) ? me(e, a, i) : O(e) ? await de(a, i) : P(e) ? pe() : F(e) ? await be(e, a, i) : N(e) ? he(e, i) : R(e) ? await we(e, a, i) : U(e) ? Se(e) : J(e) ? xe(e) : j(e) ? ve(e) : await ge(e, a, i), t && (Array.isArray(t) ? r.push(...t) : (t.id = e.id, t.title = i.legendLayerNameMap[e.id] || e.title, t.opacity = e.opacity, t.minScale = e.minScale || 0, t.maxScale = e.maxScale || 0, A(e) && e.blendMode && \"normal\" !== e.blendMode && (t.blendMode = e.blendMode), r.push(t)));\n  }\n\n  if (n && r.forEach(e => {\n    e.minScale = 0, e.maxScale = 0;\n  }), e.graphics && e.graphics.length) {\n    const a = await le(null, e.graphics, t, i);\n    a && r.push(a);\n  }\n\n  return r;\n}\n\nfunction ae(e) {\n  return {\n    culture: e.culture,\n    key: e.key,\n    type: \"BingMaps\" + (\"aerial\" === e.style ? \"Aerial\" : \"hybrid\" === e.style ? \"Hybrid\" : \"Road\")\n  };\n}\n\nasync function ne(e, t, i) {\n  e.legendEnabled && i.legendLayers.push({\n    id: e.id\n  });\n  const r = t.layerView,\n        a = t.printTemplate;\n  let n;\n\n  if (!i.is11xService || r.filter) {\n    return le(e, await Ee(r), a, i);\n  }\n\n  return n = {\n    type: \"CSV\"\n  }, e.write(n, {\n    origin: \"web-map\"\n  }), delete n.popupInfo, delete n.layerType, n.showLabels = a.showLabels && e.labelsVisible, n;\n}\n\nasync function le(e, t, i, r) {\n  let a;\n\n  const n = z(),\n        l = $(),\n        s = K(),\n        o = _(),\n        u = K();\n\n  if (u.layerDefinition.name = \"textLayer\", delete u.layerDefinition.drawingInfo, e) {\n    if (\"esri.layers.FeatureLayer\" === e.declaredClass || \"esri.layers.StreamLayer\" === e.declaredClass ? n.layerDefinition.name = l.layerDefinition.name = s.layerDefinition.name = o.layerDefinition.name = r.legendLayerNameMap[e.id] || e.get(\"arcgisProps.title\") || e.title : \"esri.layers.GraphicsLayer\" === e.declaredClass && (t = e.graphics.items), e.renderer) {\n      const t = e.renderer.toJSON();\n      n.layerDefinition.drawingInfo.renderer = t, l.layerDefinition.drawingInfo.renderer = t, s.layerDefinition.drawingInfo.renderer = t, o.layerDefinition.drawingInfo.renderer = t;\n    }\n\n    if (i.showLabels && e.labelsVisible && \"function\" == typeof e.write) {\n      var c, m;\n      const t = null == (c = e.write({}, {\n        origin: \"web-map\"\n      }).layerDefinition) || null == (m = c.drawingInfo) ? void 0 : m.labelingInfo;\n      t && (a = !0, n.layerDefinition.drawingInfo.labelingInfo = t, l.layerDefinition.drawingInfo.labelingInfo = t, s.layerDefinition.drawingInfo.labelingInfo = t, o.layerDefinition.drawingInfo.labelingInfo = t);\n    }\n  }\n\n  let d;\n  null != e && e.renderer || a || (delete n.layerDefinition.drawingInfo, delete l.layerDefinition.drawingInfo, delete s.layerDefinition.drawingInfo, delete o.layerDefinition.drawingInfo);\n  const p = null == e ? void 0 : e.fieldsIndex,\n        g = null == e ? void 0 : e.renderer;\n\n  if (p) {\n    const t = new Set();\n    a && (await f(t, e)), g && \"function\" == typeof g.collectRequiredFields && (await g.collectRequiredFields(t, p)), d = Array.from(t);\n    const i = p.fields.map(e => e.toJSON());\n    n.layerDefinition.fields = i, l.layerDefinition.fields = i, s.layerDefinition.fields = i, o.layerDefinition.fields = i;\n  }\n\n  const b = t && t.length;\n  let h;\n\n  for (let f = 0; f < b; f++) {\n    var w;\n    const a = t[f] || t.getItemAt(f);\n    if (!1 === a.visible || !a.geometry) continue;\n    if (h = a.toJSON(), h.hasOwnProperty(\"popupTemplate\") && delete h.popupTemplate, h.geometry && h.geometry.z && delete h.geometry.z, h.symbol && h.symbol.outline && \"esriCLS\" === h.symbol.outline.type && !r.is11xService) continue;\n    !r.is11xService && h.symbol && h.symbol.outline && h.symbol.outline.color && h.symbol.outline.color[3] && (h.symbol.outline.color[3] = 255);\n    const c = e && e.renderer && (\"valueExpression\" in e.renderer && e.renderer.valueExpression || \"hasVisualVariables\" in e.renderer && e.renderer.hasVisualVariables());\n\n    if (!h.symbol && e && e.renderer && c && !r.is11xService) {\n      const t = e.renderer,\n            i = await t.getSymbolAsync(a);\n      if (!i) continue;\n      h.symbol = i.toJSON(), \"hasVisualVariables\" in t && t.hasVisualVariables() && C(h.symbol, {\n        renderer: t,\n        graphic: a,\n        symbol: i\n      });\n    }\n\n    if (h.symbol && (h.symbol.angle || delete h.symbol.angle, Ve(h.symbol) ? h.symbol = await Le(h.symbol, r) : h.symbol.text && delete h.attributes), (!i || !i.forceFeatureAttributes) && null != (w = d) && w.length) {\n      const e = {};\n      d.forEach(t => {\n        h.attributes && h.attributes.hasOwnProperty(t) && (e[t] = h.attributes[t]);\n      }), h.attributes = e;\n    }\n\n    \"polygon\" === a.geometry.type ? n.featureSet.features.push(h) : \"polyline\" === a.geometry.type ? l.featureSet.features.push(h) : \"point\" === a.geometry.type ? h.symbol && h.symbol.text ? u.featureSet.features.push(h) : s.featureSet.features.push(h) : \"multipoint\" === a.geometry.type ? o.featureSet.features.push(h) : \"extent\" === a.geometry.type && (h.geometry = y.fromExtent(a.geometry).toJSON(), n.featureSet.features.push(h));\n  }\n\n  const S = [n, l, o, s, u].filter(e => e.featureSet.features.length > 0);\n\n  for (const y of S) {\n    const e = y.featureSet.features.every(e => e.symbol);\n    !e || i && i.forceFeatureAttributes || y.featureSet.features.forEach(e => {\n      delete e.attributes;\n    }), e && delete y.layerDefinition.drawingInfo, y.layerDefinition.drawingInfo && y.layerDefinition.drawingInfo.renderer && (await Te(y.layerDefinition.drawingInfo.renderer, r));\n  }\n\n  return S.length ? {\n    featureCollection: {\n      layers: S\n    },\n    showLabels: a\n  } : null;\n}\n\nasync function se(e, t, i) {\n  var r, a;\n  let n;\n  const l = e.renderer,\n        s = parseFloat(i.cimVersion);\n  if (e.featureReduction && (!i.is11xService || s < 2.9) || \"dot-density\" === (null == l ? void 0 : l.type) && (!i.is11xService || s < 2.6)) return ge(e, t, i);\n  e.legendEnabled && i.legendLayers.push({\n    id: e.id\n  });\n  const o = t.layerView,\n        {\n    printTemplate: u,\n    view: c\n  } = t,\n        y = l && (\"valueExpression\" in l && l.valueExpression || \"hasVisualVariables\" in l && l.hasVisualVariables()),\n        f = \"feature-layer\" !== (null == (r = e.source) ? void 0 : r.type) && \"ogc-feature\" !== (null == (a = e.source) ? void 0 : a.type);\n\n  if (!i.is11xService && y || o.filter || f || !l || \"field\" in l && null != l.field && (\"string\" != typeof l.field || !e.getField(l.field))) {\n    const t = await Ee(o);\n    n = await le(e, t, u, i);\n  } else {\n    var d, p;\n\n    if (n = {\n      id: (g = e.write()).id,\n      title: g.title,\n      opacity: g.opacity,\n      minScale: g.minScale,\n      maxScale: g.maxScale,\n      url: g.url,\n      layerType: g.layerType,\n      customParameters: g.customParameters,\n      layerDefinition: g.layerDefinition\n    }, n.showLabels = u.showLabels && e.labelsVisible, De(n, e), null != (d = n.layerDefinition) && null != (p = d.drawingInfo) && p.renderer && (delete n.layerDefinition.minScale, delete n.layerDefinition.maxScale, await Te(n.layerDefinition.drawingInfo.renderer, i), \"visualVariables\" in l && l.visualVariables && l.visualVariables[0])) {\n      const e = l.visualVariables[0];\n\n      if (\"size\" === e.type && e.maxSize && \"number\" != typeof e.maxSize && e.minSize && \"number\" != typeof e.minSize) {\n        const t = m(e, c.scale);\n        n.layerDefinition.drawingInfo.renderer.visualVariables[0].minSize = t.minSize, n.layerDefinition.drawingInfo.renderer.visualVariables[0].maxSize = t.maxSize;\n      }\n    }\n\n    const t = B(o);\n    t && (n.layerDefinition || (n.layerDefinition = {}), n.layerDefinition.definitionExpression = n.layerDefinition.definitionExpression ? `(${n.layerDefinition.definitionExpression}) AND (${t})` : t);\n  }\n\n  var g;\n  return n;\n}\n\nasync function oe(e, _ref, r) {\n  let {\n    layerView: t,\n    printTemplate: i\n  } = _ref;\n  e.legendEnabled && r.legendLayers.push({\n    id: e.id\n  });\n  return le(e, await Ee(t), i, r);\n}\n\nasync function ue(e, _ref2, i) {\n  let {\n    printTemplate: t\n  } = _ref2;\n  return le(e, null, t, i);\n}\n\nfunction ce(e, t) {\n  e.legendEnabled && t.legendLayers.push({\n    id: e.id\n  });\n  const i = {\n    layerType: (r = e.write()).layerType,\n    customParameters: r.customParameters\n  };\n  var r;\n  if (i.bandIds = e.bandIds, i.compressionQuality = e.compressionQuality, i.format = e.format, i.interpolation = e.interpolation, (e.mosaicRule || e.definitionExpression) && (i.mosaicRule = e.exportImageServiceParameters.mosaicRule.toJSON()), e.renderingRule || e.renderer) if (t.is11xService) e.renderingRule && (i.renderingRule = e.renderingRule.toJSON()), e.renderer && (i.layerDefinition = i.layerDefinition || {}, i.layerDefinition.drawingInfo = i.layerDefinition.drawingInfo || {}, i.layerDefinition.drawingInfo.renderer = e.renderer.toJSON());else {\n    const t = e.exportImageServiceParameters.combineRendererWithRenderingRule();\n    t && (i.renderingRule = t.toJSON());\n  }\n  return De(i, e), i;\n}\n\nasync function ye(e, t, i) {\n  var r;\n  if (\"flow\" === (null == (r = e.renderer) ? void 0 : r.type)) return ge(e, t, i);\n  e.legendEnabled && i.legendLayers.push({\n    id: e.id\n  });\n  const a = {\n    bandIds: (n = e.write() || {}).bandIds,\n    customParameters: n.customParameters,\n    interpolation: n.interpolation,\n    layerDefinition: n.layerDefinition\n  };\n  var n;\n  return a.layerType = \"ArcGISImageServiceLayer\", De(a, e), a;\n}\n\nasync function fe(e, t, i) {\n  const r = t.printTemplate;\n\n  if (i.is11xService) {\n    const t = {\n      type: \"kml\"\n    };\n    return e.write(t, {\n      origin: \"web-map\"\n    }), delete t.layerType, t.url = u(e.url), t;\n  }\n\n  {\n    const a = [],\n          n = t.layerView;\n    n.allVisibleMapImages.forEach((t, i) => {\n      const r = {\n        id: `${e.id}_image${i}`,\n        type: \"image\",\n        title: e.id,\n        minScale: e.minScale || 0,\n        maxScale: e.maxScale || 0,\n        opacity: e.opacity,\n        extent: t.extent\n      };\n      \"data:image/png;base64,\" === t.href.substr(0, 22) ? r.imageData = t.href.substr(22) : r.url = t.href, a.push(r);\n    });\n    const l = [...n.allVisiblePoints.items, ...n.allVisiblePolylines.items, ...n.allVisiblePolygons.items],\n          s = {\n      id: e.id,\n      ...(await le(null, l, r, i))\n    };\n    return a.push(s), a;\n  }\n}\n\nfunction me(e, _ref3, i) {\n  let {\n    view: t\n  } = _ref3;\n  let r;\n  const a = {\n    id: e.id,\n    subLayerIds: []\n  };\n  let n = [];\n\n  const l = t.scale,\n        s = e => {\n    const t = 0 === l,\n          i = 0 === e.minScale || l <= e.minScale,\n          r = 0 === e.maxScale || l >= e.maxScale;\n    if (e.visible && (t || i && r)) if (e.sublayers) e.sublayers.forEach(s);else {\n      const t = e.toExportImageJSON(),\n            i = {\n        id: e.id,\n        name: e.title,\n        layerDefinition: {\n          drawingInfo: t.drawingInfo,\n          definitionExpression: t.definitionExpression,\n          source: t.source\n        }\n      };\n      n.unshift(i), a.subLayerIds.push(e.id);\n    }\n  };\n\n  var o;\n  return e.sublayers && e.sublayers.forEach(s), n.length && (n = n.map(_ref4 => {\n    let {\n      id: e,\n      name: t,\n      layerDefinition: i\n    } = _ref4;\n    return {\n      id: e,\n      name: t,\n      layerDefinition: i\n    };\n  }), r = {\n    layerType: (o = e.write()).layerType,\n    customParameters: o.customParameters\n  }, r.layers = n, r.visibleLayers = e.capabilities.exportMap.supportsDynamicLayers ? void 0 : a.subLayerIds, De(r, e), e.legendEnabled && i.legendLayers.push(a)), r;\n}\n\nasync function de(_ref5, i) {\n  let {\n    layerView: e,\n    printTemplate: t\n  } = _ref5;\n  const r = [],\n        a = e.layer;\n  if (n(a.featureCollections)) for (const n of a.featureCollections) {\n    const e = await le(n, n.source, t, i);\n    e && r.push(...e.featureCollection.layers);\n  } else if (n(a.sublayers)) for (const n of a.sublayers) {\n    const e = await le(null, n.graphics, t, i);\n    e && r.push(...e.featureCollection.layers);\n  }\n  return {\n    featureCollection: {\n      layers: r\n    }\n  };\n}\n\nfunction pe() {\n  return {\n    type: \"OpenStreetMap\"\n  };\n}\n\nasync function ge(e, _ref6, r) {\n  let {\n    printTemplate: t,\n    view: i\n  } = _ref6;\n  const a = {\n    type: \"image\"\n  },\n        n = {\n    format: \"png\",\n    ignoreBackground: !0,\n    layers: [e],\n    rotation: 0\n  },\n        s = r.ssExtent || i.extent.clone();\n  let o = 96,\n      u = !0,\n      y = !0;\n\n  if (t.exportOptions) {\n    const e = t.exportOptions;\n    e.dpi > 0 && (o = e.dpi), e.width > 0 && (u = e.width % 2 == i.width % 2), e.height > 0 && (y = e.height % 2 == i.height % 2);\n  }\n\n  if (\"map-only\" === t.layout && t.scalePreserved && (!t.outScale || t.outScale === i.scale) && 96 === o && (!u || !y) && (n.area = {\n    x: 0,\n    y: 0,\n    width: i.width,\n    height: i.height\n  }, u || (n.area.width -= 1), y || (n.area.height -= 1), !r.ssExtent)) {\n    const e = i.toMap(l(n.area.width, n.area.height));\n    s.ymin = e.y, s.xmax = e.x, r.ssExtent = s;\n  }\n\n  a.extent = s.clone()._normalize(!0).toJSON();\n  const f = await i.takeScreenshot(n),\n        {\n    data: m\n  } = c(f.dataUrl);\n  return a.imageData = m, a;\n}\n\nasync function be(e, _ref7, r) {\n  let {\n    layerView: t,\n    printTemplate: i\n  } = _ref7;\n  e.legendEnabled && r.legendLayers.push({\n    id: e.id\n  });\n  return le(e, await Ee(t), i, r);\n}\n\nfunction he(e, t) {\n  e.legendEnabled && t.legendLayers.push({\n    id: e.id\n  });\n  const i = {\n    layerType: (r = e.write()).layerType,\n    customParameters: r.customParameters\n  };\n  var r;\n  return De(i, e), i;\n}\n\nasync function we(e, t, i) {\n  if (i.is11xService && e.serviceUrl && e.styleUrl) {\n    const t = Ie(e.styleUrl, e.apiKey),\n          r = Ie(e.serviceUrl, e.apiKey);\n\n    if (!t && !r || \"2.1.0\" !== i.cimVersion) {\n      const i = {\n        type: \"VectorTileLayer\"\n      };\n      return i.styleUrl = u(e.styleUrl), i.token = t, r !== t && (i.additionalTokens = [{\n        url: e.serviceUrl,\n        token: r\n      }]), i;\n    }\n  }\n\n  return ge(e, t, i);\n}\n\nfunction Se(e) {\n  const t = {\n    type: \"WebTiledLayer\",\n    urlTemplate: e.urlTemplate.replace(/\\${/g, \"{\"),\n    credits: e.copyright\n  };\n  return e.subDomains && e.subDomains.length > 0 && (t.subDomains = e.subDomains), t;\n}\n\nfunction xe(e) {\n  let t;\n\n  const i = [],\n        r = e => {\n    e.visible && (e.sublayers ? e.sublayers.forEach(r) : e.name && i.unshift(e.name));\n  };\n\n  return e.sublayers && e.sublayers.forEach(r), i.length && (t = {\n    type: \"wms\",\n    customLayerParameters: e.customLayerParameters,\n    customParameters: e.customParameters,\n    transparentBackground: e.imageTransparency,\n    visibleLayers: i,\n    url: u(e.url),\n    version: e.version\n  }), t;\n}\n\nfunction ve(e) {\n  const t = e.activeLayer;\n  return {\n    type: \"wmts\",\n    customLayerParameters: e.customLayerParameters,\n    customParameters: e.customParameters,\n    format: t.imageFormat,\n    layer: t.id,\n    style: t.styleId,\n    tileMatrixSet: t.tileMatrixSetId,\n    url: u(e.url)\n  };\n}\n\nfunction De(e, t) {\n  t.url && (e.url = u(e.url || t.url), e.token = Ie(e.url, t.apiKey));\n}\n\nfunction Ie(i, r) {\n  var a, n;\n  return W(i) && (r || e.apiKey) ? r || e.apiKey : null == (a = t) || null == (n = a.findCredential(i)) ? void 0 : n.token;\n}\n\nasync function Le(e, t) {\n  t.canvas || (t.canvas = document.createElement(\"canvas\"));\n  const r = 1024;\n  t.canvas.width = r, t.canvas.height = r;\n  const a = t.canvas.getContext(\"2d\");\n  let n, l;\n\n  if (e.path) {\n    var u;\n    const t = new Path2D(e.path);\n    t.closePath(), a.fillStyle = Array.isArray(e.color) ? `rgba(${e.color[0]},${e.color[1]},${e.color[2]},${e.color[3] / 255})` : \"rgb(0,0,0)\", a.fill(t);\n    const i = k(a);\n    if (!i) return null;\n    a.clearRect(0, 0, r, r);\n    const o = s(e.size) / Math.max(i.width, i.height);\n    a.scale(o, o);\n    const c = r / o,\n          y = c / 2 - i.width / 2 - i.x,\n          f = c / 2 - i.height / 2 - i.y;\n\n    if (a.translate(y, f), Array.isArray(e.color) && a.fill(t), null != (u = e.outline) && u.width && Array.isArray(e.outline.color)) {\n      const r = e.outline;\n      a.lineWidth = s(r.width) / o, a.lineJoin = \"round\", a.strokeStyle = `rgba(${r.color[0]},${r.color[1]},${r.color[2]},${r.color[3] / 255})`, a.stroke(t), i.width += a.lineWidth, i.height += a.lineWidth;\n    }\n\n    i.width *= o, i.height *= o;\n    const m = a.getImageData(r / 2 - i.width / 2, r / 2 - i.height / 2, Math.ceil(i.width), Math.ceil(i.height));\n    n = m.width, l = m.height, a.canvas.width = n, a.canvas.height = l, a.putImageData(m, 0, 0);\n  } else {\n    const t = \"image/svg+xml\" === e.contentType ? \"data:image/svg+xml;base64,\" + e.imageData : e.url,\n          r = (await i(t, {\n      responseType: \"image\"\n    })).data;\n    n = s(e.width), l = s(e.height), a.canvas.width = n, a.canvas.height = l, a.drawImage(r, 0, 0, a.canvas.width, a.canvas.height);\n  }\n\n  return {\n    type: \"esriPMS\",\n    imageData: a.canvas.toDataURL(\"image/png\").substr(22),\n    angle: e.angle,\n    contentType: \"image/png\",\n    height: o(l),\n    width: o(n),\n    xoffset: e.xoffset,\n    yoffset: e.yoffset\n  };\n}\n\nasync function Te(e, t) {\n  const i = e.type;\n  if (\"simple\" === i && Ve(e.symbol)) e.symbol = await Le(e.symbol, t);else if (\"uniqueValue\" === i || \"classBreaks\" === i) {\n    Ve(e.defaultSymbol) && (e.defaultSymbol = await Le(e.defaultSymbol, t));\n    const r = e[\"uniqueValue\" === i ? \"uniqueValueInfos\" : \"classBreakInfos\"];\n    if (r) for (const e of r) Ve(e.symbol) && (e.symbol = await Le(e.symbol, t));\n  }\n}\n\nasync function Ee(e) {\n  return e.queryFeatures(e.createQuery()).then(e => e.features);\n}\n\nfunction Me(e) {\n  return e.gpMetadata && e.gpMetadata.executionType ? H.fromJSON(e.gpMetadata.executionType) : \"sync\";\n}\n\nfunction Ve(e) {\n  return e && (e.path || \"image/svg+xml\" === e.contentType || e.url && e.url.endsWith(\".svg\"));\n}\n\nexport { Y as execute, ee as getGpPrintParams, ie as getGpServerUrl, Z as getMode, X as printCacheMap };","map":{"version":3,"sources":["D:/Github/CUSP_DataBase/CUSP_DB/src/main/gis/node_modules/@arcgis/core/rest/print.js"],"names":["e","id","t","i","r","JSONMap","a","isSome","n","createScreenPoint","l","pt2px","s","px2pt","o","normalize","u","dataComponents","c","y","collectLabelingFields","f","getSizeRangeAtScale","m","execute","d","submitJob","p","toJSON","g","b","getVisibleLayerViews","h","isGroupLayer","w","isScreenshotRequired","S","isBingMapsLayer","x","isCSVLayer","v","isFeatureLayer","D","isGeoJSONLayer","I","isGraphicsLayer","L","isImageryLayer","T","isImageryTileLayer","E","isKMLLayer","M","isMapImageLayer","V","isMapNotesLayer","O","isOpenStreetMapLayer","P","isStreamLayer","F","isTileLayer","N","isVectorTileLayer","R","isWebTileLayer","U","isWMSLayer","J","isWMTSLayer","j","isBlendLayer","A","applyVisualVariables","C","getContextBoundingBox","k","createPolygonLayer","z","createPolylineLayer","$","createPointLayer","K","createMultipointLayer","_","q","supportsApiKey","W","getFloorFilterClause","B","G","Feet","Kilometers","Meters","Miles","Q","esriFeet","esriKilometers","esriMeters","esriMiles","H","esriExecutionTypeSynchronous","esriExecutionTypeAsynchronous","X","Map","Y","ie","get","Promise","resolve","then","data","gpMetadata","gpServerUrl","is11xService","legendLayerNameMap","legendLayers","query","cimVersion","set","ee","Me","results","value","fetchResultData","waitForJobCompletion","interval","updateDelay","Z","template","showLabels","exportOptions","layout","dpi","toLowerCase","width","height","outputSize","layoutOptions","scalebarUnit","titleText","authorText","copyrightText","customTextElements","scaleBarOptions","metricUnit","metricLabel","nonMetricUnit","nonMetricLabel","map","layerId","title","subLayerIds","te","operationalLayers","RegExp","text","font","family","test","style","forEach","featureCollection","layers","layerDefinition","drawingInfo","renderer","symbol","type","featureSet","features","JSON","stringify","includes","outSpatialReference","mapOptions","spatialReference","Object","assign","legendOptions","slice","length","Web_Map_as_JSON","Format","format","Layout_Template","extraParameters","view","re","ssExtent","extent","isWrappable","clone","_normalize","showAttribution","attributionVisible","background","rotation","scalePreserved","scale","outScale","timeExtent","start","getTime","end","time","lastIndexOf","layerView","printTemplate","layer","loaded","ge","ae","ne","se","oe","ue","ce","ye","fe","me","de","pe","be","he","we","Se","xe","ve","Array","isArray","push","opacity","minScale","maxScale","blendMode","graphics","le","culture","key","legendEnabled","filter","Ee","write","origin","popupInfo","layerType","labelsVisible","name","declaredClass","items","labelingInfo","fieldsIndex","Set","collectRequiredFields","from","fields","getItemAt","visible","geometry","hasOwnProperty","popupTemplate","outline","color","valueExpression","hasVisualVariables","getSymbolAsync","graphic","angle","Ve","Le","attributes","forceFeatureAttributes","fromExtent","every","Te","parseFloat","featureReduction","source","field","getField","url","customParameters","De","visualVariables","maxSize","minSize","definitionExpression","bandIds","compressionQuality","interpolation","mosaicRule","exportImageServiceParameters","renderingRule","combineRendererWithRenderingRule","allVisibleMapImages","href","substr","imageData","allVisiblePoints","allVisiblePolylines","allVisiblePolygons","sublayers","toExportImageJSON","unshift","visibleLayers","capabilities","exportMap","supportsDynamicLayers","featureCollections","ignoreBackground","area","toMap","ymin","xmax","takeScreenshot","dataUrl","serviceUrl","styleUrl","Ie","apiKey","token","additionalTokens","urlTemplate","replace","credits","copyright","subDomains","customLayerParameters","transparentBackground","imageTransparency","version","activeLayer","imageFormat","styleId","tileMatrixSet","tileMatrixSetId","findCredential","canvas","document","createElement","getContext","path","Path2D","closePath","fillStyle","fill","clearRect","size","Math","max","translate","lineWidth","lineJoin","strokeStyle","stroke","getImageData","ceil","putImageData","contentType","responseType","drawImage","toDataURL","xoffset","yoffset","defaultSymbol","queryFeatures","createQuery","executionType","fromJSON","endsWith","getGpPrintParams","getGpServerUrl","getMode","printCacheMap"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport e from\"../config.js\";import{id as t}from\"../kernel.js\";import i from\"../request.js\";import r from\"../core/Error.js\";import{JSONMap as a}from\"../core/jsonMap.js\";import{isSome as n}from\"../core/maybe.js\";import{createScreenPoint as l,pt2px as s,px2pt as o}from\"../core/screenUtils.js\";import{normalize as u,dataComponents as c}from\"../core/urlUtils.js\";import y from\"../geometry/Polygon.js\";import{collectLabelingFields as f}from\"../layers/support/fieldUtils.js\";import{getSizeRangeAtScale as m}from\"../renderers/visualVariables/support/visualVariableUtils.js\";import{execute as d}from\"./geoprocessor/execute.js\";import{submitJob as p}from\"./geoprocessor/submitJob.js\";import{toJSON as g}from\"./support/fileFormat.js\";import{toJSON as b}from\"./support/layoutTemplate.js\";import{getVisibleLayerViews as h,isGroupLayer as w,isScreenshotRequired as S,isBingMapsLayer as x,isCSVLayer as v,isFeatureLayer as D,isGeoJSONLayer as I,isGraphicsLayer as L,isImageryLayer as T,isImageryTileLayer as E,isKMLLayer as M,isMapImageLayer as V,isMapNotesLayer as O,isOpenStreetMapLayer as P,isStreamLayer as F,isTileLayer as N,isVectorTileLayer as R,isWebTileLayer as U,isWMSLayer as J,isWMTSLayer as j,isBlendLayer as A,applyVisualVariables as C,getContextBoundingBox as k,createPolygonLayer as z,createPolylineLayer as $,createPointLayer as K,createMultipointLayer as _}from\"./support/printTaskUtils.js\";import q from\"./support/PrintTemplate.js\";import{supportsApiKey as W}from\"../support/apiKeyUtils.js\";import{getFloorFilterClause as B}from\"../views/support/floorFilterUtils.js\";const G={Feet:\"ft\",Kilometers:\"km\",Meters:\"m\",Miles:\"mi\"},Q=new a({esriFeet:\"Feet\",esriKilometers:\"Kilometers\",esriMeters:\"Meters\",esriMiles:\"Miles\"}),H=new a({esriExecutionTypeSynchronous:\"sync\",esriExecutionTypeAsynchronous:\"async\"}),X=new Map;async function Y(e,t,r){const a=ie(e);let n=X.get(a);return Promise.resolve().then((()=>n?{data:n.gpMetadata}:(n={gpServerUrl:a,is11xService:!1,legendLayerNameMap:{},legendLayers:[]},i(a,{query:{f:\"json\"}})))).then((e=>(n.gpMetadata=e.data,n.cimVersion=n.gpMetadata.cimVersion,n.is11xService=!!n.cimVersion,X.set(a,n),ee(t,n)))).then((i=>{const a=Me(n);let l;const s=e=>\"sync\"===a?e.results&&e.results[0]&&e.results[0].value:l.fetchResultData(\"Output_File\",null,r).then((e=>e.value));return\"async\"===a?p(e,i,null,r).then((e=>(l=e,e.waitForJobCompletion({interval:t.updateDelay}).then(s)))):d(e,i,null,r).then(s)}))}async function Z(e){const t=ie(e);return Me(X.get(t))}async function ee(e,t){t=t||{is11xService:!1,legendLayerNameMap:{},legendLayers:[]};const i=e.template||new q;null==i.showLabels&&(i.showLabels=!0);const a=i.exportOptions;let n;const l=b(i.layout);if(a){if(n={dpi:a.dpi},\"map_only\"===l.toLowerCase()||\"\"===l){const e=a.width,t=a.height;n.outputSize=[e,t]}}const s=i.layoutOptions;let o;if(s){let e,t;\"Miles\"===s.scalebarUnit||\"Kilometers\"===s.scalebarUnit?(e=\"Kilometers\",t=\"Miles\"):\"Meters\"!==s.scalebarUnit&&\"Feet\"!==s.scalebarUnit||(e=\"Meters\",t=\"Feet\"),o={titleText:s.titleText,authorText:s.authorText,copyrightText:s.copyrightText,customTextElements:s.customTextElements,scaleBarOptions:{metricUnit:Q.toJSON(e),metricLabel:G[e],nonMetricUnit:Q.toJSON(t),nonMetricLabel:G[t]}}}let u=null;null!=s&&s.legendLayers&&(u=s.legendLayers.map((e=>{t.legendLayerNameMap[e.layerId]=e.title;const i={id:e.layerId};return e.subLayerIds&&(i.subLayerIds=e.subLayerIds),i})));const c=await te(e,i,t);if(c.operationalLayers){const e=new RegExp(\"[\\\\u4E00-\\\\u9FFF\\\\u0E00-\\\\u0E7F\\\\u0900-\\\\u097F\\\\u3040-\\\\u309F\\\\u30A0-\\\\u30FF\\\\u31F0-\\\\u31FF]\"),i=/[\\u0600-\\u06FF]/,a=t=>{const r=t.text,a=t.font,n=a&&a.family&&a.family.toLowerCase();r&&a&&(\"arial\"===n||\"arial unicode ms\"===n)&&(a.family=e.test(r)?\"Arial Unicode MS\":\"Arial\",\"normal\"!==a.style&&i.test(r)&&(a.family=\"Arial Unicode MS\"))},n=()=>{throw new r(\"print:cim-symbol-unsupported\",\"CIMSymbol is not supported by a print service published from ArcMap\")};c.operationalLayers.forEach((e=>{var i,r,l;null!=(i=e.featureCollection)&&i.layers?e.featureCollection.layers.forEach((e=>{var i,r,l,s;if(null!=(i=e.layerDefinition)&&null!=(r=i.drawingInfo)&&null!=(l=r.renderer)&&l.symbol){const i=e.layerDefinition.drawingInfo.renderer;\"esriTS\"===i.symbol.type?a(i.symbol):\"CIMSymbolReference\"!==i.symbol.type||t.is11xService||n()}null!=(s=e.featureSet)&&s.features&&e.featureSet.features.forEach((e=>{e.symbol&&(\"esriTS\"===e.symbol.type?a(e.symbol):\"CIMSymbolReference\"!==e.symbol.type||t.is11xService||n())}))})):!t.is11xService&&null!=(r=e.layerDefinition)&&null!=(l=r.drawingInfo)&&l.renderer&&JSON.stringify(e.layerDefinition.drawingInfo.renderer).includes('\"type\":\"CIMSymbolReference\"')&&n()}))}e.outSpatialReference&&(c.mapOptions.spatialReference=e.outSpatialReference.toJSON()),Object.assign(c,{exportOptions:n,layoutOptions:o||{}}),Object.assign(c.layoutOptions,{legendOptions:{operationalLayers:null!=u?u:t.legendLayers.slice()}}),t.legendLayers.length=0,X.set(t.gpServerUrl,t);const y={Web_Map_as_JSON:JSON.stringify(c),Format:g(i.format),Layout_Template:l};return e.extraParameters&&Object.assign(y,e.extraParameters),y}async function te(e,t,i){const r=e.view;let a=r.spatialReference;const l={operationalLayers:await re(r,t,i)};let s=i.ssExtent||e.extent||r.extent;if(a&&a.isWrappable&&(s=s.clone()._normalize(!0),a=s.spatialReference),l.mapOptions={extent:s&&s.toJSON(),spatialReference:a&&a.toJSON(),showAttribution:t.attributionVisible},i.ssExtent=null,r.background&&(l.background=r.background.toJSON()),r.rotation&&(l.mapOptions.rotation=-r.rotation),t.scalePreserved&&(l.mapOptions.scale=t.outScale||r.scale),n(r.timeExtent)){const e=n(r.timeExtent.start)?r.timeExtent.start.getTime():null,t=n(r.timeExtent.end)?r.timeExtent.end.getTime():null;l.mapOptions.time=[e,t]}return l}function ie(e){let t=e;const i=t.lastIndexOf(\"/GPServer/\");return i>0&&(t=t.slice(0,i+9)),t}async function re(e,t,i){const r=[],a={layerView:null,printTemplate:t,view:e};let n=0;t.scalePreserved&&(n=t.outScale||e.scale);const l=h(e,n);for(const s of l){const e=s.layer;if(!e.loaded||w(e))continue;let t;a.layerView=s,t=S(s)?await ge(e,a,i):x(e)?ae(e):v(e)?await ne(e,a,i):D(e)?await se(e,a,i):I(e)?await oe(e,a,i):L(e)?await ue(e,a,i):T(e)?ce(e,i):E(e)?await ye(e,a,i):M(e)?await fe(e,a,i):V(e)?me(e,a,i):O(e)?await de(a,i):P(e)?pe():F(e)?await be(e,a,i):N(e)?he(e,i):R(e)?await we(e,a,i):U(e)?Se(e):J(e)?xe(e):j(e)?ve(e):await ge(e,a,i),t&&(Array.isArray(t)?r.push(...t):(t.id=e.id,t.title=i.legendLayerNameMap[e.id]||e.title,t.opacity=e.opacity,t.minScale=e.minScale||0,t.maxScale=e.maxScale||0,A(e)&&e.blendMode&&\"normal\"!==e.blendMode&&(t.blendMode=e.blendMode),r.push(t)))}if(n&&r.forEach((e=>{e.minScale=0,e.maxScale=0})),e.graphics&&e.graphics.length){const a=await le(null,e.graphics,t,i);a&&r.push(a)}return r}function ae(e){return{culture:e.culture,key:e.key,type:\"BingMaps\"+(\"aerial\"===e.style?\"Aerial\":\"hybrid\"===e.style?\"Hybrid\":\"Road\")}}async function ne(e,t,i){e.legendEnabled&&i.legendLayers.push({id:e.id});const r=t.layerView,a=t.printTemplate;let n;if(!i.is11xService||r.filter){return le(e,await Ee(r),a,i)}return n={type:\"CSV\"},e.write(n,{origin:\"web-map\"}),delete n.popupInfo,delete n.layerType,n.showLabels=a.showLabels&&e.labelsVisible,n}async function le(e,t,i,r){let a;const n=z(),l=$(),s=K(),o=_(),u=K();if(u.layerDefinition.name=\"textLayer\",delete u.layerDefinition.drawingInfo,e){if(\"esri.layers.FeatureLayer\"===e.declaredClass||\"esri.layers.StreamLayer\"===e.declaredClass?n.layerDefinition.name=l.layerDefinition.name=s.layerDefinition.name=o.layerDefinition.name=r.legendLayerNameMap[e.id]||e.get(\"arcgisProps.title\")||e.title:\"esri.layers.GraphicsLayer\"===e.declaredClass&&(t=e.graphics.items),e.renderer){const t=e.renderer.toJSON();n.layerDefinition.drawingInfo.renderer=t,l.layerDefinition.drawingInfo.renderer=t,s.layerDefinition.drawingInfo.renderer=t,o.layerDefinition.drawingInfo.renderer=t}if(i.showLabels&&e.labelsVisible&&\"function\"==typeof e.write){var c,m;const t=null==(c=e.write({},{origin:\"web-map\"}).layerDefinition)||null==(m=c.drawingInfo)?void 0:m.labelingInfo;t&&(a=!0,n.layerDefinition.drawingInfo.labelingInfo=t,l.layerDefinition.drawingInfo.labelingInfo=t,s.layerDefinition.drawingInfo.labelingInfo=t,o.layerDefinition.drawingInfo.labelingInfo=t)}}let d;null!=e&&e.renderer||a||(delete n.layerDefinition.drawingInfo,delete l.layerDefinition.drawingInfo,delete s.layerDefinition.drawingInfo,delete o.layerDefinition.drawingInfo);const p=null==e?void 0:e.fieldsIndex,g=null==e?void 0:e.renderer;if(p){const t=new Set;a&&await f(t,e),g&&\"function\"==typeof g.collectRequiredFields&&await g.collectRequiredFields(t,p),d=Array.from(t);const i=p.fields.map((e=>e.toJSON()));n.layerDefinition.fields=i,l.layerDefinition.fields=i,s.layerDefinition.fields=i,o.layerDefinition.fields=i}const b=t&&t.length;let h;for(let f=0;f<b;f++){var w;const a=t[f]||t.getItemAt(f);if(!1===a.visible||!a.geometry)continue;if(h=a.toJSON(),h.hasOwnProperty(\"popupTemplate\")&&delete h.popupTemplate,h.geometry&&h.geometry.z&&delete h.geometry.z,h.symbol&&h.symbol.outline&&\"esriCLS\"===h.symbol.outline.type&&!r.is11xService)continue;!r.is11xService&&h.symbol&&h.symbol.outline&&h.symbol.outline.color&&h.symbol.outline.color[3]&&(h.symbol.outline.color[3]=255);const c=e&&e.renderer&&(\"valueExpression\"in e.renderer&&e.renderer.valueExpression||\"hasVisualVariables\"in e.renderer&&e.renderer.hasVisualVariables());if(!h.symbol&&e&&e.renderer&&c&&!r.is11xService){const t=e.renderer,i=await t.getSymbolAsync(a);if(!i)continue;h.symbol=i.toJSON(),\"hasVisualVariables\"in t&&t.hasVisualVariables()&&C(h.symbol,{renderer:t,graphic:a,symbol:i})}if(h.symbol&&(h.symbol.angle||delete h.symbol.angle,Ve(h.symbol)?h.symbol=await Le(h.symbol,r):h.symbol.text&&delete h.attributes),(!i||!i.forceFeatureAttributes)&&null!=(w=d)&&w.length){const e={};d.forEach((t=>{h.attributes&&h.attributes.hasOwnProperty(t)&&(e[t]=h.attributes[t])})),h.attributes=e}\"polygon\"===a.geometry.type?n.featureSet.features.push(h):\"polyline\"===a.geometry.type?l.featureSet.features.push(h):\"point\"===a.geometry.type?h.symbol&&h.symbol.text?u.featureSet.features.push(h):s.featureSet.features.push(h):\"multipoint\"===a.geometry.type?o.featureSet.features.push(h):\"extent\"===a.geometry.type&&(h.geometry=y.fromExtent(a.geometry).toJSON(),n.featureSet.features.push(h))}const S=[n,l,o,s,u].filter((e=>e.featureSet.features.length>0));for(const y of S){const e=y.featureSet.features.every((e=>e.symbol));!e||i&&i.forceFeatureAttributes||y.featureSet.features.forEach((e=>{delete e.attributes})),e&&delete y.layerDefinition.drawingInfo,y.layerDefinition.drawingInfo&&y.layerDefinition.drawingInfo.renderer&&await Te(y.layerDefinition.drawingInfo.renderer,r)}return S.length?{featureCollection:{layers:S},showLabels:a}:null}async function se(e,t,i){var r,a;let n;const l=e.renderer,s=parseFloat(i.cimVersion);if(e.featureReduction&&(!i.is11xService||s<2.9)||\"dot-density\"===(null==l?void 0:l.type)&&(!i.is11xService||s<2.6))return ge(e,t,i);e.legendEnabled&&i.legendLayers.push({id:e.id});const o=t.layerView,{printTemplate:u,view:c}=t,y=l&&(\"valueExpression\"in l&&l.valueExpression||\"hasVisualVariables\"in l&&l.hasVisualVariables()),f=\"feature-layer\"!==(null==(r=e.source)?void 0:r.type)&&\"ogc-feature\"!==(null==(a=e.source)?void 0:a.type);if(!i.is11xService&&y||o.filter||f||!l||\"field\"in l&&null!=l.field&&(\"string\"!=typeof l.field||!e.getField(l.field))){const t=await Ee(o);n=await le(e,t,u,i)}else{var d,p;if(n={id:(g=e.write()).id,title:g.title,opacity:g.opacity,minScale:g.minScale,maxScale:g.maxScale,url:g.url,layerType:g.layerType,customParameters:g.customParameters,layerDefinition:g.layerDefinition},n.showLabels=u.showLabels&&e.labelsVisible,De(n,e),null!=(d=n.layerDefinition)&&null!=(p=d.drawingInfo)&&p.renderer&&(delete n.layerDefinition.minScale,delete n.layerDefinition.maxScale,await Te(n.layerDefinition.drawingInfo.renderer,i),\"visualVariables\"in l&&l.visualVariables&&l.visualVariables[0])){const e=l.visualVariables[0];if(\"size\"===e.type&&e.maxSize&&\"number\"!=typeof e.maxSize&&e.minSize&&\"number\"!=typeof e.minSize){const t=m(e,c.scale);n.layerDefinition.drawingInfo.renderer.visualVariables[0].minSize=t.minSize,n.layerDefinition.drawingInfo.renderer.visualVariables[0].maxSize=t.maxSize}}const t=B(o);t&&(n.layerDefinition||(n.layerDefinition={}),n.layerDefinition.definitionExpression=n.layerDefinition.definitionExpression?`(${n.layerDefinition.definitionExpression}) AND (${t})`:t)}var g;return n}async function oe(e,{layerView:t,printTemplate:i},r){e.legendEnabled&&r.legendLayers.push({id:e.id});return le(e,await Ee(t),i,r)}async function ue(e,{printTemplate:t},i){return le(e,null,t,i)}function ce(e,t){e.legendEnabled&&t.legendLayers.push({id:e.id});const i={layerType:(r=e.write()).layerType,customParameters:r.customParameters};var r;if(i.bandIds=e.bandIds,i.compressionQuality=e.compressionQuality,i.format=e.format,i.interpolation=e.interpolation,(e.mosaicRule||e.definitionExpression)&&(i.mosaicRule=e.exportImageServiceParameters.mosaicRule.toJSON()),e.renderingRule||e.renderer)if(t.is11xService)e.renderingRule&&(i.renderingRule=e.renderingRule.toJSON()),e.renderer&&(i.layerDefinition=i.layerDefinition||{},i.layerDefinition.drawingInfo=i.layerDefinition.drawingInfo||{},i.layerDefinition.drawingInfo.renderer=e.renderer.toJSON());else{const t=e.exportImageServiceParameters.combineRendererWithRenderingRule();t&&(i.renderingRule=t.toJSON())}return De(i,e),i}async function ye(e,t,i){var r;if(\"flow\"===(null==(r=e.renderer)?void 0:r.type))return ge(e,t,i);e.legendEnabled&&i.legendLayers.push({id:e.id});const a={bandIds:(n=e.write()||{}).bandIds,customParameters:n.customParameters,interpolation:n.interpolation,layerDefinition:n.layerDefinition};var n;return a.layerType=\"ArcGISImageServiceLayer\",De(a,e),a}async function fe(e,t,i){const r=t.printTemplate;if(i.is11xService){const t={type:\"kml\"};return e.write(t,{origin:\"web-map\"}),delete t.layerType,t.url=u(e.url),t}{const a=[],n=t.layerView;n.allVisibleMapImages.forEach(((t,i)=>{const r={id:`${e.id}_image${i}`,type:\"image\",title:e.id,minScale:e.minScale||0,maxScale:e.maxScale||0,opacity:e.opacity,extent:t.extent};\"data:image/png;base64,\"===t.href.substr(0,22)?r.imageData=t.href.substr(22):r.url=t.href,a.push(r)}));const l=[...n.allVisiblePoints.items,...n.allVisiblePolylines.items,...n.allVisiblePolygons.items],s={id:e.id,...await le(null,l,r,i)};return a.push(s),a}}function me(e,{view:t},i){let r;const a={id:e.id,subLayerIds:[]};let n=[];const l=t.scale,s=e=>{const t=0===l,i=0===e.minScale||l<=e.minScale,r=0===e.maxScale||l>=e.maxScale;if(e.visible&&(t||i&&r))if(e.sublayers)e.sublayers.forEach(s);else{const t=e.toExportImageJSON(),i={id:e.id,name:e.title,layerDefinition:{drawingInfo:t.drawingInfo,definitionExpression:t.definitionExpression,source:t.source}};n.unshift(i),a.subLayerIds.push(e.id)}};var o;return e.sublayers&&e.sublayers.forEach(s),n.length&&(n=n.map((({id:e,name:t,layerDefinition:i})=>({id:e,name:t,layerDefinition:i}))),r={layerType:(o=e.write()).layerType,customParameters:o.customParameters},r.layers=n,r.visibleLayers=e.capabilities.exportMap.supportsDynamicLayers?void 0:a.subLayerIds,De(r,e),e.legendEnabled&&i.legendLayers.push(a)),r}async function de({layerView:e,printTemplate:t},i){const r=[],a=e.layer;if(n(a.featureCollections))for(const n of a.featureCollections){const e=await le(n,n.source,t,i);e&&r.push(...e.featureCollection.layers)}else if(n(a.sublayers))for(const n of a.sublayers){const e=await le(null,n.graphics,t,i);e&&r.push(...e.featureCollection.layers)}return{featureCollection:{layers:r}}}function pe(){return{type:\"OpenStreetMap\"}}async function ge(e,{printTemplate:t,view:i},r){const a={type:\"image\"},n={format:\"png\",ignoreBackground:!0,layers:[e],rotation:0},s=r.ssExtent||i.extent.clone();let o=96,u=!0,y=!0;if(t.exportOptions){const e=t.exportOptions;e.dpi>0&&(o=e.dpi),e.width>0&&(u=e.width%2==i.width%2),e.height>0&&(y=e.height%2==i.height%2)}if(\"map-only\"===t.layout&&t.scalePreserved&&(!t.outScale||t.outScale===i.scale)&&96===o&&(!u||!y)&&(n.area={x:0,y:0,width:i.width,height:i.height},u||(n.area.width-=1),y||(n.area.height-=1),!r.ssExtent)){const e=i.toMap(l(n.area.width,n.area.height));s.ymin=e.y,s.xmax=e.x,r.ssExtent=s}a.extent=s.clone()._normalize(!0).toJSON();const f=await i.takeScreenshot(n),{data:m}=c(f.dataUrl);return a.imageData=m,a}async function be(e,{layerView:t,printTemplate:i},r){e.legendEnabled&&r.legendLayers.push({id:e.id});return le(e,await Ee(t),i,r)}function he(e,t){e.legendEnabled&&t.legendLayers.push({id:e.id});const i={layerType:(r=e.write()).layerType,customParameters:r.customParameters};var r;return De(i,e),i}async function we(e,t,i){if(i.is11xService&&e.serviceUrl&&e.styleUrl){const t=Ie(e.styleUrl,e.apiKey),r=Ie(e.serviceUrl,e.apiKey);if(!t&&!r||\"2.1.0\"!==i.cimVersion){const i={type:\"VectorTileLayer\"};return i.styleUrl=u(e.styleUrl),i.token=t,r!==t&&(i.additionalTokens=[{url:e.serviceUrl,token:r}]),i}}return ge(e,t,i)}function Se(e){const t={type:\"WebTiledLayer\",urlTemplate:e.urlTemplate.replace(/\\${/g,\"{\"),credits:e.copyright};return e.subDomains&&e.subDomains.length>0&&(t.subDomains=e.subDomains),t}function xe(e){let t;const i=[],r=e=>{e.visible&&(e.sublayers?e.sublayers.forEach(r):e.name&&i.unshift(e.name))};return e.sublayers&&e.sublayers.forEach(r),i.length&&(t={type:\"wms\",customLayerParameters:e.customLayerParameters,customParameters:e.customParameters,transparentBackground:e.imageTransparency,visibleLayers:i,url:u(e.url),version:e.version}),t}function ve(e){const t=e.activeLayer;return{type:\"wmts\",customLayerParameters:e.customLayerParameters,customParameters:e.customParameters,format:t.imageFormat,layer:t.id,style:t.styleId,tileMatrixSet:t.tileMatrixSetId,url:u(e.url)}}function De(e,t){t.url&&(e.url=u(e.url||t.url),e.token=Ie(e.url,t.apiKey))}function Ie(i,r){var a,n;return W(i)&&(r||e.apiKey)?r||e.apiKey:null==(a=t)||null==(n=a.findCredential(i))?void 0:n.token}async function Le(e,t){t.canvas||(t.canvas=document.createElement(\"canvas\"));const r=1024;t.canvas.width=r,t.canvas.height=r;const a=t.canvas.getContext(\"2d\");let n,l;if(e.path){var u;const t=new Path2D(e.path);t.closePath(),a.fillStyle=Array.isArray(e.color)?`rgba(${e.color[0]},${e.color[1]},${e.color[2]},${e.color[3]/255})`:\"rgb(0,0,0)\",a.fill(t);const i=k(a);if(!i)return null;a.clearRect(0,0,r,r);const o=s(e.size)/Math.max(i.width,i.height);a.scale(o,o);const c=r/o,y=c/2-i.width/2-i.x,f=c/2-i.height/2-i.y;if(a.translate(y,f),Array.isArray(e.color)&&a.fill(t),null!=(u=e.outline)&&u.width&&Array.isArray(e.outline.color)){const r=e.outline;a.lineWidth=s(r.width)/o,a.lineJoin=\"round\",a.strokeStyle=`rgba(${r.color[0]},${r.color[1]},${r.color[2]},${r.color[3]/255})`,a.stroke(t),i.width+=a.lineWidth,i.height+=a.lineWidth}i.width*=o,i.height*=o;const m=a.getImageData(r/2-i.width/2,r/2-i.height/2,Math.ceil(i.width),Math.ceil(i.height));n=m.width,l=m.height,a.canvas.width=n,a.canvas.height=l,a.putImageData(m,0,0)}else{const t=\"image/svg+xml\"===e.contentType?\"data:image/svg+xml;base64,\"+e.imageData:e.url,r=(await i(t,{responseType:\"image\"})).data;n=s(e.width),l=s(e.height),a.canvas.width=n,a.canvas.height=l,a.drawImage(r,0,0,a.canvas.width,a.canvas.height)}return{type:\"esriPMS\",imageData:a.canvas.toDataURL(\"image/png\").substr(22),angle:e.angle,contentType:\"image/png\",height:o(l),width:o(n),xoffset:e.xoffset,yoffset:e.yoffset}}async function Te(e,t){const i=e.type;if(\"simple\"===i&&Ve(e.symbol))e.symbol=await Le(e.symbol,t);else if(\"uniqueValue\"===i||\"classBreaks\"===i){Ve(e.defaultSymbol)&&(e.defaultSymbol=await Le(e.defaultSymbol,t));const r=e[\"uniqueValue\"===i?\"uniqueValueInfos\":\"classBreakInfos\"];if(r)for(const e of r)Ve(e.symbol)&&(e.symbol=await Le(e.symbol,t))}}async function Ee(e){return e.queryFeatures(e.createQuery()).then((e=>e.features))}function Me(e){return e.gpMetadata&&e.gpMetadata.executionType?H.fromJSON(e.gpMetadata.executionType):\"sync\"}function Ve(e){return e&&(e.path||\"image/svg+xml\"===e.contentType||e.url&&e.url.endsWith(\".svg\"))}export{Y as execute,ee as getGpPrintParams,ie as getGpServerUrl,Z as getMode,X as printCacheMap};\n"]},"metadata":{},"sourceType":"module"}