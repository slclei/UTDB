{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport { isSome as e } from \"../../../../core/maybe.js\";\nimport { c as t } from \"../../../../chunks/mat3f64.js\";\nimport { s, g as i, n as r, f as a, l as n, a as o, d as l, t as c } from \"../../../../chunks/vec3.js\";\nimport { c as h, f as u } from \"../../../../chunks/vec3f64.js\";\nimport { ViewingMode as p } from \"../../../ViewingMode.js\";\nimport { newLayout as m } from \"../../support/buffer/InterleavedLayout.js\";\nimport { ShaderOutput as d } from \"../core/shaderLibrary/ShaderOutputOptions.js\";\nimport { NormalsDoubleSidedMode as f } from \"../core/shaderLibrary/shading/Normals.glsl.js\";\nimport { defaultMaskAlphaCutoff as v } from \"../core/shaderLibrary/util/AlphaDiscard.glsl.js\";\nimport { CullFaceOptions as g, DepthTestFunction as T, AlphaDiscardMode as C } from \"../lib/basicInterfaces.js\";\nimport b from \"../lib/GLMaterialTexture.js\";\nimport { DefaultMaterialParameters as O, Material as x } from \"../lib/Material.js\";\nimport { OITPolygonOffsetLimit as S } from \"../lib/OrderIndependentTransparency.js\";\nimport { RenderPass as A } from \"../lib/RenderPass.js\";\nimport { RenderSlot as E } from \"../lib/RenderSlot.js\";\nimport { VertexAttribute as M } from \"../lib/VertexAttribute.js\";\nimport { getVerticalOffsetObject3D as q } from \"../lib/verticalOffsetUtils.js\";\nimport { writeDefaultAttributes as I } from \"./internal/bufferWriterUtils.js\";\nimport { verticalOffsetAtDistance as L, intersectTriangleGeometry as P } from \"./internal/MaterialUtil.js\";\nimport { DefaultMaterialTechniqueConfiguration as D, DefaultMaterialTechnique as R } from \"../shaders/DefaultMaterialTechnique.js\";\nimport { RealisticTreeTechnique as y } from \"../shaders/RealisticTreeTechnique.js\";\n\nclass _ extends x {\n  constructor(e) {\n    super(e, B), this.supportsEdges = !0, this.techniqueConfig = new D(), this.vertexBufferLayout = j(this.parameters), this.instanceBufferLayout = e.instanced ? H(this.parameters) : null;\n  }\n\n  isVisibleInPass(e) {\n    return e !== A.MATERIAL_DEPTH_SHADOWMAP_ALL && e !== A.MATERIAL_DEPTH_SHADOWMAP_DEFAULT && e !== A.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT || this.parameters.castShadows;\n  }\n\n  isVisible() {\n    const e = this.parameters;\n    if (!super.isVisible() || 0 === e.layerOpacity) return !1;\n    const t = e.instanced,\n          s = e.vertexColors,\n          i = e.symbolColors,\n          r = !!t && t.indexOf(\"color\") > -1,\n          a = e.vvColorEnabled,\n          n = \"replace\" === e.colorMixMode,\n          o = e.opacity > 0,\n          l = e.externalColor && e.externalColor[3] > 0;\n    return s && (r || a || i) ? !!n || o : s ? n ? l : o : r || a || i ? !!n || o : n ? l : o;\n  }\n\n  getTechniqueConfig(t, s) {\n    return this.techniqueConfig.output = t, this.techniqueConfig.hasNormalTexture = !!this.parameters.normalTextureId, this.techniqueConfig.hasColorTexture = !!this.parameters.textureId, this.techniqueConfig.vertexTangents = this.parameters.vertexTangents, this.techniqueConfig.instanced = !!this.parameters.instanced, this.techniqueConfig.instancedDoublePrecision = this.parameters.instancedDoublePrecision, this.techniqueConfig.vvSize = this.parameters.vvSizeEnabled, this.techniqueConfig.verticalOffset = null !== this.parameters.verticalOffset, this.techniqueConfig.screenSizePerspective = null !== this.parameters.screenSizePerspective, this.techniqueConfig.slicePlaneEnabled = this.parameters.slicePlaneEnabled, this.techniqueConfig.sliceHighlightDisabled = this.parameters.sliceHighlightDisabled, this.techniqueConfig.alphaDiscardMode = this.parameters.textureAlphaMode, this.techniqueConfig.normalsTypeDerivate = \"screenDerivative\" === this.parameters.normals, this.techniqueConfig.transparent = this.parameters.transparent, this.techniqueConfig.writeDepth = this.parameters.writeDepth, e(this.parameters.customDepthTest) && (this.techniqueConfig.customDepthTest = this.parameters.customDepthTest), this.techniqueConfig.sceneHasOcludees = this.parameters.sceneHasOcludees, this.techniqueConfig.cullFace = this.parameters.slicePlaneEnabled ? g.None : this.parameters.cullFace, this.techniqueConfig.multipassTerrainEnabled = s.multipassTerrainEnabled, this.techniqueConfig.cullAboveGround = s.cullAboveGround, this.techniqueConfig.hasModelTransformation = e(this.parameters.modelTransformation), t !== d.Color && t !== d.Alpha || (this.techniqueConfig.vertexColors = this.parameters.vertexColors, this.techniqueConfig.symbolColors = this.parameters.symbolColors, this.parameters.treeRendering ? this.techniqueConfig.doubleSidedMode = f.WindingOrder : this.techniqueConfig.doubleSidedMode = this.parameters.doubleSided && \"normal\" === this.parameters.doubleSidedType ? f.View : this.parameters.doubleSided && \"winding-order\" === this.parameters.doubleSidedType ? f.WindingOrder : f.None, this.techniqueConfig.instancedColor = !!this.parameters.instanced && this.parameters.instanced.indexOf(\"color\") > -1, this.techniqueConfig.receiveShadows = this.parameters.receiveShadows && this.parameters.shadowMappingEnabled, this.techniqueConfig.receiveAmbientOcclusion = !!s.ssaoEnabled && this.parameters.receiveSSAO, this.techniqueConfig.vvColor = this.parameters.vvColorEnabled, this.techniqueConfig.textureAlphaPremultiplied = !!this.parameters.textureAlphaPremultiplied, this.techniqueConfig.usePBR = this.parameters.usePBR, this.techniqueConfig.hasMetalnessAndRoughnessTexture = !!this.parameters.metallicRoughnessTextureId, this.techniqueConfig.hasEmissionTexture = !!this.parameters.emissiveTextureId, this.techniqueConfig.hasOcclusionTexture = !!this.parameters.occlusionTextureId, this.techniqueConfig.offsetBackfaces = !(!this.parameters.transparent || !this.parameters.offsetTransparentBackfaces), this.techniqueConfig.isSchematic = this.parameters.usePBR && this.parameters.isSchematic, this.techniqueConfig.transparencyPassType = s.transparencyPassType, this.techniqueConfig.enableOffset = s.camera.relativeElevation < S), this.techniqueConfig;\n  }\n\n  intersect(e, t, h, u, m, d, f) {\n    if (null !== this.parameters.verticalOffset) {\n      const e = u.camera;\n      s(U, h[12], h[13], h[14]);\n      let t = null;\n\n      switch (u.viewingMode) {\n        case p.Global:\n          t = r(k, U);\n          break;\n\n        case p.Local:\n          t = i(k, V);\n      }\n\n      let f = 0;\n\n      if (null !== this.parameters.verticalOffset) {\n        const s = a(W, U, e.eye),\n              i = n(s),\n              r = o(s, s, 1 / i);\n        let c = null;\n        this.parameters.screenSizePerspective && (c = l(t, r)), f += L(e, i, this.parameters.verticalOffset, c, this.parameters.screenSizePerspective);\n      }\n\n      o(t, t, f), c(F, t, u.transform.inverseRotation), m = a(z, m, F), d = a(G, d, F);\n    }\n\n    P(e, t, u, m, d, q(u.verticalOffset), f);\n  }\n\n  requiresSlot(e) {\n    return e === (this.parameters.transparent ? this.parameters.writeDepth ? E.TRANSPARENT_MATERIAL : E.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL : E.OPAQUE_MATERIAL) || e === E.DRAPED_MATERIAL;\n  }\n\n  createGLMaterial(e) {\n    return e.output === d.Color || e.output === d.Alpha || e.output === d.Depth || e.output === d.Normal || e.output === d.Shadow || e.output === d.Highlight ? new w(e) : null;\n  }\n\n  createBufferWriter() {\n    return new N(this.vertexBufferLayout, this.instanceBufferLayout);\n  }\n\n}\n\nclass w extends b {\n  constructor(e) {\n    super({ ...e,\n      ...e.material.parameters\n    });\n  }\n\n  updateParameters(e) {\n    const t = this._material.parameters;\n    return this.updateTexture(t.textureId), this.ensureTechnique(t.treeRendering ? y : R, e);\n  }\n\n  _updateShadowState(e) {\n    e.shadowMappingEnabled !== this._material.parameters.shadowMappingEnabled && this._material.setParameters({\n      shadowMappingEnabled: e.shadowMappingEnabled\n    });\n  }\n\n  _updateOccludeeState(e) {\n    e.hasOccludees !== this._material.parameters.sceneHasOcludees && this._material.setParameters({\n      sceneHasOcludees: e.hasOccludees\n    });\n  }\n\n  beginSlot(e) {\n    return this._output !== d.Color && this._output !== d.Alpha || (this._updateShadowState(e), this._updateOccludeeState(e)), this.updateParameters(e);\n  }\n\n  bind(e, t) {\n    t.bindPass(this._material.parameters, e), this.bindTextures(t.program);\n  }\n\n}\n\nconst B = {\n  textureId: void 0,\n  initTextureTransparent: !1,\n  isSchematic: !1,\n  usePBR: !1,\n  normalTextureId: void 0,\n  vertexTangents: !1,\n  occlusionTextureId: void 0,\n  emissiveTextureId: void 0,\n  metallicRoughnessTextureId: void 0,\n  emissiveFactor: [0, 0, 0],\n  mrrFactors: [0, 1, .5],\n  ambient: [.2, .2, .2],\n  diffuse: [.8, .8, .8],\n  externalColor: [1, 1, 1, 1],\n  colorMixMode: \"multiply\",\n  opacity: 1,\n  layerOpacity: 1,\n  vertexColors: !1,\n  symbolColors: !1,\n  doubleSided: !1,\n  doubleSidedType: \"normal\",\n  cullFace: g.Back,\n  instanced: void 0,\n  instancedDoublePrecision: !1,\n  normals: \"default\",\n  receiveSSAO: !0,\n  fillLightsEnabled: !0,\n  receiveShadows: !0,\n  castShadows: !0,\n  shadowMappingEnabled: !1,\n  verticalOffset: null,\n  screenSizePerspective: null,\n  slicePlaneEnabled: !1,\n  sliceHighlightDisabled: !1,\n  offsetTransparentBackfaces: !1,\n  vvSizeEnabled: !1,\n  vvSizeMinSize: [1, 1, 1],\n  vvSizeMaxSize: [100, 100, 100],\n  vvSizeOffset: [0, 0, 0],\n  vvSizeFactor: [1, 1, 1],\n  vvSizeValue: [1, 1, 1],\n  vvColorEnabled: !1,\n  vvColorValues: [0, 0, 0, 0, 0, 0, 0, 0],\n  vvColorColors: [1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0],\n  vvSymbolAnchor: [0, 0, 0],\n  vvSymbolRotationMatrix: t(),\n  modelTransformation: null,\n  transparent: !1,\n  writeDepth: !0,\n  customDepthTest: T.Less,\n  textureAlphaMode: C.Blend,\n  textureAlphaCutoff: v,\n  textureAlphaPremultiplied: !1,\n  sceneHasOcludees: !1,\n  ...O\n};\n\nclass N {\n  constructor(e, t) {\n    this.vertexBufferLayout = e, this.instanceBufferLayout = t;\n  }\n\n  allocate(e) {\n    return this.vertexBufferLayout.createBuffer(e);\n  }\n\n  elementCount(e) {\n    return e.indices.get(M.POSITION).length;\n  }\n\n  write(e, t, s, i) {\n    I(t, this.vertexBufferLayout, e.transformation, e.invTranspTransformation, s, i);\n  }\n\n}\n\nfunction j(e) {\n  const t = e.textureId || e.normalTextureId || e.metallicRoughnessTextureId || e.emissiveTextureId || e.occlusionTextureId,\n        s = m().vec3f(M.POSITION).vec3f(M.NORMAL);\n  return e.vertexTangents && s.vec4f(M.TANGENT), t && s.vec2f(M.UV0), e.vertexColors && s.vec4u8(M.COLOR), e.symbolColors && s.vec4u8(M.SYMBOLCOLOR), s;\n}\n\nfunction H(e) {\n  let t = m();\n  return t = e.instancedDoublePrecision ? t.vec3f(M.MODELORIGINHI).vec3f(M.MODELORIGINLO).mat3f(M.MODEL).mat3f(M.MODELNORMAL) : t.mat4f(M.MODEL).mat4f(M.MODELNORMAL), e.instanced && e.instanced.indexOf(\"color\") > -1 && (t = t.vec4f(M.INSTANCECOLOR)), e.instanced && e.instanced.indexOf(\"featureAttribute\") > -1 && (t = t.vec4f(M.INSTANCEFEATUREATTRIBUTE)), t;\n}\n\nconst z = h(),\n      G = h(),\n      V = u(0, 0, 1),\n      k = h(),\n      F = h(),\n      U = h(),\n      W = h();\nexport { _ as DefaultMaterial, H as getInstanceBufferLayout };","map":{"version":3,"sources":["D:/Github/CUSP_DataBase/CUSP_DB/src/main/gis/node_modules/@arcgis/core/views/3d/webgl-engine/materials/DefaultMaterial.js"],"names":["isSome","e","c","t","s","g","i","n","r","f","a","l","o","d","h","u","ViewingMode","p","newLayout","m","ShaderOutput","NormalsDoubleSidedMode","defaultMaskAlphaCutoff","v","CullFaceOptions","DepthTestFunction","T","AlphaDiscardMode","C","b","DefaultMaterialParameters","O","Material","x","OITPolygonOffsetLimit","S","RenderPass","A","RenderSlot","E","VertexAttribute","M","getVerticalOffsetObject3D","q","writeDefaultAttributes","I","verticalOffsetAtDistance","L","intersectTriangleGeometry","P","DefaultMaterialTechniqueConfiguration","D","DefaultMaterialTechnique","R","RealisticTreeTechnique","y","_","constructor","B","supportsEdges","techniqueConfig","vertexBufferLayout","j","parameters","instanceBufferLayout","instanced","H","isVisibleInPass","MATERIAL_DEPTH_SHADOWMAP_ALL","MATERIAL_DEPTH_SHADOWMAP_DEFAULT","MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT","castShadows","isVisible","layerOpacity","vertexColors","symbolColors","indexOf","vvColorEnabled","colorMixMode","opacity","externalColor","getTechniqueConfig","output","hasNormalTexture","normalTextureId","hasColorTexture","textureId","vertexTangents","instancedDoublePrecision","vvSize","vvSizeEnabled","verticalOffset","screenSizePerspective","slicePlaneEnabled","sliceHighlightDisabled","alphaDiscardMode","textureAlphaMode","normalsTypeDerivate","normals","transparent","writeDepth","customDepthTest","sceneHasOcludees","cullFace","None","multipassTerrainEnabled","cullAboveGround","hasModelTransformation","modelTransformation","Color","Alpha","treeRendering","doubleSidedMode","WindingOrder","doubleSided","doubleSidedType","View","instancedColor","receiveShadows","shadowMappingEnabled","receiveAmbientOcclusion","ssaoEnabled","receiveSSAO","vvColor","textureAlphaPremultiplied","usePBR","hasMetalnessAndRoughnessTexture","metallicRoughnessTextureId","hasEmissionTexture","emissiveTextureId","hasOcclusionTexture","occlusionTextureId","offsetBackfaces","offsetTransparentBackfaces","isSchematic","transparencyPassType","enableOffset","camera","relativeElevation","intersect","U","viewingMode","Global","k","Local","V","W","eye","F","transform","inverseRotation","z","G","requiresSlot","TRANSPARENT_MATERIAL","TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL","OPAQUE_MATERIAL","DRAPED_MATERIAL","createGLMaterial","Depth","Normal","Shadow","Highlight","w","createBufferWriter","N","material","updateParameters","_material","updateTexture","ensureTechnique","_updateShadowState","setParameters","_updateOccludeeState","hasOccludees","beginSlot","_output","bind","bindPass","bindTextures","program","initTextureTransparent","emissiveFactor","mrrFactors","ambient","diffuse","Back","fillLightsEnabled","vvSizeMinSize","vvSizeMaxSize","vvSizeOffset","vvSizeFactor","vvSizeValue","vvColorValues","vvColorColors","vvSymbolAnchor","vvSymbolRotationMatrix","Less","Blend","textureAlphaCutoff","allocate","createBuffer","elementCount","indices","get","POSITION","length","write","transformation","invTranspTransformation","vec3f","NORMAL","vec4f","TANGENT","vec2f","UV0","vec4u8","COLOR","SYMBOLCOLOR","MODELORIGINHI","MODELORIGINLO","mat3f","MODEL","MODELNORMAL","mat4f","INSTANCECOLOR","INSTANCEFEATUREATTRIBUTE","DefaultMaterial","getInstanceBufferLayout"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport{isSome as e}from\"../../../../core/maybe.js\";import{c as t}from\"../../../../chunks/mat3f64.js\";import{s,g as i,n as r,f as a,l as n,a as o,d as l,t as c}from\"../../../../chunks/vec3.js\";import{c as h,f as u}from\"../../../../chunks/vec3f64.js\";import{ViewingMode as p}from\"../../../ViewingMode.js\";import{newLayout as m}from\"../../support/buffer/InterleavedLayout.js\";import{ShaderOutput as d}from\"../core/shaderLibrary/ShaderOutputOptions.js\";import{NormalsDoubleSidedMode as f}from\"../core/shaderLibrary/shading/Normals.glsl.js\";import{defaultMaskAlphaCutoff as v}from\"../core/shaderLibrary/util/AlphaDiscard.glsl.js\";import{CullFaceOptions as g,DepthTestFunction as T,AlphaDiscardMode as C}from\"../lib/basicInterfaces.js\";import b from\"../lib/GLMaterialTexture.js\";import{DefaultMaterialParameters as O,Material as x}from\"../lib/Material.js\";import{OITPolygonOffsetLimit as S}from\"../lib/OrderIndependentTransparency.js\";import{RenderPass as A}from\"../lib/RenderPass.js\";import{RenderSlot as E}from\"../lib/RenderSlot.js\";import{VertexAttribute as M}from\"../lib/VertexAttribute.js\";import{getVerticalOffsetObject3D as q}from\"../lib/verticalOffsetUtils.js\";import{writeDefaultAttributes as I}from\"./internal/bufferWriterUtils.js\";import{verticalOffsetAtDistance as L,intersectTriangleGeometry as P}from\"./internal/MaterialUtil.js\";import{DefaultMaterialTechniqueConfiguration as D,DefaultMaterialTechnique as R}from\"../shaders/DefaultMaterialTechnique.js\";import{RealisticTreeTechnique as y}from\"../shaders/RealisticTreeTechnique.js\";class _ extends x{constructor(e){super(e,B),this.supportsEdges=!0,this.techniqueConfig=new D,this.vertexBufferLayout=j(this.parameters),this.instanceBufferLayout=e.instanced?H(this.parameters):null}isVisibleInPass(e){return e!==A.MATERIAL_DEPTH_SHADOWMAP_ALL&&e!==A.MATERIAL_DEPTH_SHADOWMAP_DEFAULT&&e!==A.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT||this.parameters.castShadows}isVisible(){const e=this.parameters;if(!super.isVisible()||0===e.layerOpacity)return!1;const t=e.instanced,s=e.vertexColors,i=e.symbolColors,r=!!t&&t.indexOf(\"color\")>-1,a=e.vvColorEnabled,n=\"replace\"===e.colorMixMode,o=e.opacity>0,l=e.externalColor&&e.externalColor[3]>0;return s&&(r||a||i)?!!n||o:s?n?l:o:r||a||i?!!n||o:n?l:o}getTechniqueConfig(t,s){return this.techniqueConfig.output=t,this.techniqueConfig.hasNormalTexture=!!this.parameters.normalTextureId,this.techniqueConfig.hasColorTexture=!!this.parameters.textureId,this.techniqueConfig.vertexTangents=this.parameters.vertexTangents,this.techniqueConfig.instanced=!!this.parameters.instanced,this.techniqueConfig.instancedDoublePrecision=this.parameters.instancedDoublePrecision,this.techniqueConfig.vvSize=this.parameters.vvSizeEnabled,this.techniqueConfig.verticalOffset=null!==this.parameters.verticalOffset,this.techniqueConfig.screenSizePerspective=null!==this.parameters.screenSizePerspective,this.techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled,this.techniqueConfig.sliceHighlightDisabled=this.parameters.sliceHighlightDisabled,this.techniqueConfig.alphaDiscardMode=this.parameters.textureAlphaMode,this.techniqueConfig.normalsTypeDerivate=\"screenDerivative\"===this.parameters.normals,this.techniqueConfig.transparent=this.parameters.transparent,this.techniqueConfig.writeDepth=this.parameters.writeDepth,e(this.parameters.customDepthTest)&&(this.techniqueConfig.customDepthTest=this.parameters.customDepthTest),this.techniqueConfig.sceneHasOcludees=this.parameters.sceneHasOcludees,this.techniqueConfig.cullFace=this.parameters.slicePlaneEnabled?g.None:this.parameters.cullFace,this.techniqueConfig.multipassTerrainEnabled=s.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=s.cullAboveGround,this.techniqueConfig.hasModelTransformation=e(this.parameters.modelTransformation),t!==d.Color&&t!==d.Alpha||(this.techniqueConfig.vertexColors=this.parameters.vertexColors,this.techniqueConfig.symbolColors=this.parameters.symbolColors,this.parameters.treeRendering?this.techniqueConfig.doubleSidedMode=f.WindingOrder:this.techniqueConfig.doubleSidedMode=this.parameters.doubleSided&&\"normal\"===this.parameters.doubleSidedType?f.View:this.parameters.doubleSided&&\"winding-order\"===this.parameters.doubleSidedType?f.WindingOrder:f.None,this.techniqueConfig.instancedColor=!!this.parameters.instanced&&this.parameters.instanced.indexOf(\"color\")>-1,this.techniqueConfig.receiveShadows=this.parameters.receiveShadows&&this.parameters.shadowMappingEnabled,this.techniqueConfig.receiveAmbientOcclusion=!!s.ssaoEnabled&&this.parameters.receiveSSAO,this.techniqueConfig.vvColor=this.parameters.vvColorEnabled,this.techniqueConfig.textureAlphaPremultiplied=!!this.parameters.textureAlphaPremultiplied,this.techniqueConfig.usePBR=this.parameters.usePBR,this.techniqueConfig.hasMetalnessAndRoughnessTexture=!!this.parameters.metallicRoughnessTextureId,this.techniqueConfig.hasEmissionTexture=!!this.parameters.emissiveTextureId,this.techniqueConfig.hasOcclusionTexture=!!this.parameters.occlusionTextureId,this.techniqueConfig.offsetBackfaces=!(!this.parameters.transparent||!this.parameters.offsetTransparentBackfaces),this.techniqueConfig.isSchematic=this.parameters.usePBR&&this.parameters.isSchematic,this.techniqueConfig.transparencyPassType=s.transparencyPassType,this.techniqueConfig.enableOffset=s.camera.relativeElevation<S),this.techniqueConfig}intersect(e,t,h,u,m,d,f){if(null!==this.parameters.verticalOffset){const e=u.camera;s(U,h[12],h[13],h[14]);let t=null;switch(u.viewingMode){case p.Global:t=r(k,U);break;case p.Local:t=i(k,V)}let f=0;if(null!==this.parameters.verticalOffset){const s=a(W,U,e.eye),i=n(s),r=o(s,s,1/i);let c=null;this.parameters.screenSizePerspective&&(c=l(t,r)),f+=L(e,i,this.parameters.verticalOffset,c,this.parameters.screenSizePerspective)}o(t,t,f),c(F,t,u.transform.inverseRotation),m=a(z,m,F),d=a(G,d,F)}P(e,t,u,m,d,q(u.verticalOffset),f)}requiresSlot(e){return e===(this.parameters.transparent?this.parameters.writeDepth?E.TRANSPARENT_MATERIAL:E.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:E.OPAQUE_MATERIAL)||e===E.DRAPED_MATERIAL}createGLMaterial(e){return e.output===d.Color||e.output===d.Alpha||e.output===d.Depth||e.output===d.Normal||e.output===d.Shadow||e.output===d.Highlight?new w(e):null}createBufferWriter(){return new N(this.vertexBufferLayout,this.instanceBufferLayout)}}class w extends b{constructor(e){super({...e,...e.material.parameters})}updateParameters(e){const t=this._material.parameters;return this.updateTexture(t.textureId),this.ensureTechnique(t.treeRendering?y:R,e)}_updateShadowState(e){e.shadowMappingEnabled!==this._material.parameters.shadowMappingEnabled&&this._material.setParameters({shadowMappingEnabled:e.shadowMappingEnabled})}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.sceneHasOcludees&&this._material.setParameters({sceneHasOcludees:e.hasOccludees})}beginSlot(e){return this._output!==d.Color&&this._output!==d.Alpha||(this._updateShadowState(e),this._updateOccludeeState(e)),this.updateParameters(e)}bind(e,t){t.bindPass(this._material.parameters,e),this.bindTextures(t.program)}}const B={textureId:void 0,initTextureTransparent:!1,isSchematic:!1,usePBR:!1,normalTextureId:void 0,vertexTangents:!1,occlusionTextureId:void 0,emissiveTextureId:void 0,metallicRoughnessTextureId:void 0,emissiveFactor:[0,0,0],mrrFactors:[0,1,.5],ambient:[.2,.2,.2],diffuse:[.8,.8,.8],externalColor:[1,1,1,1],colorMixMode:\"multiply\",opacity:1,layerOpacity:1,vertexColors:!1,symbolColors:!1,doubleSided:!1,doubleSidedType:\"normal\",cullFace:g.Back,instanced:void 0,instancedDoublePrecision:!1,normals:\"default\",receiveSSAO:!0,fillLightsEnabled:!0,receiveShadows:!0,castShadows:!0,shadowMappingEnabled:!1,verticalOffset:null,screenSizePerspective:null,slicePlaneEnabled:!1,sliceHighlightDisabled:!1,offsetTransparentBackfaces:!1,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvSizeValue:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],vvSymbolAnchor:[0,0,0],vvSymbolRotationMatrix:t(),modelTransformation:null,transparent:!1,writeDepth:!0,customDepthTest:T.Less,textureAlphaMode:C.Blend,textureAlphaCutoff:v,textureAlphaPremultiplied:!1,sceneHasOcludees:!1,...O};class N{constructor(e,t){this.vertexBufferLayout=e,this.instanceBufferLayout=t}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return e.indices.get(M.POSITION).length}write(e,t,s,i){I(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,s,i)}}function j(e){const t=e.textureId||e.normalTextureId||e.metallicRoughnessTextureId||e.emissiveTextureId||e.occlusionTextureId,s=m().vec3f(M.POSITION).vec3f(M.NORMAL);return e.vertexTangents&&s.vec4f(M.TANGENT),t&&s.vec2f(M.UV0),e.vertexColors&&s.vec4u8(M.COLOR),e.symbolColors&&s.vec4u8(M.SYMBOLCOLOR),s}function H(e){let t=m();return t=e.instancedDoublePrecision?t.vec3f(M.MODELORIGINHI).vec3f(M.MODELORIGINLO).mat3f(M.MODEL).mat3f(M.MODELNORMAL):t.mat4f(M.MODEL).mat4f(M.MODELNORMAL),e.instanced&&e.instanced.indexOf(\"color\")>-1&&(t=t.vec4f(M.INSTANCECOLOR)),e.instanced&&e.instanced.indexOf(\"featureAttribute\")>-1&&(t=t.vec4f(M.INSTANCEFEATUREATTRIBUTE)),t}const z=h(),G=h(),V=u(0,0,1),k=h(),F=h(),U=h(),W=h();export{_ as DefaultMaterial,H as getInstanceBufferLayout};\n"]},"metadata":{},"sourceType":"module"}