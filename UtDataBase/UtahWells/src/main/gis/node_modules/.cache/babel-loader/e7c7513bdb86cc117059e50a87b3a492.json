{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport { _ as t } from \"../../chunks/tslib.es6.js\";\nimport \"../../geometry.js\";\nimport { result as e } from \"../../core/asyncUtils.js\";\nimport i from \"../../core/Collection.js\";\nimport { HandleOwner as r } from \"../../core/HandleOwner.js\";\nimport { on as s, whenTrue as o } from \"../../core/watchUtils.js\";\nimport { property as n } from \"../../core/accessorSupport/decorators/property.js\";\nimport \"../../core/arrayUtils.js\";\nimport \"../../core/has.js\";\nimport \"../../core/accessorSupport/ensureType.js\";\nimport { subclass as a } from \"../../core/accessorSupport/decorators/subclass.js\";\nimport { extentContainsPoint as c } from \"../../geometry/support/contains.js\";\nimport { geographicToWebMercator as h, project as u } from \"../../geometry/support/webMercatorUtils.js\";\nimport l from \"../../geometry/SpatialReference.js\";\n\nfunction p(t, e) {\n  return t && \"copyright\" in t && (!e || \"function\" == typeof t.originOf && \"user\" === t.originOf(\"copyright\"));\n}\n\nfunction d(t, e) {\n  return t.length !== e.length || t.some((t, i) => t.text !== e[i].text);\n}\n\nfunction m(t, e, i) {\n  if (!i || !e) return;\n  t.find(t => t.layerView === e && t.text === i) || t.push({\n    text: i,\n    layerView: e\n  });\n}\n\nfunction f(t) {\n  return \"bing-maps\" === t.type;\n}\n\nconst b = [];\nlet y = class extends r {\n  constructor(t) {\n    super(t), this._clear = () => {\n      this._fetchedAttributionData.clear(), this._pendingAttributions.clear(), this.handles.remove(\"suspension\"), this.notifyChange(\"state\");\n    }, this._pendingAttributions = new Set(), this._fetchedAttributionData = new Map(), this.items = new i(), this.view = null, this._allLayerViewsChange = t => {\n      this.handles.remove(\"suspension\");\n      const e = this.get(\"view.allLayerViews\");\n      e && this.handles.add(e.map(t => t.watch([\"suspended\", \"attributionVisible\"], this._updateAttributionItems)), \"suspension\"), t && t.removed && t.removed.forEach(t => {\n        this._pendingAttributions.delete(t), this._fetchedAttributionData.delete(t);\n      }), this._updateAttributionItems();\n    }, this._updateAttributionItems = () => {\n      const t = this.get(\"view.allLayerViews\");\n      b.length = 0, t ? (t.forEach(t => {\n        if (t.suspended || !t.get(\"layer.attributionVisible\")) return;\n        const e = t.layer;\n        if (p(e, \"user\")) return void m(b, t, e.copyright);\n\n        if (e.hasAttributionData) {\n          if (this._fetchedAttributionData.has(t)) {\n            const i = this._fetchedAttributionData.get(t);\n\n            return void (i ? m(b, t, this._getDynamicAttribution(i, this.view, e)) : p(e) && m(b, t, e.copyright));\n          }\n\n          return void this._fetchAttributionData(t);\n        }\n\n        const i = e.get(\"portalItem.accessInformation\");\n        m(b, t, i || e.copyright);\n      }), d(this.items, b) && (this.items.removeAll(), this.items.addMany(b)), b.length = 0, this.notifyChange(\"state\")) : this._clear();\n    }, this.handles.add([s(this, \"view.allLayerViews\", \"change\", this._allLayerViewsChange, this._allLayerViewsChange, this._clear), o(this, \"view.stationary\", () => this._updateAttributionItems())]);\n  }\n\n  destroy() {\n    this.view = null, this._fetchedAttributionData.clear(), this._pendingAttributions.clear(), this.items.removeAll();\n  }\n\n  get state() {\n    return this.get(\"view.ready\") ? this._pendingAttributions.size > 0 ? \"loading\" : \"ready\" : \"disabled\";\n  }\n\n  async _fetchAttributionData(t) {\n    if (this._pendingAttributions.has(t)) return;\n\n    this._pendingAttributions.add(t);\n\n    const i = await e(t.layer.fetchAttributionData());\n\n    if (this._pendingAttributions.has(t)) {\n      const e = i.ok ? this._createContributionIndex(i.value, f(t.layer)) : null;\n      this._pendingAttributions.delete(t), this._fetchedAttributionData.set(t, e);\n    }\n\n    this._updateAttributionItems();\n  }\n\n  _createContributionIndex(t, e) {\n    const i = t.contributors,\n          r = {};\n    if (!i) return r;\n\n    for (let s = 0; s < i.length; s++) {\n      const t = i[s],\n            o = t.coverageAreas;\n      if (!o) return;\n\n      for (const i of o) {\n        const o = i.bbox,\n              n = i.zoomMin - (e && i.zoomMin ? 1 : 0),\n              a = i.zoomMax - (e && i.zoomMax ? 1 : 0),\n              c = {\n          xmin: o[1],\n          ymin: o[0],\n          xmax: o[3],\n          ymax: o[2],\n          spatialReference: l.WGS84\n        },\n              u = {\n          extent: h(c),\n          attribution: t.attribution || \"\",\n          score: null != i.score ? i.score : 100,\n          id: s\n        };\n\n        for (let t = n; t <= a; t++) r[t] = r[t] || [], r[t].push(u);\n      }\n    }\n\n    return r.maxKey = Math.max.apply(null, Object.keys(r)), r;\n  }\n\n  _getDynamicAttribution(t, e, i) {\n    const {\n      extent: r,\n      scale: s\n    } = e;\n    let o = i.tileInfo.scaleToZoom(s);\n    if (o = Math.min(t.maxKey, Math.round(o)), !r || null == o || o <= -1) return \"\";\n    const n = t[o],\n          a = u(r.center.clone().normalize(), e.spatialReference),\n          h = {};\n    return n ? n.filter(t => {\n      const e = !h[t.id] && a && c(t.extent, a);\n      return e && (h[t.id] = !0), e;\n    }).sort((t, e) => e.score - t.score || t.objectId - e.objectId).map(t => t.attribution).join(\", \") : \"\";\n  }\n\n};\nt([n({\n  readOnly: !0,\n  type: i\n})], y.prototype, \"items\", void 0), t([n({\n  readOnly: !0\n})], y.prototype, \"state\", null), t([n()], y.prototype, \"view\", void 0), y = t([a(\"esri.widgets.Attribution.AttributionViewModel\")], y);\nconst g = y;\nexport { g as default };","map":{"version":3,"sources":["D:/Github/CUSP_DataBase/CUSP_DB/src/main/gis/node_modules/@arcgis/core/widgets/Attribution/AttributionViewModel.js"],"names":["_","t","result","e","i","HandleOwner","r","on","s","whenTrue","o","property","n","subclass","a","extentContainsPoint","c","geographicToWebMercator","h","project","u","l","p","originOf","d","length","some","text","m","find","layerView","push","f","type","b","y","constructor","_clear","_fetchedAttributionData","clear","_pendingAttributions","handles","remove","notifyChange","Set","Map","items","view","_allLayerViewsChange","get","add","map","watch","_updateAttributionItems","removed","forEach","delete","suspended","layer","copyright","hasAttributionData","has","_getDynamicAttribution","_fetchAttributionData","removeAll","addMany","destroy","state","size","fetchAttributionData","ok","_createContributionIndex","value","set","contributors","coverageAreas","bbox","zoomMin","zoomMax","xmin","ymin","xmax","ymax","spatialReference","WGS84","extent","attribution","score","id","maxKey","Math","max","apply","Object","keys","scale","tileInfo","scaleToZoom","min","round","center","clone","normalize","filter","sort","objectId","join","readOnly","prototype","g","default"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport{_ as t}from\"../../chunks/tslib.es6.js\";import\"../../geometry.js\";import{result as e}from\"../../core/asyncUtils.js\";import i from\"../../core/Collection.js\";import{HandleOwner as r}from\"../../core/HandleOwner.js\";import{on as s,whenTrue as o}from\"../../core/watchUtils.js\";import{property as n}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/arrayUtils.js\";import\"../../core/has.js\";import\"../../core/accessorSupport/ensureType.js\";import{subclass as a}from\"../../core/accessorSupport/decorators/subclass.js\";import{extentContainsPoint as c}from\"../../geometry/support/contains.js\";import{geographicToWebMercator as h,project as u}from\"../../geometry/support/webMercatorUtils.js\";import l from\"../../geometry/SpatialReference.js\";function p(t,e){return t&&\"copyright\"in t&&(!e||\"function\"==typeof t.originOf&&\"user\"===t.originOf(\"copyright\"))}function d(t,e){return t.length!==e.length||t.some(((t,i)=>t.text!==e[i].text))}function m(t,e,i){if(!i||!e)return;t.find((t=>t.layerView===e&&t.text===i))||t.push({text:i,layerView:e})}function f(t){return\"bing-maps\"===t.type}const b=[];let y=class extends r{constructor(t){super(t),this._clear=()=>{this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.handles.remove(\"suspension\"),this.notifyChange(\"state\")},this._pendingAttributions=new Set,this._fetchedAttributionData=new Map,this.items=new i,this.view=null,this._allLayerViewsChange=t=>{this.handles.remove(\"suspension\");const e=this.get(\"view.allLayerViews\");e&&this.handles.add(e.map((t=>t.watch([\"suspended\",\"attributionVisible\"],this._updateAttributionItems))),\"suspension\"),t&&t.removed&&t.removed.forEach((t=>{this._pendingAttributions.delete(t),this._fetchedAttributionData.delete(t)})),this._updateAttributionItems()},this._updateAttributionItems=()=>{const t=this.get(\"view.allLayerViews\");b.length=0,t?(t.forEach((t=>{if(t.suspended||!t.get(\"layer.attributionVisible\"))return;const e=t.layer;if(p(e,\"user\"))return void m(b,t,e.copyright);if(e.hasAttributionData){if(this._fetchedAttributionData.has(t)){const i=this._fetchedAttributionData.get(t);return void(i?m(b,t,this._getDynamicAttribution(i,this.view,e)):p(e)&&m(b,t,e.copyright))}return void this._fetchAttributionData(t)}const i=e.get(\"portalItem.accessInformation\");m(b,t,i||e.copyright)})),d(this.items,b)&&(this.items.removeAll(),this.items.addMany(b)),b.length=0,this.notifyChange(\"state\")):this._clear()},this.handles.add([s(this,\"view.allLayerViews\",\"change\",this._allLayerViewsChange,this._allLayerViewsChange,this._clear),o(this,\"view.stationary\",(()=>this._updateAttributionItems()))])}destroy(){this.view=null,this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.items.removeAll()}get state(){return this.get(\"view.ready\")?this._pendingAttributions.size>0?\"loading\":\"ready\":\"disabled\"}async _fetchAttributionData(t){if(this._pendingAttributions.has(t))return;this._pendingAttributions.add(t);const i=await e(t.layer.fetchAttributionData());if(this._pendingAttributions.has(t)){const e=i.ok?this._createContributionIndex(i.value,f(t.layer)):null;this._pendingAttributions.delete(t),this._fetchedAttributionData.set(t,e)}this._updateAttributionItems()}_createContributionIndex(t,e){const i=t.contributors,r={};if(!i)return r;for(let s=0;s<i.length;s++){const t=i[s],o=t.coverageAreas;if(!o)return;for(const i of o){const o=i.bbox,n=i.zoomMin-(e&&i.zoomMin?1:0),a=i.zoomMax-(e&&i.zoomMax?1:0),c={xmin:o[1],ymin:o[0],xmax:o[3],ymax:o[2],spatialReference:l.WGS84},u={extent:h(c),attribution:t.attribution||\"\",score:null!=i.score?i.score:100,id:s};for(let t=n;t<=a;t++)r[t]=r[t]||[],r[t].push(u)}}return r.maxKey=Math.max.apply(null,Object.keys(r)),r}_getDynamicAttribution(t,e,i){const{extent:r,scale:s}=e;let o=i.tileInfo.scaleToZoom(s);if(o=Math.min(t.maxKey,Math.round(o)),!r||null==o||o<=-1)return\"\";const n=t[o],a=u(r.center.clone().normalize(),e.spatialReference),h={};return n?n.filter((t=>{const e=!h[t.id]&&a&&c(t.extent,a);return e&&(h[t.id]=!0),e})).sort(((t,e)=>e.score-t.score||t.objectId-e.objectId)).map((t=>t.attribution)).join(\", \"):\"\"}};t([n({readOnly:!0,type:i})],y.prototype,\"items\",void 0),t([n({readOnly:!0})],y.prototype,\"state\",null),t([n()],y.prototype,\"view\",void 0),y=t([a(\"esri.widgets.Attribution.AttributionViewModel\")],y);const g=y;export{g as default};\n"]},"metadata":{},"sourceType":"module"}