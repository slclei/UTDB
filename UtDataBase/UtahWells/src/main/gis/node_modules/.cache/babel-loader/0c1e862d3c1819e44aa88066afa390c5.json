{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport { isSome as e } from \"../core/maybe.js\";\nimport { urlToObject as n } from \"../core/urlUtils.js\";\nimport { getScale as t } from \"../geometry/support/scaleUtils.js\";\nimport { getLayerFloorFilterClause as i, combineFloorsDefinitionExpression as r } from \"../views/support/floorFilterUtils.js\";\n\nfunction s(e, n) {\n  return n ? { ...n,\n    query: { ...e,\n      ...n.query\n    }\n  } : {\n    query: e\n  };\n}\n\nfunction o(e) {\n  return \"string\" == typeof e ? n(e) : e;\n}\n\nfunction l(e, n, t) {\n  const i = {};\n\n  for (const r in e) {\n    if (\"declaredClass\" === r) continue;\n    const s = e[r];\n    if (null != s && \"function\" != typeof s) if (Array.isArray(s)) {\n      i[r] = [];\n\n      for (let e = 0; e < s.length; e++) i[r][e] = l(s[e]);\n    } else if (\"object\" == typeof s) {\n      if (s.toJSON) {\n        const e = s.toJSON(t && t[r]);\n        i[r] = n ? e : JSON.stringify(e);\n      } else i[r] = n ? s : JSON.stringify(s);\n    } else i[r] = s;\n  }\n\n  return i;\n}\n\nfunction f(_ref) {\n  let {\n    mapExtent: e,\n    floors: n,\n    width: r,\n    sublayers: s,\n    layerIds: o\n  } = _ref;\n  const l = {},\n        f = {\n    extent: e,\n    width: r,\n    spatialReference: null == e ? void 0 : e.spatialReference\n  };\n  let u = s;\n  null != o && o.length && s && (u = s.filter(e => o.includes(e.id)));\n\n  const c = t(f),\n        y = [],\n        p = e => {\n    const n = 0 === c,\n          t = 0 === e.minScale || c <= e.minScale,\n          i = 0 === e.maxScale || c >= e.maxScale;\n    e.visible && (n || t && i) && (e.sublayers ? e.sublayers.forEach(p) : y.unshift(e));\n  };\n\n  if (u && u.forEach(p), u && u.length) {\n    const e = y.map(e => {\n      const t = i(n, e);\n      return e.toExportImageJSON(t);\n    }),\n          t = e.some(e => \"mapLayer\" === e.source.type ? e.source.mapLayerId !== e.id : \"dataLayer\" === e.source.type);\n\n    if (t) {\n      let n = JSON.stringify(e);\n      \"[]\" === n && (n = \"[{}]\"), l.dynamicLayers = n;\n    } else if (!t) {\n      if (null != o && o.length) l.layerIds = o;else {\n        const e = u.map(_ref2 => {\n          let {\n            id: e\n          } = _ref2;\n          return e;\n        });\n        e.length && (l.layerIds = e);\n      }\n      const e = a({\n        floors: n,\n        visibleSublayers: y\n      });\n\n      if (e && e.length) {\n        const n = e.reduce((e, n) => (n.definitionExpression && (e[n.id] = n.definitionExpression), e), {});\n        Object.keys(n).length && (l.layerDefs = JSON.stringify(n));\n      }\n    }\n  } else null != o && o.length && (l.layerIds = o);\n\n  return l;\n}\n\nfunction a(_ref3) {\n  let {\n    floors: n,\n    visibleSublayers: t\n  } = _ref3;\n  const s = !(null == n || !n.length),\n        o = t.filter(e => null != e.definitionExpression || s && null != e.floorInfo);\n  if (!o.length) return null;\n  return o.map(t => {\n    const s = i(n, t),\n          o = e(s) ? r(s, t) : t.definitionExpression,\n          l = {\n      id: t.id,\n      definitionExpression: null\n    };\n    return o && (l.definitionExpression = o), l;\n  });\n}\n\nexport { s as asValidOptions, l as encode, o as parseUrl, f as toDynamicLayersJSON };","map":{"version":3,"sources":["D:/Github/CUSP_DataBase/CUSP_DB/src/main/gis/node_modules/@arcgis/core/rest/utils.js"],"names":["isSome","e","urlToObject","n","getScale","t","getLayerFloorFilterClause","i","combineFloorsDefinitionExpression","r","s","query","o","l","Array","isArray","length","toJSON","JSON","stringify","f","mapExtent","floors","width","sublayers","layerIds","extent","spatialReference","u","filter","includes","id","c","y","p","minScale","maxScale","visible","forEach","unshift","map","toExportImageJSON","some","source","type","mapLayerId","dynamicLayers","a","visibleSublayers","reduce","definitionExpression","Object","keys","layerDefs","floorInfo","asValidOptions","encode","parseUrl","toDynamicLayersJSON"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport{isSome as e}from\"../core/maybe.js\";import{urlToObject as n}from\"../core/urlUtils.js\";import{getScale as t}from\"../geometry/support/scaleUtils.js\";import{getLayerFloorFilterClause as i,combineFloorsDefinitionExpression as r}from\"../views/support/floorFilterUtils.js\";function s(e,n){return n?{...n,query:{...e,...n.query}}:{query:e}}function o(e){return\"string\"==typeof e?n(e):e}function l(e,n,t){const i={};for(const r in e){if(\"declaredClass\"===r)continue;const s=e[r];if(null!=s&&\"function\"!=typeof s)if(Array.isArray(s)){i[r]=[];for(let e=0;e<s.length;e++)i[r][e]=l(s[e])}else if(\"object\"==typeof s)if(s.toJSON){const e=s.toJSON(t&&t[r]);i[r]=n?e:JSON.stringify(e)}else i[r]=n?s:JSON.stringify(s);else i[r]=s}return i}function f({mapExtent:e,floors:n,width:r,sublayers:s,layerIds:o}){const l={},f={extent:e,width:r,spatialReference:null==e?void 0:e.spatialReference};let u=s;null!=o&&o.length&&s&&(u=s.filter((e=>o.includes(e.id))));const c=t(f),y=[],p=e=>{const n=0===c,t=0===e.minScale||c<=e.minScale,i=0===e.maxScale||c>=e.maxScale;e.visible&&(n||t&&i)&&(e.sublayers?e.sublayers.forEach(p):y.unshift(e))};if(u&&u.forEach(p),u&&u.length){const e=y.map((e=>{const t=i(n,e);return e.toExportImageJSON(t)})),t=e.some((e=>\"mapLayer\"===e.source.type?e.source.mapLayerId!==e.id:\"dataLayer\"===e.source.type));if(t){let n=JSON.stringify(e);\"[]\"===n&&(n=\"[{}]\"),l.dynamicLayers=n}else if(!t){if(null!=o&&o.length)l.layerIds=o;else{const e=u.map((({id:e})=>e));e.length&&(l.layerIds=e)}const e=a({floors:n,visibleSublayers:y});if(e&&e.length){const n=e.reduce(((e,n)=>(n.definitionExpression&&(e[n.id]=n.definitionExpression),e)),{});Object.keys(n).length&&(l.layerDefs=JSON.stringify(n))}}}else null!=o&&o.length&&(l.layerIds=o);return l}function a({floors:n,visibleSublayers:t}){const s=!(null==n||!n.length),o=t.filter((e=>null!=e.definitionExpression||s&&null!=e.floorInfo));if(!o.length)return null;return o.map((t=>{const s=i(n,t),o=e(s)?r(s,t):t.definitionExpression,l={id:t.id,definitionExpression:null};return o&&(l.definitionExpression=o),l}))}export{s as asValidOptions,l as encode,o as parseUrl,f as toDynamicLayersJSON};\n"]},"metadata":{},"sourceType":"module"}