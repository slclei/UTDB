{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport { isSome as e } from \"../../../core/maybe.js\";\nimport i from \"./TileCoverage.js\";\nimport t from \"./TileKey.js\";\nconst l = 1e-6;\n\nclass s {\n  constructor(e) {\n    this._tiles = new Map(), this.buffer = 0, this.acquireTile = e.acquireTile, this.releaseTile = e.releaseTile, this.tileInfoView = e.tileInfoView, this.buffer = e.buffer;\n  }\n\n  destroy() {}\n\n  clear() {\n    this._tiles.forEach(e => this._releaseTile(e));\n  }\n\n  tileKeys() {\n    const e = [];\n    return this._tiles.forEach((i, t) => e.push(t)), e;\n  }\n\n  update(e) {\n    const l = this.tileInfoView.getTileCoverage(e.state, this.buffer, \"closest\"),\n          {\n      spans: s,\n      lodInfo: r\n    } = l,\n          {\n      level: a\n    } = r,\n          o = [],\n          d = [],\n          h = new Set(),\n          n = new Set();\n\n    for (const {\n      row: i,\n      colFrom: c,\n      colTo: f\n    } of s) for (let e = c; e <= f; e++) {\n      const l = t.getId(a, i, r.normalizeCol(e), r.getWorldForColumn(e)),\n            s = this._getOrAcquireTile(o, l);\n\n      h.add(l), s.isReady ? s.visible = !0 : n.add(s.key);\n    }\n\n    n.forEach(e => this._addPlaceholders(h, e)), this._tiles.forEach(e => {\n      h.has(e.key.id) || (d.push(e.key.id), this._releaseTile(e));\n    }), i.pool.release(l);\n    return {\n      hasMissingTiles: n.size > 0,\n      added: o,\n      removed: d\n    };\n  }\n\n  _getOrAcquireTile(e, i) {\n    if (!this._tiles.has(i)) {\n      const l = this.acquireTile(new t(i));\n      e.push(i), this._tiles.set(i, l), l.visible = !1;\n    }\n\n    return this._tiles.get(i);\n  }\n\n  _getTile(e) {\n    return this._tiles.get(e);\n  }\n\n  _releaseTile(e) {\n    this._tiles.delete(e.key.id), this.releaseTile(e);\n  }\n\n  _addPlaceholders(e, i) {\n    const t = this._addPlaceholderChildren(e, i);\n\n    if (!(Math.abs(1 - t) < l)) {\n      if (!this._addPlaceholderParent(e, i)) {\n        this._getTile(i.id).visible = !0;\n      }\n    }\n  }\n\n  _addPlaceholderChildren(e, i) {\n    let t = 0;\n    return this._tiles.forEach(l => {\n      t += this._addPlaceholderChild(e, l, i);\n    }), t;\n  }\n\n  _addPlaceholderChild(e, i, t) {\n    if (i.key.level <= t.level || !i.hasData || !t.contains(i.key)) return 0;\n    i.visible = !0, e.add(i.key.id);\n    return 1 / (1 << 2 * (i.key.level - t.level));\n  }\n\n  _addPlaceholderParent(i, t) {\n    let l = t.getParentKey(),\n        s = 0,\n        r = null;\n\n    for (; e(l);) {\n      if (i.has(l.id)) return !0;\n\n      const e = this._getTile(l.id);\n\n      if (null != e && e.isReady) return e.visible = !0, i.add(e.key.id), !0;\n      null != e && e.hasData && e.patchCount > s && (s = e.patchCount, r = e), l = l.getParentKey();\n    }\n\n    return !!r && (r.visible = !0, i.add(r.key.id), !0);\n  }\n\n}\n\nexport { s as TileManager };","map":{"version":3,"sources":["D:/Github/CUSP_DataBase/CUSP_DB/src/main/gis/node_modules/@arcgis/core/views/2d/tiling/TileManager.js"],"names":["isSome","e","i","t","l","s","constructor","_tiles","Map","buffer","acquireTile","releaseTile","tileInfoView","destroy","clear","forEach","_releaseTile","tileKeys","push","update","getTileCoverage","state","spans","lodInfo","r","level","a","o","d","h","Set","n","row","colFrom","c","colTo","f","getId","normalizeCol","getWorldForColumn","_getOrAcquireTile","add","isReady","visible","key","_addPlaceholders","has","id","pool","release","hasMissingTiles","size","added","removed","set","get","_getTile","delete","_addPlaceholderChildren","Math","abs","_addPlaceholderParent","_addPlaceholderChild","hasData","contains","getParentKey","patchCount","TileManager"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport{isSome as e}from\"../../../core/maybe.js\";import i from\"./TileCoverage.js\";import t from\"./TileKey.js\";const l=1e-6;class s{constructor(e){this._tiles=new Map,this.buffer=0,this.acquireTile=e.acquireTile,this.releaseTile=e.releaseTile,this.tileInfoView=e.tileInfoView,this.buffer=e.buffer}destroy(){}clear(){this._tiles.forEach((e=>this._releaseTile(e)))}tileKeys(){const e=[];return this._tiles.forEach(((i,t)=>e.push(t))),e}update(e){const l=this.tileInfoView.getTileCoverage(e.state,this.buffer,\"closest\"),{spans:s,lodInfo:r}=l,{level:a}=r,o=[],d=[],h=new Set,n=new Set;for(const{row:i,colFrom:c,colTo:f}of s)for(let e=c;e<=f;e++){const l=t.getId(a,i,r.normalizeCol(e),r.getWorldForColumn(e)),s=this._getOrAcquireTile(o,l);h.add(l),s.isReady?s.visible=!0:n.add(s.key)}n.forEach((e=>this._addPlaceholders(h,e))),this._tiles.forEach((e=>{h.has(e.key.id)||(d.push(e.key.id),this._releaseTile(e))})),i.pool.release(l);return{hasMissingTiles:n.size>0,added:o,removed:d}}_getOrAcquireTile(e,i){if(!this._tiles.has(i)){const l=this.acquireTile(new t(i));e.push(i),this._tiles.set(i,l),l.visible=!1}return this._tiles.get(i)}_getTile(e){return this._tiles.get(e)}_releaseTile(e){this._tiles.delete(e.key.id),this.releaseTile(e)}_addPlaceholders(e,i){const t=this._addPlaceholderChildren(e,i);if(!(Math.abs(1-t)<l)){if(!this._addPlaceholderParent(e,i)){this._getTile(i.id).visible=!0}}}_addPlaceholderChildren(e,i){let t=0;return this._tiles.forEach((l=>{t+=this._addPlaceholderChild(e,l,i)})),t}_addPlaceholderChild(e,i,t){if(i.key.level<=t.level||!i.hasData||!t.contains(i.key))return 0;i.visible=!0,e.add(i.key.id);return 1/(1<<2*(i.key.level-t.level))}_addPlaceholderParent(i,t){let l=t.getParentKey(),s=0,r=null;for(;e(l);){if(i.has(l.id))return!0;const e=this._getTile(l.id);if(null!=e&&e.isReady)return e.visible=!0,i.add(e.key.id),!0;null!=e&&e.hasData&&e.patchCount>s&&(s=e.patchCount,r=e),l=l.getParentKey()}return!!r&&(r.visible=!0,i.add(r.key.id),!0)}}export{s as TileManager};\n"]},"metadata":{},"sourceType":"module"}