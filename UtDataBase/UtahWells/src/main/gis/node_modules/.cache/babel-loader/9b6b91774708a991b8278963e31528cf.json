{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport { nextPowerOfTwo as t } from \"../../../../../core/mathUtils.js\";\nimport { isSome as r } from \"../../../../../core/maybe.js\";\nimport { c as o } from \"../../../../../chunks/mat3f32.js\";\nimport { f as e } from \"../../../../../chunks/vec4f32.js\";\nimport { VTL_TEXTURE_BINDING_UNIT_SPRITES as i, VTL_HIGH_RES_CUTOFF as s } from \"../definitions.js\";\nimport { WGLDrawPhase as a } from \"../enums.js\";\nimport { u32to4Xu8 as n } from \"../number.js\";\nimport c from \"./WGLBrush.js\";\nimport { BufferObject as m } from \"../../../../webgl/BufferObject.js\";\nimport { TextureSamplingMode as f, CompareFunction as l, PrimitiveType as u, Usage as p } from \"../../../../webgl/enums.js\";\nimport { VertexArrayObject as _ } from \"../../../../webgl/VertexArrayObject.js\";\n\nclass d extends c {\n  constructor() {\n    super(...arguments), this._color = e(1, 0, 0, 1), this._patternMatrix = o(), this._programOptions = {\n      id: !1,\n      pattern: !1\n    };\n  }\n\n  dispose() {\n    this._vao && (this._vao.dispose(), this._vao = null);\n  }\n\n  drawMany(o, e) {\n    const {\n      context: c,\n      painter: m,\n      styleLayerUID: p\n    } = o;\n\n    this._loadWGLResources(o);\n\n    const _ = o.displayLevel,\n          d = o.styleLayer,\n          h = d.backgroundMaterial,\n          g = m.vectorTilesMaterialManager,\n          v = d.getPaintValue(\"background-color\", _),\n          b = d.getPaintValue(\"background-opacity\", _),\n          y = d.getPaintValue(\"background-pattern\", _),\n          M = void 0 !== y,\n          x = v[3] * b,\n          j = 1 | window.devicePixelRatio,\n          U = o.spriteMosaic;\n    let L, w;\n    const A = j > s ? 2 : 1,\n          P = o.drawPhase === a.HITTEST,\n          I = this._programOptions;\n    I.id = P, I.pattern = M;\n    const k = g.getMaterialProgram(c, h, I);\n\n    if (c.bindVAO(this._vao), c.useProgram(k), M) {\n      const t = U.getMosaicItemPosition(y, !0);\n\n      if (r(t)) {\n        const {\n          tl: o,\n          br: e,\n          page: s\n        } = t;\n        L = e[0] - o[0], w = e[1] - o[1];\n        const a = U.getPageSize(s);\n        r(a) && (U.bind(c, f.LINEAR, s, i), k.setUniform4f(\"u_tlbr\", o[0], o[1], e[0], e[1]), k.setUniform2fv(\"u_mosaicSize\", a), k.setUniform1i(\"u_texture\", i));\n      }\n\n      k.setUniform1f(\"u_opacity\", b);\n    } else this._color[0] = x * v[0], this._color[1] = x * v[1], this._color[2] = x * v[2], this._color[3] = x, k.setUniform4fv(\"u_color\", this._color);\n\n    if (k.setUniform1f(\"u_depth\", d.z || 0), P) {\n      const t = n(p + 1);\n      k.setUniform4fv(\"u_id\", t);\n    }\n\n    for (const r of e) {\n      if (k.setUniform1f(\"u_coord_range\", r.rangeX), k.setUniformMatrix3fv(\"u_dvsMat3\", r.transforms.dvs), M) {\n        const o = Math.max(2 ** (Math.round(_) - r.key.level), 1),\n              e = A * r.width * o,\n              i = e / t(L),\n              s = e / t(w);\n        this._patternMatrix[0] = i, this._patternMatrix[4] = s, k.setUniformMatrix3fv(\"u_pattern_matrix\", this._patternMatrix);\n      }\n\n      c.setStencilFunction(l.EQUAL, r.stencilRef, 255), c.drawArrays(u.TRIANGLE_STRIP, 0, 4);\n    }\n  }\n\n  _loadWGLResources(t) {\n    if (this._vao) return;\n    const {\n      context: r,\n      styleLayer: o\n    } = t,\n          e = o.backgroundMaterial,\n          i = new Int8Array([0, 0, 1, 0, 0, 1, 1, 1]),\n          s = m.createVertex(r, p.STATIC_DRAW, i),\n          a = new _(r, e.getAttributeLocations(), e.getLayoutInfo(), {\n      geometry: s\n    });\n    this._vao = a;\n  }\n\n}\n\nexport { d as WGLBrushVTLBackground };","map":{"version":3,"sources":["D:/Github/CUSP_DataBase/CUSP_DB/src/main/gis/node_modules/@arcgis/core/views/2d/engine/webgl/brushes/WGLBrushVTLBackground.js"],"names":["nextPowerOfTwo","t","isSome","r","c","o","f","e","VTL_TEXTURE_BINDING_UNIT_SPRITES","i","VTL_HIGH_RES_CUTOFF","s","WGLDrawPhase","a","u32to4Xu8","n","BufferObject","m","TextureSamplingMode","CompareFunction","l","PrimitiveType","u","Usage","p","VertexArrayObject","_","d","constructor","arguments","_color","_patternMatrix","_programOptions","id","pattern","dispose","_vao","drawMany","context","painter","styleLayerUID","_loadWGLResources","displayLevel","styleLayer","h","backgroundMaterial","g","vectorTilesMaterialManager","v","getPaintValue","b","y","M","x","j","window","devicePixelRatio","U","spriteMosaic","L","w","A","P","drawPhase","HITTEST","I","k","getMaterialProgram","bindVAO","useProgram","getMosaicItemPosition","tl","br","page","getPageSize","bind","LINEAR","setUniform4f","setUniform2fv","setUniform1i","setUniform1f","setUniform4fv","z","rangeX","setUniformMatrix3fv","transforms","dvs","Math","max","round","key","level","width","setStencilFunction","EQUAL","stencilRef","drawArrays","TRIANGLE_STRIP","Int8Array","createVertex","STATIC_DRAW","getAttributeLocations","getLayoutInfo","geometry","WGLBrushVTLBackground"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport{nextPowerOfTwo as t}from\"../../../../../core/mathUtils.js\";import{isSome as r}from\"../../../../../core/maybe.js\";import{c as o}from\"../../../../../chunks/mat3f32.js\";import{f as e}from\"../../../../../chunks/vec4f32.js\";import{VTL_TEXTURE_BINDING_UNIT_SPRITES as i,VTL_HIGH_RES_CUTOFF as s}from\"../definitions.js\";import{WGLDrawPhase as a}from\"../enums.js\";import{u32to4Xu8 as n}from\"../number.js\";import c from\"./WGLBrush.js\";import{BufferObject as m}from\"../../../../webgl/BufferObject.js\";import{TextureSamplingMode as f,CompareFunction as l,PrimitiveType as u,Usage as p}from\"../../../../webgl/enums.js\";import{VertexArrayObject as _}from\"../../../../webgl/VertexArrayObject.js\";class d extends c{constructor(){super(...arguments),this._color=e(1,0,0,1),this._patternMatrix=o(),this._programOptions={id:!1,pattern:!1}}dispose(){this._vao&&(this._vao.dispose(),this._vao=null)}drawMany(o,e){const{context:c,painter:m,styleLayerUID:p}=o;this._loadWGLResources(o);const _=o.displayLevel,d=o.styleLayer,h=d.backgroundMaterial,g=m.vectorTilesMaterialManager,v=d.getPaintValue(\"background-color\",_),b=d.getPaintValue(\"background-opacity\",_),y=d.getPaintValue(\"background-pattern\",_),M=void 0!==y,x=v[3]*b,j=1|window.devicePixelRatio,U=o.spriteMosaic;let L,w;const A=j>s?2:1,P=o.drawPhase===a.HITTEST,I=this._programOptions;I.id=P,I.pattern=M;const k=g.getMaterialProgram(c,h,I);if(c.bindVAO(this._vao),c.useProgram(k),M){const t=U.getMosaicItemPosition(y,!0);if(r(t)){const{tl:o,br:e,page:s}=t;L=e[0]-o[0],w=e[1]-o[1];const a=U.getPageSize(s);r(a)&&(U.bind(c,f.LINEAR,s,i),k.setUniform4f(\"u_tlbr\",o[0],o[1],e[0],e[1]),k.setUniform2fv(\"u_mosaicSize\",a),k.setUniform1i(\"u_texture\",i))}k.setUniform1f(\"u_opacity\",b)}else this._color[0]=x*v[0],this._color[1]=x*v[1],this._color[2]=x*v[2],this._color[3]=x,k.setUniform4fv(\"u_color\",this._color);if(k.setUniform1f(\"u_depth\",d.z||0),P){const t=n(p+1);k.setUniform4fv(\"u_id\",t)}for(const r of e){if(k.setUniform1f(\"u_coord_range\",r.rangeX),k.setUniformMatrix3fv(\"u_dvsMat3\",r.transforms.dvs),M){const o=Math.max(2**(Math.round(_)-r.key.level),1),e=A*r.width*o,i=e/t(L),s=e/t(w);this._patternMatrix[0]=i,this._patternMatrix[4]=s,k.setUniformMatrix3fv(\"u_pattern_matrix\",this._patternMatrix)}c.setStencilFunction(l.EQUAL,r.stencilRef,255),c.drawArrays(u.TRIANGLE_STRIP,0,4)}}_loadWGLResources(t){if(this._vao)return;const{context:r,styleLayer:o}=t,e=o.backgroundMaterial,i=new Int8Array([0,0,1,0,0,1,1,1]),s=m.createVertex(r,p.STATIC_DRAW,i),a=new _(r,e.getAttributeLocations(),e.getLayoutInfo(),{geometry:s});this._vao=a}}export{d as WGLBrushVTLBackground};\n"]},"metadata":{},"sourceType":"module"}