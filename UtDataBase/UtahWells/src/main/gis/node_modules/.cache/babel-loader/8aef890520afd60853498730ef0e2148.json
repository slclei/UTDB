{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport { adjustStaticAGOUrl as e } from \"../../../../core/devEnvironmentUtils.js\";\nimport { get as t, isSome as r, isNone as s } from \"../../../../core/maybe.js\";\nimport { a as o } from \"../../../../chunks/mat3.js\";\nimport { c as i } from \"../../../../chunks/mat3f64.js\";\nimport { a } from \"../../../../chunks/mat4.js\";\nimport { c as u } from \"../../../../chunks/mat4f64.js\";\nimport { m as n, f as l, E as c, l as m, n as d, e as f } from \"../../../../chunks/vec3.js\";\nimport { c as p } from \"../../../../chunks/vec3f64.js\";\nimport { empty as x, expandWithVec3 as g } from \"../../../../geometry/support/aaBoundingBox.js\";\nimport { BufferViewVec3f as b, BufferViewVec4f as h, BufferViewVec2f as R, BufferViewVec4u8 as v, BufferViewVec4u16 as B, BufferViewVec3u8 as M, BufferViewVec3u16 as T } from \"../../../../geometry/support/buffer/BufferView.js\";\nimport { t as w, a as y, s as j } from \"../../../../chunks/vec32.js\";\nimport { t as E, s as O } from \"../../../../chunks/vec42.js\";\nimport { createBuffer as C } from \"../../../../geometry/support/buffer/utils.js\";\nimport { DefaultLoadingContext as S } from \"../../glTF/DefaultLoadingContext.js\";\nimport { load as A } from \"../../glTF/loader.js\";\nimport { triangleFanToTriangles as N, triangleStripToTriangles as I, trianglesToTriangles as L } from \"../../glTF/internal/indexUtils.js\";\nimport { load as F, processLoadResult as k } from \"./wosrLoader.js\";\nimport { AlphaDiscardMode as P, DepthTestFunction as V, CullFaceOptions as _ } from \"../../webgl-engine/lib/basicInterfaces.js\";\nimport { Geometry as G } from \"../../webgl-engine/lib/Geometry.js\";\nimport { Texture as D } from \"../../webgl-engine/lib/Texture.js\";\nimport { VertexAttribute as z } from \"../../webgl-engine/lib/VertexAttribute.js\";\nimport { DefaultMaterial as U } from \"../../webgl-engine/materials/DefaultMaterial.js\";\nimport { COLOR_GAMMA as q } from \"../../webgl-engine/materials/DefaultMaterial_COLOR_GAMMA.js\";\nimport { PrimitiveType as W } from \"../../../webgl/enums.js\";\nimport { n as $ } from \"../../../../chunks/vec22.js\";\nimport { c as K, f as Q } from \"../../../../chunks/vec43.js\";\nimport { c as H } from \"../../../../chunks/vec33.js\";\n\nasync function J(s, o) {\n  const i = X(e(s));\n\n  if (\"wosr\" === i.fileType) {\n    const e = await (o.cache ? o.cache.loadWOSR(i.url, o) : F(i.url, o)),\n          t = k(e, o);\n    return {\n      lods: [t],\n      referenceBoundingBox: t.boundingBox,\n      isEsriSymbolResource: !1,\n      isWosr: !0,\n      remove: e.remove\n    };\n  }\n\n  const a = await (o.cache ? o.cache.loadGLTF(i.url, o, o.usePBR) : A(new S(o.streamDataRequester), i.url, o, o.usePBR)),\n        u = t(a.model.meta, \"ESRI_proxyEllipsoid\");\n  a.meta.isEsriSymbolResource && r(u) && -1 !== a.meta.uri.indexOf(\"/RealisticTrees/\") && te(a, u);\n  const n = a.meta.isEsriSymbolResource ? {\n    usePBR: o.usePBR,\n    isSchematic: !1,\n    treeRendering: a.customMeta.esriTreeRendering,\n    mrrFactors: [0, 1, .2]\n  } : {\n    usePBR: o.usePBR,\n    isSchematic: !1,\n    mrrFactors: [0, 1, .5]\n  },\n        l = { ...o.materialParamsMixin,\n    treeRendering: a.customMeta.esriTreeRendering\n  };\n\n  if (null != i.specifiedLodIndex) {\n    const e = Y(a, n, l, i.specifiedLodIndex);\n    let t = e[0].boundingBox;\n\n    if (0 !== i.specifiedLodIndex) {\n      t = Y(a, n, l, 0)[0].boundingBox;\n    }\n\n    return {\n      lods: e,\n      referenceBoundingBox: t,\n      isEsriSymbolResource: a.meta.isEsriSymbolResource,\n      isWosr: !1,\n      remove: a.remove\n    };\n  }\n\n  const c = Y(a, n, l);\n  return {\n    lods: c,\n    referenceBoundingBox: c[0].boundingBox,\n    isEsriSymbolResource: a.meta.isEsriSymbolResource,\n    isWosr: !1,\n    remove: a.remove\n  };\n}\n\nfunction X(e) {\n  const t = e.match(/(.*\\.(gltf|glb))(\\?lod=([0-9]+))?$/);\n  if (t) return {\n    fileType: \"gltf\",\n    url: t[1],\n    specifiedLodIndex: null != t[4] ? Number(t[4]) : null\n  };\n  return e.match(/(.*\\.(json|json\\.gz))$/) ? {\n    fileType: \"wosr\",\n    url: e,\n    specifiedLodIndex: null\n  } : {\n    fileType: \"unknown\",\n    url: e,\n    specifiedLodIndex: null\n  };\n}\n\nfunction Y(e, t, s, a) {\n  const u = e.model,\n        n = i(),\n        l = new Array(),\n        c = new Map(),\n        m = new Map();\n  return u.lods.forEach((e, i) => {\n    if (void 0 !== a && i !== a) return;\n    const d = {\n      name: e.name,\n      stageResources: {\n        textures: new Array(),\n        materials: new Array(),\n        geometries: new Array()\n      },\n      lodThreshold: r(e.lodThreshold) ? e.lodThreshold : null,\n      pivotOffset: [0, 0, 0],\n      numberOfVertices: 0,\n      boundingBox: x()\n    };\n    l.push(d), e.parts.forEach(e => {\n      const i = e.material + (e.attributes.normal ? \"_normal\" : \"\") + (e.attributes.color ? \"_color\" : \"\") + (e.attributes.texCoord0 ? \"_texCoord0\" : \"\") + (e.attributes.tangent ? \"_tangent\" : \"\"),\n            a = u.materials.get(e.material),\n            l = r(e.attributes.texCoord0),\n            f = r(e.attributes.normal),\n            p = Z(a.alphaMode);\n\n      if (!c.has(i)) {\n        if (l) {\n          if (r(a.textureColor) && !m.has(a.textureColor)) {\n            const e = u.textures.get(a.textureColor),\n                  t = { ...e.parameters,\n              preMultiplyAlpha: p !== P.Opaque\n            };\n            m.set(a.textureColor, new D(e.data, t));\n          }\n\n          if (r(a.textureNormal) && !m.has(a.textureNormal)) {\n            const e = u.textures.get(a.textureNormal);\n            m.set(a.textureNormal, new D(e.data, e.parameters));\n          }\n\n          if (r(a.textureOcclusion) && !m.has(a.textureOcclusion)) {\n            const e = u.textures.get(a.textureOcclusion);\n            m.set(a.textureOcclusion, new D(e.data, e.parameters));\n          }\n\n          if (r(a.textureEmissive) && !m.has(a.textureEmissive)) {\n            const e = u.textures.get(a.textureEmissive);\n            m.set(a.textureEmissive, new D(e.data, e.parameters));\n          }\n\n          if (r(a.textureMetallicRoughness) && !m.has(a.textureMetallicRoughness)) {\n            const e = u.textures.get(a.textureMetallicRoughness);\n            m.set(a.textureMetallicRoughness, new D(e.data, e.parameters));\n          }\n        }\n\n        const o = a.color[0] ** (1 / q),\n              n = a.color[1] ** (1 / q),\n              d = a.color[2] ** (1 / q),\n              x = a.emissiveFactor[0] ** (1 / q),\n              g = a.emissiveFactor[1] ** (1 / q),\n              b = a.emissiveFactor[2] ** (1 / q),\n              h = r(a.textureColor) && l ? m.get(a.textureColor) : null;\n        c.set(i, new U({ ...t,\n          transparent: p === P.Blend,\n          customDepthTest: V.Lequal,\n          textureAlphaMode: p,\n          textureAlphaCutoff: a.alphaCutoff,\n          diffuse: [o, n, d],\n          ambient: [o, n, d],\n          opacity: a.opacity,\n          doubleSided: a.doubleSided,\n          doubleSidedType: \"winding-order\",\n          cullFace: a.doubleSided ? _.None : _.Back,\n          vertexColors: !!e.attributes.color,\n          vertexTangents: !!e.attributes.tangent,\n          normals: f ? \"default\" : \"screenDerivative\",\n          castShadows: !0,\n          receiveSSAO: !0,\n          fillLightsEnabled: !0,\n          textureId: r(h) ? h.id : void 0,\n          colorMixMode: a.colorMixMode,\n          normalTextureId: r(a.textureNormal) && l ? m.get(a.textureNormal).id : void 0,\n          textureAlphaPremultiplied: r(h) && !!h.params.preMultiplyAlpha,\n          occlusionTextureId: r(a.textureOcclusion) && l ? m.get(a.textureOcclusion).id : void 0,\n          emissiveTextureId: r(a.textureEmissive) && l ? m.get(a.textureEmissive).id : void 0,\n          metallicRoughnessTextureId: r(a.textureMetallicRoughness) && l ? m.get(a.textureMetallicRoughness).id : void 0,\n          emissiveFactor: [x, g, b],\n          mrrFactors: [a.metallicFactor, a.roughnessFactor, t.mrrFactors[2]],\n          isSchematic: !1,\n          ...s\n        }));\n      }\n\n      const x = ee(e.indices || e.attributes.position.count, e.primitiveType),\n            S = e.attributes.position.count,\n            A = C(b, S);\n      w(A, e.attributes.position, e.transform);\n      const N = [[z.POSITION, {\n        data: A.typedBuffer,\n        size: A.elementCount,\n        exclusive: !0\n      }]],\n            I = [[z.POSITION, x]];\n\n      if (r(e.attributes.normal)) {\n        const t = C(b, S);\n        o(n, e.transform), y(t, e.attributes.normal, n), N.push([z.NORMAL, {\n          data: t.typedBuffer,\n          size: t.elementCount,\n          exclusive: !0\n        }]), I.push([z.NORMAL, x]);\n      }\n\n      if (r(e.attributes.tangent)) {\n        const t = C(h, S);\n        o(n, e.transform), E(t, e.attributes.tangent, n), N.push([z.TANGENT, {\n          data: t.typedBuffer,\n          size: t.elementCount,\n          exclusive: !0\n        }]), I.push([z.TANGENT, x]);\n      }\n\n      if (r(e.attributes.texCoord0)) {\n        const t = C(R, S);\n        $(t, e.attributes.texCoord0), N.push([z.UV0, {\n          data: t.typedBuffer,\n          size: t.elementCount,\n          exclusive: !0\n        }]), I.push([z.UV0, x]);\n      }\n\n      if (r(e.attributes.color)) {\n        const t = C(v, S);\n        if (4 === e.attributes.color.elementCount) e.attributes.color instanceof h ? O(t, e.attributes.color, 255) : e.attributes.color instanceof v ? K(t, e.attributes.color) : e.attributes.color instanceof B && O(t, e.attributes.color, 1 / 256);else {\n          Q(t, 255, 255, 255, 255);\n          const r = new M(t.buffer, 0, 4);\n          e.attributes.color instanceof b ? j(r, e.attributes.color, 255) : e.attributes.color instanceof M ? H(r, e.attributes.color) : e.attributes.color instanceof T && j(r, e.attributes.color, 1 / 256);\n        }\n        N.push([z.COLOR, {\n          data: t.typedBuffer,\n          size: t.elementCount,\n          exclusive: !0\n        }]), I.push([z.COLOR, x]);\n      }\n\n      const L = new G(N, I);\n      d.stageResources.geometries.push(L), d.stageResources.materials.push(c.get(i)), l && (r(a.textureColor) && d.stageResources.textures.push(m.get(a.textureColor)), r(a.textureNormal) && d.stageResources.textures.push(m.get(a.textureNormal)), r(a.textureOcclusion) && d.stageResources.textures.push(m.get(a.textureOcclusion)), r(a.textureEmissive) && d.stageResources.textures.push(m.get(a.textureEmissive)), r(a.textureMetallicRoughness) && d.stageResources.textures.push(m.get(a.textureMetallicRoughness))), d.numberOfVertices += S;\n      const F = L.boundingInfo;\n      r(F) && (g(d.boundingBox, F.getBBMin()), g(d.boundingBox, F.getBBMax()));\n    });\n  }), l;\n}\n\nfunction Z(e) {\n  switch (e) {\n    case \"BLEND\":\n      return P.Blend;\n\n    case \"MASK\":\n      return P.Mask;\n\n    case \"OPAQUE\":\n    case null:\n    case void 0:\n      return P.Opaque;\n  }\n}\n\nfunction ee(e, t) {\n  switch (t) {\n    case W.TRIANGLES:\n      return L(e);\n\n    case W.TRIANGLE_STRIP:\n      return I(e);\n\n    case W.TRIANGLE_FAN:\n      return N(e);\n  }\n}\n\nfunction te(e, t) {\n  for (let r = 0; r < e.model.lods.length; ++r) {\n    const o = e.model.lods[r];\n    e.customMeta.esriTreeRendering = !0;\n\n    for (const i of o.parts) {\n      const o = i.attributes.normal;\n      if (s(o)) return;\n      const x = i.attributes.position,\n            g = x.count,\n            h = p(),\n            R = p(),\n            B = p(),\n            M = C(v, g),\n            T = C(b, g),\n            w = a(u(), i.transform);\n\n      for (let s = 0; s < g; s++) {\n        x.getVec(s, R), o.getVec(s, h), n(R, R, i.transform), l(B, R, t.center), c(B, B, t.radius);\n        const a = B[2],\n              u = m(B),\n              p = Math.min(.45 + .55 * u * u, 1);\n        c(B, B, t.radius), n(B, B, w), d(B, B), r + 1 !== e.model.lods.length && e.model.lods.length > 1 && f(B, B, h, a > -1 ? .2 : Math.min(-4 * a - 3.8, 1)), T.setVec(s, B), M.set(s, 0, 255 * p), M.set(s, 1, 255 * p), M.set(s, 2, 255 * p), M.set(s, 3, 255);\n      }\n\n      i.attributes.normal = T, i.attributes.color = M;\n    }\n  }\n}\n\nexport { J as fetch, Y as gltfToEngineResources, X as parseUrl };","map":{"version":3,"sources":["D:/Github/CUSP_DataBase/CUSP_DB/src/main/gis/node_modules/@arcgis/core/views/3d/layers/graphics/objectResourceUtils.js"],"names":["adjustStaticAGOUrl","e","get","t","isSome","r","isNone","s","a","o","c","i","u","m","n","f","l","E","d","p","empty","x","expandWithVec3","g","BufferViewVec3f","b","BufferViewVec4f","h","BufferViewVec2f","R","BufferViewVec4u8","v","BufferViewVec4u16","B","BufferViewVec3u8","M","BufferViewVec3u16","T","w","y","j","O","createBuffer","C","DefaultLoadingContext","S","load","A","triangleFanToTriangles","N","triangleStripToTriangles","I","trianglesToTriangles","L","F","processLoadResult","k","AlphaDiscardMode","P","DepthTestFunction","V","CullFaceOptions","_","Geometry","G","Texture","D","VertexAttribute","z","DefaultMaterial","U","COLOR_GAMMA","q","PrimitiveType","W","$","K","Q","H","J","X","fileType","cache","loadWOSR","url","lods","referenceBoundingBox","boundingBox","isEsriSymbolResource","isWosr","remove","loadGLTF","usePBR","streamDataRequester","model","meta","uri","indexOf","te","isSchematic","treeRendering","customMeta","esriTreeRendering","mrrFactors","materialParamsMixin","specifiedLodIndex","Y","match","Number","Array","Map","forEach","name","stageResources","textures","materials","geometries","lodThreshold","pivotOffset","numberOfVertices","push","parts","material","attributes","normal","color","texCoord0","tangent","Z","alphaMode","has","textureColor","parameters","preMultiplyAlpha","Opaque","set","data","textureNormal","textureOcclusion","textureEmissive","textureMetallicRoughness","emissiveFactor","transparent","Blend","customDepthTest","Lequal","textureAlphaMode","textureAlphaCutoff","alphaCutoff","diffuse","ambient","opacity","doubleSided","doubleSidedType","cullFace","None","Back","vertexColors","vertexTangents","normals","castShadows","receiveSSAO","fillLightsEnabled","textureId","id","colorMixMode","normalTextureId","textureAlphaPremultiplied","params","occlusionTextureId","emissiveTextureId","metallicRoughnessTextureId","metallicFactor","roughnessFactor","ee","indices","position","count","primitiveType","transform","POSITION","typedBuffer","size","elementCount","exclusive","NORMAL","TANGENT","UV0","buffer","COLOR","boundingInfo","getBBMin","getBBMax","Mask","TRIANGLES","TRIANGLE_STRIP","TRIANGLE_FAN","length","getVec","center","radius","Math","min","setVec","fetch","gltfToEngineResources","parseUrl"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport{adjustStaticAGOUrl as e}from\"../../../../core/devEnvironmentUtils.js\";import{get as t,isSome as r,isNone as s}from\"../../../../core/maybe.js\";import{a as o}from\"../../../../chunks/mat3.js\";import{c as i}from\"../../../../chunks/mat3f64.js\";import{a}from\"../../../../chunks/mat4.js\";import{c as u}from\"../../../../chunks/mat4f64.js\";import{m as n,f as l,E as c,l as m,n as d,e as f}from\"../../../../chunks/vec3.js\";import{c as p}from\"../../../../chunks/vec3f64.js\";import{empty as x,expandWithVec3 as g}from\"../../../../geometry/support/aaBoundingBox.js\";import{BufferViewVec3f as b,BufferViewVec4f as h,BufferViewVec2f as R,BufferViewVec4u8 as v,BufferViewVec4u16 as B,BufferViewVec3u8 as M,BufferViewVec3u16 as T}from\"../../../../geometry/support/buffer/BufferView.js\";import{t as w,a as y,s as j}from\"../../../../chunks/vec32.js\";import{t as E,s as O}from\"../../../../chunks/vec42.js\";import{createBuffer as C}from\"../../../../geometry/support/buffer/utils.js\";import{DefaultLoadingContext as S}from\"../../glTF/DefaultLoadingContext.js\";import{load as A}from\"../../glTF/loader.js\";import{triangleFanToTriangles as N,triangleStripToTriangles as I,trianglesToTriangles as L}from\"../../glTF/internal/indexUtils.js\";import{load as F,processLoadResult as k}from\"./wosrLoader.js\";import{AlphaDiscardMode as P,DepthTestFunction as V,CullFaceOptions as _}from\"../../webgl-engine/lib/basicInterfaces.js\";import{Geometry as G}from\"../../webgl-engine/lib/Geometry.js\";import{Texture as D}from\"../../webgl-engine/lib/Texture.js\";import{VertexAttribute as z}from\"../../webgl-engine/lib/VertexAttribute.js\";import{DefaultMaterial as U}from\"../../webgl-engine/materials/DefaultMaterial.js\";import{COLOR_GAMMA as q}from\"../../webgl-engine/materials/DefaultMaterial_COLOR_GAMMA.js\";import{PrimitiveType as W}from\"../../../webgl/enums.js\";import{n as $}from\"../../../../chunks/vec22.js\";import{c as K,f as Q}from\"../../../../chunks/vec43.js\";import{c as H}from\"../../../../chunks/vec33.js\";async function J(s,o){const i=X(e(s));if(\"wosr\"===i.fileType){const e=await(o.cache?o.cache.loadWOSR(i.url,o):F(i.url,o)),t=k(e,o);return{lods:[t],referenceBoundingBox:t.boundingBox,isEsriSymbolResource:!1,isWosr:!0,remove:e.remove}}const a=await(o.cache?o.cache.loadGLTF(i.url,o,o.usePBR):A(new S(o.streamDataRequester),i.url,o,o.usePBR)),u=t(a.model.meta,\"ESRI_proxyEllipsoid\");a.meta.isEsriSymbolResource&&r(u)&&-1!==a.meta.uri.indexOf(\"/RealisticTrees/\")&&te(a,u);const n=a.meta.isEsriSymbolResource?{usePBR:o.usePBR,isSchematic:!1,treeRendering:a.customMeta.esriTreeRendering,mrrFactors:[0,1,.2]}:{usePBR:o.usePBR,isSchematic:!1,mrrFactors:[0,1,.5]},l={...o.materialParamsMixin,treeRendering:a.customMeta.esriTreeRendering};if(null!=i.specifiedLodIndex){const e=Y(a,n,l,i.specifiedLodIndex);let t=e[0].boundingBox;if(0!==i.specifiedLodIndex){t=Y(a,n,l,0)[0].boundingBox}return{lods:e,referenceBoundingBox:t,isEsriSymbolResource:a.meta.isEsriSymbolResource,isWosr:!1,remove:a.remove}}const c=Y(a,n,l);return{lods:c,referenceBoundingBox:c[0].boundingBox,isEsriSymbolResource:a.meta.isEsriSymbolResource,isWosr:!1,remove:a.remove}}function X(e){const t=e.match(/(.*\\.(gltf|glb))(\\?lod=([0-9]+))?$/);if(t)return{fileType:\"gltf\",url:t[1],specifiedLodIndex:null!=t[4]?Number(t[4]):null};return e.match(/(.*\\.(json|json\\.gz))$/)?{fileType:\"wosr\",url:e,specifiedLodIndex:null}:{fileType:\"unknown\",url:e,specifiedLodIndex:null}}function Y(e,t,s,a){const u=e.model,n=i(),l=new Array,c=new Map,m=new Map;return u.lods.forEach(((e,i)=>{if(void 0!==a&&i!==a)return;const d={name:e.name,stageResources:{textures:new Array,materials:new Array,geometries:new Array},lodThreshold:r(e.lodThreshold)?e.lodThreshold:null,pivotOffset:[0,0,0],numberOfVertices:0,boundingBox:x()};l.push(d),e.parts.forEach((e=>{const i=e.material+(e.attributes.normal?\"_normal\":\"\")+(e.attributes.color?\"_color\":\"\")+(e.attributes.texCoord0?\"_texCoord0\":\"\")+(e.attributes.tangent?\"_tangent\":\"\"),a=u.materials.get(e.material),l=r(e.attributes.texCoord0),f=r(e.attributes.normal),p=Z(a.alphaMode);if(!c.has(i)){if(l){if(r(a.textureColor)&&!m.has(a.textureColor)){const e=u.textures.get(a.textureColor),t={...e.parameters,preMultiplyAlpha:p!==P.Opaque};m.set(a.textureColor,new D(e.data,t))}if(r(a.textureNormal)&&!m.has(a.textureNormal)){const e=u.textures.get(a.textureNormal);m.set(a.textureNormal,new D(e.data,e.parameters))}if(r(a.textureOcclusion)&&!m.has(a.textureOcclusion)){const e=u.textures.get(a.textureOcclusion);m.set(a.textureOcclusion,new D(e.data,e.parameters))}if(r(a.textureEmissive)&&!m.has(a.textureEmissive)){const e=u.textures.get(a.textureEmissive);m.set(a.textureEmissive,new D(e.data,e.parameters))}if(r(a.textureMetallicRoughness)&&!m.has(a.textureMetallicRoughness)){const e=u.textures.get(a.textureMetallicRoughness);m.set(a.textureMetallicRoughness,new D(e.data,e.parameters))}}const o=a.color[0]**(1/q),n=a.color[1]**(1/q),d=a.color[2]**(1/q),x=a.emissiveFactor[0]**(1/q),g=a.emissiveFactor[1]**(1/q),b=a.emissiveFactor[2]**(1/q),h=r(a.textureColor)&&l?m.get(a.textureColor):null;c.set(i,new U({...t,transparent:p===P.Blend,customDepthTest:V.Lequal,textureAlphaMode:p,textureAlphaCutoff:a.alphaCutoff,diffuse:[o,n,d],ambient:[o,n,d],opacity:a.opacity,doubleSided:a.doubleSided,doubleSidedType:\"winding-order\",cullFace:a.doubleSided?_.None:_.Back,vertexColors:!!e.attributes.color,vertexTangents:!!e.attributes.tangent,normals:f?\"default\":\"screenDerivative\",castShadows:!0,receiveSSAO:!0,fillLightsEnabled:!0,textureId:r(h)?h.id:void 0,colorMixMode:a.colorMixMode,normalTextureId:r(a.textureNormal)&&l?m.get(a.textureNormal).id:void 0,textureAlphaPremultiplied:r(h)&&!!h.params.preMultiplyAlpha,occlusionTextureId:r(a.textureOcclusion)&&l?m.get(a.textureOcclusion).id:void 0,emissiveTextureId:r(a.textureEmissive)&&l?m.get(a.textureEmissive).id:void 0,metallicRoughnessTextureId:r(a.textureMetallicRoughness)&&l?m.get(a.textureMetallicRoughness).id:void 0,emissiveFactor:[x,g,b],mrrFactors:[a.metallicFactor,a.roughnessFactor,t.mrrFactors[2]],isSchematic:!1,...s}))}const x=ee(e.indices||e.attributes.position.count,e.primitiveType),S=e.attributes.position.count,A=C(b,S);w(A,e.attributes.position,e.transform);const N=[[z.POSITION,{data:A.typedBuffer,size:A.elementCount,exclusive:!0}]],I=[[z.POSITION,x]];if(r(e.attributes.normal)){const t=C(b,S);o(n,e.transform),y(t,e.attributes.normal,n),N.push([z.NORMAL,{data:t.typedBuffer,size:t.elementCount,exclusive:!0}]),I.push([z.NORMAL,x])}if(r(e.attributes.tangent)){const t=C(h,S);o(n,e.transform),E(t,e.attributes.tangent,n),N.push([z.TANGENT,{data:t.typedBuffer,size:t.elementCount,exclusive:!0}]),I.push([z.TANGENT,x])}if(r(e.attributes.texCoord0)){const t=C(R,S);$(t,e.attributes.texCoord0),N.push([z.UV0,{data:t.typedBuffer,size:t.elementCount,exclusive:!0}]),I.push([z.UV0,x])}if(r(e.attributes.color)){const t=C(v,S);if(4===e.attributes.color.elementCount)e.attributes.color instanceof h?O(t,e.attributes.color,255):e.attributes.color instanceof v?K(t,e.attributes.color):e.attributes.color instanceof B&&O(t,e.attributes.color,1/256);else{Q(t,255,255,255,255);const r=new M(t.buffer,0,4);e.attributes.color instanceof b?j(r,e.attributes.color,255):e.attributes.color instanceof M?H(r,e.attributes.color):e.attributes.color instanceof T&&j(r,e.attributes.color,1/256)}N.push([z.COLOR,{data:t.typedBuffer,size:t.elementCount,exclusive:!0}]),I.push([z.COLOR,x])}const L=new G(N,I);d.stageResources.geometries.push(L),d.stageResources.materials.push(c.get(i)),l&&(r(a.textureColor)&&d.stageResources.textures.push(m.get(a.textureColor)),r(a.textureNormal)&&d.stageResources.textures.push(m.get(a.textureNormal)),r(a.textureOcclusion)&&d.stageResources.textures.push(m.get(a.textureOcclusion)),r(a.textureEmissive)&&d.stageResources.textures.push(m.get(a.textureEmissive)),r(a.textureMetallicRoughness)&&d.stageResources.textures.push(m.get(a.textureMetallicRoughness))),d.numberOfVertices+=S;const F=L.boundingInfo;r(F)&&(g(d.boundingBox,F.getBBMin()),g(d.boundingBox,F.getBBMax()))}))})),l}function Z(e){switch(e){case\"BLEND\":return P.Blend;case\"MASK\":return P.Mask;case\"OPAQUE\":case null:case void 0:return P.Opaque}}function ee(e,t){switch(t){case W.TRIANGLES:return L(e);case W.TRIANGLE_STRIP:return I(e);case W.TRIANGLE_FAN:return N(e)}}function te(e,t){for(let r=0;r<e.model.lods.length;++r){const o=e.model.lods[r];e.customMeta.esriTreeRendering=!0;for(const i of o.parts){const o=i.attributes.normal;if(s(o))return;const x=i.attributes.position,g=x.count,h=p(),R=p(),B=p(),M=C(v,g),T=C(b,g),w=a(u(),i.transform);for(let s=0;s<g;s++){x.getVec(s,R),o.getVec(s,h),n(R,R,i.transform),l(B,R,t.center),c(B,B,t.radius);const a=B[2],u=m(B),p=Math.min(.45+.55*u*u,1);c(B,B,t.radius),n(B,B,w),d(B,B),r+1!==e.model.lods.length&&e.model.lods.length>1&&f(B,B,h,a>-1?.2:Math.min(-4*a-3.8,1)),T.setVec(s,B),M.set(s,0,255*p),M.set(s,1,255*p),M.set(s,2,255*p),M.set(s,3,255)}i.attributes.normal=T,i.attributes.color=M}}}export{J as fetch,Y as gltfToEngineResources,X as parseUrl};\n"]},"metadata":{},"sourceType":"module"}