{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport { isSome as e } from \"../../../core/maybe.js\";\nimport { slice as t } from \"../../../core/typedArrayUtil.js\";\nimport { IndexType as r } from \"../../../libs/i3s/enums.js\";\nimport { get as n } from \"../../../libs/i3s/I3SModule.js\";\nimport { NodeIMModificationImpact as o } from \"./i3s/I3SNode.js\";\n\nasync function s(e) {\n  await g();\n  const t = [e.geometryBuffer];\n  return {\n    result: m(e, t),\n    transferList: t\n  };\n}\n\nasync function f(e) {\n  var r;\n  await g();\n\n  const n = [e.geometryBuffer],\n        {\n    geometryBuffer: o\n  } = e,\n        s = o.byteLength,\n        f = y._malloc(s),\n        i = new Uint8Array(y.HEAPU8.buffer, f, s);\n\n  i.set(new Uint8Array(o));\n  const a = y.dracoDecompressPointCloudData(f, i.byteLength);\n  if (y._free(f), a.error.length > 0) throw `i3s.wasm: ${a.error}`;\n  const u = (null == (r = a.featureIds) ? void 0 : r.length) > 0 ? t(a.featureIds) : null,\n        l = t(a.positions);\n  u && n.push(u.buffer), n.push(l.buffer);\n  return {\n    result: {\n      positions: l,\n      featureIds: u\n    },\n    transferList: n\n  };\n}\n\nasync function i(e) {\n  await g(), E(e);\n  const t = {\n    buffer: e.buffer\n  };\n  return {\n    result: t,\n    transferList: [t.buffer]\n  };\n}\n\nasync function a(e) {\n  await g(), b(e);\n}\n\nasync function u(e) {\n  await g(), y.setLegacySchema(e.context, e.jsonSchema);\n}\n\nfunction l(e) {\n  h(e);\n}\n\nlet c, y;\n\nfunction b(e) {\n  const t = e.modifications,\n        r = y._malloc(8 * t.length),\n        n = new Float64Array(y.HEAPU8.buffer, r, t.length);\n\n  for (let o = 0; o < t.length; ++o) n[o] = t[o];\n\n  y.setModifications(e.context, r, t.length, e.isGeodetic), y._free(r);\n}\n\nfunction m(n, o) {\n  if (!y) return null;\n\n  const {\n    context: s,\n    localOrigin: f,\n    globalTrafo: i,\n    mbs: a,\n    obb: u,\n    elevationOffset: l,\n    geometryBuffer: c,\n    geometryDescriptor: b,\n    indexToVertexProjector: m,\n    vertexToRenderProjector: d\n  } = n,\n        E = y._malloc(c.byteLength),\n        h = 33,\n        g = y._malloc(h * Float64Array.BYTES_PER_ELEMENT),\n        w = new Uint8Array(y.HEAPU8.buffer, E, c.byteLength);\n\n  w.set(new Uint8Array(c));\n  const A = new Float64Array(y.HEAPU8.buffer, g, h);\n  p(A, f);\n\n  let _ = A.byteOffset + 3 * A.BYTES_PER_ELEMENT,\n      L = new Float64Array(A.buffer, _);\n\n  p(L, i), _ += 16 * A.BYTES_PER_ELEMENT, L = new Float64Array(A.buffer, _), p(L, a), _ += 4 * A.BYTES_PER_ELEMENT, e(u) && (L = new Float64Array(A.buffer, _), p(L, u.center), _ += 3 * A.BYTES_PER_ELEMENT, L = new Float64Array(A.buffer, _), p(L, u.halfSize), _ += 3 * A.BYTES_PER_ELEMENT, L = new Float64Array(A.buffer, _), p(L, u.quaternion));\n  const I = b,\n        T = {\n    isDraco: !1,\n    isLegacy: !1,\n    color: n.layouts.some(e => e.some(e => \"color\" === e.name)),\n    normal: n.needNormals && n.layouts.some(e => e.some(e => \"normalCompressed\" === e.name)),\n    uv0: n.layouts.some(e => e.some(e => \"uv0\" === e.name)),\n    uvRegion: n.layouts.some(e => e.some(e => \"uvRegion\" === e.name)),\n    featureIndex: I.featureIndex\n  },\n        P = y.process(s, !!n.obb, E, w.byteLength, I, T, g, l, m, d, n.normalReferenceFrame);\n  if (y._free(g), y._free(E), P.error.length > 0) throw `i3s.wasm: ${P.error}`;\n  if (P.discarded) return null;\n  const U = P.componentOffsets.length > 0 ? t(P.componentOffsets) : null,\n        B = P.featureIds.length > 0 ? t(P.featureIds) : null,\n        F = t(P.interleavedVertedData).buffer,\n        M = P.indicesType === r.Int16 ? t(new Uint16Array(P.indices.buffer, P.indices.byteOffset, P.indices.byteLength / 2)) : t(new Uint32Array(P.indices.buffer, P.indices.byteOffset, P.indices.byteLength / 4)),\n        S = t(P.positions),\n        v = P.positionIndicesType === r.Int16 ? t(new Uint16Array(P.positionIndices.buffer, P.positionIndices.byteOffset, P.positionIndices.byteLength / 2)) : t(new Uint32Array(P.positionIndices.buffer, P.positionIndices.byteOffset, P.positionIndices.byteLength / 4)),\n        x = {\n    layout: n.layouts[0],\n    interleavedVertexData: F,\n    indices: M,\n    hasColors: P.hasColors,\n    hasModifications: P.hasModifications,\n    positionData: {\n      data: S,\n      indices: v\n    }\n  };\n  return B && o.push(B.buffer), U && o.push(U.buffer), o.push(F), o.push(M.buffer), o.push(S.buffer), o.push(v.buffer), {\n    componentOffsets: U,\n    featureIds: B,\n    transformedGeometry: x,\n    obb: P.obb\n  };\n}\n\nfunction d(e) {\n  return 0 === e ? o.Unmodified : 1 === e ? o.PotentiallyModified : 2 === e ? o.Culled : o.Unknown;\n}\n\nfunction E(e) {\n  const {\n    context: t,\n    buffer: r\n  } = e,\n        n = y._malloc(r.byteLength),\n        o = r.byteLength / Float64Array.BYTES_PER_ELEMENT,\n        s = new Float64Array(y.HEAPU8.buffer, n, o),\n        f = new Float64Array(r);\n\n  s.set(f), y.filterOBBs(t, n, o), f.set(s), y._free(n);\n}\n\nfunction h(e) {\n  y && y.destroy(e);\n}\n\nfunction p(e, t) {\n  for (let r = 0; r < t.length; ++r) e[r] = t[r];\n}\n\nfunction g() {\n  return y ? Promise.resolve() : (c || (c = n().then(e => {\n    y = e, c = null;\n  })), c);\n}\n\nconst w = {\n  transform: m,\n  destroy: h\n};\nexport { l as destroyContext, f as dracoDecompressPointCloudData, i as filterObbsForModifications, E as filterObbsForModificationsSync, g as initialize, d as interpretObbModificationResults, s as process, u as setLegacySchema, a as setModifications, b as setModificationsSync, w as test };","map":{"version":3,"sources":["D:/Github/CUSP_DataBase/CUSP_DB/src/main/gis/node_modules/@arcgis/core/views/3d/layers/SceneLayerWorker.js"],"names":["isSome","e","slice","t","IndexType","r","get","n","NodeIMModificationImpact","o","s","g","geometryBuffer","result","m","transferList","f","byteLength","y","_malloc","i","Uint8Array","HEAPU8","buffer","set","a","dracoDecompressPointCloudData","_free","error","length","u","featureIds","l","positions","push","E","b","setLegacySchema","context","jsonSchema","h","c","modifications","Float64Array","setModifications","isGeodetic","localOrigin","globalTrafo","mbs","obb","elevationOffset","geometryDescriptor","indexToVertexProjector","vertexToRenderProjector","d","BYTES_PER_ELEMENT","w","A","p","_","byteOffset","L","center","halfSize","quaternion","I","T","isDraco","isLegacy","color","layouts","some","name","normal","needNormals","uv0","uvRegion","featureIndex","P","process","normalReferenceFrame","discarded","U","componentOffsets","B","F","interleavedVertedData","M","indicesType","Int16","Uint16Array","indices","Uint32Array","S","v","positionIndicesType","positionIndices","x","layout","interleavedVertexData","hasColors","hasModifications","positionData","data","transformedGeometry","Unmodified","PotentiallyModified","Culled","Unknown","filterOBBs","destroy","Promise","resolve","then","transform","destroyContext","filterObbsForModifications","filterObbsForModificationsSync","initialize","interpretObbModificationResults","setModificationsSync","test"],"mappings":"AAAA;AACA;AACA;AACA;AACA,SAAOA,MAAM,IAAIC,CAAjB,QAAuB,wBAAvB;AAAgD,SAAOC,KAAK,IAAIC,CAAhB,QAAsB,iCAAtB;AAAwD,SAAOC,SAAS,IAAIC,CAApB,QAA0B,4BAA1B;AAAuD,SAAOC,GAAG,IAAIC,CAAd,QAAoB,gCAApB;AAAqD,SAAOC,wBAAwB,IAAIC,CAAnC,QAAyC,kBAAzC;;AAA4D,eAAeC,CAAf,CAAiBT,CAAjB,EAAmB;AAAC,QAAMU,CAAC,EAAP;AAAU,QAAMR,CAAC,GAAC,CAACF,CAAC,CAACW,cAAH,CAAR;AAA2B,SAAM;AAACC,IAAAA,MAAM,EAACC,CAAC,CAACb,CAAD,EAAGE,CAAH,CAAT;AAAeY,IAAAA,YAAY,EAACZ;AAA5B,GAAN;AAAqC;;AAAA,eAAea,CAAf,CAAiBf,CAAjB,EAAmB;AAAC,MAAII,CAAJ;AAAM,QAAMM,CAAC,EAAP;;AAAU,QAAMJ,CAAC,GAAC,CAACN,CAAC,CAACW,cAAH,CAAR;AAAA,QAA2B;AAACA,IAAAA,cAAc,EAACH;AAAhB,MAAmBR,CAA9C;AAAA,QAAgDS,CAAC,GAACD,CAAC,CAACQ,UAApD;AAAA,QAA+DD,CAAC,GAACE,CAAC,CAACC,OAAF,CAAUT,CAAV,CAAjE;AAAA,QAA8EU,CAAC,GAAC,IAAIC,UAAJ,CAAeH,CAAC,CAACI,MAAF,CAASC,MAAxB,EAA+BP,CAA/B,EAAiCN,CAAjC,CAAhF;;AAAoHU,EAAAA,CAAC,CAACI,GAAF,CAAM,IAAIH,UAAJ,CAAeZ,CAAf,CAAN;AAAyB,QAAMgB,CAAC,GAACP,CAAC,CAACQ,6BAAF,CAAgCV,CAAhC,EAAkCI,CAAC,CAACH,UAApC,CAAR;AAAwD,MAAGC,CAAC,CAACS,KAAF,CAAQX,CAAR,GAAWS,CAAC,CAACG,KAAF,CAAQC,MAAR,GAAe,CAA7B,EAA+B,MAAM,aAAYJ,CAAC,CAACG,KAAM,EAA1B;AAA4B,QAAME,CAAC,GAAC,CAAC,SAAOzB,CAAC,GAACoB,CAAC,CAACM,UAAX,IAAuB,KAAK,CAA5B,GAA8B1B,CAAC,CAACwB,MAAjC,IAAyC,CAAzC,GAA2C1B,CAAC,CAACsB,CAAC,CAACM,UAAH,CAA5C,GAA2D,IAAnE;AAAA,QAAwEC,CAAC,GAAC7B,CAAC,CAACsB,CAAC,CAACQ,SAAH,CAA3E;AAAyFH,EAAAA,CAAC,IAAEvB,CAAC,CAAC2B,IAAF,CAAOJ,CAAC,CAACP,MAAT,CAAH,EAAoBhB,CAAC,CAAC2B,IAAF,CAAOF,CAAC,CAACT,MAAT,CAApB;AAAqC,SAAM;AAACV,IAAAA,MAAM,EAAC;AAACoB,MAAAA,SAAS,EAACD,CAAX;AAAaD,MAAAA,UAAU,EAACD;AAAxB,KAAR;AAAmCf,IAAAA,YAAY,EAACR;AAAhD,GAAN;AAAyD;;AAAA,eAAea,CAAf,CAAiBnB,CAAjB,EAAmB;AAAC,QAAMU,CAAC,EAAP,EAAUwB,CAAC,CAAClC,CAAD,CAAX;AAAe,QAAME,CAAC,GAAC;AAACoB,IAAAA,MAAM,EAACtB,CAAC,CAACsB;AAAV,GAAR;AAA0B,SAAM;AAACV,IAAAA,MAAM,EAACV,CAAR;AAAUY,IAAAA,YAAY,EAAC,CAACZ,CAAC,CAACoB,MAAH;AAAvB,GAAN;AAAyC;;AAAA,eAAeE,CAAf,CAAiBxB,CAAjB,EAAmB;AAAC,QAAMU,CAAC,EAAP,EAAUyB,CAAC,CAACnC,CAAD,CAAX;AAAe;;AAAA,eAAe6B,CAAf,CAAiB7B,CAAjB,EAAmB;AAAC,QAAMU,CAAC,EAAP,EAAUO,CAAC,CAACmB,eAAF,CAAkBpC,CAAC,CAACqC,OAApB,EAA4BrC,CAAC,CAACsC,UAA9B,CAAV;AAAoD;;AAAA,SAASP,CAAT,CAAW/B,CAAX,EAAa;AAACuC,EAAAA,CAAC,CAACvC,CAAD,CAAD;AAAK;;AAAA,IAAIwC,CAAJ,EAAMvB,CAAN;;AAAQ,SAASkB,CAAT,CAAWnC,CAAX,EAAa;AAAC,QAAME,CAAC,GAACF,CAAC,CAACyC,aAAV;AAAA,QAAwBrC,CAAC,GAACa,CAAC,CAACC,OAAF,CAAU,IAAEhB,CAAC,CAAC0B,MAAd,CAA1B;AAAA,QAAgDtB,CAAC,GAAC,IAAIoC,YAAJ,CAAiBzB,CAAC,CAACI,MAAF,CAASC,MAA1B,EAAiClB,CAAjC,EAAmCF,CAAC,CAAC0B,MAArC,CAAlD;;AAA+F,OAAI,IAAIpB,CAAC,GAAC,CAAV,EAAYA,CAAC,GAACN,CAAC,CAAC0B,MAAhB,EAAuB,EAAEpB,CAAzB,EAA2BF,CAAC,CAACE,CAAD,CAAD,GAAKN,CAAC,CAACM,CAAD,CAAN;;AAAUS,EAAAA,CAAC,CAAC0B,gBAAF,CAAmB3C,CAAC,CAACqC,OAArB,EAA6BjC,CAA7B,EAA+BF,CAAC,CAAC0B,MAAjC,EAAwC5B,CAAC,CAAC4C,UAA1C,GAAsD3B,CAAC,CAACS,KAAF,CAAQtB,CAAR,CAAtD;AAAiE;;AAAA,SAASS,CAAT,CAAWP,CAAX,EAAaE,CAAb,EAAe;AAAC,MAAG,CAACS,CAAJ,EAAM,OAAO,IAAP;;AAAY,QAAK;AAACoB,IAAAA,OAAO,EAAC5B,CAAT;AAAWoC,IAAAA,WAAW,EAAC9B,CAAvB;AAAyB+B,IAAAA,WAAW,EAAC3B,CAArC;AAAuC4B,IAAAA,GAAG,EAACvB,CAA3C;AAA6CwB,IAAAA,GAAG,EAACnB,CAAjD;AAAmDoB,IAAAA,eAAe,EAAClB,CAAnE;AAAqEpB,IAAAA,cAAc,EAAC6B,CAApF;AAAsFU,IAAAA,kBAAkB,EAACf,CAAzG;AAA2GgB,IAAAA,sBAAsB,EAACtC,CAAlI;AAAoIuC,IAAAA,uBAAuB,EAACC;AAA5J,MAA+J/C,CAApK;AAAA,QAAsK4B,CAAC,GAACjB,CAAC,CAACC,OAAF,CAAUsB,CAAC,CAACxB,UAAZ,CAAxK;AAAA,QAAgMuB,CAAC,GAAC,EAAlM;AAAA,QAAqM7B,CAAC,GAACO,CAAC,CAACC,OAAF,CAAUqB,CAAC,GAACG,YAAY,CAACY,iBAAzB,CAAvM;AAAA,QAAmPC,CAAC,GAAC,IAAInC,UAAJ,CAAeH,CAAC,CAACI,MAAF,CAASC,MAAxB,EAA+BY,CAA/B,EAAiCM,CAAC,CAACxB,UAAnC,CAArP;;AAAoSuC,EAAAA,CAAC,CAAChC,GAAF,CAAM,IAAIH,UAAJ,CAAeoB,CAAf,CAAN;AAAyB,QAAMgB,CAAC,GAAC,IAAId,YAAJ,CAAiBzB,CAAC,CAACI,MAAF,CAASC,MAA1B,EAAiCZ,CAAjC,EAAmC6B,CAAnC,CAAR;AAA8CkB,EAAAA,CAAC,CAACD,CAAD,EAAGzC,CAAH,CAAD;;AAAO,MAAI2C,CAAC,GAACF,CAAC,CAACG,UAAF,GAAa,IAAEH,CAAC,CAACF,iBAAvB;AAAA,MAAyCM,CAAC,GAAC,IAAIlB,YAAJ,CAAiBc,CAAC,CAAClC,MAAnB,EAA0BoC,CAA1B,CAA3C;;AAAwED,EAAAA,CAAC,CAACG,CAAD,EAAGzC,CAAH,CAAD,EAAOuC,CAAC,IAAE,KAAGF,CAAC,CAACF,iBAAf,EAAiCM,CAAC,GAAC,IAAIlB,YAAJ,CAAiBc,CAAC,CAAClC,MAAnB,EAA0BoC,CAA1B,CAAnC,EAAgED,CAAC,CAACG,CAAD,EAAGpC,CAAH,CAAjE,EAAuEkC,CAAC,IAAE,IAAEF,CAAC,CAACF,iBAA9E,EAAgGtD,CAAC,CAAC6B,CAAD,CAAD,KAAO+B,CAAC,GAAC,IAAIlB,YAAJ,CAAiBc,CAAC,CAAClC,MAAnB,EAA0BoC,CAA1B,CAAF,EAA+BD,CAAC,CAACG,CAAD,EAAG/B,CAAC,CAACgC,MAAL,CAAhC,EAA6CH,CAAC,IAAE,IAAEF,CAAC,CAACF,iBAApD,EAAsEM,CAAC,GAAC,IAAIlB,YAAJ,CAAiBc,CAAC,CAAClC,MAAnB,EAA0BoC,CAA1B,CAAxE,EAAqGD,CAAC,CAACG,CAAD,EAAG/B,CAAC,CAACiC,QAAL,CAAtG,EAAqHJ,CAAC,IAAE,IAAEF,CAAC,CAACF,iBAA5H,EAA8IM,CAAC,GAAC,IAAIlB,YAAJ,CAAiBc,CAAC,CAAClC,MAAnB,EAA0BoC,CAA1B,CAAhJ,EAA6KD,CAAC,CAACG,CAAD,EAAG/B,CAAC,CAACkC,UAAL,CAArL,CAAhG;AAAuS,QAAMC,CAAC,GAAC7B,CAAR;AAAA,QAAU8B,CAAC,GAAC;AAACC,IAAAA,OAAO,EAAC,CAAC,CAAV;AAAYC,IAAAA,QAAQ,EAAC,CAAC,CAAtB;AAAwBC,IAAAA,KAAK,EAAC9D,CAAC,CAAC+D,OAAF,CAAUC,IAAV,CAAgBtE,CAAC,IAAEA,CAAC,CAACsE,IAAF,CAAQtE,CAAC,IAAE,YAAUA,CAAC,CAACuE,IAAvB,CAAnB,CAA9B;AAAiFC,IAAAA,MAAM,EAAClE,CAAC,CAACmE,WAAF,IAAenE,CAAC,CAAC+D,OAAF,CAAUC,IAAV,CAAgBtE,CAAC,IAAEA,CAAC,CAACsE,IAAF,CAAQtE,CAAC,IAAE,uBAAqBA,CAAC,CAACuE,IAAlC,CAAnB,CAAvG;AAAqKG,IAAAA,GAAG,EAACpE,CAAC,CAAC+D,OAAF,CAAUC,IAAV,CAAgBtE,CAAC,IAAEA,CAAC,CAACsE,IAAF,CAAQtE,CAAC,IAAE,UAAQA,CAAC,CAACuE,IAArB,CAAnB,CAAzK;AAA0NI,IAAAA,QAAQ,EAACrE,CAAC,CAAC+D,OAAF,CAAUC,IAAV,CAAgBtE,CAAC,IAAEA,CAAC,CAACsE,IAAF,CAAQtE,CAAC,IAAE,eAAaA,CAAC,CAACuE,IAA1B,CAAnB,CAAnO;AAAyRK,IAAAA,YAAY,EAACZ,CAAC,CAACY;AAAxS,GAAZ;AAAA,QAAkUC,CAAC,GAAC5D,CAAC,CAAC6D,OAAF,CAAUrE,CAAV,EAAY,CAAC,CAACH,CAAC,CAAC0C,GAAhB,EAAoBd,CAApB,EAAsBqB,CAAC,CAACvC,UAAxB,EAAmCgD,CAAnC,EAAqCC,CAArC,EAAuCvD,CAAvC,EAAyCqB,CAAzC,EAA2ClB,CAA3C,EAA6CwC,CAA7C,EAA+C/C,CAAC,CAACyE,oBAAjD,CAApU;AAA2Y,MAAG9D,CAAC,CAACS,KAAF,CAAQhB,CAAR,GAAWO,CAAC,CAACS,KAAF,CAAQQ,CAAR,CAAX,EAAsB2C,CAAC,CAAClD,KAAF,CAAQC,MAAR,GAAe,CAAxC,EAA0C,MAAM,aAAYiD,CAAC,CAAClD,KAAM,EAA1B;AAA4B,MAAGkD,CAAC,CAACG,SAAL,EAAe,OAAO,IAAP;AAAY,QAAMC,CAAC,GAACJ,CAAC,CAACK,gBAAF,CAAmBtD,MAAnB,GAA0B,CAA1B,GAA4B1B,CAAC,CAAC2E,CAAC,CAACK,gBAAH,CAA7B,GAAkD,IAA1D;AAAA,QAA+DC,CAAC,GAACN,CAAC,CAAC/C,UAAF,CAAaF,MAAb,GAAoB,CAApB,GAAsB1B,CAAC,CAAC2E,CAAC,CAAC/C,UAAH,CAAvB,GAAsC,IAAvG;AAAA,QAA4GsD,CAAC,GAAClF,CAAC,CAAC2E,CAAC,CAACQ,qBAAH,CAAD,CAA2B/D,MAAzI;AAAA,QAAgJgE,CAAC,GAACT,CAAC,CAACU,WAAF,KAAgBnF,CAAC,CAACoF,KAAlB,GAAwBtF,CAAC,CAAC,IAAIuF,WAAJ,CAAgBZ,CAAC,CAACa,OAAF,CAAUpE,MAA1B,EAAiCuD,CAAC,CAACa,OAAF,CAAU/B,UAA3C,EAAsDkB,CAAC,CAACa,OAAF,CAAU1E,UAAV,GAAqB,CAA3E,CAAD,CAAzB,GAAyGd,CAAC,CAAC,IAAIyF,WAAJ,CAAgBd,CAAC,CAACa,OAAF,CAAUpE,MAA1B,EAAiCuD,CAAC,CAACa,OAAF,CAAU/B,UAA3C,EAAsDkB,CAAC,CAACa,OAAF,CAAU1E,UAAV,GAAqB,CAA3E,CAAD,CAA5P;AAAA,QAA4U4E,CAAC,GAAC1F,CAAC,CAAC2E,CAAC,CAAC7C,SAAH,CAA/U;AAAA,QAA6V6D,CAAC,GAAChB,CAAC,CAACiB,mBAAF,KAAwB1F,CAAC,CAACoF,KAA1B,GAAgCtF,CAAC,CAAC,IAAIuF,WAAJ,CAAgBZ,CAAC,CAACkB,eAAF,CAAkBzE,MAAlC,EAAyCuD,CAAC,CAACkB,eAAF,CAAkBpC,UAA3D,EAAsEkB,CAAC,CAACkB,eAAF,CAAkB/E,UAAlB,GAA6B,CAAnG,CAAD,CAAjC,GAAyId,CAAC,CAAC,IAAIyF,WAAJ,CAAgBd,CAAC,CAACkB,eAAF,CAAkBzE,MAAlC,EAAyCuD,CAAC,CAACkB,eAAF,CAAkBpC,UAA3D,EAAsEkB,CAAC,CAACkB,eAAF,CAAkB/E,UAAlB,GAA6B,CAAnG,CAAD,CAAze;AAAA,QAAilBgF,CAAC,GAAC;AAACC,IAAAA,MAAM,EAAC3F,CAAC,CAAC+D,OAAF,CAAU,CAAV,CAAR;AAAqB6B,IAAAA,qBAAqB,EAACd,CAA3C;AAA6CM,IAAAA,OAAO,EAACJ,CAArD;AAAuDa,IAAAA,SAAS,EAACtB,CAAC,CAACsB,SAAnE;AAA6EC,IAAAA,gBAAgB,EAACvB,CAAC,CAACuB,gBAAhG;AAAiHC,IAAAA,YAAY,EAAC;AAACC,MAAAA,IAAI,EAACV,CAAN;AAAQF,MAAAA,OAAO,EAACG;AAAhB;AAA9H,GAAnlB;AAAquB,SAAOV,CAAC,IAAE3E,CAAC,CAACyB,IAAF,CAAOkD,CAAC,CAAC7D,MAAT,CAAH,EAAoB2D,CAAC,IAAEzE,CAAC,CAACyB,IAAF,CAAOgD,CAAC,CAAC3D,MAAT,CAAvB,EAAwCd,CAAC,CAACyB,IAAF,CAAOmD,CAAP,CAAxC,EAAkD5E,CAAC,CAACyB,IAAF,CAAOqD,CAAC,CAAChE,MAAT,CAAlD,EAAmEd,CAAC,CAACyB,IAAF,CAAO2D,CAAC,CAACtE,MAAT,CAAnE,EAAoFd,CAAC,CAACyB,IAAF,CAAO4D,CAAC,CAACvE,MAAT,CAApF,EAAqG;AAAC4D,IAAAA,gBAAgB,EAACD,CAAlB;AAAoBnD,IAAAA,UAAU,EAACqD,CAA/B;AAAiCoB,IAAAA,mBAAmB,EAACP,CAArD;AAAuDhD,IAAAA,GAAG,EAAC6B,CAAC,CAAC7B;AAA7D,GAA5G;AAA8K;;AAAA,SAASK,CAAT,CAAWrD,CAAX,EAAa;AAAC,SAAO,MAAIA,CAAJ,GAAMQ,CAAC,CAACgG,UAAR,GAAmB,MAAIxG,CAAJ,GAAMQ,CAAC,CAACiG,mBAAR,GAA4B,MAAIzG,CAAJ,GAAMQ,CAAC,CAACkG,MAAR,GAAelG,CAAC,CAACmG,OAAvE;AAA+E;;AAAA,SAASzE,CAAT,CAAWlC,CAAX,EAAa;AAAC,QAAK;AAACqC,IAAAA,OAAO,EAACnC,CAAT;AAAWoB,IAAAA,MAAM,EAAClB;AAAlB,MAAqBJ,CAA1B;AAAA,QAA4BM,CAAC,GAACW,CAAC,CAACC,OAAF,CAAUd,CAAC,CAACY,UAAZ,CAA9B;AAAA,QAAsDR,CAAC,GAACJ,CAAC,CAACY,UAAF,GAAa0B,YAAY,CAACY,iBAAlF;AAAA,QAAoG7C,CAAC,GAAC,IAAIiC,YAAJ,CAAiBzB,CAAC,CAACI,MAAF,CAASC,MAA1B,EAAiChB,CAAjC,EAAmCE,CAAnC,CAAtG;AAAA,QAA4IO,CAAC,GAAC,IAAI2B,YAAJ,CAAiBtC,CAAjB,CAA9I;;AAAkKK,EAAAA,CAAC,CAACc,GAAF,CAAMR,CAAN,GAASE,CAAC,CAAC2F,UAAF,CAAa1G,CAAb,EAAeI,CAAf,EAAiBE,CAAjB,CAAT,EAA6BO,CAAC,CAACQ,GAAF,CAAMd,CAAN,CAA7B,EAAsCQ,CAAC,CAACS,KAAF,CAAQpB,CAAR,CAAtC;AAAiD;;AAAA,SAASiC,CAAT,CAAWvC,CAAX,EAAa;AAACiB,EAAAA,CAAC,IAAEA,CAAC,CAAC4F,OAAF,CAAU7G,CAAV,CAAH;AAAgB;;AAAA,SAASyD,CAAT,CAAWzD,CAAX,EAAaE,CAAb,EAAe;AAAC,OAAI,IAAIE,CAAC,GAAC,CAAV,EAAYA,CAAC,GAACF,CAAC,CAAC0B,MAAhB,EAAuB,EAAExB,CAAzB,EAA2BJ,CAAC,CAACI,CAAD,CAAD,GAAKF,CAAC,CAACE,CAAD,CAAN;AAAU;;AAAA,SAASM,CAAT,GAAY;AAAC,SAAOO,CAAC,GAAC6F,OAAO,CAACC,OAAR,EAAD,IAAoBvE,CAAC,KAAGA,CAAC,GAAClC,CAAC,GAAG0G,IAAJ,CAAUhH,CAAC,IAAE;AAACiB,IAAAA,CAAC,GAACjB,CAAF,EAAIwC,CAAC,GAAC,IAAN;AAAW,GAAzB,CAAL,CAAD,EAAmCA,CAAvD,CAAR;AAAkE;;AAAA,MAAMe,CAAC,GAAC;AAAC0D,EAAAA,SAAS,EAACpG,CAAX;AAAagG,EAAAA,OAAO,EAACtE;AAArB,CAAR;AAAgC,SAAOR,CAAC,IAAImF,cAAZ,EAA2BnG,CAAC,IAAIU,6BAAhC,EAA8DN,CAAC,IAAIgG,0BAAnE,EAA8FjF,CAAC,IAAIkF,8BAAnG,EAAkI1G,CAAC,IAAI2G,UAAvI,EAAkJhE,CAAC,IAAIiE,+BAAvJ,EAAuL7G,CAAC,IAAIqE,OAA5L,EAAoMjD,CAAC,IAAIO,eAAzM,EAAyNZ,CAAC,IAAImB,gBAA9N,EAA+OR,CAAC,IAAIoF,oBAApP,EAAyQhE,CAAC,IAAIiE,IAA9Q","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport{isSome as e}from\"../../../core/maybe.js\";import{slice as t}from\"../../../core/typedArrayUtil.js\";import{IndexType as r}from\"../../../libs/i3s/enums.js\";import{get as n}from\"../../../libs/i3s/I3SModule.js\";import{NodeIMModificationImpact as o}from\"./i3s/I3SNode.js\";async function s(e){await g();const t=[e.geometryBuffer];return{result:m(e,t),transferList:t}}async function f(e){var r;await g();const n=[e.geometryBuffer],{geometryBuffer:o}=e,s=o.byteLength,f=y._malloc(s),i=new Uint8Array(y.HEAPU8.buffer,f,s);i.set(new Uint8Array(o));const a=y.dracoDecompressPointCloudData(f,i.byteLength);if(y._free(f),a.error.length>0)throw`i3s.wasm: ${a.error}`;const u=(null==(r=a.featureIds)?void 0:r.length)>0?t(a.featureIds):null,l=t(a.positions);u&&n.push(u.buffer),n.push(l.buffer);return{result:{positions:l,featureIds:u},transferList:n}}async function i(e){await g(),E(e);const t={buffer:e.buffer};return{result:t,transferList:[t.buffer]}}async function a(e){await g(),b(e)}async function u(e){await g(),y.setLegacySchema(e.context,e.jsonSchema)}function l(e){h(e)}let c,y;function b(e){const t=e.modifications,r=y._malloc(8*t.length),n=new Float64Array(y.HEAPU8.buffer,r,t.length);for(let o=0;o<t.length;++o)n[o]=t[o];y.setModifications(e.context,r,t.length,e.isGeodetic),y._free(r)}function m(n,o){if(!y)return null;const{context:s,localOrigin:f,globalTrafo:i,mbs:a,obb:u,elevationOffset:l,geometryBuffer:c,geometryDescriptor:b,indexToVertexProjector:m,vertexToRenderProjector:d}=n,E=y._malloc(c.byteLength),h=33,g=y._malloc(h*Float64Array.BYTES_PER_ELEMENT),w=new Uint8Array(y.HEAPU8.buffer,E,c.byteLength);w.set(new Uint8Array(c));const A=new Float64Array(y.HEAPU8.buffer,g,h);p(A,f);let _=A.byteOffset+3*A.BYTES_PER_ELEMENT,L=new Float64Array(A.buffer,_);p(L,i),_+=16*A.BYTES_PER_ELEMENT,L=new Float64Array(A.buffer,_),p(L,a),_+=4*A.BYTES_PER_ELEMENT,e(u)&&(L=new Float64Array(A.buffer,_),p(L,u.center),_+=3*A.BYTES_PER_ELEMENT,L=new Float64Array(A.buffer,_),p(L,u.halfSize),_+=3*A.BYTES_PER_ELEMENT,L=new Float64Array(A.buffer,_),p(L,u.quaternion));const I=b,T={isDraco:!1,isLegacy:!1,color:n.layouts.some((e=>e.some((e=>\"color\"===e.name)))),normal:n.needNormals&&n.layouts.some((e=>e.some((e=>\"normalCompressed\"===e.name)))),uv0:n.layouts.some((e=>e.some((e=>\"uv0\"===e.name)))),uvRegion:n.layouts.some((e=>e.some((e=>\"uvRegion\"===e.name)))),featureIndex:I.featureIndex},P=y.process(s,!!n.obb,E,w.byteLength,I,T,g,l,m,d,n.normalReferenceFrame);if(y._free(g),y._free(E),P.error.length>0)throw`i3s.wasm: ${P.error}`;if(P.discarded)return null;const U=P.componentOffsets.length>0?t(P.componentOffsets):null,B=P.featureIds.length>0?t(P.featureIds):null,F=t(P.interleavedVertedData).buffer,M=P.indicesType===r.Int16?t(new Uint16Array(P.indices.buffer,P.indices.byteOffset,P.indices.byteLength/2)):t(new Uint32Array(P.indices.buffer,P.indices.byteOffset,P.indices.byteLength/4)),S=t(P.positions),v=P.positionIndicesType===r.Int16?t(new Uint16Array(P.positionIndices.buffer,P.positionIndices.byteOffset,P.positionIndices.byteLength/2)):t(new Uint32Array(P.positionIndices.buffer,P.positionIndices.byteOffset,P.positionIndices.byteLength/4)),x={layout:n.layouts[0],interleavedVertexData:F,indices:M,hasColors:P.hasColors,hasModifications:P.hasModifications,positionData:{data:S,indices:v}};return B&&o.push(B.buffer),U&&o.push(U.buffer),o.push(F),o.push(M.buffer),o.push(S.buffer),o.push(v.buffer),{componentOffsets:U,featureIds:B,transformedGeometry:x,obb:P.obb}}function d(e){return 0===e?o.Unmodified:1===e?o.PotentiallyModified:2===e?o.Culled:o.Unknown}function E(e){const{context:t,buffer:r}=e,n=y._malloc(r.byteLength),o=r.byteLength/Float64Array.BYTES_PER_ELEMENT,s=new Float64Array(y.HEAPU8.buffer,n,o),f=new Float64Array(r);s.set(f),y.filterOBBs(t,n,o),f.set(s),y._free(n)}function h(e){y&&y.destroy(e)}function p(e,t){for(let r=0;r<t.length;++r)e[r]=t[r]}function g(){return y?Promise.resolve():(c||(c=n().then((e=>{y=e,c=null}))),c)}const w={transform:m,destroy:h};export{l as destroyContext,f as dracoDecompressPointCloudData,i as filterObbsForModifications,E as filterObbsForModificationsSync,g as initialize,d as interpretObbModificationResults,s as process,u as setLegacySchema,a as setModifications,b as setModificationsSync,w as test};\n"]},"metadata":{},"sourceType":"module"}