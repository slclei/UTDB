{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport { isSome as e, isNone as t } from \"../../../../../core/maybe.js\";\nimport { TranslateAnchor as i } from \"../../vectorTiles/style/StyleDefinition.js\";\nimport { VTL_TEXTURE_BINDING_UNIT_SPRITES as n } from \"../definitions.js\";\nimport { WGLDrawPhase as a } from \"../enums.js\";\nimport { u32to4Xu8 as r } from \"../number.js\";\nimport o from \"./WGLBrush.js\";\nimport { TextureSamplingMode as s, CompareFunction as l, PrimitiveType as f, DataType as m } from \"../../../../webgl/enums.js\";\n\nclass u extends o {\n  constructor() {\n    super(...arguments), this._programOptions = {\n      id: !1,\n      pattern: !1,\n      sdf: !1\n    };\n  }\n\n  dispose() {}\n\n  drawMany(o, u) {\n    const {\n      context: c,\n      displayLevel: p,\n      state: d,\n      drawPhase: g,\n      painter: y,\n      pixelRatio: E,\n      spriteMosaic: v,\n      styleLayerUID: M\n    } = o;\n    if (!u.some(e => {\n      var t, i;\n      return null != (t = null == (i = e.layerData.get(M)) ? void 0 : i.lineIndexCount) && t;\n    })) return;\n\n    const _ = o.styleLayer,\n          U = _.lineMaterial,\n          I = y.vectorTilesMaterialManager,\n          P = _.getPaintValue(\"line-translate\", p),\n          x = _.getPaintValue(\"line-translate-anchor\", p),\n          T = _.getPaintProperty(\"line-pattern\"),\n          S = void 0 !== T,\n          D = S && T.isDataDriven;\n\n    let L, N;\n\n    if (S && !D) {\n      const e = T.getValue(p);\n      L = v.getMosaicItemPosition(e);\n    }\n\n    let V = !1;\n\n    if (!S) {\n      const e = _.getPaintProperty(\"line-dasharray\");\n\n      if (N = void 0 !== e, V = N && e.isDataDriven, N && !V) {\n        const t = e.getValue(p),\n              i = _.getDashKey(t, _.getLayoutValue(\"line-cap\", p));\n\n        L = v.getMosaicItemPosition(i);\n      }\n    }\n\n    const R = 1 / E,\n          h = g === a.HITTEST,\n          A = this._programOptions;\n    A.id = h, A.pattern = S, A.sdf = N;\n    const j = I.getMaterialProgram(c, U, A);\n\n    if (c.useProgram(j), j.setUniformMatrix3fv(\"u_displayViewMat3\", d.displayViewMat3), j.setUniformMatrix3fv(\"u_displayMat3\", x === i.VIEWPORT ? d.displayMat3 : d.displayViewMat3), j.setUniform2fv(\"u_lineTranslation\", P), j.setUniform1f(\"u_depth\", _.z), j.setUniform1f(\"u_antialiasing\", R), h) {\n      const e = r(M + 1);\n      j.setUniform4fv(\"u_id\", e);\n    }\n\n    if (L && e(L)) {\n      const {\n        page: t\n      } = L,\n            i = v.getPageSize(t);\n      e(i) && (v.bind(c, s.LINEAR, t, n), j.setUniform2fv(\"u_mosaicSize\", i), j.setUniform1i(\"u_texture\", n));\n    }\n\n    let w = -1;\n\n    for (const i of u) {\n      if (!i.layerData.has(M)) continue;\n      i.key.level !== w && (w = i.key.level, U.setDataUniforms(j, p, _, w, v));\n      const a = 2 ** (p - w) / E;\n      j.setUniform1f(\"u_zoomFactor\", a);\n      const r = i.layerData.get(M);\n      if (!r.lineIndexCount) continue;\n      r.prepareForRendering(c);\n      const o = r.lineVertexArrayObject;\n\n      if (!t(o)) {\n        if (c.bindVAO(o), j.setUniformMatrix3fv(\"u_dvsMat3\", i.transforms.dvs), c.setStencilFunction(l.EQUAL, i.stencilRef, 255), D || V) {\n          const t = r.patternMap;\n          if (!t) continue;\n\n          for (const [i, a] of t) {\n            const t = v.getPageSize(i);\n            e(t) && (v.bind(c, s.LINEAR, i, n), j.setUniform2fv(\"u_mosaicSize\", t), j.setUniform1i(\"u_texture\", n), c.drawElements(f.TRIANGLES, a[1], m.UNSIGNED_INT, Uint32Array.BYTES_PER_ELEMENT * a[0]));\n          }\n        } else c.drawElements(f.TRIANGLES, r.lineIndexCount, m.UNSIGNED_INT, Uint32Array.BYTES_PER_ELEMENT * r.lineIndexStart);\n\n        i.triangleCount += r.lineIndexCount / 3;\n      }\n    }\n  }\n\n}\n\nexport { u as WGLBrushVTLLine };","map":{"version":3,"sources":["D:/Github/CUSP_DataBase/CUSP_DB/src/main/gis/node_modules/@arcgis/core/views/2d/engine/webgl/brushes/WGLBrushVTLLine.js"],"names":["isSome","e","isNone","t","TranslateAnchor","i","VTL_TEXTURE_BINDING_UNIT_SPRITES","n","WGLDrawPhase","a","u32to4Xu8","r","o","TextureSamplingMode","s","CompareFunction","l","PrimitiveType","f","DataType","m","u","constructor","arguments","_programOptions","id","pattern","sdf","dispose","drawMany","context","c","displayLevel","p","state","d","drawPhase","g","painter","y","pixelRatio","E","spriteMosaic","v","styleLayerUID","M","some","layerData","get","lineIndexCount","_","styleLayer","U","lineMaterial","I","vectorTilesMaterialManager","P","getPaintValue","x","T","getPaintProperty","S","D","isDataDriven","L","N","getValue","getMosaicItemPosition","V","getDashKey","getLayoutValue","R","h","HITTEST","A","j","getMaterialProgram","useProgram","setUniformMatrix3fv","displayViewMat3","VIEWPORT","displayMat3","setUniform2fv","setUniform1f","z","setUniform4fv","page","getPageSize","bind","LINEAR","setUniform1i","w","has","key","level","setDataUniforms","prepareForRendering","lineVertexArrayObject","bindVAO","transforms","dvs","setStencilFunction","EQUAL","stencilRef","patternMap","drawElements","TRIANGLES","UNSIGNED_INT","Uint32Array","BYTES_PER_ELEMENT","lineIndexStart","triangleCount","WGLBrushVTLLine"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport{isSome as e,isNone as t}from\"../../../../../core/maybe.js\";import{TranslateAnchor as i}from\"../../vectorTiles/style/StyleDefinition.js\";import{VTL_TEXTURE_BINDING_UNIT_SPRITES as n}from\"../definitions.js\";import{WGLDrawPhase as a}from\"../enums.js\";import{u32to4Xu8 as r}from\"../number.js\";import o from\"./WGLBrush.js\";import{TextureSamplingMode as s,CompareFunction as l,PrimitiveType as f,DataType as m}from\"../../../../webgl/enums.js\";class u extends o{constructor(){super(...arguments),this._programOptions={id:!1,pattern:!1,sdf:!1}}dispose(){}drawMany(o,u){const{context:c,displayLevel:p,state:d,drawPhase:g,painter:y,pixelRatio:E,spriteMosaic:v,styleLayerUID:M}=o;if(!u.some((e=>{var t,i;return null!=(t=null==(i=e.layerData.get(M))?void 0:i.lineIndexCount)&&t})))return;const _=o.styleLayer,U=_.lineMaterial,I=y.vectorTilesMaterialManager,P=_.getPaintValue(\"line-translate\",p),x=_.getPaintValue(\"line-translate-anchor\",p),T=_.getPaintProperty(\"line-pattern\"),S=void 0!==T,D=S&&T.isDataDriven;let L,N;if(S&&!D){const e=T.getValue(p);L=v.getMosaicItemPosition(e)}let V=!1;if(!S){const e=_.getPaintProperty(\"line-dasharray\");if(N=void 0!==e,V=N&&e.isDataDriven,N&&!V){const t=e.getValue(p),i=_.getDashKey(t,_.getLayoutValue(\"line-cap\",p));L=v.getMosaicItemPosition(i)}}const R=1/E,h=g===a.HITTEST,A=this._programOptions;A.id=h,A.pattern=S,A.sdf=N;const j=I.getMaterialProgram(c,U,A);if(c.useProgram(j),j.setUniformMatrix3fv(\"u_displayViewMat3\",d.displayViewMat3),j.setUniformMatrix3fv(\"u_displayMat3\",x===i.VIEWPORT?d.displayMat3:d.displayViewMat3),j.setUniform2fv(\"u_lineTranslation\",P),j.setUniform1f(\"u_depth\",_.z),j.setUniform1f(\"u_antialiasing\",R),h){const e=r(M+1);j.setUniform4fv(\"u_id\",e)}if(L&&e(L)){const{page:t}=L,i=v.getPageSize(t);e(i)&&(v.bind(c,s.LINEAR,t,n),j.setUniform2fv(\"u_mosaicSize\",i),j.setUniform1i(\"u_texture\",n))}let w=-1;for(const i of u){if(!i.layerData.has(M))continue;i.key.level!==w&&(w=i.key.level,U.setDataUniforms(j,p,_,w,v));const a=2**(p-w)/E;j.setUniform1f(\"u_zoomFactor\",a);const r=i.layerData.get(M);if(!r.lineIndexCount)continue;r.prepareForRendering(c);const o=r.lineVertexArrayObject;if(!t(o)){if(c.bindVAO(o),j.setUniformMatrix3fv(\"u_dvsMat3\",i.transforms.dvs),c.setStencilFunction(l.EQUAL,i.stencilRef,255),D||V){const t=r.patternMap;if(!t)continue;for(const[i,a]of t){const t=v.getPageSize(i);e(t)&&(v.bind(c,s.LINEAR,i,n),j.setUniform2fv(\"u_mosaicSize\",t),j.setUniform1i(\"u_texture\",n),c.drawElements(f.TRIANGLES,a[1],m.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*a[0]))}}else c.drawElements(f.TRIANGLES,r.lineIndexCount,m.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*r.lineIndexStart);i.triangleCount+=r.lineIndexCount/3}}}}export{u as WGLBrushVTLLine};\n"]},"metadata":{},"sourceType":"module"}