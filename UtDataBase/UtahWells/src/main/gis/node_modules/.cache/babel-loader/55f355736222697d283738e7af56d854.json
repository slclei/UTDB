{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport t from \"../../../../../core/ArrayPool.js\";\nimport { e } from \"../../../../../chunks/earcut.js\";\nimport { triangulate as i } from \"../../../../../geometry/libtess.js\";\nimport { BucketType as r } from \"../enums.js\";\nimport l from \"./BaseBucket.js\";\nimport { Point as n } from \"../../webgl/Geometry.js\";\n\nclass s extends l {\n  constructor(t, e, i, l, n, s, o) {\n    super(t, e, i), this.type = r.FILL, this._patternMap = new Map(), this._fillVertexBuffer = l, this._fillIndexBuffer = n, this._outlineVertexBuffer = s, this._outlineIndexBuffer = o;\n  }\n\n  get fillIndexStart() {\n    return this._fillIndexStart;\n  }\n\n  get fillIndexCount() {\n    return this._fillIndexCount;\n  }\n\n  get outlineIndexStart() {\n    return this._outlineIndexStart;\n  }\n\n  get outlineIndexCount() {\n    return this._outlineIndexCount;\n  }\n\n  getResources(t, e, i) {\n    const r = this.layer,\n          l = this.zoom,\n          n = r.getPaintProperty(\"fill-pattern\");\n    if (n) if (n.isDataDriven) for (const s of this._features) e(n.getValue(l, s), !0);else e(n.getValue(l), !0);\n  }\n\n  processFeatures(t) {\n    this._fillIndexStart = 3 * this._fillIndexBuffer.index, this._fillIndexCount = 0, this._outlineIndexStart = 3 * this._outlineIndexBuffer.index, this._outlineIndexCount = 0;\n    const e = this.layer,\n          i = this.zoom,\n          {\n      fillMaterial: r,\n      outlineMaterial: l,\n      hasDataDrivenFill: n,\n      hasDataDrivenOutline: s\n    } = e;\n    t && t.setExtent(this.layerExtent);\n    const o = e.getPaintProperty(\"fill-pattern\"),\n          a = null == o ? void 0 : o.isDataDriven;\n    let f = !o && e.getPaintValue(\"fill-antialias\", i);\n\n    if (e.outlineUsesFillColor) {\n      if (f && !e.hasDataDrivenOpacity) {\n        const t = e.getPaintValue(\"fill-opacity\", i),\n              r = e.getPaintValue(\"fill-opacity\", i + 1);\n        t < 1 && r < 1 && (f = !1);\n      }\n\n      if (f && !e.hasDataDrivenColor) {\n        const t = e.getPaintValue(\"fill-color\", i),\n              r = e.getPaintValue(\"fill-color\", i + 1);\n        t[3] < 1 && r[3] < 1 && (f = !1);\n      }\n    }\n\n    const u = this._features,\n          d = null == t ? void 0 : t.validateTessellation;\n\n    if (a) {\n      const n = [];\n\n      for (const a of u) {\n        const u = o.getValue(i, a),\n              h = this._spriteInfo[u];\n        if (!h || !h.rect) continue;\n\n        const x = r.encodeAttributes(a, i, e, h),\n              c = f && s ? l.encodeAttributes(a, i, e) : [],\n              _ = a.getGeometry(t);\n\n        n.push({\n          ddFillAttributes: x,\n          ddOutlineAttributes: c,\n          page: h.page,\n          geometry: _\n        }), n.sort((t, e) => t.page - e.page);\n\n        for (const {\n          ddFillAttributes: t,\n          ddOutlineAttributes: i,\n          page: r,\n          geometry: l\n        } of n) this._processFeature(l, f, e.outlineUsesFillColor, t, i, d, r);\n      }\n    } else for (const h of u) {\n      const o = n ? r.encodeAttributes(h, i, e) : null,\n            a = f && s ? l.encodeAttributes(h, i, e) : null,\n            u = h.getGeometry(t);\n\n      this._processFeature(u, f, e.outlineUsesFillColor, o, a, d);\n    }\n  }\n\n  serialize() {\n    let t = 10;\n    t += this.layerUIDs.length, t += this._fillVertexBuffer.array.length, t += this._fillIndexBuffer.array.length, t += this._outlineVertexBuffer.array.length, t += this._outlineIndexBuffer.array.length, t += 3 * this._patternMap.size + 1;\n    const e = new Uint32Array(t),\n          i = new Int32Array(e.buffer);\n    let r = 0;\n    e[r++] = this.type, e[r++] = this.layerUIDs.length;\n\n    for (let s = 0; s < this.layerUIDs.length; s++) e[r++] = this.layerUIDs[s];\n\n    e[r++] = this._fillIndexStart, e[r++] = this._fillIndexCount, e[r++] = this._outlineIndexStart, e[r++] = this._outlineIndexCount;\n    const l = this._patternMap,\n          n = l.size;\n    if (e[r++] = n, n > 0) for (const [s, [o, a]] of l) e[r++] = s, e[r++] = o, e[r++] = a;\n    e[r++] = this._fillVertexBuffer.array.length;\n\n    for (let s = 0; s < this._fillVertexBuffer.array.length; s++) i[r++] = this._fillVertexBuffer.array[s];\n\n    e[r++] = this._fillIndexBuffer.array.length;\n\n    for (let s = 0; s < this._fillIndexBuffer.array.length; s++) e[r++] = this._fillIndexBuffer.array[s];\n\n    e[r++] = this._outlineVertexBuffer.array.length;\n\n    for (let s = 0; s < this._outlineVertexBuffer.array.length; s++) i[r++] = this._outlineVertexBuffer.array[s];\n\n    e[r++] = this._outlineIndexBuffer.array.length;\n\n    for (let s = 0; s < this._outlineIndexBuffer.array.length; s++) e[r++] = this._outlineIndexBuffer.array[s];\n\n    return e.buffer;\n  }\n\n  _processFeature(t, e, i, r, l, n, o) {\n    if (!t) return;\n    const a = t.length,\n          f = !l || 0 === l.length;\n    if (e && (!i || f)) for (let s = 0; s < a; s++) this._processOutline(t[s], l);\n    const u = 32;\n    let d;\n\n    for (let h = 0; h < a; h++) {\n      const e = s._area(t[h]);\n\n      e > u ? (void 0 !== d && this._processFill(t, d, r, n, o), d = [h]) : e < -u && void 0 !== d && d.push(h);\n    }\n\n    void 0 !== d && this._processFill(t, d, r, n, o);\n  }\n\n  _processOutline(t, e) {\n    const i = this._outlineVertexBuffer,\n          r = this._outlineIndexBuffer,\n          l = r.index;\n    let s, o, a;\n    const f = new n(0, 0),\n          u = new n(0, 0),\n          d = new n(0, 0);\n\n    let h = -1,\n        x = -1,\n        c = -1,\n        _ = -1,\n        y = -1,\n        g = !1;\n\n    const p = 0;\n    let I = t.length;\n    if (I < 2) return;\n    const B = t[p];\n    let m = t[I - 1];\n\n    for (; I && m.isEqual(B);) --I, m = t[I - 1];\n\n    if (!(I - p < 2)) {\n      for (let l = p; l < I; ++l) {\n        l === p ? (s = t[I - 1], o = t[p], a = t[p + 1], f.assignSub(o, s), f.normalize(), f.rightPerpendicular()) : (s = o, o = a, a = l !== I - 1 ? t[l + 1] : t[p], f.assign(u));\n\n        const n = this._isClipEdge(s, o);\n\n        -1 === _ && (g = n), u.assignSub(a, o), u.normalize(), u.rightPerpendicular();\n        const B = f.x * u.y - f.y * u.x;\n        d.assignAdd(f, u), d.normalize();\n        const m = -d.x * -f.x + -d.y * -f.y;\n        let V = Math.abs(0 !== m ? 1 / m : 1);\n        V > 8 && (V = 8), B >= 0 ? (c = i.add(o.x, o.y, f.x, f.y, 0, 1, e), -1 === _ && (_ = c), h >= 0 && x >= 0 && c >= 0 && !n && r.add(h, x, c), x = i.add(o.x, o.y, V * -d.x, V * -d.y, 0, -1, e), -1 === y && (y = x), h >= 0 && x >= 0 && c >= 0 && !n && r.add(h, x, c), h = x, x = c, c = i.add(o.x, o.y, d.x, d.y, 0, 1, e), h >= 0 && x >= 0 && c >= 0 && !n && r.add(h, x, c), x = i.add(o.x, o.y, u.x, u.y, 0, 1, e), h >= 0 && x >= 0 && c >= 0 && !n && r.add(h, x, c)) : (c = i.add(o.x, o.y, V * d.x, V * d.y, 0, 1, e), -1 === _ && (_ = c), h >= 0 && x >= 0 && c >= 0 && !n && r.add(h, x, c), x = i.add(o.x, o.y, -f.x, -f.y, 0, -1, e), -1 === y && (y = x), h >= 0 && x >= 0 && c >= 0 && !n && r.add(h, x, c), h = x, x = c, c = i.add(o.x, o.y, -d.x, -d.y, 0, -1, e), h >= 0 && x >= 0 && c >= 0 && !n && r.add(h, x, c), h = i.add(o.x, o.y, -u.x, -u.y, 0, -1, e), h >= 0 && x >= 0 && c >= 0 && !n && r.add(h, x, c));\n      }\n\n      h >= 0 && x >= 0 && _ >= 0 && !g && r.add(h, x, _), h >= 0 && _ >= 0 && y >= 0 && !g && r.add(h, y, _), this._outlineIndexCount += 3 * (r.index - l);\n    }\n  }\n\n  _processFill(r, l, n, s, o) {\n    s = !0;\n    let a;\n    l.length > 1 && (a = []);\n    let f = 0;\n\n    for (const t of l) 0 !== f && a.push(f), f += r[t].length;\n\n    const u = 2 * f,\n          d = t.acquire();\n\n    for (const t of l) {\n      const e = r[t],\n            i = e.length;\n\n      for (let t = 0; t < i; ++t) d.push(e[t].x, e[t].y);\n    }\n\n    const h = e(d, a, 2);\n\n    if (s && e.deviation(d, a, 2, h) > 0) {\n      const t = l.map(t => r[t].length),\n            {\n        buffer: e,\n        vertexCount: s\n      } = i(d, t);\n\n      if (s > 0) {\n        const t = this._fillVertexBuffer.index;\n\n        for (let i = 0; i < s; i++) this._fillVertexBuffer.add(e[2 * i], e[2 * i + 1], n);\n\n        for (let e = 0; e < s; e += 3) {\n          const i = t + e;\n\n          this._fillIndexBuffer.add(i, i + 1, i + 2);\n        }\n\n        if (void 0 !== o) {\n          const t = this._patternMap,\n                e = t.get(o);\n          e ? e[1] += s : t.set(o, [this._fillIndexStart + this._fillIndexCount, s]);\n        }\n\n        this._fillIndexCount += s;\n      }\n    } else {\n      const t = h.length;\n\n      if (t > 0) {\n        const e = this._fillVertexBuffer.index;\n        let i = 0;\n\n        for (; i < u;) this._fillVertexBuffer.add(d[i++], d[i++], n);\n\n        let r = 0;\n\n        for (; r < t;) this._fillIndexBuffer.add(e + h[r++], e + h[r++], e + h[r++]);\n\n        if (void 0 !== o) {\n          const e = this._patternMap,\n                i = e.get(o);\n          i ? i[1] += t : e.set(o, [this._fillIndexStart + this._fillIndexCount, t]);\n        }\n\n        this._fillIndexCount += t;\n      }\n    }\n\n    t.release(d);\n  }\n\n  _isClipEdge(t, e) {\n    return t.x === e.x ? t.x <= -64 || t.x >= 4160 : t.y === e.y && (t.y <= -64 || t.y >= 4160);\n  }\n\n  static _area(t) {\n    let e = 0;\n    const i = t.length - 1;\n\n    for (let r = 0; r < i; r++) e += (t[r].x - t[r + 1].x) * (t[r].y + t[r + 1].y);\n\n    return e += (t[i].x - t[0].x) * (t[i].y + t[0].y), .5 * e;\n  }\n\n}\n\nexport { s as default };","map":{"version":3,"sources":["D:/Github/CUSP_DataBase/CUSP_DB/src/main/gis/node_modules/@arcgis/core/views/2d/engine/vectorTiles/buckets/FillBucket.js"],"names":["t","e","triangulate","i","BucketType","r","l","Point","n","s","constructor","o","type","FILL","_patternMap","Map","_fillVertexBuffer","_fillIndexBuffer","_outlineVertexBuffer","_outlineIndexBuffer","fillIndexStart","_fillIndexStart","fillIndexCount","_fillIndexCount","outlineIndexStart","_outlineIndexStart","outlineIndexCount","_outlineIndexCount","getResources","layer","zoom","getPaintProperty","isDataDriven","_features","getValue","processFeatures","index","fillMaterial","outlineMaterial","hasDataDrivenFill","hasDataDrivenOutline","setExtent","layerExtent","a","f","getPaintValue","outlineUsesFillColor","hasDataDrivenOpacity","hasDataDrivenColor","u","d","validateTessellation","h","_spriteInfo","rect","x","encodeAttributes","c","_","getGeometry","push","ddFillAttributes","ddOutlineAttributes","page","geometry","sort","_processFeature","serialize","layerUIDs","length","array","size","Uint32Array","Int32Array","buffer","_processOutline","_area","_processFill","y","g","p","I","B","m","isEqual","assignSub","normalize","rightPerpendicular","assign","_isClipEdge","assignAdd","V","Math","abs","add","acquire","deviation","map","vertexCount","get","set","release","default"],"mappings":"AAAA;AACA;AACA;AACA;AACA,OAAOA,CAAP,MAAa,kCAAb;AAAgD,SAAOC,CAAP,QAAa,iCAAb;AAA+C,SAAOC,WAAW,IAAIC,CAAtB,QAA4B,oCAA5B;AAAiE,SAAOC,UAAU,IAAIC,CAArB,QAA2B,aAA3B;AAAyC,OAAOC,CAAP,MAAa,iBAAb;AAA+B,SAAOC,KAAK,IAAIC,CAAhB,QAAsB,yBAAtB;;AAAgD,MAAMC,CAAN,SAAgBH,CAAhB,CAAiB;AAACI,EAAAA,WAAW,CAACV,CAAD,EAAGC,CAAH,EAAKE,CAAL,EAAOG,CAAP,EAASE,CAAT,EAAWC,CAAX,EAAaE,CAAb,EAAe;AAAC,UAAMX,CAAN,EAAQC,CAAR,EAAUE,CAAV,GAAa,KAAKS,IAAL,GAAUP,CAAC,CAACQ,IAAzB,EAA8B,KAAKC,WAAL,GAAiB,IAAIC,GAAJ,EAA/C,EAAuD,KAAKC,iBAAL,GAAuBV,CAA9E,EAAgF,KAAKW,gBAAL,GAAsBT,CAAtG,EAAwG,KAAKU,oBAAL,GAA0BT,CAAlI,EAAoI,KAAKU,mBAAL,GAAyBR,CAA7J;AAA+J;;AAAkB,MAAdS,cAAc,GAAE;AAAC,WAAO,KAAKC,eAAZ;AAA4B;;AAAkB,MAAdC,cAAc,GAAE;AAAC,WAAO,KAAKC,eAAZ;AAA4B;;AAAqB,MAAjBC,iBAAiB,GAAE;AAAC,WAAO,KAAKC,kBAAZ;AAA+B;;AAAqB,MAAjBC,iBAAiB,GAAE;AAAC,WAAO,KAAKC,kBAAZ;AAA+B;;AAAAC,EAAAA,YAAY,CAAC5B,CAAD,EAAGC,CAAH,EAAKE,CAAL,EAAO;AAAC,UAAME,CAAC,GAAC,KAAKwB,KAAb;AAAA,UAAmBvB,CAAC,GAAC,KAAKwB,IAA1B;AAAA,UAA+BtB,CAAC,GAACH,CAAC,CAAC0B,gBAAF,CAAmB,cAAnB,CAAjC;AAAoE,QAAGvB,CAAH,EAAK,IAAGA,CAAC,CAACwB,YAAL,EAAkB,KAAI,MAAMvB,CAAV,IAAe,KAAKwB,SAApB,EAA8BhC,CAAC,CAACO,CAAC,CAAC0B,QAAF,CAAW5B,CAAX,EAAaG,CAAb,CAAD,EAAiB,CAAC,CAAlB,CAAD,CAAhD,KAA2ER,CAAC,CAACO,CAAC,CAAC0B,QAAF,CAAW5B,CAAX,CAAD,EAAe,CAAC,CAAhB,CAAD;AAAoB;;AAAA6B,EAAAA,eAAe,CAACnC,CAAD,EAAG;AAAC,SAAKqB,eAAL,GAAqB,IAAE,KAAKJ,gBAAL,CAAsBmB,KAA7C,EAAmD,KAAKb,eAAL,GAAqB,CAAxE,EAA0E,KAAKE,kBAAL,GAAwB,IAAE,KAAKN,mBAAL,CAAyBiB,KAA7H,EAAmI,KAAKT,kBAAL,GAAwB,CAA3J;AAA6J,UAAM1B,CAAC,GAAC,KAAK4B,KAAb;AAAA,UAAmB1B,CAAC,GAAC,KAAK2B,IAA1B;AAAA,UAA+B;AAACO,MAAAA,YAAY,EAAChC,CAAd;AAAgBiC,MAAAA,eAAe,EAAChC,CAAhC;AAAkCiC,MAAAA,iBAAiB,EAAC/B,CAApD;AAAsDgC,MAAAA,oBAAoB,EAAC/B;AAA3E,QAA8ER,CAA7G;AAA+GD,IAAAA,CAAC,IAAEA,CAAC,CAACyC,SAAF,CAAY,KAAKC,WAAjB,CAAH;AAAiC,UAAM/B,CAAC,GAACV,CAAC,CAAC8B,gBAAF,CAAmB,cAAnB,CAAR;AAAA,UAA2CY,CAAC,GAAC,QAAMhC,CAAN,GAAQ,KAAK,CAAb,GAAeA,CAAC,CAACqB,YAA9D;AAA2E,QAAIY,CAAC,GAAC,CAACjC,CAAD,IAAIV,CAAC,CAAC4C,aAAF,CAAgB,gBAAhB,EAAiC1C,CAAjC,CAAV;;AAA8C,QAAGF,CAAC,CAAC6C,oBAAL,EAA0B;AAAC,UAAGF,CAAC,IAAE,CAAC3C,CAAC,CAAC8C,oBAAT,EAA8B;AAAC,cAAM/C,CAAC,GAACC,CAAC,CAAC4C,aAAF,CAAgB,cAAhB,EAA+B1C,CAA/B,CAAR;AAAA,cAA0CE,CAAC,GAACJ,CAAC,CAAC4C,aAAF,CAAgB,cAAhB,EAA+B1C,CAAC,GAAC,CAAjC,CAA5C;AAAgFH,QAAAA,CAAC,GAAC,CAAF,IAAKK,CAAC,GAAC,CAAP,KAAWuC,CAAC,GAAC,CAAC,CAAd;AAAiB;;AAAA,UAAGA,CAAC,IAAE,CAAC3C,CAAC,CAAC+C,kBAAT,EAA4B;AAAC,cAAMhD,CAAC,GAACC,CAAC,CAAC4C,aAAF,CAAgB,YAAhB,EAA6B1C,CAA7B,CAAR;AAAA,cAAwCE,CAAC,GAACJ,CAAC,CAAC4C,aAAF,CAAgB,YAAhB,EAA6B1C,CAAC,GAAC,CAA/B,CAA1C;AAA4EH,QAAAA,CAAC,CAAC,CAAD,CAAD,GAAK,CAAL,IAAQK,CAAC,CAAC,CAAD,CAAD,GAAK,CAAb,KAAiBuC,CAAC,GAAC,CAAC,CAApB;AAAuB;AAAC;;AAAA,UAAMK,CAAC,GAAC,KAAKhB,SAAb;AAAA,UAAuBiB,CAAC,GAAC,QAAMlD,CAAN,GAAQ,KAAK,CAAb,GAAeA,CAAC,CAACmD,oBAA1C;;AAA+D,QAAGR,CAAH,EAAK;AAAC,YAAMnC,CAAC,GAAC,EAAR;;AAAW,WAAI,MAAMmC,CAAV,IAAeM,CAAf,EAAiB;AAAC,cAAMA,CAAC,GAACtC,CAAC,CAACuB,QAAF,CAAW/B,CAAX,EAAawC,CAAb,CAAR;AAAA,cAAwBS,CAAC,GAAC,KAAKC,WAAL,CAAiBJ,CAAjB,CAA1B;AAA8C,YAAG,CAACG,CAAD,IAAI,CAACA,CAAC,CAACE,IAAV,EAAe;;AAAS,cAAMC,CAAC,GAAClD,CAAC,CAACmD,gBAAF,CAAmBb,CAAnB,EAAqBxC,CAArB,EAAuBF,CAAvB,EAAyBmD,CAAzB,CAAR;AAAA,cAAoCK,CAAC,GAACb,CAAC,IAAEnC,CAAH,GAAKH,CAAC,CAACkD,gBAAF,CAAmBb,CAAnB,EAAqBxC,CAArB,EAAuBF,CAAvB,CAAL,GAA+B,EAArE;AAAA,cAAwEyD,CAAC,GAACf,CAAC,CAACgB,WAAF,CAAc3D,CAAd,CAA1E;;AAA2FQ,QAAAA,CAAC,CAACoD,IAAF,CAAO;AAACC,UAAAA,gBAAgB,EAACN,CAAlB;AAAoBO,UAAAA,mBAAmB,EAACL,CAAxC;AAA0CM,UAAAA,IAAI,EAACX,CAAC,CAACW,IAAjD;AAAsDC,UAAAA,QAAQ,EAACN;AAA/D,SAAP,GAA0ElD,CAAC,CAACyD,IAAF,CAAQ,CAACjE,CAAD,EAAGC,CAAH,KAAOD,CAAC,CAAC+D,IAAF,GAAO9D,CAAC,CAAC8D,IAAxB,CAA1E;;AAAyG,aAAI,MAAK;AAACF,UAAAA,gBAAgB,EAAC7D,CAAlB;AAAoB8D,UAAAA,mBAAmB,EAAC3D,CAAxC;AAA0C4D,UAAAA,IAAI,EAAC1D,CAA/C;AAAiD2D,UAAAA,QAAQ,EAAC1D;AAA1D,SAAT,IAAwEE,CAAxE,EAA0E,KAAK0D,eAAL,CAAqB5D,CAArB,EAAuBsC,CAAvB,EAAyB3C,CAAC,CAAC6C,oBAA3B,EAAgD9C,CAAhD,EAAkDG,CAAlD,EAAoD+C,CAApD,EAAsD7C,CAAtD;AAAyD;AAAC,KAAjb,MAAsb,KAAI,MAAM+C,CAAV,IAAeH,CAAf,EAAiB;AAAC,YAAMtC,CAAC,GAACH,CAAC,GAACH,CAAC,CAACmD,gBAAF,CAAmBJ,CAAnB,EAAqBjD,CAArB,EAAuBF,CAAvB,CAAD,GAA2B,IAApC;AAAA,YAAyC0C,CAAC,GAACC,CAAC,IAAEnC,CAAH,GAAKH,CAAC,CAACkD,gBAAF,CAAmBJ,CAAnB,EAAqBjD,CAArB,EAAuBF,CAAvB,CAAL,GAA+B,IAA1E;AAAA,YAA+EgD,CAAC,GAACG,CAAC,CAACO,WAAF,CAAc3D,CAAd,CAAjF;;AAAkG,WAAKkE,eAAL,CAAqBjB,CAArB,EAAuBL,CAAvB,EAAyB3C,CAAC,CAAC6C,oBAA3B,EAAgDnC,CAAhD,EAAkDgC,CAAlD,EAAoDO,CAApD;AAAuD;AAAC;;AAAAiB,EAAAA,SAAS,GAAE;AAAC,QAAInE,CAAC,GAAC,EAAN;AAASA,IAAAA,CAAC,IAAE,KAAKoE,SAAL,CAAeC,MAAlB,EAAyBrE,CAAC,IAAE,KAAKgB,iBAAL,CAAuBsD,KAAvB,CAA6BD,MAAzD,EAAgErE,CAAC,IAAE,KAAKiB,gBAAL,CAAsBqD,KAAtB,CAA4BD,MAA/F,EAAsGrE,CAAC,IAAE,KAAKkB,oBAAL,CAA0BoD,KAA1B,CAAgCD,MAAzI,EAAgJrE,CAAC,IAAE,KAAKmB,mBAAL,CAAyBmD,KAAzB,CAA+BD,MAAlL,EAAyLrE,CAAC,IAAE,IAAE,KAAKc,WAAL,CAAiByD,IAAnB,GAAwB,CAApN;AAAsN,UAAMtE,CAAC,GAAC,IAAIuE,WAAJ,CAAgBxE,CAAhB,CAAR;AAAA,UAA2BG,CAAC,GAAC,IAAIsE,UAAJ,CAAexE,CAAC,CAACyE,MAAjB,CAA7B;AAAsD,QAAIrE,CAAC,GAAC,CAAN;AAAQJ,IAAAA,CAAC,CAACI,CAAC,EAAF,CAAD,GAAO,KAAKO,IAAZ,EAAiBX,CAAC,CAACI,CAAC,EAAF,CAAD,GAAO,KAAK+D,SAAL,CAAeC,MAAvC;;AAA8C,SAAI,IAAI5D,CAAC,GAAC,CAAV,EAAYA,CAAC,GAAC,KAAK2D,SAAL,CAAeC,MAA7B,EAAoC5D,CAAC,EAArC,EAAwCR,CAAC,CAACI,CAAC,EAAF,CAAD,GAAO,KAAK+D,SAAL,CAAe3D,CAAf,CAAP;;AAAyBR,IAAAA,CAAC,CAACI,CAAC,EAAF,CAAD,GAAO,KAAKgB,eAAZ,EAA4BpB,CAAC,CAACI,CAAC,EAAF,CAAD,GAAO,KAAKkB,eAAxC,EAAwDtB,CAAC,CAACI,CAAC,EAAF,CAAD,GAAO,KAAKoB,kBAApE,EAAuFxB,CAAC,CAACI,CAAC,EAAF,CAAD,GAAO,KAAKsB,kBAAnG;AAAsH,UAAMrB,CAAC,GAAC,KAAKQ,WAAb;AAAA,UAAyBN,CAAC,GAACF,CAAC,CAACiE,IAA7B;AAAkC,QAAGtE,CAAC,CAACI,CAAC,EAAF,CAAD,GAAOG,CAAP,EAASA,CAAC,GAAC,CAAd,EAAgB,KAAI,MAAK,CAACC,CAAD,EAAG,CAACE,CAAD,EAAGgC,CAAH,CAAH,CAAT,IAAqBrC,CAArB,EAAuBL,CAAC,CAACI,CAAC,EAAF,CAAD,GAAOI,CAAP,EAASR,CAAC,CAACI,CAAC,EAAF,CAAD,GAAOM,CAAhB,EAAkBV,CAAC,CAACI,CAAC,EAAF,CAAD,GAAOsC,CAAzB;AAA2B1C,IAAAA,CAAC,CAACI,CAAC,EAAF,CAAD,GAAO,KAAKW,iBAAL,CAAuBsD,KAAvB,CAA6BD,MAApC;;AAA2C,SAAI,IAAI5D,CAAC,GAAC,CAAV,EAAYA,CAAC,GAAC,KAAKO,iBAAL,CAAuBsD,KAAvB,CAA6BD,MAA3C,EAAkD5D,CAAC,EAAnD,EAAsDN,CAAC,CAACE,CAAC,EAAF,CAAD,GAAO,KAAKW,iBAAL,CAAuBsD,KAAvB,CAA6B7D,CAA7B,CAAP;;AAAuCR,IAAAA,CAAC,CAACI,CAAC,EAAF,CAAD,GAAO,KAAKY,gBAAL,CAAsBqD,KAAtB,CAA4BD,MAAnC;;AAA0C,SAAI,IAAI5D,CAAC,GAAC,CAAV,EAAYA,CAAC,GAAC,KAAKQ,gBAAL,CAAsBqD,KAAtB,CAA4BD,MAA1C,EAAiD5D,CAAC,EAAlD,EAAqDR,CAAC,CAACI,CAAC,EAAF,CAAD,GAAO,KAAKY,gBAAL,CAAsBqD,KAAtB,CAA4B7D,CAA5B,CAAP;;AAAsCR,IAAAA,CAAC,CAACI,CAAC,EAAF,CAAD,GAAO,KAAKa,oBAAL,CAA0BoD,KAA1B,CAAgCD,MAAvC;;AAA8C,SAAI,IAAI5D,CAAC,GAAC,CAAV,EAAYA,CAAC,GAAC,KAAKS,oBAAL,CAA0BoD,KAA1B,CAAgCD,MAA9C,EAAqD5D,CAAC,EAAtD,EAAyDN,CAAC,CAACE,CAAC,EAAF,CAAD,GAAO,KAAKa,oBAAL,CAA0BoD,KAA1B,CAAgC7D,CAAhC,CAAP;;AAA0CR,IAAAA,CAAC,CAACI,CAAC,EAAF,CAAD,GAAO,KAAKc,mBAAL,CAAyBmD,KAAzB,CAA+BD,MAAtC;;AAA6C,SAAI,IAAI5D,CAAC,GAAC,CAAV,EAAYA,CAAC,GAAC,KAAKU,mBAAL,CAAyBmD,KAAzB,CAA+BD,MAA7C,EAAoD5D,CAAC,EAArD,EAAwDR,CAAC,CAACI,CAAC,EAAF,CAAD,GAAO,KAAKc,mBAAL,CAAyBmD,KAAzB,CAA+B7D,CAA/B,CAAP;;AAAyC,WAAOR,CAAC,CAACyE,MAAT;AAAgB;;AAAAR,EAAAA,eAAe,CAAClE,CAAD,EAAGC,CAAH,EAAKE,CAAL,EAAOE,CAAP,EAASC,CAAT,EAAWE,CAAX,EAAaG,CAAb,EAAe;AAAC,QAAG,CAACX,CAAJ,EAAM;AAAO,UAAM2C,CAAC,GAAC3C,CAAC,CAACqE,MAAV;AAAA,UAAiBzB,CAAC,GAAC,CAACtC,CAAD,IAAI,MAAIA,CAAC,CAAC+D,MAA7B;AAAoC,QAAGpE,CAAC,KAAG,CAACE,CAAD,IAAIyC,CAAP,CAAJ,EAAc,KAAI,IAAInC,CAAC,GAAC,CAAV,EAAYA,CAAC,GAACkC,CAAd,EAAgBlC,CAAC,EAAjB,EAAoB,KAAKkE,eAAL,CAAqB3E,CAAC,CAACS,CAAD,CAAtB,EAA0BH,CAA1B;AAA6B,UAAM2C,CAAC,GAAC,EAAR;AAAW,QAAIC,CAAJ;;AAAM,SAAI,IAAIE,CAAC,GAAC,CAAV,EAAYA,CAAC,GAACT,CAAd,EAAgBS,CAAC,EAAjB,EAAoB;AAAC,YAAMnD,CAAC,GAACQ,CAAC,CAACmE,KAAF,CAAQ5E,CAAC,CAACoD,CAAD,CAAT,CAAR;;AAAsBnD,MAAAA,CAAC,GAACgD,CAAF,IAAK,KAAK,CAAL,KAASC,CAAT,IAAY,KAAK2B,YAAL,CAAkB7E,CAAlB,EAAoBkD,CAApB,EAAsB7C,CAAtB,EAAwBG,CAAxB,EAA0BG,CAA1B,CAAZ,EAAyCuC,CAAC,GAAC,CAACE,CAAD,CAAhD,IAAqDnD,CAAC,GAAC,CAACgD,CAAH,IAAM,KAAK,CAAL,KAASC,CAAf,IAAkBA,CAAC,CAACU,IAAF,CAAOR,CAAP,CAAvE;AAAiF;;AAAA,SAAK,CAAL,KAASF,CAAT,IAAY,KAAK2B,YAAL,CAAkB7E,CAAlB,EAAoBkD,CAApB,EAAsB7C,CAAtB,EAAwBG,CAAxB,EAA0BG,CAA1B,CAAZ;AAAyC;;AAAAgE,EAAAA,eAAe,CAAC3E,CAAD,EAAGC,CAAH,EAAK;AAAC,UAAME,CAAC,GAAC,KAAKe,oBAAb;AAAA,UAAkCb,CAAC,GAAC,KAAKc,mBAAzC;AAAA,UAA6Db,CAAC,GAACD,CAAC,CAAC+B,KAAjE;AAAuE,QAAI3B,CAAJ,EAAME,CAAN,EAAQgC,CAAR;AAAU,UAAMC,CAAC,GAAC,IAAIpC,CAAJ,CAAM,CAAN,EAAQ,CAAR,CAAR;AAAA,UAAmByC,CAAC,GAAC,IAAIzC,CAAJ,CAAM,CAAN,EAAQ,CAAR,CAArB;AAAA,UAAgC0C,CAAC,GAAC,IAAI1C,CAAJ,CAAM,CAAN,EAAQ,CAAR,CAAlC;;AAA6C,QAAI4C,CAAC,GAAC,CAAC,CAAP;AAAA,QAASG,CAAC,GAAC,CAAC,CAAZ;AAAA,QAAcE,CAAC,GAAC,CAAC,CAAjB;AAAA,QAAmBC,CAAC,GAAC,CAAC,CAAtB;AAAA,QAAwBoB,CAAC,GAAC,CAAC,CAA3B;AAAA,QAA6BC,CAAC,GAAC,CAAC,CAAhC;;AAAkC,UAAMC,CAAC,GAAC,CAAR;AAAU,QAAIC,CAAC,GAACjF,CAAC,CAACqE,MAAR;AAAe,QAAGY,CAAC,GAAC,CAAL,EAAO;AAAO,UAAMC,CAAC,GAAClF,CAAC,CAACgF,CAAD,CAAT;AAAa,QAAIG,CAAC,GAACnF,CAAC,CAACiF,CAAC,GAAC,CAAH,CAAP;;AAAa,WAAKA,CAAC,IAAEE,CAAC,CAACC,OAAF,CAAUF,CAAV,CAAR,GAAsB,EAAED,CAAF,EAAIE,CAAC,GAACnF,CAAC,CAACiF,CAAC,GAAC,CAAH,CAAP;;AAAa,QAAG,EAAEA,CAAC,GAACD,CAAF,GAAI,CAAN,CAAH,EAAY;AAAC,WAAI,IAAI1E,CAAC,GAAC0E,CAAV,EAAY1E,CAAC,GAAC2E,CAAd,EAAgB,EAAE3E,CAAlB,EAAoB;AAACA,QAAAA,CAAC,KAAG0E,CAAJ,IAAOvE,CAAC,GAACT,CAAC,CAACiF,CAAC,GAAC,CAAH,CAAH,EAAStE,CAAC,GAACX,CAAC,CAACgF,CAAD,CAAZ,EAAgBrC,CAAC,GAAC3C,CAAC,CAACgF,CAAC,GAAC,CAAH,CAAnB,EAAyBpC,CAAC,CAACyC,SAAF,CAAY1E,CAAZ,EAAcF,CAAd,CAAzB,EAA0CmC,CAAC,CAAC0C,SAAF,EAA1C,EAAwD1C,CAAC,CAAC2C,kBAAF,EAA/D,KAAwF9E,CAAC,GAACE,CAAF,EAAIA,CAAC,GAACgC,CAAN,EAAQA,CAAC,GAACrC,CAAC,KAAG2E,CAAC,GAAC,CAAN,GAAQjF,CAAC,CAACM,CAAC,GAAC,CAAH,CAAT,GAAeN,CAAC,CAACgF,CAAD,CAA1B,EAA8BpC,CAAC,CAAC4C,MAAF,CAASvC,CAAT,CAAtH;;AAAmI,cAAMzC,CAAC,GAAC,KAAKiF,WAAL,CAAiBhF,CAAjB,EAAmBE,CAAnB,CAAR;;AAA8B,SAAC,CAAD,KAAK+C,CAAL,KAASqB,CAAC,GAACvE,CAAX,GAAcyC,CAAC,CAACoC,SAAF,CAAY1C,CAAZ,EAAchC,CAAd,CAAd,EAA+BsC,CAAC,CAACqC,SAAF,EAA/B,EAA6CrC,CAAC,CAACsC,kBAAF,EAA7C;AAAoE,cAAML,CAAC,GAACtC,CAAC,CAACW,CAAF,GAAIN,CAAC,CAAC6B,CAAN,GAAQlC,CAAC,CAACkC,CAAF,GAAI7B,CAAC,CAACM,CAAtB;AAAwBL,QAAAA,CAAC,CAACwC,SAAF,CAAY9C,CAAZ,EAAcK,CAAd,GAAiBC,CAAC,CAACoC,SAAF,EAAjB;AAA+B,cAAMH,CAAC,GAAC,CAACjC,CAAC,CAACK,CAAH,GAAK,CAACX,CAAC,CAACW,CAAR,GAAU,CAACL,CAAC,CAAC4B,CAAH,GAAK,CAAClC,CAAC,CAACkC,CAA1B;AAA4B,YAAIa,CAAC,GAACC,IAAI,CAACC,GAAL,CAAS,MAAIV,CAAJ,GAAM,IAAEA,CAAR,GAAU,CAAnB,CAAN;AAA4BQ,QAAAA,CAAC,GAAC,CAAF,KAAMA,CAAC,GAAC,CAAR,GAAWT,CAAC,IAAE,CAAH,IAAMzB,CAAC,GAACtD,CAAC,CAAC2F,GAAF,CAAMnF,CAAC,CAAC4C,CAAR,EAAU5C,CAAC,CAACmE,CAAZ,EAAclC,CAAC,CAACW,CAAhB,EAAkBX,CAAC,CAACkC,CAApB,EAAsB,CAAtB,EAAwB,CAAxB,EAA0B7E,CAA1B,CAAF,EAA+B,CAAC,CAAD,KAAKyD,CAAL,KAASA,CAAC,GAACD,CAAX,CAA/B,EAA6CL,CAAC,IAAE,CAAH,IAAMG,CAAC,IAAE,CAAT,IAAYE,CAAC,IAAE,CAAf,IAAkB,CAACjD,CAAnB,IAAsBH,CAAC,CAACyF,GAAF,CAAM1C,CAAN,EAAQG,CAAR,EAAUE,CAAV,CAAnE,EAAgFF,CAAC,GAACpD,CAAC,CAAC2F,GAAF,CAAMnF,CAAC,CAAC4C,CAAR,EAAU5C,CAAC,CAACmE,CAAZ,EAAca,CAAC,GAAC,CAACzC,CAAC,CAACK,CAAnB,EAAqBoC,CAAC,GAAC,CAACzC,CAAC,CAAC4B,CAA1B,EAA4B,CAA5B,EAA8B,CAAC,CAA/B,EAAiC7E,CAAjC,CAAlF,EAAsH,CAAC,CAAD,KAAK6E,CAAL,KAASA,CAAC,GAACvB,CAAX,CAAtH,EAAoIH,CAAC,IAAE,CAAH,IAAMG,CAAC,IAAE,CAAT,IAAYE,CAAC,IAAE,CAAf,IAAkB,CAACjD,CAAnB,IAAsBH,CAAC,CAACyF,GAAF,CAAM1C,CAAN,EAAQG,CAAR,EAAUE,CAAV,CAA1J,EAAuKL,CAAC,GAACG,CAAzK,EAA2KA,CAAC,GAACE,CAA7K,EAA+KA,CAAC,GAACtD,CAAC,CAAC2F,GAAF,CAAMnF,CAAC,CAAC4C,CAAR,EAAU5C,CAAC,CAACmE,CAAZ,EAAc5B,CAAC,CAACK,CAAhB,EAAkBL,CAAC,CAAC4B,CAApB,EAAsB,CAAtB,EAAwB,CAAxB,EAA0B7E,CAA1B,CAAjL,EAA8MmD,CAAC,IAAE,CAAH,IAAMG,CAAC,IAAE,CAAT,IAAYE,CAAC,IAAE,CAAf,IAAkB,CAACjD,CAAnB,IAAsBH,CAAC,CAACyF,GAAF,CAAM1C,CAAN,EAAQG,CAAR,EAAUE,CAAV,CAApO,EAAiPF,CAAC,GAACpD,CAAC,CAAC2F,GAAF,CAAMnF,CAAC,CAAC4C,CAAR,EAAU5C,CAAC,CAACmE,CAAZ,EAAc7B,CAAC,CAACM,CAAhB,EAAkBN,CAAC,CAAC6B,CAApB,EAAsB,CAAtB,EAAwB,CAAxB,EAA0B7E,CAA1B,CAAnP,EAAgRmD,CAAC,IAAE,CAAH,IAAMG,CAAC,IAAE,CAAT,IAAYE,CAAC,IAAE,CAAf,IAAkB,CAACjD,CAAnB,IAAsBH,CAAC,CAACyF,GAAF,CAAM1C,CAAN,EAAQG,CAAR,EAAUE,CAAV,CAA5S,KAA2TA,CAAC,GAACtD,CAAC,CAAC2F,GAAF,CAAMnF,CAAC,CAAC4C,CAAR,EAAU5C,CAAC,CAACmE,CAAZ,EAAca,CAAC,GAACzC,CAAC,CAACK,CAAlB,EAAoBoC,CAAC,GAACzC,CAAC,CAAC4B,CAAxB,EAA0B,CAA1B,EAA4B,CAA5B,EAA8B7E,CAA9B,CAAF,EAAmC,CAAC,CAAD,KAAKyD,CAAL,KAASA,CAAC,GAACD,CAAX,CAAnC,EAAiDL,CAAC,IAAE,CAAH,IAAMG,CAAC,IAAE,CAAT,IAAYE,CAAC,IAAE,CAAf,IAAkB,CAACjD,CAAnB,IAAsBH,CAAC,CAACyF,GAAF,CAAM1C,CAAN,EAAQG,CAAR,EAAUE,CAAV,CAAvE,EAAoFF,CAAC,GAACpD,CAAC,CAAC2F,GAAF,CAAMnF,CAAC,CAAC4C,CAAR,EAAU5C,CAAC,CAACmE,CAAZ,EAAc,CAAClC,CAAC,CAACW,CAAjB,EAAmB,CAACX,CAAC,CAACkC,CAAtB,EAAwB,CAAxB,EAA0B,CAAC,CAA3B,EAA6B7E,CAA7B,CAAtF,EAAsH,CAAC,CAAD,KAAK6E,CAAL,KAASA,CAAC,GAACvB,CAAX,CAAtH,EAAoIH,CAAC,IAAE,CAAH,IAAMG,CAAC,IAAE,CAAT,IAAYE,CAAC,IAAE,CAAf,IAAkB,CAACjD,CAAnB,IAAsBH,CAAC,CAACyF,GAAF,CAAM1C,CAAN,EAAQG,CAAR,EAAUE,CAAV,CAA1J,EAAuKL,CAAC,GAACG,CAAzK,EAA2KA,CAAC,GAACE,CAA7K,EAA+KA,CAAC,GAACtD,CAAC,CAAC2F,GAAF,CAAMnF,CAAC,CAAC4C,CAAR,EAAU5C,CAAC,CAACmE,CAAZ,EAAc,CAAC5B,CAAC,CAACK,CAAjB,EAAmB,CAACL,CAAC,CAAC4B,CAAtB,EAAwB,CAAxB,EAA0B,CAAC,CAA3B,EAA6B7E,CAA7B,CAAjL,EAAiNmD,CAAC,IAAE,CAAH,IAAMG,CAAC,IAAE,CAAT,IAAYE,CAAC,IAAE,CAAf,IAAkB,CAACjD,CAAnB,IAAsBH,CAAC,CAACyF,GAAF,CAAM1C,CAAN,EAAQG,CAAR,EAAUE,CAAV,CAAvO,EAAoPL,CAAC,GAACjD,CAAC,CAAC2F,GAAF,CAAMnF,CAAC,CAAC4C,CAAR,EAAU5C,CAAC,CAACmE,CAAZ,EAAc,CAAC7B,CAAC,CAACM,CAAjB,EAAmB,CAACN,CAAC,CAAC6B,CAAtB,EAAwB,CAAxB,EAA0B,CAAC,CAA3B,EAA6B7E,CAA7B,CAAtP,EAAsRmD,CAAC,IAAE,CAAH,IAAMG,CAAC,IAAE,CAAT,IAAYE,CAAC,IAAE,CAAf,IAAkB,CAACjD,CAAnB,IAAsBH,CAAC,CAACyF,GAAF,CAAM1C,CAAN,EAAQG,CAAR,EAAUE,CAAV,CAAvmB,CAAX;AAAgoB;;AAAAL,MAAAA,CAAC,IAAE,CAAH,IAAMG,CAAC,IAAE,CAAT,IAAYG,CAAC,IAAE,CAAf,IAAkB,CAACqB,CAAnB,IAAsB1E,CAAC,CAACyF,GAAF,CAAM1C,CAAN,EAAQG,CAAR,EAAUG,CAAV,CAAtB,EAAmCN,CAAC,IAAE,CAAH,IAAMM,CAAC,IAAE,CAAT,IAAYoB,CAAC,IAAE,CAAf,IAAkB,CAACC,CAAnB,IAAsB1E,CAAC,CAACyF,GAAF,CAAM1C,CAAN,EAAQ0B,CAAR,EAAUpB,CAAV,CAAzD,EAAsE,KAAK/B,kBAAL,IAAyB,KAAGtB,CAAC,CAAC+B,KAAF,GAAQ9B,CAAX,CAA/F;AAA6G;AAAC;;AAAAuE,EAAAA,YAAY,CAACxE,CAAD,EAAGC,CAAH,EAAKE,CAAL,EAAOC,CAAP,EAASE,CAAT,EAAW;AAACF,IAAAA,CAAC,GAAC,CAAC,CAAH;AAAK,QAAIkC,CAAJ;AAAMrC,IAAAA,CAAC,CAAC+D,MAAF,GAAS,CAAT,KAAa1B,CAAC,GAAC,EAAf;AAAmB,QAAIC,CAAC,GAAC,CAAN;;AAAQ,SAAI,MAAM5C,CAAV,IAAeM,CAAf,EAAiB,MAAIsC,CAAJ,IAAOD,CAAC,CAACiB,IAAF,CAAOhB,CAAP,CAAP,EAAiBA,CAAC,IAAEvC,CAAC,CAACL,CAAD,CAAD,CAAKqE,MAAzB;;AAAgC,UAAMpB,CAAC,GAAC,IAAEL,CAAV;AAAA,UAAYM,CAAC,GAAClD,CAAC,CAAC+F,OAAF,EAAd;;AAA0B,SAAI,MAAM/F,CAAV,IAAeM,CAAf,EAAiB;AAAC,YAAML,CAAC,GAACI,CAAC,CAACL,CAAD,CAAT;AAAA,YAAaG,CAAC,GAACF,CAAC,CAACoE,MAAjB;;AAAwB,WAAI,IAAIrE,CAAC,GAAC,CAAV,EAAYA,CAAC,GAACG,CAAd,EAAgB,EAAEH,CAAlB,EAAoBkD,CAAC,CAACU,IAAF,CAAO3D,CAAC,CAACD,CAAD,CAAD,CAAKuD,CAAZ,EAActD,CAAC,CAACD,CAAD,CAAD,CAAK8E,CAAnB;AAAsB;;AAAA,UAAM1B,CAAC,GAACnD,CAAC,CAACiD,CAAD,EAAGP,CAAH,EAAK,CAAL,CAAT;;AAAiB,QAAGlC,CAAC,IAAER,CAAC,CAAC+F,SAAF,CAAY9C,CAAZ,EAAcP,CAAd,EAAgB,CAAhB,EAAkBS,CAAlB,IAAqB,CAA3B,EAA6B;AAAC,YAAMpD,CAAC,GAACM,CAAC,CAAC2F,GAAF,CAAOjG,CAAC,IAAEK,CAAC,CAACL,CAAD,CAAD,CAAKqE,MAAf,CAAR;AAAA,YAAgC;AAACK,QAAAA,MAAM,EAACzE,CAAR;AAAUiG,QAAAA,WAAW,EAACzF;AAAtB,UAAyBN,CAAC,CAAC+C,CAAD,EAAGlD,CAAH,CAA1D;;AAAgE,UAAGS,CAAC,GAAC,CAAL,EAAO;AAAC,cAAMT,CAAC,GAAC,KAAKgB,iBAAL,CAAuBoB,KAA/B;;AAAqC,aAAI,IAAIjC,CAAC,GAAC,CAAV,EAAYA,CAAC,GAACM,CAAd,EAAgBN,CAAC,EAAjB,EAAoB,KAAKa,iBAAL,CAAuB8E,GAAvB,CAA2B7F,CAAC,CAAC,IAAEE,CAAH,CAA5B,EAAkCF,CAAC,CAAC,IAAEE,CAAF,GAAI,CAAL,CAAnC,EAA2CK,CAA3C;;AAA8C,aAAI,IAAIP,CAAC,GAAC,CAAV,EAAYA,CAAC,GAACQ,CAAd,EAAgBR,CAAC,IAAE,CAAnB,EAAqB;AAAC,gBAAME,CAAC,GAACH,CAAC,GAACC,CAAV;;AAAY,eAAKgB,gBAAL,CAAsB6E,GAAtB,CAA0B3F,CAA1B,EAA4BA,CAAC,GAAC,CAA9B,EAAgCA,CAAC,GAAC,CAAlC;AAAqC;;AAAA,YAAG,KAAK,CAAL,KAASQ,CAAZ,EAAc;AAAC,gBAAMX,CAAC,GAAC,KAAKc,WAAb;AAAA,gBAAyBb,CAAC,GAACD,CAAC,CAACmG,GAAF,CAAMxF,CAAN,CAA3B;AAAoCV,UAAAA,CAAC,GAACA,CAAC,CAAC,CAAD,CAAD,IAAMQ,CAAP,GAAST,CAAC,CAACoG,GAAF,CAAMzF,CAAN,EAAQ,CAAC,KAAKU,eAAL,GAAqB,KAAKE,eAA3B,EAA2Cd,CAA3C,CAAR,CAAV;AAAiE;;AAAA,aAAKc,eAAL,IAAsBd,CAAtB;AAAwB;AAAC,KAAja,MAAqa;AAAC,YAAMT,CAAC,GAACoD,CAAC,CAACiB,MAAV;;AAAiB,UAAGrE,CAAC,GAAC,CAAL,EAAO;AAAC,cAAMC,CAAC,GAAC,KAAKe,iBAAL,CAAuBoB,KAA/B;AAAqC,YAAIjC,CAAC,GAAC,CAAN;;AAAQ,eAAKA,CAAC,GAAC8C,CAAP,GAAU,KAAKjC,iBAAL,CAAuB8E,GAAvB,CAA2B5C,CAAC,CAAC/C,CAAC,EAAF,CAA5B,EAAkC+C,CAAC,CAAC/C,CAAC,EAAF,CAAnC,EAAyCK,CAAzC;;AAA4C,YAAIH,CAAC,GAAC,CAAN;;AAAQ,eAAKA,CAAC,GAACL,CAAP,GAAU,KAAKiB,gBAAL,CAAsB6E,GAAtB,CAA0B7F,CAAC,GAACmD,CAAC,CAAC/C,CAAC,EAAF,CAA7B,EAAmCJ,CAAC,GAACmD,CAAC,CAAC/C,CAAC,EAAF,CAAtC,EAA4CJ,CAAC,GAACmD,CAAC,CAAC/C,CAAC,EAAF,CAA/C;;AAAsD,YAAG,KAAK,CAAL,KAASM,CAAZ,EAAc;AAAC,gBAAMV,CAAC,GAAC,KAAKa,WAAb;AAAA,gBAAyBX,CAAC,GAACF,CAAC,CAACkG,GAAF,CAAMxF,CAAN,CAA3B;AAAoCR,UAAAA,CAAC,GAACA,CAAC,CAAC,CAAD,CAAD,IAAMH,CAAP,GAASC,CAAC,CAACmG,GAAF,CAAMzF,CAAN,EAAQ,CAAC,KAAKU,eAAL,GAAqB,KAAKE,eAA3B,EAA2CvB,CAA3C,CAAR,CAAV;AAAiE;;AAAA,aAAKuB,eAAL,IAAsBvB,CAAtB;AAAwB;AAAC;;AAAAA,IAAAA,CAAC,CAACqG,OAAF,CAAUnD,CAAV;AAAa;;AAAAuC,EAAAA,WAAW,CAACzF,CAAD,EAAGC,CAAH,EAAK;AAAC,WAAOD,CAAC,CAACuD,CAAF,KAAMtD,CAAC,CAACsD,CAAR,GAAUvD,CAAC,CAACuD,CAAF,IAAK,CAAC,EAAN,IAAUvD,CAAC,CAACuD,CAAF,IAAK,IAAzB,GAA8BvD,CAAC,CAAC8E,CAAF,KAAM7E,CAAC,CAAC6E,CAAR,KAAY9E,CAAC,CAAC8E,CAAF,IAAK,CAAC,EAAN,IAAU9E,CAAC,CAAC8E,CAAF,IAAK,IAA3B,CAArC;AAAsE;;AAAY,SAALF,KAAK,CAAC5E,CAAD,EAAG;AAAC,QAAIC,CAAC,GAAC,CAAN;AAAQ,UAAME,CAAC,GAACH,CAAC,CAACqE,MAAF,GAAS,CAAjB;;AAAmB,SAAI,IAAIhE,CAAC,GAAC,CAAV,EAAYA,CAAC,GAACF,CAAd,EAAgBE,CAAC,EAAjB,EAAoBJ,CAAC,IAAE,CAACD,CAAC,CAACK,CAAD,CAAD,CAAKkD,CAAL,GAAOvD,CAAC,CAACK,CAAC,GAAC,CAAH,CAAD,CAAOkD,CAAf,KAAmBvD,CAAC,CAACK,CAAD,CAAD,CAAKyE,CAAL,GAAO9E,CAAC,CAACK,CAAC,GAAC,CAAH,CAAD,CAAOyE,CAAjC,CAAH;;AAAuC,WAAO7E,CAAC,IAAE,CAACD,CAAC,CAACG,CAAD,CAAD,CAAKoD,CAAL,GAAOvD,CAAC,CAAC,CAAD,CAAD,CAAKuD,CAAb,KAAiBvD,CAAC,CAACG,CAAD,CAAD,CAAK2E,CAAL,GAAO9E,CAAC,CAAC,CAAD,CAAD,CAAK8E,CAA7B,CAAH,EAAmC,KAAG7E,CAA7C;AAA+C;;AAA3gM;;AAA4gM,SAAOQ,CAAC,IAAI6F,OAAZ","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport t from\"../../../../../core/ArrayPool.js\";import{e}from\"../../../../../chunks/earcut.js\";import{triangulate as i}from\"../../../../../geometry/libtess.js\";import{BucketType as r}from\"../enums.js\";import l from\"./BaseBucket.js\";import{Point as n}from\"../../webgl/Geometry.js\";class s extends l{constructor(t,e,i,l,n,s,o){super(t,e,i),this.type=r.FILL,this._patternMap=new Map,this._fillVertexBuffer=l,this._fillIndexBuffer=n,this._outlineVertexBuffer=s,this._outlineIndexBuffer=o}get fillIndexStart(){return this._fillIndexStart}get fillIndexCount(){return this._fillIndexCount}get outlineIndexStart(){return this._outlineIndexStart}get outlineIndexCount(){return this._outlineIndexCount}getResources(t,e,i){const r=this.layer,l=this.zoom,n=r.getPaintProperty(\"fill-pattern\");if(n)if(n.isDataDriven)for(const s of this._features)e(n.getValue(l,s),!0);else e(n.getValue(l),!0)}processFeatures(t){this._fillIndexStart=3*this._fillIndexBuffer.index,this._fillIndexCount=0,this._outlineIndexStart=3*this._outlineIndexBuffer.index,this._outlineIndexCount=0;const e=this.layer,i=this.zoom,{fillMaterial:r,outlineMaterial:l,hasDataDrivenFill:n,hasDataDrivenOutline:s}=e;t&&t.setExtent(this.layerExtent);const o=e.getPaintProperty(\"fill-pattern\"),a=null==o?void 0:o.isDataDriven;let f=!o&&e.getPaintValue(\"fill-antialias\",i);if(e.outlineUsesFillColor){if(f&&!e.hasDataDrivenOpacity){const t=e.getPaintValue(\"fill-opacity\",i),r=e.getPaintValue(\"fill-opacity\",i+1);t<1&&r<1&&(f=!1)}if(f&&!e.hasDataDrivenColor){const t=e.getPaintValue(\"fill-color\",i),r=e.getPaintValue(\"fill-color\",i+1);t[3]<1&&r[3]<1&&(f=!1)}}const u=this._features,d=null==t?void 0:t.validateTessellation;if(a){const n=[];for(const a of u){const u=o.getValue(i,a),h=this._spriteInfo[u];if(!h||!h.rect)continue;const x=r.encodeAttributes(a,i,e,h),c=f&&s?l.encodeAttributes(a,i,e):[],_=a.getGeometry(t);n.push({ddFillAttributes:x,ddOutlineAttributes:c,page:h.page,geometry:_}),n.sort(((t,e)=>t.page-e.page));for(const{ddFillAttributes:t,ddOutlineAttributes:i,page:r,geometry:l}of n)this._processFeature(l,f,e.outlineUsesFillColor,t,i,d,r)}}else for(const h of u){const o=n?r.encodeAttributes(h,i,e):null,a=f&&s?l.encodeAttributes(h,i,e):null,u=h.getGeometry(t);this._processFeature(u,f,e.outlineUsesFillColor,o,a,d)}}serialize(){let t=10;t+=this.layerUIDs.length,t+=this._fillVertexBuffer.array.length,t+=this._fillIndexBuffer.array.length,t+=this._outlineVertexBuffer.array.length,t+=this._outlineIndexBuffer.array.length,t+=3*this._patternMap.size+1;const e=new Uint32Array(t),i=new Int32Array(e.buffer);let r=0;e[r++]=this.type,e[r++]=this.layerUIDs.length;for(let s=0;s<this.layerUIDs.length;s++)e[r++]=this.layerUIDs[s];e[r++]=this._fillIndexStart,e[r++]=this._fillIndexCount,e[r++]=this._outlineIndexStart,e[r++]=this._outlineIndexCount;const l=this._patternMap,n=l.size;if(e[r++]=n,n>0)for(const[s,[o,a]]of l)e[r++]=s,e[r++]=o,e[r++]=a;e[r++]=this._fillVertexBuffer.array.length;for(let s=0;s<this._fillVertexBuffer.array.length;s++)i[r++]=this._fillVertexBuffer.array[s];e[r++]=this._fillIndexBuffer.array.length;for(let s=0;s<this._fillIndexBuffer.array.length;s++)e[r++]=this._fillIndexBuffer.array[s];e[r++]=this._outlineVertexBuffer.array.length;for(let s=0;s<this._outlineVertexBuffer.array.length;s++)i[r++]=this._outlineVertexBuffer.array[s];e[r++]=this._outlineIndexBuffer.array.length;for(let s=0;s<this._outlineIndexBuffer.array.length;s++)e[r++]=this._outlineIndexBuffer.array[s];return e.buffer}_processFeature(t,e,i,r,l,n,o){if(!t)return;const a=t.length,f=!l||0===l.length;if(e&&(!i||f))for(let s=0;s<a;s++)this._processOutline(t[s],l);const u=32;let d;for(let h=0;h<a;h++){const e=s._area(t[h]);e>u?(void 0!==d&&this._processFill(t,d,r,n,o),d=[h]):e<-u&&void 0!==d&&d.push(h)}void 0!==d&&this._processFill(t,d,r,n,o)}_processOutline(t,e){const i=this._outlineVertexBuffer,r=this._outlineIndexBuffer,l=r.index;let s,o,a;const f=new n(0,0),u=new n(0,0),d=new n(0,0);let h=-1,x=-1,c=-1,_=-1,y=-1,g=!1;const p=0;let I=t.length;if(I<2)return;const B=t[p];let m=t[I-1];for(;I&&m.isEqual(B);)--I,m=t[I-1];if(!(I-p<2)){for(let l=p;l<I;++l){l===p?(s=t[I-1],o=t[p],a=t[p+1],f.assignSub(o,s),f.normalize(),f.rightPerpendicular()):(s=o,o=a,a=l!==I-1?t[l+1]:t[p],f.assign(u));const n=this._isClipEdge(s,o);-1===_&&(g=n),u.assignSub(a,o),u.normalize(),u.rightPerpendicular();const B=f.x*u.y-f.y*u.x;d.assignAdd(f,u),d.normalize();const m=-d.x*-f.x+-d.y*-f.y;let V=Math.abs(0!==m?1/m:1);V>8&&(V=8),B>=0?(c=i.add(o.x,o.y,f.x,f.y,0,1,e),-1===_&&(_=c),h>=0&&x>=0&&c>=0&&!n&&r.add(h,x,c),x=i.add(o.x,o.y,V*-d.x,V*-d.y,0,-1,e),-1===y&&(y=x),h>=0&&x>=0&&c>=0&&!n&&r.add(h,x,c),h=x,x=c,c=i.add(o.x,o.y,d.x,d.y,0,1,e),h>=0&&x>=0&&c>=0&&!n&&r.add(h,x,c),x=i.add(o.x,o.y,u.x,u.y,0,1,e),h>=0&&x>=0&&c>=0&&!n&&r.add(h,x,c)):(c=i.add(o.x,o.y,V*d.x,V*d.y,0,1,e),-1===_&&(_=c),h>=0&&x>=0&&c>=0&&!n&&r.add(h,x,c),x=i.add(o.x,o.y,-f.x,-f.y,0,-1,e),-1===y&&(y=x),h>=0&&x>=0&&c>=0&&!n&&r.add(h,x,c),h=x,x=c,c=i.add(o.x,o.y,-d.x,-d.y,0,-1,e),h>=0&&x>=0&&c>=0&&!n&&r.add(h,x,c),h=i.add(o.x,o.y,-u.x,-u.y,0,-1,e),h>=0&&x>=0&&c>=0&&!n&&r.add(h,x,c))}h>=0&&x>=0&&_>=0&&!g&&r.add(h,x,_),h>=0&&_>=0&&y>=0&&!g&&r.add(h,y,_),this._outlineIndexCount+=3*(r.index-l)}}_processFill(r,l,n,s,o){s=!0;let a;l.length>1&&(a=[]);let f=0;for(const t of l)0!==f&&a.push(f),f+=r[t].length;const u=2*f,d=t.acquire();for(const t of l){const e=r[t],i=e.length;for(let t=0;t<i;++t)d.push(e[t].x,e[t].y)}const h=e(d,a,2);if(s&&e.deviation(d,a,2,h)>0){const t=l.map((t=>r[t].length)),{buffer:e,vertexCount:s}=i(d,t);if(s>0){const t=this._fillVertexBuffer.index;for(let i=0;i<s;i++)this._fillVertexBuffer.add(e[2*i],e[2*i+1],n);for(let e=0;e<s;e+=3){const i=t+e;this._fillIndexBuffer.add(i,i+1,i+2)}if(void 0!==o){const t=this._patternMap,e=t.get(o);e?e[1]+=s:t.set(o,[this._fillIndexStart+this._fillIndexCount,s])}this._fillIndexCount+=s}}else{const t=h.length;if(t>0){const e=this._fillVertexBuffer.index;let i=0;for(;i<u;)this._fillVertexBuffer.add(d[i++],d[i++],n);let r=0;for(;r<t;)this._fillIndexBuffer.add(e+h[r++],e+h[r++],e+h[r++]);if(void 0!==o){const e=this._patternMap,i=e.get(o);i?i[1]+=t:e.set(o,[this._fillIndexStart+this._fillIndexCount,t])}this._fillIndexCount+=t}}t.release(d)}_isClipEdge(t,e){return t.x===e.x?t.x<=-64||t.x>=4160:t.y===e.y&&(t.y<=-64||t.y>=4160)}static _area(t){let e=0;const i=t.length-1;for(let r=0;r<i;r++)e+=(t[r].x-t[r+1].x)*(t[r].y+t[r+1].y);return e+=(t[i].x-t[0].x)*(t[i].y+t[0].y),.5*e}}export{s as default};\n"]},"metadata":{},"sourceType":"module"}