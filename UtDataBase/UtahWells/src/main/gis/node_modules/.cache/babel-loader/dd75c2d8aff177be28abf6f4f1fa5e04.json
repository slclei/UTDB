{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport e from \"../../../../../../core/Logger.js\";\nimport { analyzeCIMResource as t } from \"../../../../../../symbols/cim/cimAnalyzer.js\";\nimport { evaluateValueOrFunction as a } from \"../../../../../../symbols/cim/utils.js\";\nimport s from \"./WGLMeshTemplate.js\";\nconst i = e.getLogger(\"esri.views.2d.engine.webgl.WGLDynamicMeshTemplate\");\n\nclass r extends s {\n  constructor(e) {\n    super(), this._ongoingMaterialRequestMap = new Map(), this._materialCache = new Map(), this._dynamicPropertyMap = new Map(), this._cimLayer = e;\n  }\n\n  analyze(e, s, r, n, o) {\n    if (o && 0 === o.length) return null;\n    const l = o && o.length > 0,\n          m = s.readLegacyFeature(),\n          c = this._materialCache,\n          h = this._cimLayer.materialHash;\n    if (!h) return i.error(\"A Dynamic mesh template must have a material hash value or function!\"), Promise.reject(null);\n    const u = \"function\" == typeof h ? h(m, r, n) : h;\n\n    if (c.has(u)) {\n      const e = c.get(u);\n      return Promise.resolve(e);\n    }\n\n    const p = this._ongoingMaterialRequestMap.get(u);\n\n    if (p) return p;\n    const g = this._cimLayer,\n          y = t(g.cim, this._cimLayer.materialOverrides);\n    y.mosaicHash = u;\n    const {\n      type: M,\n      url: f\n    } = g,\n          _ = {\n      cim: y,\n      type: M,\n      mosaicHash: u,\n      url: f,\n      size: null,\n      dashTemplate: null,\n      text: null,\n      fontName: null\n    };\n\n    switch (M) {\n      case \"marker\":\n        _.size = a(g.size, m, r, n);\n        break;\n\n      case \"line\":\n        _.dashTemplate = g.dashTemplate;\n        break;\n\n      case \"text\":\n        _.text = a(g.text, m, r, n), _.fontName = a(g.fontName, m, r, n);\n    }\n\n    const d = e.getMosaicItem(_, o).then(e => (l || (this._ongoingMaterialRequestMap.delete(u), c.set(u, e)), e)).catch(e => (this._ongoingMaterialRequestMap.delete(u), i.error(\".analyze()\", e.message), null));\n    return l || this._ongoingMaterialRequestMap.set(u, d), d;\n  }\n\n}\n\nexport { r as default };","map":{"version":3,"sources":["D:/Github/CUSP_DataBase/CUSP_DB/src/main/gis/node_modules/@arcgis/core/views/2d/engine/webgl/mesh/templates/WGLDynamicMeshTemplate.js"],"names":["e","analyzeCIMResource","t","evaluateValueOrFunction","a","s","i","getLogger","r","constructor","_ongoingMaterialRequestMap","Map","_materialCache","_dynamicPropertyMap","_cimLayer","analyze","n","o","length","l","m","readLegacyFeature","c","h","materialHash","error","Promise","reject","u","has","get","resolve","p","g","y","cim","materialOverrides","mosaicHash","type","M","url","f","_","size","dashTemplate","text","fontName","d","getMosaicItem","then","delete","set","catch","message","default"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport e from\"../../../../../../core/Logger.js\";import{analyzeCIMResource as t}from\"../../../../../../symbols/cim/cimAnalyzer.js\";import{evaluateValueOrFunction as a}from\"../../../../../../symbols/cim/utils.js\";import s from\"./WGLMeshTemplate.js\";const i=e.getLogger(\"esri.views.2d.engine.webgl.WGLDynamicMeshTemplate\");class r extends s{constructor(e){super(),this._ongoingMaterialRequestMap=new Map,this._materialCache=new Map,this._dynamicPropertyMap=new Map,this._cimLayer=e}analyze(e,s,r,n,o){if(o&&0===o.length)return null;const l=o&&o.length>0,m=s.readLegacyFeature(),c=this._materialCache,h=this._cimLayer.materialHash;if(!h)return i.error(\"A Dynamic mesh template must have a material hash value or function!\"),Promise.reject(null);const u=\"function\"==typeof h?h(m,r,n):h;if(c.has(u)){const e=c.get(u);return Promise.resolve(e)}const p=this._ongoingMaterialRequestMap.get(u);if(p)return p;const g=this._cimLayer,y=t(g.cim,this._cimLayer.materialOverrides);y.mosaicHash=u;const{type:M,url:f}=g,_={cim:y,type:M,mosaicHash:u,url:f,size:null,dashTemplate:null,text:null,fontName:null};switch(M){case\"marker\":_.size=a(g.size,m,r,n);break;case\"line\":_.dashTemplate=g.dashTemplate;break;case\"text\":_.text=a(g.text,m,r,n),_.fontName=a(g.fontName,m,r,n)}const d=e.getMosaicItem(_,o).then((e=>(l||(this._ongoingMaterialRequestMap.delete(u),c.set(u,e)),e))).catch((e=>(this._ongoingMaterialRequestMap.delete(u),i.error(\".analyze()\",e.message),null)));return l||this._ongoingMaterialRequestMap.set(u,d),d}}export{r as default};\n"]},"metadata":{},"sourceType":"module"}