{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport { neverReached as e } from \"../../../../core/compilerUtils.js\";\nimport { getOrCreateMapValue as t } from \"../../../../core/MapUtils.js\";\nimport { isDataProtocol as r, dataComponents as s, dataToArrayBuffer as n, makeAbsolute as o } from \"../../../../core/urlUtils.js\";\nimport { Version as a } from \"../../../../core/Version.js\";\nimport { y as i, m as u, j as c, e as p, h as f } from \"../../../../chunks/mat4.js\";\nimport { c as d, b as l } from \"../../../../chunks/mat4f64.js\";\nimport { g as m } from \"../../../../chunks/quat.js\";\nimport { a as h } from \"../../../../chunks/quatf64.js\";\nimport { BufferViewUint32 as y, BufferViewUint16 as b, BufferViewUint8 as T, BufferViewVec3f as O, BufferViewVec4f as w, BufferViewVec2f as N, BufferViewVec4u8 as x, BufferViewVec4u16 as S, BufferViewVec3u8 as C, BufferViewVec3u16 as _, BufferViewVec2u32 as U, BufferViewVec2u16 as I, BufferViewVec2i16 as g, BufferViewVec2u8 as A, BufferViewVec2i8 as E } from \"../../../../geometry/support/buffer/BufferView.js\";\nimport { m as L } from \"../../../../chunks/scalar.js\";\nimport { BinaryStreamReader as B } from \"./BinaryStreamReader.js\";\nimport { AttributeType as R } from \"./enums.js\";\nimport { material as D, textureSampler as G } from \"./fillDefaults.js\";\nimport { splitURI as v } from \"./pathUtils.js\";\nimport { DataType as j } from \"../../../webgl/enums.js\";\nconst M = {\n  MAGIC: 1179937895,\n  CHUNK_TYPE_JSON: 1313821514,\n  CHUNK_TYPE_BIN: 5130562,\n  MIN_HEADER_LENGTH: 20\n};\n\nclass F {\n  constructor(e, t, r, s, n) {\n    this.context = e, this.errorContext = t, this.uri = r, this.json = s, this.glbBuffer = n, this.bufferLoaders = new Map(), this.textureLoaders = new Map(), this.textureCache = new Map(), this.materialCache = new Map(), this.nodeParentMap = new Map(), this.nodeTransformCache = new Map(), this.baseUri = v(this.uri).dirPart, this._checkVersionSupported(), this._checkRequiredExtensionsSupported(), t.errorUnsupportedIf(null == s.scenes, \"Scenes must be defined.\"), t.errorUnsupportedIf(null == s.meshes, \"Meshes must be defined\"), t.errorUnsupportedIf(null == s.nodes, \"Nodes must be defined.\"), this._computeNodeParents();\n  }\n\n  static async load(e, t, o, a) {\n    if (r(o)) {\n      const r = s(o);\n      if (\"model/gltf-binary\" !== r.mediaType) try {\n        const s = JSON.parse(r.isBase64 ? atob(r.data) : r.data);\n        return new F(e, t, o, s);\n      } catch {}\n      const a = n(o);\n      if (F._isGLBData(a)) return this._fromGLBData(e, t, o, a);\n    }\n\n    if (o.endsWith(\".gltf\")) {\n      const r = await e.loadJSON(o, a);\n      return new F(e, t, o, r);\n    }\n\n    const i = await e.loadBinary(o, a);\n    if (F._isGLBData(i)) return this._fromGLBData(e, t, o, i);\n    const u = await e.loadJSON(o, a);\n    return new F(e, t, o, u);\n  }\n\n  static _isGLBData(e) {\n    const t = new B(e);\n    return t.remainingBytes() >= 4 && t.readUint32() === M.MAGIC;\n  }\n\n  static async _fromGLBData(e, t, r, s) {\n    const n = await F._parseGLBData(t, s);\n    return new F(e, t, r, n.json, n.binaryData);\n  }\n\n  static async _parseGLBData(e, t) {\n    const r = new B(t);\n    e.assert(r.remainingBytes() >= 12, \"GLB binary data is insufficiently large.\");\n    const s = r.readUint32(),\n          n = r.readUint32(),\n          o = r.readUint32();\n    e.assert(s === M.MAGIC, \"Magic first 4 bytes do not fit to expected GLB value.\"), e.assert(t.byteLength >= o, \"GLB binary data is smaller than header specifies.\"), e.errorUnsupportedIf(2 !== n, \"An unsupported GLB container version was detected. Only version 2 is supported.\");\n    let a,\n        i,\n        u = 0;\n\n    for (; r.remainingBytes() >= 8;) {\n      const t = r.readUint32(),\n            s = r.readUint32();\n      0 === u ? (e.assert(s === M.CHUNK_TYPE_JSON, \"First GLB chunk must be JSON.\"), e.assert(t >= 0, \"No JSON data found.\"), a = await q(r.readUint8Array(t))) : 1 === u ? (e.errorUnsupportedIf(s !== M.CHUNK_TYPE_BIN, \"Second GLB chunk expected to be BIN.\"), i = r.readUint8Array(t)) : e.warnUnsupported(\"More than 2 GLB chunks detected. Skipping.\"), u += 1;\n    }\n\n    return a || e.error(\"No GLB JSON chunk detected.\"), {\n      json: a,\n      binaryData: i\n    };\n  }\n\n  async getBuffer(e, t) {\n    const r = this.json.buffers[e],\n          s = this.errorContext;\n    if (null == r.uri) return s.assert(null != this.glbBuffer, \"GLB buffer not present\"), this.glbBuffer;\n    const n = await this._getBufferLoader(e, t);\n    return s.assert(n.byteLength === r.byteLength, \"Buffer byte lengths should match.\"), n;\n  }\n\n  async _getBufferLoader(e, t) {\n    const r = this.bufferLoaders.get(e);\n    if (r) return r;\n    const s = this.json.buffers[e],\n          n = this.context.loadBinary(this._resolveUri(s.uri), t).then(e => new Uint8Array(e));\n    return this.bufferLoaders.set(e, n), n;\n  }\n\n  async getAccessor(e, t) {\n    const r = this.errorContext;\n    r.errorUnsupportedIf(!this.json.accessors, \"Accessors missing.\");\n    const s = this.json.accessors[e];\n    r.errorUnsupportedIf(null == (null == s ? void 0 : s.bufferView), \"Some accessor does not specify a bufferView.\"), r.errorUnsupportedIf(s.type in [R.MAT2, R.MAT3, R.MAT4], `AttributeType ${s.type} is not supported`);\n    const n = this.json.bufferViews[s.bufferView],\n          o = await this.getBuffer(n.buffer, t),\n          a = H[s.type],\n          i = Y[s.componentType],\n          u = a * i,\n          c = n.byteStride || u;\n    return {\n      raw: o.buffer,\n      byteStride: c,\n      byteOffset: o.byteOffset + (n.byteOffset || 0) + (s.byteOffset || 0),\n      entryCount: s.count,\n      isDenselyPacked: c === u,\n      componentCount: a,\n      componentByteSize: i,\n      componentType: s.componentType,\n      min: s.min,\n      max: s.max,\n      normalized: !!s.normalized\n    };\n  }\n\n  async getIndexData(e, t) {\n    if (null == e.indices) return null;\n    const r = await this.getAccessor(e.indices, t);\n    if (r.isDenselyPacked) switch (r.componentType) {\n      case j.UNSIGNED_BYTE:\n        return new Uint8Array(r.raw, r.byteOffset, r.entryCount);\n\n      case j.UNSIGNED_SHORT:\n        return new Uint16Array(r.raw, r.byteOffset, r.entryCount);\n\n      case j.UNSIGNED_INT:\n        return new Uint32Array(r.raw, r.byteOffset, r.entryCount);\n    } else switch (r.componentType) {\n      case j.UNSIGNED_BYTE:\n        return L(this._wrapAccessor(T, r));\n\n      case j.UNSIGNED_SHORT:\n        return L(this._wrapAccessor(b, r));\n\n      case j.UNSIGNED_INT:\n        return L(this._wrapAccessor(y, r));\n    }\n  }\n\n  async getPositionData(e, t) {\n    const r = this.errorContext;\n    r.errorUnsupportedIf(null == e.attributes.POSITION, \"No POSITION vertex data found.\");\n    const s = await this.getAccessor(e.attributes.POSITION, t);\n    return r.errorUnsupportedIf(s.componentType !== j.FLOAT, \"Expected type FLOAT for POSITION vertex attribute, but found \" + z[s.componentType]), r.errorUnsupportedIf(3 !== s.componentCount, \"POSITION vertex attribute must have 3 components, but found \" + s.componentCount.toFixed()), this._wrapAccessor(O, s);\n  }\n\n  async getNormalData(e, t) {\n    const r = this.errorContext;\n    r.assert(null != e.attributes.NORMAL, \"No NORMAL vertex data found.\");\n    const s = await this.getAccessor(e.attributes.NORMAL, t);\n    return r.errorUnsupportedIf(s.componentType !== j.FLOAT, \"Expected type FLOAT for NORMAL vertex attribute, but found \" + z[s.componentType]), r.errorUnsupportedIf(3 !== s.componentCount, \"NORMAL vertex attribute must have 3 components, but found \" + s.componentCount.toFixed()), this._wrapAccessor(O, s);\n  }\n\n  async getTangentData(e, t) {\n    const r = this.errorContext;\n    r.assert(null != e.attributes.TANGENT, \"No TANGENT vertex data found.\");\n    const s = await this.getAccessor(e.attributes.TANGENT, t);\n    return r.errorUnsupportedIf(s.componentType !== j.FLOAT, \"Expected type FLOAT for TANGENT vertex attribute, but found \" + z[s.componentType]), r.errorUnsupportedIf(4 !== s.componentCount, \"TANGENT vertex attribute must have 4 components, but found \" + s.componentCount.toFixed()), new w(s.raw, s.byteOffset, s.byteStride, s.byteOffset + s.byteStride * s.entryCount);\n  }\n\n  async getTextureCoordinates(e, t) {\n    const r = this.errorContext;\n    r.assert(null != e.attributes.TEXCOORD_0, \"No TEXCOORD_0 vertex data found.\");\n    const s = await this.getAccessor(e.attributes.TEXCOORD_0, t);\n    return r.errorUnsupportedIf(2 !== s.componentCount, \"TEXCOORD_0 vertex attribute must have 2 components, but found \" + s.componentCount.toFixed()), s.componentType === j.FLOAT ? this._wrapAccessor(N, s) : (r.errorUnsupportedIf(!s.normalized, \"Integer component types are only supported for a normalized accessor for TEXCOORD_0.\"), J(s));\n  }\n\n  async getVertexColors(e, t) {\n    const r = this.errorContext;\n    r.assert(null != e.attributes.COLOR_0, \"No COLOR_0 vertex data found.\");\n    const s = await this.getAccessor(e.attributes.COLOR_0, t);\n\n    if (r.errorUnsupportedIf(4 !== s.componentCount && 3 !== s.componentCount, \"COLOR_0 attribute must have 3 or 4 components, but found \" + s.componentCount.toFixed()), 4 === s.componentCount) {\n      if (s.componentType === j.FLOAT) return this._wrapAccessor(w, s);\n      if (s.componentType === j.UNSIGNED_BYTE) return this._wrapAccessor(x, s);\n      if (s.componentType === j.UNSIGNED_SHORT) return this._wrapAccessor(S, s);\n    } else if (3 === s.componentCount) {\n      if (s.componentType === j.FLOAT) return this._wrapAccessor(O, s);\n      if (s.componentType === j.UNSIGNED_BYTE) return this._wrapAccessor(C, s);\n      if (s.componentType === j.UNSIGNED_SHORT) return this._wrapAccessor(_, s);\n    }\n\n    r.errorUnsupported(\"Unsupported component type for COLOR_0 attribute: \" + z[s.componentType]);\n  }\n\n  hasPositions(e) {\n    return void 0 !== e.attributes.POSITION;\n  }\n\n  hasNormals(e) {\n    return void 0 !== e.attributes.NORMAL;\n  }\n\n  hasVertexColors(e) {\n    return void 0 !== e.attributes.COLOR_0;\n  }\n\n  hasTextureCoordinates(e) {\n    return void 0 !== e.attributes.TEXCOORD_0;\n  }\n\n  hasTangents(e) {\n    return void 0 !== e.attributes.TANGENT;\n  }\n\n  async getMaterial(e, t, r) {\n    let s = this.materialCache.get(e.material);\n\n    if (!s) {\n      const n = null != e.material ? D(this.json.materials[e.material]) : D(),\n            o = n.pbrMetallicRoughness,\n            a = this.hasVertexColors(e),\n            i = this.getTexture(o.baseColorTexture, t),\n            u = this.getTexture(n.normalTexture, t),\n            c = r ? this.getTexture(n.occlusionTexture, t) : null,\n            p = r ? this.getTexture(n.emissiveTexture, t) : null,\n            f = r ? this.getTexture(o.metallicRoughnessTexture, t) : null,\n            d = null != e.material ? e.material : -1;\n      s = {\n        alphaMode: n.alphaMode,\n        alphaCutoff: n.alphaCutoff,\n        color: o.baseColorFactor,\n        doubleSided: !!n.doubleSided,\n        colorTexture: await i,\n        normalTexture: await u,\n        name: n.name,\n        id: d,\n        occlusionTexture: await c,\n        emissiveTexture: await p,\n        emissiveFactor: n.emissiveFactor,\n        metallicFactor: o.metallicFactor,\n        roughnessFactor: o.roughnessFactor,\n        metallicRoughnessTexture: await f,\n        vertexColors: a,\n        ESRI_externalColorMixMode: n.extras.ESRI_externalColorMixMode\n      };\n    }\n\n    return s;\n  }\n\n  async getTexture(e, r) {\n    if (!e) return null;\n    this.errorContext.errorUnsupportedIf(0 !== (e.texCoord || 0), \"Only TEXCOORD with index 0 is supported.\");\n    const s = e.index,\n          n = this.errorContext,\n          o = this.json.textures[s],\n          a = G(null != o.sampler ? this.json.samplers[o.sampler] : {});\n    n.errorUnsupportedIf(null == o.source, \"Source is expected to be defined for a texture.\");\n    const i = this.json.images[o.source],\n          u = await this._loadTextureImageData(s, o, r);\n    return t(this.textureCache, s, () => {\n      const e = e => 33071 === e || 33648 === e || 10497 === e,\n            t = e => (n.error(`Unexpected TextureSampler WrapMode: ${e}. Using default REPEAT(10497).`), 10497);\n\n      return {\n        data: u,\n        wrapS: e(a.wrapS) ? a.wrapS : t(a.wrapS),\n        wrapT: e(a.wrapT) ? a.wrapT : t(a.wrapT),\n        minFilter: a.minFilter,\n        name: i.name,\n        id: s\n      };\n    });\n  }\n\n  getNodeTransform(e) {\n    if (void 0 === e) return k;\n    let t = this.nodeTransformCache.get(e);\n\n    if (!t) {\n      const r = this.getNodeTransform(this._getNodeParent(e)),\n            s = this.json.nodes[e];\n      s.matrix ? t = u(d(), r, s.matrix) : s.translation || s.rotation || s.scale ? (t = l(r), s.translation && c(t, t, s.translation), s.rotation && (V[3] = m(V, s.rotation), p(t, t, V[3], V)), s.scale && f(t, t, s.scale)) : t = r, this.nodeTransformCache.set(e, t);\n    }\n\n    return t;\n  }\n\n  _wrapAccessor(e, t) {\n    return new e(t.raw, t.byteOffset, t.byteStride, t.byteOffset + t.byteStride * (t.entryCount - 1) + t.componentByteSize * t.componentCount);\n  }\n\n  _resolveUri(e) {\n    return o(e, this.baseUri);\n  }\n\n  _getNodeParent(e) {\n    return this.nodeParentMap.get(e);\n  }\n\n  _checkVersionSupported() {\n    const e = a.parse(this.json.asset.version, \"glTF\");\n    P.validate(e);\n  }\n\n  _checkRequiredExtensionsSupported() {\n    const e = this.json,\n          t = this.errorContext;\n    e.extensionsRequired && 0 !== e.extensionsRequired.length && t.errorUnsupported(\"gltf loader was not able to load unsupported feature. Required extensions: \" + e.extensionsRequired.join(\", \"));\n  }\n\n  _computeNodeParents() {\n    this.json.nodes.forEach((e, t) => {\n      e.children && e.children.forEach(e => {\n        this.nodeParentMap.set(e, t);\n      });\n    });\n  }\n\n  async _loadTextureImageData(e, t, r) {\n    const s = this.textureLoaders.get(e);\n    if (s) return s;\n\n    const n = this._createTextureLoader(t, r);\n\n    return this.textureLoaders.set(e, n), n;\n  }\n\n  async _createTextureLoader(e, t) {\n    const r = this.json.images[e.source];\n    if (r.uri) return this.context.loadImage(this._resolveUri(r.uri), t);\n    const s = this.errorContext;\n    s.errorUnsupportedIf(null == r.bufferView, \"Image bufferView must be defined.\"), s.errorUnsupportedIf(null == r.mimeType, \"Image mimeType must be defined.\");\n    const n = this.json.bufferViews[r.bufferView],\n          o = await this.getBuffer(n.buffer, t);\n    return s.errorUnsupportedIf(null != n.byteStride, \"byteStride not supported for image buffer\"), X(new Uint8Array(o.buffer, o.byteOffset + (n.byteOffset || 0), n.byteLength), r.mimeType);\n  }\n\n}\n\nconst P = new a(2, 0, \"glTF\"),\n      k = i(d(), Math.PI / 2),\n      V = h(),\n      H = {\n  SCALAR: 1,\n  VEC2: 2,\n  VEC3: 3,\n  VEC4: 4\n},\n      Y = {\n  [j.BYTE]: 1,\n  [j.UNSIGNED_BYTE]: 1,\n  [j.SHORT]: 2,\n  [j.UNSIGNED_SHORT]: 2,\n  [j.FLOAT]: 4,\n  [j.UNSIGNED_INT]: 4\n};\n\nfunction J(t) {\n  switch (t.componentType) {\n    case j.BYTE:\n      return new E(t.raw, t.byteOffset, t.byteStride, t.byteOffset + t.byteStride * t.entryCount);\n\n    case j.UNSIGNED_BYTE:\n      return new A(t.raw, t.byteOffset, t.byteStride, t.byteOffset + t.byteStride * t.entryCount);\n\n    case j.SHORT:\n      return new g(t.raw, t.byteOffset, t.byteStride, t.byteOffset + t.byteStride * t.entryCount);\n\n    case j.UNSIGNED_SHORT:\n      return new I(t.raw, t.byteOffset, t.byteStride, t.byteOffset + t.byteStride * t.entryCount);\n\n    case j.UNSIGNED_INT:\n      return new U(t.raw, t.byteOffset, t.byteStride, t.byteOffset + t.byteStride * t.entryCount);\n\n    case j.FLOAT:\n      return new N(t.raw, t.byteOffset, t.byteStride, t.byteOffset + t.byteStride * t.entryCount);\n\n    default:\n      return void e(t.componentType);\n  }\n}\n\nasync function q(e) {\n  return new Promise((t, r) => {\n    const s = new Blob([e]),\n          n = new FileReader();\n    n.onload = () => {\n      const e = n.result;\n      t(JSON.parse(e));\n    }, n.onerror = e => {\n      r(e);\n    }, n.readAsText(s);\n  });\n}\n\nasync function X(e, t) {\n  return new Promise((r, s) => {\n    const n = new Blob([e], {\n      type: t\n    }),\n          o = URL.createObjectURL(n),\n          a = new Image();\n    a.addEventListener(\"load\", () => {\n      URL.revokeObjectURL(o), \"decode\" in a ? a.decode().then(() => r(a), () => r(a)) : r(a);\n    }), a.addEventListener(\"error\", e => {\n      URL.revokeObjectURL(o), s(e);\n    }), a.src = o;\n  });\n}\n\nconst z = {\n  5120: \"BYTE\",\n  5121: \"UNSIGNED_BYTE\",\n  5122: \"SHORT\",\n  5123: \"UNSIGNED_SHORT\",\n  5125: \"UNSIGNED_INT\",\n  5126: \"FLOAT\"\n};\nexport { F as Resource };","map":{"version":3,"sources":["D:/Github/CUSP_DataBase/CUSP_DB/src/main/gis/node_modules/@arcgis/core/views/3d/glTF/internal/Resource.js"],"names":["neverReached","e","getOrCreateMapValue","t","isDataProtocol","r","dataComponents","s","dataToArrayBuffer","n","makeAbsolute","o","Version","a","y","i","m","u","j","c","p","h","f","d","b","l","g","BufferViewUint32","BufferViewUint16","BufferViewUint8","T","BufferViewVec3f","O","BufferViewVec4f","w","BufferViewVec2f","N","BufferViewVec4u8","x","BufferViewVec4u16","S","BufferViewVec3u8","C","BufferViewVec3u16","_","BufferViewVec2u32","U","BufferViewVec2u16","I","BufferViewVec2i16","BufferViewVec2u8","A","BufferViewVec2i8","E","L","BinaryStreamReader","B","AttributeType","R","material","D","textureSampler","G","splitURI","v","DataType","M","MAGIC","CHUNK_TYPE_JSON","CHUNK_TYPE_BIN","MIN_HEADER_LENGTH","F","constructor","context","errorContext","uri","json","glbBuffer","bufferLoaders","Map","textureLoaders","textureCache","materialCache","nodeParentMap","nodeTransformCache","baseUri","dirPart","_checkVersionSupported","_checkRequiredExtensionsSupported","errorUnsupportedIf","scenes","meshes","nodes","_computeNodeParents","load","mediaType","JSON","parse","isBase64","atob","data","_isGLBData","_fromGLBData","endsWith","loadJSON","loadBinary","remainingBytes","readUint32","_parseGLBData","binaryData","assert","byteLength","q","readUint8Array","warnUnsupported","error","getBuffer","buffers","_getBufferLoader","get","_resolveUri","then","Uint8Array","set","getAccessor","accessors","bufferView","type","MAT2","MAT3","MAT4","bufferViews","buffer","H","Y","componentType","byteStride","raw","byteOffset","entryCount","count","isDenselyPacked","componentCount","componentByteSize","min","max","normalized","getIndexData","indices","UNSIGNED_BYTE","UNSIGNED_SHORT","Uint16Array","UNSIGNED_INT","Uint32Array","_wrapAccessor","getPositionData","attributes","POSITION","FLOAT","z","toFixed","getNormalData","NORMAL","getTangentData","TANGENT","getTextureCoordinates","TEXCOORD_0","J","getVertexColors","COLOR_0","errorUnsupported","hasPositions","hasNormals","hasVertexColors","hasTextureCoordinates","hasTangents","getMaterial","materials","pbrMetallicRoughness","getTexture","baseColorTexture","normalTexture","occlusionTexture","emissiveTexture","metallicRoughnessTexture","alphaMode","alphaCutoff","color","baseColorFactor","doubleSided","colorTexture","name","id","emissiveFactor","metallicFactor","roughnessFactor","vertexColors","ESRI_externalColorMixMode","extras","texCoord","index","textures","sampler","samplers","source","images","_loadTextureImageData","wrapS","wrapT","minFilter","getNodeTransform","k","_getNodeParent","matrix","translation","rotation","scale","V","asset","version","P","validate","extensionsRequired","length","join","forEach","children","_createTextureLoader","loadImage","mimeType","X","Math","PI","SCALAR","VEC2","VEC3","VEC4","BYTE","SHORT","Promise","Blob","FileReader","onload","result","onerror","readAsText","URL","createObjectURL","Image","addEventListener","revokeObjectURL","decode","src","Resource"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport{neverReached as e}from\"../../../../core/compilerUtils.js\";import{getOrCreateMapValue as t}from\"../../../../core/MapUtils.js\";import{isDataProtocol as r,dataComponents as s,dataToArrayBuffer as n,makeAbsolute as o}from\"../../../../core/urlUtils.js\";import{Version as a}from\"../../../../core/Version.js\";import{y as i,m as u,j as c,e as p,h as f}from\"../../../../chunks/mat4.js\";import{c as d,b as l}from\"../../../../chunks/mat4f64.js\";import{g as m}from\"../../../../chunks/quat.js\";import{a as h}from\"../../../../chunks/quatf64.js\";import{BufferViewUint32 as y,BufferViewUint16 as b,BufferViewUint8 as T,BufferViewVec3f as O,BufferViewVec4f as w,BufferViewVec2f as N,BufferViewVec4u8 as x,BufferViewVec4u16 as S,BufferViewVec3u8 as C,BufferViewVec3u16 as _,BufferViewVec2u32 as U,BufferViewVec2u16 as I,BufferViewVec2i16 as g,BufferViewVec2u8 as A,BufferViewVec2i8 as E}from\"../../../../geometry/support/buffer/BufferView.js\";import{m as L}from\"../../../../chunks/scalar.js\";import{BinaryStreamReader as B}from\"./BinaryStreamReader.js\";import{AttributeType as R}from\"./enums.js\";import{material as D,textureSampler as G}from\"./fillDefaults.js\";import{splitURI as v}from\"./pathUtils.js\";import{DataType as j}from\"../../../webgl/enums.js\";const M={MAGIC:1179937895,CHUNK_TYPE_JSON:1313821514,CHUNK_TYPE_BIN:5130562,MIN_HEADER_LENGTH:20};class F{constructor(e,t,r,s,n){this.context=e,this.errorContext=t,this.uri=r,this.json=s,this.glbBuffer=n,this.bufferLoaders=new Map,this.textureLoaders=new Map,this.textureCache=new Map,this.materialCache=new Map,this.nodeParentMap=new Map,this.nodeTransformCache=new Map,this.baseUri=v(this.uri).dirPart,this._checkVersionSupported(),this._checkRequiredExtensionsSupported(),t.errorUnsupportedIf(null==s.scenes,\"Scenes must be defined.\"),t.errorUnsupportedIf(null==s.meshes,\"Meshes must be defined\"),t.errorUnsupportedIf(null==s.nodes,\"Nodes must be defined.\"),this._computeNodeParents()}static async load(e,t,o,a){if(r(o)){const r=s(o);if(\"model/gltf-binary\"!==r.mediaType)try{const s=JSON.parse(r.isBase64?atob(r.data):r.data);return new F(e,t,o,s)}catch{}const a=n(o);if(F._isGLBData(a))return this._fromGLBData(e,t,o,a)}if(o.endsWith(\".gltf\")){const r=await e.loadJSON(o,a);return new F(e,t,o,r)}const i=await e.loadBinary(o,a);if(F._isGLBData(i))return this._fromGLBData(e,t,o,i);const u=await e.loadJSON(o,a);return new F(e,t,o,u)}static _isGLBData(e){const t=new B(e);return t.remainingBytes()>=4&&t.readUint32()===M.MAGIC}static async _fromGLBData(e,t,r,s){const n=await F._parseGLBData(t,s);return new F(e,t,r,n.json,n.binaryData)}static async _parseGLBData(e,t){const r=new B(t);e.assert(r.remainingBytes()>=12,\"GLB binary data is insufficiently large.\");const s=r.readUint32(),n=r.readUint32(),o=r.readUint32();e.assert(s===M.MAGIC,\"Magic first 4 bytes do not fit to expected GLB value.\"),e.assert(t.byteLength>=o,\"GLB binary data is smaller than header specifies.\"),e.errorUnsupportedIf(2!==n,\"An unsupported GLB container version was detected. Only version 2 is supported.\");let a,i,u=0;for(;r.remainingBytes()>=8;){const t=r.readUint32(),s=r.readUint32();0===u?(e.assert(s===M.CHUNK_TYPE_JSON,\"First GLB chunk must be JSON.\"),e.assert(t>=0,\"No JSON data found.\"),a=await q(r.readUint8Array(t))):1===u?(e.errorUnsupportedIf(s!==M.CHUNK_TYPE_BIN,\"Second GLB chunk expected to be BIN.\"),i=r.readUint8Array(t)):e.warnUnsupported(\"More than 2 GLB chunks detected. Skipping.\"),u+=1}return a||e.error(\"No GLB JSON chunk detected.\"),{json:a,binaryData:i}}async getBuffer(e,t){const r=this.json.buffers[e],s=this.errorContext;if(null==r.uri)return s.assert(null!=this.glbBuffer,\"GLB buffer not present\"),this.glbBuffer;const n=await this._getBufferLoader(e,t);return s.assert(n.byteLength===r.byteLength,\"Buffer byte lengths should match.\"),n}async _getBufferLoader(e,t){const r=this.bufferLoaders.get(e);if(r)return r;const s=this.json.buffers[e],n=this.context.loadBinary(this._resolveUri(s.uri),t).then((e=>new Uint8Array(e)));return this.bufferLoaders.set(e,n),n}async getAccessor(e,t){const r=this.errorContext;r.errorUnsupportedIf(!this.json.accessors,\"Accessors missing.\");const s=this.json.accessors[e];r.errorUnsupportedIf(null==(null==s?void 0:s.bufferView),\"Some accessor does not specify a bufferView.\"),r.errorUnsupportedIf(s.type in[R.MAT2,R.MAT3,R.MAT4],`AttributeType ${s.type} is not supported`);const n=this.json.bufferViews[s.bufferView],o=await this.getBuffer(n.buffer,t),a=H[s.type],i=Y[s.componentType],u=a*i,c=n.byteStride||u;return{raw:o.buffer,byteStride:c,byteOffset:o.byteOffset+(n.byteOffset||0)+(s.byteOffset||0),entryCount:s.count,isDenselyPacked:c===u,componentCount:a,componentByteSize:i,componentType:s.componentType,min:s.min,max:s.max,normalized:!!s.normalized}}async getIndexData(e,t){if(null==e.indices)return null;const r=await this.getAccessor(e.indices,t);if(r.isDenselyPacked)switch(r.componentType){case j.UNSIGNED_BYTE:return new Uint8Array(r.raw,r.byteOffset,r.entryCount);case j.UNSIGNED_SHORT:return new Uint16Array(r.raw,r.byteOffset,r.entryCount);case j.UNSIGNED_INT:return new Uint32Array(r.raw,r.byteOffset,r.entryCount)}else switch(r.componentType){case j.UNSIGNED_BYTE:return L(this._wrapAccessor(T,r));case j.UNSIGNED_SHORT:return L(this._wrapAccessor(b,r));case j.UNSIGNED_INT:return L(this._wrapAccessor(y,r))}}async getPositionData(e,t){const r=this.errorContext;r.errorUnsupportedIf(null==e.attributes.POSITION,\"No POSITION vertex data found.\");const s=await this.getAccessor(e.attributes.POSITION,t);return r.errorUnsupportedIf(s.componentType!==j.FLOAT,\"Expected type FLOAT for POSITION vertex attribute, but found \"+z[s.componentType]),r.errorUnsupportedIf(3!==s.componentCount,\"POSITION vertex attribute must have 3 components, but found \"+s.componentCount.toFixed()),this._wrapAccessor(O,s)}async getNormalData(e,t){const r=this.errorContext;r.assert(null!=e.attributes.NORMAL,\"No NORMAL vertex data found.\");const s=await this.getAccessor(e.attributes.NORMAL,t);return r.errorUnsupportedIf(s.componentType!==j.FLOAT,\"Expected type FLOAT for NORMAL vertex attribute, but found \"+z[s.componentType]),r.errorUnsupportedIf(3!==s.componentCount,\"NORMAL vertex attribute must have 3 components, but found \"+s.componentCount.toFixed()),this._wrapAccessor(O,s)}async getTangentData(e,t){const r=this.errorContext;r.assert(null!=e.attributes.TANGENT,\"No TANGENT vertex data found.\");const s=await this.getAccessor(e.attributes.TANGENT,t);return r.errorUnsupportedIf(s.componentType!==j.FLOAT,\"Expected type FLOAT for TANGENT vertex attribute, but found \"+z[s.componentType]),r.errorUnsupportedIf(4!==s.componentCount,\"TANGENT vertex attribute must have 4 components, but found \"+s.componentCount.toFixed()),new w(s.raw,s.byteOffset,s.byteStride,s.byteOffset+s.byteStride*s.entryCount)}async getTextureCoordinates(e,t){const r=this.errorContext;r.assert(null!=e.attributes.TEXCOORD_0,\"No TEXCOORD_0 vertex data found.\");const s=await this.getAccessor(e.attributes.TEXCOORD_0,t);return r.errorUnsupportedIf(2!==s.componentCount,\"TEXCOORD_0 vertex attribute must have 2 components, but found \"+s.componentCount.toFixed()),s.componentType===j.FLOAT?this._wrapAccessor(N,s):(r.errorUnsupportedIf(!s.normalized,\"Integer component types are only supported for a normalized accessor for TEXCOORD_0.\"),J(s))}async getVertexColors(e,t){const r=this.errorContext;r.assert(null!=e.attributes.COLOR_0,\"No COLOR_0 vertex data found.\");const s=await this.getAccessor(e.attributes.COLOR_0,t);if(r.errorUnsupportedIf(4!==s.componentCount&&3!==s.componentCount,\"COLOR_0 attribute must have 3 or 4 components, but found \"+s.componentCount.toFixed()),4===s.componentCount){if(s.componentType===j.FLOAT)return this._wrapAccessor(w,s);if(s.componentType===j.UNSIGNED_BYTE)return this._wrapAccessor(x,s);if(s.componentType===j.UNSIGNED_SHORT)return this._wrapAccessor(S,s)}else if(3===s.componentCount){if(s.componentType===j.FLOAT)return this._wrapAccessor(O,s);if(s.componentType===j.UNSIGNED_BYTE)return this._wrapAccessor(C,s);if(s.componentType===j.UNSIGNED_SHORT)return this._wrapAccessor(_,s)}r.errorUnsupported(\"Unsupported component type for COLOR_0 attribute: \"+z[s.componentType])}hasPositions(e){return void 0!==e.attributes.POSITION}hasNormals(e){return void 0!==e.attributes.NORMAL}hasVertexColors(e){return void 0!==e.attributes.COLOR_0}hasTextureCoordinates(e){return void 0!==e.attributes.TEXCOORD_0}hasTangents(e){return void 0!==e.attributes.TANGENT}async getMaterial(e,t,r){let s=this.materialCache.get(e.material);if(!s){const n=null!=e.material?D(this.json.materials[e.material]):D(),o=n.pbrMetallicRoughness,a=this.hasVertexColors(e),i=this.getTexture(o.baseColorTexture,t),u=this.getTexture(n.normalTexture,t),c=r?this.getTexture(n.occlusionTexture,t):null,p=r?this.getTexture(n.emissiveTexture,t):null,f=r?this.getTexture(o.metallicRoughnessTexture,t):null,d=null!=e.material?e.material:-1;s={alphaMode:n.alphaMode,alphaCutoff:n.alphaCutoff,color:o.baseColorFactor,doubleSided:!!n.doubleSided,colorTexture:await i,normalTexture:await u,name:n.name,id:d,occlusionTexture:await c,emissiveTexture:await p,emissiveFactor:n.emissiveFactor,metallicFactor:o.metallicFactor,roughnessFactor:o.roughnessFactor,metallicRoughnessTexture:await f,vertexColors:a,ESRI_externalColorMixMode:n.extras.ESRI_externalColorMixMode}}return s}async getTexture(e,r){if(!e)return null;this.errorContext.errorUnsupportedIf(0!==(e.texCoord||0),\"Only TEXCOORD with index 0 is supported.\");const s=e.index,n=this.errorContext,o=this.json.textures[s],a=G(null!=o.sampler?this.json.samplers[o.sampler]:{});n.errorUnsupportedIf(null==o.source,\"Source is expected to be defined for a texture.\");const i=this.json.images[o.source],u=await this._loadTextureImageData(s,o,r);return t(this.textureCache,s,(()=>{const e=e=>33071===e||33648===e||10497===e,t=e=>(n.error(`Unexpected TextureSampler WrapMode: ${e}. Using default REPEAT(10497).`),10497);return{data:u,wrapS:e(a.wrapS)?a.wrapS:t(a.wrapS),wrapT:e(a.wrapT)?a.wrapT:t(a.wrapT),minFilter:a.minFilter,name:i.name,id:s}}))}getNodeTransform(e){if(void 0===e)return k;let t=this.nodeTransformCache.get(e);if(!t){const r=this.getNodeTransform(this._getNodeParent(e)),s=this.json.nodes[e];s.matrix?t=u(d(),r,s.matrix):s.translation||s.rotation||s.scale?(t=l(r),s.translation&&c(t,t,s.translation),s.rotation&&(V[3]=m(V,s.rotation),p(t,t,V[3],V)),s.scale&&f(t,t,s.scale)):t=r,this.nodeTransformCache.set(e,t)}return t}_wrapAccessor(e,t){return new e(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*(t.entryCount-1)+t.componentByteSize*t.componentCount)}_resolveUri(e){return o(e,this.baseUri)}_getNodeParent(e){return this.nodeParentMap.get(e)}_checkVersionSupported(){const e=a.parse(this.json.asset.version,\"glTF\");P.validate(e)}_checkRequiredExtensionsSupported(){const e=this.json,t=this.errorContext;e.extensionsRequired&&0!==e.extensionsRequired.length&&t.errorUnsupported(\"gltf loader was not able to load unsupported feature. Required extensions: \"+e.extensionsRequired.join(\", \"))}_computeNodeParents(){this.json.nodes.forEach(((e,t)=>{e.children&&e.children.forEach((e=>{this.nodeParentMap.set(e,t)}))}))}async _loadTextureImageData(e,t,r){const s=this.textureLoaders.get(e);if(s)return s;const n=this._createTextureLoader(t,r);return this.textureLoaders.set(e,n),n}async _createTextureLoader(e,t){const r=this.json.images[e.source];if(r.uri)return this.context.loadImage(this._resolveUri(r.uri),t);const s=this.errorContext;s.errorUnsupportedIf(null==r.bufferView,\"Image bufferView must be defined.\"),s.errorUnsupportedIf(null==r.mimeType,\"Image mimeType must be defined.\");const n=this.json.bufferViews[r.bufferView],o=await this.getBuffer(n.buffer,t);return s.errorUnsupportedIf(null!=n.byteStride,\"byteStride not supported for image buffer\"),X(new Uint8Array(o.buffer,o.byteOffset+(n.byteOffset||0),n.byteLength),r.mimeType)}}const P=new a(2,0,\"glTF\"),k=i(d(),Math.PI/2),V=h(),H={SCALAR:1,VEC2:2,VEC3:3,VEC4:4},Y={[j.BYTE]:1,[j.UNSIGNED_BYTE]:1,[j.SHORT]:2,[j.UNSIGNED_SHORT]:2,[j.FLOAT]:4,[j.UNSIGNED_INT]:4};function J(t){switch(t.componentType){case j.BYTE:return new E(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case j.UNSIGNED_BYTE:return new A(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case j.SHORT:return new g(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case j.UNSIGNED_SHORT:return new I(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case j.UNSIGNED_INT:return new U(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case j.FLOAT:return new N(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);default:return void e(t.componentType)}}async function q(e){return new Promise(((t,r)=>{const s=new Blob([e]),n=new FileReader;n.onload=()=>{const e=n.result;t(JSON.parse(e))},n.onerror=e=>{r(e)},n.readAsText(s)}))}async function X(e,t){return new Promise(((r,s)=>{const n=new Blob([e],{type:t}),o=URL.createObjectURL(n),a=new Image;a.addEventListener(\"load\",(()=>{URL.revokeObjectURL(o),\"decode\"in a?a.decode().then((()=>r(a)),(()=>r(a))):r(a)})),a.addEventListener(\"error\",(e=>{URL.revokeObjectURL(o),s(e)})),a.src=o}))}const z={5120:\"BYTE\",5121:\"UNSIGNED_BYTE\",5122:\"SHORT\",5123:\"UNSIGNED_SHORT\",5125:\"UNSIGNED_INT\",5126:\"FLOAT\"};export{F as Resource};\n"]},"metadata":{},"sourceType":"module"}