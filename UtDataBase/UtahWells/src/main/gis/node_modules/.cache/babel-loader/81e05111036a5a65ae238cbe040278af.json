{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport e from \"../../../../../../core/has.js\";\nimport { createResolver as t } from \"../../../../../../core/promiseUtils.js\";\nimport { brushes as s } from \"../../../../engine/brushes.js\";\nimport { FeatureContainer as i } from \"../../../../engine/FeatureContainer.js\";\nimport { WGLDrawPhase as r } from \"../../../../engine/webgl/enums.js\";\nconst a = e(\"featurelayer-order-by-server-enabled\");\n\nclass l extends i {\n  constructor(e, t, s, i) {\n    super(e), this._pointToCallbacks = [], this._layer = s, this._layerView = t, this._onUpdate = i;\n  }\n\n  renderChildren(e) {\n    if (this.attributeView.update(), this.hasAnimation) {\n      e.painter.effects.integrate.draw(e, e.attributeView);\n    }\n\n    super.renderChildren(e);\n  }\n\n  hasEmptyAttributeView() {\n    return this.attributeView.isEmpty();\n  }\n\n  isUpdating() {\n    return this.attributeView.isUpdating();\n  }\n\n  hitTest(e) {\n    const s = t();\n    return this._pointToCallbacks.push({\n      point: e,\n      resolver: s\n    }), this.requestRender(), s.promise;\n  }\n\n  onTileData(e, t) {\n    const s = a && \"orderBy\" in this._layer && this._layer.orderBy,\n          i = (null == s ? void 0 : s.length) && !s[0].valueExpression && s[0].field,\n          r = s && this._layerView.orderByFields === i;\n    e.patch(t, r), this.contains(e) || this.addChild(e), this.requestRender();\n  }\n\n  onTileError(e) {\n    this.contains(e) || this.addChild(e);\n  }\n\n  updateTransitionProperties(e, t) {\n    super.updateTransitionProperties(e, t), this._layerView.featureEffectView.transitionStep(e, t), this._layerView.featureEffectView.transitioning && this.requestRender();\n  }\n\n  doRender(e) {\n    const {\n      minScale: t,\n      maxScale: s\n    } = this._layer,\n          i = e.state.scale;\n    i <= (t || 1 / 0) && i >= s && super.doRender(e);\n  }\n\n  onAttributeStoreUpdate() {\n    this.hasLabels && this._layerView.view.labelManager.requestUpdate(), this._onUpdate();\n  }\n\n  get hasAnimation() {\n    return this.hasLabels;\n  }\n\n  setStencilReference(e) {\n    if (e.rendererInfo.ddDotSize > 1) {\n      const e = 1;\n\n      for (const t of this.children) t.stencilRef = t.key.level + e;\n    } else super.setStencilReference(e);\n  }\n\n  get hasLabels() {\n    if (\"sublayers\" in this._layer) return this._layer.sublayers.some(e => e.labelingInfo && e.labelingInfo.length && e.labelsVisible);\n    const e = this._layer.featureReduction,\n          t = e && \"cluster\" === e.type && e.labelsVisible && e.labelingInfo && e.labelingInfo.length;\n    return this._layer.labelingInfo && this._layer.labelingInfo.length && this._layer.labelsVisible || !!t;\n  }\n\n  prepareRenderPasses(e) {\n    const t = e.registerRenderPass({\n      name: \"label\",\n      brushes: [s.label],\n      target: () => this.hasLabels ? this.children : null,\n      drawPhase: r.LABEL | r.LABEL_ALPHA\n    }),\n          i = e.registerRenderPass({\n      name: \"geometry\",\n      brushes: [s.fill, s.line, s.marker, s.text],\n      target: () => this.children,\n      enableDefaultDraw: () => !this._layerView.featureEffectView.hasEffects,\n      effects: [{\n        apply: e.effects.outsideEffect,\n        enable: () => this._layerView.featureEffectView.hasEffects,\n        args: () => this._layerView.featureEffectView.excludedEffects\n      }, {\n        apply: e.effects.insideEffect,\n        enable: () => this._layerView.featureEffectView.hasEffects,\n        args: () => this._layerView.featureEffectView.includedEffects\n      }, {\n        apply: e.effects.hittest,\n        enable: () => !!this._pointToCallbacks.length,\n        args: () => this._pointToCallbacks\n      }]\n    }),\n          a = e.registerRenderPass({\n      name: \"highlight\",\n      brushes: [s.fill, s.line, s.marker, s.text],\n      target: () => this.children,\n      drawPhase: r.HIGHLIGHT,\n      enableDefaultDraw: () => !1,\n      effects: [{\n        apply: e.effects.highlight,\n        enable: () => !!this._layerView.hasHighlight()\n      }]\n    });\n    return [...super.prepareRenderPasses(e), i, a, t];\n  }\n\n}\n\nexport { l as WGLFeatureView };","map":{"version":3,"sources":["D:/Github/CUSP_DataBase/CUSP_DB/src/main/gis/node_modules/@arcgis/core/views/2d/layers/features/tileRenderers/support/WGLFeatureView.js"],"names":["e","createResolver","t","brushes","s","FeatureContainer","i","WGLDrawPhase","r","a","l","constructor","_pointToCallbacks","_layer","_layerView","_onUpdate","renderChildren","attributeView","update","hasAnimation","painter","effects","integrate","draw","hasEmptyAttributeView","isEmpty","isUpdating","hitTest","push","point","resolver","requestRender","promise","onTileData","orderBy","length","valueExpression","field","orderByFields","patch","contains","addChild","onTileError","updateTransitionProperties","featureEffectView","transitionStep","transitioning","doRender","minScale","maxScale","state","scale","onAttributeStoreUpdate","hasLabels","view","labelManager","requestUpdate","setStencilReference","rendererInfo","ddDotSize","children","stencilRef","key","level","sublayers","some","labelingInfo","labelsVisible","featureReduction","type","prepareRenderPasses","registerRenderPass","name","label","target","drawPhase","LABEL","LABEL_ALPHA","fill","line","marker","text","enableDefaultDraw","hasEffects","apply","outsideEffect","enable","args","excludedEffects","insideEffect","includedEffects","hittest","HIGHLIGHT","highlight","hasHighlight","WGLFeatureView"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport e from\"../../../../../../core/has.js\";import{createResolver as t}from\"../../../../../../core/promiseUtils.js\";import{brushes as s}from\"../../../../engine/brushes.js\";import{FeatureContainer as i}from\"../../../../engine/FeatureContainer.js\";import{WGLDrawPhase as r}from\"../../../../engine/webgl/enums.js\";const a=e(\"featurelayer-order-by-server-enabled\");class l extends i{constructor(e,t,s,i){super(e),this._pointToCallbacks=[],this._layer=s,this._layerView=t,this._onUpdate=i}renderChildren(e){if(this.attributeView.update(),this.hasAnimation){e.painter.effects.integrate.draw(e,e.attributeView)}super.renderChildren(e)}hasEmptyAttributeView(){return this.attributeView.isEmpty()}isUpdating(){return this.attributeView.isUpdating()}hitTest(e){const s=t();return this._pointToCallbacks.push({point:e,resolver:s}),this.requestRender(),s.promise}onTileData(e,t){const s=a&&\"orderBy\"in this._layer&&this._layer.orderBy,i=(null==s?void 0:s.length)&&!s[0].valueExpression&&s[0].field,r=s&&this._layerView.orderByFields===i;e.patch(t,r),this.contains(e)||this.addChild(e),this.requestRender()}onTileError(e){this.contains(e)||this.addChild(e)}updateTransitionProperties(e,t){super.updateTransitionProperties(e,t),this._layerView.featureEffectView.transitionStep(e,t),this._layerView.featureEffectView.transitioning&&this.requestRender()}doRender(e){const{minScale:t,maxScale:s}=this._layer,i=e.state.scale;i<=(t||1/0)&&i>=s&&super.doRender(e)}onAttributeStoreUpdate(){this.hasLabels&&this._layerView.view.labelManager.requestUpdate(),this._onUpdate()}get hasAnimation(){return this.hasLabels}setStencilReference(e){if(e.rendererInfo.ddDotSize>1){const e=1;for(const t of this.children)t.stencilRef=t.key.level+e}else super.setStencilReference(e)}get hasLabels(){if(\"sublayers\"in this._layer)return this._layer.sublayers.some((e=>e.labelingInfo&&e.labelingInfo.length&&e.labelsVisible));const e=this._layer.featureReduction,t=e&&\"cluster\"===e.type&&e.labelsVisible&&e.labelingInfo&&e.labelingInfo.length;return this._layer.labelingInfo&&this._layer.labelingInfo.length&&this._layer.labelsVisible||!!t}prepareRenderPasses(e){const t=e.registerRenderPass({name:\"label\",brushes:[s.label],target:()=>this.hasLabels?this.children:null,drawPhase:r.LABEL|r.LABEL_ALPHA}),i=e.registerRenderPass({name:\"geometry\",brushes:[s.fill,s.line,s.marker,s.text],target:()=>this.children,enableDefaultDraw:()=>!this._layerView.featureEffectView.hasEffects,effects:[{apply:e.effects.outsideEffect,enable:()=>this._layerView.featureEffectView.hasEffects,args:()=>this._layerView.featureEffectView.excludedEffects},{apply:e.effects.insideEffect,enable:()=>this._layerView.featureEffectView.hasEffects,args:()=>this._layerView.featureEffectView.includedEffects},{apply:e.effects.hittest,enable:()=>!!this._pointToCallbacks.length,args:()=>this._pointToCallbacks}]}),a=e.registerRenderPass({name:\"highlight\",brushes:[s.fill,s.line,s.marker,s.text],target:()=>this.children,drawPhase:r.HIGHLIGHT,enableDefaultDraw:()=>!1,effects:[{apply:e.effects.highlight,enable:()=>!!this._layerView.hasHighlight()}]});return[...super.prepareRenderPasses(e),i,a,t]}}export{l as WGLFeatureView};\n"]},"metadata":{},"sourceType":"module"}