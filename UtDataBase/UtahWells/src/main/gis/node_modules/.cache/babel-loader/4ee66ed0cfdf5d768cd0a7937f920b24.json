{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport e from \"../../../../../core/Error.js\";\nimport t from \"../../../../../core/Logger.js\";\nimport s from \"../../../../../core/LRUCache.js\";\nimport { createRendererExpression as i } from \"../../../../../support/arcadeOnDemand.js\";\nimport r from \"../../../arcade/callExpressionWithFeature.js\";\nimport { expandSymbol as a } from \"../../../layers/support/cimSymbolUtils.js\";\nconst n = t.getLogger(\"esri/views/2d/engine/webgl/util/Matcher\");\n\nasync function l(e, t, s, i) {\n  switch (e.type) {\n    case \"simple\":\n      return o.fromBasicRenderer(e, t, s, i);\n\n    case \"map\":\n      return d.fromUVRenderer(e, t, s, i);\n\n    case \"interval\":\n      return c.fromCBRenderer(e, t, s, i);\n\n    case \"dictionary\":\n      return p.fromDictionaryRenderer(e, t, s, i);\n\n    case \"subtype\":\n      return u.fromSubtypes(e, t, s, i);\n  }\n}\n\nclass o {\n  constructor() {\n    this.type = \"feature\", this._defaultResult = null;\n  }\n\n  static async fromBasicRenderer(e, t, s, i) {\n    const r = new o();\n\n    if (e.symbol) {\n      const n = await a(e.symbol, s, i),\n            l = t.createTemplateGroup(n, null);\n      r.setDefault(l);\n    }\n\n    return r;\n  }\n\n  size() {\n    return 1;\n  }\n\n  getDefault() {\n    return this._defaultResult;\n  }\n\n  setDefault(e) {\n    this._defaultResult = e;\n  }\n\n  match(e, t, s, i, r) {\n    return this.getDefault();\n  }\n\n  async analyze(e, t, s, i, r, a) {\n    return null;\n  }\n\n}\n\nclass u extends o {\n  constructor(e, t) {\n    super(), this._subMatchers = e, this._subtypeField = t;\n  }\n\n  static async fromSubtypes(e, t, s, i) {\n    const r = new Map(),\n          a = [];\n\n    for (const n in e.renderers) {\n      const o = parseInt(n, 10),\n            u = l(e.renderers[n], t, s, i).then(e => r.set(o, e));\n      a.push(u);\n    }\n\n    return await Promise.all(a), new u(r, e.subtypeField);\n  }\n\n  match(e, t, s, i, r) {\n    const a = t.readAttribute(this._subtypeField),\n          n = this._subMatchers.get(a);\n\n    return n ? n.match(e, t, s, i, r) : null;\n  }\n\n}\n\nclass c extends o {\n  constructor(e, t, s, i) {\n    super(), this.type = \"interval\", this._intervals = [], this._isMaxInclusive = t, this._fieldIndex = i, this._field = e, this._normalizationInfo = s;\n  }\n\n  static async fromCBRenderer(e, t, s, i) {\n    const {\n      isMaxInclusive: r,\n      normalizationField: n,\n      normalizationTotal: l,\n      normalizationType: o\n    } = e,\n          u = e.field,\n          d = new c(u, r, {\n      normalizationField: n,\n      normalizationTotal: l,\n      normalizationType: o\n    }, e.fieldIndex),\n          h = await a(e.backgroundFillSymbol, s, i);\n    await Promise.all(e.intervals.map(async e => {\n      const r = await a(e.symbol, s, i),\n            n = await t.createTemplateGroup(r, h),\n            l = {\n        min: e.min,\n        max: e.max\n      };\n      d.add(l, n);\n    }));\n    const m = await a(e.defaultSymbol, s, i);\n\n    if (m) {\n      const e = await t.createTemplateGroup(m, h);\n      d.setDefault(e);\n    }\n\n    return d;\n  }\n\n  add(e, t) {\n    this._intervals.push({\n      interval: e,\n      result: t\n    }), this._intervals.sort((e, t) => e.interval.min - t.interval.min);\n  }\n\n  size() {\n    return super.size() + this._intervals.length;\n  }\n\n  match(e, t, s, i, r) {\n    if (null == this._fieldIndex && !this._field) return this.getDefault();\n    const a = null != this._fieldIndex ? t.getComputedNumericAtIndex(this._fieldIndex) : this._getValueFromField(t);\n    if (!a && (null == a || isNaN(a))) return this.getDefault();\n\n    for (let n = 0; n < this._intervals.length; n++) {\n      const {\n        interval: e,\n        result: t\n      } = this._intervals[n],\n            s = a >= e.min,\n            i = this._isMaxInclusive ? a <= e.max : a < e.max;\n      if (s && i) return t;\n    }\n\n    return this.getDefault();\n  }\n\n  _needsNormalization() {\n    const e = this._normalizationInfo;\n    return e && (e.normalizationField || e.normalizationTotal || e.normalizationType);\n  }\n\n  _getValueFromField(e) {\n    const t = e.readAttribute(this._field);\n    if (!this._needsNormalization() || null == t) return t;\n    const {\n      normalizationField: s,\n      normalizationTotal: i,\n      normalizationType: r\n    } = this._normalizationInfo,\n          a = !!s && e.readAttribute(s);\n    if (r) switch (r) {\n      case \"esriNormalizeByField\":\n        return a ? t / a : void 0;\n\n      case \"esriNormalizeByLog\":\n        return Math.log(t) * Math.LOG10E;\n\n      case \"esriNormalizeByPercentOfTotal\":\n        return t / i * 100;\n\n      default:\n        return void n.error(`Found unknown normalization type: ${r}`);\n    } else n.error(\"Normalization is required, but no type was set!\");\n  }\n\n}\n\nclass d extends o {\n  constructor(e, t, s) {\n    super(), this.type = \"map\", this._nullResult = null, this._resultsMap = new Map(), this._fieldsIndex = s, this._fields = e, this._seperator = t || \"\";\n  }\n\n  static async fromUVRenderer(e, t, s, i) {\n    const r = e.fieldDelimiter,\n          n = [e.field];\n    e.field2 && n.push(e.field2), e.field3 && n.push(e.field3);\n    const l = await a(e.backgroundFillSymbol, s, i),\n          o = new d(n, r, e.fieldIndex);\n    await Promise.all(e.map.map(async e => {\n      const r = await a(e.symbol, s, i),\n            n = await t.createTemplateGroup(r, l);\n      \"<Null>\" === e.value ? o.setNullResult(n) : o.add(e.value, n);\n    }));\n    const u = await a(e.defaultSymbol, s, i);\n\n    if (u) {\n      const e = await t.createTemplateGroup(u, l);\n      o.setDefault(e);\n    }\n\n    return o;\n  }\n\n  setNullResult(e) {\n    this._nullResult = e;\n  }\n\n  add(e, t) {\n    this._resultsMap.set(e.toString(), t);\n  }\n\n  size() {\n    return super.size() + this._resultsMap.size;\n  }\n\n  match(e, t, s, i, r) {\n    if (null == this._fieldsIndex && !this._fields) return this.getDefault();\n    const a = null != this._fieldsIndex ? t.getComputedStringAtIndex(this._fieldsIndex) : this._getValueFromFields(t);\n    if (null !== this._nullResult && (null == a || \"\" === a || \"<Null>\" === a)) return this._nullResult;\n    if (!a && null == a) return this.getDefault();\n    const n = a.toString();\n    return this._resultsMap.has(n) ? this._resultsMap.get(n) : this.getDefault();\n  }\n\n  _getValueFromFields(e) {\n    const t = [];\n\n    for (const s of this._fields) {\n      const i = e.readAttribute(s);\n      null == i || \"\" === i ? t.push(\"<Null>\") : t.push(i);\n    }\n\n    return t.join(this._seperator);\n  }\n\n}\n\nasync function h(e, t) {\n  const s = e || 1;\n  if (\"number\" == typeof s) return (e, t, i) => s;\n  const a = await i(s, t.spatialReference, t.fields);\n  return (e, s, i) => r(a, e, {\n    $view: i\n  }, t.geometryType, s) || 1;\n}\n\nlet m;\n\nasync function f() {\n  return m || (m = import(\"../../../layers/features/createSymbolSchema.js\")), m;\n}\n\nclass p extends o {\n  constructor(e, t, i, r, a, n) {\n    super(), this.type = \"dictionary\", this._groupIdCache = new s(100), this._loader = e, this._fieldMap = e.fieldMap, this._symbolFields = e.getSymbolFields(), this._templates = t, this._info = i, this._scaleFn = r, this._schemaUtilsModule = a, this._symbolOptions = n;\n  }\n\n  static async fromDictionaryRenderer(e, t, s, i) {\n    const [{\n      DictionaryLoader: r\n    }, a] = await Promise.all([import(\"../../../../../renderers/support/DictionaryLoader.js\"), f()]),\n          n = new r(e.url, e.config, e.fieldMap);\n    await n.fetchResources({\n      spatialReference: s.spatialReference,\n      fields: s.fields\n    });\n    const l = await h(e.scaleExpression, s);\n    return new p(n, t, s, l, a, e.symbolOptions);\n  }\n\n  async _analyzeFeature(t, s, i, r, l) {\n    const o = t.readLegacyFeature(),\n          u = this._scaleFn(o, i, r),\n          c = this._attributeHash(o) + \"-\" + u,\n          d = this._groupIdCache.get(c);\n\n    if (d) return d;\n\n    const h = { ...r,\n      spatialReference: this._info.spatialReference,\n      abortOptions: l,\n      fields: this._info.fields\n    },\n          m = await this._loader.getSymbolAsync(o, h),\n          f = this._schemaUtilsModule.createSymbolSchema(m, this._symbolOptions),\n          p = a(f, this._info, s, l).then(t => {\n      if (\"expanded-cim\" !== t.type) return n.error(new e(\"mapview-bad-type\", `Found unexpected type ${t.type} in dictionary response`)), null;\n      t.hash += \"-\" + u;\n\n      for (const e of t.layers) e.scaleFactor = u, e.templateHash += \"-\" + u;\n\n      return this._templates.createTemplateGroup(t, null);\n    });\n\n    return this._groupIdCache.put(c, p, 1), p;\n  }\n\n  async analyze(e, t, s, i, r, a) {\n    const n = t.getCursor(),\n          l = [];\n\n    for (; n.next();) l.push(this._analyzeFeature(n, s, i, r, a));\n\n    return Promise.all(l);\n  }\n\n  match(e, t, s, i, r) {\n    return null;\n  }\n\n  _attributeHash(e) {\n    let t = \"\";\n\n    for (const s of this._symbolFields) {\n      const i = this._fieldMap[s];\n      i && (t += e.attributes[i] + \"-\");\n    }\n\n    return t;\n  }\n\n}\n\nexport { p as DictionaryMatcher, o as FeatureMatcher, c as IntervalMatcher, d as MapMatcher, u as SubtypeMatcher, l as createMatcher };","map":{"version":3,"sources":["D:/Github/CUSP_DataBase/CUSP_DB/src/main/gis/node_modules/@arcgis/core/views/2d/engine/webgl/util/Matcher.js"],"names":["e","t","s","createRendererExpression","i","r","expandSymbol","a","n","getLogger","l","type","o","fromBasicRenderer","d","fromUVRenderer","c","fromCBRenderer","p","fromDictionaryRenderer","u","fromSubtypes","constructor","_defaultResult","symbol","createTemplateGroup","setDefault","size","getDefault","match","analyze","_subMatchers","_subtypeField","Map","renderers","parseInt","then","set","push","Promise","all","subtypeField","readAttribute","get","_intervals","_isMaxInclusive","_fieldIndex","_field","_normalizationInfo","isMaxInclusive","normalizationField","normalizationTotal","normalizationType","field","fieldIndex","h","backgroundFillSymbol","intervals","map","min","max","add","m","defaultSymbol","interval","result","sort","length","getComputedNumericAtIndex","_getValueFromField","isNaN","_needsNormalization","Math","log","LOG10E","error","_nullResult","_resultsMap","_fieldsIndex","_fields","_seperator","fieldDelimiter","field2","field3","value","setNullResult","toString","getComputedStringAtIndex","_getValueFromFields","has","join","spatialReference","fields","$view","geometryType","f","_groupIdCache","_loader","_fieldMap","fieldMap","_symbolFields","getSymbolFields","_templates","_info","_scaleFn","_schemaUtilsModule","_symbolOptions","DictionaryLoader","url","config","fetchResources","scaleExpression","symbolOptions","_analyzeFeature","readLegacyFeature","_attributeHash","abortOptions","getSymbolAsync","createSymbolSchema","hash","layers","scaleFactor","templateHash","put","getCursor","next","attributes","DictionaryMatcher","FeatureMatcher","IntervalMatcher","MapMatcher","SubtypeMatcher","createMatcher"],"mappings":"AAAA;AACA;AACA;AACA;AACA,OAAOA,CAAP,MAAa,8BAAb;AAA4C,OAAOC,CAAP,MAAa,+BAAb;AAA6C,OAAOC,CAAP,MAAa,iCAAb;AAA+C,SAAOC,wBAAwB,IAAIC,CAAnC,QAAyC,0CAAzC;AAAoF,OAAOC,CAAP,MAAa,8CAAb;AAA4D,SAAOC,YAAY,IAAIC,CAAvB,QAA6B,2CAA7B;AAAyE,MAAMC,CAAC,GAACP,CAAC,CAACQ,SAAF,CAAY,yCAAZ,CAAR;;AAA+D,eAAeC,CAAf,CAAiBV,CAAjB,EAAmBC,CAAnB,EAAqBC,CAArB,EAAuBE,CAAvB,EAAyB;AAAC,UAAOJ,CAAC,CAACW,IAAT;AAAe,SAAI,QAAJ;AAAa,aAAOC,CAAC,CAACC,iBAAF,CAAoBb,CAApB,EAAsBC,CAAtB,EAAwBC,CAAxB,EAA0BE,CAA1B,CAAP;;AAAoC,SAAI,KAAJ;AAAU,aAAOU,CAAC,CAACC,cAAF,CAAiBf,CAAjB,EAAmBC,CAAnB,EAAqBC,CAArB,EAAuBE,CAAvB,CAAP;;AAAiC,SAAI,UAAJ;AAAe,aAAOY,CAAC,CAACC,cAAF,CAAiBjB,CAAjB,EAAmBC,CAAnB,EAAqBC,CAArB,EAAuBE,CAAvB,CAAP;;AAAiC,SAAI,YAAJ;AAAiB,aAAOc,CAAC,CAACC,sBAAF,CAAyBnB,CAAzB,EAA2BC,CAA3B,EAA6BC,CAA7B,EAA+BE,CAA/B,CAAP;;AAAyC,SAAI,SAAJ;AAAc,aAAOgB,CAAC,CAACC,YAAF,CAAerB,CAAf,EAAiBC,CAAjB,EAAmBC,CAAnB,EAAqBE,CAArB,CAAP;AAAnO;AAAmQ;;AAAA,MAAMQ,CAAN,CAAO;AAACU,EAAAA,WAAW,GAAE;AAAC,SAAKX,IAAL,GAAU,SAAV,EAAoB,KAAKY,cAAL,GAAoB,IAAxC;AAA6C;;AAA8B,eAAjBV,iBAAiB,CAACb,CAAD,EAAGC,CAAH,EAAKC,CAAL,EAAOE,CAAP,EAAS;AAAC,UAAMC,CAAC,GAAC,IAAIO,CAAJ,EAAR;;AAAc,QAAGZ,CAAC,CAACwB,MAAL,EAAY;AAAC,YAAMhB,CAAC,GAAC,MAAMD,CAAC,CAACP,CAAC,CAACwB,MAAH,EAAUtB,CAAV,EAAYE,CAAZ,CAAf;AAAA,YAA8BM,CAAC,GAACT,CAAC,CAACwB,mBAAF,CAAsBjB,CAAtB,EAAwB,IAAxB,CAAhC;AAA8DH,MAAAA,CAAC,CAACqB,UAAF,CAAahB,CAAb;AAAgB;;AAAA,WAAOL,CAAP;AAAS;;AAAAsB,EAAAA,IAAI,GAAE;AAAC,WAAO,CAAP;AAAS;;AAAAC,EAAAA,UAAU,GAAE;AAAC,WAAO,KAAKL,cAAZ;AAA2B;;AAAAG,EAAAA,UAAU,CAAC1B,CAAD,EAAG;AAAC,SAAKuB,cAAL,GAAoBvB,CAApB;AAAsB;;AAAA6B,EAAAA,KAAK,CAAC7B,CAAD,EAAGC,CAAH,EAAKC,CAAL,EAAOE,CAAP,EAASC,CAAT,EAAW;AAAC,WAAO,KAAKuB,UAAL,EAAP;AAAyB;;AAAa,QAAPE,OAAO,CAAC9B,CAAD,EAAGC,CAAH,EAAKC,CAAL,EAAOE,CAAP,EAASC,CAAT,EAAWE,CAAX,EAAa;AAAC,WAAO,IAAP;AAAY;;AAAnY;;AAAoY,MAAMa,CAAN,SAAgBR,CAAhB,CAAiB;AAACU,EAAAA,WAAW,CAACtB,CAAD,EAAGC,CAAH,EAAK;AAAC,aAAQ,KAAK8B,YAAL,GAAkB/B,CAA1B,EAA4B,KAAKgC,aAAL,GAAmB/B,CAA/C;AAAiD;;AAAyB,eAAZoB,YAAY,CAACrB,CAAD,EAAGC,CAAH,EAAKC,CAAL,EAAOE,CAAP,EAAS;AAAC,UAAMC,CAAC,GAAC,IAAI4B,GAAJ,EAAR;AAAA,UAAgB1B,CAAC,GAAC,EAAlB;;AAAqB,SAAI,MAAMC,CAAV,IAAeR,CAAC,CAACkC,SAAjB,EAA2B;AAAC,YAAMtB,CAAC,GAACuB,QAAQ,CAAC3B,CAAD,EAAG,EAAH,CAAhB;AAAA,YAAuBY,CAAC,GAACV,CAAC,CAACV,CAAC,CAACkC,SAAF,CAAY1B,CAAZ,CAAD,EAAgBP,CAAhB,EAAkBC,CAAlB,EAAoBE,CAApB,CAAD,CAAwBgC,IAAxB,CAA8BpC,CAAC,IAAEK,CAAC,CAACgC,GAAF,CAAMzB,CAAN,EAAQZ,CAAR,CAAjC,CAAzB;AAAuEO,MAAAA,CAAC,CAAC+B,IAAF,CAAOlB,CAAP;AAAU;;AAAA,WAAO,MAAMmB,OAAO,CAACC,GAAR,CAAYjC,CAAZ,CAAN,EAAqB,IAAIa,CAAJ,CAAMf,CAAN,EAAQL,CAAC,CAACyC,YAAV,CAA5B;AAAoD;;AAAAZ,EAAAA,KAAK,CAAC7B,CAAD,EAAGC,CAAH,EAAKC,CAAL,EAAOE,CAAP,EAASC,CAAT,EAAW;AAAC,UAAME,CAAC,GAACN,CAAC,CAACyC,aAAF,CAAgB,KAAKV,aAArB,CAAR;AAAA,UAA4CxB,CAAC,GAAC,KAAKuB,YAAL,CAAkBY,GAAlB,CAAsBpC,CAAtB,CAA9C;;AAAuE,WAAOC,CAAC,GAACA,CAAC,CAACqB,KAAF,CAAQ7B,CAAR,EAAUC,CAAV,EAAYC,CAAZ,EAAcE,CAAd,EAAgBC,CAAhB,CAAD,GAAoB,IAA5B;AAAiC;;AAArZ;;AAAsZ,MAAMW,CAAN,SAAgBJ,CAAhB,CAAiB;AAACU,EAAAA,WAAW,CAACtB,CAAD,EAAGC,CAAH,EAAKC,CAAL,EAAOE,CAAP,EAAS;AAAC,aAAQ,KAAKO,IAAL,GAAU,UAAlB,EAA6B,KAAKiC,UAAL,GAAgB,EAA7C,EAAgD,KAAKC,eAAL,GAAqB5C,CAArE,EAAuE,KAAK6C,WAAL,GAAiB1C,CAAxF,EAA0F,KAAK2C,MAAL,GAAY/C,CAAtG,EAAwG,KAAKgD,kBAAL,GAAwB9C,CAAhI;AAAkI;;AAA2B,eAAde,cAAc,CAACjB,CAAD,EAAGC,CAAH,EAAKC,CAAL,EAAOE,CAAP,EAAS;AAAC,UAAK;AAAC6C,MAAAA,cAAc,EAAC5C,CAAhB;AAAkB6C,MAAAA,kBAAkB,EAAC1C,CAArC;AAAuC2C,MAAAA,kBAAkB,EAACzC,CAA1D;AAA4D0C,MAAAA,iBAAiB,EAACxC;AAA9E,QAAiFZ,CAAtF;AAAA,UAAwFoB,CAAC,GAACpB,CAAC,CAACqD,KAA5F;AAAA,UAAkGvC,CAAC,GAAC,IAAIE,CAAJ,CAAMI,CAAN,EAAQf,CAAR,EAAU;AAAC6C,MAAAA,kBAAkB,EAAC1C,CAApB;AAAsB2C,MAAAA,kBAAkB,EAACzC,CAAzC;AAA2C0C,MAAAA,iBAAiB,EAACxC;AAA7D,KAAV,EAA0EZ,CAAC,CAACsD,UAA5E,CAApG;AAAA,UAA4LC,CAAC,GAAC,MAAMhD,CAAC,CAACP,CAAC,CAACwD,oBAAH,EAAwBtD,CAAxB,EAA0BE,CAA1B,CAArM;AAAkO,UAAMmC,OAAO,CAACC,GAAR,CAAYxC,CAAC,CAACyD,SAAF,CAAYC,GAAZ,CAAiB,MAAM1D,CAAN,IAAS;AAAC,YAAMK,CAAC,GAAC,MAAME,CAAC,CAACP,CAAC,CAACwB,MAAH,EAAUtB,CAAV,EAAYE,CAAZ,CAAf;AAAA,YAA8BI,CAAC,GAAC,MAAMP,CAAC,CAACwB,mBAAF,CAAsBpB,CAAtB,EAAwBkD,CAAxB,CAAtC;AAAA,YAAiE7C,CAAC,GAAC;AAACiD,QAAAA,GAAG,EAAC3D,CAAC,CAAC2D,GAAP;AAAWC,QAAAA,GAAG,EAAC5D,CAAC,CAAC4D;AAAjB,OAAnE;AAAyF9C,MAAAA,CAAC,CAAC+C,GAAF,CAAMnD,CAAN,EAAQF,CAAR;AAAW,KAA/H,CAAZ,CAAN;AAAqJ,UAAMsD,CAAC,GAAC,MAAMvD,CAAC,CAACP,CAAC,CAAC+D,aAAH,EAAiB7D,CAAjB,EAAmBE,CAAnB,CAAf;;AAAqC,QAAG0D,CAAH,EAAK;AAAC,YAAM9D,CAAC,GAAC,MAAMC,CAAC,CAACwB,mBAAF,CAAsBqC,CAAtB,EAAwBP,CAAxB,CAAd;AAAyCzC,MAAAA,CAAC,CAACY,UAAF,CAAa1B,CAAb;AAAgB;;AAAA,WAAOc,CAAP;AAAS;;AAAA+C,EAAAA,GAAG,CAAC7D,CAAD,EAAGC,CAAH,EAAK;AAAC,SAAK2C,UAAL,CAAgBN,IAAhB,CAAqB;AAAC0B,MAAAA,QAAQ,EAAChE,CAAV;AAAYiE,MAAAA,MAAM,EAAChE;AAAnB,KAArB,GAA4C,KAAK2C,UAAL,CAAgBsB,IAAhB,CAAsB,CAAClE,CAAD,EAAGC,CAAH,KAAOD,CAAC,CAACgE,QAAF,CAAWL,GAAX,GAAe1D,CAAC,CAAC+D,QAAF,CAAWL,GAAvD,CAA5C;AAAyG;;AAAAhC,EAAAA,IAAI,GAAE;AAAC,WAAO,MAAMA,IAAN,KAAa,KAAKiB,UAAL,CAAgBuB,MAApC;AAA2C;;AAAAtC,EAAAA,KAAK,CAAC7B,CAAD,EAAGC,CAAH,EAAKC,CAAL,EAAOE,CAAP,EAASC,CAAT,EAAW;AAAC,QAAG,QAAM,KAAKyC,WAAX,IAAwB,CAAC,KAAKC,MAAjC,EAAwC,OAAO,KAAKnB,UAAL,EAAP;AAAyB,UAAMrB,CAAC,GAAC,QAAM,KAAKuC,WAAX,GAAuB7C,CAAC,CAACmE,yBAAF,CAA4B,KAAKtB,WAAjC,CAAvB,GAAqE,KAAKuB,kBAAL,CAAwBpE,CAAxB,CAA7E;AAAwG,QAAG,CAACM,CAAD,KAAK,QAAMA,CAAN,IAAS+D,KAAK,CAAC/D,CAAD,CAAnB,CAAH,EAA2B,OAAO,KAAKqB,UAAL,EAAP;;AAAyB,SAAI,IAAIpB,CAAC,GAAC,CAAV,EAAYA,CAAC,GAAC,KAAKoC,UAAL,CAAgBuB,MAA9B,EAAqC3D,CAAC,EAAtC,EAAyC;AAAC,YAAK;AAACwD,QAAAA,QAAQ,EAAChE,CAAV;AAAYiE,QAAAA,MAAM,EAAChE;AAAnB,UAAsB,KAAK2C,UAAL,CAAgBpC,CAAhB,CAA3B;AAAA,YAA8CN,CAAC,GAACK,CAAC,IAAEP,CAAC,CAAC2D,GAArD;AAAA,YAAyDvD,CAAC,GAAC,KAAKyC,eAAL,GAAqBtC,CAAC,IAAEP,CAAC,CAAC4D,GAA1B,GAA8BrD,CAAC,GAACP,CAAC,CAAC4D,GAA7F;AAAiG,UAAG1D,CAAC,IAAEE,CAAN,EAAQ,OAAOH,CAAP;AAAS;;AAAA,WAAO,KAAK2B,UAAL,EAAP;AAAyB;;AAAA2C,EAAAA,mBAAmB,GAAE;AAAC,UAAMvE,CAAC,GAAC,KAAKgD,kBAAb;AAAgC,WAAOhD,CAAC,KAAGA,CAAC,CAACkD,kBAAF,IAAsBlD,CAAC,CAACmD,kBAAxB,IAA4CnD,CAAC,CAACoD,iBAAjD,CAAR;AAA4E;;AAAAiB,EAAAA,kBAAkB,CAACrE,CAAD,EAAG;AAAC,UAAMC,CAAC,GAACD,CAAC,CAAC0C,aAAF,CAAgB,KAAKK,MAArB,CAAR;AAAqC,QAAG,CAAC,KAAKwB,mBAAL,EAAD,IAA6B,QAAMtE,CAAtC,EAAwC,OAAOA,CAAP;AAAS,UAAK;AAACiD,MAAAA,kBAAkB,EAAChD,CAApB;AAAsBiD,MAAAA,kBAAkB,EAAC/C,CAAzC;AAA2CgD,MAAAA,iBAAiB,EAAC/C;AAA7D,QAAgE,KAAK2C,kBAA1E;AAAA,UAA6FzC,CAAC,GAAC,CAAC,CAACL,CAAF,IAAKF,CAAC,CAAC0C,aAAF,CAAgBxC,CAAhB,CAApG;AAAuH,QAAGG,CAAH,EAAK,QAAOA,CAAP;AAAU,WAAI,sBAAJ;AAA2B,eAAOE,CAAC,GAACN,CAAC,GAACM,CAAH,GAAK,KAAK,CAAlB;;AAAoB,WAAI,oBAAJ;AAAyB,eAAOiE,IAAI,CAACC,GAAL,CAASxE,CAAT,IAAYuE,IAAI,CAACE,MAAxB;;AAA+B,WAAI,+BAAJ;AAAoC,eAAOzE,CAAC,GAACG,CAAF,GAAI,GAAX;;AAAe;AAAQ,eAAO,KAAKI,CAAC,CAACmE,KAAF,CAAS,qCAAoCtE,CAAE,EAA/C,CAAZ;AAA5K,KAAL,MAAoPG,CAAC,CAACmE,KAAF,CAAQ,iDAAR;AAA2D;;AAA53D;;AAA63D,MAAM7D,CAAN,SAAgBF,CAAhB,CAAiB;AAACU,EAAAA,WAAW,CAACtB,CAAD,EAAGC,CAAH,EAAKC,CAAL,EAAO;AAAC,aAAQ,KAAKS,IAAL,GAAU,KAAlB,EAAwB,KAAKiE,WAAL,GAAiB,IAAzC,EAA8C,KAAKC,WAAL,GAAiB,IAAI5C,GAAJ,EAA/D,EAAuE,KAAK6C,YAAL,GAAkB5E,CAAzF,EAA2F,KAAK6E,OAAL,GAAa/E,CAAxG,EAA0G,KAAKgF,UAAL,GAAgB/E,CAAC,IAAE,EAA7H;AAAgI;;AAA2B,eAAdc,cAAc,CAACf,CAAD,EAAGC,CAAH,EAAKC,CAAL,EAAOE,CAAP,EAAS;AAAC,UAAMC,CAAC,GAACL,CAAC,CAACiF,cAAV;AAAA,UAAyBzE,CAAC,GAAC,CAACR,CAAC,CAACqD,KAAH,CAA3B;AAAqCrD,IAAAA,CAAC,CAACkF,MAAF,IAAU1E,CAAC,CAAC8B,IAAF,CAAOtC,CAAC,CAACkF,MAAT,CAAV,EAA2BlF,CAAC,CAACmF,MAAF,IAAU3E,CAAC,CAAC8B,IAAF,CAAOtC,CAAC,CAACmF,MAAT,CAArC;AAAsD,UAAMzE,CAAC,GAAC,MAAMH,CAAC,CAACP,CAAC,CAACwD,oBAAH,EAAwBtD,CAAxB,EAA0BE,CAA1B,CAAf;AAAA,UAA4CQ,CAAC,GAAC,IAAIE,CAAJ,CAAMN,CAAN,EAAQH,CAAR,EAAUL,CAAC,CAACsD,UAAZ,CAA9C;AAAsE,UAAMf,OAAO,CAACC,GAAR,CAAYxC,CAAC,CAAC0D,GAAF,CAAMA,GAAN,CAAW,MAAM1D,CAAN,IAAS;AAAC,YAAMK,CAAC,GAAC,MAAME,CAAC,CAACP,CAAC,CAACwB,MAAH,EAAUtB,CAAV,EAAYE,CAAZ,CAAf;AAAA,YAA8BI,CAAC,GAAC,MAAMP,CAAC,CAACwB,mBAAF,CAAsBpB,CAAtB,EAAwBK,CAAxB,CAAtC;AAAiE,mBAAWV,CAAC,CAACoF,KAAb,GAAmBxE,CAAC,CAACyE,aAAF,CAAgB7E,CAAhB,CAAnB,GAAsCI,CAAC,CAACiD,GAAF,CAAM7D,CAAC,CAACoF,KAAR,EAAc5E,CAAd,CAAtC;AAAuD,KAA7I,CAAZ,CAAN;AAAmK,UAAMY,CAAC,GAAC,MAAMb,CAAC,CAACP,CAAC,CAAC+D,aAAH,EAAiB7D,CAAjB,EAAmBE,CAAnB,CAAf;;AAAqC,QAAGgB,CAAH,EAAK;AAAC,YAAMpB,CAAC,GAAC,MAAMC,CAAC,CAACwB,mBAAF,CAAsBL,CAAtB,EAAwBV,CAAxB,CAAd;AAAyCE,MAAAA,CAAC,CAACc,UAAF,CAAa1B,CAAb;AAAgB;;AAAA,WAAOY,CAAP;AAAS;;AAAAyE,EAAAA,aAAa,CAACrF,CAAD,EAAG;AAAC,SAAK4E,WAAL,GAAiB5E,CAAjB;AAAmB;;AAAA6D,EAAAA,GAAG,CAAC7D,CAAD,EAAGC,CAAH,EAAK;AAAC,SAAK4E,WAAL,CAAiBxC,GAAjB,CAAqBrC,CAAC,CAACsF,QAAF,EAArB,EAAkCrF,CAAlC;AAAqC;;AAAA0B,EAAAA,IAAI,GAAE;AAAC,WAAO,MAAMA,IAAN,KAAa,KAAKkD,WAAL,CAAiBlD,IAArC;AAA0C;;AAAAE,EAAAA,KAAK,CAAC7B,CAAD,EAAGC,CAAH,EAAKC,CAAL,EAAOE,CAAP,EAASC,CAAT,EAAW;AAAC,QAAG,QAAM,KAAKyE,YAAX,IAAyB,CAAC,KAAKC,OAAlC,EAA0C,OAAO,KAAKnD,UAAL,EAAP;AAAyB,UAAMrB,CAAC,GAAC,QAAM,KAAKuE,YAAX,GAAwB7E,CAAC,CAACsF,wBAAF,CAA2B,KAAKT,YAAhC,CAAxB,GAAsE,KAAKU,mBAAL,CAAyBvF,CAAzB,CAA9E;AAA0G,QAAG,SAAO,KAAK2E,WAAZ,KAA0B,QAAMrE,CAAN,IAAS,OAAKA,CAAd,IAAiB,aAAWA,CAAtD,CAAH,EAA4D,OAAO,KAAKqE,WAAZ;AAAwB,QAAG,CAACrE,CAAD,IAAI,QAAMA,CAAb,EAAe,OAAO,KAAKqB,UAAL,EAAP;AAAyB,UAAMpB,CAAC,GAACD,CAAC,CAAC+E,QAAF,EAAR;AAAqB,WAAO,KAAKT,WAAL,CAAiBY,GAAjB,CAAqBjF,CAArB,IAAwB,KAAKqE,WAAL,CAAiBlC,GAAjB,CAAqBnC,CAArB,CAAxB,GAAgD,KAAKoB,UAAL,EAAvD;AAAyE;;AAAA4D,EAAAA,mBAAmB,CAACxF,CAAD,EAAG;AAAC,UAAMC,CAAC,GAAC,EAAR;;AAAW,SAAI,MAAMC,CAAV,IAAe,KAAK6E,OAApB,EAA4B;AAAC,YAAM3E,CAAC,GAACJ,CAAC,CAAC0C,aAAF,CAAgBxC,CAAhB,CAAR;AAA2B,cAAME,CAAN,IAAS,OAAKA,CAAd,GAAgBH,CAAC,CAACqC,IAAF,CAAO,QAAP,CAAhB,GAAiCrC,CAAC,CAACqC,IAAF,CAAOlC,CAAP,CAAjC;AAA2C;;AAAA,WAAOH,CAAC,CAACyF,IAAF,CAAO,KAAKV,UAAZ,CAAP;AAA+B;;AAAzyC;;AAA0yC,eAAezB,CAAf,CAAiBvD,CAAjB,EAAmBC,CAAnB,EAAqB;AAAC,QAAMC,CAAC,GAACF,CAAC,IAAE,CAAX;AAAa,MAAG,YAAU,OAAOE,CAApB,EAAsB,OAAM,CAACF,CAAD,EAAGC,CAAH,EAAKG,CAAL,KAASF,CAAf;AAAiB,QAAMK,CAAC,GAAC,MAAMH,CAAC,CAACF,CAAD,EAAGD,CAAC,CAAC0F,gBAAL,EAAsB1F,CAAC,CAAC2F,MAAxB,CAAf;AAA+C,SAAM,CAAC5F,CAAD,EAAGE,CAAH,EAAKE,CAAL,KAASC,CAAC,CAACE,CAAD,EAAGP,CAAH,EAAK;AAAC6F,IAAAA,KAAK,EAACzF;AAAP,GAAL,EAAeH,CAAC,CAAC6F,YAAjB,EAA8B5F,CAA9B,CAAD,IAAmC,CAAlD;AAAoD;;AAAA,IAAI4D,CAAJ;;AAAM,eAAeiC,CAAf,GAAkB;AAAC,SAAOjC,CAAC,KAAGA,CAAC,GAAC,OAAO,gDAAP,CAAL,CAAD,EAAgEA,CAAvE;AAAyE;;AAAA,MAAM5C,CAAN,SAAgBN,CAAhB,CAAiB;AAACU,EAAAA,WAAW,CAACtB,CAAD,EAAGC,CAAH,EAAKG,CAAL,EAAOC,CAAP,EAASE,CAAT,EAAWC,CAAX,EAAa;AAAC,aAAQ,KAAKG,IAAL,GAAU,YAAlB,EAA+B,KAAKqF,aAAL,GAAmB,IAAI9F,CAAJ,CAAM,GAAN,CAAlD,EAA6D,KAAK+F,OAAL,GAAajG,CAA1E,EAA4E,KAAKkG,SAAL,GAAelG,CAAC,CAACmG,QAA7F,EAAsG,KAAKC,aAAL,GAAmBpG,CAAC,CAACqG,eAAF,EAAzH,EAA6I,KAAKC,UAAL,GAAgBrG,CAA7J,EAA+J,KAAKsG,KAAL,GAAWnG,CAA1K,EAA4K,KAAKoG,QAAL,GAAcnG,CAA1L,EAA4L,KAAKoG,kBAAL,GAAwBlG,CAApN,EAAsN,KAAKmG,cAAL,GAAoBlG,CAA1O;AAA4O;;AAAmC,eAAtBW,sBAAsB,CAACnB,CAAD,EAAGC,CAAH,EAAKC,CAAL,EAAOE,CAAP,EAAS;AAAC,UAAK,CAAC;AAACuG,MAAAA,gBAAgB,EAACtG;AAAlB,KAAD,EAAsBE,CAAtB,IAAyB,MAAMgC,OAAO,CAACC,GAAR,CAAY,CAAC,OAAO,sDAAP,CAAD,EAAgEuD,CAAC,EAAjE,CAAZ,CAApC;AAAA,UAAsHvF,CAAC,GAAC,IAAIH,CAAJ,CAAML,CAAC,CAAC4G,GAAR,EAAY5G,CAAC,CAAC6G,MAAd,EAAqB7G,CAAC,CAACmG,QAAvB,CAAxH;AAAyJ,UAAM3F,CAAC,CAACsG,cAAF,CAAiB;AAACnB,MAAAA,gBAAgB,EAACzF,CAAC,CAACyF,gBAApB;AAAqCC,MAAAA,MAAM,EAAC1F,CAAC,CAAC0F;AAA9C,KAAjB,CAAN;AAA8E,UAAMlF,CAAC,GAAC,MAAM6C,CAAC,CAACvD,CAAC,CAAC+G,eAAH,EAAmB7G,CAAnB,CAAf;AAAqC,WAAO,IAAIgB,CAAJ,CAAMV,CAAN,EAAQP,CAAR,EAAUC,CAAV,EAAYQ,CAAZ,EAAcH,CAAd,EAAgBP,CAAC,CAACgH,aAAlB,CAAP;AAAwC;;AAAqB,QAAfC,eAAe,CAAChH,CAAD,EAAGC,CAAH,EAAKE,CAAL,EAAOC,CAAP,EAASK,CAAT,EAAW;AAAC,UAAME,CAAC,GAACX,CAAC,CAACiH,iBAAF,EAAR;AAAA,UAA8B9F,CAAC,GAAC,KAAKoF,QAAL,CAAc5F,CAAd,EAAgBR,CAAhB,EAAkBC,CAAlB,CAAhC;AAAA,UAAqDW,CAAC,GAAC,KAAKmG,cAAL,CAAoBvG,CAApB,IAAuB,GAAvB,GAA2BQ,CAAlF;AAAA,UAAoFN,CAAC,GAAC,KAAKkF,aAAL,CAAmBrD,GAAnB,CAAuB3B,CAAvB,CAAtF;;AAAgH,QAAGF,CAAH,EAAK,OAAOA,CAAP;;AAAS,UAAMyC,CAAC,GAAC,EAAC,GAAGlD,CAAJ;AAAMsF,MAAAA,gBAAgB,EAAC,KAAKY,KAAL,CAAWZ,gBAAlC;AAAmDyB,MAAAA,YAAY,EAAC1G,CAAhE;AAAkEkF,MAAAA,MAAM,EAAC,KAAKW,KAAL,CAAWX;AAApF,KAAR;AAAA,UAAoG9B,CAAC,GAAC,MAAM,KAAKmC,OAAL,CAAaoB,cAAb,CAA4BzG,CAA5B,EAA8B2C,CAA9B,CAA5G;AAAA,UAA6IwC,CAAC,GAAC,KAAKU,kBAAL,CAAwBa,kBAAxB,CAA2CxD,CAA3C,EAA6C,KAAK4C,cAAlD,CAA/I;AAAA,UAAiNxF,CAAC,GAACX,CAAC,CAACwF,CAAD,EAAG,KAAKQ,KAAR,EAAcrG,CAAd,EAAgBQ,CAAhB,CAAD,CAAoB0B,IAApB,CAA0BnC,CAAC,IAAE;AAAC,UAAG,mBAAiBA,CAAC,CAACU,IAAtB,EAA2B,OAAOH,CAAC,CAACmE,KAAF,CAAQ,IAAI3E,CAAJ,CAAM,kBAAN,EAA0B,yBAAwBC,CAAC,CAACU,IAAK,yBAAzD,CAAR,GAA4F,IAAnG;AAAwGV,MAAAA,CAAC,CAACsH,IAAF,IAAQ,MAAInG,CAAZ;;AAAc,WAAI,MAAMpB,CAAV,IAAeC,CAAC,CAACuH,MAAjB,EAAwBxH,CAAC,CAACyH,WAAF,GAAcrG,CAAd,EAAgBpB,CAAC,CAAC0H,YAAF,IAAgB,MAAItG,CAApC;;AAAsC,aAAO,KAAKkF,UAAL,CAAgB7E,mBAAhB,CAAoCxB,CAApC,EAAsC,IAAtC,CAAP;AAAmD,KAAhS,CAAnN;;AAAsf,WAAO,KAAK+F,aAAL,CAAmB2B,GAAnB,CAAuB3G,CAAvB,EAAyBE,CAAzB,EAA2B,CAA3B,GAA8BA,CAArC;AAAuC;;AAAa,QAAPY,OAAO,CAAC9B,CAAD,EAAGC,CAAH,EAAKC,CAAL,EAAOE,CAAP,EAASC,CAAT,EAAWE,CAAX,EAAa;AAAC,UAAMC,CAAC,GAACP,CAAC,CAAC2H,SAAF,EAAR;AAAA,UAAsBlH,CAAC,GAAC,EAAxB;;AAA2B,WAAKF,CAAC,CAACqH,IAAF,EAAL,GAAenH,CAAC,CAAC4B,IAAF,CAAO,KAAK2E,eAAL,CAAqBzG,CAArB,EAAuBN,CAAvB,EAAyBE,CAAzB,EAA2BC,CAA3B,EAA6BE,CAA7B,CAAP;;AAAwC,WAAOgC,OAAO,CAACC,GAAR,CAAY9B,CAAZ,CAAP;AAAsB;;AAAAmB,EAAAA,KAAK,CAAC7B,CAAD,EAAGC,CAAH,EAAKC,CAAL,EAAOE,CAAP,EAASC,CAAT,EAAW;AAAC,WAAO,IAAP;AAAY;;AAAA8G,EAAAA,cAAc,CAACnH,CAAD,EAAG;AAAC,QAAIC,CAAC,GAAC,EAAN;;AAAS,SAAI,MAAMC,CAAV,IAAe,KAAKkG,aAApB,EAAkC;AAAC,YAAMhG,CAAC,GAAC,KAAK8F,SAAL,CAAehG,CAAf,CAAR;AAA0BE,MAAAA,CAAC,KAAGH,CAAC,IAAED,CAAC,CAAC8H,UAAF,CAAa1H,CAAb,IAAgB,GAAtB,CAAD;AAA4B;;AAAA,WAAOH,CAAP;AAAS;;AAAhkD;;AAAikD,SAAOiB,CAAC,IAAI6G,iBAAZ,EAA8BnH,CAAC,IAAIoH,cAAnC,EAAkDhH,CAAC,IAAIiH,eAAvD,EAAuEnH,CAAC,IAAIoH,UAA5E,EAAuF9G,CAAC,IAAI+G,cAA5F,EAA2GzH,CAAC,IAAI0H,aAAhH","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport e from\"../../../../../core/Error.js\";import t from\"../../../../../core/Logger.js\";import s from\"../../../../../core/LRUCache.js\";import{createRendererExpression as i}from\"../../../../../support/arcadeOnDemand.js\";import r from\"../../../arcade/callExpressionWithFeature.js\";import{expandSymbol as a}from\"../../../layers/support/cimSymbolUtils.js\";const n=t.getLogger(\"esri/views/2d/engine/webgl/util/Matcher\");async function l(e,t,s,i){switch(e.type){case\"simple\":return o.fromBasicRenderer(e,t,s,i);case\"map\":return d.fromUVRenderer(e,t,s,i);case\"interval\":return c.fromCBRenderer(e,t,s,i);case\"dictionary\":return p.fromDictionaryRenderer(e,t,s,i);case\"subtype\":return u.fromSubtypes(e,t,s,i)}}class o{constructor(){this.type=\"feature\",this._defaultResult=null}static async fromBasicRenderer(e,t,s,i){const r=new o;if(e.symbol){const n=await a(e.symbol,s,i),l=t.createTemplateGroup(n,null);r.setDefault(l)}return r}size(){return 1}getDefault(){return this._defaultResult}setDefault(e){this._defaultResult=e}match(e,t,s,i,r){return this.getDefault()}async analyze(e,t,s,i,r,a){return null}}class u extends o{constructor(e,t){super(),this._subMatchers=e,this._subtypeField=t}static async fromSubtypes(e,t,s,i){const r=new Map,a=[];for(const n in e.renderers){const o=parseInt(n,10),u=l(e.renderers[n],t,s,i).then((e=>r.set(o,e)));a.push(u)}return await Promise.all(a),new u(r,e.subtypeField)}match(e,t,s,i,r){const a=t.readAttribute(this._subtypeField),n=this._subMatchers.get(a);return n?n.match(e,t,s,i,r):null}}class c extends o{constructor(e,t,s,i){super(),this.type=\"interval\",this._intervals=[],this._isMaxInclusive=t,this._fieldIndex=i,this._field=e,this._normalizationInfo=s}static async fromCBRenderer(e,t,s,i){const{isMaxInclusive:r,normalizationField:n,normalizationTotal:l,normalizationType:o}=e,u=e.field,d=new c(u,r,{normalizationField:n,normalizationTotal:l,normalizationType:o},e.fieldIndex),h=await a(e.backgroundFillSymbol,s,i);await Promise.all(e.intervals.map((async e=>{const r=await a(e.symbol,s,i),n=await t.createTemplateGroup(r,h),l={min:e.min,max:e.max};d.add(l,n)})));const m=await a(e.defaultSymbol,s,i);if(m){const e=await t.createTemplateGroup(m,h);d.setDefault(e)}return d}add(e,t){this._intervals.push({interval:e,result:t}),this._intervals.sort(((e,t)=>e.interval.min-t.interval.min))}size(){return super.size()+this._intervals.length}match(e,t,s,i,r){if(null==this._fieldIndex&&!this._field)return this.getDefault();const a=null!=this._fieldIndex?t.getComputedNumericAtIndex(this._fieldIndex):this._getValueFromField(t);if(!a&&(null==a||isNaN(a)))return this.getDefault();for(let n=0;n<this._intervals.length;n++){const{interval:e,result:t}=this._intervals[n],s=a>=e.min,i=this._isMaxInclusive?a<=e.max:a<e.max;if(s&&i)return t}return this.getDefault()}_needsNormalization(){const e=this._normalizationInfo;return e&&(e.normalizationField||e.normalizationTotal||e.normalizationType)}_getValueFromField(e){const t=e.readAttribute(this._field);if(!this._needsNormalization()||null==t)return t;const{normalizationField:s,normalizationTotal:i,normalizationType:r}=this._normalizationInfo,a=!!s&&e.readAttribute(s);if(r)switch(r){case\"esriNormalizeByField\":return a?t/a:void 0;case\"esriNormalizeByLog\":return Math.log(t)*Math.LOG10E;case\"esriNormalizeByPercentOfTotal\":return t/i*100;default:return void n.error(`Found unknown normalization type: ${r}`)}else n.error(\"Normalization is required, but no type was set!\")}}class d extends o{constructor(e,t,s){super(),this.type=\"map\",this._nullResult=null,this._resultsMap=new Map,this._fieldsIndex=s,this._fields=e,this._seperator=t||\"\"}static async fromUVRenderer(e,t,s,i){const r=e.fieldDelimiter,n=[e.field];e.field2&&n.push(e.field2),e.field3&&n.push(e.field3);const l=await a(e.backgroundFillSymbol,s,i),o=new d(n,r,e.fieldIndex);await Promise.all(e.map.map((async e=>{const r=await a(e.symbol,s,i),n=await t.createTemplateGroup(r,l);\"<Null>\"===e.value?o.setNullResult(n):o.add(e.value,n)})));const u=await a(e.defaultSymbol,s,i);if(u){const e=await t.createTemplateGroup(u,l);o.setDefault(e)}return o}setNullResult(e){this._nullResult=e}add(e,t){this._resultsMap.set(e.toString(),t)}size(){return super.size()+this._resultsMap.size}match(e,t,s,i,r){if(null==this._fieldsIndex&&!this._fields)return this.getDefault();const a=null!=this._fieldsIndex?t.getComputedStringAtIndex(this._fieldsIndex):this._getValueFromFields(t);if(null!==this._nullResult&&(null==a||\"\"===a||\"<Null>\"===a))return this._nullResult;if(!a&&null==a)return this.getDefault();const n=a.toString();return this._resultsMap.has(n)?this._resultsMap.get(n):this.getDefault()}_getValueFromFields(e){const t=[];for(const s of this._fields){const i=e.readAttribute(s);null==i||\"\"===i?t.push(\"<Null>\"):t.push(i)}return t.join(this._seperator)}}async function h(e,t){const s=e||1;if(\"number\"==typeof s)return(e,t,i)=>s;const a=await i(s,t.spatialReference,t.fields);return(e,s,i)=>r(a,e,{$view:i},t.geometryType,s)||1}let m;async function f(){return m||(m=import(\"../../../layers/features/createSymbolSchema.js\")),m}class p extends o{constructor(e,t,i,r,a,n){super(),this.type=\"dictionary\",this._groupIdCache=new s(100),this._loader=e,this._fieldMap=e.fieldMap,this._symbolFields=e.getSymbolFields(),this._templates=t,this._info=i,this._scaleFn=r,this._schemaUtilsModule=a,this._symbolOptions=n}static async fromDictionaryRenderer(e,t,s,i){const[{DictionaryLoader:r},a]=await Promise.all([import(\"../../../../../renderers/support/DictionaryLoader.js\"),f()]),n=new r(e.url,e.config,e.fieldMap);await n.fetchResources({spatialReference:s.spatialReference,fields:s.fields});const l=await h(e.scaleExpression,s);return new p(n,t,s,l,a,e.symbolOptions)}async _analyzeFeature(t,s,i,r,l){const o=t.readLegacyFeature(),u=this._scaleFn(o,i,r),c=this._attributeHash(o)+\"-\"+u,d=this._groupIdCache.get(c);if(d)return d;const h={...r,spatialReference:this._info.spatialReference,abortOptions:l,fields:this._info.fields},m=await this._loader.getSymbolAsync(o,h),f=this._schemaUtilsModule.createSymbolSchema(m,this._symbolOptions),p=a(f,this._info,s,l).then((t=>{if(\"expanded-cim\"!==t.type)return n.error(new e(\"mapview-bad-type\",`Found unexpected type ${t.type} in dictionary response`)),null;t.hash+=\"-\"+u;for(const e of t.layers)e.scaleFactor=u,e.templateHash+=\"-\"+u;return this._templates.createTemplateGroup(t,null)}));return this._groupIdCache.put(c,p,1),p}async analyze(e,t,s,i,r,a){const n=t.getCursor(),l=[];for(;n.next();)l.push(this._analyzeFeature(n,s,i,r,a));return Promise.all(l)}match(e,t,s,i,r){return null}_attributeHash(e){let t=\"\";for(const s of this._symbolFields){const i=this._fieldMap[s];i&&(t+=e.attributes[i]+\"-\")}return t}}export{p as DictionaryMatcher,o as FeatureMatcher,c as IntervalMatcher,d as MapMatcher,u as SubtypeMatcher,l as createMatcher};\n"]},"metadata":{},"sourceType":"module"}