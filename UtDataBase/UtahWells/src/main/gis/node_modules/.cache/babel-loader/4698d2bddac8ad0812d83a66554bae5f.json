{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport t from \"../../../../../core/Error.js\";\nimport { isAbortError as e, isAborted as s, createAbortError as i } from \"../../../../../core/promiseUtils.js\";\nconst a = {\n  GCExt: 249,\n  COMMENT: 254,\n  APPExt: 255,\n  UNKNOWN: 1,\n  IMAGE: 44,\n  EOF: 59,\n  EXT: 33\n};\n\nfunction r(t) {\n  if (!t || 0 === t.byteLength) return !1;\n  const e = t.constructor === Uint8Array ? t : new Uint8Array(t);\n  return 71 === e[0] && 73 === e[1] && 70 === e[2] && 56 === e[3];\n}\n\nfunction h(t) {\n  const e = new Uint8ClampedArray(t);\n  let s = 6;\n  return [e[s++] + (e[s++] << 8), e[s++] + (e[s++] << 8)];\n}\n\nfunction o(t) {\n  if (!t || 0 === t.byteLength) return !1;\n  const e = new Uint8Array(t);\n  if (!r(e)) return !1;\n  let s = 0;\n\n  for (let i = 0, a = e.length - 9; i < a; ++i) if (0 === e[i] && 33 === e[i + 1] && 249 === e[i + 2] && 4 === e[i + 3] && 0 === e[i + 8] && (44 === e[i + 9] || 33 === e[i + 9]) && (s++, s > 1)) return !0;\n\n  return !1;\n}\n\nclass n {\n  constructor() {\n    this.paused = !1, this.playing = !1, this.waitTillDone = !0, this.loading = !1, this.firstFrameOnly = !1, this.frames = [], this.comment = \"\", this.length = 0, this.currentFrameNumber = 0, this.frameCount = 0, this.playSpeed = 1, this.lastFrame = null, this.playOnLoad = !0, this.complete = !1, this.interlaceOffsets = [0, 4, 2, 1], this.interlaceSteps = [8, 8, 4, 2], this._lastUsedFrame = -1;\n  }\n\n  static async create(s, i) {\n    const a = new n();\n\n    try {\n      await a._load(s, i);\n    } catch (r) {\n      if (!e(r)) return new t(\"invalid-resource\", `Could not load PNG: ${r.message}`);\n    }\n\n    return a;\n  }\n\n  play() {\n    this.playing || (this.paused = !1, this.playing = !0, this._play());\n  }\n\n  pause() {\n    this.paused = !0, this.playing = !1, clearTimeout(this.timerID);\n  }\n\n  togglePlay() {\n    this.paused || !this.playing ? this.play() : this.pause();\n  }\n\n  bindFrame(t, e, s) {\n    t.bindTexture(e, s);\n    const i = this.frameChanged();\n\n    if (i) {\n      const t = this.currentFrame,\n            s = t.frameData;\n      e.updateData(0, 0, 0, t.width, t.height, s), this.updateUsedFrame();\n    }\n\n    return i;\n  }\n\n  seekFrame(t) {\n    clearTimeout(this.timerID), this.currentFrameNumber = t % this.frames.length, this.playing ? this._play() : this._setCurrentFrame(this.currentFrameNumber);\n  }\n\n  seek(t) {\n    clearTimeout(this.timerID), t < 0 && (t = 0), t *= 1e3, t %= this.length;\n    let e = 0;\n\n    for (; t > this.frames[e].time + this.frames[e].delay && e < this.frames.length;) e += 1;\n\n    this.currentFrameNumber = e, this.playing ? this._play() : this._setCurrentFrame(this.currentFrameNumber);\n  }\n\n  frameChanged() {\n    return this._lastUsedFrame !== this.currentFrameNumber;\n  }\n\n  updateUsedFrame() {\n    this._lastUsedFrame = this.currentFrameNumber;\n  }\n\n  async _load(s, i) {\n    try {\n      this.loading = !0, await this._parse(s, i), this.loading = !1, this.play();\n    } catch (a) {\n      if (!e(a)) return new t(\"invalid-resource\", \"Could not parse gif!\");\n    }\n  }\n\n  _parse(t, e) {\n    const s = new l(t);\n    s.pos += 6, this.width = s.data[s.pos++] + (s.data[s.pos++] << 8), this.height = s.data[s.pos++] + (s.data[s.pos++] << 8);\n    const i = s.data[s.pos++];\n    return this.globalColourCount = 1 << 1 + (7 & i), s.pos++, s.pos++, 128 & i && (this.globalColourTable = this._parseColourTable(this.globalColourCount, s)), new Promise((t, i) => {\n      setTimeout(() => this._parseBlock(s, t, i, e), 0);\n    });\n  }\n\n  async _parseBlock(t, e, r, h) {\n    if (h && h.signal && s(h.signal)) return void r(i());\n    const o = t.data[t.pos++];\n\n    if (o === a.IMAGE) {\n      if (this._parseImg(t), this.firstFrameOnly) return this._finishedLoading(), void e();\n    } else {\n      if (o === a.EOF) return this._finishedLoading(), void e();\n\n      this._parseExt(t);\n    }\n\n    \"function\" == typeof this.onprogress && this.onprogress({\n      bytesRead: t.pos,\n      totalBytes: t.data.length,\n      frame: this.frames.length\n    }), setTimeout(() => this._parseBlock(t, e, r, h), 0);\n  }\n\n  _parseColourTable(t, e) {\n    const s = [];\n\n    for (let i = 0; i < t; i++) s.push([e.data[e.pos++], e.data[e.pos++], e.data[e.pos++]]);\n\n    return s;\n  }\n\n  _parseImg(t) {\n    const e = t => {\n      const e = this.pixelBufSize / t;\n      this.interlacedBufSize !== this.pixelBufSize && (this.deinterlaceBuf = new Uint8Array(this.pixelBufSize), this.interlacedBufSize = this.pixelBufSize);\n      let s = 0;\n\n      for (let i = 0; i < 4; i++) for (let a = this.interlaceOffsets[i]; a < e; a += this.interlaceSteps[i]) this.deinterlaceBuf.set(this.pixelBuf.subarray(s, s + t), a * t), s += t;\n    },\n          s = {};\n\n    this.frames.push(s), s.disposalMethod = this.disposalMethod, s.time = this.length, s.delay = 10 * this.delayTime, this.length += s.delay, this.transparencyGiven ? s.transparencyIndex = this.transparencyIndex : s.transparencyIndex = void 0, s.leftPos = t.data[t.pos++] + (t.data[t.pos++] << 8), s.topPos = t.data[t.pos++] + (t.data[t.pos++] << 8), s.width = t.data[t.pos++] + (t.data[t.pos++] << 8), s.height = t.data[t.pos++] + (t.data[t.pos++] << 8);\n    const i = t.data[t.pos++];\n    s.localColourTableFlag = !!(128 & i), s.localColourTableFlag && (s.localColourTable = this._parseColourTable(1 << 1 + (7 & i), t)), this.pixelBufSize !== s.width * s.height && (this.pixelBuf = new Uint8Array(s.width * s.height), this.pixelBufSize = s.width * s.height), this._lzwDecode(t.data[t.pos++], t.readSubBlocksB()), 64 & i ? (s.interlaced = !0, e(s.width)) : s.interlaced = !1, this._processFrame(s);\n  }\n\n  _lzwDecode(t, e) {\n    let s, i, a, r, h, o, n, l, d;\n    a = i = 0;\n    let p = [];\n    const u = 1 << t,\n          m = u + 1;\n\n    for (r = t + 1, d = !1; !d;) {\n      for (o = h, h = 0, s = 0; s < r; s++) e[a >> 3] & 1 << (7 & a) && (h |= 1 << s), a++;\n\n      if (h === u) {\n        for (p = [], r = t + 1, s = 0; s < u; s++) p[s] = [s];\n\n        p[u] = [], p[m] = null;\n      } else {\n        if (h === m) return void (d = !0);\n\n        for (h >= p.length ? p.push(p[o].concat(p[o][0])) : o !== u && p.push(p[o].concat(p[h][0])), n = p[h], l = n.length, s = 0; s < l; s++) this.pixelBuf[i++] = n[s];\n\n        p.length === 1 << r && r < 12 && r++;\n      }\n    }\n  }\n\n  _processFrame(t) {\n    t.image = document.createElement(\"canvas\"), t.image.width = this.width, t.image.height = this.height, t.ctx = t.image.getContext(\"2d\");\n    const e = t.localColourTableFlag ? t.localColourTable : this.globalColourTable;\n    null === this.lastFrame && (this.lastFrame = t);\n    const s = 2 === this.lastFrame.disposalMethod || 3 === this.lastFrame.disposalMethod;\n    s || t.ctx.drawImage(this.lastFrame.image, 0, 0, this.width, this.height);\n    const i = t.ctx.getImageData(t.leftPos, t.topPos, t.width, t.height),\n          a = t.transparencyIndex,\n          r = i.data,\n          h = t.interlaced ? this.deinterlaceBuf : this.pixelBuf,\n          o = h.length;\n    let n,\n        l,\n        d = 0;\n\n    for (let p = 0; p < o; p++) n = h[p], l = e[n], a !== n ? (r[d++] = l[0], r[d++] = l[1], r[d++] = l[2], r[d++] = 255) : s ? (r[d + 3] = 0, d += 4) : d += 4;\n\n    t.ctx.putImageData(i, t.leftPos, t.topPos), this.lastFrame = t;\n  }\n\n  _parseExt(t) {\n    const e = t.data[t.pos++];\n    e === a.GCExt ? this._parseGCExt(t) : e === a.COMMENT ? this.comment += t.readSubBlocks() : e === a.APPExt ? this._parseAppExt(t) : (e === a.UNKNOWN && (t.pos += 13), t.readSubBlocks());\n  }\n\n  _parseAppExt(t) {\n    t.pos += 1, \"NETSCAPE\" === t.getString(8) ? t.pos += 8 : (t.pos += 3, t.readSubBlocks());\n  }\n\n  _parseGCExt(t) {\n    t.pos++;\n    const e = t.data[t.pos++];\n    this.disposalMethod = (28 & e) >> 2, this.transparencyGiven = !!(1 & e), this.delayTime = t.data[t.pos++] + (t.data[t.pos++] << 8), this.transparencyIndex = t.data[t.pos++], t.pos++;\n  }\n\n  _finishedLoading() {\n    this.loading = !1, this.frameCount = this.frames.length, this.lastFrame = null, this.complete = !0, this.disposalMethod = void 0, this.transparencyGiven = void 0, this.delayTime = void 0, this.transparencyIndex = void 0, this.waitTillDone = void 0, this.pixelBuf = void 0, this.deinterlaceBuf = void 0, this.pixelBufSize = void 0, this.deinterlaceBuf = void 0, this.currentFrameNumber = 0, this.frames.length > 0 && this._setCurrentFrame(0), this.playOnLoad && this.play();\n  }\n\n  _play() {\n    let t, e;\n    0 !== this.playSpeed ? (this.playSpeed < 0 ? (this.currentFrameNumber -= 1, this.currentFrameNumber < 0 && (this.currentFrameNumber = this.frames.length - 1), e = this.currentFrameNumber, e -= 1, e < 0 && (e = this.frames.length - 1), t = 1 * -this.frames[e].delay / this.playSpeed) : (this.currentFrameNumber += 1, this.currentFrameNumber %= this.frames.length, t = 1 * this.frames[this.currentFrameNumber].delay / this.playSpeed), this._setCurrentFrame(this.currentFrameNumber), this.timerID = window.setTimeout(() => this._play(), t)) : this.pause();\n  }\n\n  _setCurrentFrame(t) {\n    const e = this.frames[t];\n    this.currentFrame = {\n      frameData: e.image,\n      top: 0,\n      left: 0,\n      width: this.width,\n      height: this.height\n    };\n  }\n\n}\n\nclass l {\n  constructor(t) {\n    this.pos = 0, this.data = new Uint8ClampedArray(t), this.len = this.data.length;\n  }\n\n  getString(t) {\n    let e = \"\";\n\n    for (; t--;) e += String.fromCharCode(this.data[this.pos++]);\n\n    return e;\n  }\n\n  readSubBlocks() {\n    let t,\n        e,\n        s = \"\";\n\n    do {\n      for (e = t = this.data[this.pos++]; e--;) s += String.fromCharCode(this.data[this.pos++]);\n    } while (0 !== t && this.pos < this.len);\n\n    return s;\n  }\n\n  readSubBlocksB() {\n    let t, e;\n    const s = [];\n\n    do {\n      for (e = t = this.data[this.pos++]; e--;) s.push(this.data[this.pos++]);\n    } while (0 !== t && this.pos < this.len);\n\n    return s;\n  }\n\n}\n\nexport { n as default, h as getGIFSize, o as isAnimatedGIF, r as isGIF };","map":{"version":3,"sources":["D:/Github/CUSP_DataBase/CUSP_DB/src/main/gis/node_modules/@arcgis/core/views/2d/engine/webgl/animatedFormats/gif.js"],"names":["t","isAbortError","e","isAborted","s","createAbortError","i","a","GCExt","COMMENT","APPExt","UNKNOWN","IMAGE","EOF","EXT","r","byteLength","constructor","Uint8Array","h","Uint8ClampedArray","o","length","n","paused","playing","waitTillDone","loading","firstFrameOnly","frames","comment","currentFrameNumber","frameCount","playSpeed","lastFrame","playOnLoad","complete","interlaceOffsets","interlaceSteps","_lastUsedFrame","create","_load","message","play","_play","pause","clearTimeout","timerID","togglePlay","bindFrame","bindTexture","frameChanged","currentFrame","frameData","updateData","width","height","updateUsedFrame","seekFrame","_setCurrentFrame","seek","time","delay","_parse","l","pos","data","globalColourCount","globalColourTable","_parseColourTable","Promise","setTimeout","_parseBlock","signal","_parseImg","_finishedLoading","_parseExt","onprogress","bytesRead","totalBytes","frame","push","pixelBufSize","interlacedBufSize","deinterlaceBuf","set","pixelBuf","subarray","disposalMethod","delayTime","transparencyGiven","transparencyIndex","leftPos","topPos","localColourTableFlag","localColourTable","_lzwDecode","readSubBlocksB","interlaced","_processFrame","d","p","u","m","concat","image","document","createElement","ctx","getContext","drawImage","getImageData","putImageData","_parseGCExt","readSubBlocks","_parseAppExt","getString","window","top","left","len","String","fromCharCode","default","getGIFSize","isAnimatedGIF","isGIF"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport t from\"../../../../../core/Error.js\";import{isAbortError as e,isAborted as s,createAbortError as i}from\"../../../../../core/promiseUtils.js\";const a={GCExt:249,COMMENT:254,APPExt:255,UNKNOWN:1,IMAGE:44,EOF:59,EXT:33};function r(t){if(!t||0===t.byteLength)return!1;const e=t.constructor===Uint8Array?t:new Uint8Array(t);return 71===e[0]&&73===e[1]&&70===e[2]&&56===e[3]}function h(t){const e=new Uint8ClampedArray(t);let s=6;return[e[s++]+(e[s++]<<8),e[s++]+(e[s++]<<8)]}function o(t){if(!t||0===t.byteLength)return!1;const e=new Uint8Array(t);if(!r(e))return!1;let s=0;for(let i=0,a=e.length-9;i<a;++i)if(0===e[i]&&33===e[i+1]&&249===e[i+2]&&4===e[i+3]&&0===e[i+8]&&(44===e[i+9]||33===e[i+9])&&(s++,s>1))return!0;return!1}class n{constructor(){this.paused=!1,this.playing=!1,this.waitTillDone=!0,this.loading=!1,this.firstFrameOnly=!1,this.frames=[],this.comment=\"\",this.length=0,this.currentFrameNumber=0,this.frameCount=0,this.playSpeed=1,this.lastFrame=null,this.playOnLoad=!0,this.complete=!1,this.interlaceOffsets=[0,4,2,1],this.interlaceSteps=[8,8,4,2],this._lastUsedFrame=-1}static async create(s,i){const a=new n;try{await a._load(s,i)}catch(r){if(!e(r))return new t(\"invalid-resource\",`Could not load PNG: ${r.message}`)}return a}play(){this.playing||(this.paused=!1,this.playing=!0,this._play())}pause(){this.paused=!0,this.playing=!1,clearTimeout(this.timerID)}togglePlay(){this.paused||!this.playing?this.play():this.pause()}bindFrame(t,e,s){t.bindTexture(e,s);const i=this.frameChanged();if(i){const t=this.currentFrame,s=t.frameData;e.updateData(0,0,0,t.width,t.height,s),this.updateUsedFrame()}return i}seekFrame(t){clearTimeout(this.timerID),this.currentFrameNumber=t%this.frames.length,this.playing?this._play():this._setCurrentFrame(this.currentFrameNumber)}seek(t){clearTimeout(this.timerID),t<0&&(t=0),t*=1e3,t%=this.length;let e=0;for(;t>this.frames[e].time+this.frames[e].delay&&e<this.frames.length;)e+=1;this.currentFrameNumber=e,this.playing?this._play():this._setCurrentFrame(this.currentFrameNumber)}frameChanged(){return this._lastUsedFrame!==this.currentFrameNumber}updateUsedFrame(){this._lastUsedFrame=this.currentFrameNumber}async _load(s,i){try{this.loading=!0,await this._parse(s,i),this.loading=!1,this.play()}catch(a){if(!e(a))return new t(\"invalid-resource\",\"Could not parse gif!\")}}_parse(t,e){const s=new l(t);s.pos+=6,this.width=s.data[s.pos++]+(s.data[s.pos++]<<8),this.height=s.data[s.pos++]+(s.data[s.pos++]<<8);const i=s.data[s.pos++];return this.globalColourCount=1<<1+(7&i),s.pos++,s.pos++,128&i&&(this.globalColourTable=this._parseColourTable(this.globalColourCount,s)),new Promise(((t,i)=>{setTimeout((()=>this._parseBlock(s,t,i,e)),0)}))}async _parseBlock(t,e,r,h){if(h&&h.signal&&s(h.signal))return void r(i());const o=t.data[t.pos++];if(o===a.IMAGE){if(this._parseImg(t),this.firstFrameOnly)return this._finishedLoading(),void e()}else{if(o===a.EOF)return this._finishedLoading(),void e();this._parseExt(t)}\"function\"==typeof this.onprogress&&this.onprogress({bytesRead:t.pos,totalBytes:t.data.length,frame:this.frames.length}),setTimeout((()=>this._parseBlock(t,e,r,h)),0)}_parseColourTable(t,e){const s=[];for(let i=0;i<t;i++)s.push([e.data[e.pos++],e.data[e.pos++],e.data[e.pos++]]);return s}_parseImg(t){const e=t=>{const e=this.pixelBufSize/t;this.interlacedBufSize!==this.pixelBufSize&&(this.deinterlaceBuf=new Uint8Array(this.pixelBufSize),this.interlacedBufSize=this.pixelBufSize);let s=0;for(let i=0;i<4;i++)for(let a=this.interlaceOffsets[i];a<e;a+=this.interlaceSteps[i])this.deinterlaceBuf.set(this.pixelBuf.subarray(s,s+t),a*t),s+=t},s={};this.frames.push(s),s.disposalMethod=this.disposalMethod,s.time=this.length,s.delay=10*this.delayTime,this.length+=s.delay,this.transparencyGiven?s.transparencyIndex=this.transparencyIndex:s.transparencyIndex=void 0,s.leftPos=t.data[t.pos++]+(t.data[t.pos++]<<8),s.topPos=t.data[t.pos++]+(t.data[t.pos++]<<8),s.width=t.data[t.pos++]+(t.data[t.pos++]<<8),s.height=t.data[t.pos++]+(t.data[t.pos++]<<8);const i=t.data[t.pos++];s.localColourTableFlag=!!(128&i),s.localColourTableFlag&&(s.localColourTable=this._parseColourTable(1<<1+(7&i),t)),this.pixelBufSize!==s.width*s.height&&(this.pixelBuf=new Uint8Array(s.width*s.height),this.pixelBufSize=s.width*s.height),this._lzwDecode(t.data[t.pos++],t.readSubBlocksB()),64&i?(s.interlaced=!0,e(s.width)):s.interlaced=!1,this._processFrame(s)}_lzwDecode(t,e){let s,i,a,r,h,o,n,l,d;a=i=0;let p=[];const u=1<<t,m=u+1;for(r=t+1,d=!1;!d;){for(o=h,h=0,s=0;s<r;s++)e[a>>3]&1<<(7&a)&&(h|=1<<s),a++;if(h===u){for(p=[],r=t+1,s=0;s<u;s++)p[s]=[s];p[u]=[],p[m]=null}else{if(h===m)return void(d=!0);for(h>=p.length?p.push(p[o].concat(p[o][0])):o!==u&&p.push(p[o].concat(p[h][0])),n=p[h],l=n.length,s=0;s<l;s++)this.pixelBuf[i++]=n[s];p.length===1<<r&&r<12&&r++}}}_processFrame(t){t.image=document.createElement(\"canvas\"),t.image.width=this.width,t.image.height=this.height,t.ctx=t.image.getContext(\"2d\");const e=t.localColourTableFlag?t.localColourTable:this.globalColourTable;null===this.lastFrame&&(this.lastFrame=t);const s=2===this.lastFrame.disposalMethod||3===this.lastFrame.disposalMethod;s||t.ctx.drawImage(this.lastFrame.image,0,0,this.width,this.height);const i=t.ctx.getImageData(t.leftPos,t.topPos,t.width,t.height),a=t.transparencyIndex,r=i.data,h=t.interlaced?this.deinterlaceBuf:this.pixelBuf,o=h.length;let n,l,d=0;for(let p=0;p<o;p++)n=h[p],l=e[n],a!==n?(r[d++]=l[0],r[d++]=l[1],r[d++]=l[2],r[d++]=255):s?(r[d+3]=0,d+=4):d+=4;t.ctx.putImageData(i,t.leftPos,t.topPos),this.lastFrame=t}_parseExt(t){const e=t.data[t.pos++];e===a.GCExt?this._parseGCExt(t):e===a.COMMENT?this.comment+=t.readSubBlocks():e===a.APPExt?this._parseAppExt(t):(e===a.UNKNOWN&&(t.pos+=13),t.readSubBlocks())}_parseAppExt(t){t.pos+=1,\"NETSCAPE\"===t.getString(8)?t.pos+=8:(t.pos+=3,t.readSubBlocks())}_parseGCExt(t){t.pos++;const e=t.data[t.pos++];this.disposalMethod=(28&e)>>2,this.transparencyGiven=!!(1&e),this.delayTime=t.data[t.pos++]+(t.data[t.pos++]<<8),this.transparencyIndex=t.data[t.pos++],t.pos++}_finishedLoading(){this.loading=!1,this.frameCount=this.frames.length,this.lastFrame=null,this.complete=!0,this.disposalMethod=void 0,this.transparencyGiven=void 0,this.delayTime=void 0,this.transparencyIndex=void 0,this.waitTillDone=void 0,this.pixelBuf=void 0,this.deinterlaceBuf=void 0,this.pixelBufSize=void 0,this.deinterlaceBuf=void 0,this.currentFrameNumber=0,this.frames.length>0&&this._setCurrentFrame(0),this.playOnLoad&&this.play()}_play(){let t,e;0!==this.playSpeed?(this.playSpeed<0?(this.currentFrameNumber-=1,this.currentFrameNumber<0&&(this.currentFrameNumber=this.frames.length-1),e=this.currentFrameNumber,e-=1,e<0&&(e=this.frames.length-1),t=1*-this.frames[e].delay/this.playSpeed):(this.currentFrameNumber+=1,this.currentFrameNumber%=this.frames.length,t=1*this.frames[this.currentFrameNumber].delay/this.playSpeed),this._setCurrentFrame(this.currentFrameNumber),this.timerID=window.setTimeout((()=>this._play()),t)):this.pause()}_setCurrentFrame(t){const e=this.frames[t];this.currentFrame={frameData:e.image,top:0,left:0,width:this.width,height:this.height}}}class l{constructor(t){this.pos=0,this.data=new Uint8ClampedArray(t),this.len=this.data.length}getString(t){let e=\"\";for(;t--;)e+=String.fromCharCode(this.data[this.pos++]);return e}readSubBlocks(){let t,e,s=\"\";do{for(e=t=this.data[this.pos++];e--;)s+=String.fromCharCode(this.data[this.pos++])}while(0!==t&&this.pos<this.len);return s}readSubBlocksB(){let t,e;const s=[];do{for(e=t=this.data[this.pos++];e--;)s.push(this.data[this.pos++])}while(0!==t&&this.pos<this.len);return s}}export{n as default,h as getGIFSize,o as isAnimatedGIF,r as isGIF};\n"]},"metadata":{},"sourceType":"module"}