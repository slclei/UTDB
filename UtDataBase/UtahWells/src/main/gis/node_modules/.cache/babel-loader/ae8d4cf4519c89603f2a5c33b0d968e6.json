{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport e from \"../../../../../core/BidiEngine.js\";\nimport { numericHash as t } from \"../../../../../core/string.js\";\nimport { BucketType as n } from \"../enums.js\";\nimport { C_DEG_TO_RAD as i, log2 as s, interpolate as a } from \"../GeometryUtils.js\";\nimport { TILE_PIXEL_RATIO as o, Anchor as r, TILE_COORD_SIZE as l } from \"../Placement.js\";\nimport { SDF_GLYPH_SIZE as h, TextShaping as x } from \"../TextShaping.js\";\nimport c from \"./BaseBucket.js\";\nimport { TextTransform as d, SymbolPlacement as f, TextWritingMode as g, SymbolAnchor as y, TextJustification as m, RotationAlignment as u } from \"../style/StyleDefinition.js\";\nimport { IconLayout as p, TextLayout as _ } from \"../style/StyleLayer.js\";\nimport { GeometryType as M, Point as P } from \"../../webgl/Geometry.js\";\nconst I = 10;\n\nfunction b(e, t) {\n  return e.iconMosaicItem && t.iconMosaicItem ? e.iconMosaicItem.page === t.iconMosaicItem.page ? 0 : e.iconMosaicItem.page - t.iconMosaicItem.page : e.iconMosaicItem && !t.iconMosaicItem ? 1 : !e.iconMosaicItem && t.iconMosaicItem ? -1 : 0;\n}\n\nclass A extends c {\n  constructor(e, t, i, s, a, o, r, l) {\n    super(e, t, l.getSpriteItems()), this.type = n.SYMBOL, this._markerMap = new Map(), this._glyphMap = new Map(), this._glyphBufferDataStorage = new Map(), this._isIconSDF = !1, this._iconVertexBuffer = i, this._iconIndexBuffer = s, this._textVertexBuffer = a, this._textIndexBuffer = o, this._placementEngine = r, this._workerTileHandler = l;\n  }\n\n  get markerPageMap() {\n    return this._markerMap;\n  }\n\n  get glyphsPageMap() {\n    return this._glyphMap;\n  }\n\n  get symbolInstances() {\n    return this._symbolInstances;\n  }\n\n  getResources(e, n, i) {\n    const s = this.layer,\n          a = this.zoom;\n    e && e.setExtent(this.layerExtent);\n    const o = s.getLayoutProperty(\"icon-image\"),\n          r = s.getLayoutProperty(\"text-field\");\n    let l = s.getLayoutProperty(\"text-transform\"),\n        h = s.getLayoutProperty(\"text-font\");\n    const x = [];\n    let c, f, g, y;\n    o && !o.isDataDriven && (c = o.getValue(a)), r && !r.isDataDriven && (f = r.getValue(a)), l && l.isDataDriven || (g = s.getLayoutValue(\"text-transform\", a), l = null), h && h.isDataDriven || (y = s.getLayoutValue(\"text-font\", a), h = null);\n\n    for (const m of this._features) {\n      const u = m.getGeometry(e);\n      if (!u || 0 === u.length) continue;\n\n      let p, _;\n\n      o && (p = o.isDataDriven ? o.getValue(a, m) : this._replaceKeys(c, m.values), p && n(p));\n      let M = !1;\n\n      if (r && (_ = r.isDataDriven ? r.getValue(a, m) : this._replaceKeys(f, m.values), _)) {\n        switch (_ = _.replace(/\\\\n/g, \"\\n\"), l && (g = l.getValue(a, m)), g) {\n          case d.LOWERCASE:\n            _ = _.toLowerCase();\n            break;\n\n          case d.UPPERCASE:\n            _ = _.toUpperCase();\n        }\n\n        if (A._bidiEngine.hasBidiChar(_)) {\n          let e;\n          e = \"rtl\" === A._bidiEngine.checkContextual(_) ? \"IDNNN\" : \"ICNNN\", _ = A._bidiEngine.bidiTransform(_, e, \"VLYSN\"), M = !0;\n        }\n\n        const e = _.length;\n\n        if (e > 0) {\n          h && (y = h.getValue(a, m));\n\n          for (const t of y) {\n            let n = i[t];\n            n || (n = i[t] = new Set());\n\n            for (let t = 0; t < e; t++) {\n              const e = _.charCodeAt(t);\n\n              n.add(e);\n            }\n          }\n        }\n      }\n\n      if (!p && !_) continue;\n      const P = s.getLayoutValue(\"symbol-sort-key\", a, m),\n            I = {\n        feature: m,\n        sprite: p,\n        label: _,\n        rtl: M,\n        geometry: u,\n        hash: (_ ? t(_) : 0) ^ (p ? t(p) : 0),\n        priority: P,\n        textFont: y\n      };\n      x.push(I);\n    }\n\n    this._symbolFeatures = x;\n  }\n\n  processFeatures(e) {\n    e && e.setExtent(this.layerExtent);\n    const t = this.layer,\n          n = this.zoom,\n          s = t.getLayoutValue(\"symbol-placement\", n),\n          a = s !== f.POINT,\n          c = t.getLayoutValue(\"symbol-spacing\", n) * o,\n          d = t.getLayoutProperty(\"icon-image\"),\n          P = t.getLayoutProperty(\"text-field\"),\n          I = d ? new p(t, n, a) : null,\n          L = P ? new _(t, n, a) : null,\n          V = this._workerTileHandler;\n    let T;\n    d && (T = V.getSpriteItems()), this._iconIndexStart = 3 * this._iconIndexBuffer.index, this._textIndexStart = 3 * this._textIndexBuffer.index, this._iconIndexCount = 0, this._textIndexCount = 0, this._markerMap.clear(), this._glyphMap.clear();\n    const w = [];\n    let B = 1;\n    L && L.size && (B = L.size / h);\n    const C = L ? L.maxAngle * i : 0,\n          R = L ? L.size * o : 0;\n\n    for (const i of this._symbolFeatures) {\n      let e;\n      I && T && i.sprite && (e = T[i.sprite], e && e.sdf && (this._isIconSDF = !0));\n      let t;\n      !!e && I.update(n, i.feature);\n      let d = 0;\n      const p = i.label;\n\n      if (p) {\n        L.update(n, i.feature);\n        const e = a ? L.keepUpright : L.writingMode && L.writingMode.indexOf(g.VERTICAL) >= 0;\n        let s = .5;\n\n        switch (L.anchor) {\n          case y.TOP_LEFT:\n          case y.LEFT:\n          case y.BOTTOM_LEFT:\n            s = 0;\n            break;\n\n          case y.TOP_RIGHT:\n          case y.RIGHT:\n          case y.BOTTOM_RIGHT:\n            s = 1;\n        }\n\n        let r = .5;\n\n        switch (L.anchor) {\n          case y.TOP_LEFT:\n          case y.TOP:\n          case y.TOP_RIGHT:\n            r = 0;\n            break;\n\n          case y.BOTTOM_LEFT:\n          case y.BOTTOM:\n          case y.BOTTOM_RIGHT:\n            r = 1;\n        }\n\n        let l = .5;\n\n        switch (L.justify) {\n          case m.AUTO:\n            l = s;\n            break;\n\n          case m.LEFT:\n            l = 0;\n            break;\n\n          case m.RIGHT:\n            l = 1;\n        }\n\n        const c = L.letterSpacing * h,\n              f = a ? 0 : L.maxWidth * h,\n              u = L.lineHeight * h,\n              _ = i.textFont.map(e => V.getGlyphItems(e));\n\n        if (t = new x(_, f, u, c, s, r, l).getShaping(p, i.rtl, e), t && t.length > 0) {\n          let e = 1e30,\n              n = -1e30;\n\n          for (const i of t) e = Math.min(e, i.x), n = Math.max(n, i.x);\n\n          d = (n - e + 2 * h) * B * o;\n        }\n      }\n\n      for (let n of i.geometry) {\n        const h = [];\n\n        if (s === f.LINE) {\n          if (t && t.length > 0 && L && L.size) {\n            const e = L.size * o * (2 + Math.min(2, 4 * Math.abs(L.offset[1])));\n            n = A._smoothVertices(n, e);\n          }\n\n          A._pushAnchors(h, n, c, d);\n        } else s === f.LINE_CENTER ? A._pushCenterAnchor(h, n) : i.feature.type === M.Polygon ? A._pushCentroid(h, n) : h.push(new r(n[0].x, n[0].y));\n\n        for (const s of h) {\n          if (s.x < 0 || s.x > l || s.y < 0 || s.y > l) continue;\n          if (a && d > 0 && L.rotationAlignment === u.MAP && !A._honorsTextMaxAngle(n, s, d, C, R)) continue;\n          const o = {\n            shaping: t,\n            line: n,\n            iconMosaicItem: e,\n            anchor: s,\n            symbolFeature: i,\n            textColliders: [],\n            iconColliders: [],\n            textVertexRanges: [],\n            iconVertexRanges: []\n          };\n          w.push(o), this._processFeature(o, I, L);\n        }\n      }\n    }\n\n    w.sort(b), this._addPlacedGlyphs(), this._symbolInstances = w;\n  }\n\n  serialize() {\n    let e = 11;\n    e += this.layerUIDs.length, e += 3 * this.markerPageMap.size, e += 3 * this.glyphsPageMap.size, e += A._symbolsSerializationLength(this._symbolInstances), e += this._iconVertexBuffer.array.length, e += this._iconIndexBuffer.array.length, e += this._textVertexBuffer.array.length, e += this._textIndexBuffer.array.length;\n    const t = new Uint32Array(e),\n          n = new Int32Array(t.buffer),\n          i = new Float32Array(t.buffer);\n    let s = 0;\n    t[s++] = this.type, t[s++] = this.layerUIDs.length;\n\n    for (let a = 0; a < this.layerUIDs.length; a++) t[s++] = this.layerUIDs[a];\n\n    t[s++] = this._isIconSDF ? 1 : 0, t[s++] = this.markerPageMap.size;\n\n    for (const [a, [o, r]] of this.markerPageMap) t[s++] = a, t[s++] = o, t[s++] = r;\n\n    t[s++] = this.glyphsPageMap.size;\n\n    for (const [a, [o, r]] of this.glyphsPageMap) t[s++] = a, t[s++] = o, t[s++] = r;\n\n    t[s++] = this._iconVertexBuffer.index / 4, t[s++] = this._textVertexBuffer.index / 4, s = A.serializeSymbols(t, n, i, s, this._symbolInstances), t[s++] = this._iconVertexBuffer.array.length;\n\n    for (let a = 0; a < this._iconVertexBuffer.array.length; a++) n[s++] = this._iconVertexBuffer.array[a];\n\n    t[s++] = this._iconIndexBuffer.array.length;\n\n    for (let a = 0; a < this._iconIndexBuffer.array.length; a++) t[s++] = this._iconIndexBuffer.array[a];\n\n    t[s++] = this._textVertexBuffer.array.length;\n\n    for (let a = 0; a < this._textVertexBuffer.array.length; a++) n[s++] = this._textVertexBuffer.array[a];\n\n    t[s++] = this._textIndexBuffer.array.length;\n\n    for (let a = 0; a < this._textIndexBuffer.array.length; a++) t[s++] = this._textIndexBuffer.array[a];\n\n    return t.buffer;\n  }\n\n  static _symbolsSerializationLength(e) {\n    let t = 0;\n    t += 1;\n\n    for (const n of e || []) {\n      t += 4, t += 1;\n\n      for (const e of n.textColliders) t += I;\n\n      for (const e of n.iconColliders) t += I;\n\n      t += 1, t += 2 * n.textVertexRanges.length, t += 1, t += 2 * n.iconVertexRanges.length;\n    }\n\n    return t;\n  }\n\n  static serializeSymbols(e, t, n, i, s) {\n    s = s || [], t[i++] = s.length;\n\n    for (const a of s) {\n      t[i++] = a.anchor.x, t[i++] = a.anchor.y, t[i++] = a.symbolFeature.hash, t[i++] = a.symbolFeature.priority, t[i++] = a.textColliders.length + a.iconColliders.length;\n\n      for (const e of a.textColliders) t[i++] = e.xTile, t[i++] = e.yTile, t[i++] = e.dxPixels, t[i++] = e.dyPixels, t[i++] = e.hard ? 1 : 0, t[i++] = e.partIndex, n[i++] = e.minLod, n[i++] = e.maxLod, t[i++] = e.width, t[i++] = e.height;\n\n      for (const e of a.iconColliders) t[i++] = e.xTile, t[i++] = e.yTile, t[i++] = e.dxPixels, t[i++] = e.dyPixels, t[i++] = e.hard ? 1 : 0, t[i++] = e.partIndex, n[i++] = e.minLod, n[i++] = e.maxLod, t[i++] = e.width, t[i++] = e.height;\n\n      t[i++] = a.textVertexRanges.length;\n\n      for (const [e, n] of a.textVertexRanges) t[i++] = e, t[i++] = n;\n\n      t[i++] = a.iconVertexRanges.length;\n\n      for (const [e, n] of a.iconVertexRanges) t[i++] = e, t[i++] = n;\n    }\n\n    return i;\n  }\n\n  _replaceKeys(e, t) {\n    return e.replace(/{([^{}]+)}/g, function (e, n) {\n      return n in t ? t[n] : \"\";\n    });\n  }\n\n  _processFeature(e, t, n) {\n    const {\n      line: i,\n      iconMosaicItem: a,\n      shaping: o,\n      anchor: r\n    } = e,\n          l = this.zoom,\n          h = this.layer,\n          x = !!a;\n    let c = !0;\n    x && (c = t.optional || !a);\n    const d = o && o.length > 0;\n    let f,\n        g,\n        y = !0;\n\n    if (d && (y = n.optional), x && (f = this._placementEngine.getIconPlacement(r, a, t)), (f || c) && (d && (g = this._placementEngine.getTextPlacement(r, o, i, n)), g || y)) {\n      if (f && g || (y || c ? y || g ? c || f || (g = null) : f = null : (f = null, g = null)), g) {\n        const t = h.hasDataDrivenText ? h.textMaterial.encodeAttributes(e.symbolFeature.feature, l, h) : null;\n\n        if (this._storePlacedGlyphs(e, g.shapes, l, n.rotationAlignment, t), g.textColliders) {\n          e.textColliders = g.textColliders;\n\n          for (const e of g.textColliders) {\n            e.minLod = Math.max(l + s(e.minLod), 0), e.maxLod = Math.min(l + s(e.maxLod), 25);\n            const t = e.angle;\n\n            if (t) {\n              const n = Math.cos(t),\n                    i = Math.sin(t),\n                    s = e.dxPixels * n - e.dyPixels * i,\n                    a = e.dxPixels * i + e.dyPixels * n,\n                    o = (e.dxPixels + e.width) * n - e.dyPixels * i,\n                    r = (e.dxPixels + e.width) * i + e.dyPixels * n,\n                    l = e.dxPixels * n - (e.dyPixels + e.height) * i,\n                    h = e.dxPixels * i + (e.dyPixels + e.height) * n,\n                    x = (e.dxPixels + e.width) * n - (e.dyPixels + e.height) * i,\n                    c = (e.dxPixels + e.width) * i + (e.dyPixels + e.height) * n,\n                    d = Math.min(s, o, l, x),\n                    f = Math.max(s, o, l, x),\n                    g = Math.min(a, r, h, c),\n                    y = Math.max(a, r, h, c);\n              e.dxPixels = d, e.dyPixels = g, e.width = f - d, e.height = y - g;\n            }\n          }\n        }\n      }\n\n      if (f) {\n        const n = h.hasDataDrivenIcon ? h.iconMaterial.encodeAttributes(e.symbolFeature.feature, l, h) : null;\n\n        if (this._addPlacedIcons(e, f.shapes, l, a.page, t.rotationAlignment === u.VIEWPORT, n), f.iconColliders) {\n          e.iconColliders = f.iconColliders;\n\n          for (const e of f.iconColliders) {\n            e.minLod = Math.max(l + s(e.minLod), 0), e.maxLod = Math.min(l + s(e.maxLod), 25);\n            const t = e.angle;\n\n            if (t) {\n              const n = Math.cos(t),\n                    i = Math.sin(t),\n                    s = e.dxPixels * n - e.dyPixels * i,\n                    a = e.dxPixels * i + e.dyPixels * n,\n                    o = (e.dxPixels + e.width) * n - e.dyPixels * i,\n                    r = (e.dxPixels + e.width) * i + e.dyPixels * n,\n                    l = e.dxPixels * n - (e.dyPixels + e.height) * i,\n                    h = e.dxPixels * i + (e.dyPixels + e.height) * n,\n                    x = (e.dxPixels + e.width) * n - (e.dyPixels + e.height) * i,\n                    c = (e.dxPixels + e.width) * i + (e.dyPixels + e.height) * n,\n                    d = Math.min(s, o, l, x),\n                    f = Math.max(s, o, l, x),\n                    g = Math.min(a, r, h, c),\n                    y = Math.max(a, r, h, c);\n              e.dxPixels = d, e.dyPixels = g, e.width = f - d, e.height = y - g;\n            }\n          }\n        }\n      }\n    }\n  }\n\n  _addPlacedIcons(e, t, n, i, a, o) {\n    const r = Math.max(n - 1, 0),\n          l = this._iconVertexBuffer,\n          h = this._iconIndexBuffer,\n          x = this._markerMap;\n\n    for (const c of t) {\n      const t = a ? 0 : Math.max(n + s(c.minzoom), r),\n            d = a ? 25 : Math.min(n + s(c.maxzoom), 25);\n      if (d <= t) continue;\n      const f = c.tl,\n            g = c.tr,\n            y = c.bl,\n            m = c.br,\n            u = c.mosaicRect,\n            p = c.labelAngle,\n            _ = c.minAngle,\n            M = c.maxAngle,\n            P = c.anchor,\n            I = l.index,\n            b = u.x,\n            A = u.y,\n            L = b + u.width,\n            V = A + u.height,\n            T = l.index;\n      l.add(P.x, P.y, f.x, f.y, b, A, p, _, M, t, d, o), l.add(P.x, P.y, g.x, g.y, L, A, p, _, M, t, d, o), l.add(P.x, P.y, y.x, y.y, b, V, p, _, M, t, d, o), l.add(P.x, P.y, m.x, m.y, L, V, p, _, M, t, d, o), e.iconVertexRanges.length > 0 && e.iconVertexRanges[0][0] + e.iconVertexRanges[0][1] === T ? e.iconVertexRanges[0][1] += 4 : e.iconVertexRanges.push([T, 4]), h.add(I + 0, I + 1, I + 2), h.add(I + 1, I + 2, I + 3), x.has(i) ? x.get(i)[1] += 6 : x.set(i, [this._iconIndexStart + this._iconIndexCount, 6]), this._iconIndexCount += 6;\n    }\n  }\n\n  _addPlacedGlyphs() {\n    const e = this._textVertexBuffer,\n          t = this._textIndexBuffer,\n          n = this._glyphMap;\n\n    for (const [i, s] of this._glyphBufferDataStorage) for (const a of s) {\n      const s = e.index,\n            o = a.symbolInstance,\n            r = a.ddAttributes,\n            l = e.index;\n      e.add(a.glyphAnchor[0], a.glyphAnchor[1], a.tl[0], a.tl[1], a.xmin, a.ymin, a.labelAngle, a.minAngle, a.maxAngle, a.minLod, a.maxLod, r), e.add(a.glyphAnchor[0], a.glyphAnchor[1], a.tr[0], a.tr[1], a.xmax, a.ymin, a.labelAngle, a.minAngle, a.maxAngle, a.minLod, a.maxLod, r), e.add(a.glyphAnchor[0], a.glyphAnchor[1], a.bl[0], a.bl[1], a.xmin, a.ymax, a.labelAngle, a.minAngle, a.maxAngle, a.minLod, a.maxLod, r), e.add(a.glyphAnchor[0], a.glyphAnchor[1], a.br[0], a.br[1], a.xmax, a.ymax, a.labelAngle, a.minAngle, a.maxAngle, a.minLod, a.maxLod, r), o.textVertexRanges.length > 0 && o.textVertexRanges[0][0] + o.textVertexRanges[0][1] === l ? o.textVertexRanges[0][1] += 4 : o.textVertexRanges.push([l, 4]), t.add(s + 0, s + 1, s + 2), t.add(s + 1, s + 2, s + 3), n.has(i) ? n.get(i)[1] += 6 : n.set(i, [this._textIndexStart + this._textIndexCount, 6]), this._textIndexCount += 6;\n    }\n\n    this._glyphBufferDataStorage.clear();\n  }\n\n  _storePlacedGlyphs(e, t, n, i, a) {\n    const o = Math.max(n - 1, 0),\n          r = i === u.VIEWPORT;\n\n    let l, h, x, c, d, f, g, y, m, p, _;\n\n    for (const u of t) {\n      if (l = r ? 0 : Math.max(n + s(u.minzoom), o), h = r ? 25 : Math.min(n + s(u.maxzoom), 25), h <= l) continue;\n      x = u.tl, c = u.tr, d = u.bl, f = u.br, g = u.labelAngle, y = u.minAngle, m = u.maxAngle, p = u.anchor, _ = u.mosaicRect, this._glyphBufferDataStorage.has(u.page) || this._glyphBufferDataStorage.set(u.page, []);\n\n      this._glyphBufferDataStorage.get(u.page).push({\n        glyphAnchor: [p.x, p.y],\n        tl: [x.x, x.y],\n        tr: [c.x, c.y],\n        bl: [d.x, d.y],\n        br: [f.x, f.y],\n        xmin: _.x,\n        ymin: _.y,\n        xmax: _.x + _.width,\n        ymax: _.y + _.height,\n        labelAngle: g,\n        minAngle: y,\n        maxAngle: m,\n        minLod: l,\n        maxLod: h,\n        placementLod: o,\n        symbolInstance: e,\n        ddAttributes: a\n      });\n    }\n  }\n\n  static _pushAnchors(e, t, n, i) {\n    n += i;\n    let s = 0;\n    const o = t.length - 1;\n\n    for (let a = 0; a < o; a++) s += P.distance(t[a], t[a + 1]);\n\n    let l = i || n;\n    if (l *= .5, s <= l) return;\n    const h = l / s;\n    let x = 0,\n        c = -(n = s / Math.max(Math.round(s / n), 1)) / 2;\n    const d = t.length - 1;\n\n    for (let f = 0; f < d; f++) {\n      const i = t[f],\n            s = t[f + 1],\n            o = s.x - i.x,\n            l = s.y - i.y,\n            d = Math.sqrt(o * o + l * l);\n      let g;\n\n      for (; c + n < x + d;) {\n        c += n;\n        const t = (c - x) / d,\n              y = a(i.x, s.x, t),\n              m = a(i.y, s.y, t);\n        void 0 === g && (g = Math.atan2(l, o)), e.push(new r(y, m, g, f, h));\n      }\n\n      x += d;\n    }\n  }\n\n  static _pushCenterAnchor(e, t) {\n    let n = 0;\n    const i = t.length - 1;\n\n    for (let a = 0; a < i; a++) n += P.distance(t[a], t[a + 1]);\n\n    const s = n / 2;\n    let o = 0;\n    const l = t.length - 1;\n\n    for (let h = 0; h < l; h++) {\n      const n = t[h],\n            i = t[h + 1],\n            l = i.x - n.x,\n            x = i.y - n.y,\n            c = Math.sqrt(l * l + x * x);\n\n      if (s < o + c) {\n        const t = (s - o) / c,\n              d = a(n.x, i.x, t),\n              f = a(n.y, i.y, t),\n              g = Math.atan2(x, l);\n        return void e.push(new r(d, f, g, h, 0));\n      }\n\n      o += c;\n    }\n  }\n\n  static _deviation(e, t, n) {\n    const i = (t.x - e.x) * (n.x - t.x) + (t.y - e.y) * (n.y - t.y),\n          s = (t.x - e.x) * (n.y - t.y) - (t.y - e.y) * (n.x - t.x);\n    return Math.atan2(s, i);\n  }\n\n  static _honorsTextMaxAngle(e, t, n, i, s) {\n    let a = 0;\n    const o = n / 2;\n    let r = new P(t.x, t.y),\n        l = t.segment + 1;\n\n    for (; a > -o;) {\n      if (--l, l < 0) return !1;\n      a -= P.distance(e[l], r), r = e[l];\n    }\n\n    a += P.distance(e[l], e[l + 1]);\n    const h = [];\n    let x = 0;\n    const c = e.length;\n\n    for (; a < o;) {\n      const t = e[l];\n      let n,\n          o = l;\n\n      do {\n        if (++o, o === c) return !1;\n        n = e[o];\n      } while (n.isEqual(t));\n\n      let r,\n          d = o;\n\n      do {\n        if (++d, d === c) return !1;\n        r = e[d];\n      } while (r.isEqual(n));\n\n      const f = this._deviation(t, n, r);\n\n      for (h.push({\n        deviation: f,\n        distToAnchor: a\n      }), x += f; a - h[0].distToAnchor > s;) x -= h.shift().deviation;\n\n      if (Math.abs(x) > i) return !1;\n      a += P.distance(n, r), l = o;\n    }\n\n    return !0;\n  }\n\n  static _smoothVertices(e, t) {\n    if (t <= 0) return e;\n    let n = e.length;\n    if (n < 3) return e;\n    const i = [];\n    let s = 0,\n        a = 0;\n    i.push(0);\n\n    for (let g = 1; g < n; g++) {\n      const t = P.distance(e[g], e[g - 1]);\n      t > 0 && (s += t, i.push(s), a++, a !== g && (e[a] = e[g]));\n    }\n\n    if (n = a + 1, n < 3) return e;\n    t = Math.min(t, .2 * s);\n    const o = e[0].x,\n          r = e[0].y,\n          l = e[n - 1].x,\n          h = e[n - 1].y,\n          x = P.sub(e[0], e[1]);\n    x.normalize(), e[0].x += t * x.x, e[0].y += t * x.y, x.assignSub(e[n - 1], e[n - 2]), x.normalize(), e[n - 1].x += t * x.x, e[n - 1].y += t * x.y, i[0] -= t, i[n - 1] += t;\n    const c = [];\n    c.push(new P(o, r));\n    const d = 1e-6,\n          f = .5 * t;\n\n    for (let g = 1; g < n - 1; g++) {\n      let s = 0,\n          a = 0,\n          o = 0;\n\n      for (let n = g - 1; n >= 0; n--) {\n        const r = f + i[n + 1] - i[g];\n        if (r < 0) break;\n        const l = i[n + 1] - i[n],\n              h = i[g] - i[n] < f ? 1 : r / l;\n        if (h < d) break;\n        const x = h * h,\n              c = h * r - .5 * x * l,\n              y = h * l / t,\n              m = e[n + 1],\n              u = e[n].x - m.x,\n              p = e[n].y - m.y;\n        s += y / c * (m.x * h * r + .5 * x * (r * u - l * m.x) - x * h * l * u / 3), a += y / c * (m.y * h * r + .5 * x * (r * p - l * m.y) - x * h * l * p / 3), o += y;\n      }\n\n      for (let r = g + 1; r < n; r++) {\n        const n = f - i[r - 1] + i[g];\n        if (n < 0) break;\n        const l = i[r] - i[r - 1],\n              h = i[r] - i[g] < f ? 1 : n / l;\n        if (h < d) break;\n        const x = h * h,\n              c = h * n - .5 * x * l,\n              y = h * l / t,\n              m = e[r - 1],\n              u = e[r].x - m.x,\n              p = e[r].y - m.y;\n        s += y / c * (m.x * h * n + .5 * x * (n * u - l * m.x) - x * h * l * u / 3), a += y / c * (m.y * h * n + .5 * x * (n * p - l * m.y) - x * h * l * p / 3), o += y;\n      }\n\n      c.push(new P(s / o, a / o));\n    }\n\n    return c.push(new P(l, h)), e[0].x = o, e[0].y = r, e[n - 1].x = l, e[n - 1].y = h, c;\n  }\n\n  static _pushCentroid(e, t) {\n    const n = 0,\n          i = 0,\n          s = 4096,\n          a = 4096,\n          o = t.length - 1;\n    let l = 0,\n        h = 0,\n        x = 0,\n        c = t[0].x,\n        d = t[0].y;\n    c > s && (c = s), c < n && (c = n), d > a && (d = a), d < i && (d = i);\n\n    for (let r = 1; r < o; r++) {\n      let e = t[r].x,\n          o = t[r].y,\n          f = t[r + 1].x,\n          g = t[r + 1].y;\n      e > s && (e = s), e < n && (e = n), o > a && (o = a), o < i && (o = i), f > s && (f = s), f < n && (f = n), g > a && (g = a), g < i && (g = i);\n      const y = (e - c) * (g - d) - (f - c) * (o - d);\n      l += y * (c + e + f), h += y * (d + o + g), x += y;\n    }\n\n    l /= 3 * x, h /= 3 * x, isNaN(l) || isNaN(h) || e.push(new r(l, h));\n  }\n\n}\n\nA._bidiEngine = new e();\nexport { A as default };","map":{"version":3,"sources":["D:/Github/CUSP_DataBase/CUSP_DB/src/main/gis/node_modules/@arcgis/core/views/2d/engine/vectorTiles/buckets/SymbolBucket.js"],"names":["e","numericHash","t","BucketType","n","C_DEG_TO_RAD","i","log2","s","interpolate","a","TILE_PIXEL_RATIO","o","Anchor","r","TILE_COORD_SIZE","l","SDF_GLYPH_SIZE","h","TextShaping","x","c","TextTransform","d","SymbolPlacement","f","TextWritingMode","g","SymbolAnchor","y","TextJustification","m","RotationAlignment","u","IconLayout","p","TextLayout","_","GeometryType","M","Point","P","I","b","iconMosaicItem","page","A","constructor","getSpriteItems","type","SYMBOL","_markerMap","Map","_glyphMap","_glyphBufferDataStorage","_isIconSDF","_iconVertexBuffer","_iconIndexBuffer","_textVertexBuffer","_textIndexBuffer","_placementEngine","_workerTileHandler","markerPageMap","glyphsPageMap","symbolInstances","_symbolInstances","getResources","layer","zoom","setExtent","layerExtent","getLayoutProperty","isDataDriven","getValue","getLayoutValue","_features","getGeometry","length","_replaceKeys","values","replace","LOWERCASE","toLowerCase","UPPERCASE","toUpperCase","_bidiEngine","hasBidiChar","checkContextual","bidiTransform","Set","charCodeAt","add","feature","sprite","label","rtl","geometry","hash","priority","textFont","push","_symbolFeatures","processFeatures","POINT","L","V","T","_iconIndexStart","index","_textIndexStart","_iconIndexCount","_textIndexCount","clear","w","B","size","C","maxAngle","R","sdf","update","keepUpright","writingMode","indexOf","VERTICAL","anchor","TOP_LEFT","LEFT","BOTTOM_LEFT","TOP_RIGHT","RIGHT","BOTTOM_RIGHT","TOP","BOTTOM","justify","AUTO","letterSpacing","maxWidth","lineHeight","map","getGlyphItems","getShaping","Math","min","max","LINE","abs","offset","_smoothVertices","_pushAnchors","LINE_CENTER","_pushCenterAnchor","Polygon","_pushCentroid","rotationAlignment","MAP","_honorsTextMaxAngle","shaping","line","symbolFeature","textColliders","iconColliders","textVertexRanges","iconVertexRanges","_processFeature","sort","_addPlacedGlyphs","serialize","layerUIDs","_symbolsSerializationLength","array","Uint32Array","Int32Array","buffer","Float32Array","serializeSymbols","xTile","yTile","dxPixels","dyPixels","hard","partIndex","minLod","maxLod","width","height","optional","getIconPlacement","getTextPlacement","hasDataDrivenText","textMaterial","encodeAttributes","_storePlacedGlyphs","shapes","angle","cos","sin","hasDataDrivenIcon","iconMaterial","_addPlacedIcons","VIEWPORT","minzoom","maxzoom","tl","tr","bl","br","mosaicRect","labelAngle","minAngle","has","get","set","symbolInstance","ddAttributes","glyphAnchor","xmin","ymin","xmax","ymax","placementLod","distance","round","sqrt","atan2","_deviation","segment","isEqual","deviation","distToAnchor","shift","sub","normalize","assignSub","isNaN","default"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport e from\"../../../../../core/BidiEngine.js\";import{numericHash as t}from\"../../../../../core/string.js\";import{BucketType as n}from\"../enums.js\";import{C_DEG_TO_RAD as i,log2 as s,interpolate as a}from\"../GeometryUtils.js\";import{TILE_PIXEL_RATIO as o,Anchor as r,TILE_COORD_SIZE as l}from\"../Placement.js\";import{SDF_GLYPH_SIZE as h,TextShaping as x}from\"../TextShaping.js\";import c from\"./BaseBucket.js\";import{TextTransform as d,SymbolPlacement as f,TextWritingMode as g,SymbolAnchor as y,TextJustification as m,RotationAlignment as u}from\"../style/StyleDefinition.js\";import{IconLayout as p,TextLayout as _}from\"../style/StyleLayer.js\";import{GeometryType as M,Point as P}from\"../../webgl/Geometry.js\";const I=10;function b(e,t){return e.iconMosaicItem&&t.iconMosaicItem?e.iconMosaicItem.page===t.iconMosaicItem.page?0:e.iconMosaicItem.page-t.iconMosaicItem.page:e.iconMosaicItem&&!t.iconMosaicItem?1:!e.iconMosaicItem&&t.iconMosaicItem?-1:0}class A extends c{constructor(e,t,i,s,a,o,r,l){super(e,t,l.getSpriteItems()),this.type=n.SYMBOL,this._markerMap=new Map,this._glyphMap=new Map,this._glyphBufferDataStorage=new Map,this._isIconSDF=!1,this._iconVertexBuffer=i,this._iconIndexBuffer=s,this._textVertexBuffer=a,this._textIndexBuffer=o,this._placementEngine=r,this._workerTileHandler=l}get markerPageMap(){return this._markerMap}get glyphsPageMap(){return this._glyphMap}get symbolInstances(){return this._symbolInstances}getResources(e,n,i){const s=this.layer,a=this.zoom;e&&e.setExtent(this.layerExtent);const o=s.getLayoutProperty(\"icon-image\"),r=s.getLayoutProperty(\"text-field\");let l=s.getLayoutProperty(\"text-transform\"),h=s.getLayoutProperty(\"text-font\");const x=[];let c,f,g,y;o&&!o.isDataDriven&&(c=o.getValue(a)),r&&!r.isDataDriven&&(f=r.getValue(a)),l&&l.isDataDriven||(g=s.getLayoutValue(\"text-transform\",a),l=null),h&&h.isDataDriven||(y=s.getLayoutValue(\"text-font\",a),h=null);for(const m of this._features){const u=m.getGeometry(e);if(!u||0===u.length)continue;let p,_;o&&(p=o.isDataDriven?o.getValue(a,m):this._replaceKeys(c,m.values),p&&n(p));let M=!1;if(r&&(_=r.isDataDriven?r.getValue(a,m):this._replaceKeys(f,m.values),_)){switch(_=_.replace(/\\\\n/g,\"\\n\"),l&&(g=l.getValue(a,m)),g){case d.LOWERCASE:_=_.toLowerCase();break;case d.UPPERCASE:_=_.toUpperCase()}if(A._bidiEngine.hasBidiChar(_)){let e;e=\"rtl\"===A._bidiEngine.checkContextual(_)?\"IDNNN\":\"ICNNN\",_=A._bidiEngine.bidiTransform(_,e,\"VLYSN\"),M=!0}const e=_.length;if(e>0){h&&(y=h.getValue(a,m));for(const t of y){let n=i[t];n||(n=i[t]=new Set);for(let t=0;t<e;t++){const e=_.charCodeAt(t);n.add(e)}}}}if(!p&&!_)continue;const P=s.getLayoutValue(\"symbol-sort-key\",a,m),I={feature:m,sprite:p,label:_,rtl:M,geometry:u,hash:(_?t(_):0)^(p?t(p):0),priority:P,textFont:y};x.push(I)}this._symbolFeatures=x}processFeatures(e){e&&e.setExtent(this.layerExtent);const t=this.layer,n=this.zoom,s=t.getLayoutValue(\"symbol-placement\",n),a=s!==f.POINT,c=t.getLayoutValue(\"symbol-spacing\",n)*o,d=t.getLayoutProperty(\"icon-image\"),P=t.getLayoutProperty(\"text-field\"),I=d?new p(t,n,a):null,L=P?new _(t,n,a):null,V=this._workerTileHandler;let T;d&&(T=V.getSpriteItems()),this._iconIndexStart=3*this._iconIndexBuffer.index,this._textIndexStart=3*this._textIndexBuffer.index,this._iconIndexCount=0,this._textIndexCount=0,this._markerMap.clear(),this._glyphMap.clear();const w=[];let B=1;L&&L.size&&(B=L.size/h);const C=L?L.maxAngle*i:0,R=L?L.size*o:0;for(const i of this._symbolFeatures){let e;I&&T&&i.sprite&&(e=T[i.sprite],e&&e.sdf&&(this._isIconSDF=!0));let t;!!e&&I.update(n,i.feature);let d=0;const p=i.label;if(p){L.update(n,i.feature);const e=a?L.keepUpright:L.writingMode&&L.writingMode.indexOf(g.VERTICAL)>=0;let s=.5;switch(L.anchor){case y.TOP_LEFT:case y.LEFT:case y.BOTTOM_LEFT:s=0;break;case y.TOP_RIGHT:case y.RIGHT:case y.BOTTOM_RIGHT:s=1}let r=.5;switch(L.anchor){case y.TOP_LEFT:case y.TOP:case y.TOP_RIGHT:r=0;break;case y.BOTTOM_LEFT:case y.BOTTOM:case y.BOTTOM_RIGHT:r=1}let l=.5;switch(L.justify){case m.AUTO:l=s;break;case m.LEFT:l=0;break;case m.RIGHT:l=1}const c=L.letterSpacing*h,f=a?0:L.maxWidth*h,u=L.lineHeight*h,_=i.textFont.map((e=>V.getGlyphItems(e)));if(t=new x(_,f,u,c,s,r,l).getShaping(p,i.rtl,e),t&&t.length>0){let e=1e30,n=-1e30;for(const i of t)e=Math.min(e,i.x),n=Math.max(n,i.x);d=(n-e+2*h)*B*o}}for(let n of i.geometry){const h=[];if(s===f.LINE){if(t&&t.length>0&&L&&L.size){const e=L.size*o*(2+Math.min(2,4*Math.abs(L.offset[1])));n=A._smoothVertices(n,e)}A._pushAnchors(h,n,c,d)}else s===f.LINE_CENTER?A._pushCenterAnchor(h,n):i.feature.type===M.Polygon?A._pushCentroid(h,n):h.push(new r(n[0].x,n[0].y));for(const s of h){if(s.x<0||s.x>l||s.y<0||s.y>l)continue;if(a&&d>0&&L.rotationAlignment===u.MAP&&!A._honorsTextMaxAngle(n,s,d,C,R))continue;const o={shaping:t,line:n,iconMosaicItem:e,anchor:s,symbolFeature:i,textColliders:[],iconColliders:[],textVertexRanges:[],iconVertexRanges:[]};w.push(o),this._processFeature(o,I,L)}}}w.sort(b),this._addPlacedGlyphs(),this._symbolInstances=w}serialize(){let e=11;e+=this.layerUIDs.length,e+=3*this.markerPageMap.size,e+=3*this.glyphsPageMap.size,e+=A._symbolsSerializationLength(this._symbolInstances),e+=this._iconVertexBuffer.array.length,e+=this._iconIndexBuffer.array.length,e+=this._textVertexBuffer.array.length,e+=this._textIndexBuffer.array.length;const t=new Uint32Array(e),n=new Int32Array(t.buffer),i=new Float32Array(t.buffer);let s=0;t[s++]=this.type,t[s++]=this.layerUIDs.length;for(let a=0;a<this.layerUIDs.length;a++)t[s++]=this.layerUIDs[a];t[s++]=this._isIconSDF?1:0,t[s++]=this.markerPageMap.size;for(const[a,[o,r]]of this.markerPageMap)t[s++]=a,t[s++]=o,t[s++]=r;t[s++]=this.glyphsPageMap.size;for(const[a,[o,r]]of this.glyphsPageMap)t[s++]=a,t[s++]=o,t[s++]=r;t[s++]=this._iconVertexBuffer.index/4,t[s++]=this._textVertexBuffer.index/4,s=A.serializeSymbols(t,n,i,s,this._symbolInstances),t[s++]=this._iconVertexBuffer.array.length;for(let a=0;a<this._iconVertexBuffer.array.length;a++)n[s++]=this._iconVertexBuffer.array[a];t[s++]=this._iconIndexBuffer.array.length;for(let a=0;a<this._iconIndexBuffer.array.length;a++)t[s++]=this._iconIndexBuffer.array[a];t[s++]=this._textVertexBuffer.array.length;for(let a=0;a<this._textVertexBuffer.array.length;a++)n[s++]=this._textVertexBuffer.array[a];t[s++]=this._textIndexBuffer.array.length;for(let a=0;a<this._textIndexBuffer.array.length;a++)t[s++]=this._textIndexBuffer.array[a];return t.buffer}static _symbolsSerializationLength(e){let t=0;t+=1;for(const n of e||[]){t+=4,t+=1;for(const e of n.textColliders)t+=I;for(const e of n.iconColliders)t+=I;t+=1,t+=2*n.textVertexRanges.length,t+=1,t+=2*n.iconVertexRanges.length}return t}static serializeSymbols(e,t,n,i,s){s=s||[],t[i++]=s.length;for(const a of s){t[i++]=a.anchor.x,t[i++]=a.anchor.y,t[i++]=a.symbolFeature.hash,t[i++]=a.symbolFeature.priority,t[i++]=a.textColliders.length+a.iconColliders.length;for(const e of a.textColliders)t[i++]=e.xTile,t[i++]=e.yTile,t[i++]=e.dxPixels,t[i++]=e.dyPixels,t[i++]=e.hard?1:0,t[i++]=e.partIndex,n[i++]=e.minLod,n[i++]=e.maxLod,t[i++]=e.width,t[i++]=e.height;for(const e of a.iconColliders)t[i++]=e.xTile,t[i++]=e.yTile,t[i++]=e.dxPixels,t[i++]=e.dyPixels,t[i++]=e.hard?1:0,t[i++]=e.partIndex,n[i++]=e.minLod,n[i++]=e.maxLod,t[i++]=e.width,t[i++]=e.height;t[i++]=a.textVertexRanges.length;for(const[e,n]of a.textVertexRanges)t[i++]=e,t[i++]=n;t[i++]=a.iconVertexRanges.length;for(const[e,n]of a.iconVertexRanges)t[i++]=e,t[i++]=n}return i}_replaceKeys(e,t){return e.replace(/{([^{}]+)}/g,(function(e,n){return n in t?t[n]:\"\"}))}_processFeature(e,t,n){const{line:i,iconMosaicItem:a,shaping:o,anchor:r}=e,l=this.zoom,h=this.layer,x=!!a;let c=!0;x&&(c=t.optional||!a);const d=o&&o.length>0;let f,g,y=!0;if(d&&(y=n.optional),x&&(f=this._placementEngine.getIconPlacement(r,a,t)),(f||c)&&(d&&(g=this._placementEngine.getTextPlacement(r,o,i,n)),g||y)){if(f&&g||(y||c?y||g?c||f||(g=null):f=null:(f=null,g=null)),g){const t=h.hasDataDrivenText?h.textMaterial.encodeAttributes(e.symbolFeature.feature,l,h):null;if(this._storePlacedGlyphs(e,g.shapes,l,n.rotationAlignment,t),g.textColliders){e.textColliders=g.textColliders;for(const e of g.textColliders){e.minLod=Math.max(l+s(e.minLod),0),e.maxLod=Math.min(l+s(e.maxLod),25);const t=e.angle;if(t){const n=Math.cos(t),i=Math.sin(t),s=e.dxPixels*n-e.dyPixels*i,a=e.dxPixels*i+e.dyPixels*n,o=(e.dxPixels+e.width)*n-e.dyPixels*i,r=(e.dxPixels+e.width)*i+e.dyPixels*n,l=e.dxPixels*n-(e.dyPixels+e.height)*i,h=e.dxPixels*i+(e.dyPixels+e.height)*n,x=(e.dxPixels+e.width)*n-(e.dyPixels+e.height)*i,c=(e.dxPixels+e.width)*i+(e.dyPixels+e.height)*n,d=Math.min(s,o,l,x),f=Math.max(s,o,l,x),g=Math.min(a,r,h,c),y=Math.max(a,r,h,c);e.dxPixels=d,e.dyPixels=g,e.width=f-d,e.height=y-g}}}}if(f){const n=h.hasDataDrivenIcon?h.iconMaterial.encodeAttributes(e.symbolFeature.feature,l,h):null;if(this._addPlacedIcons(e,f.shapes,l,a.page,t.rotationAlignment===u.VIEWPORT,n),f.iconColliders){e.iconColliders=f.iconColliders;for(const e of f.iconColliders){e.minLod=Math.max(l+s(e.minLod),0),e.maxLod=Math.min(l+s(e.maxLod),25);const t=e.angle;if(t){const n=Math.cos(t),i=Math.sin(t),s=e.dxPixels*n-e.dyPixels*i,a=e.dxPixels*i+e.dyPixels*n,o=(e.dxPixels+e.width)*n-e.dyPixels*i,r=(e.dxPixels+e.width)*i+e.dyPixels*n,l=e.dxPixels*n-(e.dyPixels+e.height)*i,h=e.dxPixels*i+(e.dyPixels+e.height)*n,x=(e.dxPixels+e.width)*n-(e.dyPixels+e.height)*i,c=(e.dxPixels+e.width)*i+(e.dyPixels+e.height)*n,d=Math.min(s,o,l,x),f=Math.max(s,o,l,x),g=Math.min(a,r,h,c),y=Math.max(a,r,h,c);e.dxPixels=d,e.dyPixels=g,e.width=f-d,e.height=y-g}}}}}}_addPlacedIcons(e,t,n,i,a,o){const r=Math.max(n-1,0),l=this._iconVertexBuffer,h=this._iconIndexBuffer,x=this._markerMap;for(const c of t){const t=a?0:Math.max(n+s(c.minzoom),r),d=a?25:Math.min(n+s(c.maxzoom),25);if(d<=t)continue;const f=c.tl,g=c.tr,y=c.bl,m=c.br,u=c.mosaicRect,p=c.labelAngle,_=c.minAngle,M=c.maxAngle,P=c.anchor,I=l.index,b=u.x,A=u.y,L=b+u.width,V=A+u.height,T=l.index;l.add(P.x,P.y,f.x,f.y,b,A,p,_,M,t,d,o),l.add(P.x,P.y,g.x,g.y,L,A,p,_,M,t,d,o),l.add(P.x,P.y,y.x,y.y,b,V,p,_,M,t,d,o),l.add(P.x,P.y,m.x,m.y,L,V,p,_,M,t,d,o),e.iconVertexRanges.length>0&&e.iconVertexRanges[0][0]+e.iconVertexRanges[0][1]===T?e.iconVertexRanges[0][1]+=4:e.iconVertexRanges.push([T,4]),h.add(I+0,I+1,I+2),h.add(I+1,I+2,I+3),x.has(i)?x.get(i)[1]+=6:x.set(i,[this._iconIndexStart+this._iconIndexCount,6]),this._iconIndexCount+=6}}_addPlacedGlyphs(){const e=this._textVertexBuffer,t=this._textIndexBuffer,n=this._glyphMap;for(const[i,s]of this._glyphBufferDataStorage)for(const a of s){const s=e.index,o=a.symbolInstance,r=a.ddAttributes,l=e.index;e.add(a.glyphAnchor[0],a.glyphAnchor[1],a.tl[0],a.tl[1],a.xmin,a.ymin,a.labelAngle,a.minAngle,a.maxAngle,a.minLod,a.maxLod,r),e.add(a.glyphAnchor[0],a.glyphAnchor[1],a.tr[0],a.tr[1],a.xmax,a.ymin,a.labelAngle,a.minAngle,a.maxAngle,a.minLod,a.maxLod,r),e.add(a.glyphAnchor[0],a.glyphAnchor[1],a.bl[0],a.bl[1],a.xmin,a.ymax,a.labelAngle,a.minAngle,a.maxAngle,a.minLod,a.maxLod,r),e.add(a.glyphAnchor[0],a.glyphAnchor[1],a.br[0],a.br[1],a.xmax,a.ymax,a.labelAngle,a.minAngle,a.maxAngle,a.minLod,a.maxLod,r),o.textVertexRanges.length>0&&o.textVertexRanges[0][0]+o.textVertexRanges[0][1]===l?o.textVertexRanges[0][1]+=4:o.textVertexRanges.push([l,4]),t.add(s+0,s+1,s+2),t.add(s+1,s+2,s+3),n.has(i)?n.get(i)[1]+=6:n.set(i,[this._textIndexStart+this._textIndexCount,6]),this._textIndexCount+=6}this._glyphBufferDataStorage.clear()}_storePlacedGlyphs(e,t,n,i,a){const o=Math.max(n-1,0),r=i===u.VIEWPORT;let l,h,x,c,d,f,g,y,m,p,_;for(const u of t){if(l=r?0:Math.max(n+s(u.minzoom),o),h=r?25:Math.min(n+s(u.maxzoom),25),h<=l)continue;x=u.tl,c=u.tr,d=u.bl,f=u.br,g=u.labelAngle,y=u.minAngle,m=u.maxAngle,p=u.anchor,_=u.mosaicRect,this._glyphBufferDataStorage.has(u.page)||this._glyphBufferDataStorage.set(u.page,[]);this._glyphBufferDataStorage.get(u.page).push({glyphAnchor:[p.x,p.y],tl:[x.x,x.y],tr:[c.x,c.y],bl:[d.x,d.y],br:[f.x,f.y],xmin:_.x,ymin:_.y,xmax:_.x+_.width,ymax:_.y+_.height,labelAngle:g,minAngle:y,maxAngle:m,minLod:l,maxLod:h,placementLod:o,symbolInstance:e,ddAttributes:a})}}static _pushAnchors(e,t,n,i){n+=i;let s=0;const o=t.length-1;for(let a=0;a<o;a++)s+=P.distance(t[a],t[a+1]);let l=i||n;if(l*=.5,s<=l)return;const h=l/s;let x=0,c=-(n=s/Math.max(Math.round(s/n),1))/2;const d=t.length-1;for(let f=0;f<d;f++){const i=t[f],s=t[f+1],o=s.x-i.x,l=s.y-i.y,d=Math.sqrt(o*o+l*l);let g;for(;c+n<x+d;){c+=n;const t=(c-x)/d,y=a(i.x,s.x,t),m=a(i.y,s.y,t);void 0===g&&(g=Math.atan2(l,o)),e.push(new r(y,m,g,f,h))}x+=d}}static _pushCenterAnchor(e,t){let n=0;const i=t.length-1;for(let a=0;a<i;a++)n+=P.distance(t[a],t[a+1]);const s=n/2;let o=0;const l=t.length-1;for(let h=0;h<l;h++){const n=t[h],i=t[h+1],l=i.x-n.x,x=i.y-n.y,c=Math.sqrt(l*l+x*x);if(s<o+c){const t=(s-o)/c,d=a(n.x,i.x,t),f=a(n.y,i.y,t),g=Math.atan2(x,l);return void e.push(new r(d,f,g,h,0))}o+=c}}static _deviation(e,t,n){const i=(t.x-e.x)*(n.x-t.x)+(t.y-e.y)*(n.y-t.y),s=(t.x-e.x)*(n.y-t.y)-(t.y-e.y)*(n.x-t.x);return Math.atan2(s,i)}static _honorsTextMaxAngle(e,t,n,i,s){let a=0;const o=n/2;let r=new P(t.x,t.y),l=t.segment+1;for(;a>-o;){if(--l,l<0)return!1;a-=P.distance(e[l],r),r=e[l]}a+=P.distance(e[l],e[l+1]);const h=[];let x=0;const c=e.length;for(;a<o;){const t=e[l];let n,o=l;do{if(++o,o===c)return!1;n=e[o]}while(n.isEqual(t));let r,d=o;do{if(++d,d===c)return!1;r=e[d]}while(r.isEqual(n));const f=this._deviation(t,n,r);for(h.push({deviation:f,distToAnchor:a}),x+=f;a-h[0].distToAnchor>s;)x-=h.shift().deviation;if(Math.abs(x)>i)return!1;a+=P.distance(n,r),l=o}return!0}static _smoothVertices(e,t){if(t<=0)return e;let n=e.length;if(n<3)return e;const i=[];let s=0,a=0;i.push(0);for(let g=1;g<n;g++){const t=P.distance(e[g],e[g-1]);t>0&&(s+=t,i.push(s),a++,a!==g&&(e[a]=e[g]))}if(n=a+1,n<3)return e;t=Math.min(t,.2*s);const o=e[0].x,r=e[0].y,l=e[n-1].x,h=e[n-1].y,x=P.sub(e[0],e[1]);x.normalize(),e[0].x+=t*x.x,e[0].y+=t*x.y,x.assignSub(e[n-1],e[n-2]),x.normalize(),e[n-1].x+=t*x.x,e[n-1].y+=t*x.y,i[0]-=t,i[n-1]+=t;const c=[];c.push(new P(o,r));const d=1e-6,f=.5*t;for(let g=1;g<n-1;g++){let s=0,a=0,o=0;for(let n=g-1;n>=0;n--){const r=f+i[n+1]-i[g];if(r<0)break;const l=i[n+1]-i[n],h=i[g]-i[n]<f?1:r/l;if(h<d)break;const x=h*h,c=h*r-.5*x*l,y=h*l/t,m=e[n+1],u=e[n].x-m.x,p=e[n].y-m.y;s+=y/c*(m.x*h*r+.5*x*(r*u-l*m.x)-x*h*l*u/3),a+=y/c*(m.y*h*r+.5*x*(r*p-l*m.y)-x*h*l*p/3),o+=y}for(let r=g+1;r<n;r++){const n=f-i[r-1]+i[g];if(n<0)break;const l=i[r]-i[r-1],h=i[r]-i[g]<f?1:n/l;if(h<d)break;const x=h*h,c=h*n-.5*x*l,y=h*l/t,m=e[r-1],u=e[r].x-m.x,p=e[r].y-m.y;s+=y/c*(m.x*h*n+.5*x*(n*u-l*m.x)-x*h*l*u/3),a+=y/c*(m.y*h*n+.5*x*(n*p-l*m.y)-x*h*l*p/3),o+=y}c.push(new P(s/o,a/o))}return c.push(new P(l,h)),e[0].x=o,e[0].y=r,e[n-1].x=l,e[n-1].y=h,c}static _pushCentroid(e,t){const n=0,i=0,s=4096,a=4096,o=t.length-1;let l=0,h=0,x=0,c=t[0].x,d=t[0].y;c>s&&(c=s),c<n&&(c=n),d>a&&(d=a),d<i&&(d=i);for(let r=1;r<o;r++){let e=t[r].x,o=t[r].y,f=t[r+1].x,g=t[r+1].y;e>s&&(e=s),e<n&&(e=n),o>a&&(o=a),o<i&&(o=i),f>s&&(f=s),f<n&&(f=n),g>a&&(g=a),g<i&&(g=i);const y=(e-c)*(g-d)-(f-c)*(o-d);l+=y*(c+e+f),h+=y*(d+o+g),x+=y}l/=3*x,h/=3*x,isNaN(l)||isNaN(h)||e.push(new r(l,h))}}A._bidiEngine=new e;export{A as default};\n"]},"metadata":{},"sourceType":"module"}