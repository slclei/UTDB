{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../../chunks/tslib.es6.js\";\nimport \"../../../geometry.js\";\nimport t from \"../../../core/Error.js\";\nimport s from \"../../../core/Loadable.js\";\nimport { isSome as r, isNone as o } from \"../../../core/maybe.js\";\nimport { property as p } from \"../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../core/arrayUtils.js\";\nimport \"../../../core/has.js\";\nimport \"../../../core/accessorSupport/ensureType.js\";\nimport { subclass as i } from \"../../../core/accessorSupport/decorators/subclass.js\";\nimport { queryFeatureSetJSON as a, getSpatialReferenceWkid as n, getServerLandingPage as u, getServerConformance as l, getServerCollections as c, getServerOpenApi as d, getCollectionDefinition as m, crsDefault as y, crsPrefix as f } from \"../../ogc/ogcFeatureUtils.js\";\nimport g from \"../../../rest/support/FeatureSet.js\";\nimport h from \"../../../geometry/SpatialReference.js\";\nimport { typeKebabDictionary as S } from \"../../../geometry/support/typeUtils.js\";\nlet v = class extends s {\n  constructor() {\n    super(...arguments), this.featureDefinition = null, this.type = \"ogc-feature\";\n  }\n\n  load(e) {\n    return this.addResolvingPromise(this._loadOGCServices(this.layer, e)), this.when();\n  }\n\n  getFeatureDefinition() {\n    const {\n      featureDefinition: {\n        collection: e,\n        layerDefinition: t,\n        spatialReference: s,\n        supportedCrs: r\n      },\n      layer: {\n        apiKey: o,\n        capabilities: p,\n        customParameters: i\n      }\n    } = this;\n    return {\n      capabilities: p,\n      collection: e,\n      layerDefinition: t,\n      queryParameters: {\n        apiKey: o,\n        customParameters: i\n      },\n      spatialReference: s,\n      supportedCrs: r\n    };\n  }\n\n  queryExtent(e) {\n    let t = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    return null;\n  }\n\n  queryFeatureCount(e) {\n    let t = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    return null;\n  }\n\n  queryFeatures(e) {\n    let t = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    return this.queryFeaturesJSON(e, t).then(e => g.fromJSON(e));\n  }\n\n  queryFeaturesJSON(e) {\n    let t = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    const s = this.getFeatureDefinition();\n    return this.load(t).then(() => a(s, e, t));\n  }\n\n  queryObjectIds(e) {\n    let t = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    return null;\n  }\n\n  serviceSupportsSpatialReference(e) {\n    return !(!e.isWGS84 && !e.isWebMercator) || !!this.featureDefinition.supportedCrs[e.wkid];\n  }\n\n  _conformsToType(e, t) {\n    var s;\n    const r = new RegExp(`^${t}$`, \"i\");\n    return null != (s = e.conformsTo.some(e => r.test(e))) && s;\n  }\n\n  _getCapabilities(e, t) {\n    var s, o, p, i, a, n, u;\n    const l = r(t) ? null == (s = t.components) ? void 0 : s.parameters : null;\n    return {\n      attachment: null,\n      data: {\n        isVersioned: !1,\n        supportsAttachment: !1,\n        supportsM: !1,\n        supportsZ: e\n      },\n      metadata: {\n        supportsAdvancedFieldProperties: !1\n      },\n      operations: {\n        supportsCalculate: !1,\n        supportsTruncate: !1,\n        supportsValidateSql: !1,\n        supportsAdd: !1,\n        supportsDelete: !1,\n        supportsEditing: !1,\n        supportsChangeTracking: !1,\n        supportsQuery: !1,\n        supportsQueryAttachments: !1,\n        supportsResizeAttachments: !1,\n        supportsSync: !1,\n        supportsUpdate: !1,\n        supportsExceedsLimitStatistics: !1\n      },\n      query: {\n        maxRecordCount: null != (o = null != (p = null == l || null == (i = l.limit) || null == (a = i.schema) ? void 0 : a.maximum) ? p : null == l || null == (n = l.limitFeatures) || null == (u = n.schema) ? void 0 : u.maximum) ? o : 5e3,\n        maxRecordCountFactor: void 0,\n        standardMaxRecordCount: void 0,\n        supportsCacheHint: !1,\n        supportsCentroid: !1,\n        supportsDisjointSpatialRelationship: !1,\n        supportsDistance: !1,\n        supportsDistinct: !1,\n        supportsExtent: !1,\n        supportsFormatPBF: !1,\n        supportsGeometryProperties: !1,\n        supportsHavingClause: !1,\n        supportsHistoricMoment: !1,\n        supportsMaxRecordCountFactor: !1,\n        supportsOrderBy: !1,\n        supportsPagination: !1,\n        supportsPercentileStatistics: !1,\n        supportsQuantization: !1,\n        supportsQuantizationEditMode: !1,\n        supportsQueryByOthers: !1,\n        supportsQueryGeometry: !1,\n        supportsResultType: !1,\n        supportsStandardizedQueriesOnly: !1,\n        supportsTopFeaturesQuery: !1,\n        supportsStatistics: !1,\n        supportsSpatialAggregationStatistics: !1,\n        supportedSpatialAggregationStatistics: {\n          envelope: !1,\n          centroid: !1,\n          convexHull: !1\n        },\n        supportsDefaultSpatialReference: !1,\n        supportsCompactGeometry: !1,\n        supportsSqlExpression: !1,\n        tileMaxRecordCount: void 0\n      },\n      queryRelated: {\n        supportsCount: !1,\n        supportsOrderBy: !1,\n        supportsPagination: !1\n      },\n      editing: {\n        supportsDeleteByAnonymous: !1,\n        supportsDeleteByOthers: !1,\n        supportsGeometryUpdate: !1,\n        supportsGlobalId: !1,\n        supportsReturnServiceEditsInSourceSpatialReference: !1,\n        supportsRollbackOnFailure: !1,\n        supportsUpdateByAnonymous: !1,\n        supportsUpdateByOthers: !1,\n        supportsUploadWithItemId: !1,\n        supportsUpdateWithoutM: !1\n      }\n    };\n  }\n\n  _getExtent(e) {\n    var t;\n    const s = null == (t = e.extent) ? void 0 : t.spatial;\n    if (!s) return null;\n    const r = s.bbox[0],\n          o = 4 === r.length,\n          p = r[0],\n          i = r[1],\n          a = o ? void 0 : r[2];\n    return {\n      xmin: p,\n      ymin: i,\n      xmax: o ? r[2] : r[3],\n      ymax: o ? r[3] : r[4],\n      zmin: a,\n      zmax: o ? void 0 : r[5],\n      spatialReference: h.WGS84.toJSON()\n    };\n  }\n\n  _getStorageSpatialReference(e) {\n    var t;\n    const s = null != (t = e.storageCrs) ? t : y,\n          r = n(s);\n    return o(r) ? h.WGS84 : new h({\n      wkid: r\n    });\n  }\n\n  _getSupportedSpatialReferences(e, t) {\n    var s;\n    const r = \"#/crs\",\n          o = null != (s = e.crs) ? s : [y],\n          p = o.includes(r) ? o.filter(e => e !== r).concat(t.crs) : o,\n          i = /^http:\\/\\/www\\.opengis.net\\/def\\/crs\\/epsg\\/.*\\/3785$/i;\n    return p.filter(e => !i.test(e));\n  }\n\n  async _loadOGCServices(e, s) {\n    const o = r(s) ? s.signal : null,\n          {\n      apiKey: p,\n      collectionId: i,\n      customParameters: a,\n      fields: y,\n      geometryType: g,\n      hasZ: h,\n      objectIdField: v,\n      timeInfo: x,\n      url: R\n    } = e,\n          w = {\n      fields: null == y ? void 0 : y.map(e => e.toJSON()),\n      geometryType: S.toJSON(g),\n      hasZ: h,\n      objectIdField: v,\n      timeInfo: null == x ? void 0 : x.toJSON()\n    },\n          C = {\n      apiKey: p,\n      customParameters: a,\n      signal: o\n    },\n          j = await u(R, C),\n          [O, F] = await Promise.all([l(j, C), c(j, C)]);\n    if (!this._conformsToType(O, \"http://www.opengis.net/spec/ogcapi-features-1/1.0/conf/geojson\")) throw new t(\"ogc-feature-layer:no-geojson-support\", \"Server does not support geojson\");\n    const b = F.collections.find(e => e.id === i);\n    if (!b) throw new t(\"ogc-feature-layer:collection-not-found\", \"Server does not contain the named collection\");\n\n    const D = this._conformsToType(O, \"http://www.opengis.net/spec/ogcapi-features-1/1.0/conf/oas30\") ? await d(j, C) : null,\n          P = await m(b, w, C),\n          T = this._getCapabilities(P.hasZ, D),\n          _ = this._getExtent(b),\n          q = this._getStorageSpatialReference(b).toJSON(),\n          E = this._getSupportedSpatialReferences(b, F),\n          G = new RegExp(`^${f}`, \"i\"),\n          I = {};\n\n    for (const t of E) {\n      const e = n(t);\n      r(e) && (I[e] || (I[e] = t.replace(G, \"\")));\n    }\n\n    P.extent = _, this.featureDefinition = {\n      capabilities: T,\n      collection: b,\n      layerDefinition: P,\n      queryParameters: {},\n      spatialReference: q,\n      supportedCrs: I\n    };\n  }\n\n};\ne([p()], v.prototype, \"featureDefinition\", void 0), e([p({\n  constructOnly: !0\n})], v.prototype, \"layer\", void 0), e([p()], v.prototype, \"type\", void 0), v = e([i(\"esri.layers.graphics.sources.OGCFeatureSource\")], v);\nconst x = v;\nexport { v as OGCFeatureSource, x as default };","map":{"version":3,"sources":["D:/Github/CUSP_DataBase/CUSP_DB/src/main/gis/node_modules/@arcgis/core/layers/graphics/sources/OGCFeatureSource.js"],"names":["_","e","t","s","isSome","r","isNone","o","property","p","subclass","i","queryFeatureSetJSON","a","getSpatialReferenceWkid","n","getServerLandingPage","u","getServerConformance","l","getServerCollections","c","getServerOpenApi","d","getCollectionDefinition","m","crsDefault","y","crsPrefix","f","g","h","typeKebabDictionary","S","v","constructor","arguments","featureDefinition","type","load","addResolvingPromise","_loadOGCServices","layer","when","getFeatureDefinition","collection","layerDefinition","spatialReference","supportedCrs","apiKey","capabilities","customParameters","queryParameters","queryExtent","queryFeatureCount","queryFeatures","queryFeaturesJSON","then","fromJSON","queryObjectIds","serviceSupportsSpatialReference","isWGS84","isWebMercator","wkid","_conformsToType","RegExp","conformsTo","some","test","_getCapabilities","components","parameters","attachment","data","isVersioned","supportsAttachment","supportsM","supportsZ","metadata","supportsAdvancedFieldProperties","operations","supportsCalculate","supportsTruncate","supportsValidateSql","supportsAdd","supportsDelete","supportsEditing","supportsChangeTracking","supportsQuery","supportsQueryAttachments","supportsResizeAttachments","supportsSync","supportsUpdate","supportsExceedsLimitStatistics","query","maxRecordCount","limit","schema","maximum","limitFeatures","maxRecordCountFactor","standardMaxRecordCount","supportsCacheHint","supportsCentroid","supportsDisjointSpatialRelationship","supportsDistance","supportsDistinct","supportsExtent","supportsFormatPBF","supportsGeometryProperties","supportsHavingClause","supportsHistoricMoment","supportsMaxRecordCountFactor","supportsOrderBy","supportsPagination","supportsPercentileStatistics","supportsQuantization","supportsQuantizationEditMode","supportsQueryByOthers","supportsQueryGeometry","supportsResultType","supportsStandardizedQueriesOnly","supportsTopFeaturesQuery","supportsStatistics","supportsSpatialAggregationStatistics","supportedSpatialAggregationStatistics","envelope","centroid","convexHull","supportsDefaultSpatialReference","supportsCompactGeometry","supportsSqlExpression","tileMaxRecordCount","queryRelated","supportsCount","editing","supportsDeleteByAnonymous","supportsDeleteByOthers","supportsGeometryUpdate","supportsGlobalId","supportsReturnServiceEditsInSourceSpatialReference","supportsRollbackOnFailure","supportsUpdateByAnonymous","supportsUpdateByOthers","supportsUploadWithItemId","supportsUpdateWithoutM","_getExtent","extent","spatial","bbox","length","xmin","ymin","xmax","ymax","zmin","zmax","WGS84","toJSON","_getStorageSpatialReference","storageCrs","_getSupportedSpatialReferences","crs","includes","filter","concat","signal","collectionId","fields","geometryType","hasZ","objectIdField","timeInfo","x","url","R","w","map","C","j","O","F","Promise","all","b","collections","find","id","D","P","T","q","E","G","I","replace","prototype","constructOnly","OGCFeatureSource","default"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import\"../../../geometry.js\";import t from\"../../../core/Error.js\";import s from\"../../../core/Loadable.js\";import{isSome as r,isNone as o}from\"../../../core/maybe.js\";import{property as p}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/arrayUtils.js\";import\"../../../core/has.js\";import\"../../../core/accessorSupport/ensureType.js\";import{subclass as i}from\"../../../core/accessorSupport/decorators/subclass.js\";import{queryFeatureSetJSON as a,getSpatialReferenceWkid as n,getServerLandingPage as u,getServerConformance as l,getServerCollections as c,getServerOpenApi as d,getCollectionDefinition as m,crsDefault as y,crsPrefix as f}from\"../../ogc/ogcFeatureUtils.js\";import g from\"../../../rest/support/FeatureSet.js\";import h from\"../../../geometry/SpatialReference.js\";import{typeKebabDictionary as S}from\"../../../geometry/support/typeUtils.js\";let v=class extends s{constructor(){super(...arguments),this.featureDefinition=null,this.type=\"ogc-feature\"}load(e){return this.addResolvingPromise(this._loadOGCServices(this.layer,e)),this.when()}getFeatureDefinition(){const{featureDefinition:{collection:e,layerDefinition:t,spatialReference:s,supportedCrs:r},layer:{apiKey:o,capabilities:p,customParameters:i}}=this;return{capabilities:p,collection:e,layerDefinition:t,queryParameters:{apiKey:o,customParameters:i},spatialReference:s,supportedCrs:r}}queryExtent(e,t={}){return null}queryFeatureCount(e,t={}){return null}queryFeatures(e,t={}){return this.queryFeaturesJSON(e,t).then((e=>g.fromJSON(e)))}queryFeaturesJSON(e,t={}){const s=this.getFeatureDefinition();return this.load(t).then((()=>a(s,e,t)))}queryObjectIds(e,t={}){return null}serviceSupportsSpatialReference(e){return!(!e.isWGS84&&!e.isWebMercator)||!!this.featureDefinition.supportedCrs[e.wkid]}_conformsToType(e,t){var s;const r=new RegExp(`^${t}$`,\"i\");return null!=(s=e.conformsTo.some((e=>r.test(e))))&&s}_getCapabilities(e,t){var s,o,p,i,a,n,u;const l=r(t)?null==(s=t.components)?void 0:s.parameters:null;return{attachment:null,data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:e},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:!1,supportsDelete:!1,supportsEditing:!1,supportsChangeTracking:!1,supportsQuery:!1,supportsQueryAttachments:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:!1,supportsExceedsLimitStatistics:!1},query:{maxRecordCount:null!=(o=null!=(p=null==l||null==(i=l.limit)||null==(a=i.schema)?void 0:a.maximum)?p:null==l||null==(n=l.limitFeatures)||null==(u=n.schema)?void 0:u.maximum)?o:5e3,maxRecordCountFactor:void 0,standardMaxRecordCount:void 0,supportsCacheHint:!1,supportsCentroid:!1,supportsDisjointSpatialRelationship:!1,supportsDistance:!1,supportsDistinct:!1,supportsExtent:!1,supportsFormatPBF:!1,supportsGeometryProperties:!1,supportsHavingClause:!1,supportsHistoricMoment:!1,supportsMaxRecordCountFactor:!1,supportsOrderBy:!1,supportsPagination:!1,supportsPercentileStatistics:!1,supportsQuantization:!1,supportsQuantizationEditMode:!1,supportsQueryByOthers:!1,supportsQueryGeometry:!1,supportsResultType:!1,supportsStandardizedQueriesOnly:!1,supportsTopFeaturesQuery:!1,supportsStatistics:!1,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsDefaultSpatialReference:!1,supportsCompactGeometry:!1,supportsSqlExpression:!1,tileMaxRecordCount:void 0},queryRelated:{supportsCount:!1,supportsOrderBy:!1,supportsPagination:!1},editing:{supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsGeometryUpdate:!1,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsUploadWithItemId:!1,supportsUpdateWithoutM:!1}}}_getExtent(e){var t;const s=null==(t=e.extent)?void 0:t.spatial;if(!s)return null;const r=s.bbox[0],o=4===r.length,p=r[0],i=r[1],a=o?void 0:r[2];return{xmin:p,ymin:i,xmax:o?r[2]:r[3],ymax:o?r[3]:r[4],zmin:a,zmax:o?void 0:r[5],spatialReference:h.WGS84.toJSON()}}_getStorageSpatialReference(e){var t;const s=null!=(t=e.storageCrs)?t:y,r=n(s);return o(r)?h.WGS84:new h({wkid:r})}_getSupportedSpatialReferences(e,t){var s;const r=\"#/crs\",o=null!=(s=e.crs)?s:[y],p=o.includes(r)?o.filter((e=>e!==r)).concat(t.crs):o,i=/^http:\\/\\/www\\.opengis.net\\/def\\/crs\\/epsg\\/.*\\/3785$/i;return p.filter((e=>!i.test(e)))}async _loadOGCServices(e,s){const o=r(s)?s.signal:null,{apiKey:p,collectionId:i,customParameters:a,fields:y,geometryType:g,hasZ:h,objectIdField:v,timeInfo:x,url:R}=e,w={fields:null==y?void 0:y.map((e=>e.toJSON())),geometryType:S.toJSON(g),hasZ:h,objectIdField:v,timeInfo:null==x?void 0:x.toJSON()},C={apiKey:p,customParameters:a,signal:o},j=await u(R,C),[O,F]=await Promise.all([l(j,C),c(j,C)]);if(!this._conformsToType(O,\"http://www.opengis.net/spec/ogcapi-features-1/1.0/conf/geojson\"))throw new t(\"ogc-feature-layer:no-geojson-support\",\"Server does not support geojson\");const b=F.collections.find((e=>e.id===i));if(!b)throw new t(\"ogc-feature-layer:collection-not-found\",\"Server does not contain the named collection\");const D=this._conformsToType(O,\"http://www.opengis.net/spec/ogcapi-features-1/1.0/conf/oas30\")?await d(j,C):null,P=await m(b,w,C),T=this._getCapabilities(P.hasZ,D),_=this._getExtent(b),q=this._getStorageSpatialReference(b).toJSON(),E=this._getSupportedSpatialReferences(b,F),G=new RegExp(`^${f}`,\"i\"),I={};for(const t of E){const e=n(t);r(e)&&(I[e]||(I[e]=t.replace(G,\"\")))}P.extent=_,this.featureDefinition={capabilities:T,collection:b,layerDefinition:P,queryParameters:{},spatialReference:q,supportedCrs:I}}};e([p()],v.prototype,\"featureDefinition\",void 0),e([p({constructOnly:!0})],v.prototype,\"layer\",void 0),e([p()],v.prototype,\"type\",void 0),v=e([i(\"esri.layers.graphics.sources.OGCFeatureSource\")],v);const x=v;export{v as OGCFeatureSource,x as default};\n"]},"metadata":{},"sourceType":"module"}