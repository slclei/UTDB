{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../../chunks/tslib.es6.js\";\nimport \"../../../geometry.js\";\nimport t from \"../../../Graphic.js\";\nimport r from \"../../../request.js\";\nimport s from \"../../../TimeExtent.js\";\nimport a from \"../../../core/Error.js\";\nimport i from \"../../../core/has.js\";\nimport { JSONMap as n } from \"../../../core/jsonMap.js\";\nimport o from \"../../../core/Loadable.js\";\nimport { isSome as u, isNone as l } from \"../../../core/maybe.js\";\nimport { setDeepValue as d } from \"../../../core/object.js\";\nimport { debounce as c } from \"../../../core/promiseUtils.js\";\nimport { dataComponents as h } from \"../../../core/urlUtils.js\";\nimport { property as p } from \"../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../core/arrayUtils.js\";\nimport \"../../../core/accessorSupport/ensureType.js\";\nimport { subclass as y } from \"../../../core/accessorSupport/decorators/subclass.js\";\nimport m from \"../../../geometry/Extent.js\";\nimport { fromJSON as f } from \"../../../geometry/support/jsonUtils.js\";\nimport { createDrawingInfo as g } from \"./support/clientSideDefaults.js\";\nimport { unapplyEditsZUnitScaling as R } from \"../../../rest/query/operations/editsZScale.js\";\nimport { processAttachmentQueryResult as F } from \"../../../rest/query/operations/queryAttachments.js\";\nimport b from \"../../../tasks/QueryTask.js\";\nimport q from \"../../../geometry/SpatialReference.js\";\nconst I = new n({\n  originalAndCurrentFeatures: \"original-and-current-features\",\n  none: \"none\"\n});\n\nasync function _(e) {\n  if (\"string\" == typeof e) {\n    const t = h(e);\n    return t || {\n      data: e\n    };\n  }\n\n  return new Promise((t, r) => {\n    const s = new FileReader();\n    s.readAsDataURL(e), s.onload = () => t(h(s.result)), s.onerror = e => r(e);\n  });\n}\n\nconst O = new Set([\"Feature Layer\", \"Table\"]);\nlet S = class extends o {\n  constructor() {\n    super(...arguments), this.type = \"feature-layer\", this.refresh = c(async () => {\n      var e, t;\n      await this.load();\n      const r = null == (e = this.sourceJSON.editingInfo) ? void 0 : e.lastEditDate;\n      if (null == r) return {\n        dataChanged: !0,\n        updates: {}\n      };\n\n      try {\n        await this._fetchService(null);\n      } catch {\n        return {\n          dataChanged: !0,\n          updates: {}\n        };\n      }\n\n      const s = r !== (null == (t = this.sourceJSON.editingInfo) ? void 0 : t.lastEditDate);\n      return {\n        dataChanged: s,\n        updates: s ? {\n          editingInfo: this.sourceJSON.editingInfo,\n          extent: this.sourceJSON.extent\n        } : null\n      };\n    });\n  }\n\n  load(e) {\n    const t = u(e) ? e.signal : null;\n    return this.addResolvingPromise(this._fetchService(this.layer.sourceJSON, t)), Promise.resolve(this);\n  }\n\n  get queryTask() {\n    const {\n      capabilities: {\n        query: {\n          supportsFormatPBF: e\n        }\n      },\n      parsedUrl: t,\n      dynamicDataSource: r,\n      infoFor3D: s,\n      gdbVersion: a,\n      spatialReference: n,\n      fieldsIndex: o\n    } = this.layer,\n          u = i(\"featurelayer-pbf\") && e && l(s) ? \"pbf\" : \"json\";\n    return new b({\n      url: t.path,\n      format: u,\n      fieldsIndex: o,\n      infoFor3D: s,\n      dynamicDataSource: r,\n      gdbVersion: a,\n      sourceSpatialReference: n\n    });\n  }\n\n  async addAttachment(e, t) {\n    await this.load();\n\n    const s = e.attributes[this.layer.objectIdField],\n          a = this.layer.parsedUrl.path + \"/\" + s + \"/addAttachment\",\n          i = this._getLayerRequestOptions(),\n          n = this._getFormDataForAttachment(t, i.query);\n\n    try {\n      const e = await r(a, {\n        body: n\n      });\n      return this._createFeatureEditResult(e.data.addAttachmentResult);\n    } catch (o) {\n      throw this._createAttachmentErrorResult(s, o);\n    }\n  }\n\n  async updateAttachment(e, t, s) {\n    await this.load();\n\n    const a = e.attributes[this.layer.objectIdField],\n          i = this.layer.parsedUrl.path + \"/\" + a + \"/updateAttachment\",\n          n = this._getLayerRequestOptions({\n      query: {\n        attachmentId: t\n      }\n    }),\n          o = this._getFormDataForAttachment(s, n.query);\n\n    try {\n      const e = await r(i, {\n        body: o\n      });\n      return this._createFeatureEditResult(e.data.updateAttachmentResult);\n    } catch (u) {\n      throw this._createAttachmentErrorResult(a, u);\n    }\n  }\n\n  async applyEdits(e, t) {\n    await this.load();\n\n    const s = e.addFeatures.map(this._serializeFeature, this),\n          a = e.updateFeatures.map(this._serializeFeature, this),\n          i = this._getFeatureIds(e.deleteFeatures, null == t ? void 0 : t.globalIdUsed);\n\n    R(s, a, this.layer.spatialReference);\n    const n = [],\n          o = [],\n          u = [...e.deleteAttachments];\n\n    for (const r of e.addAttachments) n.push(await this._serializeAttachment(r));\n\n    for (const r of e.updateAttachments) o.push(await this._serializeAttachment(r));\n\n    const l = n.length || o.length || u.length ? {\n      adds: n,\n      updates: o,\n      deletes: u\n    } : null,\n          d = {\n      gdbVersion: (null == t ? void 0 : t.gdbVersion) || this.layer.gdbVersion,\n      rollbackOnFailure: null == t ? void 0 : t.rollbackOnFailureEnabled,\n      useGlobalIds: null == t ? void 0 : t.globalIdUsed,\n      returnEditMoment: null == t ? void 0 : t.returnEditMoment,\n      usePreviousEditMoment: null == t ? void 0 : t.usePreviousEditMoment,\n      sessionId: null == t ? void 0 : t.sessionId\n    };\n    null != t && t.returnServiceEditsOption ? (d.edits = JSON.stringify([{\n      id: this.layer.layerId,\n      adds: s,\n      updates: a,\n      deletes: i,\n      attachments: l\n    }]), d.returnServiceEditsOption = I.toJSON(null == t ? void 0 : t.returnServiceEditsOption), d.returnServiceEditsInSourceSR = null == t ? void 0 : t.returnServiceEditsInSourceSR) : (d.adds = s.length ? JSON.stringify(s) : null, d.updates = a.length ? JSON.stringify(a) : null, d.deletes = i.length ? null != t && t.globalIdUsed ? JSON.stringify(i) : i.join(\",\") : null, d.attachments = l && JSON.stringify(l));\n\n    const c = this._getLayerRequestOptions({\n      method: \"post\",\n      query: d\n    }),\n          h = null != t && t.returnServiceEditsOption ? this.layer.url : this.layer.parsedUrl.path,\n          p = await r(h + \"/applyEdits\", c);\n\n    return this._createEditsResult(p);\n  }\n\n  async deleteAttachments(e, t) {\n    await this.load();\n    const s = e.attributes[this.layer.objectIdField],\n          a = this.layer.parsedUrl.path + \"/\" + s + \"/deleteAttachments\";\n\n    try {\n      return (await r(a, this._getLayerRequestOptions({\n        query: {\n          attachmentIds: t.join(\",\")\n        },\n        method: \"post\"\n      }))).data.deleteAttachmentResults.map(this._createFeatureEditResult);\n    } catch (i) {\n      throw this._createAttachmentErrorResult(s, i);\n    }\n  }\n\n  fetchRecomputedExtents() {\n    let e = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    const t = e.signal;\n    return this.load({\n      signal: t\n    }).then(async () => {\n      const t = this._getLayerRequestOptions({ ...e,\n        query: {\n          returnUpdates: !0\n        }\n      }),\n            {\n        layerId: a,\n        url: i\n      } = this.layer,\n            {\n        data: n\n      } = await r(`${i}/${a}`, t),\n            {\n        id: o,\n        extent: u,\n        fullExtent: l,\n        timeExtent: d\n      } = n,\n            c = u || l;\n\n      return {\n        id: o,\n        fullExtent: c && m.fromJSON(c),\n        timeExtent: d && s.fromJSON({\n          start: d[0],\n          end: d[1]\n        })\n      };\n    });\n  }\n\n  async queryAttachments(e) {\n    let t = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    const {\n      parsedUrl: s\n    } = this.layer,\n          a = s.path;\n    await this.load();\n\n    const i = this._getLayerRequestOptions(t);\n\n    if (!this.layer.get(\"capabilities.operations.supportsQueryAttachments\")) {\n      const {\n        objectIds: t\n      } = e,\n            s = [];\n\n      for (const e of t) {\n        const t = a + \"/\" + e + \"/attachments\";\n        s.push(r(t, i));\n      }\n\n      return Promise.all(s).then(e => t.map((t, r) => ({\n        parentObjectId: t,\n        attachmentInfos: e[r].data.attachmentInfos\n      }))).then(e => F(e, a));\n    }\n\n    return this.queryTask.executeAttachmentQuery(e, i);\n  }\n\n  async queryFeatures(e, t) {\n    return await this.load(), this.queryTask.execute(e, { ...t,\n      query: this._createRequestQueryOptions(t)\n    });\n  }\n\n  async queryFeaturesJSON(e, t) {\n    return await this.load(), this.queryTask.executeJSON(e, { ...t,\n      query: this._createRequestQueryOptions(t)\n    });\n  }\n\n  async queryObjectIds(e, t) {\n    return await this.load(), this.queryTask.executeForIds(e, { ...t,\n      query: this._createRequestQueryOptions(t)\n    });\n  }\n\n  async queryFeatureCount(e, t) {\n    return await this.load(), this.queryTask.executeForCount(e, { ...t,\n      query: this._createRequestQueryOptions(t)\n    });\n  }\n\n  async queryExtent(e, t) {\n    return await this.load(), this.queryTask.executeForExtent(e, { ...t,\n      query: this._createRequestQueryOptions(t)\n    });\n  }\n\n  async queryRelatedFeatures(e, t) {\n    return await this.load(), this.queryTask.executeRelationshipQuery(e, { ...t,\n      query: this._createRequestQueryOptions(t)\n    });\n  }\n\n  async queryRelatedFeaturesCount(e, t) {\n    return await this.load(), this.queryTask.executeRelationshipQueryForCount(e, { ...t,\n      query: this._createRequestQueryOptions(t)\n    });\n  }\n\n  async queryTopFeatures(e, t) {\n    return await this.load(), this.queryTask.executeTopFeaturesQuery(e, { ...t,\n      query: this._createRequestQueryOptions(t)\n    });\n  }\n\n  async queryTopObjectIds(e, t) {\n    return await this.load(), this.queryTask.executeForTopIds(e, { ...t,\n      query: this._createRequestQueryOptions(t)\n    });\n  }\n\n  async queryTopExtents(e, t) {\n    return await this.load(), this.queryTask.executeForTopExtents(e, { ...t,\n      query: this._createRequestQueryOptions(t)\n    });\n  }\n\n  async queryTopCount(e, t) {\n    return await this.load(), this.queryTask.executeForTopCount(e, { ...t,\n      query: this._createRequestQueryOptions(t)\n    });\n  }\n\n  _createRequestQueryOptions(e) {\n    const t = { ...this.layer.customParameters,\n      token: this.layer.apiKey,\n      ...(null == e ? void 0 : e.query)\n    };\n    return this.layer.datesInUnknownTimezone && (t.timeReferenceUnknownClient = !0), t;\n  }\n\n  async _fetchService(e, t) {\n    if (!e) {\n      const {\n        data: s\n      } = await r(this.layer.parsedUrl.path, this._getLayerRequestOptions({\n        query: i(\"featurelayer-advanced-symbols\") ? {\n          returnAdvancedSymbols: !0\n        } : {},\n        signal: t\n      }));\n      e = s;\n    }\n\n    this.sourceJSON = this._patchServiceJSON(e);\n    const s = e.type;\n    if (!O.has(s)) throw new a(\"feature-layer-source:unsupported-type\", `Source type \"${s}\" is not supported`);\n  }\n\n  _patchServiceJSON(e) {\n    var t;\n\n    if (\"Table\" !== e.type && e.geometryType && (null == e || null == (t = e.drawingInfo) || !t.renderer) && !e.defaultSymbol) {\n      const t = g(e.geometryType).renderer;\n      d(\"drawingInfo.renderer\", t, e);\n    }\n\n    return \"esriGeometryMultiPatch\" === e.geometryType && e.infoFor3D && (e.geometryType = \"mesh\"), e;\n  }\n\n  _serializeFeature(e) {\n    const {\n      geometry: t,\n      attributes: r\n    } = e;\n    return l(t) ? {\n      attributes: r\n    } : \"mesh\" === t.type || \"extent\" === t.type ? null : {\n      geometry: t.toJSON(),\n      attributes: r\n    };\n  }\n\n  async _serializeAttachment(e) {\n    const {\n      feature: t,\n      attachment: r\n    } = e,\n          {\n      globalId: s,\n      name: a,\n      contentType: i,\n      data: n,\n      uploadId: o\n    } = r,\n          u = {\n      globalId: s,\n      parentGlobalId: null,\n      contentType: null,\n      name: null,\n      uploadId: null,\n      data: null\n    };\n    if (t && (u.parentGlobalId = \"attributes\" in t ? t.attributes && t.attributes[this.layer.globalIdField] : t.globalId), o) u.uploadId = o;else if (n) {\n      const e = await _(n);\n      u.contentType = e.mediaType, u.data = e.data, n instanceof File && (u.name = n.name);\n    }\n    return a && (u.name = a), i && (u.contentType = i), u;\n  }\n\n  _getFeatureIds(e, t) {\n    const r = e[0];\n    return r ? this._canUseGlobalIds(t, e) ? this._getGlobalIdsFromFeatureIdentifier(e) : \"objectId\" in r ? this._getObjectIdsFromFeatureIdentifier(e) : this._getIdsFromFeatures(e) : [];\n  }\n\n  _getIdsFromFeatures(e) {\n    const t = this.layer.objectIdField;\n    return e.map(e => e.attributes && e.attributes[t]);\n  }\n\n  _canUseGlobalIds(e, t) {\n    return e && \"globalId\" in t[0];\n  }\n\n  _getObjectIdsFromFeatureIdentifier(e) {\n    return e.map(e => e.objectId);\n  }\n\n  _getGlobalIdsFromFeatureIdentifier(e) {\n    return e.map(e => e.globalId);\n  }\n\n  _createEditsResult(e) {\n    var t;\n    const r = e.data,\n          {\n      layerId: s\n    } = this.layer,\n          a = [];\n    let i = null;\n    if (Array.isArray(r)) for (const u of r) a.push({\n      id: u.id,\n      editedFeatures: u.editedFeatures\n    }), u.id === s && (i = {\n      addResults: u.addResults,\n      updateResults: u.updateResults,\n      deleteResults: u.deleteResults,\n      attachments: u.attachments,\n      editMoment: u.editMoment\n    });else i = r;\n    const n = null == (t = i) ? void 0 : t.attachments,\n          o = {\n      addFeatureResults: i.addResults ? i.addResults.map(this._createFeatureEditResult, this) : [],\n      updateFeatureResults: i.updateResults ? i.updateResults.map(this._createFeatureEditResult, this) : [],\n      deleteFeatureResults: i.deleteResults ? i.deleteResults.map(this._createFeatureEditResult, this) : [],\n      addAttachmentResults: n && n.addResults ? n.addResults.map(this._createFeatureEditResult, this) : [],\n      updateAttachmentResults: n && n.updateResults ? n.updateResults.map(this._createFeatureEditResult, this) : [],\n      deleteAttachmentResults: n && n.deleteResults ? n.deleteResults.map(this._createFeatureEditResult, this) : []\n    };\n\n    if (i.editMoment && (o.editMoment = i.editMoment), a.length > 0) {\n      o.editedFeatureResults = [];\n\n      for (const e of a) {\n        const {\n          adds: t,\n          updates: r,\n          deletes: s,\n          spatialReference: a\n        } = e.editedFeatures,\n              i = a ? new q(a) : null;\n        o.editedFeatureResults.push({\n          layerId: e.id,\n          editedFeatures: {\n            adds: (null == t ? void 0 : t.map(e => this._createEditedFeature(e, i))) || [],\n            updates: (null == r ? void 0 : r.map(e => ({\n              original: this._createEditedFeature(e[0], i),\n              current: this._createEditedFeature(e[1], i)\n            }))) || [],\n            deletes: (null == s ? void 0 : s.map(e => this._createEditedFeature(e, i))) || [],\n            spatialReference: i\n          }\n        });\n      }\n    }\n\n    return o;\n  }\n\n  _createEditedFeature(e, r) {\n    return new t({\n      attributes: e.attributes,\n      geometry: f({ ...e.geometry,\n        spatialReference: r\n      })\n    });\n  }\n\n  _createFeatureEditResult(e) {\n    const t = !0 === e.success ? null : e.error || {\n      code: void 0,\n      description: void 0\n    };\n    return {\n      objectId: e.objectId,\n      globalId: e.globalId,\n      error: t ? new a(\"feature-layer-source:edit-failure\", t.description, {\n        code: t.code\n      }) : null\n    };\n  }\n\n  _createAttachmentErrorResult(e, t) {\n    const r = t.details.messages && t.details.messages[0] || t.message,\n          s = t.details.httpStatus || t.details.messageCode;\n    return {\n      objectId: e,\n      globalId: null,\n      error: new a(\"feature-layer-source:attachment-failure\", r, {\n        code: s\n      })\n    };\n  }\n\n  _getFormDataForAttachment(e, t) {\n    const r = e instanceof FormData ? e : e && e.elements ? new FormData(e) : null;\n    if (r) for (const s in t) {\n      const e = t[s];\n      null != e && (r.set ? r.set(s, e) : r.append(s, e));\n    }\n    return r;\n  }\n\n  _getLayerRequestOptions() {\n    let e = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    const {\n      parsedUrl: t,\n      gdbVersion: r,\n      dynamicDataSource: s\n    } = this.layer;\n    return { ...e,\n      query: {\n        gdbVersion: r,\n        layer: s ? JSON.stringify({\n          source: s\n        }) : void 0,\n        ...t.query,\n        f: \"json\",\n        ...this._createRequestQueryOptions(e)\n      },\n      responseType: \"json\"\n    };\n  }\n\n};\ne([p()], S.prototype, \"type\", void 0), e([p({\n  constructOnly: !0\n})], S.prototype, \"layer\", void 0), e([p({\n  readOnly: !0\n})], S.prototype, \"queryTask\", null), S = e([y(\"esri.layers.graphics.sources.FeatureLayerSource\")], S);\nconst E = S;\nexport { E as default };","map":{"version":3,"sources":["D:/Github/CUSP_DataBase/CUSP_DB/src/main/gis/node_modules/@arcgis/core/layers/graphics/sources/FeatureLayerSource.js"],"names":["_","e","t","r","s","a","i","JSONMap","n","o","isSome","u","isNone","l","setDeepValue","d","debounce","c","dataComponents","h","property","p","subclass","y","m","fromJSON","f","createDrawingInfo","g","unapplyEditsZUnitScaling","R","processAttachmentQueryResult","F","b","q","I","originalAndCurrentFeatures","none","data","Promise","FileReader","readAsDataURL","onload","result","onerror","O","Set","S","constructor","arguments","type","refresh","load","sourceJSON","editingInfo","lastEditDate","dataChanged","updates","_fetchService","extent","signal","addResolvingPromise","layer","resolve","queryTask","capabilities","query","supportsFormatPBF","parsedUrl","dynamicDataSource","infoFor3D","gdbVersion","spatialReference","fieldsIndex","url","path","format","sourceSpatialReference","addAttachment","attributes","objectIdField","_getLayerRequestOptions","_getFormDataForAttachment","body","_createFeatureEditResult","addAttachmentResult","_createAttachmentErrorResult","updateAttachment","attachmentId","updateAttachmentResult","applyEdits","addFeatures","map","_serializeFeature","updateFeatures","_getFeatureIds","deleteFeatures","globalIdUsed","deleteAttachments","addAttachments","push","_serializeAttachment","updateAttachments","length","adds","deletes","rollbackOnFailure","rollbackOnFailureEnabled","useGlobalIds","returnEditMoment","usePreviousEditMoment","sessionId","returnServiceEditsOption","edits","JSON","stringify","id","layerId","attachments","toJSON","returnServiceEditsInSourceSR","join","method","_createEditsResult","attachmentIds","deleteAttachmentResults","fetchRecomputedExtents","then","returnUpdates","fullExtent","timeExtent","start","end","queryAttachments","get","objectIds","all","parentObjectId","attachmentInfos","executeAttachmentQuery","queryFeatures","execute","_createRequestQueryOptions","queryFeaturesJSON","executeJSON","queryObjectIds","executeForIds","queryFeatureCount","executeForCount","queryExtent","executeForExtent","queryRelatedFeatures","executeRelationshipQuery","queryRelatedFeaturesCount","executeRelationshipQueryForCount","queryTopFeatures","executeTopFeaturesQuery","queryTopObjectIds","executeForTopIds","queryTopExtents","executeForTopExtents","queryTopCount","executeForTopCount","customParameters","token","apiKey","datesInUnknownTimezone","timeReferenceUnknownClient","returnAdvancedSymbols","_patchServiceJSON","has","geometryType","drawingInfo","renderer","defaultSymbol","geometry","feature","attachment","globalId","name","contentType","uploadId","parentGlobalId","globalIdField","mediaType","File","_canUseGlobalIds","_getGlobalIdsFromFeatureIdentifier","_getObjectIdsFromFeatureIdentifier","_getIdsFromFeatures","objectId","Array","isArray","editedFeatures","addResults","updateResults","deleteResults","editMoment","addFeatureResults","updateFeatureResults","deleteFeatureResults","addAttachmentResults","updateAttachmentResults","editedFeatureResults","_createEditedFeature","original","current","success","error","code","description","details","messages","message","httpStatus","messageCode","FormData","elements","set","append","source","responseType","prototype","constructOnly","readOnly","E","default"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import\"../../../geometry.js\";import t from\"../../../Graphic.js\";import r from\"../../../request.js\";import s from\"../../../TimeExtent.js\";import a from\"../../../core/Error.js\";import i from\"../../../core/has.js\";import{JSONMap as n}from\"../../../core/jsonMap.js\";import o from\"../../../core/Loadable.js\";import{isSome as u,isNone as l}from\"../../../core/maybe.js\";import{setDeepValue as d}from\"../../../core/object.js\";import{debounce as c}from\"../../../core/promiseUtils.js\";import{dataComponents as h}from\"../../../core/urlUtils.js\";import{property as p}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/arrayUtils.js\";import\"../../../core/accessorSupport/ensureType.js\";import{subclass as y}from\"../../../core/accessorSupport/decorators/subclass.js\";import m from\"../../../geometry/Extent.js\";import{fromJSON as f}from\"../../../geometry/support/jsonUtils.js\";import{createDrawingInfo as g}from\"./support/clientSideDefaults.js\";import{unapplyEditsZUnitScaling as R}from\"../../../rest/query/operations/editsZScale.js\";import{processAttachmentQueryResult as F}from\"../../../rest/query/operations/queryAttachments.js\";import b from\"../../../tasks/QueryTask.js\";import q from\"../../../geometry/SpatialReference.js\";const I=new n({originalAndCurrentFeatures:\"original-and-current-features\",none:\"none\"});async function _(e){if(\"string\"==typeof e){const t=h(e);return t||{data:e}}return new Promise(((t,r)=>{const s=new FileReader;s.readAsDataURL(e),s.onload=()=>t(h(s.result)),s.onerror=e=>r(e)}))}const O=new Set([\"Feature Layer\",\"Table\"]);let S=class extends o{constructor(){super(...arguments),this.type=\"feature-layer\",this.refresh=c((async()=>{var e,t;await this.load();const r=null==(e=this.sourceJSON.editingInfo)?void 0:e.lastEditDate;if(null==r)return{dataChanged:!0,updates:{}};try{await this._fetchService(null)}catch{return{dataChanged:!0,updates:{}}}const s=r!==(null==(t=this.sourceJSON.editingInfo)?void 0:t.lastEditDate);return{dataChanged:s,updates:s?{editingInfo:this.sourceJSON.editingInfo,extent:this.sourceJSON.extent}:null}}))}load(e){const t=u(e)?e.signal:null;return this.addResolvingPromise(this._fetchService(this.layer.sourceJSON,t)),Promise.resolve(this)}get queryTask(){const{capabilities:{query:{supportsFormatPBF:e}},parsedUrl:t,dynamicDataSource:r,infoFor3D:s,gdbVersion:a,spatialReference:n,fieldsIndex:o}=this.layer,u=i(\"featurelayer-pbf\")&&e&&l(s)?\"pbf\":\"json\";return new b({url:t.path,format:u,fieldsIndex:o,infoFor3D:s,dynamicDataSource:r,gdbVersion:a,sourceSpatialReference:n})}async addAttachment(e,t){await this.load();const s=e.attributes[this.layer.objectIdField],a=this.layer.parsedUrl.path+\"/\"+s+\"/addAttachment\",i=this._getLayerRequestOptions(),n=this._getFormDataForAttachment(t,i.query);try{const e=await r(a,{body:n});return this._createFeatureEditResult(e.data.addAttachmentResult)}catch(o){throw this._createAttachmentErrorResult(s,o)}}async updateAttachment(e,t,s){await this.load();const a=e.attributes[this.layer.objectIdField],i=this.layer.parsedUrl.path+\"/\"+a+\"/updateAttachment\",n=this._getLayerRequestOptions({query:{attachmentId:t}}),o=this._getFormDataForAttachment(s,n.query);try{const e=await r(i,{body:o});return this._createFeatureEditResult(e.data.updateAttachmentResult)}catch(u){throw this._createAttachmentErrorResult(a,u)}}async applyEdits(e,t){await this.load();const s=e.addFeatures.map(this._serializeFeature,this),a=e.updateFeatures.map(this._serializeFeature,this),i=this._getFeatureIds(e.deleteFeatures,null==t?void 0:t.globalIdUsed);R(s,a,this.layer.spatialReference);const n=[],o=[],u=[...e.deleteAttachments];for(const r of e.addAttachments)n.push(await this._serializeAttachment(r));for(const r of e.updateAttachments)o.push(await this._serializeAttachment(r));const l=n.length||o.length||u.length?{adds:n,updates:o,deletes:u}:null,d={gdbVersion:(null==t?void 0:t.gdbVersion)||this.layer.gdbVersion,rollbackOnFailure:null==t?void 0:t.rollbackOnFailureEnabled,useGlobalIds:null==t?void 0:t.globalIdUsed,returnEditMoment:null==t?void 0:t.returnEditMoment,usePreviousEditMoment:null==t?void 0:t.usePreviousEditMoment,sessionId:null==t?void 0:t.sessionId};null!=t&&t.returnServiceEditsOption?(d.edits=JSON.stringify([{id:this.layer.layerId,adds:s,updates:a,deletes:i,attachments:l}]),d.returnServiceEditsOption=I.toJSON(null==t?void 0:t.returnServiceEditsOption),d.returnServiceEditsInSourceSR=null==t?void 0:t.returnServiceEditsInSourceSR):(d.adds=s.length?JSON.stringify(s):null,d.updates=a.length?JSON.stringify(a):null,d.deletes=i.length?null!=t&&t.globalIdUsed?JSON.stringify(i):i.join(\",\"):null,d.attachments=l&&JSON.stringify(l));const c=this._getLayerRequestOptions({method:\"post\",query:d}),h=null!=t&&t.returnServiceEditsOption?this.layer.url:this.layer.parsedUrl.path,p=await r(h+\"/applyEdits\",c);return this._createEditsResult(p)}async deleteAttachments(e,t){await this.load();const s=e.attributes[this.layer.objectIdField],a=this.layer.parsedUrl.path+\"/\"+s+\"/deleteAttachments\";try{return(await r(a,this._getLayerRequestOptions({query:{attachmentIds:t.join(\",\")},method:\"post\"}))).data.deleteAttachmentResults.map(this._createFeatureEditResult)}catch(i){throw this._createAttachmentErrorResult(s,i)}}fetchRecomputedExtents(e={}){const t=e.signal;return this.load({signal:t}).then((async()=>{const t=this._getLayerRequestOptions({...e,query:{returnUpdates:!0}}),{layerId:a,url:i}=this.layer,{data:n}=await r(`${i}/${a}`,t),{id:o,extent:u,fullExtent:l,timeExtent:d}=n,c=u||l;return{id:o,fullExtent:c&&m.fromJSON(c),timeExtent:d&&s.fromJSON({start:d[0],end:d[1]})}}))}async queryAttachments(e,t={}){const{parsedUrl:s}=this.layer,a=s.path;await this.load();const i=this._getLayerRequestOptions(t);if(!this.layer.get(\"capabilities.operations.supportsQueryAttachments\")){const{objectIds:t}=e,s=[];for(const e of t){const t=a+\"/\"+e+\"/attachments\";s.push(r(t,i))}return Promise.all(s).then((e=>t.map(((t,r)=>({parentObjectId:t,attachmentInfos:e[r].data.attachmentInfos}))))).then((e=>F(e,a)))}return this.queryTask.executeAttachmentQuery(e,i)}async queryFeatures(e,t){return await this.load(),this.queryTask.execute(e,{...t,query:this._createRequestQueryOptions(t)})}async queryFeaturesJSON(e,t){return await this.load(),this.queryTask.executeJSON(e,{...t,query:this._createRequestQueryOptions(t)})}async queryObjectIds(e,t){return await this.load(),this.queryTask.executeForIds(e,{...t,query:this._createRequestQueryOptions(t)})}async queryFeatureCount(e,t){return await this.load(),this.queryTask.executeForCount(e,{...t,query:this._createRequestQueryOptions(t)})}async queryExtent(e,t){return await this.load(),this.queryTask.executeForExtent(e,{...t,query:this._createRequestQueryOptions(t)})}async queryRelatedFeatures(e,t){return await this.load(),this.queryTask.executeRelationshipQuery(e,{...t,query:this._createRequestQueryOptions(t)})}async queryRelatedFeaturesCount(e,t){return await this.load(),this.queryTask.executeRelationshipQueryForCount(e,{...t,query:this._createRequestQueryOptions(t)})}async queryTopFeatures(e,t){return await this.load(),this.queryTask.executeTopFeaturesQuery(e,{...t,query:this._createRequestQueryOptions(t)})}async queryTopObjectIds(e,t){return await this.load(),this.queryTask.executeForTopIds(e,{...t,query:this._createRequestQueryOptions(t)})}async queryTopExtents(e,t){return await this.load(),this.queryTask.executeForTopExtents(e,{...t,query:this._createRequestQueryOptions(t)})}async queryTopCount(e,t){return await this.load(),this.queryTask.executeForTopCount(e,{...t,query:this._createRequestQueryOptions(t)})}_createRequestQueryOptions(e){const t={...this.layer.customParameters,token:this.layer.apiKey,...null==e?void 0:e.query};return this.layer.datesInUnknownTimezone&&(t.timeReferenceUnknownClient=!0),t}async _fetchService(e,t){if(!e){const{data:s}=await r(this.layer.parsedUrl.path,this._getLayerRequestOptions({query:i(\"featurelayer-advanced-symbols\")?{returnAdvancedSymbols:!0}:{},signal:t}));e=s}this.sourceJSON=this._patchServiceJSON(e);const s=e.type;if(!O.has(s))throw new a(\"feature-layer-source:unsupported-type\",`Source type \"${s}\" is not supported`)}_patchServiceJSON(e){var t;if(\"Table\"!==e.type&&e.geometryType&&(null==e||null==(t=e.drawingInfo)||!t.renderer)&&!e.defaultSymbol){const t=g(e.geometryType).renderer;d(\"drawingInfo.renderer\",t,e)}return\"esriGeometryMultiPatch\"===e.geometryType&&e.infoFor3D&&(e.geometryType=\"mesh\"),e}_serializeFeature(e){const{geometry:t,attributes:r}=e;return l(t)?{attributes:r}:\"mesh\"===t.type||\"extent\"===t.type?null:{geometry:t.toJSON(),attributes:r}}async _serializeAttachment(e){const{feature:t,attachment:r}=e,{globalId:s,name:a,contentType:i,data:n,uploadId:o}=r,u={globalId:s,parentGlobalId:null,contentType:null,name:null,uploadId:null,data:null};if(t&&(u.parentGlobalId=\"attributes\"in t?t.attributes&&t.attributes[this.layer.globalIdField]:t.globalId),o)u.uploadId=o;else if(n){const e=await _(n);u.contentType=e.mediaType,u.data=e.data,n instanceof File&&(u.name=n.name)}return a&&(u.name=a),i&&(u.contentType=i),u}_getFeatureIds(e,t){const r=e[0];return r?this._canUseGlobalIds(t,e)?this._getGlobalIdsFromFeatureIdentifier(e):\"objectId\"in r?this._getObjectIdsFromFeatureIdentifier(e):this._getIdsFromFeatures(e):[]}_getIdsFromFeatures(e){const t=this.layer.objectIdField;return e.map((e=>e.attributes&&e.attributes[t]))}_canUseGlobalIds(e,t){return e&&\"globalId\"in t[0]}_getObjectIdsFromFeatureIdentifier(e){return e.map((e=>e.objectId))}_getGlobalIdsFromFeatureIdentifier(e){return e.map((e=>e.globalId))}_createEditsResult(e){var t;const r=e.data,{layerId:s}=this.layer,a=[];let i=null;if(Array.isArray(r))for(const u of r)a.push({id:u.id,editedFeatures:u.editedFeatures}),u.id===s&&(i={addResults:u.addResults,updateResults:u.updateResults,deleteResults:u.deleteResults,attachments:u.attachments,editMoment:u.editMoment});else i=r;const n=null==(t=i)?void 0:t.attachments,o={addFeatureResults:i.addResults?i.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:i.updateResults?i.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:i.deleteResults?i.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:n&&n.addResults?n.addResults.map(this._createFeatureEditResult,this):[],updateAttachmentResults:n&&n.updateResults?n.updateResults.map(this._createFeatureEditResult,this):[],deleteAttachmentResults:n&&n.deleteResults?n.deleteResults.map(this._createFeatureEditResult,this):[]};if(i.editMoment&&(o.editMoment=i.editMoment),a.length>0){o.editedFeatureResults=[];for(const e of a){const{adds:t,updates:r,deletes:s,spatialReference:a}=e.editedFeatures,i=a?new q(a):null;o.editedFeatureResults.push({layerId:e.id,editedFeatures:{adds:(null==t?void 0:t.map((e=>this._createEditedFeature(e,i))))||[],updates:(null==r?void 0:r.map((e=>({original:this._createEditedFeature(e[0],i),current:this._createEditedFeature(e[1],i)}))))||[],deletes:(null==s?void 0:s.map((e=>this._createEditedFeature(e,i))))||[],spatialReference:i}})}}return o}_createEditedFeature(e,r){return new t({attributes:e.attributes,geometry:f({...e.geometry,spatialReference:r})})}_createFeatureEditResult(e){const t=!0===e.success?null:e.error||{code:void 0,description:void 0};return{objectId:e.objectId,globalId:e.globalId,error:t?new a(\"feature-layer-source:edit-failure\",t.description,{code:t.code}):null}}_createAttachmentErrorResult(e,t){const r=t.details.messages&&t.details.messages[0]||t.message,s=t.details.httpStatus||t.details.messageCode;return{objectId:e,globalId:null,error:new a(\"feature-layer-source:attachment-failure\",r,{code:s})}}_getFormDataForAttachment(e,t){const r=e instanceof FormData?e:e&&e.elements?new FormData(e):null;if(r)for(const s in t){const e=t[s];null!=e&&(r.set?r.set(s,e):r.append(s,e))}return r}_getLayerRequestOptions(e={}){const{parsedUrl:t,gdbVersion:r,dynamicDataSource:s}=this.layer;return{...e,query:{gdbVersion:r,layer:s?JSON.stringify({source:s}):void 0,...t.query,f:\"json\",...this._createRequestQueryOptions(e)},responseType:\"json\"}}};e([p()],S.prototype,\"type\",void 0),e([p({constructOnly:!0})],S.prototype,\"layer\",void 0),e([p({readOnly:!0})],S.prototype,\"queryTask\",null),S=e([y(\"esri.layers.graphics.sources.FeatureLayerSource\")],S);const E=S;export{E as default};\n"]},"metadata":{},"sourceType":"module"}