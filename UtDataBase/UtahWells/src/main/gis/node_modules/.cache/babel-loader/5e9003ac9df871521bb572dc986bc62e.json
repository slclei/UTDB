{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport { b as t, m as s, t as e, r as i } from \"../../../../../../chunks/mat2d.js\";\nimport { c as h, t as n } from \"../../../../../../chunks/mat2df32.js\";\nimport { s as o, t as r } from \"../../../../../../chunks/vec2.js\";\nimport { c as a } from \"../../../../../../chunks/vec2f32.js\";\nimport { VAlign as c } from \"../../alignmentUtils.js\";\nimport { i1616to32 as d } from \"../../number.js\";\nimport f from \"../../Rect.js\";\nimport l from \"../../collisions/BoundingBox.js\";\n\nconst m = 26,\n      u = 4,\n      g = m + u,\n      _ = m - 6,\n      p = 3,\n      x = 8,\n      w = Math.PI / 180;\n\nclass y {\n  constructor(t, s, e, i) {\n    this._rotationT = h(), this._xBounds = 0, this._yBounds = 0, this.minZoom = 0, this.maxZoom = 255, this._bounds = null;\n    const n = e.rect,\n          o = new Float32Array(8);\n    t *= i, s *= i;\n    const r = e.code ? n.width * i : e.metrics.width,\n          a = e.code ? n.height * i : e.metrics.height;\n    o[0] = t, o[1] = s, o[2] = t + r, o[3] = s, o[4] = t, o[5] = s + a, o[6] = t + r, o[7] = s + a, this._data = o, this._setTextureCoords(n), this._scale = i, this._mosaic = e, this.x = t, this.y = s, this.maxOffset = Math.max(t + r, s + a);\n  }\n\n  get width() {\n    return this._mosaic.metrics.width * this._scale;\n  }\n\n  get mosaic() {\n    return this._mosaic;\n  }\n\n  set angle(s) {\n    this._angle = s, t(this._rotationT, -s), this._setOffsets(this._data);\n  }\n\n  get angle() {\n    return this._angle;\n  }\n\n  get xTopLeft() {\n    return this._data[0];\n  }\n\n  get yTopLeft() {\n    return this._data[1];\n  }\n\n  get xBottomRight() {\n    return this._data[6];\n  }\n\n  get yBottomRight() {\n    return this._data[7];\n  }\n\n  get texcoords() {\n    return this._texcoords;\n  }\n\n  get textureBinding() {\n    return this._mosaic.textureBinding;\n  }\n\n  get offsets() {\n    return this._offsets || this._setOffsets(this._data), this._offsets;\n  }\n\n  get char() {\n    return String.fromCharCode(this._mosaic.code);\n  }\n\n  get code() {\n    return this._mosaic.code;\n  }\n\n  get bounds() {\n    if (!this._bounds) {\n      const {\n        height: t,\n        width: e\n      } = this._mosaic.metrics,\n            i = e * this._scale,\n            o = Math.abs(t) * this._scale,\n            r = new Float32Array(8);\n\n      r[0] = this.x, r[1] = this.y, r[2] = this.x + i, r[3] = this.y, r[4] = this.x, r[5] = this.y + o, r[6] = this.x + i, r[7] = this.y + o;\n      const a = s(h(), this._rotationT, this._T);\n      n(r, r, a);\n      let c = 1 / 0,\n          d = 1 / 0,\n          f = 0,\n          m = 0;\n\n      for (let s = 0; s < 4; s++) {\n        const t = r[2 * s],\n              e = r[2 * s + 1];\n        c = Math.min(c, t), d = Math.min(d, e), f = Math.max(f, t), m = Math.max(m, e);\n      }\n\n      const u = f - c,\n            g = m - d,\n            _ = c + u / 2,\n            p = d + g / 2;\n\n      this._bounds = new l(_, p, u, g);\n    }\n\n    return this._bounds;\n  }\n\n  setTransform(t) {\n    this._T = t, this._offsets = null;\n  }\n\n  _setOffsets(t) {\n    this._offsets || (this._offsets = {\n      upperLeft: 0,\n      upperRight: 0,\n      lowerLeft: 0,\n      lowerRight: 0\n    });\n    const e = this._offsets,\n          i = new Float32Array(8),\n          o = s(h(), this._rotationT, this._T);\n    n(i, t, o), e.upperLeft = d(i[0] * x, i[1] * x), e.upperRight = d(i[2] * x, i[3] * x), e.lowerLeft = d(i[4] * x, i[5] * x), e.lowerRight = d(i[6] * x, i[7] * x);\n  }\n\n  _setTextureCoords(_ref) {\n    let {\n      x: t,\n      y: s,\n      width: e,\n      height: i\n    } = _ref;\n    this._texcoords = {\n      upperLeft: d(t, s),\n      upperRight: d(t + e, s),\n      lowerLeft: d(t, s + i),\n      lowerRight: d(t + e, s + i)\n    };\n  }\n\n}\n\nconst M = (t, s) => ({\n  code: 0,\n  page: 0,\n  sdf: !0,\n  rect: new f(0, 0, 11, 8),\n  textureBinding: s,\n  metrics: {\n    advance: 0,\n    height: 4,\n    width: t,\n    left: 0,\n    top: 0\n  }\n});\n\nclass T {\n  constructor(t, s, e) {\n    this._rotation = 0, this._decorate(t, s, e), this.glyphs = t, this.bounds = this._createBounds(t), this.isMultiline = s.length > 1, this._hasRotation = 0 !== e.angle, this._T = this._createGlyphTransform(this.bounds, e);\n\n    for (const i of t) i.setTransform(this._T);\n  }\n\n  setRotation(e) {\n    if (0 === e && 0 === this._rotation) return;\n    this._rotation = e;\n    const i = this._T,\n          n = t(h(), e);\n    s(i, n, i);\n\n    for (const t of this.glyphs) t.setTransform(this._T);\n  }\n\n  _decorate(t, s, e) {\n    if (!e.decoration || \"none\" === e.decoration || !t.length) return;\n    const i = e.scale,\n          h = \"underline\" === e.decoration ? g : _,\n          n = t[0].textureBinding;\n\n    for (const o of s) {\n      const s = o.startX * i,\n            e = o.startY * i,\n            r = (o.width + o.glyphWidthEnd) * i;\n      t.push(new y(s, e + h * i, M(r, n), 1));\n    }\n  }\n\n  get boundsT() {\n    const t = this.bounds,\n          s = o(a(), t.x, t.y);\n\n    if (r(s, s, this._T), this._hasRotation) {\n      const e = Math.max(t.width, t.height);\n      return new l(s[0], s[1], e, e);\n    }\n\n    return new l(s[0], s[1], t.width, t.height);\n  }\n\n  _createBounds(t) {\n    let s = 1 / 0,\n        e = 1 / 0,\n        i = 0,\n        h = 0;\n\n    for (const r of t) s = Math.min(s, r.xTopLeft), e = Math.min(e, r.yTopLeft), i = Math.max(i, r.xTopLeft + r.width), h = Math.max(h, r.yBottomRight);\n\n    const n = i - s,\n          o = h - e;\n    return new l(s + n / 2, e + o / 2, n, o);\n  }\n\n  _createGlyphTransform(t, s) {\n    const n = w * s.angle,\n          r = h(),\n          c = a();\n    return e(r, r, o(c, s.xOffset, -s.yOffset)), s.isCIM ? i(r, r, n) : (e(r, r, o(c, t.x, t.y)), i(r, r, n), e(r, r, o(c, -t.x, -t.y))), r;\n  }\n\n}\n\nclass B {\n  constructor(t, s, e, i, h, n) {\n    this.glyphWidthEnd = 0, this.startX = 0, this.startY = 0, this.start = Math.max(0, Math.min(s, e)), this.end = Math.max(0, Math.max(s, e)), this.end < t.length && (this.glyphWidthEnd = t[this.end].metrics.width), this.width = i, this.yMin = h, this.yMax = n;\n  }\n\n}\n\nconst b = t => 10 === t,\n      R = t => 32 === t;\n\nfunction L(t, s, e) {\n  const i = new Array(),\n        h = 1 / e.scale,\n        n = e.maxLineWidth * h,\n        o = s ? t.length - 1 : 0,\n        r = s ? -1 : t.length,\n        a = s ? -1 : 1;\n  let c = o,\n      d = 0,\n      f = 0,\n      l = c,\n      m = l,\n      u = 0,\n      g = 1 / 0,\n      _ = 0;\n\n  for (; c !== r;) {\n    const {\n      code: s,\n      metrics: e\n    } = t[c],\n          h = Math.abs(e.top);\n    if (b(s) || R(s) || (g = Math.min(g, h), _ = Math.max(_, h + e.height)), b(s)) c !== o && (i.push(new B(t, l, c - a, d, g, _)), g = 1 / 0, _ = 0), d = 0, l = c + a, m = c + a, f = 0;else if (R(s)) m = c + a, f = 0, u = e.advance, d += e.advance;else if (d > n) {\n      if (m !== l) {\n        const s = m - 2 * a;\n        d -= u, i.push(new B(t, l, s, d - f, g, _)), g = 1 / 0, _ = 0, l = m, d = f;\n      } else i.push(new B(t, l, c - a, d, g, _)), g = 1 / 0, _ = 0, l = c, m = c, d = 0;\n\n      d += e.advance, f += e.advance;\n    } else d += e.advance, f += e.advance;\n    c += a;\n  }\n\n  const p = new B(t, l, c - a, d, g, _);\n  return p.start >= 0 && p.end < t.length && i.push(p), i;\n}\n\nfunction v(t, s) {\n  let e = 0;\n\n  for (let n = 0; n < t.length; n++) {\n    const {\n      width: s\n    } = t[n];\n    e = Math.max(s, e);\n  }\n\n  const i = \"underline\" === s.decoration ? u : 0,\n        h = t[0].yMin;\n  return {\n    x: 0,\n    y: h,\n    height: t[t.length - 1].yMax + s.lineHeight * (t.length - 1) + i - h,\n    width: e\n  };\n}\n\nfunction j(t, s, e) {\n  const i = e.scale,\n        h = new Array(),\n        n = L(t, s, e),\n        o = v(n, e),\n        {\n    vAlign: r,\n    hAlign: a\n  } = e,\n        d = r === c.Baseline ? 1 : 0,\n        f = d ? 0 : r - 1,\n        l = (1 - d) * -o.y + f * (o.height / 2) + (d ? 1 : 0) * -m;\n\n  for (let c = 0; c < n.length; c++) {\n    const {\n      start: s,\n      end: o,\n      width: r\n    } = n[c];\n    let d = -1 * (a + 1) * (r / 2) - p;\n    const f = c * e.lineHeight + l - p;\n    n[c].startX = d, n[c].startY = f;\n\n    for (let e = s; e <= o; e++) {\n      const s = t[e];\n      if (b(s.code)) continue;\n      const n = new y(d + s.metrics.left, f - s.metrics.top, s, i);\n      d += s.metrics.advance, h.push(n);\n    }\n  }\n\n  return new T(h, n, e);\n}\n\nexport { y as ShapedGlyph, T as ShapingInfo, j as shapeGlyphs };","map":{"version":3,"sources":["D:/Github/CUSP_DataBase/CUSP_DB/src/main/gis/node_modules/@arcgis/core/views/2d/engine/webgl/mesh/templates/shapingUtils.js"],"names":["b","t","m","s","e","r","i","c","h","n","o","a","VAlign","i1616to32","d","f","l","u","g","_","p","x","w","Math","PI","y","constructor","_rotationT","_xBounds","_yBounds","minZoom","maxZoom","_bounds","rect","Float32Array","code","width","metrics","height","_data","_setTextureCoords","_scale","_mosaic","maxOffset","max","mosaic","angle","_angle","_setOffsets","xTopLeft","yTopLeft","xBottomRight","yBottomRight","texcoords","_texcoords","textureBinding","offsets","_offsets","char","String","fromCharCode","bounds","abs","_T","min","setTransform","upperLeft","upperRight","lowerLeft","lowerRight","M","page","sdf","advance","left","top","T","_rotation","_decorate","glyphs","_createBounds","isMultiline","length","_hasRotation","_createGlyphTransform","setRotation","decoration","scale","startX","startY","glyphWidthEnd","push","boundsT","xOffset","yOffset","isCIM","B","start","end","yMin","yMax","R","L","Array","maxLineWidth","v","lineHeight","j","vAlign","hAlign","Baseline","ShapedGlyph","ShapingInfo","shapeGlyphs"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport{b as t,m as s,t as e,r as i}from\"../../../../../../chunks/mat2d.js\";import{c as h,t as n}from\"../../../../../../chunks/mat2df32.js\";import{s as o,t as r}from\"../../../../../../chunks/vec2.js\";import{c as a}from\"../../../../../../chunks/vec2f32.js\";import{VAlign as c}from\"../../alignmentUtils.js\";import{i1616to32 as d}from\"../../number.js\";import f from\"../../Rect.js\";import l from\"../../collisions/BoundingBox.js\";const m=26,u=4,g=m+u,_=m-6,p=3,x=8,w=Math.PI/180;class y{constructor(t,s,e,i){this._rotationT=h(),this._xBounds=0,this._yBounds=0,this.minZoom=0,this.maxZoom=255,this._bounds=null;const n=e.rect,o=new Float32Array(8);t*=i,s*=i;const r=e.code?n.width*i:e.metrics.width,a=e.code?n.height*i:e.metrics.height;o[0]=t,o[1]=s,o[2]=t+r,o[3]=s,o[4]=t,o[5]=s+a,o[6]=t+r,o[7]=s+a,this._data=o,this._setTextureCoords(n),this._scale=i,this._mosaic=e,this.x=t,this.y=s,this.maxOffset=Math.max(t+r,s+a)}get width(){return this._mosaic.metrics.width*this._scale}get mosaic(){return this._mosaic}set angle(s){this._angle=s,t(this._rotationT,-s),this._setOffsets(this._data)}get angle(){return this._angle}get xTopLeft(){return this._data[0]}get yTopLeft(){return this._data[1]}get xBottomRight(){return this._data[6]}get yBottomRight(){return this._data[7]}get texcoords(){return this._texcoords}get textureBinding(){return this._mosaic.textureBinding}get offsets(){return this._offsets||this._setOffsets(this._data),this._offsets}get char(){return String.fromCharCode(this._mosaic.code)}get code(){return this._mosaic.code}get bounds(){if(!this._bounds){const{height:t,width:e}=this._mosaic.metrics,i=e*this._scale,o=Math.abs(t)*this._scale,r=new Float32Array(8);r[0]=this.x,r[1]=this.y,r[2]=this.x+i,r[3]=this.y,r[4]=this.x,r[5]=this.y+o,r[6]=this.x+i,r[7]=this.y+o;const a=s(h(),this._rotationT,this._T);n(r,r,a);let c=1/0,d=1/0,f=0,m=0;for(let s=0;s<4;s++){const t=r[2*s],e=r[2*s+1];c=Math.min(c,t),d=Math.min(d,e),f=Math.max(f,t),m=Math.max(m,e)}const u=f-c,g=m-d,_=c+u/2,p=d+g/2;this._bounds=new l(_,p,u,g)}return this._bounds}setTransform(t){this._T=t,this._offsets=null}_setOffsets(t){this._offsets||(this._offsets={upperLeft:0,upperRight:0,lowerLeft:0,lowerRight:0});const e=this._offsets,i=new Float32Array(8),o=s(h(),this._rotationT,this._T);n(i,t,o),e.upperLeft=d(i[0]*x,i[1]*x),e.upperRight=d(i[2]*x,i[3]*x),e.lowerLeft=d(i[4]*x,i[5]*x),e.lowerRight=d(i[6]*x,i[7]*x)}_setTextureCoords({x:t,y:s,width:e,height:i}){this._texcoords={upperLeft:d(t,s),upperRight:d(t+e,s),lowerLeft:d(t,s+i),lowerRight:d(t+e,s+i)}}}const M=(t,s)=>({code:0,page:0,sdf:!0,rect:new f(0,0,11,8),textureBinding:s,metrics:{advance:0,height:4,width:t,left:0,top:0}});class T{constructor(t,s,e){this._rotation=0,this._decorate(t,s,e),this.glyphs=t,this.bounds=this._createBounds(t),this.isMultiline=s.length>1,this._hasRotation=0!==e.angle,this._T=this._createGlyphTransform(this.bounds,e);for(const i of t)i.setTransform(this._T)}setRotation(e){if(0===e&&0===this._rotation)return;this._rotation=e;const i=this._T,n=t(h(),e);s(i,n,i);for(const t of this.glyphs)t.setTransform(this._T)}_decorate(t,s,e){if(!e.decoration||\"none\"===e.decoration||!t.length)return;const i=e.scale,h=\"underline\"===e.decoration?g:_,n=t[0].textureBinding;for(const o of s){const s=o.startX*i,e=o.startY*i,r=(o.width+o.glyphWidthEnd)*i;t.push(new y(s,e+h*i,M(r,n),1))}}get boundsT(){const t=this.bounds,s=o(a(),t.x,t.y);if(r(s,s,this._T),this._hasRotation){const e=Math.max(t.width,t.height);return new l(s[0],s[1],e,e)}return new l(s[0],s[1],t.width,t.height)}_createBounds(t){let s=1/0,e=1/0,i=0,h=0;for(const r of t)s=Math.min(s,r.xTopLeft),e=Math.min(e,r.yTopLeft),i=Math.max(i,r.xTopLeft+r.width),h=Math.max(h,r.yBottomRight);const n=i-s,o=h-e;return new l(s+n/2,e+o/2,n,o)}_createGlyphTransform(t,s){const n=w*s.angle,r=h(),c=a();return e(r,r,o(c,s.xOffset,-s.yOffset)),s.isCIM?i(r,r,n):(e(r,r,o(c,t.x,t.y)),i(r,r,n),e(r,r,o(c,-t.x,-t.y))),r}}class B{constructor(t,s,e,i,h,n){this.glyphWidthEnd=0,this.startX=0,this.startY=0,this.start=Math.max(0,Math.min(s,e)),this.end=Math.max(0,Math.max(s,e)),this.end<t.length&&(this.glyphWidthEnd=t[this.end].metrics.width),this.width=i,this.yMin=h,this.yMax=n}}const b=t=>10===t,R=t=>32===t;function L(t,s,e){const i=new Array,h=1/e.scale,n=e.maxLineWidth*h,o=s?t.length-1:0,r=s?-1:t.length,a=s?-1:1;let c=o,d=0,f=0,l=c,m=l,u=0,g=1/0,_=0;for(;c!==r;){const{code:s,metrics:e}=t[c],h=Math.abs(e.top);if(b(s)||R(s)||(g=Math.min(g,h),_=Math.max(_,h+e.height)),b(s))c!==o&&(i.push(new B(t,l,c-a,d,g,_)),g=1/0,_=0),d=0,l=c+a,m=c+a,f=0;else if(R(s))m=c+a,f=0,u=e.advance,d+=e.advance;else if(d>n){if(m!==l){const s=m-2*a;d-=u,i.push(new B(t,l,s,d-f,g,_)),g=1/0,_=0,l=m,d=f}else i.push(new B(t,l,c-a,d,g,_)),g=1/0,_=0,l=c,m=c,d=0;d+=e.advance,f+=e.advance}else d+=e.advance,f+=e.advance;c+=a}const p=new B(t,l,c-a,d,g,_);return p.start>=0&&p.end<t.length&&i.push(p),i}function v(t,s){let e=0;for(let n=0;n<t.length;n++){const{width:s}=t[n];e=Math.max(s,e)}const i=\"underline\"===s.decoration?u:0,h=t[0].yMin;return{x:0,y:h,height:t[t.length-1].yMax+s.lineHeight*(t.length-1)+i-h,width:e}}function j(t,s,e){const i=e.scale,h=new Array,n=L(t,s,e),o=v(n,e),{vAlign:r,hAlign:a}=e,d=r===c.Baseline?1:0,f=d?0:r-1,l=(1-d)*-o.y+f*(o.height/2)+(d?1:0)*-m;for(let c=0;c<n.length;c++){const{start:s,end:o,width:r}=n[c];let d=-1*(a+1)*(r/2)-p;const f=c*e.lineHeight+l-p;n[c].startX=d,n[c].startY=f;for(let e=s;e<=o;e++){const s=t[e];if(b(s.code))continue;const n=new y(d+s.metrics.left,f-s.metrics.top,s,i);d+=s.metrics.advance,h.push(n)}}return new T(h,n,e)}export{y as ShapedGlyph,T as ShapingInfo,j as shapeGlyphs};\n"]},"metadata":{},"sourceType":"module"}