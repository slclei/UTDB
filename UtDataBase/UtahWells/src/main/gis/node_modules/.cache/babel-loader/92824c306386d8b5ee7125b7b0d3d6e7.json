{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport { pt2px as e } from \"../../../../../../core/screenUtils.js\";\nimport t from \"../../VertexStream.js\";\nimport { BlendFactor as r, TargetType as i, DepthStencilTargetType as s, TextureType as o, PixelFormat as a, PixelType as l, TextureWrapMode as n, TextureSamplingMode as u } from \"../../../../../webgl/enums.js\";\nimport { FramebufferObject as h } from \"../../../../../webgl/FramebufferObject.js\";\nimport { Texture as p } from \"../../../../../webgl/Texture.js\";\nconst _ = [1, 0],\n      d = [0, 1];\n\nclass c {\n  constructor() {\n    this._horizontalBlurFBO = null, this._verticalBlurFBO = null, this._size = [0, 0], this._programDesc = {\n      blur: {\n        vsPath: \"post-processing/pp\",\n        fsPath: \"post-processing/blur/gaussianBlur\",\n        attributes: new Map([[\"a_position\", 0]])\n      },\n      composite: {\n        vsPath: \"post-processing/pp\",\n        fsPath: \"post-processing/drop-shadow/composite\",\n        attributes: new Map([[\"a_position\", 0]])\n      },\n      blit: {\n        vsPath: \"post-processing/pp\",\n        fsPath: \"post-processing/blit\",\n        attributes: new Map([[\"a_position\", 0]])\n      }\n    };\n  }\n\n  dispose() {\n    this._layerFBOTexture && (this._layerFBOTexture.dispose(), this._layerFBOTexture = null), this._horizontalBlurFBO && (this._horizontalBlurFBO.dispose(), this._horizontalBlurFBO = null), this._verticalBlurFBO && (this._verticalBlurFBO.dispose(), this._verticalBlurFBO = null);\n  }\n\n  draw(i, s, o) {\n    const {\n      context: a,\n      state: l,\n      painter: n\n    } = i,\n          {\n      materialManager: u\n    } = n,\n          h = this._programDesc,\n          p = s.width,\n          c = s.height,\n          B = [Math.round(p / 2), Math.round(c / 2)],\n          {\n      blurRadius: m,\n      offsetX: T,\n      offsetY: f,\n      color: g\n    } = o,\n          F = [e(T / 2), e(f / 2)];\n\n    this._createOrResizeResources(i, p, c, B);\n\n    const O = this._horizontalBlurFBO,\n          E = this._verticalBlurFBO;\n    a.setStencilWriteMask(0), a.setStencilTestEnabled(!1), a.setDepthWriteEnabled(!1), a.setDepthTestEnabled(!1);\n    const b = this._layerFBOTexture;\n    s.copyToTexture(0, 0, p, c, 0, 0, b), this._quad || (this._quad = new t(a, [-1, -1, 1, -1, -1, 1, 1, 1])), a.setViewport(0, 0, B[0], B[1]);\n    const w = this._quad;\n    w.bind(), a.setBlendingEnabled(!1);\n    const x = u.getProgram(i, h.blur, [{\n      name: \"radius\",\n      value: Math.ceil(m)\n    }]);\n    a.useProgram(x), a.bindFramebuffer(O), a.bindTexture(s.colorTexture, 4), x.setUniform1i(\"u_colorTexture\", 4), x.setUniform2fv(\"u_texSize\", B), x.setUniform2fv(\"u_direction\", _), x.setUniform1f(\"u_sigma\", m), w.draw(), a.bindFramebuffer(E), a.bindTexture(O.colorTexture, 5), x.setUniform1i(\"u_colorTexture\", 5), x.setUniform2fv(\"u_direction\", d), w.draw(), a.bindFramebuffer(s), a.setViewport(0, 0, p, c);\n    const M = u.getProgram(i, h.composite);\n    a.useProgram(M), a.bindTexture(E.colorTexture, 2), M.setUniform1i(\"u_blurTexture\", 2), a.bindTexture(b, 3), M.setUniform1i(\"u_layerFBOTexture\", 3), M.setUniform4fv(\"u_shadowColor\", [g[3] * (g[0] / 255), g[3] * (g[1] / 255), g[3] * (g[2] / 255), g[3]]), M.setUniformMatrix3fv(\"u_displayViewMat3\", l.displayMat3), M.setUniform2fv(\"u_shadowOffset\", F), w.draw(), a.setBlendingEnabled(!0), a.setStencilTestEnabled(!0), a.setBlendFunction(r.ONE, r.ONE_MINUS_SRC_ALPHA), w.unbind();\n  }\n\n  _createOrResizeResources(e, t, r, _) {\n    const {\n      context: d\n    } = e;\n    this._horizontalBlurFBO && this._size[0] === t && this._size[1] === r || (this._size[0] = t, this._size[1] = r, this._horizontalBlurFBO ? this._horizontalBlurFBO.resize(_[0], _[1]) : this._horizontalBlurFBO = new h(d, {\n      colorTarget: i.TEXTURE,\n      depthStencilTarget: s.NONE,\n      width: _[0],\n      height: _[1]\n    }, {\n      target: o.TEXTURE_2D,\n      pixelFormat: a.RGBA,\n      internalFormat: a.RGBA,\n      dataType: l.UNSIGNED_BYTE,\n      wrapMode: n.CLAMP_TO_EDGE,\n      samplingMode: u.LINEAR,\n      flipped: !1,\n      width: _[0],\n      height: _[1]\n    }), this._verticalBlurFBO ? this._verticalBlurFBO.resize(_[0], _[1]) : this._verticalBlurFBO = new h(d, {\n      colorTarget: i.TEXTURE,\n      depthStencilTarget: s.NONE,\n      width: _[0],\n      height: _[1]\n    }, {\n      target: o.TEXTURE_2D,\n      pixelFormat: a.RGBA,\n      internalFormat: a.RGBA,\n      dataType: l.UNSIGNED_BYTE,\n      wrapMode: n.CLAMP_TO_EDGE,\n      samplingMode: u.LINEAR,\n      flipped: !1,\n      width: _[0],\n      height: _[1]\n    }), this._layerFBOTexture ? this._layerFBOTexture.resize(t, r) : this._layerFBOTexture = new p(d, {\n      target: o.TEXTURE_2D,\n      pixelFormat: a.RGBA,\n      internalFormat: a.RGBA,\n      dataType: l.UNSIGNED_BYTE,\n      wrapMode: n.CLAMP_TO_EDGE,\n      samplingMode: u.LINEAR,\n      flipped: !1,\n      width: t,\n      height: r\n    }));\n  }\n\n}\n\nexport { c as DropShadow };","map":{"version":3,"sources":["D:/Github/CUSP_DataBase/CUSP_DB/src/main/gis/node_modules/@arcgis/core/views/2d/engine/webgl/effects/post-processing/DropShadow.js"],"names":["pt2px","e","t","BlendFactor","r","TargetType","i","DepthStencilTargetType","s","TextureType","o","PixelFormat","a","PixelType","l","TextureWrapMode","n","TextureSamplingMode","u","FramebufferObject","h","Texture","p","_","d","c","constructor","_horizontalBlurFBO","_verticalBlurFBO","_size","_programDesc","blur","vsPath","fsPath","attributes","Map","composite","blit","dispose","_layerFBOTexture","draw","context","state","painter","materialManager","width","height","B","Math","round","blurRadius","m","offsetX","T","offsetY","f","color","g","F","_createOrResizeResources","O","E","setStencilWriteMask","setStencilTestEnabled","setDepthWriteEnabled","setDepthTestEnabled","b","copyToTexture","_quad","setViewport","w","bind","setBlendingEnabled","x","getProgram","name","value","ceil","useProgram","bindFramebuffer","bindTexture","colorTexture","setUniform1i","setUniform2fv","setUniform1f","M","setUniform4fv","setUniformMatrix3fv","displayMat3","setBlendFunction","ONE","ONE_MINUS_SRC_ALPHA","unbind","resize","colorTarget","TEXTURE","depthStencilTarget","NONE","target","TEXTURE_2D","pixelFormat","RGBA","internalFormat","dataType","UNSIGNED_BYTE","wrapMode","CLAMP_TO_EDGE","samplingMode","LINEAR","flipped","DropShadow"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport{pt2px as e}from\"../../../../../../core/screenUtils.js\";import t from\"../../VertexStream.js\";import{BlendFactor as r,TargetType as i,DepthStencilTargetType as s,TextureType as o,PixelFormat as a,PixelType as l,TextureWrapMode as n,TextureSamplingMode as u}from\"../../../../../webgl/enums.js\";import{FramebufferObject as h}from\"../../../../../webgl/FramebufferObject.js\";import{Texture as p}from\"../../../../../webgl/Texture.js\";const _=[1,0],d=[0,1];class c{constructor(){this._horizontalBlurFBO=null,this._verticalBlurFBO=null,this._size=[0,0],this._programDesc={blur:{vsPath:\"post-processing/pp\",fsPath:\"post-processing/blur/gaussianBlur\",attributes:new Map([[\"a_position\",0]])},composite:{vsPath:\"post-processing/pp\",fsPath:\"post-processing/drop-shadow/composite\",attributes:new Map([[\"a_position\",0]])},blit:{vsPath:\"post-processing/pp\",fsPath:\"post-processing/blit\",attributes:new Map([[\"a_position\",0]])}}}dispose(){this._layerFBOTexture&&(this._layerFBOTexture.dispose(),this._layerFBOTexture=null),this._horizontalBlurFBO&&(this._horizontalBlurFBO.dispose(),this._horizontalBlurFBO=null),this._verticalBlurFBO&&(this._verticalBlurFBO.dispose(),this._verticalBlurFBO=null)}draw(i,s,o){const{context:a,state:l,painter:n}=i,{materialManager:u}=n,h=this._programDesc,p=s.width,c=s.height,B=[Math.round(p/2),Math.round(c/2)],{blurRadius:m,offsetX:T,offsetY:f,color:g}=o,F=[e(T/2),e(f/2)];this._createOrResizeResources(i,p,c,B);const O=this._horizontalBlurFBO,E=this._verticalBlurFBO;a.setStencilWriteMask(0),a.setStencilTestEnabled(!1),a.setDepthWriteEnabled(!1),a.setDepthTestEnabled(!1);const b=this._layerFBOTexture;s.copyToTexture(0,0,p,c,0,0,b),this._quad||(this._quad=new t(a,[-1,-1,1,-1,-1,1,1,1])),a.setViewport(0,0,B[0],B[1]);const w=this._quad;w.bind(),a.setBlendingEnabled(!1);const x=u.getProgram(i,h.blur,[{name:\"radius\",value:Math.ceil(m)}]);a.useProgram(x),a.bindFramebuffer(O),a.bindTexture(s.colorTexture,4),x.setUniform1i(\"u_colorTexture\",4),x.setUniform2fv(\"u_texSize\",B),x.setUniform2fv(\"u_direction\",_),x.setUniform1f(\"u_sigma\",m),w.draw(),a.bindFramebuffer(E),a.bindTexture(O.colorTexture,5),x.setUniform1i(\"u_colorTexture\",5),x.setUniform2fv(\"u_direction\",d),w.draw(),a.bindFramebuffer(s),a.setViewport(0,0,p,c);const M=u.getProgram(i,h.composite);a.useProgram(M),a.bindTexture(E.colorTexture,2),M.setUniform1i(\"u_blurTexture\",2),a.bindTexture(b,3),M.setUniform1i(\"u_layerFBOTexture\",3),M.setUniform4fv(\"u_shadowColor\",[g[3]*(g[0]/255),g[3]*(g[1]/255),g[3]*(g[2]/255),g[3]]),M.setUniformMatrix3fv(\"u_displayViewMat3\",l.displayMat3),M.setUniform2fv(\"u_shadowOffset\",F),w.draw(),a.setBlendingEnabled(!0),a.setStencilTestEnabled(!0),a.setBlendFunction(r.ONE,r.ONE_MINUS_SRC_ALPHA),w.unbind()}_createOrResizeResources(e,t,r,_){const{context:d}=e;this._horizontalBlurFBO&&this._size[0]===t&&this._size[1]===r||(this._size[0]=t,this._size[1]=r,this._horizontalBlurFBO?this._horizontalBlurFBO.resize(_[0],_[1]):this._horizontalBlurFBO=new h(d,{colorTarget:i.TEXTURE,depthStencilTarget:s.NONE,width:_[0],height:_[1]},{target:o.TEXTURE_2D,pixelFormat:a.RGBA,internalFormat:a.RGBA,dataType:l.UNSIGNED_BYTE,wrapMode:n.CLAMP_TO_EDGE,samplingMode:u.LINEAR,flipped:!1,width:_[0],height:_[1]}),this._verticalBlurFBO?this._verticalBlurFBO.resize(_[0],_[1]):this._verticalBlurFBO=new h(d,{colorTarget:i.TEXTURE,depthStencilTarget:s.NONE,width:_[0],height:_[1]},{target:o.TEXTURE_2D,pixelFormat:a.RGBA,internalFormat:a.RGBA,dataType:l.UNSIGNED_BYTE,wrapMode:n.CLAMP_TO_EDGE,samplingMode:u.LINEAR,flipped:!1,width:_[0],height:_[1]}),this._layerFBOTexture?this._layerFBOTexture.resize(t,r):this._layerFBOTexture=new p(d,{target:o.TEXTURE_2D,pixelFormat:a.RGBA,internalFormat:a.RGBA,dataType:l.UNSIGNED_BYTE,wrapMode:n.CLAMP_TO_EDGE,samplingMode:u.LINEAR,flipped:!1,width:t,height:r}))}}export{c as DropShadow};\n"]},"metadata":{},"sourceType":"module"}