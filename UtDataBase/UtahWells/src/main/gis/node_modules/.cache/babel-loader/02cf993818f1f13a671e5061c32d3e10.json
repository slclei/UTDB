{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport { isArrayLike as e } from \"../../core/arrayUtils.js\";\nimport t from \"../../core/Logger.js\";\nimport { isSome as r } from \"../../core/maybe.js\";\nimport { isUint16Array as i, isUint32Array as s } from \"../../core/typedArrayUtil.js\";\nimport { checkWebGLError as n } from \"./checkWebGLError.js\";\nimport { ContextType as o } from \"./context-util.js\";\nimport { BufferType as f, ResourceType as a, Usage as u, DataType as h } from \"./enums.js\";\n\nconst _ = t.getLogger(\"esri.views.webgl.BufferObject\");\n\nfunction b(t) {\n  return e(t);\n}\n\nclass c {\n  constructor(e, t, r, i) {\n    this._context = e, this.bufferType = t, this.usage = r, this._glName = null, this._size = -1, this._indexType = void 0, e.instanceCounter.increment(a.Buffer, this), this._glName = this._context.gl.createBuffer(), n(this._context.gl), i && this.setData(i);\n  }\n\n  static createIndex(e, t, r) {\n    return new c(e, f.ELEMENT_ARRAY_BUFFER, t, r);\n  }\n\n  static createVertex(e, t, r) {\n    return new c(e, f.ARRAY_BUFFER, t, r);\n  }\n\n  static createUniform(e, t, r) {\n    if (e.type !== o.WEBGL2) throw new Error(\"Uniform buffers are supported in WebGL2 only!\");\n    return new c(e, f.UNIFORM_BUFFER, t, r);\n  }\n\n  static createPixelPack(e) {\n    let t = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : u.STREAM_READ;\n    let r = arguments.length > 2 ? arguments[2] : undefined;\n    if (e.type !== o.WEBGL2) throw new Error(\"Pixel pack buffers are supported in WebGL2 only!\");\n    const i = new c(e, f.PIXEL_PACK_BUFFER, t);\n    return r && i.setSize(r), i;\n  }\n\n  static createPixelUnpack(e) {\n    let t = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : u.STREAM_DRAW;\n    let r = arguments.length > 2 ? arguments[2] : undefined;\n    if (e.type !== o.WEBGL2) throw new Error(\"Pixel unpack buffers are supported in WebGL2 only!\");\n    return new c(e, f.PIXEL_UNPACK_BUFFER, t, r);\n  }\n\n  get glName() {\n    return this._glName;\n  }\n\n  get size() {\n    return this._size;\n  }\n\n  get indexType() {\n    return this._indexType;\n  }\n\n  get byteSize() {\n    return this.bufferType === f.ELEMENT_ARRAY_BUFFER ? this._indexType === h.UNSIGNED_INT ? 4 * this._size : 2 * this._size : this._size;\n  }\n\n  get _isVAOAware() {\n    return this.bufferType === f.ELEMENT_ARRAY_BUFFER || this.bufferType === f.ARRAY_BUFFER;\n  }\n\n  dispose() {\n    var e;\n\n    if (null != (e = this._context) && e.gl) {\n      if (this._glName) {\n        this._context.gl.deleteBuffer(this._glName), this._glName = null;\n      }\n\n      this._context.instanceCounter.decrement(a.Buffer, this), this._context = null;\n    } else this._glName && _.warn(\"Leaked WebGL buffer object\");\n  }\n\n  setSize(e) {\n    let t = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n    if (e <= 0 && _.error(\"Buffer size needs to be positive!\"), this.bufferType === f.ELEMENT_ARRAY_BUFFER && r(t)) switch (this._indexType = t, t) {\n      case h.UNSIGNED_SHORT:\n        e *= 2;\n        break;\n\n      case h.UNSIGNED_INT:\n        e *= 4;\n    }\n\n    this._setBufferData(e);\n  }\n\n  setData(e) {\n    if (!e) return;\n    let t = e.byteLength;\n    this.bufferType === f.ELEMENT_ARRAY_BUFFER && (i(e) && (t /= 2, this._indexType = h.UNSIGNED_SHORT), s(e) && (t /= 4, this._indexType = h.UNSIGNED_INT)), this._setBufferData(t, e);\n  }\n\n  _setBufferData(e) {\n    let t = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n    this._size = e;\n\n    const i = this._context.getBoundVAO();\n\n    this._isVAOAware && this._context.bindVAO(null), this._context.bindBuffer(this);\n    const s = this._context.gl;\n    r(t) ? s.bufferData(this.bufferType, t, this.usage) : s.bufferData(this.bufferType, e, this.usage), n(s), this._isVAOAware && this._context.bindVAO(i);\n  }\n\n  setSubData(e) {\n    let t = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n    let r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n    let o = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : e.byteLength;\n    if (!e) return;\n    (t < 0 || t >= this._size) && _.error(\"offset is out of range!\");\n    let a = t,\n        u = r,\n        h = o,\n        b = e.byteLength;\n    this.bufferType === f.ELEMENT_ARRAY_BUFFER && (i(e) ? (b /= 2, a *= 2, u *= 2, h *= 2) : s(e) && (b /= 4, a *= 4, u *= 4, h *= 4)), void 0 === o && (o = b - 1), r >= o && _.error(\"end must be bigger than start!\"), t + r - o > this._size && _.error(\"An attempt to write beyond the end of the buffer!\");\n\n    const c = this._context.getBoundVAO();\n\n    this._isVAOAware && this._context.bindVAO(null), this._context.bindBuffer(this);\n    const E = this._context.gl,\n          l = ArrayBuffer.isView(e) ? e.buffer : e,\n          d = 0 === u && h === e.byteLength ? l : l.slice(u, h);\n    E.bufferSubData(this.bufferType, a, d), n(E), this._isVAOAware && this._context.bindVAO(c);\n  }\n\n  setSubDataFromView(e, t, r, i) {\n    if (!e) return;\n    (t < 0 || t >= this._size) && _.error(\"offset is out of range!\"), r >= i && _.error(\"end must be bigger than start!\"), t + r - i > this._size && _.error(\"An attempt to write beyond the end of the buffer!\");\n\n    const s = this._context.getBoundVAO();\n\n    this._isVAOAware && this._context.bindVAO(null), this._context.bindBuffer(this);\n    const f = this._context.gl;\n    if (this._context.type === o.WEBGL2) f.bufferSubData(this.bufferType, t * e.BYTES_PER_ELEMENT, e, r, i - r);else {\n      const s = 0 === r && i === e.length ? e : e.subarray(r, i);\n      f.bufferSubData(this.bufferType, t * e.BYTES_PER_ELEMENT, s);\n    }\n    n(f), this._isVAOAware && this._context.bindVAO(s);\n  }\n\n  getSubData(e) {\n    let t = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n    let r = arguments.length > 2 ? arguments[2] : undefined;\n    let i = arguments.length > 3 ? arguments[3] : undefined;\n    if (this._context.type !== o.WEBGL2) return void _.error(\"Get buffer subdata is supported in WebGL2 only!\");\n    if (r < 0 || i < 0) return void _.error(\"Problem getting subdata: offset and length were less than zero!\");\n    const s = b(e) ? e.BYTES_PER_ELEMENT : 1;\n    if (s * ((null != r ? r : 0) + (null != i ? i : 0)) > e.byteLength) return void _.error(\"Problem getting subdata: offset and length exceeded destination size!\");\n    t + s * (null != i ? i : 0) > this.byteSize && _.warn(\"Potential problem getting subdata: requested data exceeds buffer size!\");\n    const n = this._context.gl;\n    this._context.bindBuffer(this, f.COPY_READ_BUFFER), n.getBufferSubData(f.COPY_READ_BUFFER, t, e, r, i), this._context.unbindBuffer(f.COPY_READ_BUFFER);\n  }\n\n  async getSubDataAsync(e) {\n    let t = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n    let r = arguments.length > 2 ? arguments[2] : undefined;\n    let i = arguments.length > 3 ? arguments[3] : undefined;\n    this._context.type === o.WEBGL2 ? (await this._context.clientWaitAsync(), this.getSubData(e, t, r, i)) : _.error(\"Get buffer subdata is supported in WebGL2 only!\");\n  }\n\n}\n\nexport { c as BufferObject };","map":{"version":3,"sources":["D:/Github/CUSP_DataBase/CUSP_DB/src/main/gis/node_modules/@arcgis/core/views/webgl/BufferObject.js"],"names":["isArrayLike","e","t","isSome","r","isUint16Array","i","isUint32Array","s","checkWebGLError","n","ContextType","o","BufferType","f","ResourceType","a","Usage","u","DataType","h","_","getLogger","b","c","constructor","_context","bufferType","usage","_glName","_size","_indexType","instanceCounter","increment","Buffer","gl","createBuffer","setData","createIndex","ELEMENT_ARRAY_BUFFER","createVertex","ARRAY_BUFFER","createUniform","type","WEBGL2","Error","UNIFORM_BUFFER","createPixelPack","STREAM_READ","PIXEL_PACK_BUFFER","setSize","createPixelUnpack","STREAM_DRAW","PIXEL_UNPACK_BUFFER","glName","size","indexType","byteSize","UNSIGNED_INT","_isVAOAware","dispose","deleteBuffer","decrement","warn","error","UNSIGNED_SHORT","_setBufferData","byteLength","getBoundVAO","bindVAO","bindBuffer","bufferData","setSubData","E","l","ArrayBuffer","isView","buffer","d","slice","bufferSubData","setSubDataFromView","BYTES_PER_ELEMENT","length","subarray","getSubData","COPY_READ_BUFFER","getBufferSubData","unbindBuffer","getSubDataAsync","clientWaitAsync","BufferObject"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport{isArrayLike as e}from\"../../core/arrayUtils.js\";import t from\"../../core/Logger.js\";import{isSome as r}from\"../../core/maybe.js\";import{isUint16Array as i,isUint32Array as s}from\"../../core/typedArrayUtil.js\";import{checkWebGLError as n}from\"./checkWebGLError.js\";import{ContextType as o}from\"./context-util.js\";import{BufferType as f,ResourceType as a,Usage as u,DataType as h}from\"./enums.js\";const _=t.getLogger(\"esri.views.webgl.BufferObject\");function b(t){return e(t)}class c{constructor(e,t,r,i){this._context=e,this.bufferType=t,this.usage=r,this._glName=null,this._size=-1,this._indexType=void 0,e.instanceCounter.increment(a.Buffer,this),this._glName=this._context.gl.createBuffer(),n(this._context.gl),i&&this.setData(i)}static createIndex(e,t,r){return new c(e,f.ELEMENT_ARRAY_BUFFER,t,r)}static createVertex(e,t,r){return new c(e,f.ARRAY_BUFFER,t,r)}static createUniform(e,t,r){if(e.type!==o.WEBGL2)throw new Error(\"Uniform buffers are supported in WebGL2 only!\");return new c(e,f.UNIFORM_BUFFER,t,r)}static createPixelPack(e,t=u.STREAM_READ,r){if(e.type!==o.WEBGL2)throw new Error(\"Pixel pack buffers are supported in WebGL2 only!\");const i=new c(e,f.PIXEL_PACK_BUFFER,t);return r&&i.setSize(r),i}static createPixelUnpack(e,t=u.STREAM_DRAW,r){if(e.type!==o.WEBGL2)throw new Error(\"Pixel unpack buffers are supported in WebGL2 only!\");return new c(e,f.PIXEL_UNPACK_BUFFER,t,r)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get byteSize(){return this.bufferType===f.ELEMENT_ARRAY_BUFFER?this._indexType===h.UNSIGNED_INT?4*this._size:2*this._size:this._size}get _isVAOAware(){return this.bufferType===f.ELEMENT_ARRAY_BUFFER||this.bufferType===f.ARRAY_BUFFER}dispose(){var e;if(null!=(e=this._context)&&e.gl){if(this._glName){this._context.gl.deleteBuffer(this._glName),this._glName=null}this._context.instanceCounter.decrement(a.Buffer,this),this._context=null}else this._glName&&_.warn(\"Leaked WebGL buffer object\")}setSize(e,t=null){if(e<=0&&_.error(\"Buffer size needs to be positive!\"),this.bufferType===f.ELEMENT_ARRAY_BUFFER&&r(t))switch(this._indexType=t,t){case h.UNSIGNED_SHORT:e*=2;break;case h.UNSIGNED_INT:e*=4}this._setBufferData(e)}setData(e){if(!e)return;let t=e.byteLength;this.bufferType===f.ELEMENT_ARRAY_BUFFER&&(i(e)&&(t/=2,this._indexType=h.UNSIGNED_SHORT),s(e)&&(t/=4,this._indexType=h.UNSIGNED_INT)),this._setBufferData(t,e)}_setBufferData(e,t=null){this._size=e;const i=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const s=this._context.gl;r(t)?s.bufferData(this.bufferType,t,this.usage):s.bufferData(this.bufferType,e,this.usage),n(s),this._isVAOAware&&this._context.bindVAO(i)}setSubData(e,t=0,r=0,o=e.byteLength){if(!e)return;(t<0||t>=this._size)&&_.error(\"offset is out of range!\");let a=t,u=r,h=o,b=e.byteLength;this.bufferType===f.ELEMENT_ARRAY_BUFFER&&(i(e)?(b/=2,a*=2,u*=2,h*=2):s(e)&&(b/=4,a*=4,u*=4,h*=4)),void 0===o&&(o=b-1),r>=o&&_.error(\"end must be bigger than start!\"),t+r-o>this._size&&_.error(\"An attempt to write beyond the end of the buffer!\");const c=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const E=this._context.gl,l=ArrayBuffer.isView(e)?e.buffer:e,d=0===u&&h===e.byteLength?l:l.slice(u,h);E.bufferSubData(this.bufferType,a,d),n(E),this._isVAOAware&&this._context.bindVAO(c)}setSubDataFromView(e,t,r,i){if(!e)return;(t<0||t>=this._size)&&_.error(\"offset is out of range!\"),r>=i&&_.error(\"end must be bigger than start!\"),t+r-i>this._size&&_.error(\"An attempt to write beyond the end of the buffer!\");const s=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const f=this._context.gl;if(this._context.type===o.WEBGL2)f.bufferSubData(this.bufferType,t*e.BYTES_PER_ELEMENT,e,r,i-r);else{const s=0===r&&i===e.length?e:e.subarray(r,i);f.bufferSubData(this.bufferType,t*e.BYTES_PER_ELEMENT,s)}n(f),this._isVAOAware&&this._context.bindVAO(s)}getSubData(e,t=0,r,i){if(this._context.type!==o.WEBGL2)return void _.error(\"Get buffer subdata is supported in WebGL2 only!\");if(r<0||i<0)return void _.error(\"Problem getting subdata: offset and length were less than zero!\");const s=b(e)?e.BYTES_PER_ELEMENT:1;if(s*((null!=r?r:0)+(null!=i?i:0))>e.byteLength)return void _.error(\"Problem getting subdata: offset and length exceeded destination size!\");t+s*(null!=i?i:0)>this.byteSize&&_.warn(\"Potential problem getting subdata: requested data exceeds buffer size!\");const n=this._context.gl;this._context.bindBuffer(this,f.COPY_READ_BUFFER),n.getBufferSubData(f.COPY_READ_BUFFER,t,e,r,i),this._context.unbindBuffer(f.COPY_READ_BUFFER)}async getSubDataAsync(e,t=0,r,i){this._context.type===o.WEBGL2?(await this._context.clientWaitAsync(),this.getSubData(e,t,r,i)):_.error(\"Get buffer subdata is supported in WebGL2 only!\")}}export{c as BufferObject};\n"]},"metadata":{},"sourceType":"module"}