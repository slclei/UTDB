{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport { isSome as t } from \"../../../../core/maybe.js\";\nimport { isAbortError as e } from \"../../../../core/promiseUtils.js\";\nimport { PlacementEngine as s } from \"./Placement.js\";\nimport r from \"./TileParser.js\";\nimport { TileStatus as i } from \"../../tiling/enums.js\";\n\nclass a {\n  constructor(t, e, r, a) {\n    this.status = i.INITIALIZED, this.placementEngine = new s(), this.tileKey = t, this.refKeys = e, this._workerTileHandler = r, this._styleRepository = a;\n  }\n\n  release() {\n    this.tileKey = \"\", this.refKeys = null, this.status = i.INITIALIZED, this._workerTileHandler = null;\n  }\n\n  async parse(s, r) {\n    const a = r && r.signal;\n\n    if (t(a)) {\n      const t = () => {\n        a.removeEventListener(\"abort\", t), this.status = i.INVALID;\n      };\n\n      a.addEventListener(\"abort\", t);\n    }\n\n    let n;\n    const l = {\n      bucketsWithData: [],\n      emptyBuckets: null\n    };\n\n    try {\n      n = await this._parse(s, r);\n    } catch (y) {\n      if (e(y)) throw y;\n      return {\n        result: l,\n        transferList: []\n      };\n    }\n\n    this.status = i.READY;\n    const o = l.bucketsWithData,\n          u = [];\n\n    for (const t of n) if (t.hasFeatures()) {\n      const e = t.serialize();\n      o.push(e);\n    } else u.push(t.layer.uid);\n\n    const h = [...o];\n    let c = null;\n    return u.length > 0 && (c = Uint32Array.from(u), h.push(c.buffer)), l.emptyBuckets = c, {\n      result: l,\n      transferList: h\n    };\n  }\n\n  setObsolete() {\n    this.status = i.INVALID;\n  }\n\n  getLayers() {\n    return this._workerTileHandler.getLayers();\n  }\n\n  getWorkerTileHandler() {\n    return this._workerTileHandler;\n  }\n\n  async _parse(t, e) {\n    const s = t.sourceName2DataAndRefKey;\n    if (0 === Object.keys(s).length) return [];\n    this.status = i.MODIFIED;\n    return new r(s, this, e.client, this._styleRepository, t.styleLayerUIDs).parse(e);\n  }\n\n}\n\nexport { a as default };","map":{"version":3,"sources":["D:/Github/CUSP_DataBase/CUSP_DB/src/main/gis/node_modules/@arcgis/core/views/2d/engine/vectorTiles/WorkerTile.js"],"names":["isSome","t","isAbortError","e","PlacementEngine","s","r","TileStatus","i","a","constructor","status","INITIALIZED","placementEngine","tileKey","refKeys","_workerTileHandler","_styleRepository","release","parse","signal","removeEventListener","INVALID","addEventListener","n","l","bucketsWithData","emptyBuckets","_parse","y","result","transferList","READY","o","u","hasFeatures","serialize","push","layer","uid","h","c","length","Uint32Array","from","buffer","setObsolete","getLayers","getWorkerTileHandler","sourceName2DataAndRefKey","Object","keys","MODIFIED","client","styleLayerUIDs","default"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport{isSome as t}from\"../../../../core/maybe.js\";import{isAbortError as e}from\"../../../../core/promiseUtils.js\";import{PlacementEngine as s}from\"./Placement.js\";import r from\"./TileParser.js\";import{TileStatus as i}from\"../../tiling/enums.js\";class a{constructor(t,e,r,a){this.status=i.INITIALIZED,this.placementEngine=new s,this.tileKey=t,this.refKeys=e,this._workerTileHandler=r,this._styleRepository=a}release(){this.tileKey=\"\",this.refKeys=null,this.status=i.INITIALIZED,this._workerTileHandler=null}async parse(s,r){const a=r&&r.signal;if(t(a)){const t=()=>{a.removeEventListener(\"abort\",t),this.status=i.INVALID};a.addEventListener(\"abort\",t)}let n;const l={bucketsWithData:[],emptyBuckets:null};try{n=await this._parse(s,r)}catch(y){if(e(y))throw y;return{result:l,transferList:[]}}this.status=i.READY;const o=l.bucketsWithData,u=[];for(const t of n)if(t.hasFeatures()){const e=t.serialize();o.push(e)}else u.push(t.layer.uid);const h=[...o];let c=null;return u.length>0&&(c=Uint32Array.from(u),h.push(c.buffer)),l.emptyBuckets=c,{result:l,transferList:h}}setObsolete(){this.status=i.INVALID}getLayers(){return this._workerTileHandler.getLayers()}getWorkerTileHandler(){return this._workerTileHandler}async _parse(t,e){const s=t.sourceName2DataAndRefKey;if(0===Object.keys(s).length)return[];this.status=i.MODIFIED;return new r(s,this,e.client,this._styleRepository,t.styleLayerUIDs).parse(e)}}export{a as default};\n"]},"metadata":{},"sourceType":"module"}