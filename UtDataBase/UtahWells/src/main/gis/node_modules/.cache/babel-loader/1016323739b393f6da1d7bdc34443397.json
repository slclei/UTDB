{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../chunks/tslib.es6.js\";\nimport t from \"../../request.js\";\nimport r from \"../../core/Error.js\";\nimport \"../../core/has.js\";\nimport i from \"../../core/Logger.js\";\nimport { isSome as o } from \"../../core/maybe.js\";\nimport { debounce as s } from \"../../core/promiseUtils.js\";\nimport { urlToObject as a } from \"../../core/urlUtils.js\";\nimport { property as n } from \"../../core/accessorSupport/decorators/property.js\";\nimport \"../../core/arrayUtils.js\";\nimport \"../../core/accessorSupport/ensureType.js\";\nimport { reader as l } from \"../../core/accessorSupport/decorators/reader.js\";\nimport { subclass as p } from \"../../core/accessorSupport/decorators/subclass.js\";\nimport { writer as d } from \"../../core/accessorSupport/decorators/writer.js\";\nimport { updateOrigins as c } from \"../../core/accessorSupport/originUtils.js\";\nimport u from \"../../geometry/Extent.js\";\nimport m from \"../../geometry/HeightModelInfo.js\";\nimport y from \"../../geometry/SpatialReference.js\";\nimport { titleFromUrlAndName as h, parse as f, cleanTitle as v, sanitizeUrlWithLayerId as S, writeUrlWithLayerId as g } from \"../support/arcgisLayerUrl.js\";\nimport { id as w, url as I } from \"../support/commonProperties.js\";\nimport { fetchIndexInfo as x } from \"../support/I3SIndexInfo.js\";\nimport b from \"../../portal/Portal.js\";\nimport j from \"../../portal/PortalItem.js\";\nimport { saveResources as _ } from \"../../webdoc/support/saveUtils.js\";\n\nconst R = i.getLogger(\"esri.layers.mixins.SceneService\"),\n      A = i => {\n  let A = class extends i {\n    constructor() {\n      super(...arguments), this.spatialReference = null, this.fullExtent = null, this.heightModelInfo = null, this.minScale = 0, this.maxScale = 0, this.version = {\n        major: Number.NaN,\n        minor: Number.NaN,\n        versionString: \"\"\n      }, this.copyright = null, this.sublayerTitleMode = \"item-title\", this.title = null, this.layerId = null, this.indexInfo = null, this._debouncedSaveOperations = s(async (e, t, r) => {\n        switch (e) {\n          case K.SAVE:\n            return this._save(t);\n\n          case K.SAVE_AS:\n            return this._saveAs(r, t);\n        }\n      });\n    }\n\n    readSpatialReference(e, t) {\n      return this._readSpatialReference(t);\n    }\n\n    _readSpatialReference(e) {\n      if (null != e.spatialReference) return y.fromJSON(e.spatialReference);\n      {\n        const t = e.store,\n              r = t.indexCRS || t.geographicCRS,\n              i = r && parseInt(r.substring(r.lastIndexOf(\"/\") + 1, r.length), 10);\n        return null != i ? new y(i) : null;\n      }\n    }\n\n    readFullExtent(e, t, r) {\n      if (null != e && \"object\" == typeof e) {\n        const i = null == e.spatialReference ? { ...e,\n          spatialReference: this._readSpatialReference(t)\n        } : e;\n        return u.fromJSON(i, r);\n      }\n\n      const i = t.store,\n            o = this._readSpatialReference(t);\n\n      return null == o || null == i || null == i.extent || !Array.isArray(i.extent) || i.extent.some(e => e < N) ? null : new u({\n        xmin: i.extent[0],\n        ymin: i.extent[1],\n        xmax: i.extent[2],\n        ymax: i.extent[3],\n        spatialReference: o\n      });\n    }\n\n    parseVersionString(e) {\n      const t = {\n        major: Number.NaN,\n        minor: Number.NaN,\n        versionString: e\n      },\n            r = e.split(\".\");\n      return r.length >= 2 && (t.major = parseInt(r[0], 10), t.minor = parseInt(r[1], 10)), t;\n    }\n\n    readVersion(e, t) {\n      const r = t.store,\n            i = null != r.version ? r.version.toString() : \"\";\n      return this.parseVersionString(i);\n    }\n\n    readTitlePortalItem(e) {\n      return \"item-title\" !== this.sublayerTitleMode ? void 0 : e;\n    }\n\n    readTitleService(e, t) {\n      const r = this.portalItem && this.portalItem.title;\n      if (\"item-title\" === this.sublayerTitleMode) return h(this.url, t.name);\n      let i = t.name;\n\n      if (!i && this.url) {\n        const e = f(this.url);\n        o(e) && (i = e.title);\n      }\n\n      return \"item-title-and-service-name\" === this.sublayerTitleMode && r && (i = r + \" - \" + i), v(i);\n    }\n\n    set url(e) {\n      const t = S({\n        layer: this,\n        url: e,\n        nonStandardUrlAllowed: !1,\n        logger: R\n      });\n      this._set(\"url\", t.url), null != t.layerId && this._set(\"layerId\", t.layerId);\n    }\n\n    writeUrl(e, t, r, i) {\n      g(this, e, \"layers\", t, i);\n    }\n\n    get parsedUrl() {\n      const e = this._get(\"url\");\n\n      if (!e) return null;\n      const t = a(e);\n      return null != this.layerId && (t.path = `${t.path}/layers/${this.layerId}`), t;\n    }\n\n    async _fetchIndexAndUpdateExtent(e, t) {\n      this.indexInfo = x(this.parsedUrl.path, this.rootNode, e, this.apiKey, R, t), null == this.fullExtent || this.fullExtent.hasZ || this._updateExtent(await this.indexInfo);\n    }\n\n    _updateExtent(e) {\n      if (\"page\" === (null == e ? void 0 : e.type)) {\n        var t, i;\n        const o = e.rootIndex % e.pageSize,\n              s = null == (t = e.rootPage) || null == (i = t.nodes) ? void 0 : i[o];\n        if (null == s || null == s.obb || null == s.obb.center || null == s.obb.halfSize) throw new r(\"sceneservice:invalid-node-page\", \"Invalid node page.\");\n        if (s.obb.center[0] < N || null == this.fullExtent || this.fullExtent.hasZ) return;\n        const a = s.obb.halfSize,\n              n = s.obb.center[2],\n              l = Math.sqrt(a[0] * a[0] + a[1] * a[1] + a[2] * a[2]);\n        this.fullExtent.zmin = n - l, this.fullExtent.zmax = n + l;\n      } else if (\"node\" === (null == e ? void 0 : e.type)) {\n        var o;\n        const t = null == (o = e.rootNode) ? void 0 : o.mbs;\n        if (!Array.isArray(t) || 4 !== t.length || t[0] < N) return;\n        const r = t[2],\n              i = t[3];\n        this.fullExtent.zmin = r - i, this.fullExtent.zmax = r + i;\n      }\n    }\n\n    async _fetchService(e) {\n      if (null == this.url) throw new r(\"sceneservice:url-not-set\", \"Scene service can not be loaded without valid portal item or url\");\n\n      if (null == this.layerId && /SceneServer\\/*$/i.test(this.url)) {\n        const t = await this._fetchFirstLayerId(e);\n        null != t && (this.layerId = t);\n      }\n\n      return this._fetchServiceLayer(e);\n    }\n\n    async _fetchFirstLayerId(e) {\n      const r = await t(this.url, {\n        query: {\n          f: \"json\",\n          token: this.apiKey\n        },\n        responseType: \"json\",\n        signal: e\n      });\n      if (r.data && Array.isArray(r.data.layers) && r.data.layers.length > 0) return r.data.layers[0].id;\n    }\n\n    async _fetchServiceLayer(e) {\n      const r = await t(this.parsedUrl.path, {\n        query: {\n          f: \"json\",\n          token: this.apiKey\n        },\n        responseType: \"json\",\n        signal: e\n      });\n      r.ssl && (this.url = this.url.replace(/^http:/i, \"https:\"));\n      let i = !1;\n      if (r.data.layerType && \"Voxel\" === r.data.layerType && (i = !0), i) return this._fetchVoxelServiceLayer();\n      const o = r.data;\n      this.read(o, {\n        origin: \"service\",\n        url: this.parsedUrl\n      }), this.validateLayer(o);\n    }\n\n    async _fetchVoxelServiceLayer(e) {\n      const r = (await t(this.parsedUrl.path + \"/layer\", {\n        query: {\n          f: \"json\",\n          token: this.apiKey\n        },\n        responseType: \"json\",\n        signal: e\n      })).data;\n      this.read(r, {\n        origin: \"service\",\n        url: this.parsedUrl\n      }), this.validateLayer(r);\n    }\n\n    async _ensureLoadBeforeSave() {\n      await this.load(), \"beforeSave\" in this && \"function\" == typeof this.beforeSave && (await this.beforeSave());\n    }\n\n    validateLayer(e) {}\n\n    _updateTypeKeywords(e, t, r) {\n      e.typeKeywords || (e.typeKeywords = []);\n      const i = t.getTypeKeywords();\n\n      for (const o of i) e.typeKeywords.push(o);\n\n      e.typeKeywords && (e.typeKeywords = e.typeKeywords.filter((e, t, r) => r.indexOf(e) === t), r === U.newItem && (e.typeKeywords = e.typeKeywords.filter(e => \"Hosted Service\" !== e)));\n    }\n\n    async _saveAs(e, t) {\n      const i = { ...O,\n        ...t\n      };\n      let o = j.from(e);\n      o || (R.error(\"_saveAs(): requires a portal item parameter\"), await Promise.reject(new r(\"sceneservice:portal-item-required\", \"_saveAs() requires a portal item to save to\"))), o.id && (o = o.clone(), o.id = null);\n      const s = o.portal || b.getDefault();\n      await this._ensureLoadBeforeSave(), o.type = T, o.portal = s;\n      const a = {\n        origin: \"portal-item\",\n        url: null,\n        messages: [],\n        portal: s,\n        portalItem: o,\n        writtenProperties: [],\n        blockedRelativeUrls: [],\n        resources: {\n          toAdd: [],\n          toUpdate: [],\n          toKeep: [],\n          pendingOperations: []\n        }\n      },\n            n = {\n        layers: [this.write({}, a)]\n      };\n      return await Promise.all(a.resources.pendingOperations), await this._validateAgainstJSONSchema(n, a, i), o.url = this.url, o.title || (o.title = this.title), this._updateTypeKeywords(o, i, U.newItem), await s._signIn(), await s.user.addItem({\n        item: o,\n        folder: i && i.folder,\n        data: n\n      }), await _(this.resourceReferences, a, null), this.portalItem = o, c(a), a.portalItem = o, o;\n    }\n\n    async _save(e) {\n      const t = { ...O,\n        ...e\n      };\n      this.portalItem || (R.error(\"_save(): requires the .portalItem property to be set\"), await Promise.reject(new r(\"sceneservice:portal-item-not-set\", \"Portal item to save to has not been set on this SceneService\"))), this.portalItem.type !== T && (R.error(\"_save(): Non-matching portal item type. Got \" + this.portalItem.type + \", expected \" + T), await Promise.reject(new r(\"sceneservice:portal-item-wrong-type\", `Portal item needs to have type \"${T}\"`))), await this._ensureLoadBeforeSave();\n      const i = {\n        origin: \"portal-item\",\n        url: this.portalItem.itemUrl && a(this.portalItem.itemUrl),\n        messages: [],\n        portal: this.portalItem.portal || b.getDefault(),\n        portalItem: this.portalItem,\n        writtenProperties: [],\n        blockedRelativeUrls: [],\n        resources: {\n          toAdd: [],\n          toUpdate: [],\n          toKeep: [],\n          pendingOperations: []\n        }\n      },\n            o = {\n        layers: [this.write({}, i)]\n      };\n      return await Promise.all(i.resources.pendingOperations), await this._validateAgainstJSONSchema(o, i, t), this.portalItem.url = this.url, this.portalItem.title || (this.portalItem.title = this.title), this._updateTypeKeywords(this.portalItem, t, U.existingItem), await this.portalItem.update({\n        data: o\n      }), await _(this.resourceReferences, i, null), c(i), this.portalItem;\n    }\n\n    async _validateAgainstJSONSchema(e, t, i) {\n      let o = t.messages.filter(e => \"error\" === e.type).map(e => new r(e.name, e.message, e.details));\n\n      if (i && i.validationOptions.ignoreUnsupported && (o = o.filter(e => \"layer:unsupported\" !== e.name && \"symbol:unsupported\" !== e.name && \"symbol-layer:unsupported\" !== e.name && \"property:unsupported\" !== e.name && \"url:unsupported\" !== e.name && \"scenemodification:unsupported\" !== e.name)), i.validationOptions.enabled || E) {\n        const t = (await import(\"../support/schemaValidator.js\")).validate(e, i.portalItemLayerType);\n\n        if (t.length > 0) {\n          const e = `Layer item did not validate:\\n${t.join(\"\\n\")}`;\n\n          if (R.error(`_validateAgainstJSONSchema(): ${e}`), \"throw\" === i.validationOptions.failPolicy) {\n            const e = t.map(e => new r(\"sceneservice:schema-validation\", e)).concat(o);\n            throw new r(\"sceneservice-validate:error\", \"Failed to save layer item due to schema validation, see `details.errors`.\", {\n              combined: e\n            });\n          }\n        }\n      }\n\n      if (o.length > 0) throw new r(\"sceneservice:save\", \"Failed to save SceneService due to unsupported or invalid content. See 'details.errors' for more detailed information\", {\n        errors: o\n      });\n    }\n\n  };\n  return e([n(w)], A.prototype, \"id\", void 0), e([n({\n    type: y\n  })], A.prototype, \"spatialReference\", void 0), e([l(\"spatialReference\", [\"spatialReference\", \"store.indexCRS\", \"store.geographicCRS\"])], A.prototype, \"readSpatialReference\", null), e([n({\n    type: u\n  })], A.prototype, \"fullExtent\", void 0), e([l(\"fullExtent\", [\"fullExtent\", \"store.extent\", \"spatialReference\", \"store.indexCRS\", \"store.geographicCRS\"])], A.prototype, \"readFullExtent\", null), e([n({\n    readOnly: !0,\n    type: m\n  })], A.prototype, \"heightModelInfo\", void 0), e([n({\n    type: Number,\n    json: {\n      name: \"layerDefinition.minScale\",\n      write: !0,\n      origins: {\n        service: {\n          read: {\n            source: \"minScale\"\n          },\n          write: !1\n        }\n      }\n    }\n  })], A.prototype, \"minScale\", void 0), e([n({\n    type: Number,\n    json: {\n      name: \"layerDefinition.maxScale\",\n      write: !0,\n      origins: {\n        service: {\n          read: {\n            source: \"maxScale\"\n          },\n          write: !1\n        }\n      }\n    }\n  })], A.prototype, \"maxScale\", void 0), e([n({\n    readOnly: !0\n  })], A.prototype, \"version\", void 0), e([l(\"version\", [\"store.version\"])], A.prototype, \"readVersion\", null), e([n({\n    type: String,\n    json: {\n      read: {\n        source: \"copyrightText\"\n      }\n    }\n  })], A.prototype, \"copyright\", void 0), e([n({\n    type: String,\n    json: {\n      read: !1\n    }\n  })], A.prototype, \"sublayerTitleMode\", void 0), e([n({\n    type: String\n  })], A.prototype, \"title\", void 0), e([l(\"portal-item\", \"title\")], A.prototype, \"readTitlePortalItem\", null), e([l(\"service\", \"title\", [\"name\"])], A.prototype, \"readTitleService\", null), e([n({\n    type: Number,\n    json: {\n      origins: {\n        service: {\n          read: {\n            source: \"id\"\n          }\n        },\n        \"portal-item\": {\n          write: {\n            target: \"id\",\n            isRequired: !0,\n            ignoreOrigin: !0\n          },\n          read: !1\n        }\n      }\n    }\n  })], A.prototype, \"layerId\", void 0), e([n(I)], A.prototype, \"url\", null), e([d(\"url\")], A.prototype, \"writeUrl\", null), e([n()], A.prototype, \"parsedUrl\", null), e([n({\n    readOnly: !0\n  })], A.prototype, \"store\", void 0), e([n({\n    type: String,\n    readOnly: !0,\n    json: {\n      read: {\n        source: \"store.rootNode\"\n      }\n    }\n  })], A.prototype, \"rootNode\", void 0), A = e([p(\"esri.layers.mixins.SceneService\")], A), A;\n},\n      N = -1e38,\n      E = !1;\n\nvar U;\n!function (e) {\n  e[e.existingItem = 0] = \"existingItem\", e[e.newItem = 1] = \"newItem\";\n}(U || (U = {}));\nconst T = \"Scene Service\",\n      O = {\n  getTypeKeywords: () => [],\n  portalItemLayerType: \"unknown\",\n  validationOptions: {\n    enabled: !0,\n    ignoreUnsupported: !1,\n    failPolicy: \"throw\"\n  }\n};\nvar K;\n!function (e) {\n  e[e.SAVE = 0] = \"SAVE\", e[e.SAVE_AS = 1] = \"SAVE_AS\";\n}(K || (K = {}));\nexport { T as SCENE_SERVICE_ITEM_TYPE, K as SaveOperationType, A as SceneService };","map":{"version":3,"sources":["D:/Github/CUSP_DataBase/CUSP_DB/src/main/gis/node_modules/@arcgis/core/layers/mixins/SceneService.js"],"names":["_","e","t","r","i","isSome","o","debounce","s","urlToObject","a","property","n","reader","l","subclass","p","writer","d","updateOrigins","c","u","m","y","titleFromUrlAndName","h","parse","f","cleanTitle","v","sanitizeUrlWithLayerId","S","writeUrlWithLayerId","g","id","w","url","I","fetchIndexInfo","x","b","j","saveResources","R","getLogger","A","constructor","arguments","spatialReference","fullExtent","heightModelInfo","minScale","maxScale","version","major","Number","NaN","minor","versionString","copyright","sublayerTitleMode","title","layerId","indexInfo","_debouncedSaveOperations","K","SAVE","_save","SAVE_AS","_saveAs","readSpatialReference","_readSpatialReference","fromJSON","store","indexCRS","geographicCRS","parseInt","substring","lastIndexOf","length","readFullExtent","extent","Array","isArray","some","N","xmin","ymin","xmax","ymax","parseVersionString","split","readVersion","toString","readTitlePortalItem","readTitleService","portalItem","name","layer","nonStandardUrlAllowed","logger","_set","writeUrl","parsedUrl","_get","path","_fetchIndexAndUpdateExtent","rootNode","apiKey","hasZ","_updateExtent","type","rootIndex","pageSize","rootPage","nodes","obb","center","halfSize","Math","sqrt","zmin","zmax","mbs","_fetchService","test","_fetchFirstLayerId","_fetchServiceLayer","query","token","responseType","signal","data","layers","ssl","replace","layerType","_fetchVoxelServiceLayer","read","origin","validateLayer","_ensureLoadBeforeSave","load","beforeSave","_updateTypeKeywords","typeKeywords","getTypeKeywords","push","filter","indexOf","U","newItem","O","from","error","Promise","reject","clone","portal","getDefault","T","messages","writtenProperties","blockedRelativeUrls","resources","toAdd","toUpdate","toKeep","pendingOperations","write","all","_validateAgainstJSONSchema","_signIn","user","addItem","item","folder","resourceReferences","itemUrl","existingItem","update","map","message","details","validationOptions","ignoreUnsupported","enabled","E","validate","portalItemLayerType","join","failPolicy","concat","combined","errors","prototype","readOnly","json","origins","service","source","String","target","isRequired","ignoreOrigin","SCENE_SERVICE_ITEM_TYPE","SaveOperationType","SceneService"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import t from\"../../request.js\";import r from\"../../core/Error.js\";import\"../../core/has.js\";import i from\"../../core/Logger.js\";import{isSome as o}from\"../../core/maybe.js\";import{debounce as s}from\"../../core/promiseUtils.js\";import{urlToObject as a}from\"../../core/urlUtils.js\";import{property as n}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/arrayUtils.js\";import\"../../core/accessorSupport/ensureType.js\";import{reader as l}from\"../../core/accessorSupport/decorators/reader.js\";import{subclass as p}from\"../../core/accessorSupport/decorators/subclass.js\";import{writer as d}from\"../../core/accessorSupport/decorators/writer.js\";import{updateOrigins as c}from\"../../core/accessorSupport/originUtils.js\";import u from\"../../geometry/Extent.js\";import m from\"../../geometry/HeightModelInfo.js\";import y from\"../../geometry/SpatialReference.js\";import{titleFromUrlAndName as h,parse as f,cleanTitle as v,sanitizeUrlWithLayerId as S,writeUrlWithLayerId as g}from\"../support/arcgisLayerUrl.js\";import{id as w,url as I}from\"../support/commonProperties.js\";import{fetchIndexInfo as x}from\"../support/I3SIndexInfo.js\";import b from\"../../portal/Portal.js\";import j from\"../../portal/PortalItem.js\";import{saveResources as _}from\"../../webdoc/support/saveUtils.js\";const R=i.getLogger(\"esri.layers.mixins.SceneService\"),A=i=>{let A=class extends i{constructor(){super(...arguments),this.spatialReference=null,this.fullExtent=null,this.heightModelInfo=null,this.minScale=0,this.maxScale=0,this.version={major:Number.NaN,minor:Number.NaN,versionString:\"\"},this.copyright=null,this.sublayerTitleMode=\"item-title\",this.title=null,this.layerId=null,this.indexInfo=null,this._debouncedSaveOperations=s((async(e,t,r)=>{switch(e){case K.SAVE:return this._save(t);case K.SAVE_AS:return this._saveAs(r,t)}}))}readSpatialReference(e,t){return this._readSpatialReference(t)}_readSpatialReference(e){if(null!=e.spatialReference)return y.fromJSON(e.spatialReference);{const t=e.store,r=t.indexCRS||t.geographicCRS,i=r&&parseInt(r.substring(r.lastIndexOf(\"/\")+1,r.length),10);return null!=i?new y(i):null}}readFullExtent(e,t,r){if(null!=e&&\"object\"==typeof e){const i=null==e.spatialReference?{...e,spatialReference:this._readSpatialReference(t)}:e;return u.fromJSON(i,r)}const i=t.store,o=this._readSpatialReference(t);return null==o||null==i||null==i.extent||!Array.isArray(i.extent)||i.extent.some((e=>e<N))?null:new u({xmin:i.extent[0],ymin:i.extent[1],xmax:i.extent[2],ymax:i.extent[3],spatialReference:o})}parseVersionString(e){const t={major:Number.NaN,minor:Number.NaN,versionString:e},r=e.split(\".\");return r.length>=2&&(t.major=parseInt(r[0],10),t.minor=parseInt(r[1],10)),t}readVersion(e,t){const r=t.store,i=null!=r.version?r.version.toString():\"\";return this.parseVersionString(i)}readTitlePortalItem(e){return\"item-title\"!==this.sublayerTitleMode?void 0:e}readTitleService(e,t){const r=this.portalItem&&this.portalItem.title;if(\"item-title\"===this.sublayerTitleMode)return h(this.url,t.name);let i=t.name;if(!i&&this.url){const e=f(this.url);o(e)&&(i=e.title)}return\"item-title-and-service-name\"===this.sublayerTitleMode&&r&&(i=r+\" - \"+i),v(i)}set url(e){const t=S({layer:this,url:e,nonStandardUrlAllowed:!1,logger:R});this._set(\"url\",t.url),null!=t.layerId&&this._set(\"layerId\",t.layerId)}writeUrl(e,t,r,i){g(this,e,\"layers\",t,i)}get parsedUrl(){const e=this._get(\"url\");if(!e)return null;const t=a(e);return null!=this.layerId&&(t.path=`${t.path}/layers/${this.layerId}`),t}async _fetchIndexAndUpdateExtent(e,t){this.indexInfo=x(this.parsedUrl.path,this.rootNode,e,this.apiKey,R,t),null==this.fullExtent||this.fullExtent.hasZ||this._updateExtent(await this.indexInfo)}_updateExtent(e){if(\"page\"===(null==e?void 0:e.type)){var t,i;const o=e.rootIndex%e.pageSize,s=null==(t=e.rootPage)||null==(i=t.nodes)?void 0:i[o];if(null==s||null==s.obb||null==s.obb.center||null==s.obb.halfSize)throw new r(\"sceneservice:invalid-node-page\",\"Invalid node page.\");if(s.obb.center[0]<N||null==this.fullExtent||this.fullExtent.hasZ)return;const a=s.obb.halfSize,n=s.obb.center[2],l=Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]);this.fullExtent.zmin=n-l,this.fullExtent.zmax=n+l}else if(\"node\"===(null==e?void 0:e.type)){var o;const t=null==(o=e.rootNode)?void 0:o.mbs;if(!Array.isArray(t)||4!==t.length||t[0]<N)return;const r=t[2],i=t[3];this.fullExtent.zmin=r-i,this.fullExtent.zmax=r+i}}async _fetchService(e){if(null==this.url)throw new r(\"sceneservice:url-not-set\",\"Scene service can not be loaded without valid portal item or url\");if(null==this.layerId&&/SceneServer\\/*$/i.test(this.url)){const t=await this._fetchFirstLayerId(e);null!=t&&(this.layerId=t)}return this._fetchServiceLayer(e)}async _fetchFirstLayerId(e){const r=await t(this.url,{query:{f:\"json\",token:this.apiKey},responseType:\"json\",signal:e});if(r.data&&Array.isArray(r.data.layers)&&r.data.layers.length>0)return r.data.layers[0].id}async _fetchServiceLayer(e){const r=await t(this.parsedUrl.path,{query:{f:\"json\",token:this.apiKey},responseType:\"json\",signal:e});r.ssl&&(this.url=this.url.replace(/^http:/i,\"https:\"));let i=!1;if(r.data.layerType&&\"Voxel\"===r.data.layerType&&(i=!0),i)return this._fetchVoxelServiceLayer();const o=r.data;this.read(o,{origin:\"service\",url:this.parsedUrl}),this.validateLayer(o)}async _fetchVoxelServiceLayer(e){const r=(await t(this.parsedUrl.path+\"/layer\",{query:{f:\"json\",token:this.apiKey},responseType:\"json\",signal:e})).data;this.read(r,{origin:\"service\",url:this.parsedUrl}),this.validateLayer(r)}async _ensureLoadBeforeSave(){await this.load(),\"beforeSave\"in this&&\"function\"==typeof this.beforeSave&&await this.beforeSave()}validateLayer(e){}_updateTypeKeywords(e,t,r){e.typeKeywords||(e.typeKeywords=[]);const i=t.getTypeKeywords();for(const o of i)e.typeKeywords.push(o);e.typeKeywords&&(e.typeKeywords=e.typeKeywords.filter(((e,t,r)=>r.indexOf(e)===t)),r===U.newItem&&(e.typeKeywords=e.typeKeywords.filter((e=>\"Hosted Service\"!==e))))}async _saveAs(e,t){const i={...O,...t};let o=j.from(e);o||(R.error(\"_saveAs(): requires a portal item parameter\"),await Promise.reject(new r(\"sceneservice:portal-item-required\",\"_saveAs() requires a portal item to save to\"))),o.id&&(o=o.clone(),o.id=null);const s=o.portal||b.getDefault();await this._ensureLoadBeforeSave(),o.type=T,o.portal=s;const a={origin:\"portal-item\",url:null,messages:[],portal:s,portalItem:o,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}},n={layers:[this.write({},a)]};return await Promise.all(a.resources.pendingOperations),await this._validateAgainstJSONSchema(n,a,i),o.url=this.url,o.title||(o.title=this.title),this._updateTypeKeywords(o,i,U.newItem),await s._signIn(),await s.user.addItem({item:o,folder:i&&i.folder,data:n}),await _(this.resourceReferences,a,null),this.portalItem=o,c(a),a.portalItem=o,o}async _save(e){const t={...O,...e};this.portalItem||(R.error(\"_save(): requires the .portalItem property to be set\"),await Promise.reject(new r(\"sceneservice:portal-item-not-set\",\"Portal item to save to has not been set on this SceneService\"))),this.portalItem.type!==T&&(R.error(\"_save(): Non-matching portal item type. Got \"+this.portalItem.type+\", expected \"+T),await Promise.reject(new r(\"sceneservice:portal-item-wrong-type\",`Portal item needs to have type \"${T}\"`))),await this._ensureLoadBeforeSave();const i={origin:\"portal-item\",url:this.portalItem.itemUrl&&a(this.portalItem.itemUrl),messages:[],portal:this.portalItem.portal||b.getDefault(),portalItem:this.portalItem,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}},o={layers:[this.write({},i)]};return await Promise.all(i.resources.pendingOperations),await this._validateAgainstJSONSchema(o,i,t),this.portalItem.url=this.url,this.portalItem.title||(this.portalItem.title=this.title),this._updateTypeKeywords(this.portalItem,t,U.existingItem),await this.portalItem.update({data:o}),await _(this.resourceReferences,i,null),c(i),this.portalItem}async _validateAgainstJSONSchema(e,t,i){let o=t.messages.filter((e=>\"error\"===e.type)).map((e=>new r(e.name,e.message,e.details)));if(i&&i.validationOptions.ignoreUnsupported&&(o=o.filter((e=>\"layer:unsupported\"!==e.name&&\"symbol:unsupported\"!==e.name&&\"symbol-layer:unsupported\"!==e.name&&\"property:unsupported\"!==e.name&&\"url:unsupported\"!==e.name&&\"scenemodification:unsupported\"!==e.name))),i.validationOptions.enabled||E){const t=(await import(\"../support/schemaValidator.js\")).validate(e,i.portalItemLayerType);if(t.length>0){const e=`Layer item did not validate:\\n${t.join(\"\\n\")}`;if(R.error(`_validateAgainstJSONSchema(): ${e}`),\"throw\"===i.validationOptions.failPolicy){const e=t.map((e=>new r(\"sceneservice:schema-validation\",e))).concat(o);throw new r(\"sceneservice-validate:error\",\"Failed to save layer item due to schema validation, see `details.errors`.\",{combined:e})}}}if(o.length>0)throw new r(\"sceneservice:save\",\"Failed to save SceneService due to unsupported or invalid content. See 'details.errors' for more detailed information\",{errors:o})}};return e([n(w)],A.prototype,\"id\",void 0),e([n({type:y})],A.prototype,\"spatialReference\",void 0),e([l(\"spatialReference\",[\"spatialReference\",\"store.indexCRS\",\"store.geographicCRS\"])],A.prototype,\"readSpatialReference\",null),e([n({type:u})],A.prototype,\"fullExtent\",void 0),e([l(\"fullExtent\",[\"fullExtent\",\"store.extent\",\"spatialReference\",\"store.indexCRS\",\"store.geographicCRS\"])],A.prototype,\"readFullExtent\",null),e([n({readOnly:!0,type:m})],A.prototype,\"heightModelInfo\",void 0),e([n({type:Number,json:{name:\"layerDefinition.minScale\",write:!0,origins:{service:{read:{source:\"minScale\"},write:!1}}}})],A.prototype,\"minScale\",void 0),e([n({type:Number,json:{name:\"layerDefinition.maxScale\",write:!0,origins:{service:{read:{source:\"maxScale\"},write:!1}}}})],A.prototype,\"maxScale\",void 0),e([n({readOnly:!0})],A.prototype,\"version\",void 0),e([l(\"version\",[\"store.version\"])],A.prototype,\"readVersion\",null),e([n({type:String,json:{read:{source:\"copyrightText\"}}})],A.prototype,\"copyright\",void 0),e([n({type:String,json:{read:!1}})],A.prototype,\"sublayerTitleMode\",void 0),e([n({type:String})],A.prototype,\"title\",void 0),e([l(\"portal-item\",\"title\")],A.prototype,\"readTitlePortalItem\",null),e([l(\"service\",\"title\",[\"name\"])],A.prototype,\"readTitleService\",null),e([n({type:Number,json:{origins:{service:{read:{source:\"id\"}},\"portal-item\":{write:{target:\"id\",isRequired:!0,ignoreOrigin:!0},read:!1}}}})],A.prototype,\"layerId\",void 0),e([n(I)],A.prototype,\"url\",null),e([d(\"url\")],A.prototype,\"writeUrl\",null),e([n()],A.prototype,\"parsedUrl\",null),e([n({readOnly:!0})],A.prototype,\"store\",void 0),e([n({type:String,readOnly:!0,json:{read:{source:\"store.rootNode\"}}})],A.prototype,\"rootNode\",void 0),A=e([p(\"esri.layers.mixins.SceneService\")],A),A},N=-1e38,E=!1;var U;!function(e){e[e.existingItem=0]=\"existingItem\",e[e.newItem=1]=\"newItem\"}(U||(U={}));const T=\"Scene Service\",O={getTypeKeywords:()=>[],portalItemLayerType:\"unknown\",validationOptions:{enabled:!0,ignoreUnsupported:!1,failPolicy:\"throw\"}};var K;!function(e){e[e.SAVE=0]=\"SAVE\",e[e.SAVE_AS=1]=\"SAVE_AS\"}(K||(K={}));export{T as SCENE_SERVICE_ITEM_TYPE,K as SaveOperationType,A as SceneService};\n"]},"metadata":{},"sourceType":"module"}