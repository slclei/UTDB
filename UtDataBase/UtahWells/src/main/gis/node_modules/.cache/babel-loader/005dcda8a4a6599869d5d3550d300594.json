{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport e from \"../../../request.js\";\nimport { isSome as t } from \"../../../core/maybe.js\";\nimport { join as r, urlToObject as n } from \"../../../core/urlUtils.js\";\nimport { getJsonType as i } from \"../../../geometry/support/jsonUtils.js\";\nimport { normalizeCentralMeridian as o } from \"../../../geometry/support/normalizeUtils.js\";\nimport { mapParameters as a } from \"../../operations/urlUtils.js\";\nimport { parsePBFFeatureQuery as s } from \"./pbfQueryUtils.js\";\nimport { applyFeatureSetZUnitScaling as u } from \"./queryZScale.js\";\nconst l = \"Layer does not support extent calculation.\";\n\nfunction m(e, t) {\n  if (t && \"extent\" === e.type) return `${e.xmin},${e.ymin},${e.xmax},${e.ymax}`;\n  if (t && \"point\" === e.type) return `${e.x},${e.y}`;\n  const r = e.toJSON();\n  return delete r.spatialReference, JSON.stringify(r);\n}\n\nfunction y(e, r) {\n  const n = e.geometry,\n        o = e.toJSON();\n  delete o.compactGeometryEnabled, delete o.defaultSpatialReferenceEnabled;\n  const a = o,\n        s = e.outSpatialReference;\n  let u, l;\n\n  if (t(n) && (u = n.spatialReference, l = n.spatialReference.wkid || JSON.stringify(n.spatialReference), a.geometryType = i(n), a.geometry = m(n, e.compactGeometryEnabled), a.inSR = l), o.groupByFieldsForStatistics && (a.groupByFieldsForStatistics = o.groupByFieldsForStatistics.join(\",\")), o.objectIds && (a.objectIds = o.objectIds.join(\",\")), o.orderByFields && (a.orderByFields = o.orderByFields.join(\",\")), !o.outFields || !o.returnDistinctValues && (null != r && r.returnCountOnly || null != r && r.returnExtentOnly || null != r && r.returnIdsOnly) ? delete a.outFields : -1 !== o.outFields.indexOf(\"*\") ? a.outFields = \"*\" : a.outFields = o.outFields.join(\",\"), o.outSR ? a.outSR = o.outSR.wkid || JSON.stringify(o.outSR) : n && (o.returnGeometry || o.returnCentroid) && (a.outSR = a.inSR), o.returnGeometry && delete o.returnGeometry, o.outStatistics && (a.outStatistics = JSON.stringify(o.outStatistics)), o.pixelSize && (a.pixelSize = JSON.stringify(o.pixelSize)), o.quantizationParameters && (e.defaultSpatialReferenceEnabled && t(u) && t(e.quantizationParameters) && t(e.quantizationParameters.extent) && u.equals(e.quantizationParameters.extent.spatialReference) && delete o.quantizationParameters.extent.spatialReference, a.quantizationParameters = JSON.stringify(o.quantizationParameters)), o.parameterValues && (a.parameterValues = JSON.stringify(o.parameterValues)), o.rangeValues && (a.rangeValues = JSON.stringify(o.rangeValues)), o.dynamicDataSource && (a.layer = JSON.stringify({\n    source: o.dynamicDataSource\n  }), delete o.dynamicDataSource), o.timeExtent) {\n    const e = o.timeExtent,\n          {\n      start: t,\n      end: r\n    } = e;\n    null == t && null == r || (a.time = t === r ? t : `${null == t ? \"null\" : t},${null == r ? \"null\" : r}`), delete o.timeExtent;\n  }\n\n  return e.defaultSpatialReferenceEnabled && t(u) && t(s) && u.equals(s) && (a.defaultSR = a.inSR, delete a.inSR, delete a.outSR), a;\n}\n\nasync function c(e, r, n, i) {\n  const o = t(r.timeExtent) && r.timeExtent.isEmpty ? {\n    data: {\n      features: []\n    }\n  } : await E(e, r, \"json\", i);\n  return u(r, n, o.data), o;\n}\n\nasync function d(e, r, n, i) {\n  if (t(r.timeExtent) && r.timeExtent.isEmpty) return Promise.resolve({\n    data: n.createFeatureResult()\n  });\n  const o = await f(e, r, i),\n        a = o;\n  return a.data = s(o.data, n), a;\n}\n\nfunction f(e, t, r) {\n  return E(e, t, \"pbf\", r);\n}\n\nfunction p(e, r, n) {\n  return t(r.timeExtent) && r.timeExtent.isEmpty ? Promise.resolve({\n    data: {\n      objectIds: []\n    }\n  }) : E(e, r, \"json\", n, {\n    returnIdsOnly: !0\n  });\n}\n\nfunction S(e, r, n) {\n  return t(r.timeExtent) && r.timeExtent.isEmpty ? Promise.resolve({\n    data: {\n      count: 0\n    }\n  }) : E(e, r, \"json\", n, {\n    returnIdsOnly: !0,\n    returnCountOnly: !0\n  });\n}\n\nfunction x(e, r, n) {\n  return t(r.timeExtent) && r.timeExtent.isEmpty ? Promise.resolve({\n    data: {\n      count: 0,\n      extent: null\n    }\n  }) : E(e, r, \"json\", n, {\n    returnExtentOnly: !0,\n    returnCountOnly: !0\n  }).then(e => {\n    const t = e.data;\n    if (t.hasOwnProperty(\"extent\")) return e;\n    if (t.features) throw new Error(l);\n    if (t.hasOwnProperty(\"count\")) throw new Error(l);\n    return e;\n  });\n}\n\nfunction E(i, s, u) {\n  let l = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};\n  let m = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : {};\n  const c = \"string\" == typeof i ? n(i) : i,\n        d = s.geometry ? [s.geometry] : [];\n  return l.responseType = \"pbf\" === u ? \"array-buffer\" : \"json\", o(d, null, l).then(n => {\n    const i = n && n[0];\n    t(i) && ((s = s.clone()).geometry = i);\n    const o = a({ ...c.query,\n      f: u,\n      ...m,\n      ...y(s, m)\n    });\n    return e(r(c.path, \"query\"), { ...l,\n      query: { ...o,\n        ...l.query\n      }\n    });\n  });\n}\n\nexport { m as encodeGeometry, c as executeQuery, S as executeQueryForCount, x as executeQueryForExtent, p as executeQueryForIds, d as executeQueryPBF, f as executeQueryPBFBuffer, y as queryToQueryStringParameters, E as runQuery };","map":{"version":3,"sources":["D:/Github/CUSP_DataBase/CUSP_DB/src/main/gis/node_modules/@arcgis/core/rest/query/operations/query.js"],"names":["e","isSome","t","join","r","urlToObject","n","getJsonType","i","normalizeCentralMeridian","o","mapParameters","a","parsePBFFeatureQuery","s","applyFeatureSetZUnitScaling","u","l","m","type","xmin","ymin","xmax","ymax","x","y","toJSON","spatialReference","JSON","stringify","geometry","compactGeometryEnabled","defaultSpatialReferenceEnabled","outSpatialReference","wkid","geometryType","inSR","groupByFieldsForStatistics","objectIds","orderByFields","outFields","returnDistinctValues","returnCountOnly","returnExtentOnly","returnIdsOnly","indexOf","outSR","returnGeometry","returnCentroid","outStatistics","pixelSize","quantizationParameters","extent","equals","parameterValues","rangeValues","dynamicDataSource","layer","source","timeExtent","start","end","time","defaultSR","c","isEmpty","data","features","E","d","Promise","resolve","createFeatureResult","f","p","S","count","then","hasOwnProperty","Error","responseType","clone","query","path","encodeGeometry","executeQuery","executeQueryForCount","executeQueryForExtent","executeQueryForIds","executeQueryPBF","executeQueryPBFBuffer","queryToQueryStringParameters","runQuery"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport e from\"../../../request.js\";import{isSome as t}from\"../../../core/maybe.js\";import{join as r,urlToObject as n}from\"../../../core/urlUtils.js\";import{getJsonType as i}from\"../../../geometry/support/jsonUtils.js\";import{normalizeCentralMeridian as o}from\"../../../geometry/support/normalizeUtils.js\";import{mapParameters as a}from\"../../operations/urlUtils.js\";import{parsePBFFeatureQuery as s}from\"./pbfQueryUtils.js\";import{applyFeatureSetZUnitScaling as u}from\"./queryZScale.js\";const l=\"Layer does not support extent calculation.\";function m(e,t){if(t&&\"extent\"===e.type)return`${e.xmin},${e.ymin},${e.xmax},${e.ymax}`;if(t&&\"point\"===e.type)return`${e.x},${e.y}`;const r=e.toJSON();return delete r.spatialReference,JSON.stringify(r)}function y(e,r){const n=e.geometry,o=e.toJSON();delete o.compactGeometryEnabled,delete o.defaultSpatialReferenceEnabled;const a=o,s=e.outSpatialReference;let u,l;if(t(n)&&(u=n.spatialReference,l=n.spatialReference.wkid||JSON.stringify(n.spatialReference),a.geometryType=i(n),a.geometry=m(n,e.compactGeometryEnabled),a.inSR=l),o.groupByFieldsForStatistics&&(a.groupByFieldsForStatistics=o.groupByFieldsForStatistics.join(\",\")),o.objectIds&&(a.objectIds=o.objectIds.join(\",\")),o.orderByFields&&(a.orderByFields=o.orderByFields.join(\",\")),!o.outFields||!o.returnDistinctValues&&(null!=r&&r.returnCountOnly||null!=r&&r.returnExtentOnly||null!=r&&r.returnIdsOnly)?delete a.outFields:-1!==o.outFields.indexOf(\"*\")?a.outFields=\"*\":a.outFields=o.outFields.join(\",\"),o.outSR?a.outSR=o.outSR.wkid||JSON.stringify(o.outSR):n&&(o.returnGeometry||o.returnCentroid)&&(a.outSR=a.inSR),o.returnGeometry&&delete o.returnGeometry,o.outStatistics&&(a.outStatistics=JSON.stringify(o.outStatistics)),o.pixelSize&&(a.pixelSize=JSON.stringify(o.pixelSize)),o.quantizationParameters&&(e.defaultSpatialReferenceEnabled&&t(u)&&t(e.quantizationParameters)&&t(e.quantizationParameters.extent)&&u.equals(e.quantizationParameters.extent.spatialReference)&&delete o.quantizationParameters.extent.spatialReference,a.quantizationParameters=JSON.stringify(o.quantizationParameters)),o.parameterValues&&(a.parameterValues=JSON.stringify(o.parameterValues)),o.rangeValues&&(a.rangeValues=JSON.stringify(o.rangeValues)),o.dynamicDataSource&&(a.layer=JSON.stringify({source:o.dynamicDataSource}),delete o.dynamicDataSource),o.timeExtent){const e=o.timeExtent,{start:t,end:r}=e;null==t&&null==r||(a.time=t===r?t:`${null==t?\"null\":t},${null==r?\"null\":r}`),delete o.timeExtent}return e.defaultSpatialReferenceEnabled&&t(u)&&t(s)&&u.equals(s)&&(a.defaultSR=a.inSR,delete a.inSR,delete a.outSR),a}async function c(e,r,n,i){const o=t(r.timeExtent)&&r.timeExtent.isEmpty?{data:{features:[]}}:await E(e,r,\"json\",i);return u(r,n,o.data),o}async function d(e,r,n,i){if(t(r.timeExtent)&&r.timeExtent.isEmpty)return Promise.resolve({data:n.createFeatureResult()});const o=await f(e,r,i),a=o;return a.data=s(o.data,n),a}function f(e,t,r){return E(e,t,\"pbf\",r)}function p(e,r,n){return t(r.timeExtent)&&r.timeExtent.isEmpty?Promise.resolve({data:{objectIds:[]}}):E(e,r,\"json\",n,{returnIdsOnly:!0})}function S(e,r,n){return t(r.timeExtent)&&r.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):E(e,r,\"json\",n,{returnIdsOnly:!0,returnCountOnly:!0})}function x(e,r,n){return t(r.timeExtent)&&r.timeExtent.isEmpty?Promise.resolve({data:{count:0,extent:null}}):E(e,r,\"json\",n,{returnExtentOnly:!0,returnCountOnly:!0}).then((e=>{const t=e.data;if(t.hasOwnProperty(\"extent\"))return e;if(t.features)throw new Error(l);if(t.hasOwnProperty(\"count\"))throw new Error(l);return e}))}function E(i,s,u,l={},m={}){const c=\"string\"==typeof i?n(i):i,d=s.geometry?[s.geometry]:[];return l.responseType=\"pbf\"===u?\"array-buffer\":\"json\",o(d,null,l).then((n=>{const i=n&&n[0];t(i)&&((s=s.clone()).geometry=i);const o=a({...c.query,f:u,...m,...y(s,m)});return e(r(c.path,\"query\"),{...l,query:{...o,...l.query}})}))}export{m as encodeGeometry,c as executeQuery,S as executeQueryForCount,x as executeQueryForExtent,p as executeQueryForIds,d as executeQueryPBF,f as executeQueryPBFBuffer,y as queryToQueryStringParameters,E as runQuery};\n"]},"metadata":{},"sourceType":"module"}