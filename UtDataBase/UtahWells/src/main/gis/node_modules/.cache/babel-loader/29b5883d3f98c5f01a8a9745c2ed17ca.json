{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport { _ as t } from \"../chunks/tslib.es6.js\";\nimport o from \"../core/Accessor.js\";\nimport e from \"../core/Collection.js\";\nimport { HandleOwner as i } from \"../core/HandleOwner.js\";\nimport { makeHandle as r } from \"../core/handleUtils.js\";\nimport s from \"../core/Logger.js\";\nimport { isSome as a, isNone as l, destroyMaybe as n } from \"../core/maybe.js\";\nimport { watch as h } from \"../core/watchUtils.js\";\nimport { property as c } from \"../core/accessorSupport/decorators/property.js\";\nimport \"../core/arrayUtils.js\";\nimport \"../core/has.js\";\nimport \"../core/accessorSupport/ensureType.js\";\nimport { subclass as p } from \"../core/accessorSupport/decorators/subclass.js\";\nimport { TextureCollection as u } from \"./3d/support/TextureCollection.js\";\nimport { ViewEventPriorities as v } from \"./input/InputManager.js\";\nimport { eventTypes as d } from \"./input/ViewEvents.js\";\nimport { getToolCollectionHandles as m, areToolManipulatorsEditable as f } from \"./interactive/interactiveToolUtils.js\";\nimport { EditableFlag as T } from \"./interactive/interfaces.js\";\nimport _ from \"./interactive/ToolViewManagerManipulatorState.js\";\nconst E = s.getLogger(\"esri.views.ToolViewManager\"),\n      w = \"attached\",\n      g = \"tools\";\nlet y = class extends i {\n  constructor(t) {\n    super(t), this._manipulatorState = new _(), this.tools = new e(), this.cursor = null, this._forEachTool = t => {\n      for (const o of this.tools.items) if (t(o)) return;\n    };\n  }\n\n  initialize() {\n    this.handles.add([this.view.on(d, t => {\n      this._handleInputEvent(t);\n    }, v.TOOL), ...m(this.tools), this.tools.on(\"before-remove\", _ref => {\n      let {\n        item: t\n      } = _ref;\n\n      this._manipulatorState.clearPointers(t, this._forEachTool);\n    }), this.tools.on(\"change\", () => {\n      this._refreshToolWatchers();\n    })]);\n  }\n\n  destroy() {\n    this.detach(), this.handles.removeAll();\n  }\n\n  set activeTool(t) {\n    if (a(t) && !this.view.ready) return void E.error(\"Cannot set active tool while view is not ready.\");\n    if (t === this.activeTool) return void (a(t) && E.warn(\"Tool is already active - ignoring activation request.\"));\n    const o = this.activeTool;\n    this._set(\"activeTool\", t), a(o) && o.deactivate(), a(t) && t.activate(), this._removeIncompleteTools(t);\n    const e = l(this.activeTool);\n\n    for (const i of this.tools) {\n      i.setEditableFlag(T.MANAGER, e || i === this.activeTool);\n      const t = f(i);\n      !e && t || this._manipulatorState.clearPointers(i, this._forEachTool, !t);\n    }\n\n    this._updateCursor();\n  }\n\n  get updating() {\n    var t, o;\n    return this.updatingHandles.updating || this.tools.some(t => t.updating) || null != (t = null == (o = this.textures) ? void 0 : o.updating) && t;\n  }\n\n  attach() {\n    \"3d\" === this.view.type ? (this._set(\"textures\", new u(this.view._stage, this.view.resourceController.scheduler)), this.handles.add([this.view.state.watch(\"camera\", () => {\n      this._forEachManipulator(t => {\n        null != t.onViewChange && t.onViewChange();\n      });\n    }), this.view.elevationProvider.on(\"elevation-change\", t => {\n      this._forEachManipulator(o => {\n        null != o.onElevationChange && o.onElevationChange(t);\n      });\n    }), r(() => this._set(\"textures\", n(this.textures)))], w)) : this.handles.add(this.view.watch(\"extent\", () => {\n      this._forEachManipulator(t => {\n        null != t.onViewChange && t.onViewChange();\n      });\n    }));\n  }\n\n  detach() {\n    a(this.activeTool) && (this.activeTool = null), this.tools.removeAll(), this.handles.remove(w);\n  }\n\n  _forEachManipulator(t) {\n    this._forEachTool(o => {\n      o.manipulators && o.manipulators.forEach(_ref2 => {\n        let {\n          manipulator: e\n        } = _ref2;\n        return t(e, o);\n      });\n    });\n  }\n\n  _handleInputEvent(t) {\n    let o = !1;\n    const e = { ...t,\n      stopPropagation: () => {\n        o = !0, t.stopPropagation();\n      }\n    };\n    a(this.activeTool) ? this.activeTool.handleInputEvent && this.activeTool.handleInputEvent(e) : this._forEachTool(t => {\n      !o && t.visible && t.handleInputEvent(e);\n    }), !o && \"key-down\" === t.type && \"Escape\" === t.key && this.activeTool && (t.stopPropagation(), this.activeTool = null), this._manipulatorState.handleInputEvent(e, {\n      forEachTool: this._forEachTool,\n      activeTool: this.activeTool,\n      setActiveTool: t => {\n        this.activeTool = t;\n      },\n      view: this.view\n    }), !o && a(this.activeTool) && this.activeTool.handleInputEventAfter(e), this._manipulatorState.handleHoverEvent(e, this._forEachTool), this._updateCursor();\n  }\n\n  _refreshToolWatchers() {\n    this.handles.remove(g), this._forEachTool(t => {\n      if (t instanceof o) {\n        const o = h(t, [\"cursor\", \"visible\", \"editable\"], () => {\n          f(t) || this._manipulatorState.clearPointers(t, this._forEachTool), this._updateCursor();\n        });\n        this.handles.add(o, g);\n      }\n\n      t.manipulators && this.handles.add(t.manipulators.on(\"change\", o => {\n        o.removed.forEach(_ref3 => {\n          let {\n            id: o\n          } = _ref3;\n\n          this._manipulatorState.clearPointers(t, this._forEachTool, !0, o);\n        }), this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool), this._updateCursor();\n      }), g);\n    }), this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool), this._updateCursor();\n  }\n\n  _updateCursor() {\n    let t = this._manipulatorState.cursor;\n    this._forEachTool(o => !(!a(o.cursor) || !o.visible) && (t = o.cursor, !0)), this._get(\"cursor\") !== t && this._set(\"cursor\", t);\n  }\n\n  _removeIncompleteTools(t) {\n    this.tools.filter(o => (l(t) || o !== t) && !o.created).forEach(t => {\n      this.tools.remove(t);\n    });\n  }\n\n};\nt([c({\n  constructOnly: !0,\n  nonNullable: !0\n})], y.prototype, \"view\", void 0), t([c({\n  readOnly: !0,\n  nonNullable: !0\n})], y.prototype, \"textures\", void 0), t([c({\n  value: null\n})], y.prototype, \"activeTool\", null), t([c({\n  readOnly: !0,\n  type: e\n})], y.prototype, \"tools\", void 0), t([c({\n  readOnly: !0\n})], y.prototype, \"cursor\", void 0), t([c({\n  readOnly: !0\n})], y.prototype, \"updating\", null), y = t([p(\"esri.views.ToolViewManager\")], y);\nconst j = y;\nexport { j as default };","map":{"version":3,"sources":["D:/Github/CUSP_DataBase/CUSP_DB/src/main/gis/node_modules/@arcgis/core/views/ToolViewManager.js"],"names":["_","t","o","e","HandleOwner","i","makeHandle","r","s","isSome","a","isNone","l","destroyMaybe","n","watch","h","property","c","subclass","p","TextureCollection","u","ViewEventPriorities","v","eventTypes","d","getToolCollectionHandles","m","areToolManipulatorsEditable","f","EditableFlag","T","E","getLogger","w","g","y","constructor","_manipulatorState","tools","cursor","_forEachTool","items","initialize","handles","add","view","on","_handleInputEvent","TOOL","item","clearPointers","_refreshToolWatchers","destroy","detach","removeAll","activeTool","ready","error","warn","_set","deactivate","activate","_removeIncompleteTools","setEditableFlag","MANAGER","_updateCursor","updating","updatingHandles","some","textures","attach","type","_stage","resourceController","scheduler","state","_forEachManipulator","onViewChange","elevationProvider","onElevationChange","remove","manipulators","forEach","manipulator","stopPropagation","handleInputEvent","visible","key","forEachTool","setActiveTool","handleInputEventAfter","handleHoverEvent","removed","id","updateHoveredStateFromKnownPointers","_get","filter","created","constructOnly","nonNullable","prototype","readOnly","value","j","default"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport{_ as t}from\"../chunks/tslib.es6.js\";import o from\"../core/Accessor.js\";import e from\"../core/Collection.js\";import{HandleOwner as i}from\"../core/HandleOwner.js\";import{makeHandle as r}from\"../core/handleUtils.js\";import s from\"../core/Logger.js\";import{isSome as a,isNone as l,destroyMaybe as n}from\"../core/maybe.js\";import{watch as h}from\"../core/watchUtils.js\";import{property as c}from\"../core/accessorSupport/decorators/property.js\";import\"../core/arrayUtils.js\";import\"../core/has.js\";import\"../core/accessorSupport/ensureType.js\";import{subclass as p}from\"../core/accessorSupport/decorators/subclass.js\";import{TextureCollection as u}from\"./3d/support/TextureCollection.js\";import{ViewEventPriorities as v}from\"./input/InputManager.js\";import{eventTypes as d}from\"./input/ViewEvents.js\";import{getToolCollectionHandles as m,areToolManipulatorsEditable as f}from\"./interactive/interactiveToolUtils.js\";import{EditableFlag as T}from\"./interactive/interfaces.js\";import _ from\"./interactive/ToolViewManagerManipulatorState.js\";const E=s.getLogger(\"esri.views.ToolViewManager\"),w=\"attached\",g=\"tools\";let y=class extends i{constructor(t){super(t),this._manipulatorState=new _,this.tools=new e,this.cursor=null,this._forEachTool=t=>{for(const o of this.tools.items)if(t(o))return}}initialize(){this.handles.add([this.view.on(d,(t=>{this._handleInputEvent(t)}),v.TOOL),...m(this.tools),this.tools.on(\"before-remove\",(({item:t})=>{this._manipulatorState.clearPointers(t,this._forEachTool)})),this.tools.on(\"change\",(()=>{this._refreshToolWatchers()}))])}destroy(){this.detach(),this.handles.removeAll()}set activeTool(t){if(a(t)&&!this.view.ready)return void E.error(\"Cannot set active tool while view is not ready.\");if(t===this.activeTool)return void(a(t)&&E.warn(\"Tool is already active - ignoring activation request.\"));const o=this.activeTool;this._set(\"activeTool\",t),a(o)&&o.deactivate(),a(t)&&t.activate(),this._removeIncompleteTools(t);const e=l(this.activeTool);for(const i of this.tools){i.setEditableFlag(T.MANAGER,e||i===this.activeTool);const t=f(i);!e&&t||this._manipulatorState.clearPointers(i,this._forEachTool,!t)}this._updateCursor()}get updating(){var t,o;return this.updatingHandles.updating||this.tools.some((t=>t.updating))||null!=(t=null==(o=this.textures)?void 0:o.updating)&&t}attach(){\"3d\"===this.view.type?(this._set(\"textures\",new u(this.view._stage,this.view.resourceController.scheduler)),this.handles.add([this.view.state.watch(\"camera\",(()=>{this._forEachManipulator((t=>{null!=t.onViewChange&&t.onViewChange()}))})),this.view.elevationProvider.on(\"elevation-change\",(t=>{this._forEachManipulator((o=>{null!=o.onElevationChange&&o.onElevationChange(t)}))})),r((()=>this._set(\"textures\",n(this.textures))))],w)):this.handles.add(this.view.watch(\"extent\",(()=>{this._forEachManipulator((t=>{null!=t.onViewChange&&t.onViewChange()}))})))}detach(){a(this.activeTool)&&(this.activeTool=null),this.tools.removeAll(),this.handles.remove(w)}_forEachManipulator(t){this._forEachTool((o=>{o.manipulators&&o.manipulators.forEach((({manipulator:e})=>t(e,o)))}))}_handleInputEvent(t){let o=!1;const e={...t,stopPropagation:()=>{o=!0,t.stopPropagation()}};a(this.activeTool)?this.activeTool.handleInputEvent&&this.activeTool.handleInputEvent(e):this._forEachTool((t=>{!o&&t.visible&&t.handleInputEvent(e)})),!o&&\"key-down\"===t.type&&\"Escape\"===t.key&&this.activeTool&&(t.stopPropagation(),this.activeTool=null),this._manipulatorState.handleInputEvent(e,{forEachTool:this._forEachTool,activeTool:this.activeTool,setActiveTool:t=>{this.activeTool=t},view:this.view}),!o&&a(this.activeTool)&&this.activeTool.handleInputEventAfter(e),this._manipulatorState.handleHoverEvent(e,this._forEachTool),this._updateCursor()}_refreshToolWatchers(){this.handles.remove(g),this._forEachTool((t=>{if(t instanceof o){const o=h(t,[\"cursor\",\"visible\",\"editable\"],(()=>{f(t)||this._manipulatorState.clearPointers(t,this._forEachTool),this._updateCursor()}));this.handles.add(o,g)}t.manipulators&&this.handles.add(t.manipulators.on(\"change\",(o=>{o.removed.forEach((({id:o})=>{this._manipulatorState.clearPointers(t,this._forEachTool,!0,o)})),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()})),g)})),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}_updateCursor(){let t=this._manipulatorState.cursor;this._forEachTool((o=>!(!a(o.cursor)||!o.visible)&&(t=o.cursor,!0))),this._get(\"cursor\")!==t&&this._set(\"cursor\",t)}_removeIncompleteTools(t){this.tools.filter((o=>(l(t)||o!==t)&&!o.created)).forEach((t=>{this.tools.remove(t)}))}};t([c({constructOnly:!0,nonNullable:!0})],y.prototype,\"view\",void 0),t([c({readOnly:!0,nonNullable:!0})],y.prototype,\"textures\",void 0),t([c({value:null})],y.prototype,\"activeTool\",null),t([c({readOnly:!0,type:e})],y.prototype,\"tools\",void 0),t([c({readOnly:!0})],y.prototype,\"cursor\",void 0),t([c({readOnly:!0})],y.prototype,\"updating\",null),y=t([p(\"esri.views.ToolViewManager\")],y);const j=y;export{j as default};\n"]},"metadata":{},"sourceType":"module"}