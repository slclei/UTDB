{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../../../chunks/tslib.es6.js\";\nimport t from \"../../../../Graphic.js\";\nimport r from \"../../../../core/Accessor.js\";\nimport i from \"../../../../core/Logger.js\";\nimport { isSome as s } from \"../../../../core/maybe.js\";\nimport { isAbortError as o } from \"../../../../core/promiseUtils.js\";\nimport { property as a } from \"../../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../../core/arrayUtils.js\";\nimport \"../../../../core/has.js\";\nimport \"../../../../core/accessorSupport/ensureType.js\";\nimport { subclass as p } from \"../../../../core/accessorSupport/decorators/subclass.js\";\nimport { mosaicPixelData as n } from \"../../../../layers/support/rasterFunctions/pixelUtils.js\";\nimport { BitmapContainer as l } from \"../../engine/BitmapContainer.js\";\nimport { Container as c } from \"../../engine/Container.js\";\nimport h from \"../../engine/ImageryBitmapSource.js\";\nimport m from \"../support/ExportStrategy.js\";\nconst d = i.getLogger(\"esri.views.2d.layers.imagery.ImageryView2D\");\nlet u = class extends r {\n  constructor() {\n    super(...arguments), this.attached = !1, this.container = new c(), this.updateRequested = !1, this.type = \"imagery\", this._bitmapView = new l();\n  }\n\n  destroy() {\n    this.attached && (this.detach(), this.attached = !1), this.updateRequested = !1;\n  }\n\n  get updating() {\n    return !this.attached || this.isUpdating();\n  }\n\n  update(e) {\n    this.strategy.update(e).catch(e => {\n      o(e) || d.error(e);\n    });\n  }\n\n  hitTest(e) {\n    return new t({\n      attributes: {},\n      geometry: e.clone(),\n      layer: this.layer\n    });\n  }\n\n  attach() {\n    this.container.addChild(this._bitmapView);\n    const e = this.layer.version >= 10,\n          t = this.layer.version >= 10.1 ? this.layer.imageMaxHeight : 2048,\n          r = this.layer.version >= 10.1 ? this.layer.imageMaxWidth : 2048;\n    this.strategy = new m({\n      container: this._bitmapView,\n      imageNormalizationSupported: e,\n      imageMaxHeight: t,\n      imageMaxWidth: r,\n      fetchSource: this._fetchImage.bind(this),\n      requestUpdate: () => this.requestUpdate()\n    });\n  }\n\n  detach() {\n    this.strategy.destroy(), this._bitmapView.removeAllChildren(), this.container.removeAllChildren(), this.updateRequested = !1;\n  }\n\n  redraw() {\n    this.strategy.updateExports(e => {\n      e.source instanceof HTMLImageElement ? e.requestRender() : this.layer.applyRenderer({\n        pixelBlock: e.source.pixelBlock\n      }).then(t => {\n        const r = e.source;\n        r.pixelBlock = t.pixelBlock, r.filter = e => this.layer.applyFilter(e), this.container.requestRender();\n      });\n    });\n  }\n\n  requestUpdate() {\n    this.updateRequested || (this.updateRequested = !0, this.view.requestUpdate());\n  }\n\n  isUpdating() {\n    return this.strategy.updating || this.updateRequested;\n  }\n\n  getPixelData() {\n    if (this.updating) return null;\n    const e = this.strategy.bitmaps;\n    if (1 === e.length && e[0].source) return {\n      extent: e[0].source.extent,\n      pixelBlock: e[0].source.originalPixelBlock\n    };\n\n    if (e.length > 1) {\n      const t = this.view.extent,\n            r = e.map(e => e.source).filter(e => e.extent && e.extent.intersects(t)).map(e => ({\n        extent: e.extent,\n        pixelBlock: e.originalPixelBlock\n      })),\n            i = n(r, t);\n      return s(i) ? {\n        extent: i.extent,\n        pixelBlock: i.pixelBlock\n      } : null;\n    }\n\n    return null;\n  }\n\n  _fetchImage(e, t, r, i) {\n    return (i = i || {}).timeExtent = this.timeExtent, i.requestAsImageElement = !0, this.layer.fetchImage(e, t, r, i).then(e => e.imageElement ? e.imageElement : this.layer.applyRenderer(e.pixelData, {\n      signal: i.signal\n    }).then(t => {\n      const r = new h(t.pixelBlock, t.extent.clone(), e.pixelData.pixelBlock);\n      return r.filter = e => this.layer.applyFilter(e), r;\n    }));\n  }\n\n};\ne([a()], u.prototype, \"attached\", void 0), e([a()], u.prototype, \"container\", void 0), e([a()], u.prototype, \"layer\", void 0), e([a()], u.prototype, \"strategy\", void 0), e([a()], u.prototype, \"timeExtent\", void 0), e([a()], u.prototype, \"view\", void 0), e([a()], u.prototype, \"updateRequested\", void 0), e([a()], u.prototype, \"updating\", null), e([a()], u.prototype, \"type\", void 0), u = e([p(\"esri.views.2d.layers.imagery.ImageryView2D\")], u);\nconst y = u;\nexport { y as default };","map":{"version":3,"sources":["D:/Github/CUSP_DataBase/CUSP_DB/src/main/gis/node_modules/@arcgis/core/views/2d/layers/imagery/ImageryView2D.js"],"names":["_","e","t","r","i","isSome","s","isAbortError","o","property","a","subclass","p","mosaicPixelData","n","BitmapContainer","l","Container","c","h","m","d","getLogger","u","constructor","arguments","attached","container","updateRequested","type","_bitmapView","destroy","detach","updating","isUpdating","update","strategy","catch","error","hitTest","attributes","geometry","clone","layer","attach","addChild","version","imageMaxHeight","imageMaxWidth","imageNormalizationSupported","fetchSource","_fetchImage","bind","requestUpdate","removeAllChildren","redraw","updateExports","source","HTMLImageElement","requestRender","applyRenderer","pixelBlock","then","filter","applyFilter","view","getPixelData","bitmaps","length","extent","originalPixelBlock","map","intersects","timeExtent","requestAsImageElement","fetchImage","imageElement","pixelData","signal","prototype","y","default"],"mappings":"AAAA;AACA;AACA;AACA;AACA,SAAOA,CAAC,IAAIC,CAAZ,QAAkB,iCAAlB;AAAoD,OAAOC,CAAP,MAAa,wBAAb;AAAsC,OAAOC,CAAP,MAAa,8BAAb;AAA4C,OAAOC,CAAP,MAAa,4BAAb;AAA0C,SAAOC,MAAM,IAAIC,CAAjB,QAAuB,2BAAvB;AAAmD,SAAOC,YAAY,IAAIC,CAAvB,QAA6B,kCAA7B;AAAgE,SAAOC,QAAQ,IAAIC,CAAnB,QAAyB,yDAAzB;AAAmF,OAAM,gCAAN;AAAuC,OAAM,yBAAN;AAAgC,OAAM,gDAAN;AAAuD,SAAOC,QAAQ,IAAIC,CAAnB,QAAyB,yDAAzB;AAAmF,SAAOC,eAAe,IAAIC,CAA1B,QAAgC,0DAAhC;AAA2F,SAAOC,eAAe,IAAIC,CAA1B,QAAgC,iCAAhC;AAAkE,SAAOC,SAAS,IAAIC,CAApB,QAA0B,2BAA1B;AAAsD,OAAOC,CAAP,MAAa,qCAAb;AAAmD,OAAOC,CAAP,MAAa,8BAAb;AAA4C,MAAMC,CAAC,GAACjB,CAAC,CAACkB,SAAF,CAAY,4CAAZ,CAAR;AAAkE,IAAIC,CAAC,GAAC,cAAcpB,CAAd,CAAe;AAACqB,EAAAA,WAAW,GAAE;AAAC,UAAM,GAAGC,SAAT,GAAoB,KAAKC,QAAL,GAAc,CAAC,CAAnC,EAAqC,KAAKC,SAAL,GAAe,IAAIT,CAAJ,EAApD,EAA0D,KAAKU,eAAL,GAAqB,CAAC,CAAhF,EAAkF,KAAKC,IAAL,GAAU,SAA5F,EAAsG,KAAKC,WAAL,GAAiB,IAAId,CAAJ,EAAvH;AAA6H;;AAAAe,EAAAA,OAAO,GAAE;AAAC,SAAKL,QAAL,KAAgB,KAAKM,MAAL,IAAc,KAAKN,QAAL,GAAc,CAAC,CAA7C,GAAgD,KAAKE,eAAL,GAAqB,CAAC,CAAtE;AAAwE;;AAAY,MAARK,QAAQ,GAAE;AAAC,WAAM,CAAC,KAAKP,QAAN,IAAgB,KAAKQ,UAAL,EAAtB;AAAwC;;AAAAC,EAAAA,MAAM,CAAClC,CAAD,EAAG;AAAC,SAAKmC,QAAL,CAAcD,MAAd,CAAqBlC,CAArB,EAAwBoC,KAAxB,CAA+BpC,CAAC,IAAE;AAACO,MAAAA,CAAC,CAACP,CAAD,CAAD,IAAMoB,CAAC,CAACiB,KAAF,CAAQrC,CAAR,CAAN;AAAiB,KAApD;AAAuD;;AAAAsC,EAAAA,OAAO,CAACtC,CAAD,EAAG;AAAC,WAAO,IAAIC,CAAJ,CAAM;AAACsC,MAAAA,UAAU,EAAC,EAAZ;AAAeC,MAAAA,QAAQ,EAACxC,CAAC,CAACyC,KAAF,EAAxB;AAAkCC,MAAAA,KAAK,EAAC,KAAKA;AAA7C,KAAN,CAAP;AAAkE;;AAAAC,EAAAA,MAAM,GAAE;AAAC,SAAKjB,SAAL,CAAekB,QAAf,CAAwB,KAAKf,WAA7B;AAA0C,UAAM7B,CAAC,GAAC,KAAK0C,KAAL,CAAWG,OAAX,IAAoB,EAA5B;AAAA,UAA+B5C,CAAC,GAAC,KAAKyC,KAAL,CAAWG,OAAX,IAAoB,IAApB,GAAyB,KAAKH,KAAL,CAAWI,cAApC,GAAmD,IAApF;AAAA,UAAyF5C,CAAC,GAAC,KAAKwC,KAAL,CAAWG,OAAX,IAAoB,IAApB,GAAyB,KAAKH,KAAL,CAAWK,aAApC,GAAkD,IAA7I;AAAkJ,SAAKZ,QAAL,GAAc,IAAIhB,CAAJ,CAAM;AAACO,MAAAA,SAAS,EAAC,KAAKG,WAAhB;AAA4BmB,MAAAA,2BAA2B,EAAChD,CAAxD;AAA0D8C,MAAAA,cAAc,EAAC7C,CAAzE;AAA2E8C,MAAAA,aAAa,EAAC7C,CAAzF;AAA2F+C,MAAAA,WAAW,EAAC,KAAKC,WAAL,CAAiBC,IAAjB,CAAsB,IAAtB,CAAvG;AAAmIC,MAAAA,aAAa,EAAC,MAAI,KAAKA,aAAL;AAArJ,KAAN,CAAd;AAAgM;;AAAArB,EAAAA,MAAM,GAAE;AAAC,SAAKI,QAAL,CAAcL,OAAd,IAAwB,KAAKD,WAAL,CAAiBwB,iBAAjB,EAAxB,EAA6D,KAAK3B,SAAL,CAAe2B,iBAAf,EAA7D,EAAgG,KAAK1B,eAAL,GAAqB,CAAC,CAAtH;AAAwH;;AAAA2B,EAAAA,MAAM,GAAE;AAAC,SAAKnB,QAAL,CAAcoB,aAAd,CAA6BvD,CAAC,IAAE;AAACA,MAAAA,CAAC,CAACwD,MAAF,YAAoBC,gBAApB,GAAqCzD,CAAC,CAAC0D,aAAF,EAArC,GAAuD,KAAKhB,KAAL,CAAWiB,aAAX,CAAyB;AAACC,QAAAA,UAAU,EAAC5D,CAAC,CAACwD,MAAF,CAASI;AAArB,OAAzB,EAA2DC,IAA3D,CAAiE5D,CAAC,IAAE;AAAC,cAAMC,CAAC,GAACF,CAAC,CAACwD,MAAV;AAAiBtD,QAAAA,CAAC,CAAC0D,UAAF,GAAa3D,CAAC,CAAC2D,UAAf,EAA0B1D,CAAC,CAAC4D,MAAF,GAAS9D,CAAC,IAAE,KAAK0C,KAAL,CAAWqB,WAAX,CAAuB/D,CAAvB,CAAtC,EAAgE,KAAK0B,SAAL,CAAegC,aAAf,EAAhE;AAA+F,OAArL,CAAvD;AAA+O,KAAhR;AAAmR;;AAAAN,EAAAA,aAAa,GAAE;AAAC,SAAKzB,eAAL,KAAuB,KAAKA,eAAL,GAAqB,CAAC,CAAtB,EAAwB,KAAKqC,IAAL,CAAUZ,aAAV,EAA/C;AAA0E;;AAAAnB,EAAAA,UAAU,GAAE;AAAC,WAAO,KAAKE,QAAL,CAAcH,QAAd,IAAwB,KAAKL,eAApC;AAAoD;;AAAAsC,EAAAA,YAAY,GAAE;AAAC,QAAG,KAAKjC,QAAR,EAAiB,OAAO,IAAP;AAAY,UAAMhC,CAAC,GAAC,KAAKmC,QAAL,CAAc+B,OAAtB;AAA8B,QAAG,MAAIlE,CAAC,CAACmE,MAAN,IAAcnE,CAAC,CAAC,CAAD,CAAD,CAAKwD,MAAtB,EAA6B,OAAM;AAACY,MAAAA,MAAM,EAACpE,CAAC,CAAC,CAAD,CAAD,CAAKwD,MAAL,CAAYY,MAApB;AAA2BR,MAAAA,UAAU,EAAC5D,CAAC,CAAC,CAAD,CAAD,CAAKwD,MAAL,CAAYa;AAAlD,KAAN;;AAA4E,QAAGrE,CAAC,CAACmE,MAAF,GAAS,CAAZ,EAAc;AAAC,YAAMlE,CAAC,GAAC,KAAK+D,IAAL,CAAUI,MAAlB;AAAA,YAAyBlE,CAAC,GAACF,CAAC,CAACsE,GAAF,CAAOtE,CAAC,IAAEA,CAAC,CAACwD,MAAZ,EAAqBM,MAArB,CAA6B9D,CAAC,IAAEA,CAAC,CAACoE,MAAF,IAAUpE,CAAC,CAACoE,MAAF,CAASG,UAAT,CAAoBtE,CAApB,CAA1C,EAAmEqE,GAAnE,CAAwEtE,CAAC,KAAG;AAACoE,QAAAA,MAAM,EAACpE,CAAC,CAACoE,MAAV;AAAiBR,QAAAA,UAAU,EAAC5D,CAAC,CAACqE;AAA9B,OAAH,CAAzE,CAA3B;AAAA,YAA4JlE,CAAC,GAACU,CAAC,CAACX,CAAD,EAAGD,CAAH,CAA/J;AAAqK,aAAOI,CAAC,CAACF,CAAD,CAAD,GAAK;AAACiE,QAAAA,MAAM,EAACjE,CAAC,CAACiE,MAAV;AAAiBR,QAAAA,UAAU,EAACzD,CAAC,CAACyD;AAA9B,OAAL,GAA+C,IAAtD;AAA2D;;AAAA,WAAO,IAAP;AAAY;;AAAAV,EAAAA,WAAW,CAAClD,CAAD,EAAGC,CAAH,EAAKC,CAAL,EAAOC,CAAP,EAAS;AAAC,WAAM,CAACA,CAAC,GAACA,CAAC,IAAE,EAAN,EAAUqE,UAAV,GAAqB,KAAKA,UAA1B,EAAqCrE,CAAC,CAACsE,qBAAF,GAAwB,CAAC,CAA9D,EAAgE,KAAK/B,KAAL,CAAWgC,UAAX,CAAsB1E,CAAtB,EAAwBC,CAAxB,EAA0BC,CAA1B,EAA4BC,CAA5B,EAA+B0D,IAA/B,CAAqC7D,CAAC,IAAEA,CAAC,CAAC2E,YAAF,GAAe3E,CAAC,CAAC2E,YAAjB,GAA8B,KAAKjC,KAAL,CAAWiB,aAAX,CAAyB3D,CAAC,CAAC4E,SAA3B,EAAqC;AAACC,MAAAA,MAAM,EAAC1E,CAAC,CAAC0E;AAAV,KAArC,EAAwDhB,IAAxD,CAA8D5D,CAAC,IAAE;AAAC,YAAMC,CAAC,GAAC,IAAIgB,CAAJ,CAAMjB,CAAC,CAAC2D,UAAR,EAAmB3D,CAAC,CAACmE,MAAF,CAAS3B,KAAT,EAAnB,EAAoCzC,CAAC,CAAC4E,SAAF,CAAYhB,UAAhD,CAAR;AAAoE,aAAO1D,CAAC,CAAC4D,MAAF,GAAS9D,CAAC,IAAE,KAAK0C,KAAL,CAAWqB,WAAX,CAAuB/D,CAAvB,CAAZ,EAAsCE,CAA7C;AAA+C,KAArL,CAAtE,CAAtE;AAAsU;;AAAzmE,CAArB;AAAgoEF,CAAC,CAAC,CAACS,CAAC,EAAF,CAAD,EAAOa,CAAC,CAACwD,SAAT,EAAmB,UAAnB,EAA8B,KAAK,CAAnC,CAAD,EAAuC9E,CAAC,CAAC,CAACS,CAAC,EAAF,CAAD,EAAOa,CAAC,CAACwD,SAAT,EAAmB,WAAnB,EAA+B,KAAK,CAApC,CAAxC,EAA+E9E,CAAC,CAAC,CAACS,CAAC,EAAF,CAAD,EAAOa,CAAC,CAACwD,SAAT,EAAmB,OAAnB,EAA2B,KAAK,CAAhC,CAAhF,EAAmH9E,CAAC,CAAC,CAACS,CAAC,EAAF,CAAD,EAAOa,CAAC,CAACwD,SAAT,EAAmB,UAAnB,EAA8B,KAAK,CAAnC,CAApH,EAA0J9E,CAAC,CAAC,CAACS,CAAC,EAAF,CAAD,EAAOa,CAAC,CAACwD,SAAT,EAAmB,YAAnB,EAAgC,KAAK,CAArC,CAA3J,EAAmM9E,CAAC,CAAC,CAACS,CAAC,EAAF,CAAD,EAAOa,CAAC,CAACwD,SAAT,EAAmB,MAAnB,EAA0B,KAAK,CAA/B,CAApM,EAAsO9E,CAAC,CAAC,CAACS,CAAC,EAAF,CAAD,EAAOa,CAAC,CAACwD,SAAT,EAAmB,iBAAnB,EAAqC,KAAK,CAA1C,CAAvO,EAAoR9E,CAAC,CAAC,CAACS,CAAC,EAAF,CAAD,EAAOa,CAAC,CAACwD,SAAT,EAAmB,UAAnB,EAA8B,IAA9B,CAArR,EAAyT9E,CAAC,CAAC,CAACS,CAAC,EAAF,CAAD,EAAOa,CAAC,CAACwD,SAAT,EAAmB,MAAnB,EAA0B,KAAK,CAA/B,CAA1T,EAA4VxD,CAAC,GAACtB,CAAC,CAAC,CAACW,CAAC,CAAC,4CAAD,CAAF,CAAD,EAAmDW,CAAnD,CAA/V;AAAqZ,MAAMyD,CAAC,GAACzD,CAAR;AAAU,SAAOyD,CAAC,IAAIC,OAAZ","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import t from\"../../../../Graphic.js\";import r from\"../../../../core/Accessor.js\";import i from\"../../../../core/Logger.js\";import{isSome as s}from\"../../../../core/maybe.js\";import{isAbortError as o}from\"../../../../core/promiseUtils.js\";import{property as a}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/arrayUtils.js\";import\"../../../../core/has.js\";import\"../../../../core/accessorSupport/ensureType.js\";import{subclass as p}from\"../../../../core/accessorSupport/decorators/subclass.js\";import{mosaicPixelData as n}from\"../../../../layers/support/rasterFunctions/pixelUtils.js\";import{BitmapContainer as l}from\"../../engine/BitmapContainer.js\";import{Container as c}from\"../../engine/Container.js\";import h from\"../../engine/ImageryBitmapSource.js\";import m from\"../support/ExportStrategy.js\";const d=i.getLogger(\"esri.views.2d.layers.imagery.ImageryView2D\");let u=class extends r{constructor(){super(...arguments),this.attached=!1,this.container=new c,this.updateRequested=!1,this.type=\"imagery\",this._bitmapView=new l}destroy(){this.attached&&(this.detach(),this.attached=!1),this.updateRequested=!1}get updating(){return!this.attached||this.isUpdating()}update(e){this.strategy.update(e).catch((e=>{o(e)||d.error(e)}))}hitTest(e){return new t({attributes:{},geometry:e.clone(),layer:this.layer})}attach(){this.container.addChild(this._bitmapView);const e=this.layer.version>=10,t=this.layer.version>=10.1?this.layer.imageMaxHeight:2048,r=this.layer.version>=10.1?this.layer.imageMaxWidth:2048;this.strategy=new m({container:this._bitmapView,imageNormalizationSupported:e,imageMaxHeight:t,imageMaxWidth:r,fetchSource:this._fetchImage.bind(this),requestUpdate:()=>this.requestUpdate()})}detach(){this.strategy.destroy(),this._bitmapView.removeAllChildren(),this.container.removeAllChildren(),this.updateRequested=!1}redraw(){this.strategy.updateExports((e=>{e.source instanceof HTMLImageElement?e.requestRender():this.layer.applyRenderer({pixelBlock:e.source.pixelBlock}).then((t=>{const r=e.source;r.pixelBlock=t.pixelBlock,r.filter=e=>this.layer.applyFilter(e),this.container.requestRender()}))}))}requestUpdate(){this.updateRequested||(this.updateRequested=!0,this.view.requestUpdate())}isUpdating(){return this.strategy.updating||this.updateRequested}getPixelData(){if(this.updating)return null;const e=this.strategy.bitmaps;if(1===e.length&&e[0].source)return{extent:e[0].source.extent,pixelBlock:e[0].source.originalPixelBlock};if(e.length>1){const t=this.view.extent,r=e.map((e=>e.source)).filter((e=>e.extent&&e.extent.intersects(t))).map((e=>({extent:e.extent,pixelBlock:e.originalPixelBlock}))),i=n(r,t);return s(i)?{extent:i.extent,pixelBlock:i.pixelBlock}:null}return null}_fetchImage(e,t,r,i){return(i=i||{}).timeExtent=this.timeExtent,i.requestAsImageElement=!0,this.layer.fetchImage(e,t,r,i).then((e=>e.imageElement?e.imageElement:this.layer.applyRenderer(e.pixelData,{signal:i.signal}).then((t=>{const r=new h(t.pixelBlock,t.extent.clone(),e.pixelData.pixelBlock);return r.filter=e=>this.layer.applyFilter(e),r}))))}};e([a()],u.prototype,\"attached\",void 0),e([a()],u.prototype,\"container\",void 0),e([a()],u.prototype,\"layer\",void 0),e([a()],u.prototype,\"strategy\",void 0),e([a()],u.prototype,\"timeExtent\",void 0),e([a()],u.prototype,\"view\",void 0),e([a()],u.prototype,\"updateRequested\",void 0),e([a()],u.prototype,\"updating\",null),e([a()],u.prototype,\"type\",void 0),u=e([p(\"esri.views.2d.layers.imagery.ImageryView2D\")],u);const y=u;export{y as default};\n"]},"metadata":{},"sourceType":"module"}