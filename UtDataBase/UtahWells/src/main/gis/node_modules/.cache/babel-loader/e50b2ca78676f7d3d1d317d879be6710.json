{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport e from \"../../../Graphic.js\";\nimport t from \"../../../request.js\";\nimport r from \"../../Attachment.js\";\nimport i from \"../support/FeatureSet.js\";\nimport s from \"../support/IdSet.js\";\nimport { defaultMaxRecords as a, stableStringify as n, FeatureServiceDatabaseType as l, IdState as o, extractServiceUrl as u } from \"../support/shared.js\";\nimport { toWhereClause as d, isSingleField as h } from \"../support/sqlUtils.js\";\nimport { decodeStatType as p } from \"../support/stats.js\";\nimport { createMD5Hash as c, outputTypes as y } from \"../../../core/MD5.js\";\nimport { id as f } from \"../../../kernel.js\";\nimport { create as _, resolve as m, reject as g } from \"../../../core/promiseUtils.js\";\nimport { fromJSON as F } from \"../../../geometry/support/jsonUtils.js\";\nimport S from \"../../../layers/FeatureLayer.js\";\nimport { convertToFeatureSet as b } from \"../../../layers/graphics/featureConversionUtils.js\";\nimport \"../../../core/urlUtils.js\";\nimport \"../../../core/unitUtils.js\";\nimport \"../../../rest/query/support/AttachmentInfo.js\";\nimport \"../../../rest/support/AttachmentQuery.js\";\nimport { executeForCount as R } from \"../../../rest/query/executeForCount.js\";\nimport \"../../../geometry.js\";\nimport { executeQueryPBF as D } from \"../../../rest/query/operations/query.js\";\nimport x from \"../../../rest/support/Query.js\";\nimport { executeForIds as w } from \"../../../rest/query/executeForIds.js\";\nimport { executeQueryJSON as I } from \"../../../rest/query/executeQueryJSON.js\";\nimport \"../../../core/has.js\";\nimport \"../../../geometry/support/spatialReferenceUtils.js\";\nimport q from \"../../../rest/support/FeatureSet.js\";\nimport \"../../../rest/support/RelationshipQuery.js\";\nimport \"../../../geometry/support/normalizeUtils.js\";\nimport \"../../../rest/support/TopFeaturesQuery.js\";\nimport { OptimizedFeatureSetParserContext as P } from \"../../../rest/query/operations/pbfOptimizedFeatureSet.js\";\nimport v from \"../../../rest/support/StatisticDefinition.js\";\nimport C from \"../../Dictionary.js\";\n\nclass j extends i {\n  constructor(e) {\n    super(e), this.declaredClass = \"esri.arcade.featureset.sources.FeatureLayerDynamic\", this._removeGeometry = !1, this._overrideFields = null, this.formulaCredential = null, this._pageJustIds = !1, this._requestStandardised = !1, this._useDefinitionExpression = !0, e.spatialReference && (this.spatialReference = e.spatialReference), this._transparent = !0, this._maxProcessing = 1e3, this._layer = e.layer, this._wset = null, void 0 !== e.outFields && (this._overrideFields = e.outFields), void 0 !== e.includeGeometry && (this._removeGeometry = !1 === e.includeGeometry);\n  }\n\n  _maxQueryRate() {\n    return a;\n  }\n\n  end() {\n    return this._layer;\n  }\n\n  optimisePagingFeatureQueries(e) {\n    this._pageJustIds = e;\n  }\n\n  convertQueryToLruCacheKey(e) {\n    const t = n(e.toJSON());\n    return c(t, y.String);\n  }\n\n  load() {\n    return null === this._loadPromise && (this._loadPromise = _((e, t) => {\n      try {\n        if (!0 === this._layer.loaded) return this._initialiseFeatureSet(), void e(this);\n        this._layer.when().then(() => {\n          try {\n            this._initialiseFeatureSet(), e(this);\n          } catch (r) {\n            t(r);\n          }\n        }, t), this._layer.load();\n      } catch (r) {\n        t(r);\n      }\n    })), this._loadPromise;\n  }\n\n  _initialiseFeatureSet() {\n    if (null == this.spatialReference && (this.spatialReference = this._layer.spatialReference), this.geometryType = this._layer.geometryType, this.fields = this._layer.fields.slice(0), this._layer.outFields) {\n      if (1 === this._layer.outFields.length && \"*\" === this._layer.outFields[0]) ;else {\n        const e = [];\n\n        for (const t of this.fields) if (\"oid\" === t.type) e.push(t);else for (const r of this._layer.outFields) if (r.toLowerCase() === t.name.toLowerCase()) {\n          e.push(t);\n          break;\n        }\n\n        this.fields = e;\n      }\n    } else ;\n    if (null !== this._overrideFields) if (1 === this._overrideFields.length && \"*\" === this._overrideFields[0]) this._overrideFields = null;else {\n      const e = [],\n            t = [];\n\n      for (const r of this.fields) if (\"oid\" === r.type) e.push(r), t.push(r.name);else for (const i of this._overrideFields) if (i.toLowerCase() === r.name.toLowerCase()) {\n        e.push(r), t.push(r.name);\n        break;\n      }\n\n      this.fields = e, this._overrideFields = t;\n    }\n\n    if (this._layer.source && this._layer.source.sourceJSON) {\n      const e = this._layer.source.sourceJSON.currentVersion;\n      !0 === this._layer.source.sourceJSON.useStandardizedQueries ? (this._databaseType = l.StandardisedNoInterval, null != e && e >= 10.61 && (this._databaseType = l.Standardised)) : null != e && (e >= 10.5 && (this._databaseType = l.StandardisedNoInterval, this._requestStandardised = !0), e >= 10.61 && (this._databaseType = l.Standardised));\n    }\n\n    this.objectIdField = this._layer.objectIdField;\n\n    for (const e of this.fields) \"global-id\" === e.type && (this.globalIdField = e.name);\n\n    this.hasM = this._layer.supportsM, this.hasZ = this._layer.supportsZ, this.typeIdField = this._layer.typeIdField, this.types = this._layer.types;\n  }\n\n  _isInFeatureSet() {\n    return o.InFeatureSet;\n  }\n\n  _refineSetBlock(e) {\n    return m(e);\n  }\n\n  _candidateIdTransform(e) {\n    return e;\n  }\n\n  _getSet(e) {\n    return null === this._wset ? this._ensureLoaded().then(() => this._getFilteredSet(\"\", null, null, null, e)).then(e => (this._wset = e, e)) : m(this._wset);\n  }\n\n  _runDatabaseProbe(e) {\n    return _((t, r) => {\n      try {\n        this._ensureLoaded().then(() => {\n          try {\n            const i = new x();\n            i.where = e.replace(\"OBJECTID\", this._layer.objectIdField), this._layer.queryObjectIds(i).then(() => {\n              t(!0);\n            }, () => {\n              try {\n                t(!1);\n              } catch (e) {\n                r(e);\n              }\n            });\n          } catch (i) {\n            r(i);\n          }\n        });\n      } catch (i) {\n        r(i);\n      }\n    });\n  }\n\n  _canUsePagination() {\n    return !(!this._layer.capabilities || !this._layer.capabilities.query || !0 !== this._layer.capabilities.query.supportsPagination);\n  }\n\n  _cacheableFeatureSetSourceKey() {\n    return this._layer.url;\n  }\n\n  pbfSupportedForQuery(e) {\n    return !e.outStatistics && this._layer && this._layer.capabilities && this._layer.capabilities.query && !0 === this._layer.capabilities.query.supportsFormatPBF && !0 === this._layer.capabilities.query.supportsQuantizationEditMode;\n  }\n\n  queryPBF(e) {\n    return e.quantizationParameters = {\n      mode: \"edit\"\n    }, D(this._layer.parsedUrl, e, new P({})).then(e => q.fromJSON(b(e.data)).unquantize());\n  }\n\n  get gdbVersion() {\n    return this._layer && this._layer.capabilities && this._layer.capabilities.data && this._layer.capabilities.data.isVersioned ? this._layer.gdbVersion ? this._layer.gdbVersion : \"SDE.DEFAULT\" : \"\";\n  }\n\n  nativeCapabilities() {\n    return {\n      title: this._layer.title,\n      source: this,\n      canQueryRelated: !0,\n      capabilities: this._layer.capabilities,\n      databaseType: this._databaseType,\n      requestStandardised: this._requestStandardised\n    };\n  }\n\n  executeQuery(e, t) {\n    const r = \"execute\" === t ? I : \"executeForCount\" === t ? R : w,\n          i = \"execute\" === t && this.pbfSupportedForQuery(e);\n    let s = null;\n\n    if (this.recentlyUsedQueries) {\n      const t = this.convertQueryToLruCacheKey(e);\n      s = this.recentlyUsedQueries.getFromCache(t), null === s && (s = !0 !== i ? r(this._layer.parsedUrl.path, e) : this.queryPBF(e), this.recentlyUsedQueries.addToCache(t, s), s = s.catch(e => {\n        throw this.recentlyUsedQueries.removeFromCache(t), e;\n      }));\n    }\n\n    return this.featureSetQueryInterceptor && this.featureSetQueryInterceptor.preLayerQueryCallback({\n      layer: this._layer,\n      query: e,\n      method: t\n    }), null === s && (s = !0 !== i ? r(this._layer.parsedUrl.path, e) : this.queryPBF(e)), s;\n  }\n\n  _getFilteredSet(e, t, r, i, a) {\n    return this.databaseType().then(n => {\n      if (this.isTable() && t && null !== e && \"\" !== e) {\n        return new s([], [], !0, null);\n      }\n\n      if (this._canUsePagination()) return this._getFilteredSetUsingPaging(e, t, r, i, a);\n      let l = \"\",\n          o = !1;\n      null !== i && this._layer.capabilities && this._layer.capabilities.query && !0 === this._layer.capabilities.query.supportsOrderBy && (l = i.constructClause(), o = !0);\n      const u = new x();\n      return u.where = null === r ? null === t ? \"1=1\" : \"\" : d(r, n), this._requestStandardised && (u.sqlFormat = \"standard\"), u.spatialRelationship = this._makeRelationshipEnum(e), u.outSpatialReference = this.spatialReference, u.orderByFields = \"\" !== l ? l.split(\",\") : null, u.geometry = null === t ? null : t, u.relationParameter = this._makeRelationshipParam(e), this.executeQuery(u, \"executeForIds\").then(e => {\n        null === e && (e = []), this._checkCancelled(a);\n        return new s([], e, o, null);\n      });\n    });\n  }\n\n  _expandPagedSet(e, t, r, i, s) {\n    return this._expandPagedSetFeatureSet(e, t, r, i, s);\n  }\n\n  _getFilteredSetUsingPaging(e, t, r, i, a) {\n    try {\n      let n = \"\",\n          l = !1;\n      return null !== i && this._layer.capabilities && this._layer.capabilities.query && !0 === this._layer.capabilities.query.supportsOrderBy && (n = i.constructClause(), l = !0), this.databaseType().then(i => {\n        let o = null === r ? null === t ? \"1=1\" : \"\" : d(r, i);\n        this._layer.definitionExpression && this._useDefinitionExpression && (o = \"\" !== o ? \"((\" + this._layer.definitionExpression + \") AND (\" + o + \"))\" : this._layer.definitionExpression);\n\n        let u = this._maxQueryRate();\n\n        const h = this._layer.capabilities.query.maxRecordCount;\n        void 0 !== h && h < u && (u = h);\n        let p = null;\n        if (!0 === this._pageJustIds) p = new s([], [\"GETPAGES\"], l, {\n          spatialRel: this._makeRelationshipEnum(e),\n          relationParam: this._makeRelationshipParam(e),\n          outFields: this._layer.objectIdField,\n          resultRecordCount: u,\n          resultOffset: 0,\n          geometry: null === t ? null : t,\n          where: o,\n          orderByFields: n,\n          returnGeometry: !1,\n          returnIdsOnly: \"false\",\n          internal: {\n            set: [],\n            lastRetrieved: 0,\n            lastPage: 0,\n            fullyResolved: !1\n          }\n        });else {\n          let r = !0;\n          !0 === this._removeGeometry && (r = !1);\n          const i = null !== this._overrideFields ? this._overrideFields : this._fieldsIncludingObjectId(this._layer.outFields ? this._layer.outFields : [\"*\"]);\n          p = new s([], [\"GETPAGES\"], l, {\n            spatialRel: this._makeRelationshipEnum(e),\n            relationParam: this._makeRelationshipParam(e),\n            outFields: i.join(\",\"),\n            resultRecordCount: u,\n            resultOffset: 0,\n            geometry: null === t ? null : t,\n            where: o,\n            orderByFields: n,\n            returnGeometry: r,\n            returnIdsOnly: \"false\",\n            internal: {\n              set: [],\n              lastRetrieved: 0,\n              lastPage: 0,\n              fullyResolved: !1\n            }\n          });\n        }\n        return this._expandPagedSet(p, u, 0, 1, a).then(() => p);\n      });\n    } catch (n) {\n      return g(n);\n    }\n  }\n\n  _clonePageDefinition(e) {\n    return null === e ? null : !0 !== e.groupbypage ? {\n      groupbypage: !1,\n      spatialRel: e.spatialRel,\n      relationParam: e.relationParam,\n      outFields: e.outFields,\n      resultRecordCount: e.resultRecordCount,\n      resultOffset: e.resultOffset,\n      geometry: e.geometry,\n      where: e.where,\n      orderByFields: e.orderByFields,\n      returnGeometry: e.returnGeometry,\n      returnIdsOnly: e.returnIdsOnly,\n      internal: e.internal\n    } : {\n      groupbypage: !0,\n      spatialRel: e.spatialRel,\n      relationParam: e.relationParam,\n      outFields: e.outFields,\n      resultRecordCount: e.resultRecordCount,\n      useOIDpagination: e.useOIDpagination,\n      generatedOid: e.generatedOid,\n      groupByFieldsForStatistics: e.groupByFieldsForStatistics,\n      resultOffset: e.resultOffset,\n      outStatistics: e.outStatistics,\n      geometry: e.geometry,\n      where: e.where,\n      orderByFields: e.orderByFields,\n      returnGeometry: e.returnGeometry,\n      returnIdsOnly: e.returnIdsOnly,\n      internal: e.internal\n    };\n  }\n\n  _getPhysicalPage(e, t, r) {\n    try {\n      const t = e.pagesDefinition.internal.lastRetrieved,\n            i = t,\n            s = e.pagesDefinition.internal.lastPage,\n            a = new x();\n      return this._requestStandardised && (a.sqlFormat = \"standard\"), a.spatialRelationship = e.pagesDefinition.spatialRel, a.relationParameter = e.pagesDefinition.relationParam, a.outFields = e.pagesDefinition.outFields.split(\",\"), a.num = e.pagesDefinition.resultRecordCount, a.start = e.pagesDefinition.internal.lastPage, a.geometry = e.pagesDefinition.geometry, a.where = e.pagesDefinition.where, a.orderByFields = \"\" !== e.pagesDefinition.orderByFields ? e.pagesDefinition.orderByFields.split(\",\") : null, a.returnGeometry = e.pagesDefinition.returnGeometry, a.outSpatialReference = this.spatialReference, this.executeQuery(a, \"execute\").then(a => {\n        if (this._checkCancelled(r), e.pagesDefinition.internal.lastPage !== s) return \"done\";\n\n        for (let t = 0; t < a.features.length; t++) e.pagesDefinition.internal.set[i + t] = a.features[t].attributes[this._layer.objectIdField];\n\n        if (!1 === this._pageJustIds) for (let e = 0; e < a.features.length; e++) this._featureCache[a.features[e].attributes[this._layer.objectIdField]] = a.features[e];\n        return (void 0 === a.exceededTransferLimit && a.features.length !== e.pagesDefinition.resultRecordCount || !1 === a.exceededTransferLimit) && (e.pagesDefinition.internal.fullyResolved = !0), e.pagesDefinition.internal.lastRetrieved = t + a.features.length, e.pagesDefinition.internal.lastPage += e.pagesDefinition.resultRecordCount, \"done\";\n      });\n    } catch (i) {\n      return g(i);\n    }\n  }\n\n  _fieldsIncludingObjectId(e) {\n    if (null === e) return [this.objectIdField];\n    const t = e.slice(0);\n    if (t.indexOf(\"*\") > -1) return t;\n    let r = !1;\n\n    for (const i of t) if (i.toUpperCase() === this.objectIdField.toUpperCase()) {\n      r = !0;\n      break;\n    }\n\n    return !1 === r && t.push(this.objectIdField), t;\n  }\n\n  _getFeatures(e, t, r, i) {\n    const s = [];\n\n    try {\n      if (-1 !== t && void 0 === this._featureCache[t] && s.push(t), !0 === this._checkIfNeedToExpandKnownPage(e, this._maxProcessingRate())) return this._expandPagedSet(e, this._maxProcessingRate(), 0, 0, i).then(() => this._getFeatures(e, t, r, i));\n      let n = 0;\n\n      for (let i = e._lastFetchedIndex; i < e._known.length; i++) {\n        if (e._lastFetchedIndex += 1, n++, void 0 === this._featureCache[e._known[i]]) {\n          let r = !1;\n\n          if (null !== this._layer._mode && void 0 !== this._layer._mode) {\n            const t = this._layer._mode;\n\n            if (void 0 !== t._featureMap[e._known[i]]) {\n              const s = t._featureMap[e._known[i]];\n              null !== s && (r = !0, this._featureCache[e._known[i]] = s);\n            }\n          }\n\n          if (!1 === r && (e._known[i] !== t && s.push(e._known[i]), s.length >= this._maxProcessingRate() - 1)) break;\n        }\n\n        if (n >= r && 0 === s.length) break;\n      }\n\n      if (0 === s.length) return m(\"success\");\n\n      try {\n        const e = new x();\n        return this._requestStandardised && (e.sqlFormat = \"standard\"), e.objectIds = s, e.outFields = null !== this._overrideFields ? this._overrideFields : this._fieldsIncludingObjectId(this._layer.outFields ? this._layer.outFields : [\"*\"]), e.returnGeometry = !0, !0 === this._removeGeometry && (e.returnGeometry = !1), e.outSpatialReference = this.spatialReference, this.executeQuery(e, \"execute\").then(e => {\n          if (this._checkCancelled(i), void 0 !== e.error) return g(new Error(e.error));\n\n          for (let t = 0; t < e.features.length; t++) this._featureCache[e.features[t].attributes[this._layer.objectIdField]] = e.features[t];\n\n          return \"success\";\n        });\n      } catch (a) {\n        return g(a);\n      }\n    } catch (a) {\n      return g(a);\n    }\n  }\n\n  _getDistinctPages(e, t, r, i, s, a, n, l, o) {\n    return this._ensureLoaded().then(() => this.databaseType()).then(u => {\n      let h = r.parseTree.column;\n\n      for (let e = 0; e < this._layer.fields.length; e++) if (this._layer.fields[e].name.toLowerCase() === h.toLowerCase()) {\n        h = this._layer.fields[e].name;\n        break;\n      }\n\n      const p = new x();\n      this._requestStandardised && (p.sqlFormat = \"standard\");\n      let c = null === a ? null === s ? \"1=1\" : \"\" : d(a, u);\n      return this._layer.definitionExpression && this._useDefinitionExpression && (c = \"\" !== c ? \"((\" + this._layer.definitionExpression + \") AND (\" + c + \"))\" : this._layer.definitionExpression), p.where = c, p.spatialRelationship = this._makeRelationshipEnum(i), p.relationParameter = this._makeRelationshipParam(i), p.geometry = null === s ? null : s, p.returnDistinctValues = !0, p.returnGeometry = !1, p.outFields = [h], this.executeQuery(p, \"execute\").then(u => {\n        if (this._checkCancelled(o), !u.hasOwnProperty(\"features\")) return g(new Error(\"Unnexected Result querying statistics from layer\"));\n        let d = !1;\n\n        for (let e = 0; e < this._layer.fields.length; e++) if (this._layer.fields[e].name === h) {\n          \"date\" === this._layer.fields[e].type && (d = !0);\n          break;\n        }\n\n        for (let e = 0; e < u.features.length; e++) {\n          if (d) {\n            const t = u.features[e].attributes[h];\n            null !== t ? l.push(new Date(t)) : l.push(t);\n          } else l.push(u.features[e].attributes[h]);\n\n          if (l.length >= n) break;\n        }\n\n        return 0 === u.features.length ? l : u.features.length === this._layer.capabilities.query.maxRecordCount && l.length < n ? this._getDistinctPages(e + u.features.length, t, r, i, s, a, n, l, o).then(e => ({\n          calculated: !0,\n          result: e\n        })) : l;\n      });\n    });\n  }\n\n  _distinctStat(e, t, r, i, s, a, n) {\n    return this._getDistinctPages(0, e, t, r, i, s, a, [], n).then(e => ({\n      calculated: !0,\n      result: e\n    }));\n  }\n\n  isTable() {\n    return this._layer.isTable || null === this._layer.geometryType || \"table\" === this._layer.type || \"\" === this._layer.geometryType;\n  }\n\n  _countstat(e, t, r, i) {\n    return this.databaseType().then(e => {\n      const s = new x();\n      if (this._requestStandardised && (s.sqlFormat = \"standard\"), this.isTable() && r && null !== t && \"\" !== t) return {\n        calculated: !0,\n        result: 0\n      };\n      let a = null === i ? null === r ? \"1=1\" : \"\" : d(i, e);\n      return this._layer.definitionExpression && this._useDefinitionExpression && (a = \"\" !== a ? \"((\" + this._layer.definitionExpression + \") AND (\" + a + \"))\" : this._layer.definitionExpression), s.where = a, s.where = a, s.spatialRelationship = this._makeRelationshipEnum(t), s.relationParameter = this._makeRelationshipParam(t), s.geometry = null === r ? null : r, s.returnGeometry = !1, this.executeQuery(s, \"executeForCount\").then(e => ({\n        calculated: !0,\n        result: e\n      }));\n    });\n  }\n\n  _stats(e, t, r, i, s, a, n) {\n    return this._ensureLoaded().then(() => {\n      const l = this._layer.capabilities && this._layer.capabilities.query && !0 === this._layer.capabilities.query.supportsSqlExpression,\n            o = this._layer.capabilities && this._layer.capabilities.query && !0 === this._layer.capabilities.query.supportsStatistics,\n            u = this._layer.capabilities && this._layer.capabilities.query && !0 === this._layer.capabilities.query.supportsDistinct;\n      return \"count\" === e ? u ? this._countstat(e, r, i, s) : {\n        calculated: !1\n      } : !1 === o || !1 === h(t) && !1 === l || !1 === t.isStandardized ? \"\" !== r || null !== s ? {\n        calculated: !1\n      } : this._manualStat(e, t, a, n) : \"distinct\" === e ? !1 === u ? \"\" !== r || null !== s ? {\n        calculated: !1\n      } : this._manualStat(e, t, a, n) : this._distinctStat(e, t, r, i, s, a, n) : this.databaseType().then(a => {\n        if (this.isTable() && i && null !== r && \"\" !== r) return {\n          calculated: !0,\n          result: null\n        };\n        const n = new x();\n        this._requestStandardised && (n.sqlFormat = \"standard\");\n        let l = null === s ? null === i ? \"1=1\" : \"\" : d(s, a);\n        this._layer.definitionExpression && this._useDefinitionExpression && (l = \"\" !== l ? \"((\" + this._layer.definitionExpression + \") AND (\" + l + \"))\" : this._layer.definitionExpression), n.where = l, n.spatialRelationship = this._makeRelationshipEnum(r), n.relationParameter = this._makeRelationshipParam(r), n.geometry = null === i ? null : i;\n        const o = new v();\n        o.statisticType = p(e), o.onStatisticField = d(t, a), o.outStatisticFieldName = \"ARCADE_STAT_RESULT\", n.returnGeometry = !1;\n        let u = \"ARCADE_STAT_RESULT\";\n        return n.outStatistics = [o], this.executeQuery(n, \"execute\").then(e => {\n          if (!e.hasOwnProperty(\"features\") || 0 === e.features.length) return g(new Error(\"Unnexected Result querying statistics from layer\"));\n          let t = !1;\n\n          for (let r = 0; r < e.fields.length; r++) if (\"ARCADE_STAT_RESULT\" === e.fields[r].name.toUpperCase()) {\n            u = e.fields[r].name, \"date\" === e.fields[r].type && (t = !0);\n            break;\n          }\n\n          if (t) {\n            let t = e.features[0].attributes[u];\n            return null !== t && (t = new Date(e.features[0].attributes[u])), {\n              calculated: !0,\n              result: t\n            };\n          }\n\n          return {\n            calculated: !0,\n            result: e.features[0].attributes[u]\n          };\n        });\n      });\n    });\n  }\n\n  _stat(e, t, r, i, s, a, n) {\n    return this._stats(e, t, r, i, s, a, n);\n  }\n\n  _canDoAggregates(e, t) {\n    return this._ensureLoaded().then(() => {\n      let e = !1;\n      const r = this._layer.capabilities && this._layer.capabilities.query && !0 === this._layer.capabilities.query.supportsSqlExpression;\n      if (void 0 !== this._layer.capabilities && null !== this._layer.capabilities.query && !0 === this._layer.capabilities.query.supportsStatistics && !0 === this._layer.capabilities.query.supportsOrderBy && (e = !0), e) for (let i = 0; i < t.length - 1; i++) null !== t[i].workingexpr && (!1 === t[i].workingexpr.isStandardized || !1 === h(t[i].workingexpr) && !1 === r) && (e = !1);\n      return !1 !== e;\n    });\n  }\n\n  _makeRelationshipEnum(e) {\n    if (e.indexOf(\"esriSpatialRelRelation\") >= 0) return \"relation\";\n\n    switch (e) {\n      case \"esriSpatialRelRelation\":\n        return \"relation\";\n\n      case \"esriSpatialRelIntersects\":\n        return \"intersects\";\n\n      case \"esriSpatialRelContains\":\n        return \"contains\";\n\n      case \"esriSpatialRelOverlaps\":\n        return \"overlaps\";\n\n      case \"esriSpatialRelWithin\":\n        return \"within\";\n\n      case \"esriSpatialRelTouches\":\n        return \"touches\";\n\n      case \"esriSpatialRelCrosses\":\n        return \"crosses\";\n\n      case \"esriSpatialRelEnvelopeIntersects\":\n        return \"envelope-intersects\";\n    }\n\n    return e;\n  }\n\n  _makeRelationshipParam(e) {\n    return e.indexOf(\"esriSpatialRelRelation\") >= 0 ? e.split(\":\")[1] : \"\";\n  }\n\n  _getAggregatePagesDataSourceDefinition(e, t, r, i, a, n, l) {\n    return this._ensureLoaded().then(() => this.databaseType()).then(o => {\n      let u = \"\",\n          h = !1,\n          p = !1;\n      null !== n && this._layer.capabilities && this._layer.capabilities.query && !0 === this._layer.capabilities.query.supportsOrderBy && (u = n.constructClause(), p = !0), this._layer.capabilities && this._layer.capabilities.query && !1 === this._layer.capabilities.query.supportsPagination && (p = !1, h = !0, u = this._layer.objectIdField);\n      const c = [];\n\n      for (let e = 0; e < t.length; e++) {\n        const r = new v();\n        r.onStatisticField = null !== t[e].workingexpr ? d(t[e].workingexpr, o) : \"\", r.outStatisticFieldName = t[e].field, r.statisticType = t[e].toStatisticsName(), c.push(r);\n      }\n\n      \"\" === u && (u = e.join(\",\"));\n\n      let y = this._maxQueryRate();\n\n      const f = this._layer.capabilities.query.maxRecordCount;\n      void 0 !== f && f < y && (y = f);\n\n      let _ = null === a ? null === i ? \"1=1\" : \"\" : d(a, o);\n\n      this._layer.definitionExpression && this._useDefinitionExpression && (_ = \"\" !== _ ? \"((\" + this._layer.definitionExpression + \") AND (\" + _ + \"))\" : this._layer.definitionExpression);\n      return new s([], [\"GETPAGES\"], p, {\n        groupbypage: !0,\n        spatialRel: this._makeRelationshipEnum(r),\n        relationParam: this._makeRelationshipParam(r),\n        outFields: [\"*\"],\n        useOIDpagination: h,\n        generatedOid: l,\n        resultRecordCount: y,\n        resultOffset: 0,\n        groupByFieldsForStatistics: e,\n        outStatistics: c,\n        geometry: null === i ? null : i,\n        where: _,\n        orderByFields: u,\n        returnGeometry: !1,\n        returnIdsOnly: !1,\n        internal: {\n          lastMaxId: -1,\n          set: [],\n          lastRetrieved: 0,\n          lastPage: 0,\n          fullyResolved: !1\n        }\n      });\n    });\n  }\n\n  _getAgregagtePhysicalPage(t, r, i) {\n    try {\n      let r = t.pagesDefinition.where;\n      !0 === t.pagesDefinition.useOIDpagination && (r = \"\" !== r ? \"(\" + r + \") AND (\" + t.pagesDefinition.generatedOid + \">\" + t.pagesDefinition.internal.lastMaxId.toString() + \")\" : t.pagesDefinition.generatedOid + \">\" + t.pagesDefinition.internal.lastMaxId.toString());\n      const s = t.pagesDefinition.internal.lastRetrieved,\n            a = s,\n            n = t.pagesDefinition.internal.lastPage,\n            l = new x();\n      return this._requestStandardised && (l.sqlFormat = \"standard\"), l.where = r, l.spatialRelationship = t.pagesDefinition.spatialRel, l.relationParameter = t.pagesDefinition.relationParam, l.outFields = t.pagesDefinition.outFields, l.outStatistics = t.pagesDefinition.outStatistics, l.geometry = t.pagesDefinition.geometry, l.groupByFieldsForStatistics = t.pagesDefinition.groupByFieldsForStatistics, l.num = t.pagesDefinition.resultRecordCount, l.start = t.pagesDefinition.internal.lastPage, l.returnGeometry = t.pagesDefinition.returnGeometry, l.orderByFields = \"\" !== t.pagesDefinition.orderByFields ? t.pagesDefinition.orderByFields.split(\",\") : null, this.isTable() && l.geometry && l.spatialRelationship ? m([]) : this.executeQuery(l, \"execute\").then(r => {\n        if (this._checkCancelled(i), !r.hasOwnProperty(\"features\")) return g(new Error(\"Unnexected Result querying aggregates from layer\"));\n        const l = [];\n        if (t.pagesDefinition.internal.lastPage !== n) return [];\n\n        for (let e = 0; e < r.features.length; e++) t.pagesDefinition.internal.set[a + e] = r.features[e].attributes[t.pagesDefinition.generatedOid];\n\n        for (let t = 0; t < r.features.length; t++) l.push(new e({\n          attributes: r.features[t].attributes,\n          geometry: null\n        }));\n\n        return !0 === t.pagesDefinition.useOIDpagination ? 0 === r.features.length ? t.pagesDefinition.internal.fullyResolved = !0 : t.pagesDefinition.internal.lastMaxId = r.features[r.features.length - 1].attributes[t.pagesDefinition.generatedOid] : (void 0 === r.exceededTransferLimit && r.features.length !== t.pagesDefinition.resultRecordCount || !1 === r.exceededTransferLimit) && (t.pagesDefinition.internal.fullyResolved = !0), t.pagesDefinition.internal.lastRetrieved = s + r.features.length, t.pagesDefinition.internal.lastPage += t.pagesDefinition.resultRecordCount, l;\n      });\n    } catch (s) {\n      return g(s);\n    }\n  }\n\n  static create(e, t, r, i, s) {\n    const a = new S({\n      url: e,\n      outFields: null === t ? [\"*\"] : t\n    });\n    return new j({\n      layer: a,\n      spatialReference: r,\n      lrucache: i,\n      interceptor: s\n    });\n  }\n\n  relationshipMetaData() {\n    return this._layer && this._layer.source && this._layer.source.sourceJSON && this._layer.source.sourceJSON.relationships ? this._layer.source.sourceJSON.relationships : [];\n  }\n\n  serviceUrl() {\n    return u(this._layer.parsedUrl.path);\n  }\n\n  queryAttachments(e, t, i, s, a) {\n    if (this._layer.capabilities.data.supportsAttachment && this._layer.capabilities.operations.supportsQueryAttachments) {\n      const n = {\n        objectIds: [e],\n        returnMetadata: a\n      };\n      return (t && t > 0 || i && i > 0) && (n.size = [t && t > 0 ? t : 0, i && i > 0 ? i : t + 1]), s && s.length > 0 && (n.attachmentTypes = s), this.featureSetQueryInterceptor && this.featureSetQueryInterceptor.preLayerQueryCallback({\n        layer: this._layer,\n        query: n,\n        method: \"attachments\"\n      }), this._layer.queryAttachments(n).then(t => {\n        const i = [];\n        return t && t[e] && t[e].forEach(t => {\n          const s = this._layer.parsedUrl.path + \"/\" + e.toString() + \"/attachments/\" + t.id.toString();\n          let n = null;\n          a && t.exifInfo && (n = C.convertJsonToArcade(t.exifInfo, !0)), i.push(new r(t.id, t.name, t.contentType, t.size, s, n));\n        }), i;\n      });\n    }\n\n    return m([]);\n  }\n\n  queryRelatedFeatures(r) {\n    const i = {\n      f: \"json\",\n      relationshipId: r.relationshipId.toString(),\n      definitionExpression: r.where,\n      outFields: r.outFields.join(\",\"),\n      returnGeometry: r.returnGeometry.toString()\n    };\n    return void 0 !== r.resultOffset && null !== r.resultOffset && (i.resultOffset = r.resultOffset.toString()), void 0 !== r.resultRecordCount && null !== r.resultRecordCount && (i.resultRecordCount = r.resultRecordCount.toString()), r.orderByFields && (i.orderByFields = r.orderByFields.join(\",\")), r.objectIds.length > 0 && (i.objectIds = r.objectIds.join(\",\")), r.outSpatialReference && (i.outSR = JSON.stringify(r.outSpatialReference.toJSON())), this.featureSetQueryInterceptor && this.featureSetQueryInterceptor.preRequestCallback({\n      layer: this._layer,\n      queryPayload: i,\n      method: \"relatedrecords\",\n      url: this._layer.parsedUrl.path + \"/queryRelatedRecords\"\n    }), t(this._layer.parsedUrl.path + \"/queryRelatedRecords\", {\n      responseType: \"json\",\n      query: i\n    }).then(t => {\n      if (t.data) {\n        const r = {},\n              i = t.data;\n\n        if (i && i.relatedRecordGroups) {\n          const t = i.spatialReference;\n\n          for (const s of i.relatedRecordGroups) {\n            const a = s.objectId,\n                  n = [];\n\n            for (const r of s.relatedRecords) {\n              r.geometry && (r.geometry.spatialReference = t);\n              const i = new e({\n                geometry: r.geometry ? F(r.geometry) : null,\n                attributes: r.attributes\n              });\n              n.push(i);\n            }\n\n            r[a] = {\n              features: n,\n              exceededTransferLimit: !0 === i.exceededTransferLimit\n            };\n          }\n        }\n\n        return r;\n      }\n\n      return g(\"Invalid Request\");\n    });\n  }\n\n  getFeatureByObjectId(e, t) {\n    const r = new x();\n    return r.outFields = t, r.returnGeometry = !1, r.outSpatialReference = this.spatialReference, r.where = this.objectIdField + \"=\" + e.toString(), this.featureSetQueryInterceptor && this.featureSetQueryInterceptor.preLayerQueryCallback({\n      layer: this._layer,\n      query: r,\n      method: \"execute\"\n    }), I(this._layer.parsedUrl.path, r).then(e => 1 === e.features.length ? e.features[0] : null);\n  }\n\n  getIdentityUser() {\n    return this.load().then(() => {\n      var e;\n      const t = null == (e = f) ? void 0 : e.findCredential(this._layer.url);\n      return t ? t.userId : null;\n    });\n  }\n\n  getOwningSystemUrl() {\n    return this.load().then(() => {\n      var e;\n      const r = null == (e = f) ? void 0 : e.findServerInfo(this._layer.url);\n      if (r) return m(r.owningSystemUrl);\n      let i = this._layer.url;\n      const s = i.toLowerCase().indexOf(\"/rest/services\");\n      return i = s > -1 ? i.substring(0, s) : i, i ? (i += \"/rest/info\", _((e, r) => {\n        t(i, {\n          query: {\n            f: \"json\"\n          }\n        }).then(t => {\n          let r = \"\";\n          t.data && t.data.owningSystemUrl && (r = t.data.owningSystemUrl), e(r);\n        }, t => {\n          e(\"\");\n        });\n      })) : m(\"\");\n    });\n  }\n\n  getDataSourceFeatureSet() {\n    const e = new j({\n      layer: this._layer,\n      spatialReference: this.spatialReference,\n      outFields: this._overrideFields,\n      includeGeometry: !this._removeGeometry,\n      lrucache: this.recentlyUsedQueries,\n      interceptor: this.featureSetQueryInterceptor\n    });\n    return e._useDefinitionExpression = !1, e;\n  }\n\n}\n\nexport { j as default };","map":{"version":3,"sources":["D:/Github/CUSP_DataBase/CUSP_DB/src/main/gis/node_modules/@arcgis/core/arcade/featureset/sources/FeatureLayerDynamic.js"],"names":["e","t","r","i","s","defaultMaxRecords","a","stableStringify","n","FeatureServiceDatabaseType","l","IdState","o","extractServiceUrl","u","toWhereClause","d","isSingleField","h","decodeStatType","p","createMD5Hash","c","outputTypes","y","id","f","create","_","resolve","m","reject","g","fromJSON","F","S","convertToFeatureSet","b","executeForCount","R","executeQueryPBF","D","x","executeForIds","w","executeQueryJSON","I","q","OptimizedFeatureSetParserContext","P","v","C","j","constructor","declaredClass","_removeGeometry","_overrideFields","formulaCredential","_pageJustIds","_requestStandardised","_useDefinitionExpression","spatialReference","_transparent","_maxProcessing","_layer","layer","_wset","outFields","includeGeometry","_maxQueryRate","end","optimisePagingFeatureQueries","convertQueryToLruCacheKey","toJSON","String","load","_loadPromise","loaded","_initialiseFeatureSet","when","then","geometryType","fields","slice","length","type","push","toLowerCase","name","source","sourceJSON","currentVersion","useStandardizedQueries","_databaseType","StandardisedNoInterval","Standardised","objectIdField","globalIdField","hasM","supportsM","hasZ","supportsZ","typeIdField","types","_isInFeatureSet","InFeatureSet","_refineSetBlock","_candidateIdTransform","_getSet","_ensureLoaded","_getFilteredSet","_runDatabaseProbe","where","replace","queryObjectIds","_canUsePagination","capabilities","query","supportsPagination","_cacheableFeatureSetSourceKey","url","pbfSupportedForQuery","outStatistics","supportsFormatPBF","supportsQuantizationEditMode","queryPBF","quantizationParameters","mode","parsedUrl","data","unquantize","gdbVersion","isVersioned","nativeCapabilities","title","canQueryRelated","databaseType","requestStandardised","executeQuery","recentlyUsedQueries","getFromCache","path","addToCache","catch","removeFromCache","featureSetQueryInterceptor","preLayerQueryCallback","method","isTable","_getFilteredSetUsingPaging","supportsOrderBy","constructClause","sqlFormat","spatialRelationship","_makeRelationshipEnum","outSpatialReference","orderByFields","split","geometry","relationParameter","_makeRelationshipParam","_checkCancelled","_expandPagedSet","_expandPagedSetFeatureSet","definitionExpression","maxRecordCount","spatialRel","relationParam","resultRecordCount","resultOffset","returnGeometry","returnIdsOnly","internal","set","lastRetrieved","lastPage","fullyResolved","_fieldsIncludingObjectId","join","_clonePageDefinition","groupbypage","useOIDpagination","generatedOid","groupByFieldsForStatistics","_getPhysicalPage","pagesDefinition","num","start","features","attributes","_featureCache","exceededTransferLimit","indexOf","toUpperCase","_getFeatures","_checkIfNeedToExpandKnownPage","_maxProcessingRate","_lastFetchedIndex","_known","_mode","_featureMap","objectIds","error","Error","_getDistinctPages","parseTree","column","returnDistinctValues","hasOwnProperty","Date","calculated","result","_distinctStat","_countstat","_stats","supportsSqlExpression","supportsStatistics","supportsDistinct","isStandardized","_manualStat","statisticType","onStatisticField","outStatisticFieldName","_stat","_canDoAggregates","workingexpr","_getAggregatePagesDataSourceDefinition","field","toStatisticsName","lastMaxId","_getAgregagtePhysicalPage","toString","lrucache","interceptor","relationshipMetaData","relationships","serviceUrl","queryAttachments","supportsAttachment","operations","supportsQueryAttachments","returnMetadata","size","attachmentTypes","forEach","exifInfo","convertJsonToArcade","contentType","queryRelatedFeatures","relationshipId","outSR","JSON","stringify","preRequestCallback","queryPayload","responseType","relatedRecordGroups","objectId","relatedRecords","getFeatureByObjectId","getIdentityUser","findCredential","userId","getOwningSystemUrl","findServerInfo","owningSystemUrl","substring","getDataSourceFeatureSet","default"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport e from\"../../../Graphic.js\";import t from\"../../../request.js\";import r from\"../../Attachment.js\";import i from\"../support/FeatureSet.js\";import s from\"../support/IdSet.js\";import{defaultMaxRecords as a,stableStringify as n,FeatureServiceDatabaseType as l,IdState as o,extractServiceUrl as u}from\"../support/shared.js\";import{toWhereClause as d,isSingleField as h}from\"../support/sqlUtils.js\";import{decodeStatType as p}from\"../support/stats.js\";import{createMD5Hash as c,outputTypes as y}from\"../../../core/MD5.js\";import{id as f}from\"../../../kernel.js\";import{create as _,resolve as m,reject as g}from\"../../../core/promiseUtils.js\";import{fromJSON as F}from\"../../../geometry/support/jsonUtils.js\";import S from\"../../../layers/FeatureLayer.js\";import{convertToFeatureSet as b}from\"../../../layers/graphics/featureConversionUtils.js\";import\"../../../core/urlUtils.js\";import\"../../../core/unitUtils.js\";import\"../../../rest/query/support/AttachmentInfo.js\";import\"../../../rest/support/AttachmentQuery.js\";import{executeForCount as R}from\"../../../rest/query/executeForCount.js\";import\"../../../geometry.js\";import{executeQueryPBF as D}from\"../../../rest/query/operations/query.js\";import x from\"../../../rest/support/Query.js\";import{executeForIds as w}from\"../../../rest/query/executeForIds.js\";import{executeQueryJSON as I}from\"../../../rest/query/executeQueryJSON.js\";import\"../../../core/has.js\";import\"../../../geometry/support/spatialReferenceUtils.js\";import q from\"../../../rest/support/FeatureSet.js\";import\"../../../rest/support/RelationshipQuery.js\";import\"../../../geometry/support/normalizeUtils.js\";import\"../../../rest/support/TopFeaturesQuery.js\";import{OptimizedFeatureSetParserContext as P}from\"../../../rest/query/operations/pbfOptimizedFeatureSet.js\";import v from\"../../../rest/support/StatisticDefinition.js\";import C from\"../../Dictionary.js\";class j extends i{constructor(e){super(e),this.declaredClass=\"esri.arcade.featureset.sources.FeatureLayerDynamic\",this._removeGeometry=!1,this._overrideFields=null,this.formulaCredential=null,this._pageJustIds=!1,this._requestStandardised=!1,this._useDefinitionExpression=!0,e.spatialReference&&(this.spatialReference=e.spatialReference),this._transparent=!0,this._maxProcessing=1e3,this._layer=e.layer,this._wset=null,void 0!==e.outFields&&(this._overrideFields=e.outFields),void 0!==e.includeGeometry&&(this._removeGeometry=!1===e.includeGeometry)}_maxQueryRate(){return a}end(){return this._layer}optimisePagingFeatureQueries(e){this._pageJustIds=e}convertQueryToLruCacheKey(e){const t=n(e.toJSON());return c(t,y.String)}load(){return null===this._loadPromise&&(this._loadPromise=_(((e,t)=>{try{if(!0===this._layer.loaded)return this._initialiseFeatureSet(),void e(this);this._layer.when().then((()=>{try{this._initialiseFeatureSet(),e(this)}catch(r){t(r)}}),t),this._layer.load()}catch(r){t(r)}}))),this._loadPromise}_initialiseFeatureSet(){if(null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference),this.geometryType=this._layer.geometryType,this.fields=this._layer.fields.slice(0),this._layer.outFields)if(1===this._layer.outFields.length&&\"*\"===this._layer.outFields[0]);else{const e=[];for(const t of this.fields)if(\"oid\"===t.type)e.push(t);else for(const r of this._layer.outFields)if(r.toLowerCase()===t.name.toLowerCase()){e.push(t);break}this.fields=e}else;if(null!==this._overrideFields)if(1===this._overrideFields.length&&\"*\"===this._overrideFields[0])this._overrideFields=null;else{const e=[],t=[];for(const r of this.fields)if(\"oid\"===r.type)e.push(r),t.push(r.name);else for(const i of this._overrideFields)if(i.toLowerCase()===r.name.toLowerCase()){e.push(r),t.push(r.name);break}this.fields=e,this._overrideFields=t}if(this._layer.source&&this._layer.source.sourceJSON){const e=this._layer.source.sourceJSON.currentVersion;!0===this._layer.source.sourceJSON.useStandardizedQueries?(this._databaseType=l.StandardisedNoInterval,null!=e&&e>=10.61&&(this._databaseType=l.Standardised)):null!=e&&(e>=10.5&&(this._databaseType=l.StandardisedNoInterval,this._requestStandardised=!0),e>=10.61&&(this._databaseType=l.Standardised))}this.objectIdField=this._layer.objectIdField;for(const e of this.fields)\"global-id\"===e.type&&(this.globalIdField=e.name);this.hasM=this._layer.supportsM,this.hasZ=this._layer.supportsZ,this.typeIdField=this._layer.typeIdField,this.types=this._layer.types}_isInFeatureSet(){return o.InFeatureSet}_refineSetBlock(e){return m(e)}_candidateIdTransform(e){return e}_getSet(e){return null===this._wset?this._ensureLoaded().then((()=>this._getFilteredSet(\"\",null,null,null,e))).then((e=>(this._wset=e,e))):m(this._wset)}_runDatabaseProbe(e){return _(((t,r)=>{try{this._ensureLoaded().then((()=>{try{const i=new x;i.where=e.replace(\"OBJECTID\",this._layer.objectIdField),this._layer.queryObjectIds(i).then((()=>{t(!0)}),(()=>{try{t(!1)}catch(e){r(e)}}))}catch(i){r(i)}}))}catch(i){r(i)}}))}_canUsePagination(){return!(!this._layer.capabilities||!this._layer.capabilities.query||!0!==this._layer.capabilities.query.supportsPagination)}_cacheableFeatureSetSourceKey(){return this._layer.url}pbfSupportedForQuery(e){return!e.outStatistics&&this._layer&&this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsFormatPBF&&!0===this._layer.capabilities.query.supportsQuantizationEditMode}queryPBF(e){return e.quantizationParameters={mode:\"edit\"},D(this._layer.parsedUrl,e,new P({})).then((e=>q.fromJSON(b(e.data)).unquantize()))}get gdbVersion(){return this._layer&&this._layer.capabilities&&this._layer.capabilities.data&&this._layer.capabilities.data.isVersioned?this._layer.gdbVersion?this._layer.gdbVersion:\"SDE.DEFAULT\":\"\"}nativeCapabilities(){return{title:this._layer.title,source:this,canQueryRelated:!0,capabilities:this._layer.capabilities,databaseType:this._databaseType,requestStandardised:this._requestStandardised}}executeQuery(e,t){const r=\"execute\"===t?I:\"executeForCount\"===t?R:w,i=\"execute\"===t&&this.pbfSupportedForQuery(e);let s=null;if(this.recentlyUsedQueries){const t=this.convertQueryToLruCacheKey(e);s=this.recentlyUsedQueries.getFromCache(t),null===s&&(s=!0!==i?r(this._layer.parsedUrl.path,e):this.queryPBF(e),this.recentlyUsedQueries.addToCache(t,s),s=s.catch((e=>{throw this.recentlyUsedQueries.removeFromCache(t),e})))}return this.featureSetQueryInterceptor&&this.featureSetQueryInterceptor.preLayerQueryCallback({layer:this._layer,query:e,method:t}),null===s&&(s=!0!==i?r(this._layer.parsedUrl.path,e):this.queryPBF(e)),s}_getFilteredSet(e,t,r,i,a){return this.databaseType().then((n=>{if(this.isTable()&&t&&null!==e&&\"\"!==e){return new s([],[],!0,null)}if(this._canUsePagination())return this._getFilteredSetUsingPaging(e,t,r,i,a);let l=\"\",o=!1;null!==i&&this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsOrderBy&&(l=i.constructClause(),o=!0);const u=new x;return u.where=null===r?null===t?\"1=1\":\"\":d(r,n),this._requestStandardised&&(u.sqlFormat=\"standard\"),u.spatialRelationship=this._makeRelationshipEnum(e),u.outSpatialReference=this.spatialReference,u.orderByFields=\"\"!==l?l.split(\",\"):null,u.geometry=null===t?null:t,u.relationParameter=this._makeRelationshipParam(e),this.executeQuery(u,\"executeForIds\").then((e=>{null===e&&(e=[]),this._checkCancelled(a);return new s([],e,o,null)}))}))}_expandPagedSet(e,t,r,i,s){return this._expandPagedSetFeatureSet(e,t,r,i,s)}_getFilteredSetUsingPaging(e,t,r,i,a){try{let n=\"\",l=!1;return null!==i&&this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsOrderBy&&(n=i.constructClause(),l=!0),this.databaseType().then((i=>{let o=null===r?null===t?\"1=1\":\"\":d(r,i);this._layer.definitionExpression&&this._useDefinitionExpression&&(o=\"\"!==o?\"((\"+this._layer.definitionExpression+\") AND (\"+o+\"))\":this._layer.definitionExpression);let u=this._maxQueryRate();const h=this._layer.capabilities.query.maxRecordCount;void 0!==h&&h<u&&(u=h);let p=null;if(!0===this._pageJustIds)p=new s([],[\"GETPAGES\"],l,{spatialRel:this._makeRelationshipEnum(e),relationParam:this._makeRelationshipParam(e),outFields:this._layer.objectIdField,resultRecordCount:u,resultOffset:0,geometry:null===t?null:t,where:o,orderByFields:n,returnGeometry:!1,returnIdsOnly:\"false\",internal:{set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}});else{let r=!0;!0===this._removeGeometry&&(r=!1);const i=null!==this._overrideFields?this._overrideFields:this._fieldsIncludingObjectId(this._layer.outFields?this._layer.outFields:[\"*\"]);p=new s([],[\"GETPAGES\"],l,{spatialRel:this._makeRelationshipEnum(e),relationParam:this._makeRelationshipParam(e),outFields:i.join(\",\"),resultRecordCount:u,resultOffset:0,geometry:null===t?null:t,where:o,orderByFields:n,returnGeometry:r,returnIdsOnly:\"false\",internal:{set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}})}return this._expandPagedSet(p,u,0,1,a).then((()=>p))}))}catch(n){return g(n)}}_clonePageDefinition(e){return null===e?null:!0!==e.groupbypage?{groupbypage:!1,spatialRel:e.spatialRel,relationParam:e.relationParam,outFields:e.outFields,resultRecordCount:e.resultRecordCount,resultOffset:e.resultOffset,geometry:e.geometry,where:e.where,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}:{groupbypage:!0,spatialRel:e.spatialRel,relationParam:e.relationParam,outFields:e.outFields,resultRecordCount:e.resultRecordCount,useOIDpagination:e.useOIDpagination,generatedOid:e.generatedOid,groupByFieldsForStatistics:e.groupByFieldsForStatistics,resultOffset:e.resultOffset,outStatistics:e.outStatistics,geometry:e.geometry,where:e.where,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}}_getPhysicalPage(e,t,r){try{const t=e.pagesDefinition.internal.lastRetrieved,i=t,s=e.pagesDefinition.internal.lastPage,a=new x;return this._requestStandardised&&(a.sqlFormat=\"standard\"),a.spatialRelationship=e.pagesDefinition.spatialRel,a.relationParameter=e.pagesDefinition.relationParam,a.outFields=e.pagesDefinition.outFields.split(\",\"),a.num=e.pagesDefinition.resultRecordCount,a.start=e.pagesDefinition.internal.lastPage,a.geometry=e.pagesDefinition.geometry,a.where=e.pagesDefinition.where,a.orderByFields=\"\"!==e.pagesDefinition.orderByFields?e.pagesDefinition.orderByFields.split(\",\"):null,a.returnGeometry=e.pagesDefinition.returnGeometry,a.outSpatialReference=this.spatialReference,this.executeQuery(a,\"execute\").then((a=>{if(this._checkCancelled(r),e.pagesDefinition.internal.lastPage!==s)return\"done\";for(let t=0;t<a.features.length;t++)e.pagesDefinition.internal.set[i+t]=a.features[t].attributes[this._layer.objectIdField];if(!1===this._pageJustIds)for(let e=0;e<a.features.length;e++)this._featureCache[a.features[e].attributes[this._layer.objectIdField]]=a.features[e];return(void 0===a.exceededTransferLimit&&a.features.length!==e.pagesDefinition.resultRecordCount||!1===a.exceededTransferLimit)&&(e.pagesDefinition.internal.fullyResolved=!0),e.pagesDefinition.internal.lastRetrieved=t+a.features.length,e.pagesDefinition.internal.lastPage+=e.pagesDefinition.resultRecordCount,\"done\"}))}catch(i){return g(i)}}_fieldsIncludingObjectId(e){if(null===e)return[this.objectIdField];const t=e.slice(0);if(t.indexOf(\"*\")>-1)return t;let r=!1;for(const i of t)if(i.toUpperCase()===this.objectIdField.toUpperCase()){r=!0;break}return!1===r&&t.push(this.objectIdField),t}_getFeatures(e,t,r,i){const s=[];try{if(-1!==t&&void 0===this._featureCache[t]&&s.push(t),!0===this._checkIfNeedToExpandKnownPage(e,this._maxProcessingRate()))return this._expandPagedSet(e,this._maxProcessingRate(),0,0,i).then((()=>this._getFeatures(e,t,r,i)));let n=0;for(let i=e._lastFetchedIndex;i<e._known.length;i++){if(e._lastFetchedIndex+=1,n++,void 0===this._featureCache[e._known[i]]){let r=!1;if(null!==this._layer._mode&&void 0!==this._layer._mode){const t=this._layer._mode;if(void 0!==t._featureMap[e._known[i]]){const s=t._featureMap[e._known[i]];null!==s&&(r=!0,this._featureCache[e._known[i]]=s)}}if(!1===r&&(e._known[i]!==t&&s.push(e._known[i]),s.length>=this._maxProcessingRate()-1))break}if(n>=r&&0===s.length)break}if(0===s.length)return m(\"success\");try{const e=new x;return this._requestStandardised&&(e.sqlFormat=\"standard\"),e.objectIds=s,e.outFields=null!==this._overrideFields?this._overrideFields:this._fieldsIncludingObjectId(this._layer.outFields?this._layer.outFields:[\"*\"]),e.returnGeometry=!0,!0===this._removeGeometry&&(e.returnGeometry=!1),e.outSpatialReference=this.spatialReference,this.executeQuery(e,\"execute\").then((e=>{if(this._checkCancelled(i),void 0!==e.error)return g(new Error(e.error));for(let t=0;t<e.features.length;t++)this._featureCache[e.features[t].attributes[this._layer.objectIdField]]=e.features[t];return\"success\"}))}catch(a){return g(a)}}catch(a){return g(a)}}_getDistinctPages(e,t,r,i,s,a,n,l,o){return this._ensureLoaded().then((()=>this.databaseType())).then((u=>{let h=r.parseTree.column;for(let e=0;e<this._layer.fields.length;e++)if(this._layer.fields[e].name.toLowerCase()===h.toLowerCase()){h=this._layer.fields[e].name;break}const p=new x;this._requestStandardised&&(p.sqlFormat=\"standard\");let c=null===a?null===s?\"1=1\":\"\":d(a,u);return this._layer.definitionExpression&&this._useDefinitionExpression&&(c=\"\"!==c?\"((\"+this._layer.definitionExpression+\") AND (\"+c+\"))\":this._layer.definitionExpression),p.where=c,p.spatialRelationship=this._makeRelationshipEnum(i),p.relationParameter=this._makeRelationshipParam(i),p.geometry=null===s?null:s,p.returnDistinctValues=!0,p.returnGeometry=!1,p.outFields=[h],this.executeQuery(p,\"execute\").then((u=>{if(this._checkCancelled(o),!u.hasOwnProperty(\"features\"))return g(new Error(\"Unnexected Result querying statistics from layer\"));let d=!1;for(let e=0;e<this._layer.fields.length;e++)if(this._layer.fields[e].name===h){\"date\"===this._layer.fields[e].type&&(d=!0);break}for(let e=0;e<u.features.length;e++){if(d){const t=u.features[e].attributes[h];null!==t?l.push(new Date(t)):l.push(t)}else l.push(u.features[e].attributes[h]);if(l.length>=n)break}return 0===u.features.length?l:u.features.length===this._layer.capabilities.query.maxRecordCount&&l.length<n?this._getDistinctPages(e+u.features.length,t,r,i,s,a,n,l,o).then((e=>({calculated:!0,result:e}))):l}))}))}_distinctStat(e,t,r,i,s,a,n){return this._getDistinctPages(0,e,t,r,i,s,a,[],n).then((e=>({calculated:!0,result:e})))}isTable(){return this._layer.isTable||null===this._layer.geometryType||\"table\"===this._layer.type||\"\"===this._layer.geometryType}_countstat(e,t,r,i){return this.databaseType().then((e=>{const s=new x;if(this._requestStandardised&&(s.sqlFormat=\"standard\"),this.isTable()&&r&&null!==t&&\"\"!==t)return{calculated:!0,result:0};let a=null===i?null===r?\"1=1\":\"\":d(i,e);return this._layer.definitionExpression&&this._useDefinitionExpression&&(a=\"\"!==a?\"((\"+this._layer.definitionExpression+\") AND (\"+a+\"))\":this._layer.definitionExpression),s.where=a,s.where=a,s.spatialRelationship=this._makeRelationshipEnum(t),s.relationParameter=this._makeRelationshipParam(t),s.geometry=null===r?null:r,s.returnGeometry=!1,this.executeQuery(s,\"executeForCount\").then((e=>({calculated:!0,result:e})))}))}_stats(e,t,r,i,s,a,n){return this._ensureLoaded().then((()=>{const l=this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsSqlExpression,o=this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsStatistics,u=this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsDistinct;return\"count\"===e?u?this._countstat(e,r,i,s):{calculated:!1}:!1===o||!1===h(t)&&!1===l||!1===t.isStandardized?\"\"!==r||null!==s?{calculated:!1}:this._manualStat(e,t,a,n):\"distinct\"===e?!1===u?\"\"!==r||null!==s?{calculated:!1}:this._manualStat(e,t,a,n):this._distinctStat(e,t,r,i,s,a,n):this.databaseType().then((a=>{if(this.isTable()&&i&&null!==r&&\"\"!==r)return{calculated:!0,result:null};const n=new x;this._requestStandardised&&(n.sqlFormat=\"standard\");let l=null===s?null===i?\"1=1\":\"\":d(s,a);this._layer.definitionExpression&&this._useDefinitionExpression&&(l=\"\"!==l?\"((\"+this._layer.definitionExpression+\") AND (\"+l+\"))\":this._layer.definitionExpression),n.where=l,n.spatialRelationship=this._makeRelationshipEnum(r),n.relationParameter=this._makeRelationshipParam(r),n.geometry=null===i?null:i;const o=new v;o.statisticType=p(e),o.onStatisticField=d(t,a),o.outStatisticFieldName=\"ARCADE_STAT_RESULT\",n.returnGeometry=!1;let u=\"ARCADE_STAT_RESULT\";return n.outStatistics=[o],this.executeQuery(n,\"execute\").then((e=>{if(!e.hasOwnProperty(\"features\")||0===e.features.length)return g(new Error(\"Unnexected Result querying statistics from layer\"));let t=!1;for(let r=0;r<e.fields.length;r++)if(\"ARCADE_STAT_RESULT\"===e.fields[r].name.toUpperCase()){u=e.fields[r].name,\"date\"===e.fields[r].type&&(t=!0);break}if(t){let t=e.features[0].attributes[u];return null!==t&&(t=new Date(e.features[0].attributes[u])),{calculated:!0,result:t}}return{calculated:!0,result:e.features[0].attributes[u]}}))}))}))}_stat(e,t,r,i,s,a,n){return this._stats(e,t,r,i,s,a,n)}_canDoAggregates(e,t){return this._ensureLoaded().then((()=>{let e=!1;const r=this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsSqlExpression;if(void 0!==this._layer.capabilities&&null!==this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsStatistics&&!0===this._layer.capabilities.query.supportsOrderBy&&(e=!0),e)for(let i=0;i<t.length-1;i++)null!==t[i].workingexpr&&(!1===t[i].workingexpr.isStandardized||!1===h(t[i].workingexpr)&&!1===r)&&(e=!1);return!1!==e}))}_makeRelationshipEnum(e){if(e.indexOf(\"esriSpatialRelRelation\")>=0)return\"relation\";switch(e){case\"esriSpatialRelRelation\":return\"relation\";case\"esriSpatialRelIntersects\":return\"intersects\";case\"esriSpatialRelContains\":return\"contains\";case\"esriSpatialRelOverlaps\":return\"overlaps\";case\"esriSpatialRelWithin\":return\"within\";case\"esriSpatialRelTouches\":return\"touches\";case\"esriSpatialRelCrosses\":return\"crosses\";case\"esriSpatialRelEnvelopeIntersects\":return\"envelope-intersects\"}return e}_makeRelationshipParam(e){return e.indexOf(\"esriSpatialRelRelation\")>=0?e.split(\":\")[1]:\"\"}_getAggregatePagesDataSourceDefinition(e,t,r,i,a,n,l){return this._ensureLoaded().then((()=>this.databaseType())).then((o=>{let u=\"\",h=!1,p=!1;null!==n&&this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsOrderBy&&(u=n.constructClause(),p=!0),this._layer.capabilities&&this._layer.capabilities.query&&!1===this._layer.capabilities.query.supportsPagination&&(p=!1,h=!0,u=this._layer.objectIdField);const c=[];for(let e=0;e<t.length;e++){const r=new v;r.onStatisticField=null!==t[e].workingexpr?d(t[e].workingexpr,o):\"\",r.outStatisticFieldName=t[e].field,r.statisticType=t[e].toStatisticsName(),c.push(r)}\"\"===u&&(u=e.join(\",\"));let y=this._maxQueryRate();const f=this._layer.capabilities.query.maxRecordCount;void 0!==f&&f<y&&(y=f);let _=null===a?null===i?\"1=1\":\"\":d(a,o);this._layer.definitionExpression&&this._useDefinitionExpression&&(_=\"\"!==_?\"((\"+this._layer.definitionExpression+\") AND (\"+_+\"))\":this._layer.definitionExpression);return new s([],[\"GETPAGES\"],p,{groupbypage:!0,spatialRel:this._makeRelationshipEnum(r),relationParam:this._makeRelationshipParam(r),outFields:[\"*\"],useOIDpagination:h,generatedOid:l,resultRecordCount:y,resultOffset:0,groupByFieldsForStatistics:e,outStatistics:c,geometry:null===i?null:i,where:_,orderByFields:u,returnGeometry:!1,returnIdsOnly:!1,internal:{lastMaxId:-1,set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}})}))}_getAgregagtePhysicalPage(t,r,i){try{let r=t.pagesDefinition.where;!0===t.pagesDefinition.useOIDpagination&&(r=\"\"!==r?\"(\"+r+\") AND (\"+t.pagesDefinition.generatedOid+\">\"+t.pagesDefinition.internal.lastMaxId.toString()+\")\":t.pagesDefinition.generatedOid+\">\"+t.pagesDefinition.internal.lastMaxId.toString());const s=t.pagesDefinition.internal.lastRetrieved,a=s,n=t.pagesDefinition.internal.lastPage,l=new x;return this._requestStandardised&&(l.sqlFormat=\"standard\"),l.where=r,l.spatialRelationship=t.pagesDefinition.spatialRel,l.relationParameter=t.pagesDefinition.relationParam,l.outFields=t.pagesDefinition.outFields,l.outStatistics=t.pagesDefinition.outStatistics,l.geometry=t.pagesDefinition.geometry,l.groupByFieldsForStatistics=t.pagesDefinition.groupByFieldsForStatistics,l.num=t.pagesDefinition.resultRecordCount,l.start=t.pagesDefinition.internal.lastPage,l.returnGeometry=t.pagesDefinition.returnGeometry,l.orderByFields=\"\"!==t.pagesDefinition.orderByFields?t.pagesDefinition.orderByFields.split(\",\"):null,this.isTable()&&l.geometry&&l.spatialRelationship?m([]):this.executeQuery(l,\"execute\").then((r=>{if(this._checkCancelled(i),!r.hasOwnProperty(\"features\"))return g(new Error(\"Unnexected Result querying aggregates from layer\"));const l=[];if(t.pagesDefinition.internal.lastPage!==n)return[];for(let e=0;e<r.features.length;e++)t.pagesDefinition.internal.set[a+e]=r.features[e].attributes[t.pagesDefinition.generatedOid];for(let t=0;t<r.features.length;t++)l.push(new e({attributes:r.features[t].attributes,geometry:null}));return!0===t.pagesDefinition.useOIDpagination?0===r.features.length?t.pagesDefinition.internal.fullyResolved=!0:t.pagesDefinition.internal.lastMaxId=r.features[r.features.length-1].attributes[t.pagesDefinition.generatedOid]:(void 0===r.exceededTransferLimit&&r.features.length!==t.pagesDefinition.resultRecordCount||!1===r.exceededTransferLimit)&&(t.pagesDefinition.internal.fullyResolved=!0),t.pagesDefinition.internal.lastRetrieved=s+r.features.length,t.pagesDefinition.internal.lastPage+=t.pagesDefinition.resultRecordCount,l}))}catch(s){return g(s)}}static create(e,t,r,i,s){const a=new S({url:e,outFields:null===t?[\"*\"]:t});return new j({layer:a,spatialReference:r,lrucache:i,interceptor:s})}relationshipMetaData(){return this._layer&&this._layer.source&&this._layer.source.sourceJSON&&this._layer.source.sourceJSON.relationships?this._layer.source.sourceJSON.relationships:[]}serviceUrl(){return u(this._layer.parsedUrl.path)}queryAttachments(e,t,i,s,a){if(this._layer.capabilities.data.supportsAttachment&&this._layer.capabilities.operations.supportsQueryAttachments){const n={objectIds:[e],returnMetadata:a};return(t&&t>0||i&&i>0)&&(n.size=[t&&t>0?t:0,i&&i>0?i:t+1]),s&&s.length>0&&(n.attachmentTypes=s),this.featureSetQueryInterceptor&&this.featureSetQueryInterceptor.preLayerQueryCallback({layer:this._layer,query:n,method:\"attachments\"}),this._layer.queryAttachments(n).then((t=>{const i=[];return t&&t[e]&&t[e].forEach((t=>{const s=this._layer.parsedUrl.path+\"/\"+e.toString()+\"/attachments/\"+t.id.toString();let n=null;a&&t.exifInfo&&(n=C.convertJsonToArcade(t.exifInfo,!0)),i.push(new r(t.id,t.name,t.contentType,t.size,s,n))})),i}))}return m([])}queryRelatedFeatures(r){const i={f:\"json\",relationshipId:r.relationshipId.toString(),definitionExpression:r.where,outFields:r.outFields.join(\",\"),returnGeometry:r.returnGeometry.toString()};return void 0!==r.resultOffset&&null!==r.resultOffset&&(i.resultOffset=r.resultOffset.toString()),void 0!==r.resultRecordCount&&null!==r.resultRecordCount&&(i.resultRecordCount=r.resultRecordCount.toString()),r.orderByFields&&(i.orderByFields=r.orderByFields.join(\",\")),r.objectIds.length>0&&(i.objectIds=r.objectIds.join(\",\")),r.outSpatialReference&&(i.outSR=JSON.stringify(r.outSpatialReference.toJSON())),this.featureSetQueryInterceptor&&this.featureSetQueryInterceptor.preRequestCallback({layer:this._layer,queryPayload:i,method:\"relatedrecords\",url:this._layer.parsedUrl.path+\"/queryRelatedRecords\"}),t(this._layer.parsedUrl.path+\"/queryRelatedRecords\",{responseType:\"json\",query:i}).then((t=>{if(t.data){const r={},i=t.data;if(i&&i.relatedRecordGroups){const t=i.spatialReference;for(const s of i.relatedRecordGroups){const a=s.objectId,n=[];for(const r of s.relatedRecords){r.geometry&&(r.geometry.spatialReference=t);const i=new e({geometry:r.geometry?F(r.geometry):null,attributes:r.attributes});n.push(i)}r[a]={features:n,exceededTransferLimit:!0===i.exceededTransferLimit}}}return r}return g(\"Invalid Request\")}))}getFeatureByObjectId(e,t){const r=new x;return r.outFields=t,r.returnGeometry=!1,r.outSpatialReference=this.spatialReference,r.where=this.objectIdField+\"=\"+e.toString(),this.featureSetQueryInterceptor&&this.featureSetQueryInterceptor.preLayerQueryCallback({layer:this._layer,query:r,method:\"execute\"}),I(this._layer.parsedUrl.path,r).then((e=>1===e.features.length?e.features[0]:null))}getIdentityUser(){return this.load().then((()=>{var e;const t=null==(e=f)?void 0:e.findCredential(this._layer.url);return t?t.userId:null}))}getOwningSystemUrl(){return this.load().then((()=>{var e;const r=null==(e=f)?void 0:e.findServerInfo(this._layer.url);if(r)return m(r.owningSystemUrl);let i=this._layer.url;const s=i.toLowerCase().indexOf(\"/rest/services\");return i=s>-1?i.substring(0,s):i,i?(i+=\"/rest/info\",_(((e,r)=>{t(i,{query:{f:\"json\"}}).then((t=>{let r=\"\";t.data&&t.data.owningSystemUrl&&(r=t.data.owningSystemUrl),e(r)}),(t=>{e(\"\")}))}))):m(\"\")}))}getDataSourceFeatureSet(){const e=new j({layer:this._layer,spatialReference:this.spatialReference,outFields:this._overrideFields,includeGeometry:!this._removeGeometry,lrucache:this.recentlyUsedQueries,interceptor:this.featureSetQueryInterceptor});return e._useDefinitionExpression=!1,e}}export{j as default};\n"]},"metadata":{},"sourceType":"module"}