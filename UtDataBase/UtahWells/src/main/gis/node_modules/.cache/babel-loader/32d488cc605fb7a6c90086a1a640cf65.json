{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport { isSome as t } from \"../../../../core/maybe.js\";\nimport { b as e, c as r, r as s, j as i, m as a } from \"../../../../chunks/mat3.js\";\nimport { c as o } from \"../../../../chunks/mat3f32.js\";\nimport { f as u } from \"../../../../chunks/vec2f32.js\";\nimport { extractBands as n } from \"../../../../layers/support/rasterFunctions/pixelUtils.js\";\nimport { DisplayObject as l } from \"../DisplayObject.js\";\nimport { TextureSamplingMode as h } from \"../../../webgl/enums.js\";\nimport { createTransformTexture as d, createRasterTexture as _, createColormapTexture as m } from \"../../../webgl/rasterUtils.js\";\nconst x = {\n  bandCount: 3,\n  outMin: 0,\n  outMax: 1,\n  minCutOff: [0, 0, 0],\n  maxCutOff: [255, 255, 255],\n  factor: [1 / 255, 1 / 255, 1 / 255],\n  useGamma: !1,\n  gamma: [1, 1, 1],\n  gammaCorrection: [1, 1, 1],\n  colormap: null,\n  colormapOffset: null,\n  stretchType: \"none\",\n  type: \"stretch\"\n};\n\nclass p extends l {\n  constructor() {\n    let t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;\n    let e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n    let r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n    super(), this._textureInvalidated = !0, this._colormapTextureInvalidated = !0, this._supportsBilinearTexture = !0, this.stencilRef = 0, this.coordScale = [1, 1], this._symbolizerParameters = null, this.height = null, this.isRendereredSource = !1, this.pixelRatio = 1, this.resolution = 0, this.rotation = 0, this._source = null, this.rawPixelData = null, this._suspended = !1, this._bandIds = null, this._interpolation = null, this._transformGrid = null, this.width = null, this.x = 0, this.y = 0, this.source = t, this.transformGrid = e, this.interpolation = r;\n  }\n\n  destroy() {\n    const t = this.getTextures();\n    null == t || t.textures.forEach(t => t.dispose()), this._rasterTexture = null, this._transformGridTexture = null, this._colormapTexture = null;\n  }\n\n  get symbolizerParameters() {\n    return this._symbolizerParameters || x;\n  }\n\n  set symbolizerParameters(t) {\n    this._symbolizerParameters !== t && (this._symbolizerParameters = t, this._colormapTextureInvalidated = !0);\n  }\n\n  get source() {\n    return this._source;\n  }\n\n  set source(t) {\n    this._source !== t && (this._source = t, this._rasterTexture && (this._rasterTexture.dispose(), this._rasterTexture = null, this._rasterTextureBandIds = null), this.invalidateTexture());\n  }\n\n  get suspended() {\n    return this._suspended;\n  }\n\n  set suspended(t) {\n    this._suspended && !t && this.stage && (this.ready(), this.requestRender()), this._suspended = t;\n  }\n\n  get bandIds() {\n    return this._bandIds;\n  }\n\n  set bandIds(t) {\n    this._bandIds = t, this._isBandIdschanged(t) && this.invalidateTexture();\n  }\n\n  get interpolation() {\n    return this._interpolation || \"nearest\";\n  }\n\n  set interpolation(t) {\n    this._interpolation = t, this._rasterTexture && this._rasterTexture.setSamplingMode(\"bilinear\" === this._getTextureSamplingMethod(t) ? h.LINEAR : h.NEAREST);\n  }\n\n  get transformGrid() {\n    return this._transformGrid;\n  }\n\n  set transformGrid(t) {\n    this._transformGrid = t, this._transformGridTexture && (this._transformGridTexture.dispose(), this._transformGridTexture = null);\n  }\n\n  invalidateTexture() {\n    this._textureInvalidated || (this._textureInvalidated = !0, this.requestRender());\n  }\n\n  _createTransforms() {\n    return {\n      dvs: o()\n    };\n  }\n\n  setTransform(t) {\n    const o = e(this.transforms.dvs),\n          [n, l] = t.toScreenNoRotation([0, 0], [this.x, this.y]),\n          h = this.resolution / this.pixelRatio / t.resolution,\n          d = h * this.width,\n          _ = h * this.height,\n          m = Math.PI * this.rotation / 180;\n\n    r(o, o, u(n, l)), r(o, o, u(d / 2, _ / 2)), s(o, o, -m), r(o, o, u(-d / 2, -_ / 2)), i(o, o, u(d, _)), a(this.transforms.dvs, t.displayViewMat3, o);\n  }\n\n  getTextures() {\n    if (!this._rasterTexture) return null;\n    const t = [],\n          e = [];\n    return this._transformGridTexture && (e.push(this._transformGridTexture), t.push(\"u_transformGrid\")), this._rasterTexture && (e.push(this._rasterTexture), t.push(\"u_image\")), this._colormapTexture && (e.push(this._colormapTexture), t.push(\"u_colormap\")), {\n      names: t,\n      textures: e\n    };\n  }\n\n  onAttach() {\n    this.invalidateTexture();\n  }\n\n  onDetach() {\n    this.invalidateTexture();\n  }\n\n  updateTexture(_ref) {\n    let {\n      context: t\n    } = _ref;\n    var e, r, s;\n    if (!this.stage) return null == (e = this._rasterTexture) || e.dispose(), null == (r = this._transformGridTexture) || r.dispose(), null == (s = this._colormapTexture) || s.dispose(), this._rasterTexture = null, this._rasterTextureBandIds = null, this._transformGridTexture = null, void (this._colormapTexture = null);\n\n    const i = this._isValidSource(this.source);\n\n    i && this._colormapTextureInvalidated && (this._colormapTextureInvalidated = !1, this._updateColormapTexture(t)), this._textureInvalidated && (this._textureInvalidated = !1, this._createOrDestroyRasterTexture(t), this._rasterTexture && (i ? this.transformGrid && !this._transformGridTexture && (this._transformGridTexture = d(t, this.transformGrid)) : this._rasterTexture.setData(null)), this.suspended || (this.ready(), this.requestRender()));\n  }\n\n  _createOrDestroyRasterTexture(e) {\n    var r, s;\n    const i = t(this.source) ? n(this.source, this.bandIds) : null;\n    if (!this._isValidSource(i)) return void (this._rasterTexture && (this._rasterTexture.dispose(), this._rasterTextureBandIds = null, this._rasterTexture = null));\n    const a = !this._isBandIdschanged(this.bandIds);\n\n    if (this._rasterTexture) {\n      if (a) return;\n      this._rasterTexture.dispose(), this._rasterTextureBandIds = null, this._rasterTexture = null;\n    }\n\n    this._supportsBilinearTexture = null == (r = e.capabilities.textureFloat) ? void 0 : r.textureFloatLinear;\n\n    const o = this._getTextureSamplingMethod(this.interpolation),\n          u = this.isRendereredSource || !(null != (s = e.capabilities.textureFloat) && s.textureFloat);\n\n    this._rasterTexture = _(e, i, o, u), this._rasterTextureBandIds = this.bandIds ? [...this.bandIds] : null;\n  }\n\n  _isBandIdschanged(t) {\n    const e = this._rasterTextureBandIds;\n    return !(null == e && null == t || e && t && e.join(\"\") === t.join(\"\"));\n  }\n\n  _isValidSource(e) {\n    var r;\n    return t(e) && (null == (r = e.pixels) ? void 0 : r.length) > 0;\n  }\n\n  _getTextureSamplingMethod(e) {\n    const {\n      type: r,\n      colormap: s\n    } = this.symbolizerParameters,\n          i = \"lut\" === r || \"stretch\" === r && t(s);\n    return !this._supportsBilinearTexture || i || \"bilinear\" !== e && \"cubic\" !== e ? \"nearest\" : \"bilinear\";\n  }\n\n  _updateColormapTexture(t) {\n    const e = this._colormap,\n          r = this.symbolizerParameters.colormap;\n    return r ? e ? r.length !== e.length || r.some((t, r) => t !== e[r]) ? (this._colormapTexture && (this._colormapTexture.dispose(), this._colormapTexture = null), this._colormapTexture = m(t, r), void (this._colormap = r)) : void 0 : (this._colormapTexture = m(t, r), void (this._colormap = r)) : (this._colormapTexture && (this._colormapTexture.dispose(), this._colormapTexture = null), void (this._colormap = null));\n  }\n\n}\n\nclass c extends p {\n  get source() {\n    return this._source;\n  }\n\n}\n\nfunction T(e) {\n  return t(e.source);\n}\n\nexport { p as RasterBitmap, c as RasterBitmapWithSource, T as hasSource };","map":{"version":3,"sources":["D:/Github/CUSP_DataBase/CUSP_DB/src/main/gis/node_modules/@arcgis/core/views/2d/engine/imagery/RasterBitmap.js"],"names":["isSome","t","b","e","c","r","s","j","i","m","a","o","f","u","extractBands","n","DisplayObject","l","TextureSamplingMode","h","createTransformTexture","d","createRasterTexture","_","createColormapTexture","x","bandCount","outMin","outMax","minCutOff","maxCutOff","factor","useGamma","gamma","gammaCorrection","colormap","colormapOffset","stretchType","type","p","constructor","_textureInvalidated","_colormapTextureInvalidated","_supportsBilinearTexture","stencilRef","coordScale","_symbolizerParameters","height","isRendereredSource","pixelRatio","resolution","rotation","_source","rawPixelData","_suspended","_bandIds","_interpolation","_transformGrid","width","y","source","transformGrid","interpolation","destroy","getTextures","textures","forEach","dispose","_rasterTexture","_transformGridTexture","_colormapTexture","symbolizerParameters","_rasterTextureBandIds","invalidateTexture","suspended","stage","ready","requestRender","bandIds","_isBandIdschanged","setSamplingMode","_getTextureSamplingMethod","LINEAR","NEAREST","_createTransforms","dvs","setTransform","transforms","toScreenNoRotation","Math","PI","displayViewMat3","push","names","onAttach","onDetach","updateTexture","context","_isValidSource","_updateColormapTexture","_createOrDestroyRasterTexture","setData","capabilities","textureFloat","textureFloatLinear","join","pixels","length","_colormap","some","T","RasterBitmap","RasterBitmapWithSource","hasSource"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport{isSome as t}from\"../../../../core/maybe.js\";import{b as e,c as r,r as s,j as i,m as a}from\"../../../../chunks/mat3.js\";import{c as o}from\"../../../../chunks/mat3f32.js\";import{f as u}from\"../../../../chunks/vec2f32.js\";import{extractBands as n}from\"../../../../layers/support/rasterFunctions/pixelUtils.js\";import{DisplayObject as l}from\"../DisplayObject.js\";import{TextureSamplingMode as h}from\"../../../webgl/enums.js\";import{createTransformTexture as d,createRasterTexture as _,createColormapTexture as m}from\"../../../webgl/rasterUtils.js\";const x={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,stretchType:\"none\",type:\"stretch\"};class p extends l{constructor(t=null,e=null,r=null){super(),this._textureInvalidated=!0,this._colormapTextureInvalidated=!0,this._supportsBilinearTexture=!0,this.stencilRef=0,this.coordScale=[1,1],this._symbolizerParameters=null,this.height=null,this.isRendereredSource=!1,this.pixelRatio=1,this.resolution=0,this.rotation=0,this._source=null,this.rawPixelData=null,this._suspended=!1,this._bandIds=null,this._interpolation=null,this._transformGrid=null,this.width=null,this.x=0,this.y=0,this.source=t,this.transformGrid=e,this.interpolation=r}destroy(){const t=this.getTextures();null==t||t.textures.forEach((t=>t.dispose())),this._rasterTexture=null,this._transformGridTexture=null,this._colormapTexture=null}get symbolizerParameters(){return this._symbolizerParameters||x}set symbolizerParameters(t){this._symbolizerParameters!==t&&(this._symbolizerParameters=t,this._colormapTextureInvalidated=!0)}get source(){return this._source}set source(t){this._source!==t&&(this._source=t,this._rasterTexture&&(this._rasterTexture.dispose(),this._rasterTexture=null,this._rasterTextureBandIds=null),this.invalidateTexture())}get suspended(){return this._suspended}set suspended(t){this._suspended&&!t&&this.stage&&(this.ready(),this.requestRender()),this._suspended=t}get bandIds(){return this._bandIds}set bandIds(t){this._bandIds=t,this._isBandIdschanged(t)&&this.invalidateTexture()}get interpolation(){return this._interpolation||\"nearest\"}set interpolation(t){this._interpolation=t,this._rasterTexture&&this._rasterTexture.setSamplingMode(\"bilinear\"===this._getTextureSamplingMethod(t)?h.LINEAR:h.NEAREST)}get transformGrid(){return this._transformGrid}set transformGrid(t){this._transformGrid=t,this._transformGridTexture&&(this._transformGridTexture.dispose(),this._transformGridTexture=null)}invalidateTexture(){this._textureInvalidated||(this._textureInvalidated=!0,this.requestRender())}_createTransforms(){return{dvs:o()}}setTransform(t){const o=e(this.transforms.dvs),[n,l]=t.toScreenNoRotation([0,0],[this.x,this.y]),h=this.resolution/this.pixelRatio/t.resolution,d=h*this.width,_=h*this.height,m=Math.PI*this.rotation/180;r(o,o,u(n,l)),r(o,o,u(d/2,_/2)),s(o,o,-m),r(o,o,u(-d/2,-_/2)),i(o,o,u(d,_)),a(this.transforms.dvs,t.displayViewMat3,o)}getTextures(){if(!this._rasterTexture)return null;const t=[],e=[];return this._transformGridTexture&&(e.push(this._transformGridTexture),t.push(\"u_transformGrid\")),this._rasterTexture&&(e.push(this._rasterTexture),t.push(\"u_image\")),this._colormapTexture&&(e.push(this._colormapTexture),t.push(\"u_colormap\")),{names:t,textures:e}}onAttach(){this.invalidateTexture()}onDetach(){this.invalidateTexture()}updateTexture({context:t}){var e,r,s;if(!this.stage)return null==(e=this._rasterTexture)||e.dispose(),null==(r=this._transformGridTexture)||r.dispose(),null==(s=this._colormapTexture)||s.dispose(),this._rasterTexture=null,this._rasterTextureBandIds=null,this._transformGridTexture=null,void(this._colormapTexture=null);const i=this._isValidSource(this.source);i&&this._colormapTextureInvalidated&&(this._colormapTextureInvalidated=!1,this._updateColormapTexture(t)),this._textureInvalidated&&(this._textureInvalidated=!1,this._createOrDestroyRasterTexture(t),this._rasterTexture&&(i?this.transformGrid&&!this._transformGridTexture&&(this._transformGridTexture=d(t,this.transformGrid)):this._rasterTexture.setData(null)),this.suspended||(this.ready(),this.requestRender()))}_createOrDestroyRasterTexture(e){var r,s;const i=t(this.source)?n(this.source,this.bandIds):null;if(!this._isValidSource(i))return void(this._rasterTexture&&(this._rasterTexture.dispose(),this._rasterTextureBandIds=null,this._rasterTexture=null));const a=!this._isBandIdschanged(this.bandIds);if(this._rasterTexture){if(a)return;this._rasterTexture.dispose(),this._rasterTextureBandIds=null,this._rasterTexture=null}this._supportsBilinearTexture=null==(r=e.capabilities.textureFloat)?void 0:r.textureFloatLinear;const o=this._getTextureSamplingMethod(this.interpolation),u=this.isRendereredSource||!(null!=(s=e.capabilities.textureFloat)&&s.textureFloat);this._rasterTexture=_(e,i,o,u),this._rasterTextureBandIds=this.bandIds?[...this.bandIds]:null}_isBandIdschanged(t){const e=this._rasterTextureBandIds;return!(null==e&&null==t||e&&t&&e.join(\"\")===t.join(\"\"))}_isValidSource(e){var r;return t(e)&&(null==(r=e.pixels)?void 0:r.length)>0}_getTextureSamplingMethod(e){const{type:r,colormap:s}=this.symbolizerParameters,i=\"lut\"===r||\"stretch\"===r&&t(s);return!this._supportsBilinearTexture||i||\"bilinear\"!==e&&\"cubic\"!==e?\"nearest\":\"bilinear\"}_updateColormapTexture(t){const e=this._colormap,r=this.symbolizerParameters.colormap;return r?e?r.length!==e.length||r.some(((t,r)=>t!==e[r]))?(this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null),this._colormapTexture=m(t,r),void(this._colormap=r)):void 0:(this._colormapTexture=m(t,r),void(this._colormap=r)):(this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null),void(this._colormap=null))}}class c extends p{get source(){return this._source}}function T(e){return t(e.source)}export{p as RasterBitmap,c as RasterBitmapWithSource,T as hasSource};\n"]},"metadata":{},"sourceType":"module"}