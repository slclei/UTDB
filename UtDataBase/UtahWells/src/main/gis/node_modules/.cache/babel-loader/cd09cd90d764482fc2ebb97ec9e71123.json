{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport e from \"../../../../core/Error.js\";\nimport t from \"../../../../core/Logger.js\";\nimport { isSome as r } from \"../../../../core/maybe.js\";\nimport { e as s } from \"../../../../chunks/earcut.js\";\nimport { s as o } from \"../../../../chunks/vec2.js\";\nimport { a as n } from \"../../../../chunks/vec2f64.js\";\nimport { convertFromNestedArray as i, convertFromPolygon as c } from \"../../../../layers/graphics/featureConversionUtils.js\";\nimport a from \"../../../../layers/graphics/OptimizedGeometry.js\";\nimport { i1616to32 as f } from \"./number.js\";\nimport { BufferObject as h } from \"../../../webgl/BufferObject.js\";\nimport { PrimitiveType as m, Usage as u, DataType as y } from \"../../../webgl/enums.js\";\n\nconst x = t.getLogger(\"esri.views.2d.engine.webgl.Mesh2D\"),\n      g = t => {\n  switch (t.BYTES_PER_ELEMENT) {\n    case 1:\n      return y.UNSIGNED_BYTE;\n\n    case 2:\n      return y.UNSIGNED_SHORT;\n\n    case 4:\n      return y.UNSIGNED_INT;\n\n    default:\n      throw new e(\"Cannot get DataType of array\");\n  }\n},\n      p = (e, t, r, s) => {\n  let o = 0;\n\n  for (let n = 1; n < r; n++) {\n    const r = e[2 * (t + n - 1)],\n          s = e[2 * (t + n - 1) + 1];\n    o += (e[2 * (t + n)] - r) * (e[2 * (t + n) + 1] + s);\n  }\n\n  return s ? o > 0 : o < 0;\n},\n      l = (_ref, r) => {\n  let {\n    coords: e,\n    lengths: t\n  } = _ref;\n  const o = [];\n\n  for (let n = 0, i = 0; n < t.length; i += t[n], n += 1) {\n    const c = i,\n          a = [];\n\n    for (; n < t.length - 1 && p(e, i + t[n], t[n + 1], r); n += 1, i += t[n]) a.push(i + t[n] - c);\n\n    const f = e.slice(2 * c, 2 * (i + t[n])),\n          h = s(f, a, 2);\n\n    for (const e of h) o.push(e + c);\n  }\n\n  return o;\n};\n\nclass w {\n  constructor(e, t, r) {\n    let s = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : !1;\n    this._cache = {}, this.vertices = e, this.indices = t, this.primitiveType = r, this.isMapSpace = s;\n  }\n\n  static fromRect(_ref2) {\n    let {\n      x: e,\n      y: t,\n      width: r,\n      height: s\n    } = _ref2;\n    const o = e,\n          n = t,\n          i = o + r,\n          c = n + s;\n    return w.fromScreenExtent({\n      xmin: o,\n      ymin: n,\n      xmax: i,\n      ymax: c\n    });\n  }\n\n  static fromPath(e) {\n    const t = i(new a(), e.path, !1, !1),\n          r = t.coords,\n          s = new Uint32Array(l(t, !0)),\n          o = new Uint32Array(r.length / 2);\n\n    for (let n = 0; n < o.length; n++) o[n] = f(Math.floor(r[2 * n]), Math.floor(r[2 * n + 1]));\n\n    return new w({\n      geometry: o\n    }, s, m.TRIANGLES);\n  }\n\n  static fromGeometry(t, r) {\n    const s = r.geometry.type;\n\n    switch (s) {\n      case \"polygon\":\n        return w.fromPolygon(t, r.geometry);\n\n      case \"extent\":\n        return w.fromMapExtent(t, r.geometry);\n\n      default:\n        return x.error(new e(\"mapview-bad-type\", `Unable to create a mesh from type ${s}`, r)), w.fromRect({\n          x: 0,\n          y: 0,\n          width: 1,\n          height: 1\n        });\n    }\n  }\n\n  static fromPolygon(e, t) {\n    const r = c(new a(), t, !1, !1),\n          s = r.coords,\n          i = new Uint32Array(l(r, !1)),\n          h = new Uint32Array(s.length / 2),\n          u = n(),\n          y = n();\n\n    for (let n = 0; n < h.length; n++) o(u, s[2 * n], s[2 * n + 1]), e.toScreen(y, u), h[n] = f(Math.floor(y[0]), Math.floor(y[1]));\n\n    return new w({\n      geometry: h\n    }, i, m.TRIANGLES, !0);\n  }\n\n  static fromScreenExtent(_ref3) {\n    let {\n      xmin: e,\n      xmax: t,\n      ymin: r,\n      ymax: s\n    } = _ref3;\n    const o = {\n      geometry: new Uint32Array([f(e, r), f(t, r), f(e, s), f(e, s), f(t, r), f(t, s)])\n    },\n          n = new Uint32Array([0, 1, 2, 3, 4, 5]);\n    return new w(o, n, m.TRIANGLES);\n  }\n\n  static fromMapExtent(e, t) {\n    const [r, s] = e.toScreen([0, 0], [t.xmin, t.ymin]),\n          [o, n] = e.toScreen([0, 0], [t.xmax, t.ymax]),\n          i = {\n      geometry: new Uint32Array([f(r, s), f(o, s), f(r, n), f(r, n), f(o, s), f(o, n)])\n    },\n          c = new Uint32Array([0, 1, 2, 3, 4, 5]);\n    return new w(i, c, m.TRIANGLES);\n  }\n\n  destroy() {\n    r(this._cache.indexBuffer) && this._cache.indexBuffer.dispose();\n\n    for (const e in this._cache.vertexBuffers) r(this._cache.vertexBuffers[e]) && this._cache.vertexBuffers[e].dispose();\n  }\n\n  get elementType() {\n    return g(this.indices);\n  }\n\n  getIndexBuffer(e) {\n    let t = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : u.STATIC_DRAW;\n    return this._cache.indexBuffer || (this._cache.indexBuffer = h.createIndex(e, t, this.indices)), this._cache.indexBuffer;\n  }\n\n  getVertexBuffers(e) {\n    let t = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : u.STATIC_DRAW;\n    return this._cache.vertexBuffers || (this._cache.vertexBuffers = Object.keys(this.vertices).reduce((r, s) => ({ ...r,\n      [s]: h.createVertex(e, t, this.vertices[s])\n    }), {})), this._cache.vertexBuffers;\n  }\n\n}\n\nexport { w as default };","map":{"version":3,"sources":["D:/Github/CUSP_DataBase/CUSP_DB/src/main/gis/node_modules/@arcgis/core/views/2d/engine/webgl/Mesh2D.js"],"names":["e","t","isSome","r","s","o","a","n","convertFromNestedArray","i","convertFromPolygon","c","i1616to32","f","BufferObject","h","PrimitiveType","m","Usage","u","DataType","y","x","getLogger","g","BYTES_PER_ELEMENT","UNSIGNED_BYTE","UNSIGNED_SHORT","UNSIGNED_INT","p","l","coords","lengths","length","push","slice","w","constructor","_cache","vertices","indices","primitiveType","isMapSpace","fromRect","width","height","fromScreenExtent","xmin","ymin","xmax","ymax","fromPath","path","Uint32Array","Math","floor","geometry","TRIANGLES","fromGeometry","type","fromPolygon","fromMapExtent","error","toScreen","destroy","indexBuffer","dispose","vertexBuffers","elementType","getIndexBuffer","STATIC_DRAW","createIndex","getVertexBuffers","Object","keys","reduce","createVertex","default"],"mappings":"AAAA;AACA;AACA;AACA;AACA,OAAOA,CAAP,MAAa,2BAAb;AAAyC,OAAOC,CAAP,MAAa,4BAAb;AAA0C,SAAOC,MAAM,IAAIC,CAAjB,QAAuB,2BAAvB;AAAmD,SAAOH,CAAC,IAAII,CAAZ,QAAkB,8BAAlB;AAAiD,SAAOA,CAAC,IAAIC,CAAZ,QAAkB,4BAAlB;AAA+C,SAAOC,CAAC,IAAIC,CAAZ,QAAkB,+BAAlB;AAAkD,SAAOC,sBAAsB,IAAIC,CAAjC,EAAmCC,kBAAkB,IAAIC,CAAzD,QAA+D,uDAA/D;AAAuH,OAAOL,CAAP,MAAa,kDAAb;AAAgE,SAAOM,SAAS,IAAIC,CAApB,QAA0B,aAA1B;AAAwC,SAAOC,YAAY,IAAIC,CAAvB,QAA6B,gCAA7B;AAA8D,SAAOC,aAAa,IAAIC,CAAxB,EAA0BC,KAAK,IAAIC,CAAnC,EAAqCC,QAAQ,IAAIC,CAAjD,QAAuD,yBAAvD;;AAAiF,MAAMC,CAAC,GAACrB,CAAC,CAACsB,SAAF,CAAY,mCAAZ,CAAR;AAAA,MAAyDC,CAAC,GAACvB,CAAC,IAAE;AAAC,UAAOA,CAAC,CAACwB,iBAAT;AAA4B,SAAK,CAAL;AAAO,aAAOJ,CAAC,CAACK,aAAT;;AAAuB,SAAK,CAAL;AAAO,aAAOL,CAAC,CAACM,cAAT;;AAAwB,SAAK,CAAL;AAAO,aAAON,CAAC,CAACO,YAAT;;AAAsB;AAAQ,YAAM,IAAI5B,CAAJ,CAAM,8BAAN,CAAN;AAA9H;AAA2K,CAA1O;AAAA,MAA2O6B,CAAC,GAAC,CAAC7B,CAAD,EAAGC,CAAH,EAAKE,CAAL,EAAOC,CAAP,KAAW;AAAC,MAAIC,CAAC,GAAC,CAAN;;AAAQ,OAAI,IAAIE,CAAC,GAAC,CAAV,EAAYA,CAAC,GAACJ,CAAd,EAAgBI,CAAC,EAAjB,EAAoB;AAAC,UAAMJ,CAAC,GAACH,CAAC,CAAC,KAAGC,CAAC,GAACM,CAAF,GAAI,CAAP,CAAD,CAAT;AAAA,UAAqBH,CAAC,GAACJ,CAAC,CAAC,KAAGC,CAAC,GAACM,CAAF,GAAI,CAAP,IAAU,CAAX,CAAxB;AAAsCF,IAAAA,CAAC,IAAE,CAACL,CAAC,CAAC,KAAGC,CAAC,GAACM,CAAL,CAAD,CAAD,GAAWJ,CAAZ,KAAgBH,CAAC,CAAC,KAAGC,CAAC,GAACM,CAAL,IAAQ,CAAT,CAAD,GAAaH,CAA7B,CAAH;AAAmC;;AAAA,SAAOA,CAAC,GAACC,CAAC,GAAC,CAAH,GAAKA,CAAC,GAAC,CAAf;AAAiB,CAAhX;AAAA,MAAiXyB,CAAC,GAAC,OAAsB3B,CAAtB,KAA0B;AAAA,MAAzB;AAAC4B,IAAAA,MAAM,EAAC/B,CAAR;AAAUgC,IAAAA,OAAO,EAAC/B;AAAlB,GAAyB;AAAC,QAAMI,CAAC,GAAC,EAAR;;AAAW,OAAI,IAAIE,CAAC,GAAC,CAAN,EAAQE,CAAC,GAAC,CAAd,EAAgBF,CAAC,GAACN,CAAC,CAACgC,MAApB,EAA2BxB,CAAC,IAAER,CAAC,CAACM,CAAD,CAAJ,EAAQA,CAAC,IAAE,CAAtC,EAAwC;AAAC,UAAMI,CAAC,GAACF,CAAR;AAAA,UAAUH,CAAC,GAAC,EAAZ;;AAAe,WAAKC,CAAC,GAACN,CAAC,CAACgC,MAAF,GAAS,CAAX,IAAcJ,CAAC,CAAC7B,CAAD,EAAGS,CAAC,GAACR,CAAC,CAACM,CAAD,CAAN,EAAUN,CAAC,CAACM,CAAC,GAAC,CAAH,CAAX,EAAiBJ,CAAjB,CAApB,EAAwCI,CAAC,IAAE,CAAH,EAAKE,CAAC,IAAER,CAAC,CAACM,CAAD,CAAjD,EAAqDD,CAAC,CAAC4B,IAAF,CAAOzB,CAAC,GAACR,CAAC,CAACM,CAAD,CAAH,GAAOI,CAAd;;AAAiB,UAAME,CAAC,GAACb,CAAC,CAACmC,KAAF,CAAQ,IAAExB,CAAV,EAAY,KAAGF,CAAC,GAACR,CAAC,CAACM,CAAD,CAAN,CAAZ,CAAR;AAAA,UAAgCQ,CAAC,GAACX,CAAC,CAACS,CAAD,EAAGP,CAAH,EAAK,CAAL,CAAnC;;AAA2C,SAAI,MAAMN,CAAV,IAAee,CAAf,EAAiBV,CAAC,CAAC6B,IAAF,CAAOlC,CAAC,GAACW,CAAT;AAAY;;AAAA,SAAON,CAAP;AAAS,CAAxmB;;AAAymB,MAAM+B,CAAN,CAAO;AAACC,EAAAA,WAAW,CAACrC,CAAD,EAAGC,CAAH,EAAKE,CAAL,EAAY;AAAA,QAALC,CAAK,uEAAH,CAAC,CAAE;AAAC,SAAKkC,MAAL,GAAY,EAAZ,EAAe,KAAKC,QAAL,GAAcvC,CAA7B,EAA+B,KAAKwC,OAAL,GAAavC,CAA5C,EAA8C,KAAKwC,aAAL,GAAmBtC,CAAjE,EAAmE,KAAKuC,UAAL,GAAgBtC,CAAnF;AAAqF;;AAAe,SAARuC,QAAQ,QAA4B;AAAA,QAA3B;AAACrB,MAAAA,CAAC,EAACtB,CAAH;AAAKqB,MAAAA,CAAC,EAACpB,CAAP;AAAS2C,MAAAA,KAAK,EAACzC,CAAf;AAAiB0C,MAAAA,MAAM,EAACzC;AAAxB,KAA2B;AAAC,UAAMC,CAAC,GAACL,CAAR;AAAA,UAAUO,CAAC,GAACN,CAAZ;AAAA,UAAcQ,CAAC,GAACJ,CAAC,GAACF,CAAlB;AAAA,UAAoBQ,CAAC,GAACJ,CAAC,GAACH,CAAxB;AAA0B,WAAOgC,CAAC,CAACU,gBAAF,CAAmB;AAACC,MAAAA,IAAI,EAAC1C,CAAN;AAAQ2C,MAAAA,IAAI,EAACzC,CAAb;AAAe0C,MAAAA,IAAI,EAACxC,CAApB;AAAsByC,MAAAA,IAAI,EAACvC;AAA3B,KAAnB,CAAP;AAAyD;;AAAe,SAARwC,QAAQ,CAACnD,CAAD,EAAG;AAAC,UAAMC,CAAC,GAACQ,CAAC,CAAC,IAAIH,CAAJ,EAAD,EAAON,CAAC,CAACoD,IAAT,EAAc,CAAC,CAAf,EAAiB,CAAC,CAAlB,CAAT;AAAA,UAA8BjD,CAAC,GAACF,CAAC,CAAC8B,MAAlC;AAAA,UAAyC3B,CAAC,GAAC,IAAIiD,WAAJ,CAAgBvB,CAAC,CAAC7B,CAAD,EAAG,CAAC,CAAJ,CAAjB,CAA3C;AAAA,UAAoEI,CAAC,GAAC,IAAIgD,WAAJ,CAAgBlD,CAAC,CAAC8B,MAAF,GAAS,CAAzB,CAAtE;;AAAkG,SAAI,IAAI1B,CAAC,GAAC,CAAV,EAAYA,CAAC,GAACF,CAAC,CAAC4B,MAAhB,EAAuB1B,CAAC,EAAxB,EAA2BF,CAAC,CAACE,CAAD,CAAD,GAAKM,CAAC,CAACyC,IAAI,CAACC,KAAL,CAAWpD,CAAC,CAAC,IAAEI,CAAH,CAAZ,CAAD,EAAoB+C,IAAI,CAACC,KAAL,CAAWpD,CAAC,CAAC,IAAEI,CAAF,GAAI,CAAL,CAAZ,CAApB,CAAN;;AAAgD,WAAO,IAAI6B,CAAJ,CAAM;AAACoB,MAAAA,QAAQ,EAACnD;AAAV,KAAN,EAAmBD,CAAnB,EAAqBa,CAAC,CAACwC,SAAvB,CAAP;AAAyC;;AAAmB,SAAZC,YAAY,CAACzD,CAAD,EAAGE,CAAH,EAAK;AAAC,UAAMC,CAAC,GAACD,CAAC,CAACqD,QAAF,CAAWG,IAAnB;;AAAwB,YAAOvD,CAAP;AAAU,WAAI,SAAJ;AAAc,eAAOgC,CAAC,CAACwB,WAAF,CAAc3D,CAAd,EAAgBE,CAAC,CAACqD,QAAlB,CAAP;;AAAmC,WAAI,QAAJ;AAAa,eAAOpB,CAAC,CAACyB,aAAF,CAAgB5D,CAAhB,EAAkBE,CAAC,CAACqD,QAApB,CAAP;;AAAqC;AAAQ,eAAOlC,CAAC,CAACwC,KAAF,CAAQ,IAAI9D,CAAJ,CAAM,kBAAN,EAA0B,qCAAoCI,CAAE,EAAhE,EAAkED,CAAlE,CAAR,GAA8EiC,CAAC,CAACO,QAAF,CAAW;AAACrB,UAAAA,CAAC,EAAC,CAAH;AAAKD,UAAAA,CAAC,EAAC,CAAP;AAASuB,UAAAA,KAAK,EAAC,CAAf;AAAiBC,UAAAA,MAAM,EAAC;AAAxB,SAAX,CAArF;AAArH;AAAkP;;AAAkB,SAAXe,WAAW,CAAC5D,CAAD,EAAGC,CAAH,EAAK;AAAC,UAAME,CAAC,GAACQ,CAAC,CAAC,IAAIL,CAAJ,EAAD,EAAOL,CAAP,EAAS,CAAC,CAAV,EAAY,CAAC,CAAb,CAAT;AAAA,UAAyBG,CAAC,GAACD,CAAC,CAAC4B,MAA7B;AAAA,UAAoCtB,CAAC,GAAC,IAAI4C,WAAJ,CAAgBvB,CAAC,CAAC3B,CAAD,EAAG,CAAC,CAAJ,CAAjB,CAAtC;AAAA,UAA+DY,CAAC,GAAC,IAAIsC,WAAJ,CAAgBjD,CAAC,CAAC6B,MAAF,GAAS,CAAzB,CAAjE;AAAA,UAA6Fd,CAAC,GAACZ,CAAC,EAAhG;AAAA,UAAmGc,CAAC,GAACd,CAAC,EAAtG;;AAAyG,SAAI,IAAIA,CAAC,GAAC,CAAV,EAAYA,CAAC,GAACQ,CAAC,CAACkB,MAAhB,EAAuB1B,CAAC,EAAxB,EAA2BF,CAAC,CAACc,CAAD,EAAGf,CAAC,CAAC,IAAEG,CAAH,CAAJ,EAAUH,CAAC,CAAC,IAAEG,CAAF,GAAI,CAAL,CAAX,CAAD,EAAqBP,CAAC,CAAC+D,QAAF,CAAW1C,CAAX,EAAaF,CAAb,CAArB,EAAqCJ,CAAC,CAACR,CAAD,CAAD,GAAKM,CAAC,CAACyC,IAAI,CAACC,KAAL,CAAWlC,CAAC,CAAC,CAAD,CAAZ,CAAD,EAAkBiC,IAAI,CAACC,KAAL,CAAWlC,CAAC,CAAC,CAAD,CAAZ,CAAlB,CAA3C;;AAA+E,WAAO,IAAIe,CAAJ,CAAM;AAACoB,MAAAA,QAAQ,EAACzC;AAAV,KAAN,EAAmBN,CAAnB,EAAqBQ,CAAC,CAACwC,SAAvB,EAAiC,CAAC,CAAlC,CAAP;AAA4C;;AAAuB,SAAhBX,gBAAgB,QAA+B;AAAA,QAA9B;AAACC,MAAAA,IAAI,EAAC/C,CAAN;AAAQiD,MAAAA,IAAI,EAAChD,CAAb;AAAe+C,MAAAA,IAAI,EAAC7C,CAApB;AAAsB+C,MAAAA,IAAI,EAAC9C;AAA3B,KAA8B;AAAC,UAAMC,CAAC,GAAC;AAACmD,MAAAA,QAAQ,EAAC,IAAIH,WAAJ,CAAgB,CAACxC,CAAC,CAACb,CAAD,EAAGG,CAAH,CAAF,EAAQU,CAAC,CAACZ,CAAD,EAAGE,CAAH,CAAT,EAAeU,CAAC,CAACb,CAAD,EAAGI,CAAH,CAAhB,EAAsBS,CAAC,CAACb,CAAD,EAAGI,CAAH,CAAvB,EAA6BS,CAAC,CAACZ,CAAD,EAAGE,CAAH,CAA9B,EAAoCU,CAAC,CAACZ,CAAD,EAAGG,CAAH,CAArC,CAAhB;AAAV,KAAR;AAAA,UAAgFG,CAAC,GAAC,IAAI8C,WAAJ,CAAgB,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,EAAO,CAAP,EAAS,CAAT,EAAW,CAAX,CAAhB,CAAlF;AAAiH,WAAO,IAAIjB,CAAJ,CAAM/B,CAAN,EAAQE,CAAR,EAAUU,CAAC,CAACwC,SAAZ,CAAP;AAA8B;;AAAoB,SAAbI,aAAa,CAAC7D,CAAD,EAAGC,CAAH,EAAK;AAAC,UAAK,CAACE,CAAD,EAAGC,CAAH,IAAMJ,CAAC,CAAC+D,QAAF,CAAW,CAAC,CAAD,EAAG,CAAH,CAAX,EAAiB,CAAC9D,CAAC,CAAC8C,IAAH,EAAQ9C,CAAC,CAAC+C,IAAV,CAAjB,CAAX;AAAA,UAA6C,CAAC3C,CAAD,EAAGE,CAAH,IAAMP,CAAC,CAAC+D,QAAF,CAAW,CAAC,CAAD,EAAG,CAAH,CAAX,EAAiB,CAAC9D,CAAC,CAACgD,IAAH,EAAQhD,CAAC,CAACiD,IAAV,CAAjB,CAAnD;AAAA,UAAqFzC,CAAC,GAAC;AAAC+C,MAAAA,QAAQ,EAAC,IAAIH,WAAJ,CAAgB,CAACxC,CAAC,CAACV,CAAD,EAAGC,CAAH,CAAF,EAAQS,CAAC,CAACR,CAAD,EAAGD,CAAH,CAAT,EAAeS,CAAC,CAACV,CAAD,EAAGI,CAAH,CAAhB,EAAsBM,CAAC,CAACV,CAAD,EAAGI,CAAH,CAAvB,EAA6BM,CAAC,CAACR,CAAD,EAAGD,CAAH,CAA9B,EAAoCS,CAAC,CAACR,CAAD,EAAGE,CAAH,CAArC,CAAhB;AAAV,KAAvF;AAAA,UAA+JI,CAAC,GAAC,IAAI0C,WAAJ,CAAgB,CAAC,CAAD,EAAG,CAAH,EAAK,CAAL,EAAO,CAAP,EAAS,CAAT,EAAW,CAAX,CAAhB,CAAjK;AAAgM,WAAO,IAAIjB,CAAJ,CAAM3B,CAAN,EAAQE,CAAR,EAAUM,CAAC,CAACwC,SAAZ,CAAP;AAA8B;;AAAAO,EAAAA,OAAO,GAAE;AAAC7D,IAAAA,CAAC,CAAC,KAAKmC,MAAL,CAAY2B,WAAb,CAAD,IAA4B,KAAK3B,MAAL,CAAY2B,WAAZ,CAAwBC,OAAxB,EAA5B;;AAA8D,SAAI,MAAMlE,CAAV,IAAe,KAAKsC,MAAL,CAAY6B,aAA3B,EAAyChE,CAAC,CAAC,KAAKmC,MAAL,CAAY6B,aAAZ,CAA0BnE,CAA1B,CAAD,CAAD,IAAiC,KAAKsC,MAAL,CAAY6B,aAAZ,CAA0BnE,CAA1B,EAA6BkE,OAA7B,EAAjC;AAAwE;;AAAe,MAAXE,WAAW,GAAE;AAAC,WAAO5C,CAAC,CAAC,KAAKgB,OAAN,CAAR;AAAuB;;AAAA6B,EAAAA,cAAc,CAACrE,CAAD,EAAmB;AAAA,QAAhBC,CAAgB,uEAAdkB,CAAC,CAACmD,WAAY;AAAC,WAAO,KAAKhC,MAAL,CAAY2B,WAAZ,KAA0B,KAAK3B,MAAL,CAAY2B,WAAZ,GAAwBlD,CAAC,CAACwD,WAAF,CAAcvE,CAAd,EAAgBC,CAAhB,EAAkB,KAAKuC,OAAvB,CAAlD,GAAmF,KAAKF,MAAL,CAAY2B,WAAtG;AAAkH;;AAAAO,EAAAA,gBAAgB,CAACxE,CAAD,EAAmB;AAAA,QAAhBC,CAAgB,uEAAdkB,CAAC,CAACmD,WAAY;AAAC,WAAO,KAAKhC,MAAL,CAAY6B,aAAZ,KAA4B,KAAK7B,MAAL,CAAY6B,aAAZ,GAA0BM,MAAM,CAACC,IAAP,CAAY,KAAKnC,QAAjB,EAA2BoC,MAA3B,CAAmC,CAACxE,CAAD,EAAGC,CAAH,MAAQ,EAAC,GAAGD,CAAJ;AAAM,OAACC,CAAD,GAAIW,CAAC,CAAC6D,YAAF,CAAe5E,CAAf,EAAiBC,CAAjB,EAAmB,KAAKsC,QAAL,CAAcnC,CAAd,CAAnB;AAAV,KAAR,CAAnC,EAA6F,EAA7F,CAAtD,GAAwJ,KAAKkC,MAAL,CAAY6B,aAA3K;AAAyL;;AAAjiE;;AAAkiE,SAAO/B,CAAC,IAAIyC,OAAZ","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport e from\"../../../../core/Error.js\";import t from\"../../../../core/Logger.js\";import{isSome as r}from\"../../../../core/maybe.js\";import{e as s}from\"../../../../chunks/earcut.js\";import{s as o}from\"../../../../chunks/vec2.js\";import{a as n}from\"../../../../chunks/vec2f64.js\";import{convertFromNestedArray as i,convertFromPolygon as c}from\"../../../../layers/graphics/featureConversionUtils.js\";import a from\"../../../../layers/graphics/OptimizedGeometry.js\";import{i1616to32 as f}from\"./number.js\";import{BufferObject as h}from\"../../../webgl/BufferObject.js\";import{PrimitiveType as m,Usage as u,DataType as y}from\"../../../webgl/enums.js\";const x=t.getLogger(\"esri.views.2d.engine.webgl.Mesh2D\"),g=t=>{switch(t.BYTES_PER_ELEMENT){case 1:return y.UNSIGNED_BYTE;case 2:return y.UNSIGNED_SHORT;case 4:return y.UNSIGNED_INT;default:throw new e(\"Cannot get DataType of array\")}},p=(e,t,r,s)=>{let o=0;for(let n=1;n<r;n++){const r=e[2*(t+n-1)],s=e[2*(t+n-1)+1];o+=(e[2*(t+n)]-r)*(e[2*(t+n)+1]+s)}return s?o>0:o<0},l=({coords:e,lengths:t},r)=>{const o=[];for(let n=0,i=0;n<t.length;i+=t[n],n+=1){const c=i,a=[];for(;n<t.length-1&&p(e,i+t[n],t[n+1],r);n+=1,i+=t[n])a.push(i+t[n]-c);const f=e.slice(2*c,2*(i+t[n])),h=s(f,a,2);for(const e of h)o.push(e+c)}return o};class w{constructor(e,t,r,s=!1){this._cache={},this.vertices=e,this.indices=t,this.primitiveType=r,this.isMapSpace=s}static fromRect({x:e,y:t,width:r,height:s}){const o=e,n=t,i=o+r,c=n+s;return w.fromScreenExtent({xmin:o,ymin:n,xmax:i,ymax:c})}static fromPath(e){const t=i(new a,e.path,!1,!1),r=t.coords,s=new Uint32Array(l(t,!0)),o=new Uint32Array(r.length/2);for(let n=0;n<o.length;n++)o[n]=f(Math.floor(r[2*n]),Math.floor(r[2*n+1]));return new w({geometry:o},s,m.TRIANGLES)}static fromGeometry(t,r){const s=r.geometry.type;switch(s){case\"polygon\":return w.fromPolygon(t,r.geometry);case\"extent\":return w.fromMapExtent(t,r.geometry);default:return x.error(new e(\"mapview-bad-type\",`Unable to create a mesh from type ${s}`,r)),w.fromRect({x:0,y:0,width:1,height:1})}}static fromPolygon(e,t){const r=c(new a,t,!1,!1),s=r.coords,i=new Uint32Array(l(r,!1)),h=new Uint32Array(s.length/2),u=n(),y=n();for(let n=0;n<h.length;n++)o(u,s[2*n],s[2*n+1]),e.toScreen(y,u),h[n]=f(Math.floor(y[0]),Math.floor(y[1]));return new w({geometry:h},i,m.TRIANGLES,!0)}static fromScreenExtent({xmin:e,xmax:t,ymin:r,ymax:s}){const o={geometry:new Uint32Array([f(e,r),f(t,r),f(e,s),f(e,s),f(t,r),f(t,s)])},n=new Uint32Array([0,1,2,3,4,5]);return new w(o,n,m.TRIANGLES)}static fromMapExtent(e,t){const[r,s]=e.toScreen([0,0],[t.xmin,t.ymin]),[o,n]=e.toScreen([0,0],[t.xmax,t.ymax]),i={geometry:new Uint32Array([f(r,s),f(o,s),f(r,n),f(r,n),f(o,s),f(o,n)])},c=new Uint32Array([0,1,2,3,4,5]);return new w(i,c,m.TRIANGLES)}destroy(){r(this._cache.indexBuffer)&&this._cache.indexBuffer.dispose();for(const e in this._cache.vertexBuffers)r(this._cache.vertexBuffers[e])&&this._cache.vertexBuffers[e].dispose()}get elementType(){return g(this.indices)}getIndexBuffer(e,t=u.STATIC_DRAW){return this._cache.indexBuffer||(this._cache.indexBuffer=h.createIndex(e,t,this.indices)),this._cache.indexBuffer}getVertexBuffers(e,t=u.STATIC_DRAW){return this._cache.vertexBuffers||(this._cache.vertexBuffers=Object.keys(this.vertices).reduce(((r,s)=>({...r,[s]:h.createVertex(e,t,this.vertices[s])})),{})),this._cache.vertexBuffers}}export{w as default};\n"]},"metadata":{},"sourceType":"module"}