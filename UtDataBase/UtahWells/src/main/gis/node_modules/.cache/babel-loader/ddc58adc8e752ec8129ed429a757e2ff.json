{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport t from \"../../core/Logger.js\";\nimport { isSome as e, isNone as i } from \"../../core/maybe.js\";\nimport { BufferObject as r } from \"./BufferObject.js\";\nimport { webglDebugEnabled as s, webglValidateShadersEnabled as h } from \"./checkWebGLError.js\";\nimport { ContextType as n } from \"./context-util.js\";\nimport { ResourceType as c, ColorAttachment as o, DepthStencilTargetType as _, PixelFormat as a, PixelType as l, DepthStencilAttachment as T, RenderbufferFormat as E, FramebufferTarget as d, TextureType as u, Usage as f, BufferType as m, TargetType as A, TextureSamplingMode as p, TextureWrapMode as R, SizedPixelFormat as N } from \"./enums.js\";\nimport { Renderbuffer as g } from \"./Renderbuffer.js\";\nimport { Texture as F } from \"./Texture.js\";\nimport { getGpuMemoryUsage as x } from \"./Util.js\";\nconst b = t.getLogger(\"esri.views.webgl.FrameBufferObject\");\n\nclass D {\n  constructor(t, i) {\n    let r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n    let s = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : null;\n\n    if (this._context = t, this._glName = null, this._depthAttachment = null, this._stencilAttachment = null, this._colorAttachments = new Map(), this._initialized = !1, this._desc = { ...i\n    }, t.instanceCounter.increment(c.Framebuffer, this), e(r)) {\n      Array.isArray(r) || (r = [r]);\n\n      for (let t = 0; t < r.length; ++t) {\n        const e = r[t],\n              i = o.COLOR_ATTACHMENT0 + t;\n        let s;\n        U(e) ? (C(e) ? (s = e.descriptor, this._colorAttachments.set(i, e)) : (s = e, this._colorAttachments.set(i, new F(this._context, s))), P(s, this._desc)) : (S(e) ? (s = e.descriptor, this._colorAttachments.set(i, e)) : (s = e, this._colorAttachments.set(i, new g(this._context, s))), B(s, this._desc)), this._validateColorAttachmentPoint(i);\n      }\n    }\n\n    if (e(s)) {\n      let t, e;\n      if (U(s)) this._context.capabilities.depthTexture || console.error(\"Setting the depth/stencil texture as an attachment requires WEBGL_depth_texture or WebGL2\"), C(s) ? (e = s.descriptor, this._depthStencilTexture = s) : (e = s, this._depthStencilTexture = new F(this._context, e)), P(e, this._desc);else {\n        var h;\n        S(s) ? (e = s.descriptor, t = s) : (e = s, t = new g(this._context, e));\n        const i = null != (h = this._desc.depthStencilTarget) ? h : _.DEPTH_STENCIL_RENDER_BUFFER;\n        i === _.STENCIL_RENDER_BUFFER ? this._stencilAttachment = t : i === _.DEPTH_RENDER_BUFFER || i === _.DEPTH_STENCIL_RENDER_BUFFER ? this._depthAttachment = t : console.error('If a Renderbuffer is provided, \"depthStencilTarget\" must be one of STENCIL_RENDER_BUFFER, DEPTH_RENDER_BUFFER or DEPTH_STENCIL_RENDER_BUFFER'), B(e, this._desc);\n      }\n    }\n  }\n\n  dispose() {\n    if (!this._desc) return;\n\n    const t = this._context.getBoundFramebufferObject();\n\n    if (this._disposeColorAttachments(), this._disposeDepthStencilAttachments(), this._glName) {\n      this._context.gl.deleteFramebuffer(this._glName), this._glName = null;\n    }\n\n    this._context.bindFramebuffer(t), this._context.instanceCounter.decrement(c.Framebuffer, this), this._desc = null;\n  }\n\n  get glName() {\n    return this._glName;\n  }\n\n  get descriptor() {\n    return this._desc;\n  }\n\n  get colorTexture() {\n    const t = this._colorAttachments.get(o.COLOR_ATTACHMENT0);\n\n    return t && C(t) ? t : null;\n  }\n\n  get colorAttachment() {\n    return this._colorAttachments.get(o.COLOR_ATTACHMENT0);\n  }\n\n  get depthStencilAttachment() {\n    return this._depthStencilTexture || this._depthAttachment || this._stencilAttachment;\n  }\n\n  get depthStencilTexture() {\n    return this._depthStencilTexture;\n  }\n\n  get width() {\n    return this._desc.width;\n  }\n\n  get height() {\n    return this._desc.height;\n  }\n\n  get gpuMemoryUsage() {\n    return [...this._colorAttachments].reduce((t, _ref) => {\n      let [e, i] = _ref;\n      return t + x(i);\n    }, 0) + x(this.depthStencilAttachment);\n  }\n\n  getColorTexture(t) {\n    const e = this._colorAttachments.get(t);\n\n    return e && C(e) ? e : null;\n  }\n\n  attachColorTexture(t) {\n    let e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : o.COLOR_ATTACHMENT0;\n    if (!t) return;\n\n    this._validateColorAttachmentPoint(e);\n\n    P(t.descriptor, this._desc), this._disposeColorAttachments(), this._initialized && (this._context.bindFramebuffer(this), this._framebufferTexture2D(t.glName, e)), this._colorAttachments.set(e, t);\n  }\n\n  detachColorTexture() {\n    let t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : o.COLOR_ATTACHMENT0;\n\n    const e = this._colorAttachments.get(t);\n\n    if (C(e)) {\n      const i = e;\n      return this._initialized && (this._context.bindFramebuffer(this), this._framebufferTexture2D(null, t)), this._colorAttachments.delete(t), i;\n    }\n  }\n\n  setColorTextureTarget(t) {\n    let e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : o.COLOR_ATTACHMENT0;\n\n    const i = this._colorAttachments.get(e);\n\n    C(i) && this._framebufferTexture2D(i.glName, e, t);\n  }\n\n  attachDepthStencilTexture(t) {\n    if (i(t)) return;\n    const e = t.descriptor;\n    e.pixelFormat !== a.DEPTH_STENCIL && console.error(\"Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!\"), e.dataType !== l.UNSIGNED_INT_24_8 && console.error(\"Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!\"), this._context.capabilities.depthTexture || console.error(\"Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!\"), P(e, this._desc), this._desc.depthStencilTarget && this._desc.depthStencilTarget !== _.DEPTH_STENCIL_TEXTURE && (this._desc.depthStencilTarget = _.DEPTH_STENCIL_TEXTURE), this._disposeDepthStencilAttachments(), this._initialized && (this._context.bindFramebuffer(this), this._framebufferTexture2D(t.glName, T)), this._depthStencilTexture = t;\n  }\n\n  detachDepthStencilTexture() {\n    const t = this._depthStencilTexture;\n    return t && this._initialized && (this._context.bindFramebuffer(this), this._framebufferTexture2D(null, T)), this._depthStencilTexture = null, t;\n  }\n\n  attachDepthStencilBuffer(t) {\n    if (i(t)) return;\n    const e = t.descriptor;\n\n    if (e.internalFormat !== E.DEPTH_STENCIL && e.internalFormat !== E.DEPTH_COMPONENT16 && console.error(\"Depth/Stencil buffer must have correct internalFormat\"), B(e, this._desc), this._disposeDepthStencilAttachments(), this._desc.depthStencilTarget = e.internalFormat === E.DEPTH_STENCIL ? _.DEPTH_STENCIL_RENDER_BUFFER : _.DEPTH_RENDER_BUFFER, this._initialized) {\n      this._context.bindFramebuffer(this);\n\n      const e = this._context.gl,\n            i = this._desc.depthStencilTarget === _.DEPTH_RENDER_BUFFER ? e.DEPTH_ATTACHMENT : e.DEPTH_STENCIL_ATTACHMENT;\n      e.framebufferRenderbuffer(d.FRAMEBUFFER, i, e.RENDERBUFFER, t.glName);\n    }\n\n    this._depthAttachment = t;\n  }\n\n  detachDepthStencilBuffer() {\n    const t = this._context.gl,\n          e = this._depthAttachment;\n\n    if (e && this._initialized) {\n      this._context.bindFramebuffer(this);\n\n      const e = this._desc.depthStencilTarget === _.DEPTH_RENDER_BUFFER ? t.DEPTH_ATTACHMENT : t.DEPTH_STENCIL_ATTACHMENT;\n      t.framebufferRenderbuffer(d.FRAMEBUFFER, e, t.RENDERBUFFER, null);\n    }\n\n    return this._depthAttachment = null, e;\n  }\n\n  detachAll() {\n    this._colorAttachments.forEach((t, e) => this._detachColorAttachment(e)), this.detachDepthStencilBuffer(), this.detachDepthStencilTexture();\n  }\n\n  copyToTexture(t, e, i, r, s, h, n) {\n    (t < 0 || e < 0 || s < 0 || h < 0) && console.error(\"Offsets cannot be negative!\"), (i <= 0 || r <= 0) && console.error(\"Copy width and height must be greater than zero!\");\n    const c = this._desc,\n          o = n.descriptor;\n    n.descriptor.target !== u.TEXTURE_2D && console.error(\"Texture target must be TEXTURE_2D!\"), (t + i > c.width || e + r > c.height || s + i > o.width || h + r > o.height) && console.error(\"Bad dimensions, the current input values will attempt to read or copy out of bounds!\");\n\n    const _ = this._context,\n          a = _.bindTexture(n, F.TEXTURE_UNIT_FOR_UPDATES);\n\n    _.setActiveTexture(F.TEXTURE_UNIT_FOR_UPDATES), _.bindFramebuffer(this), _.gl.copyTexSubImage2D(u.TEXTURE_2D, 0, s, h, t, e, i, r), _.bindTexture(a, F.TEXTURE_UNIT_FOR_UPDATES);\n  }\n\n  readPixels(t, e, i, r, s, h, n) {\n    (i <= 0 || r <= 0) && console.error(\"Copy width and height must be greater than zero!\"), n || console.error(\"Target memory is not initialized!\"), this._context.bindFramebuffer(this);\n\n    this._context.gl.readPixels(t, e, i, r, s, h, n);\n  }\n\n  async readPixelsAsync(t, e, i, h, c, o, _) {\n    if (this._context.type !== n.WEBGL2) return s() && console.warn(\"Attempting to read pixels using pixel buffer object without WebGL2\"), void this.readPixels(t, e, i, h, c, o, _);\n    const a = this._context.gl,\n          l = r.createPixelPack(this._context, f.STREAM_READ, _.byteLength);\n    this._context.bindBuffer(l), this._context.bindFramebuffer(this), a.readPixels(t, e, i, h, c, o, 0), this._context.unbindBuffer(m.PIXEL_PACK_BUFFER), await l.getSubDataAsync(_), l.dispose();\n  }\n\n  resize(t, e) {\n    const i = this._desc;\n\n    if (i.width !== t || i.height !== e) {\n      if (!this._initialized) return i.width = t, i.height = e, this._colorAttachments.forEach(i => {\n        i && i.resize(t, e);\n      }), void (this._depthStencilTexture && this._depthStencilTexture.resize(t, e));\n      i.width = t, i.height = e, this._colorAttachments.forEach(i => {\n        i && i.resize(t, e);\n      }), null != this._depthStencilTexture ? this._depthStencilTexture.resize(t, e) : (this._depthAttachment || this._stencilAttachment) && (this._depthAttachment && this._depthAttachment.resize(t, e), this._stencilAttachment && this._stencilAttachment.resize(t, e)), this._context.getBoundFramebufferObject() === this && this._context.bindFramebuffer(null), this._initialized = !1;\n    }\n  }\n\n  initializeAndBind() {\n    let t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : d.FRAMEBUFFER;\n    var e, i, r, s;\n    const n = this._context.gl;\n    if (this._initialized) return void n.bindFramebuffer(t, this.glName);\n    this._glName && n.deleteFramebuffer(this._glName);\n    const c = this._context,\n          T = n.createFramebuffer(),\n          f = this._desc,\n          m = null != (e = f.colorTarget) ? e : A.RENDER_BUFFER,\n          x = null != (i = f.width) ? i : 1,\n          b = null != (r = f.height) ? r : 1;\n    if (n.bindFramebuffer(t, T), 0 === this._colorAttachments.size) if (m === A.TEXTURE || m === A.CUBEMAP) this._colorAttachments.set(o.COLOR_ATTACHMENT0, H(c, f, this.descriptor.colorTarget === A.CUBEMAP ? u.TEXTURE_CUBE_MAP : u.TEXTURE_2D));else {\n      const t = new g(c, {\n        internalFormat: N.RGBA4,\n        width: x,\n        height: b\n      });\n\n      this._colorAttachments.set(o.COLOR_ATTACHMENT0, t);\n    }\n\n    this._colorAttachments.forEach((e, i) => {\n      e && (C(e) ? this._framebufferTexture2D(e.glName, i, M(e), t) : n.framebufferRenderbuffer(t, i, n.RENDERBUFFER, e.glName));\n    });\n\n    const D = null != (s = f.depthStencilTarget) ? s : _.NONE;\n\n    switch (D) {\n      case _.DEPTH_RENDER_BUFFER:\n      case _.DEPTH_STENCIL_RENDER_BUFFER:\n        {\n          this._depthAttachment || (this._depthAttachment = new g(c, {\n            internalFormat: f.depthStencilTarget === _.DEPTH_RENDER_BUFFER ? E.DEPTH_COMPONENT16 : E.DEPTH_STENCIL,\n            width: x,\n            height: b\n          }));\n          const e = D === _.DEPTH_RENDER_BUFFER ? n.DEPTH_ATTACHMENT : n.DEPTH_STENCIL_ATTACHMENT;\n          n.framebufferRenderbuffer(t, e, n.RENDERBUFFER, this._depthAttachment.glName);\n          break;\n        }\n\n      case _.STENCIL_RENDER_BUFFER:\n        this._stencilAttachment || (this._stencilAttachment = new g(c, {\n          internalFormat: E.STENCIL_INDEX8,\n          width: x,\n          height: b\n        })), n.framebufferRenderbuffer(t, n.STENCIL_ATTACHMENT, n.RENDERBUFFER, this._stencilAttachment.glName);\n        break;\n\n      case _.DEPTH_STENCIL_TEXTURE:\n        if (!this._depthStencilTexture) {\n          c.capabilities.depthTexture || console.error(\"Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!\");\n          const t = {\n            target: u.TEXTURE_2D,\n            pixelFormat: a.DEPTH_STENCIL,\n            dataType: l.UNSIGNED_INT_24_8,\n            samplingMode: p.NEAREST,\n            wrapMode: R.CLAMP_TO_EDGE,\n            width: x,\n            height: b\n          };\n          this._depthStencilTexture = new F(c, t);\n        }\n\n        this._framebufferTexture2D(this._depthStencilTexture.glName, n.DEPTH_STENCIL_ATTACHMENT, M(this._depthStencilTexture), t);\n\n    }\n\n    if (h()) {\n      n.checkFramebufferStatus(t) !== n.FRAMEBUFFER_COMPLETE && console.error(\"Framebuffer is incomplete!\");\n    }\n\n    this._glName = T, this._initialized = !0;\n  }\n\n  _framebufferTexture2D(t) {\n    let e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : o.COLOR_ATTACHMENT0;\n    let i = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : u.TEXTURE_2D;\n    let r = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : d.FRAMEBUFFER;\n    let s = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : 0;\n\n    this._context.gl.framebufferTexture2D(r, e, i, t, s);\n  }\n\n  _detachColorAttachment(t) {\n    s() && console.warn(\"Detaching an FBO attachment can be a slow due to invalidating framebuffer completeness!\");\n\n    const e = this._context.gl,\n          i = this._colorAttachments.get(t);\n\n    return C(i) ? this._initialized && (this._context.bindFramebuffer(this), this._framebufferTexture2D(null, t)) : this._initialized && (this._context.bindFramebuffer(this), e.framebufferRenderbuffer(d.FRAMEBUFFER, t, e.RENDERBUFFER, null)), this._colorAttachments.delete(t), i;\n  }\n\n  _disposeColorAttachments() {\n    this._colorAttachments.forEach((t, e) => {\n      this._detachColorAttachment(e), t.dispose();\n    }), this._colorAttachments.clear();\n  }\n\n  _disposeDepthStencilAttachments() {\n    const t = this._context.gl;\n\n    if (this._depthAttachment) {\n      if (this._initialized) {\n        this._context.bindFramebuffer(this);\n\n        const e = this._desc.depthStencilTarget === _.DEPTH_RENDER_BUFFER ? t.DEPTH_ATTACHMENT : t.DEPTH_STENCIL_ATTACHMENT;\n        t.framebufferRenderbuffer(d.FRAMEBUFFER, e, t.RENDERBUFFER, null);\n      }\n\n      this._depthAttachment.dispose(), this._depthAttachment = null;\n    }\n\n    this._stencilAttachment && (this._initialized && (this._context.bindFramebuffer(this), t.framebufferRenderbuffer(d.FRAMEBUFFER, t.STENCIL_ATTACHMENT, t.RENDERBUFFER, null)), this._stencilAttachment.dispose(), this._stencilAttachment = null), this._depthStencilTexture && (this._initialized && (this._context.bindFramebuffer(this), this._framebufferTexture2D(null, t.DEPTH_STENCIL_ATTACHMENT)), this._depthStencilTexture.dispose(), this._depthStencilTexture = null);\n  }\n\n  _validateColorAttachmentPoint(t) {\n    if (-1 === D._MAX_COLOR_ATTACHMENTS) {\n      const t = this._context.capabilities.drawBuffers;\n\n      if (t) {\n        const e = this._context.gl;\n        D._MAX_COLOR_ATTACHMENTS = e.getParameter(t.MAX_COLOR_ATTACHMENTS);\n      } else D._MAX_COLOR_ATTACHMENTS = 1;\n    }\n\n    const e = t - o.COLOR_ATTACHMENT0;\n    e + 1 > D._MAX_COLOR_ATTACHMENTS && b.error(\"esri.FrameBufferObject\", `illegal attachment point for color attachment: ${e + 1}. Implementation supports up to ${D._MAX_COLOR_ATTACHMENTS} color attachments`);\n  }\n\n}\n\nfunction C(t) {\n  return \"type\" in t && \"texture\" === t.type;\n}\n\nfunction S(t) {\n  return \"type\" in t && \"renderbuffer\" === t.type;\n}\n\nfunction U(t) {\n  return C(t) || \"pixelFormat\" in t;\n}\n\nfunction H(t, e, i) {\n  return new F(t, {\n    target: i,\n    pixelFormat: a.RGBA,\n    dataType: l.UNSIGNED_BYTE,\n    samplingMode: p.NEAREST,\n    wrapMode: R.CLAMP_TO_EDGE,\n    width: e.width,\n    height: e.height\n  });\n}\n\nfunction P(t, e) {\n  t.target !== u.TEXTURE_2D && t.target !== u.TEXTURE_CUBE_MAP && console.error(\"Texture type must be TEXTURE_2D or TEXTURE_CUBE_MAP!\"), void 0 !== e.width && e.width >= 0 && void 0 !== e.height && e.height >= 0 ? e.width === t.width && e.height === t.height || console.error(\"Color attachment texture must match the framebuffer's!\") : (e.width = t.width, e.height = t.height);\n}\n\nfunction B(t, e) {\n  void 0 !== e.width && e.width >= 0 && void 0 !== e.height && e.height >= 0 ? e.width === t.width && e.height === t.height || console.error(\"Renderbuffer dimensions must match the framebuffer's!\") : (e.width = t.width, e.height = t.height);\n}\n\nfunction M(t) {\n  return t.descriptor.target === u.TEXTURE_CUBE_MAP ? u.TEXTURE_CUBE_MAP_POSITIVE_X : u.TEXTURE_2D;\n}\n\nD._MAX_COLOR_ATTACHMENTS = -1;\nexport { D as FramebufferObject };","map":{"version":3,"sources":["D:/Github/CUSP_DataBase/CUSP_DB/src/main/gis/node_modules/@arcgis/core/views/webgl/FramebufferObject.js"],"names":["t","isSome","e","isNone","i","BufferObject","r","webglDebugEnabled","s","webglValidateShadersEnabled","h","ContextType","n","ResourceType","c","ColorAttachment","o","DepthStencilTargetType","_","PixelFormat","a","PixelType","l","DepthStencilAttachment","T","RenderbufferFormat","E","FramebufferTarget","d","TextureType","u","Usage","f","BufferType","m","TargetType","A","TextureSamplingMode","p","TextureWrapMode","R","SizedPixelFormat","N","Renderbuffer","g","Texture","F","getGpuMemoryUsage","x","b","getLogger","D","constructor","_context","_glName","_depthAttachment","_stencilAttachment","_colorAttachments","Map","_initialized","_desc","instanceCounter","increment","Framebuffer","Array","isArray","length","COLOR_ATTACHMENT0","U","C","descriptor","set","P","S","B","_validateColorAttachmentPoint","capabilities","depthTexture","console","error","_depthStencilTexture","depthStencilTarget","DEPTH_STENCIL_RENDER_BUFFER","STENCIL_RENDER_BUFFER","DEPTH_RENDER_BUFFER","dispose","getBoundFramebufferObject","_disposeColorAttachments","_disposeDepthStencilAttachments","gl","deleteFramebuffer","bindFramebuffer","decrement","glName","colorTexture","get","colorAttachment","depthStencilAttachment","depthStencilTexture","width","height","gpuMemoryUsage","reduce","getColorTexture","attachColorTexture","_framebufferTexture2D","detachColorTexture","delete","setColorTextureTarget","attachDepthStencilTexture","pixelFormat","DEPTH_STENCIL","dataType","UNSIGNED_INT_24_8","DEPTH_STENCIL_TEXTURE","detachDepthStencilTexture","attachDepthStencilBuffer","internalFormat","DEPTH_COMPONENT16","DEPTH_ATTACHMENT","DEPTH_STENCIL_ATTACHMENT","framebufferRenderbuffer","FRAMEBUFFER","RENDERBUFFER","detachDepthStencilBuffer","detachAll","forEach","_detachColorAttachment","copyToTexture","target","TEXTURE_2D","bindTexture","TEXTURE_UNIT_FOR_UPDATES","setActiveTexture","copyTexSubImage2D","readPixels","readPixelsAsync","type","WEBGL2","warn","createPixelPack","STREAM_READ","byteLength","bindBuffer","unbindBuffer","PIXEL_PACK_BUFFER","getSubDataAsync","resize","initializeAndBind","createFramebuffer","colorTarget","RENDER_BUFFER","size","TEXTURE","CUBEMAP","H","TEXTURE_CUBE_MAP","RGBA4","M","NONE","STENCIL_INDEX8","STENCIL_ATTACHMENT","samplingMode","NEAREST","wrapMode","CLAMP_TO_EDGE","checkFramebufferStatus","FRAMEBUFFER_COMPLETE","framebufferTexture2D","clear","_MAX_COLOR_ATTACHMENTS","drawBuffers","getParameter","MAX_COLOR_ATTACHMENTS","RGBA","UNSIGNED_BYTE","TEXTURE_CUBE_MAP_POSITIVE_X","FramebufferObject"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport t from\"../../core/Logger.js\";import{isSome as e,isNone as i}from\"../../core/maybe.js\";import{BufferObject as r}from\"./BufferObject.js\";import{webglDebugEnabled as s,webglValidateShadersEnabled as h}from\"./checkWebGLError.js\";import{ContextType as n}from\"./context-util.js\";import{ResourceType as c,ColorAttachment as o,DepthStencilTargetType as _,PixelFormat as a,PixelType as l,DepthStencilAttachment as T,RenderbufferFormat as E,FramebufferTarget as d,TextureType as u,Usage as f,BufferType as m,TargetType as A,TextureSamplingMode as p,TextureWrapMode as R,SizedPixelFormat as N}from\"./enums.js\";import{Renderbuffer as g}from\"./Renderbuffer.js\";import{Texture as F}from\"./Texture.js\";import{getGpuMemoryUsage as x}from\"./Util.js\";const b=t.getLogger(\"esri.views.webgl.FrameBufferObject\");class D{constructor(t,i,r=null,s=null){if(this._context=t,this._glName=null,this._depthAttachment=null,this._stencilAttachment=null,this._colorAttachments=new Map,this._initialized=!1,this._desc={...i},t.instanceCounter.increment(c.Framebuffer,this),e(r)){Array.isArray(r)||(r=[r]);for(let t=0;t<r.length;++t){const e=r[t],i=o.COLOR_ATTACHMENT0+t;let s;U(e)?(C(e)?(s=e.descriptor,this._colorAttachments.set(i,e)):(s=e,this._colorAttachments.set(i,new F(this._context,s))),P(s,this._desc)):(S(e)?(s=e.descriptor,this._colorAttachments.set(i,e)):(s=e,this._colorAttachments.set(i,new g(this._context,s))),B(s,this._desc)),this._validateColorAttachmentPoint(i)}}if(e(s)){let t,e;if(U(s))this._context.capabilities.depthTexture||console.error(\"Setting the depth/stencil texture as an attachment requires WEBGL_depth_texture or WebGL2\"),C(s)?(e=s.descriptor,this._depthStencilTexture=s):(e=s,this._depthStencilTexture=new F(this._context,e)),P(e,this._desc);else{var h;S(s)?(e=s.descriptor,t=s):(e=s,t=new g(this._context,e));const i=null!=(h=this._desc.depthStencilTarget)?h:_.DEPTH_STENCIL_RENDER_BUFFER;i===_.STENCIL_RENDER_BUFFER?this._stencilAttachment=t:i===_.DEPTH_RENDER_BUFFER||i===_.DEPTH_STENCIL_RENDER_BUFFER?this._depthAttachment=t:console.error('If a Renderbuffer is provided, \"depthStencilTarget\" must be one of STENCIL_RENDER_BUFFER, DEPTH_RENDER_BUFFER or DEPTH_STENCIL_RENDER_BUFFER'),B(e,this._desc)}}}dispose(){if(!this._desc)return;const t=this._context.getBoundFramebufferObject();if(this._disposeColorAttachments(),this._disposeDepthStencilAttachments(),this._glName){this._context.gl.deleteFramebuffer(this._glName),this._glName=null}this._context.bindFramebuffer(t),this._context.instanceCounter.decrement(c.Framebuffer,this),this._desc=null}get glName(){return this._glName}get descriptor(){return this._desc}get colorTexture(){const t=this._colorAttachments.get(o.COLOR_ATTACHMENT0);return t&&C(t)?t:null}get colorAttachment(){return this._colorAttachments.get(o.COLOR_ATTACHMENT0)}get depthStencilAttachment(){return this._depthStencilTexture||this._depthAttachment||this._stencilAttachment}get depthStencilTexture(){return this._depthStencilTexture}get width(){return this._desc.width}get height(){return this._desc.height}get gpuMemoryUsage(){return[...this._colorAttachments].reduce(((t,[e,i])=>t+x(i)),0)+x(this.depthStencilAttachment)}getColorTexture(t){const e=this._colorAttachments.get(t);return e&&C(e)?e:null}attachColorTexture(t,e=o.COLOR_ATTACHMENT0){if(!t)return;this._validateColorAttachmentPoint(e);P(t.descriptor,this._desc),this._disposeColorAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(t.glName,e)),this._colorAttachments.set(e,t)}detachColorTexture(t=o.COLOR_ATTACHMENT0){const e=this._colorAttachments.get(t);if(C(e)){const i=e;return this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,t)),this._colorAttachments.delete(t),i}}setColorTextureTarget(t,e=o.COLOR_ATTACHMENT0){const i=this._colorAttachments.get(e);C(i)&&this._framebufferTexture2D(i.glName,e,t)}attachDepthStencilTexture(t){if(i(t))return;const e=t.descriptor;e.pixelFormat!==a.DEPTH_STENCIL&&console.error(\"Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!\"),e.dataType!==l.UNSIGNED_INT_24_8&&console.error(\"Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!\"),this._context.capabilities.depthTexture||console.error(\"Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!\"),P(e,this._desc),this._desc.depthStencilTarget&&this._desc.depthStencilTarget!==_.DEPTH_STENCIL_TEXTURE&&(this._desc.depthStencilTarget=_.DEPTH_STENCIL_TEXTURE),this._disposeDepthStencilAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(t.glName,T)),this._depthStencilTexture=t}detachDepthStencilTexture(){const t=this._depthStencilTexture;return t&&this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,T)),this._depthStencilTexture=null,t}attachDepthStencilBuffer(t){if(i(t))return;const e=t.descriptor;if(e.internalFormat!==E.DEPTH_STENCIL&&e.internalFormat!==E.DEPTH_COMPONENT16&&console.error(\"Depth/Stencil buffer must have correct internalFormat\"),B(e,this._desc),this._disposeDepthStencilAttachments(),this._desc.depthStencilTarget=e.internalFormat===E.DEPTH_STENCIL?_.DEPTH_STENCIL_RENDER_BUFFER:_.DEPTH_RENDER_BUFFER,this._initialized){this._context.bindFramebuffer(this);const e=this._context.gl,i=this._desc.depthStencilTarget===_.DEPTH_RENDER_BUFFER?e.DEPTH_ATTACHMENT:e.DEPTH_STENCIL_ATTACHMENT;e.framebufferRenderbuffer(d.FRAMEBUFFER,i,e.RENDERBUFFER,t.glName)}this._depthAttachment=t}detachDepthStencilBuffer(){const t=this._context.gl,e=this._depthAttachment;if(e&&this._initialized){this._context.bindFramebuffer(this);const e=this._desc.depthStencilTarget===_.DEPTH_RENDER_BUFFER?t.DEPTH_ATTACHMENT:t.DEPTH_STENCIL_ATTACHMENT;t.framebufferRenderbuffer(d.FRAMEBUFFER,e,t.RENDERBUFFER,null)}return this._depthAttachment=null,e}detachAll(){this._colorAttachments.forEach(((t,e)=>this._detachColorAttachment(e))),this.detachDepthStencilBuffer(),this.detachDepthStencilTexture()}copyToTexture(t,e,i,r,s,h,n){(t<0||e<0||s<0||h<0)&&console.error(\"Offsets cannot be negative!\"),(i<=0||r<=0)&&console.error(\"Copy width and height must be greater than zero!\");const c=this._desc,o=n.descriptor;n.descriptor.target!==u.TEXTURE_2D&&console.error(\"Texture target must be TEXTURE_2D!\"),(t+i>c.width||e+r>c.height||s+i>o.width||h+r>o.height)&&console.error(\"Bad dimensions, the current input values will attempt to read or copy out of bounds!\");const _=this._context,a=_.bindTexture(n,F.TEXTURE_UNIT_FOR_UPDATES);_.setActiveTexture(F.TEXTURE_UNIT_FOR_UPDATES),_.bindFramebuffer(this),_.gl.copyTexSubImage2D(u.TEXTURE_2D,0,s,h,t,e,i,r),_.bindTexture(a,F.TEXTURE_UNIT_FOR_UPDATES)}readPixels(t,e,i,r,s,h,n){(i<=0||r<=0)&&console.error(\"Copy width and height must be greater than zero!\"),n||console.error(\"Target memory is not initialized!\"),this._context.bindFramebuffer(this);this._context.gl.readPixels(t,e,i,r,s,h,n)}async readPixelsAsync(t,e,i,h,c,o,_){if(this._context.type!==n.WEBGL2)return s()&&console.warn(\"Attempting to read pixels using pixel buffer object without WebGL2\"),void this.readPixels(t,e,i,h,c,o,_);const a=this._context.gl,l=r.createPixelPack(this._context,f.STREAM_READ,_.byteLength);this._context.bindBuffer(l),this._context.bindFramebuffer(this),a.readPixels(t,e,i,h,c,o,0),this._context.unbindBuffer(m.PIXEL_PACK_BUFFER),await l.getSubDataAsync(_),l.dispose()}resize(t,e){const i=this._desc;if(i.width!==t||i.height!==e){if(!this._initialized)return i.width=t,i.height=e,this._colorAttachments.forEach((i=>{i&&i.resize(t,e)})),void(this._depthStencilTexture&&this._depthStencilTexture.resize(t,e));i.width=t,i.height=e,this._colorAttachments.forEach((i=>{i&&i.resize(t,e)})),null!=this._depthStencilTexture?this._depthStencilTexture.resize(t,e):(this._depthAttachment||this._stencilAttachment)&&(this._depthAttachment&&this._depthAttachment.resize(t,e),this._stencilAttachment&&this._stencilAttachment.resize(t,e)),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1}}initializeAndBind(t=d.FRAMEBUFFER){var e,i,r,s;const n=this._context.gl;if(this._initialized)return void n.bindFramebuffer(t,this.glName);this._glName&&n.deleteFramebuffer(this._glName);const c=this._context,T=n.createFramebuffer(),f=this._desc,m=null!=(e=f.colorTarget)?e:A.RENDER_BUFFER,x=null!=(i=f.width)?i:1,b=null!=(r=f.height)?r:1;if(n.bindFramebuffer(t,T),0===this._colorAttachments.size)if(m===A.TEXTURE||m===A.CUBEMAP)this._colorAttachments.set(o.COLOR_ATTACHMENT0,H(c,f,this.descriptor.colorTarget===A.CUBEMAP?u.TEXTURE_CUBE_MAP:u.TEXTURE_2D));else{const t=new g(c,{internalFormat:N.RGBA4,width:x,height:b});this._colorAttachments.set(o.COLOR_ATTACHMENT0,t)}this._colorAttachments.forEach(((e,i)=>{e&&(C(e)?this._framebufferTexture2D(e.glName,i,M(e),t):n.framebufferRenderbuffer(t,i,n.RENDERBUFFER,e.glName))}));const D=null!=(s=f.depthStencilTarget)?s:_.NONE;switch(D){case _.DEPTH_RENDER_BUFFER:case _.DEPTH_STENCIL_RENDER_BUFFER:{this._depthAttachment||(this._depthAttachment=new g(c,{internalFormat:f.depthStencilTarget===_.DEPTH_RENDER_BUFFER?E.DEPTH_COMPONENT16:E.DEPTH_STENCIL,width:x,height:b}));const e=D===_.DEPTH_RENDER_BUFFER?n.DEPTH_ATTACHMENT:n.DEPTH_STENCIL_ATTACHMENT;n.framebufferRenderbuffer(t,e,n.RENDERBUFFER,this._depthAttachment.glName);break}case _.STENCIL_RENDER_BUFFER:this._stencilAttachment||(this._stencilAttachment=new g(c,{internalFormat:E.STENCIL_INDEX8,width:x,height:b})),n.framebufferRenderbuffer(t,n.STENCIL_ATTACHMENT,n.RENDERBUFFER,this._stencilAttachment.glName);break;case _.DEPTH_STENCIL_TEXTURE:if(!this._depthStencilTexture){c.capabilities.depthTexture||console.error(\"Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!\");const t={target:u.TEXTURE_2D,pixelFormat:a.DEPTH_STENCIL,dataType:l.UNSIGNED_INT_24_8,samplingMode:p.NEAREST,wrapMode:R.CLAMP_TO_EDGE,width:x,height:b};this._depthStencilTexture=new F(c,t)}this._framebufferTexture2D(this._depthStencilTexture.glName,n.DEPTH_STENCIL_ATTACHMENT,M(this._depthStencilTexture),t)}if(h()){n.checkFramebufferStatus(t)!==n.FRAMEBUFFER_COMPLETE&&console.error(\"Framebuffer is incomplete!\")}this._glName=T,this._initialized=!0}_framebufferTexture2D(t,e=o.COLOR_ATTACHMENT0,i=u.TEXTURE_2D,r=d.FRAMEBUFFER,s=0){this._context.gl.framebufferTexture2D(r,e,i,t,s)}_detachColorAttachment(t){s()&&console.warn(\"Detaching an FBO attachment can be a slow due to invalidating framebuffer completeness!\");const e=this._context.gl,i=this._colorAttachments.get(t);return C(i)?this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,t)):this._initialized&&(this._context.bindFramebuffer(this),e.framebufferRenderbuffer(d.FRAMEBUFFER,t,e.RENDERBUFFER,null)),this._colorAttachments.delete(t),i}_disposeColorAttachments(){this._colorAttachments.forEach(((t,e)=>{this._detachColorAttachment(e),t.dispose()})),this._colorAttachments.clear()}_disposeDepthStencilAttachments(){const t=this._context.gl;if(this._depthAttachment){if(this._initialized){this._context.bindFramebuffer(this);const e=this._desc.depthStencilTarget===_.DEPTH_RENDER_BUFFER?t.DEPTH_ATTACHMENT:t.DEPTH_STENCIL_ATTACHMENT;t.framebufferRenderbuffer(d.FRAMEBUFFER,e,t.RENDERBUFFER,null)}this._depthAttachment.dispose(),this._depthAttachment=null}this._stencilAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),t.framebufferRenderbuffer(d.FRAMEBUFFER,t.STENCIL_ATTACHMENT,t.RENDERBUFFER,null)),this._stencilAttachment.dispose(),this._stencilAttachment=null),this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,t.DEPTH_STENCIL_ATTACHMENT)),this._depthStencilTexture.dispose(),this._depthStencilTexture=null)}_validateColorAttachmentPoint(t){if(-1===D._MAX_COLOR_ATTACHMENTS){const t=this._context.capabilities.drawBuffers;if(t){const e=this._context.gl;D._MAX_COLOR_ATTACHMENTS=e.getParameter(t.MAX_COLOR_ATTACHMENTS)}else D._MAX_COLOR_ATTACHMENTS=1}const e=t-o.COLOR_ATTACHMENT0;e+1>D._MAX_COLOR_ATTACHMENTS&&b.error(\"esri.FrameBufferObject\",`illegal attachment point for color attachment: ${e+1}. Implementation supports up to ${D._MAX_COLOR_ATTACHMENTS} color attachments`)}}function C(t){return\"type\"in t&&\"texture\"===t.type}function S(t){return\"type\"in t&&\"renderbuffer\"===t.type}function U(t){return C(t)||\"pixelFormat\"in t}function H(t,e,i){return new F(t,{target:i,pixelFormat:a.RGBA,dataType:l.UNSIGNED_BYTE,samplingMode:p.NEAREST,wrapMode:R.CLAMP_TO_EDGE,width:e.width,height:e.height})}function P(t,e){t.target!==u.TEXTURE_2D&&t.target!==u.TEXTURE_CUBE_MAP&&console.error(\"Texture type must be TEXTURE_2D or TEXTURE_CUBE_MAP!\"),void 0!==e.width&&e.width>=0&&void 0!==e.height&&e.height>=0?e.width===t.width&&e.height===t.height||console.error(\"Color attachment texture must match the framebuffer's!\"):(e.width=t.width,e.height=t.height)}function B(t,e){void 0!==e.width&&e.width>=0&&void 0!==e.height&&e.height>=0?e.width===t.width&&e.height===t.height||console.error(\"Renderbuffer dimensions must match the framebuffer's!\"):(e.width=t.width,e.height=t.height)}function M(t){return t.descriptor.target===u.TEXTURE_CUBE_MAP?u.TEXTURE_CUBE_MAP_POSITIVE_X:u.TEXTURE_2D}D._MAX_COLOR_ATTACHMENTS=-1;export{D as FramebufferObject};\n"]},"metadata":{},"sourceType":"module"}