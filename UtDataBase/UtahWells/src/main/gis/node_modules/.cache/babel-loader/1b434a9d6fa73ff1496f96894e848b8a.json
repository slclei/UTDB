{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../chunks/tslib.es6.js\";\nimport { isSome as r } from \"../core/maybe.js\";\nimport { eachAlwaysValues as s } from \"../core/promiseUtils.js\";\nimport \"../core/Logger.js\";\nimport \"../core/accessorSupport/ensureType.js\";\nimport \"../core/arrayUtils.js\";\nimport \"../core/has.js\";\nimport \"../core/accessorSupport/set.js\";\nimport { subclass as i } from \"../core/accessorSupport/decorators/subclass.js\";\n\nconst a = a => {\n  let p = class extends a {\n    async fetchPopupFeatures(e, r) {\n      await this.when();\n\n      const {\n        location: i,\n        queryArea: a,\n        layerViewsAndGraphics: p,\n        clientOnlyGraphics: t\n      } = await this._prepareFetchPopupFeatures(e, r),\n            o = Promise.resolve(t),\n            c = this._queryLayerPopupFeatures(a, p, r),\n            n = c.map(e => e.promise);\n\n      return {\n        location: i,\n        clientOnlyGraphics: t,\n        allGraphicsPromise: s([o, ...n]).then(e => Array.from(new Set(e.flat()))),\n        promisesPerLayerView: c\n      };\n    }\n\n    _queryLayerPopupFeatures(e, s, i) {\n      return s.map(_ref => {\n        let {\n          layerView: s,\n          graphics: a\n        } = _ref;\n        const p = {\n          clientGraphics: a,\n          event: r(i) ? i.event : null,\n          signal: r(i) ? i.signal : null,\n          defaultPopupTemplateEnabled: !!r(i) && !!i.defaultPopupTemplateEnabled\n        },\n              t = s.fetchPopupFeatures(e, p);\n        return {\n          layerView: s,\n          promise: t\n        };\n      });\n    }\n\n    _isValidPopupGraphic(e, s) {\n      return e && !!e.getEffectivePopupTemplate(r(s) && s.defaultPopupTemplateEnabled);\n    }\n\n    async _prepareFetchPopupFeatures(e, r) {\n      const {\n        clientGraphics: s,\n        queryArea: i,\n        location: a\n      } = await this._popupHitTestGraphics(e, r),\n            p = this._getFetchPopupLayerViews(),\n            {\n        layerViewsAndGraphics: t,\n        clientOnlyGraphics: o\n      } = this._graphicsPerFetchPopupLayerView(s, p);\n\n      return {\n        clientOnlyGraphics: o,\n        layerViewsAndGraphics: t,\n        queryArea: i,\n        location: a\n      };\n    }\n\n    async _popupHitTestGraphics(e, r) {\n      const {\n        results: s,\n        mapPoint: i\n      } = await this.popupHitTest(e),\n            a = s.filter(e => this._isValidPopupGraphic(e.graphic, r)),\n            p = a.length ? a[0].mapPoint : null;\n      return {\n        clientGraphics: a.map(e => e.graphic),\n        queryArea: i,\n        location: i || p\n      };\n    }\n\n    _getFetchPopupLayerViews() {\n      const e = [];\n      return this.allLayerViews.forEach(r => {\n        this._isValidPopupLayerView(r) && e.push(r);\n      }), r(this.graphicsView) && this._isValidPopupLayerView(this.graphicsView) && e.push(this.graphicsView), e.reverse();\n    }\n\n    _isValidPopupLayerView(e) {\n      return r(e) && (!(\"layer\" in e) || !e.suspended) && \"fetchPopupFeatures\" in e;\n    }\n\n    _graphicsPerFetchPopupLayerView(e, r) {\n      const s = [],\n            i = new Map(),\n            a = r.map(e => {\n        const r = [];\n        return \"layer\" in e ? i.set(e.layer, r) : i.set(e.graphics, r), {\n          layerView: e,\n          graphics: r\n        };\n      });\n\n      for (const p of e) {\n        const e = i.get(p.layer) || i.get(p.sourceLayer) || null;\n        e ? e.push(p) : s.push(p);\n      }\n\n      return {\n        layerViewsAndGraphics: a,\n        clientOnlyGraphics: s\n      };\n    }\n\n  };\n  return p = e([i(\"esri.views.PopupView\")], p), p;\n};\n\nexport { a as PopupView };","map":{"version":3,"sources":["D:/Github/CUSP_DataBase/CUSP_DB/src/main/gis/node_modules/@arcgis/core/views/PopupView.js"],"names":["_","e","isSome","r","eachAlwaysValues","s","subclass","i","a","p","fetchPopupFeatures","when","location","queryArea","layerViewsAndGraphics","clientOnlyGraphics","t","_prepareFetchPopupFeatures","o","Promise","resolve","c","_queryLayerPopupFeatures","n","map","promise","allGraphicsPromise","then","Array","from","Set","flat","promisesPerLayerView","layerView","graphics","clientGraphics","event","signal","defaultPopupTemplateEnabled","_isValidPopupGraphic","getEffectivePopupTemplate","_popupHitTestGraphics","_getFetchPopupLayerViews","_graphicsPerFetchPopupLayerView","results","mapPoint","popupHitTest","filter","graphic","length","allLayerViews","forEach","_isValidPopupLayerView","push","graphicsView","reverse","suspended","Map","set","layer","get","sourceLayer","PopupView"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../chunks/tslib.es6.js\";import{isSome as r}from\"../core/maybe.js\";import{eachAlwaysValues as s}from\"../core/promiseUtils.js\";import\"../core/Logger.js\";import\"../core/accessorSupport/ensureType.js\";import\"../core/arrayUtils.js\";import\"../core/has.js\";import\"../core/accessorSupport/set.js\";import{subclass as i}from\"../core/accessorSupport/decorators/subclass.js\";const a=a=>{let p=class extends a{async fetchPopupFeatures(e,r){await this.when();const{location:i,queryArea:a,layerViewsAndGraphics:p,clientOnlyGraphics:t}=await this._prepareFetchPopupFeatures(e,r),o=Promise.resolve(t),c=this._queryLayerPopupFeatures(a,p,r),n=c.map((e=>e.promise));return{location:i,clientOnlyGraphics:t,allGraphicsPromise:s([o,...n]).then((e=>Array.from(new Set(e.flat())))),promisesPerLayerView:c}}_queryLayerPopupFeatures(e,s,i){return s.map((({layerView:s,graphics:a})=>{const p={clientGraphics:a,event:r(i)?i.event:null,signal:r(i)?i.signal:null,defaultPopupTemplateEnabled:!!r(i)&&!!i.defaultPopupTemplateEnabled},t=s.fetchPopupFeatures(e,p);return{layerView:s,promise:t}}))}_isValidPopupGraphic(e,s){return e&&!!e.getEffectivePopupTemplate(r(s)&&s.defaultPopupTemplateEnabled)}async _prepareFetchPopupFeatures(e,r){const{clientGraphics:s,queryArea:i,location:a}=await this._popupHitTestGraphics(e,r),p=this._getFetchPopupLayerViews(),{layerViewsAndGraphics:t,clientOnlyGraphics:o}=this._graphicsPerFetchPopupLayerView(s,p);return{clientOnlyGraphics:o,layerViewsAndGraphics:t,queryArea:i,location:a}}async _popupHitTestGraphics(e,r){const{results:s,mapPoint:i}=await this.popupHitTest(e),a=s.filter((e=>this._isValidPopupGraphic(e.graphic,r))),p=a.length?a[0].mapPoint:null;return{clientGraphics:a.map((e=>e.graphic)),queryArea:i,location:i||p}}_getFetchPopupLayerViews(){const e=[];return this.allLayerViews.forEach((r=>{this._isValidPopupLayerView(r)&&e.push(r)})),r(this.graphicsView)&&this._isValidPopupLayerView(this.graphicsView)&&e.push(this.graphicsView),e.reverse()}_isValidPopupLayerView(e){return r(e)&&(!(\"layer\"in e)||!e.suspended)&&\"fetchPopupFeatures\"in e}_graphicsPerFetchPopupLayerView(e,r){const s=[],i=new Map,a=r.map((e=>{const r=[];return\"layer\"in e?i.set(e.layer,r):i.set(e.graphics,r),{layerView:e,graphics:r}}));for(const p of e){const e=i.get(p.layer)||i.get(p.sourceLayer)||null;e?e.push(p):s.push(p)}return{layerViewsAndGraphics:a,clientOnlyGraphics:s}}};return p=e([i(\"esri.views.PopupView\")],p),p};export{a as PopupView};\n"]},"metadata":{},"sourceType":"module"}