{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport { isSome as t } from \"./maybe.js\";\nimport e from \"./PooledArray.js\";\nconst s = -3;\nvar i;\n!function (t) {\n  t[t.ALL = 0] = \"ALL\", t[t.SOME = 1] = \"SOME\";\n}(i || (i = {}));\n\nclass r {\n  constructor(t, e, s) {\n    this._namespace = t, this._storage = e, this._removeFunc = !1, this._hit = 0, this._miss = 0, this._storage.register(this), this._namespace += \":\", s && (this._storage.registerRemoveFunc(this._namespace, s), this._removeFunc = !0);\n  }\n\n  destroy() {\n    this._storage.clear(this._namespace), this._removeFunc && this._storage.deregisterRemoveFunc(this._namespace), this._storage.deregister(this), this._storage = null;\n  }\n\n  get namespace() {\n    return this._namespace.slice(0, -1);\n  }\n\n  get hitRate() {\n    return this._hit / (this._hit + this._miss);\n  }\n\n  get size() {\n    return this._storage.size;\n  }\n\n  get maxSize() {\n    return this._storage.maxSize;\n  }\n\n  resetHitRate() {\n    this._hit = this._miss = 0;\n  }\n\n  put(t, e, s) {\n    let i = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0;\n\n    this._storage.put(this._namespace + t, e, s, i);\n  }\n\n  get(t) {\n    const e = this._storage.get(this._namespace + t);\n\n    return void 0 === e ? ++this._miss : ++this._hit, e;\n  }\n\n  pop(t) {\n    const e = this._storage.pop(this._namespace + t);\n\n    return void 0 === e ? ++this._miss : ++this._hit, e;\n  }\n\n  updateSize(t, e, s) {\n    this._storage.updateSize(this._namespace + t, e, s);\n  }\n\n  clear() {\n    this._storage.clear(this._namespace);\n  }\n\n  clearAll() {\n    this._storage.clearAll();\n  }\n\n  getStats() {\n    return this._storage.getStats();\n  }\n\n  resetStats() {\n    this._storage.resetStats();\n  }\n\n}\n\nclass h {\n  constructor() {\n    let t = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 10485760;\n    this._maxSize = t, this._db = new Map(), this._size = 0, this._hit = 0, this._miss = 0, this._removeFuncs = new e(), this._users = new e();\n  }\n\n  destroy() {\n    this.clearAll(), this._removeFuncs.clear(), this._users.clear(), this._db = null;\n  }\n\n  register(t) {\n    this._users.push(t);\n  }\n\n  deregister(t) {\n    this._users.removeUnordered(t);\n  }\n\n  registerRemoveFunc(t, e) {\n    this._removeFuncs.push([t, e]);\n  }\n\n  deregisterRemoveFunc(t) {\n    this._removeFuncs.filterInPlace(e => e[0] !== t);\n  }\n\n  get size() {\n    return this._size;\n  }\n\n  get maxSize() {\n    return this._maxSize;\n  }\n\n  set maxSize(t) {\n    this._maxSize = Math.max(t, 0), this._checkSizeLimit();\n  }\n\n  put(t, e, r, h) {\n    const _ = this._db.get(t);\n\n    if (_ && (this._size -= _.size, this._db.delete(t), _.entry !== e && this._notifyRemove(t, _.entry, i.ALL)), r > this._maxSize) return void this._notifyRemove(t, e, i.ALL);\n    if (void 0 === e) return void console.warn(\"Refusing to cache undefined entry \");\n    if (!r || r < 0) return void console.warn(\"Refusing to cache entry with invalid size \" + r);\n    const o = 1 + Math.max(h, s) - s;\n    this._db.set(t, {\n      entry: e,\n      size: r,\n      lifetime: o,\n      lives: o\n    }), this._size += r, this._checkSizeLimit();\n  }\n\n  updateSize(e, s, r) {\n    const h = this._db.get(e);\n\n    if (h && h.entry === s) {\n      for (this._size -= h.size; r > this._maxSize;) {\n        const h = this._notifyRemove(e, s, i.SOME);\n\n        if (!(t(h) && h > 0)) return void this._db.delete(e);\n        r = h;\n      }\n\n      h.size = r, this._size += r, this._checkSizeLimit();\n    }\n  }\n\n  pop(t) {\n    const e = this._db.get(t);\n\n    if (e) return this._size -= e.size, this._db.delete(t), ++this._hit, e.entry;\n    ++this._miss;\n  }\n\n  get(t) {\n    const e = this._db.get(t);\n\n    if (void 0 !== e) return this._db.delete(t), e.lives = e.lifetime, this._db.set(t, e), ++this._hit, e.entry;\n    ++this._miss;\n  }\n\n  getStats() {\n    const t = {\n      Size: Math.round(this._size / 1048576) + \"/\" + Math.round(this._maxSize / 1048576) + \"MB\",\n      \"Hit rate\": Math.round(100 * this._getHitRate()) + \"%\",\n      Entries: this._db.size.toString()\n    },\n          e = {},\n          i = new Array();\n\n    this._db.forEach((t, s) => {\n      const r = t.lifetime;\n      i[r] = (i[r] || 0) + t.size, this._users.forAll(i => {\n        const r = i.namespace;\n\n        if (s.startsWith(r)) {\n          const s = e[r] || 0;\n          e[r] = s + t.size;\n        }\n      });\n    });\n\n    const r = {};\n\n    this._users.forAll(t => {\n      const s = t.namespace;\n\n      if (!isNaN(t.hitRate) && t.hitRate > 0) {\n        const i = e[s] || 0;\n        e[s] = i, r[s] = Math.round(100 * t.hitRate) + \"%\";\n      } else r[s] = \"0%\";\n    });\n\n    const h = Object.keys(e);\n    h.sort((t, s) => e[s] - e[t]), h.forEach(s => t[s] = Math.round(e[s] / 2 ** 20) + \"MB / \" + r[s]);\n\n    for (let _ = i.length - 1; _ >= 0; --_) {\n      const e = i[_];\n      e && (t[\"Priority \" + (_ + s - 1)] = Math.round(e / this.size * 100) + \"%\");\n    }\n\n    return t;\n  }\n\n  resetStats() {\n    this._hit = this._miss = 0, this._users.forAll(t => t.resetHitRate());\n  }\n\n  clear(t) {\n    this._db.forEach((e, s) => {\n      s.startsWith(t) && (this._size -= e.size, this._db.delete(s), this._notifyRemove(s, e.entry, i.ALL));\n    });\n  }\n\n  clearAll() {\n    this._db.forEach((t, e) => this._notifyRemove(e, t.entry, i.ALL)), this._size = 0, this._db.clear();\n  }\n\n  _getHitRate() {\n    return this._hit / (this._hit + this._miss);\n  }\n\n  _notifyRemove(t, e, s) {\n    let i;\n    return this._removeFuncs.some(r => {\n      if (t.startsWith(r[0])) {\n        const t = r[1](e, s);\n        return \"number\" == typeof t && (i = t), !0;\n      }\n\n      return !1;\n    }), i;\n  }\n\n  _checkSizeLimit() {\n    if (!(this._size <= this._maxSize)) for (const [e, s] of this._db) {\n      if (this._db.delete(e), s.lives <= 1) {\n        this._size -= s.size;\n\n        const r = this._notifyRemove(e, s.entry, i.SOME);\n\n        t(r) && r > 0 && (this._size += r, s.lives = s.lifetime, s.size = r, this._db.set(e, s));\n      } else --s.lives, this._db.set(e, s);\n\n      if (this._size <= .9 * this.maxSize) return;\n    }\n  }\n\n}\n\nexport { s as MIN_PRIORITY, r as MemCache, h as MemCacheStorage, i as RemoveMode };","map":{"version":3,"sources":["D:/Github/CUSP_DataBase/CUSP_DB/src/main/gis/node_modules/@arcgis/core/core/MemCache.js"],"names":["isSome","t","e","s","i","ALL","SOME","r","constructor","_namespace","_storage","_removeFunc","_hit","_miss","register","registerRemoveFunc","destroy","clear","deregisterRemoveFunc","deregister","namespace","slice","hitRate","size","maxSize","resetHitRate","put","get","pop","updateSize","clearAll","getStats","resetStats","h","_maxSize","_db","Map","_size","_removeFuncs","_users","push","removeUnordered","filterInPlace","Math","max","_checkSizeLimit","_","delete","entry","_notifyRemove","console","warn","o","set","lifetime","lives","Size","round","_getHitRate","Entries","toString","Array","forEach","forAll","startsWith","isNaN","Object","keys","sort","length","some","MIN_PRIORITY","MemCache","MemCacheStorage","RemoveMode"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport{isSome as t}from\"./maybe.js\";import e from\"./PooledArray.js\";const s=-3;var i;!function(t){t[t.ALL=0]=\"ALL\",t[t.SOME=1]=\"SOME\"}(i||(i={}));class r{constructor(t,e,s){this._namespace=t,this._storage=e,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),this._namespace+=\":\",s&&(this._storage.registerRemoveFunc(this._namespace,s),this._removeFunc=!0)}destroy(){this._storage.clear(this._namespace),this._removeFunc&&this._storage.deregisterRemoveFunc(this._namespace),this._storage.deregister(this),this._storage=null}get namespace(){return this._namespace.slice(0,-1)}get hitRate(){return this._hit/(this._hit+this._miss)}get size(){return this._storage.size}get maxSize(){return this._storage.maxSize}resetHitRate(){this._hit=this._miss=0}put(t,e,s,i=0){this._storage.put(this._namespace+t,e,s,i)}get(t){const e=this._storage.get(this._namespace+t);return void 0===e?++this._miss:++this._hit,e}pop(t){const e=this._storage.pop(this._namespace+t);return void 0===e?++this._miss:++this._hit,e}updateSize(t,e,s){this._storage.updateSize(this._namespace+t,e,s)}clear(){this._storage.clear(this._namespace)}clearAll(){this._storage.clearAll()}getStats(){return this._storage.getStats()}resetStats(){this._storage.resetStats()}}class h{constructor(t=10485760){this._maxSize=t,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new e,this._users=new e}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear(),this._db=null}register(t){this._users.push(t)}deregister(t){this._users.removeUnordered(t)}registerRemoveFunc(t,e){this._removeFuncs.push([t,e])}deregisterRemoveFunc(t){this._removeFuncs.filterInPlace((e=>e[0]!==t))}get size(){return this._size}get maxSize(){return this._maxSize}set maxSize(t){this._maxSize=Math.max(t,0),this._checkSizeLimit()}put(t,e,r,h){const _=this._db.get(t);if(_&&(this._size-=_.size,this._db.delete(t),_.entry!==e&&this._notifyRemove(t,_.entry,i.ALL)),r>this._maxSize)return void this._notifyRemove(t,e,i.ALL);if(void 0===e)return void console.warn(\"Refusing to cache undefined entry \");if(!r||r<0)return void console.warn(\"Refusing to cache entry with invalid size \"+r);const o=1+Math.max(h,s)-s;this._db.set(t,{entry:e,size:r,lifetime:o,lives:o}),this._size+=r,this._checkSizeLimit()}updateSize(e,s,r){const h=this._db.get(e);if(h&&h.entry===s){for(this._size-=h.size;r>this._maxSize;){const h=this._notifyRemove(e,s,i.SOME);if(!(t(h)&&h>0))return void this._db.delete(e);r=h}h.size=r,this._size+=r,this._checkSizeLimit()}}pop(t){const e=this._db.get(t);if(e)return this._size-=e.size,this._db.delete(t),++this._hit,e.entry;++this._miss}get(t){const e=this._db.get(t);if(void 0!==e)return this._db.delete(t),e.lives=e.lifetime,this._db.set(t,e),++this._hit,e.entry;++this._miss}getStats(){const t={Size:Math.round(this._size/1048576)+\"/\"+Math.round(this._maxSize/1048576)+\"MB\",\"Hit rate\":Math.round(100*this._getHitRate())+\"%\",Entries:this._db.size.toString()},e={},i=new Array;this._db.forEach(((t,s)=>{const r=t.lifetime;i[r]=(i[r]||0)+t.size,this._users.forAll((i=>{const r=i.namespace;if(s.startsWith(r)){const s=e[r]||0;e[r]=s+t.size}}))}));const r={};this._users.forAll((t=>{const s=t.namespace;if(!isNaN(t.hitRate)&&t.hitRate>0){const i=e[s]||0;e[s]=i,r[s]=Math.round(100*t.hitRate)+\"%\"}else r[s]=\"0%\"}));const h=Object.keys(e);h.sort(((t,s)=>e[s]-e[t])),h.forEach((s=>t[s]=Math.round(e[s]/2**20)+\"MB / \"+r[s]));for(let _=i.length-1;_>=0;--_){const e=i[_];e&&(t[\"Priority \"+(_+s-1)]=Math.round(e/this.size*100)+\"%\")}return t}resetStats(){this._hit=this._miss=0,this._users.forAll((t=>t.resetHitRate()))}clear(t){this._db.forEach(((e,s)=>{s.startsWith(t)&&(this._size-=e.size,this._db.delete(s),this._notifyRemove(s,e.entry,i.ALL))}))}clearAll(){this._db.forEach(((t,e)=>this._notifyRemove(e,t.entry,i.ALL))),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(t,e,s){let i;return this._removeFuncs.some((r=>{if(t.startsWith(r[0])){const t=r[1](e,s);return\"number\"==typeof t&&(i=t),!0}return!1})),i}_checkSizeLimit(){if(!(this._size<=this._maxSize))for(const[e,s]of this._db){if(this._db.delete(e),s.lives<=1){this._size-=s.size;const r=this._notifyRemove(e,s.entry,i.SOME);t(r)&&r>0&&(this._size+=r,s.lives=s.lifetime,s.size=r,this._db.set(e,s))}else--s.lives,this._db.set(e,s);if(this._size<=.9*this.maxSize)return}}}export{s as MIN_PRIORITY,r as MemCache,h as MemCacheStorage,i as RemoveMode};\n"]},"metadata":{},"sourceType":"module"}