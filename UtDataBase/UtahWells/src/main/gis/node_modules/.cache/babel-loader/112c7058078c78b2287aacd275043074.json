{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../../../chunks/tslib.es6.js\";\nimport t from \"../../../../core/Accessor.js\";\nimport { bidiText as s } from \"../../../../core/BidiText.js\";\nimport { HandleOwnerMixin as i } from \"../../../../core/HandleOwner.js\";\nimport r from \"../../../../core/has.js\";\nimport { isSome as o, isNone as a } from \"../../../../core/maybe.js\";\nimport { throwIfAborted as h, isAbortError as n, throwIfAbortError as l } from \"../../../../core/promiseUtils.js\";\nimport { property as d } from \"../../../../core/accessorSupport/decorators/property.js\";\nimport \"../../../../core/arrayUtils.js\";\nimport \"../../../../core/accessorSupport/ensureType.js\";\nimport { subclass as p } from \"../../../../core/accessorSupport/decorators/subclass.js\";\nimport c from \"../../../../geometry/SpatialReference.js\";\nimport { width as g, height as u, create as m } from \"../../../../geometry/support/aaBoundingRect.js\";\nimport { closeRingsAndFixWinding as _ } from \"../../../../geometry/support/coordsUtils.js\";\nimport { getJsonType as f, isPolygon as y, isPolyline as S, isExtent as b, isPoint as w, isMultipoint as T } from \"../../../../geometry/support/jsonUtils.js\";\nimport { normalizeCentralMeridianSync as v } from \"../../../../geometry/support/normalizeUtilsSync.js\";\nimport { getInfo as I } from \"../../../../geometry/support/spatialReferenceUtils.js\";\nimport { checkProjectionSupport as G, project as U } from \"../../../../layers/graphics/data/projectionSupport.js\";\nimport { symbolToCIM as M } from \"../../../../symbols/cim/CIMSymbolHelper.js\";\nimport { errorPolylineSymbol2D as C, errorPolygonSymbol2D as j, errorPointSymbol2D as P } from \"../../../../symbols/support/defaults.js\";\nimport { FILTER_FLAG_0 as x } from \"../../engine/webgl/definitions.js\";\nimport { GraphicTile as A } from \"../../engine/webgl/GraphicTile.js\";\nimport { TileData as R } from \"../../engine/webgl/TileData.js\";\nimport q from \"../../engine/webgl/WGLDisplayObject.js\";\nimport { MeshData as D } from \"../../engine/webgl/mesh/MeshData.js\";\nimport { WGLMeshFactory as O } from \"../../engine/webgl/mesh/factories/WGLMeshFactory.js\";\nimport { WGLTemplateStore as z } from \"../../engine/webgl/mesh/templates/WGLTemplateStore.js\";\nimport { createMatcher as F } from \"../../engine/webgl/util/Matcher.js\";\nimport { createMatcherSchema as H, createSymbolSchemaOptions as k } from \"../features/schemaUtils.js\";\nimport E from \"../features/support/AttributeStore.js\";\nimport { ComputedAttributeStorage as N } from \"../features/support/ComputedAttributeStorage.js\";\nimport { GraphicsReader as V } from \"../features/support/GraphicsReader.js\";\nimport B from \"./GraphicStore.js\";\nimport { intersectingInternationalDateline as L, isMarkerSymbol as W, isTextSymbol as J, polygonFromExtent as Z, TILE_SIZE as K, PIXEL_BUFFER as Q } from \"./graphicsUtils.js\";\nimport { expandSymbol as X } from \"../support/cimSymbolUtils.js\";\nimport { GraphicsView as Y } from \"../../../layers/GraphicsView.js\";\nimport { getWebGL1Capabilities as $ } from \"../../../webgl/capabilities.js\";\nimport { createSymbolSchema as ee } from \"../features/createSymbolSchema.js\";\nconst te = r(\"esri-2d-graphic-debug\");\n\nfunction se(e, t, s) {\n  if (s.has(e)) return s.get(e);\n  const i = {\n    tile: t,\n    addedOrModified: [],\n    removed: []\n  };\n  return s.set(e, i), i;\n}\n\nlet ie = class extends Y(i(t)) {\n  constructor(e) {\n    super(e), this._storage = new N(), this._displayIds = new Map(), this._controller = new AbortController(), this._tiles = new Map(), this._graphicStoreUpdate = !1, this._graphicsSet = new Set(), this._matcher = Promise.resolve(null), this._tileUpdateSet = new Set(), this._tilesToUpdate = new Map(), this._graphicIdToAbortController = new Map(), this._attached = !1, this._updatingGraphicsTimer = null, this._hashToExpandedSymbol = new Map(), this._hashToExpandedSymbolPromise = new Map(), this._hashToCIMSymbolPromise = new Map(), this._hashToCIM = new Map(), this._processing = !1, this._needsProcessing = !1, this._pendingUpdate = {\n      added: new Set(),\n      updated: new Set(),\n      removed: new Set()\n    }, this.lastUpdateId = -1, this.updateRequested = !1, this.graphicUpdateHandler = this.graphicUpdateHandler.bind(this);\n  }\n\n  destroy() {\n    this._updatingGraphicsTimer && (clearTimeout(this._updatingGraphicsTimer), this._updatingGraphicsTimer = null, this.notifyChange(\"updating\")), this._controller.abort(), this.container.destroy(), this._set(\"graphics\", null), this._graphicStore.clear(), this._attributeStore = null, this._hashToExpandedSymbol.clear(), this.view = null, this.renderer = null, this._hashToCIM.clear(), this._hashToCIMSymbolPromise.clear(), this._hashToExpandedSymbolPromise.clear();\n  }\n\n  _createMatcher(e, t, s) {\n    if (e) {\n      const i = H({\n        indexCount: 0,\n        fields: {}\n      }, \"feature\", e);\n      this._matcher = F(i, t, null, s);\n    }\n  }\n\n  _createDisplayId(e) {\n    return this._displayIds.has(e) || this._displayIds.set(e, this._storage.createDisplayId()), this._displayIds.get(e);\n  }\n\n  initialize() {\n    this._attributeStore = new E({\n      type: \"local\",\n      initialize: e => Promise.resolve(this.container.attributeView.initialize(e)),\n      update: e => this.container.attributeView.requestUpdate(e),\n      render: () => this.container.requestRender()\n    }, $()), this.container.hasHighlight = () => this._attributeStore.hasHighlight;\n\n    const e = e => {\n      this._createDisplayId(e.uid), this._setFilterState(e.uid, e.visible);\n    },\n          t = e => {\n      const t = this._displayIds.get(e.uid);\n\n      this._displayIds.delete(e.uid), this._storage.releaseDisplayId(t);\n    },\n          s = new z(this.container.getMaterialItems.bind(this.container), this.view.featuresTilingScheme.tileInfo);\n\n    this._graphicStore = new B(this.view.featuresTilingScheme, this.view.state.scale, this.uid, this.graphics, e, t, this._hashToCIM), this._meshFactory = new O(null, this.uid, s), this._templateStore = s, this.handles.add([this.watch(\"renderer\", e => {\n      this._createMatcher(e, s, this.container.stage.resourceManager);\n\n      for (const t of this.graphics) this._pendingUpdate.updated.add(t);\n\n      this.requestUpdate();\n    }), this.view.graphicsTileStore.on(\"update\", e => this._onTileUpdate(e)), this.container.on(\"attach\", () => {\n      te && this.container.enableRenderingBounds(() => this._graphicStore.getAllBounds()), this.graphics.items.length > 0 && this._graphicsChangeHandler({\n        target: this.graphics,\n        added: this.graphics.items,\n        removed: [],\n        moved: []\n      }), this.handles.add(this.graphics.on(\"change\", e => this._graphicsChangeHandler(e)), \"graphics\");\n      const e = this.container.stage.resourceManager;\n      this._createMatcher(this.renderer, s, e), this._graphicStore.setResourceManager(e), this._attached = !0, this.notifyChange(\"updating\");\n    })]);\n    const i = this.view.graphicsTileStore.tiles;\n\n    this._onTileUpdate({\n      added: i,\n      removed: []\n    });\n  }\n\n  get updating() {\n    return !this._attached || null !== this._updatingGraphicsTimer || this._tileUpdateSet.size > 0 || this._tilesToUpdate.size > 0;\n  }\n\n  hitTest(e) {\n    if (!this.view || !this.view.position) return null;\n    const {\n      resolution: t,\n      rotation: s\n    } = this.view.state;\n    return this._graphicStore.hitTest(e.x, e.y, 2, t, s);\n  }\n\n  update(e) {\n    h(this._controller.signal);\n    const t = e.state,\n          {\n      resolution: s\n    } = t;\n\n    if (this._graphicStore.updateLevel(s), this._graphicStoreUpdate = !0, this.updateRequested = !1, this._pendingUpdate.updated.size > 0) {\n      if (!this._processing) return void this._updateGraphics();\n      this._needsProcessing = !0;\n    }\n  }\n\n  viewChange() {\n    this.requestUpdate();\n  }\n\n  requestUpdate() {\n    this.updateRequested || (this.updateRequested = !0, this.requestUpdateCallback());\n  }\n\n  processUpdate(e) {\n    this.updateRequested && (this.updateRequested = !1, this.update(e));\n  }\n\n  graphicUpdateHandler(e) {\n    const {\n      graphic: t,\n      property: s,\n      newValue: i\n    } = e;\n\n    switch (s) {\n      case \"attributes\":\n      case \"geometry\":\n      case \"symbol\":\n        this._pendingUpdate.updated.add(t), this.requestUpdate();\n        break;\n\n      case \"visible\":\n        this._setFilterState(t.uid, i), this._attributeStore.sendUpdates();\n    }\n  }\n\n  setHighlight(e) {\n    const t = e.map(e => this._displayIds.get(e));\n\n    this._attributeStore.setHighlight(e, t);\n  }\n\n  _getIntersectingTiles(e) {\n    const t = this._graphicStore.getBounds(e);\n\n    if (!t || 0 === g(t) || 0 === u(t)) return [];\n    const s = L(t, this.view.spatialReference);\n    return o(s) ? [...new Set([...this.view.graphicsTileStore.boundsIntersections(s[0]), ...this.view.graphicsTileStore.boundsIntersections(s[1])])] : this.view.graphicsTileStore.boundsIntersections(t);\n  }\n\n  async _updateTile(e) {\n    h(this._controller.signal);\n\n    const t = e.tile,\n          s = this._getGraphicsData(this._templateStore, t, e.addedOrModified),\n          i = await this._processGraphics(t, s);\n\n    return h(this._controller.signal), this._patchTile(t.key, {\n      type: \"update\",\n      addOrUpdate: i,\n      remove: e.removed,\n      end: !0,\n      clear: !1,\n      sort: !1\n    }), i;\n  }\n\n  _patchTile(e, t) {\n    if (!this._tiles.has(e)) return;\n\n    const s = this._tiles.get(e);\n\n    this.container.onTileData(s, t), this.container.requestRender();\n  }\n\n  _graphicsChangeHandler(e) {\n    const t = this._pendingUpdate;\n\n    for (const s of e.added) t.added.add(s);\n\n    for (const s of e.moved) t.updated.add(s);\n\n    for (const s of e.removed) this._pendingUpdate.added.has(s) ? t.added.delete(s) : t.removed.add(s);\n\n    this._processing ? this._needsProcessing = !0 : this._updateGraphics();\n  }\n\n  _getGraphicsToUpdate() {\n    const e = {\n      added: [],\n      removed: [],\n      updated: []\n    };\n    if (!this.graphics) return e;\n    const t = this._pendingUpdate;\n\n    for (const s of this.graphics.items) t.added.has(s) ? e.added.push(s) : t.updated.has(s) && e.updated.push(s);\n\n    for (const s of t.removed) this._graphicStore.has(s) && e.removed.push(s);\n\n    return t.added.clear(), t.removed.clear(), t.updated.clear(), e;\n  }\n\n  async _updateGraphics() {\n    this._processing = !0;\n\n    const {\n      added: e,\n      removed: t,\n      updated: s\n    } = this._getGraphicsToUpdate(),\n          i = this._tilesToUpdate;\n\n    let r;\n\n    try {\n      if (!this._graphicStoreUpdate) {\n        const e = this.view.state,\n              {\n          resolution: t\n        } = e;\n\n        this._graphicStore.updateLevel(t);\n      }\n\n      const o = [],\n            a = new Array(e.length + t.length);\n\n      for (let e = 0; e < s.length; e++) {\n        const t = s[e],\n              h = this._getIntersectingTiles(t);\n\n        for (const e of h) {\n          r = e.id;\n          se(r, e, i).removed.push(this._displayIds.get(t.uid));\n        }\n\n        o.push(this._updateGraphic(t, null)), a[e] = t;\n      }\n\n      const h = s.length;\n\n      for (let t = 0; t < e.length; t++) {\n        const s = e[t];\n        a[h + t] = s, this._graphicsSet.add(s), o.push(this._addGraphic(s));\n      }\n\n      for (const e of t) {\n        this._abortProcessingGraphic(e.uid);\n\n        const t = this._getIntersectingTiles(e);\n\n        for (const s of t) {\n          r = s.id;\n          se(r, s, i).removed.push(this._displayIds.get(e.uid));\n        }\n\n        this._graphicsSet.delete(e), this._graphicStore.remove(e);\n      }\n\n      let n;\n      this._flipUpdatingGraphics(), await Promise.all(o);\n\n      for (let e = 0; e < a.length; e++) {\n        n = a[e];\n\n        const t = this._getIntersectingTiles(n);\n\n        for (const e of t) {\n          r = e.id;\n          se(r, e, i).addedOrModified.push(n);\n        }\n      }\n\n      this._graphicStore.updateZ();\n\n      const l = [];\n\n      for (const [e, t] of i) l.push(this._updateTile(t));\n\n      await Promise.all(l);\n    } catch (o) {\n      n(o), 0;\n    }\n\n    for (const a of t) try {\n      const e = await this._getSymbolForGraphic(a, {});\n\n      if (e) {\n        const t = e.hash();\n\n        this._hashToExpandedSymbol.delete(t);\n      }\n    } catch (o) {\n      n(o), 0;\n    }\n\n    i.clear(), this.notifyChange(\"updating\"), this._processing = !1, this._needsProcessing && (this._needsProcessing = !1, this._updateGraphics());\n  }\n\n  _getArcadeInfo(e) {\n    const t = (e.attributes ? Object.keys(e.attributes) : []).map(t => ({\n      name: t,\n      alias: t,\n      type: \"string\" == typeof e.attributes[t] ? \"esriFieldTypeString\" : \"esriFieldTypeDouble\"\n    }));\n    return a(e.geometry) ? null : {\n      geometryType: f(e.geometry),\n      spatialReference: c.fromJSON(e.geometry.spatialReference),\n      fields: t\n    };\n  }\n\n  _getSymbolForGraphic(e, t) {\n    return h(this._controller.signal), o(e.symbol) ? Promise.resolve(e.symbol) : o(this.renderer) ? this.renderer.getSymbolAsync(e, {\n      scale: this.view.scale,\n      abortOptions: t\n    }) : Promise.resolve(this._getNullSymbol(e));\n  }\n\n  _getCIMSymbol(e, t, s) {\n    let i = this._hashToCIM.get(t);\n\n    if (i) return Promise.resolve(i);\n    const r = M(e);\n\n    if (o(r)) {\n      if (\"CIMSymbolReference\" === r.type) return i = r, this._hashToCIM.set(t, i), Promise.resolve(i);\n\n      let e = this._hashToCIMSymbolPromise.get(t);\n\n      return e || (e = r.fetchCIMSymbol(s).then(e => (this._hashToCIM.set(t, e.data), this._hashToCIMSymbolPromise.delete(t), e)).catch(e => (this._hashToCIMSymbolPromise.delete(t), l(e), null)), this._hashToCIMSymbolPromise.set(t, e), e);\n    }\n\n    return Promise.resolve(null);\n  }\n\n  _expandCIMSymbol(e, t, s, i) {\n    const r = this._hashToExpandedSymbol.get(s);\n\n    if (r) return Promise.resolve(r);\n\n    let o = this._hashToExpandedSymbolPromise.get(s);\n\n    if (o) return o;\n\n    const a = this.container.stage,\n          h = this._getArcadeInfo(t),\n          n = k(null),\n          l = ee(e, n);\n\n    return o = X(l, h, a.resourceManager, i), this._hashToExpandedSymbolPromise.set(s, o), o.then(e => (this._hashToExpandedSymbol.set(s, e), this._hashToExpandedSymbolPromise.delete(s), e)), o;\n  }\n\n  async _getSymbolResources(e, t) {\n    h(this._controller.signal);\n    return this.container.stage ? this._getSymbolForGraphic(e, t).then(i => {\n      const r = i.hash();\n      return this._getCIMSymbol(i, r, t).then(i => a(i) ? null : this._expandCIMSymbol(i, e, r, t).then(e => {\n        const t = e.layers.filter(e => \"text\" === e.type && \"string\" == typeof e.text);\n\n        if (t && t.length > 0) {\n          const i = new Array(t.length);\n\n          for (let e = 0; e < t.length; e++) {\n            const r = t[e],\n                  o = [],\n                  [a] = s(r.text);\n\n            for (let e = 0; e < a.length; e++) o.push(a.charCodeAt(e));\n\n            i[e] = {\n              symbol: r,\n              id: e,\n              glyphIds: o\n            };\n          }\n\n          const o = new Map();\n          return this.container.getMaterialItems(i).then(s => {\n            for (let e = 0; e < t.length; e++) {\n              const i = t[e];\n              o.set(i.cim, {\n                text: i.text,\n                mosaicItem: s[e].mosaicItem\n              });\n            }\n\n            return {\n              symbol: e,\n              textInfo: o,\n              hash: r\n            };\n          });\n        }\n\n        return {\n          symbol: e,\n          hash: r\n        };\n      }));\n    }).catch(e => (l(e), null)) : null;\n  }\n\n  async _projectAndNormalizeGeometry(e, t) {\n    if (h(this._controller.signal), a(e.geometry) || \"mesh\" === e.geometry.type) return null;\n    let s = e.geometry;\n\n    if (y(s)) {\n      const e = s.rings;\n      s.rings = e;\n    } else if (S(s)) {\n      const e = s.paths;\n      s.paths = e;\n    } else if (b(s)) {\n      const i = await this._getSymbolForGraphic(e, t);\n\n      if (h(this._controller.signal), W(i.type) || J(i.type)) {\n        s = s.center;\n      } else s = Z(s);\n    }\n\n    await G(s.spatialReference, this.view.spatialReference);\n    const i = v(s),\n          r = U(i, s.spatialReference, this.view.spatialReference);\n    return _(r), r;\n  }\n\n  _onTileUpdate(e) {\n    const t = I(this.view.spatialReference);\n    if (e.added && e.added.length > 0) for (const s of e.added) this._addNewTile(s, t);\n    if (e.removed && e.removed.length > 0) for (const s of e.removed) this._removeTile(s.key);\n  }\n\n  async _addGraphic(e) {\n    this._abortProcessingGraphic(e.uid), h(this._controller.signal);\n    const t = new AbortController();\n\n    this._graphicIdToAbortController.set(e.uid, t);\n\n    const s = {\n      signal: t.signal\n    };\n\n    try {\n      await this._addOrUpdateGraphic(e, s), h(this._controller.signal), this._graphicIdToAbortController.delete(e.uid);\n    } catch (i) {\n      if (this._graphicIdToAbortController.delete(e.uid), !n(i)) throw i;\n    }\n  }\n\n  _updateGraphic(e, t) {\n    h(this._controller.signal);\n\n    const s = this._projectAndNormalizeGeometry(e, t),\n          i = this._getSymbolResources(e, t);\n\n    return Promise.all([s, i]).then(_ref => {\n      let [t, s] = _ref;\n      h(this._controller.signal), this._graphicStore.addOrModify(e, s, t);\n    });\n  }\n\n  _addOrUpdateGraphic(e, t) {\n    h(this._controller.signal);\n\n    const s = this._projectAndNormalizeGeometry(e, t),\n          i = this._getSymbolResources(e, t);\n\n    return Promise.all([s, i]).then(_ref2 => {\n      let [t, s] = _ref2;\n      h(this._controller.signal), this._graphicsSet.has(e) && this._graphicStore.addOrModify(e, s, t);\n    });\n  }\n\n  _addTile(e) {\n    const t = this.view.featuresTilingScheme.getTileBounds(m(), e),\n          s = new A(e, t[0], t[3]);\n    return this._tiles.set(e, s), this.container.addChild(s), s;\n  }\n\n  async _addNewTile(e, t) {\n    const s = this._addTile(e.key),\n          i = this._graphicStore.queryTileData(this._templateStore, e);\n\n    if (0 === i.length) return;\n\n    if (t) {\n      const s = Math.round((t.valid[1] - t.valid[0]) / e.resolution);\n\n      for (const e of i) e.geometry && (w(e.geometry) || T(e.geometry)) && this._wrapPoints(e, s);\n    }\n\n    const r = e.key;\n    this._tileUpdateSet.add(e.key), this.notifyChange(\"updating\");\n\n    try {\n      const t = {\n        type: \"update\",\n        clear: !1,\n        addOrUpdate: await this._processGraphics(e, i),\n        remove: [],\n        end: !0,\n        sort: !1\n      };\n      s.patch(t), this._tileUpdateSet.delete(r), this.notifyChange(\"updating\");\n    } catch (o) {\n      if (this._tileUpdateSet.delete(r), this.notifyChange(\"updating\"), !n(o)) throw o;\n    }\n  }\n\n  _removeTile(e) {\n    if (!this._tiles.has(e)) return;\n\n    const t = this._tiles.get(e);\n\n    this.container.removeChild(t), t.destroy(), this._tiles.delete(e);\n  }\n\n  _setFilterState(e, t) {\n    const s = this._displayIds.get(e),\n          i = this._attributeStore.getHighlightFlag(e);\n\n    this._attributeStore.setData(s, 0, 0, i | (t ? x : 0));\n  }\n\n  _getGraphicsData(e, t, s) {\n    const i = this.view,\n          r = I(i.spatialReference),\n          o = this._graphicStore.getGraphicsData(e, t, s);\n\n    if (r) {\n      const e = Math.round((r.valid[1] - r.valid[0]) / t.resolution);\n\n      for (const t of o) t.geometry && (w(t.geometry) || T(t.geometry)) && this._wrapPoints(t, e);\n    }\n\n    return o;\n  }\n\n  _wrapPoints(e, t) {\n    const s = e.geometry;\n    T(s) ? this._wrapMultipoint(s, t) : this._wrapPoint(e, t);\n  }\n\n  _wrapMultipoint(e, t) {\n    const s = e.points,\n          i = [];\n    let r = 0,\n        o = 0;\n\n    for (const [a, h] of s) {\n      if (i.push([a + r, h]), r = 0, t === K) {\n        const e = 5 * Q;\n        a + o < e ? (i.push([t, 0]), r = -t) : a + o > K - e && (i.push([-t, 0]), r = t);\n      } else a + o < -Q ? (i.push([t, 0]), r = -t) : a + o > K + Q && (i.push([-t, 0]), r = t);\n\n      o += a;\n    }\n\n    e.points = i;\n  }\n\n  _wrapPoint(e, t) {\n    const s = e.geometry;\n\n    if (t === K) {\n      const i = 5 * Q;\n      s.x < i ? e.geometry = {\n        points: [[s.x, s.y], [t, 0]]\n      } : s.x > K - i && (e.geometry = {\n        points: [[s.x, s.y], [-t, 0]]\n      });\n    } else s.x < -Q ? e.geometry = {\n      points: [[s.x, s.y], [t, 0]]\n    } : s.x > K + Q && (e.geometry = {\n      points: [[s.x, s.y], [-t, 0]]\n    });\n  }\n\n  _processGraphics(e, t, s) {\n    if (!(t && t.length) || !this._meshFactory) return null;\n    const i = V.from(t),\n          r = this._meshFactory;\n    return this._matcher.then(t => r.analyzeGraphics(i, this.container.stage.resourceManager, t, null, null, s).then(() => (this._attributeStore.sendUpdates(), this._processAnalyzedGraphics(e, i))));\n  }\n\n  _processAnalyzedGraphics(e, t) {\n    const s = this._meshFactory,\n          i = t.getSize(),\n          r = t.getCursor(),\n          o = {\n      features: i,\n      records: i,\n      metrics: 0\n    },\n          a = new D(e.key.id, o, {\n      fill: \"default\"\n    }, !1, !1),\n          h = [];\n\n    for (; r.next();) {\n      const t = r.readGraphic();\n      t.insertAfter = -1 === t.insertAfter ? -1 : this._displayIds.get(t.insertAfter), t.displayId = this._displayIds.get(t.attributes[this.uid]);\n      const i = new q(t.displayId);\n      i.insertAfter = t.insertAfter, h.push(i), s.writeGraphic(a, r, e.level, this.container.stage.resourceManager);\n    }\n\n    const n = e.tileInfoView.tileInfo.isWrappable,\n          l = a.serialize(n);\n    if (1 !== l.length) return new R();\n    const d = l[0].message;\n    return R.fromVertexData(d, h);\n  }\n\n  _abortProcessingGraphic(e) {\n    if (this._graphicIdToAbortController.has(e)) {\n      this._graphicIdToAbortController.get(e).abort();\n    }\n  }\n\n  _getNullSymbol(e) {\n    const t = e.geometry;\n    return S(t) ? C : y(t) || b(t) ? j : P;\n  }\n\n  _flipUpdatingGraphics() {\n    this._updatingGraphicsTimer && clearTimeout(this._updatingGraphicsTimer), this._updatingGraphicsTimer = setTimeout(() => {\n      this._updatingGraphicsTimer = null, this.notifyChange(\"updating\");\n    }, 160), this.notifyChange(\"updating\");\n  }\n\n};\ne([d({\n  constructOnly: !0\n})], ie.prototype, \"requestUpdateCallback\", void 0), e([d()], ie.prototype, \"container\", void 0), e([d({\n  constructOnly: !0\n})], ie.prototype, \"graphics\", void 0), e([d()], ie.prototype, \"updating\", null), e([d()], ie.prototype, \"view\", void 0), e([d()], ie.prototype, \"updateRequested\", void 0), ie = e([p(\"esri.views.2d.layers.support.GraphicsView2D\")], ie);\nconst re = ie;\nexport { re as default };","map":{"version":3,"sources":["D:/Github/CUSP_DataBase/CUSP_DB/src/main/gis/node_modules/@arcgis/core/views/2d/layers/graphics/GraphicsView2D.js"],"names":["_","e","t","bidiText","s","HandleOwnerMixin","i","r","isSome","o","isNone","a","throwIfAborted","h","isAbortError","n","throwIfAbortError","l","property","d","subclass","p","c","width","g","height","u","create","m","closeRingsAndFixWinding","getJsonType","f","isPolygon","y","isPolyline","S","isExtent","b","isPoint","w","isMultipoint","T","normalizeCentralMeridianSync","v","getInfo","I","checkProjectionSupport","G","project","U","symbolToCIM","M","errorPolylineSymbol2D","C","errorPolygonSymbol2D","j","errorPointSymbol2D","P","FILTER_FLAG_0","x","GraphicTile","A","TileData","R","q","MeshData","D","WGLMeshFactory","O","WGLTemplateStore","z","createMatcher","F","createMatcherSchema","H","createSymbolSchemaOptions","k","E","ComputedAttributeStorage","N","GraphicsReader","V","B","intersectingInternationalDateline","L","isMarkerSymbol","W","isTextSymbol","J","polygonFromExtent","Z","TILE_SIZE","K","PIXEL_BUFFER","Q","expandSymbol","X","GraphicsView","Y","getWebGL1Capabilities","$","createSymbolSchema","ee","te","se","has","get","tile","addedOrModified","removed","set","ie","constructor","_storage","_displayIds","Map","_controller","AbortController","_tiles","_graphicStoreUpdate","_graphicsSet","Set","_matcher","Promise","resolve","_tileUpdateSet","_tilesToUpdate","_graphicIdToAbortController","_attached","_updatingGraphicsTimer","_hashToExpandedSymbol","_hashToExpandedSymbolPromise","_hashToCIMSymbolPromise","_hashToCIM","_processing","_needsProcessing","_pendingUpdate","added","updated","lastUpdateId","updateRequested","graphicUpdateHandler","bind","destroy","clearTimeout","notifyChange","abort","container","_set","_graphicStore","clear","_attributeStore","view","renderer","_createMatcher","indexCount","fields","_createDisplayId","createDisplayId","initialize","type","attributeView","update","requestUpdate","render","requestRender","hasHighlight","uid","_setFilterState","visible","delete","releaseDisplayId","getMaterialItems","featuresTilingScheme","tileInfo","state","scale","graphics","_meshFactory","_templateStore","handles","add","watch","stage","resourceManager","graphicsTileStore","on","_onTileUpdate","enableRenderingBounds","getAllBounds","items","length","_graphicsChangeHandler","target","moved","setResourceManager","tiles","updating","size","hitTest","position","resolution","rotation","signal","updateLevel","_updateGraphics","viewChange","requestUpdateCallback","processUpdate","graphic","newValue","sendUpdates","setHighlight","map","_getIntersectingTiles","getBounds","spatialReference","boundsIntersections","_updateTile","_getGraphicsData","_processGraphics","_patchTile","key","addOrUpdate","remove","end","sort","onTileData","_getGraphicsToUpdate","push","Array","id","_updateGraphic","_addGraphic","_abortProcessingGraphic","_flipUpdatingGraphics","all","updateZ","_getSymbolForGraphic","hash","_getArcadeInfo","attributes","Object","keys","name","alias","geometry","geometryType","fromJSON","symbol","getSymbolAsync","abortOptions","_getNullSymbol","_getCIMSymbol","fetchCIMSymbol","then","data","catch","_expandCIMSymbol","_getSymbolResources","layers","filter","text","charCodeAt","glyphIds","cim","mosaicItem","textInfo","_projectAndNormalizeGeometry","rings","paths","center","_addNewTile","_removeTile","_addOrUpdateGraphic","addOrModify","_addTile","getTileBounds","addChild","queryTileData","Math","round","valid","_wrapPoints","patch","removeChild","getHighlightFlag","setData","getGraphicsData","_wrapMultipoint","_wrapPoint","points","from","analyzeGraphics","_processAnalyzedGraphics","getSize","getCursor","features","records","metrics","fill","next","readGraphic","insertAfter","displayId","writeGraphic","level","tileInfoView","isWrappable","serialize","message","fromVertexData","setTimeout","constructOnly","prototype","re","default"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import t from\"../../../../core/Accessor.js\";import{bidiText as s}from\"../../../../core/BidiText.js\";import{HandleOwnerMixin as i}from\"../../../../core/HandleOwner.js\";import r from\"../../../../core/has.js\";import{isSome as o,isNone as a}from\"../../../../core/maybe.js\";import{throwIfAborted as h,isAbortError as n,throwIfAbortError as l}from\"../../../../core/promiseUtils.js\";import{property as d}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/arrayUtils.js\";import\"../../../../core/accessorSupport/ensureType.js\";import{subclass as p}from\"../../../../core/accessorSupport/decorators/subclass.js\";import c from\"../../../../geometry/SpatialReference.js\";import{width as g,height as u,create as m}from\"../../../../geometry/support/aaBoundingRect.js\";import{closeRingsAndFixWinding as _}from\"../../../../geometry/support/coordsUtils.js\";import{getJsonType as f,isPolygon as y,isPolyline as S,isExtent as b,isPoint as w,isMultipoint as T}from\"../../../../geometry/support/jsonUtils.js\";import{normalizeCentralMeridianSync as v}from\"../../../../geometry/support/normalizeUtilsSync.js\";import{getInfo as I}from\"../../../../geometry/support/spatialReferenceUtils.js\";import{checkProjectionSupport as G,project as U}from\"../../../../layers/graphics/data/projectionSupport.js\";import{symbolToCIM as M}from\"../../../../symbols/cim/CIMSymbolHelper.js\";import{errorPolylineSymbol2D as C,errorPolygonSymbol2D as j,errorPointSymbol2D as P}from\"../../../../symbols/support/defaults.js\";import{FILTER_FLAG_0 as x}from\"../../engine/webgl/definitions.js\";import{GraphicTile as A}from\"../../engine/webgl/GraphicTile.js\";import{TileData as R}from\"../../engine/webgl/TileData.js\";import q from\"../../engine/webgl/WGLDisplayObject.js\";import{MeshData as D}from\"../../engine/webgl/mesh/MeshData.js\";import{WGLMeshFactory as O}from\"../../engine/webgl/mesh/factories/WGLMeshFactory.js\";import{WGLTemplateStore as z}from\"../../engine/webgl/mesh/templates/WGLTemplateStore.js\";import{createMatcher as F}from\"../../engine/webgl/util/Matcher.js\";import{createMatcherSchema as H,createSymbolSchemaOptions as k}from\"../features/schemaUtils.js\";import E from\"../features/support/AttributeStore.js\";import{ComputedAttributeStorage as N}from\"../features/support/ComputedAttributeStorage.js\";import{GraphicsReader as V}from\"../features/support/GraphicsReader.js\";import B from\"./GraphicStore.js\";import{intersectingInternationalDateline as L,isMarkerSymbol as W,isTextSymbol as J,polygonFromExtent as Z,TILE_SIZE as K,PIXEL_BUFFER as Q}from\"./graphicsUtils.js\";import{expandSymbol as X}from\"../support/cimSymbolUtils.js\";import{GraphicsView as Y}from\"../../../layers/GraphicsView.js\";import{getWebGL1Capabilities as $}from\"../../../webgl/capabilities.js\";import{createSymbolSchema as ee}from\"../features/createSymbolSchema.js\";const te=r(\"esri-2d-graphic-debug\");function se(e,t,s){if(s.has(e))return s.get(e);const i={tile:t,addedOrModified:[],removed:[]};return s.set(e,i),i}let ie=class extends(Y(i(t))){constructor(e){super(e),this._storage=new N,this._displayIds=new Map,this._controller=new AbortController,this._tiles=new Map,this._graphicStoreUpdate=!1,this._graphicsSet=new Set,this._matcher=Promise.resolve(null),this._tileUpdateSet=new Set,this._tilesToUpdate=new Map,this._graphicIdToAbortController=new Map,this._attached=!1,this._updatingGraphicsTimer=null,this._hashToExpandedSymbol=new Map,this._hashToExpandedSymbolPromise=new Map,this._hashToCIMSymbolPromise=new Map,this._hashToCIM=new Map,this._processing=!1,this._needsProcessing=!1,this._pendingUpdate={added:new Set,updated:new Set,removed:new Set},this.lastUpdateId=-1,this.updateRequested=!1,this.graphicUpdateHandler=this.graphicUpdateHandler.bind(this)}destroy(){this._updatingGraphicsTimer&&(clearTimeout(this._updatingGraphicsTimer),this._updatingGraphicsTimer=null,this.notifyChange(\"updating\")),this._controller.abort(),this.container.destroy(),this._set(\"graphics\",null),this._graphicStore.clear(),this._attributeStore=null,this._hashToExpandedSymbol.clear(),this.view=null,this.renderer=null,this._hashToCIM.clear(),this._hashToCIMSymbolPromise.clear(),this._hashToExpandedSymbolPromise.clear()}_createMatcher(e,t,s){if(e){const i=H({indexCount:0,fields:{}},\"feature\",e);this._matcher=F(i,t,null,s)}}_createDisplayId(e){return this._displayIds.has(e)||this._displayIds.set(e,this._storage.createDisplayId()),this._displayIds.get(e)}initialize(){this._attributeStore=new E({type:\"local\",initialize:e=>Promise.resolve(this.container.attributeView.initialize(e)),update:e=>this.container.attributeView.requestUpdate(e),render:()=>this.container.requestRender()},$()),this.container.hasHighlight=()=>this._attributeStore.hasHighlight;const e=e=>{this._createDisplayId(e.uid),this._setFilterState(e.uid,e.visible)},t=e=>{const t=this._displayIds.get(e.uid);this._displayIds.delete(e.uid),this._storage.releaseDisplayId(t)},s=new z(this.container.getMaterialItems.bind(this.container),this.view.featuresTilingScheme.tileInfo);this._graphicStore=new B(this.view.featuresTilingScheme,this.view.state.scale,this.uid,this.graphics,e,t,this._hashToCIM),this._meshFactory=new O(null,this.uid,s),this._templateStore=s,this.handles.add([this.watch(\"renderer\",(e=>{this._createMatcher(e,s,this.container.stage.resourceManager);for(const t of this.graphics)this._pendingUpdate.updated.add(t);this.requestUpdate()})),this.view.graphicsTileStore.on(\"update\",(e=>this._onTileUpdate(e))),this.container.on(\"attach\",(()=>{te&&this.container.enableRenderingBounds((()=>this._graphicStore.getAllBounds())),this.graphics.items.length>0&&this._graphicsChangeHandler({target:this.graphics,added:this.graphics.items,removed:[],moved:[]}),this.handles.add(this.graphics.on(\"change\",(e=>this._graphicsChangeHandler(e))),\"graphics\");const e=this.container.stage.resourceManager;this._createMatcher(this.renderer,s,e),this._graphicStore.setResourceManager(e),this._attached=!0,this.notifyChange(\"updating\")}))]);const i=this.view.graphicsTileStore.tiles;this._onTileUpdate({added:i,removed:[]})}get updating(){return!this._attached||null!==this._updatingGraphicsTimer||this._tileUpdateSet.size>0||this._tilesToUpdate.size>0}hitTest(e){if(!this.view||!this.view.position)return null;const{resolution:t,rotation:s}=this.view.state;return this._graphicStore.hitTest(e.x,e.y,2,t,s)}update(e){h(this._controller.signal);const t=e.state,{resolution:s}=t;if(this._graphicStore.updateLevel(s),this._graphicStoreUpdate=!0,this.updateRequested=!1,this._pendingUpdate.updated.size>0){if(!this._processing)return void this._updateGraphics();this._needsProcessing=!0}}viewChange(){this.requestUpdate()}requestUpdate(){this.updateRequested||(this.updateRequested=!0,this.requestUpdateCallback())}processUpdate(e){this.updateRequested&&(this.updateRequested=!1,this.update(e))}graphicUpdateHandler(e){const{graphic:t,property:s,newValue:i}=e;switch(s){case\"attributes\":case\"geometry\":case\"symbol\":this._pendingUpdate.updated.add(t),this.requestUpdate();break;case\"visible\":this._setFilterState(t.uid,i),this._attributeStore.sendUpdates()}}setHighlight(e){const t=e.map((e=>this._displayIds.get(e)));this._attributeStore.setHighlight(e,t)}_getIntersectingTiles(e){const t=this._graphicStore.getBounds(e);if(!t||0===g(t)||0===u(t))return[];const s=L(t,this.view.spatialReference);return o(s)?[...new Set([...this.view.graphicsTileStore.boundsIntersections(s[0]),...this.view.graphicsTileStore.boundsIntersections(s[1])])]:this.view.graphicsTileStore.boundsIntersections(t)}async _updateTile(e){h(this._controller.signal);const t=e.tile,s=this._getGraphicsData(this._templateStore,t,e.addedOrModified),i=await this._processGraphics(t,s);return h(this._controller.signal),this._patchTile(t.key,{type:\"update\",addOrUpdate:i,remove:e.removed,end:!0,clear:!1,sort:!1}),i}_patchTile(e,t){if(!this._tiles.has(e))return;const s=this._tiles.get(e);this.container.onTileData(s,t),this.container.requestRender()}_graphicsChangeHandler(e){const t=this._pendingUpdate;for(const s of e.added)t.added.add(s);for(const s of e.moved)t.updated.add(s);for(const s of e.removed)this._pendingUpdate.added.has(s)?t.added.delete(s):t.removed.add(s);this._processing?this._needsProcessing=!0:this._updateGraphics()}_getGraphicsToUpdate(){const e={added:[],removed:[],updated:[]};if(!this.graphics)return e;const t=this._pendingUpdate;for(const s of this.graphics.items)t.added.has(s)?e.added.push(s):t.updated.has(s)&&e.updated.push(s);for(const s of t.removed)this._graphicStore.has(s)&&e.removed.push(s);return t.added.clear(),t.removed.clear(),t.updated.clear(),e}async _updateGraphics(){this._processing=!0;const{added:e,removed:t,updated:s}=this._getGraphicsToUpdate(),i=this._tilesToUpdate;let r;try{if(!this._graphicStoreUpdate){const e=this.view.state,{resolution:t}=e;this._graphicStore.updateLevel(t)}const o=[],a=new Array(e.length+t.length);for(let e=0;e<s.length;e++){const t=s[e],h=this._getIntersectingTiles(t);for(const e of h){r=e.id;se(r,e,i).removed.push(this._displayIds.get(t.uid))}o.push(this._updateGraphic(t,null)),a[e]=t}const h=s.length;for(let t=0;t<e.length;t++){const s=e[t];a[h+t]=s,this._graphicsSet.add(s),o.push(this._addGraphic(s))}for(const e of t){this._abortProcessingGraphic(e.uid);const t=this._getIntersectingTiles(e);for(const s of t){r=s.id;se(r,s,i).removed.push(this._displayIds.get(e.uid))}this._graphicsSet.delete(e),this._graphicStore.remove(e)}let n;this._flipUpdatingGraphics(),await Promise.all(o);for(let e=0;e<a.length;e++){n=a[e];const t=this._getIntersectingTiles(n);for(const e of t){r=e.id;se(r,e,i).addedOrModified.push(n)}}this._graphicStore.updateZ();const l=[];for(const[e,t]of i)l.push(this._updateTile(t));await Promise.all(l)}catch(o){n(o),0}for(const a of t)try{const e=await this._getSymbolForGraphic(a,{});if(e){const t=e.hash();this._hashToExpandedSymbol.delete(t)}}catch(o){n(o),0}i.clear(),this.notifyChange(\"updating\"),this._processing=!1,this._needsProcessing&&(this._needsProcessing=!1,this._updateGraphics())}_getArcadeInfo(e){const t=(e.attributes?Object.keys(e.attributes):[]).map((t=>({name:t,alias:t,type:\"string\"==typeof e.attributes[t]?\"esriFieldTypeString\":\"esriFieldTypeDouble\"})));return a(e.geometry)?null:{geometryType:f(e.geometry),spatialReference:c.fromJSON(e.geometry.spatialReference),fields:t}}_getSymbolForGraphic(e,t){return h(this._controller.signal),o(e.symbol)?Promise.resolve(e.symbol):o(this.renderer)?this.renderer.getSymbolAsync(e,{scale:this.view.scale,abortOptions:t}):Promise.resolve(this._getNullSymbol(e))}_getCIMSymbol(e,t,s){let i=this._hashToCIM.get(t);if(i)return Promise.resolve(i);const r=M(e);if(o(r)){if(\"CIMSymbolReference\"===r.type)return i=r,this._hashToCIM.set(t,i),Promise.resolve(i);let e=this._hashToCIMSymbolPromise.get(t);return e||(e=r.fetchCIMSymbol(s).then((e=>(this._hashToCIM.set(t,e.data),this._hashToCIMSymbolPromise.delete(t),e))).catch((e=>(this._hashToCIMSymbolPromise.delete(t),l(e),null))),this._hashToCIMSymbolPromise.set(t,e),e)}return Promise.resolve(null)}_expandCIMSymbol(e,t,s,i){const r=this._hashToExpandedSymbol.get(s);if(r)return Promise.resolve(r);let o=this._hashToExpandedSymbolPromise.get(s);if(o)return o;const a=this.container.stage,h=this._getArcadeInfo(t),n=k(null),l=ee(e,n);return o=X(l,h,a.resourceManager,i),this._hashToExpandedSymbolPromise.set(s,o),o.then((e=>(this._hashToExpandedSymbol.set(s,e),this._hashToExpandedSymbolPromise.delete(s),e))),o}async _getSymbolResources(e,t){h(this._controller.signal);return this.container.stage?this._getSymbolForGraphic(e,t).then((i=>{const r=i.hash();return this._getCIMSymbol(i,r,t).then((i=>a(i)?null:this._expandCIMSymbol(i,e,r,t).then((e=>{const t=e.layers.filter((e=>\"text\"===e.type&&\"string\"==typeof e.text));if(t&&t.length>0){const i=new Array(t.length);for(let e=0;e<t.length;e++){const r=t[e],o=[],[a]=s(r.text);for(let e=0;e<a.length;e++)o.push(a.charCodeAt(e));i[e]={symbol:r,id:e,glyphIds:o}}const o=new Map;return this.container.getMaterialItems(i).then((s=>{for(let e=0;e<t.length;e++){const i=t[e];o.set(i.cim,{text:i.text,mosaicItem:s[e].mosaicItem})}return{symbol:e,textInfo:o,hash:r}}))}return{symbol:e,hash:r}}))))})).catch((e=>(l(e),null))):null}async _projectAndNormalizeGeometry(e,t){if(h(this._controller.signal),a(e.geometry)||\"mesh\"===e.geometry.type)return null;let s=e.geometry;if(y(s)){const e=s.rings;s.rings=e}else if(S(s)){const e=s.paths;s.paths=e}else if(b(s)){const i=await this._getSymbolForGraphic(e,t);if(h(this._controller.signal),W(i.type)||J(i.type)){s=s.center}else s=Z(s)}await G(s.spatialReference,this.view.spatialReference);const i=v(s),r=U(i,s.spatialReference,this.view.spatialReference);return _(r),r}_onTileUpdate(e){const t=I(this.view.spatialReference);if(e.added&&e.added.length>0)for(const s of e.added)this._addNewTile(s,t);if(e.removed&&e.removed.length>0)for(const s of e.removed)this._removeTile(s.key)}async _addGraphic(e){this._abortProcessingGraphic(e.uid),h(this._controller.signal);const t=new AbortController;this._graphicIdToAbortController.set(e.uid,t);const s={signal:t.signal};try{await this._addOrUpdateGraphic(e,s),h(this._controller.signal),this._graphicIdToAbortController.delete(e.uid)}catch(i){if(this._graphicIdToAbortController.delete(e.uid),!n(i))throw i}}_updateGraphic(e,t){h(this._controller.signal);const s=this._projectAndNormalizeGeometry(e,t),i=this._getSymbolResources(e,t);return Promise.all([s,i]).then((([t,s])=>{h(this._controller.signal),this._graphicStore.addOrModify(e,s,t)}))}_addOrUpdateGraphic(e,t){h(this._controller.signal);const s=this._projectAndNormalizeGeometry(e,t),i=this._getSymbolResources(e,t);return Promise.all([s,i]).then((([t,s])=>{h(this._controller.signal),this._graphicsSet.has(e)&&this._graphicStore.addOrModify(e,s,t)}))}_addTile(e){const t=this.view.featuresTilingScheme.getTileBounds(m(),e),s=new A(e,t[0],t[3]);return this._tiles.set(e,s),this.container.addChild(s),s}async _addNewTile(e,t){const s=this._addTile(e.key),i=this._graphicStore.queryTileData(this._templateStore,e);if(0===i.length)return;if(t){const s=Math.round((t.valid[1]-t.valid[0])/e.resolution);for(const e of i)e.geometry&&(w(e.geometry)||T(e.geometry))&&this._wrapPoints(e,s)}const r=e.key;this._tileUpdateSet.add(e.key),this.notifyChange(\"updating\");try{const t={type:\"update\",clear:!1,addOrUpdate:await this._processGraphics(e,i),remove:[],end:!0,sort:!1};s.patch(t),this._tileUpdateSet.delete(r),this.notifyChange(\"updating\")}catch(o){if(this._tileUpdateSet.delete(r),this.notifyChange(\"updating\"),!n(o))throw o}}_removeTile(e){if(!this._tiles.has(e))return;const t=this._tiles.get(e);this.container.removeChild(t),t.destroy(),this._tiles.delete(e)}_setFilterState(e,t){const s=this._displayIds.get(e),i=this._attributeStore.getHighlightFlag(e);this._attributeStore.setData(s,0,0,i|(t?x:0))}_getGraphicsData(e,t,s){const i=this.view,r=I(i.spatialReference),o=this._graphicStore.getGraphicsData(e,t,s);if(r){const e=Math.round((r.valid[1]-r.valid[0])/t.resolution);for(const t of o)t.geometry&&(w(t.geometry)||T(t.geometry))&&this._wrapPoints(t,e)}return o}_wrapPoints(e,t){const s=e.geometry;T(s)?this._wrapMultipoint(s,t):this._wrapPoint(e,t)}_wrapMultipoint(e,t){const s=e.points,i=[];let r=0,o=0;for(const[a,h]of s){if(i.push([a+r,h]),r=0,t===K){const e=5*Q;a+o<e?(i.push([t,0]),r=-t):a+o>K-e&&(i.push([-t,0]),r=t)}else a+o<-Q?(i.push([t,0]),r=-t):a+o>K+Q&&(i.push([-t,0]),r=t);o+=a}e.points=i}_wrapPoint(e,t){const s=e.geometry;if(t===K){const i=5*Q;s.x<i?e.geometry={points:[[s.x,s.y],[t,0]]}:s.x>K-i&&(e.geometry={points:[[s.x,s.y],[-t,0]]})}else s.x<-Q?e.geometry={points:[[s.x,s.y],[t,0]]}:s.x>K+Q&&(e.geometry={points:[[s.x,s.y],[-t,0]]})}_processGraphics(e,t,s){if(!(t&&t.length)||!this._meshFactory)return null;const i=V.from(t),r=this._meshFactory;return this._matcher.then((t=>r.analyzeGraphics(i,this.container.stage.resourceManager,t,null,null,s).then((()=>(this._attributeStore.sendUpdates(),this._processAnalyzedGraphics(e,i))))))}_processAnalyzedGraphics(e,t){const s=this._meshFactory,i=t.getSize(),r=t.getCursor(),o={features:i,records:i,metrics:0},a=new D(e.key.id,o,{fill:\"default\"},!1,!1),h=[];for(;r.next();){const t=r.readGraphic();t.insertAfter=-1===t.insertAfter?-1:this._displayIds.get(t.insertAfter),t.displayId=this._displayIds.get(t.attributes[this.uid]);const i=new q(t.displayId);i.insertAfter=t.insertAfter,h.push(i),s.writeGraphic(a,r,e.level,this.container.stage.resourceManager)}const n=e.tileInfoView.tileInfo.isWrappable,l=a.serialize(n);if(1!==l.length)return new R;const d=l[0].message;return R.fromVertexData(d,h)}_abortProcessingGraphic(e){if(this._graphicIdToAbortController.has(e)){this._graphicIdToAbortController.get(e).abort()}}_getNullSymbol(e){const t=e.geometry;return S(t)?C:y(t)||b(t)?j:P}_flipUpdatingGraphics(){this._updatingGraphicsTimer&&clearTimeout(this._updatingGraphicsTimer),this._updatingGraphicsTimer=setTimeout((()=>{this._updatingGraphicsTimer=null,this.notifyChange(\"updating\")}),160),this.notifyChange(\"updating\")}};e([d({constructOnly:!0})],ie.prototype,\"requestUpdateCallback\",void 0),e([d()],ie.prototype,\"container\",void 0),e([d({constructOnly:!0})],ie.prototype,\"graphics\",void 0),e([d()],ie.prototype,\"updating\",null),e([d()],ie.prototype,\"view\",void 0),e([d()],ie.prototype,\"updateRequested\",void 0),ie=e([p(\"esri.views.2d.layers.support.GraphicsView2D\")],ie);const re=ie;export{re as default};\n"]},"metadata":{},"sourceType":"module"}