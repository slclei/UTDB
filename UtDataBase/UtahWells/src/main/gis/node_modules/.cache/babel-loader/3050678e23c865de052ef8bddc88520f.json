{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport e from \"../../../../../../core/Error.js\";\nimport t from \"../../../../../../core/Logger.js\";\nimport { isAbortError as r } from \"../../../../../../core/promiseUtils.js\";\nimport { errorPointSymbolJSON as s, errorPolylineSymbolJSON as i, errorPolygonSymbolJSON as a } from \"../../../../../../symbols/support/defaultsJSON.js\";\nimport { WGLGeometryType as o } from \"../../enums.js\";\nimport { createMaterialKey as m } from \"../../materialKey/MaterialKey.js\";\nimport l from \"./WGLDynamicFillTemplate.js\";\nimport c from \"./WGLDynamicLineTemplate.js\";\nimport n from \"./WGLDynamicMarkerTemplate.js\";\nimport h from \"./WGLDynamicTextTemplate.js\";\nimport p from \"./WGLFillTemplate.js\";\nimport u from \"./WGLLineTemplate.js\";\nimport _ from \"./WGLMarkerTemplate.js\";\nimport f from \"./WGLTextTemplate.js\";\nimport M, { withLock as T } from \"../../util/Lock.js\";\nimport { ok as y } from \"../../util/Result.js\";\nimport { codepoints as I } from \"../../../../layers/features/textUtils.js\";\nimport { cimLayerToRasterizationInfo as d } from \"../../../../layers/support/cimSymbolUtils.js\";\nconst g = t.getLogger(\"esri.views.2d.engine.webgl.mesh.templates.WGLTemplateStore\"),\n      S = new Array(),\n      w = {\n  isOutline: !1,\n  isOutlinedFill: !1,\n  placement: null,\n  stride: {\n    fill: \"default\"\n  },\n  vvFlags: 0\n},\n      k = { ...s,\n  hash: JSON.stringify(s),\n  materialKey: m(o.MARKER, w)\n},\n      C = { ...i,\n  hash: JSON.stringify(i),\n  materialKey: m(o.LINE, w)\n},\n      L = { ...a,\n  hash: JSON.stringify(a),\n  materialKey: m(o.FILL, w)\n};\n\nfunction b(e, t) {\n  const r = e.length;\n  return e.push(null), t.then(t => e[r] = t), e;\n}\n\nfunction G(e) {\n  return !!(1 & e);\n}\n\nfunction E(e) {\n  return \"worker:port-closed\" === e.name;\n}\n\nclass j {\n  constructor(e, t) {\n    this._idCounter = 1, this._templateIdCounter = 1, this._idToTemplateGroup = new Map(), this._symbolToTemplate = new Map(), this._fetchQueue = [], this._idToResolver = new Map(), this._cimTemplateCache = new Map(), this._cimAnalyses = [], this._lock = new M(), this._fetchResource = e, this._tileInfo = t;\n  }\n\n  get _markerError() {\n    return this._errorTemplates.marker[0];\n  }\n\n  get _fillError() {\n    return this._errorTemplates.fill[0];\n  }\n\n  get _lineError() {\n    return this._errorTemplates.line[0];\n  }\n\n  get _textError() {\n    return this._errorTemplates.line[0];\n  }\n\n  createTemplateGroup(e, t) {\n    this._initErrorTemplates();\n\n    const r = e.hash;\n    if (this._symbolToTemplate.has(r)) return this._symbolToTemplate.get(r);\n    const s = new Array();\n    t && this._createMeshTemplates(s, t, !0), this._createMeshTemplates(s, e, !1);\n\n    const i = this._createGroupId(\"expanded-cim\" === e.type && x(e));\n\n    return this._idToTemplateGroup.set(i, s), this._symbolToTemplate.set(r, i), i;\n  }\n\n  getTemplateGroup(e) {\n    return this._idToTemplateGroup.has(e) ? this._idToTemplateGroup.get(e) : S;\n  }\n\n  getDynamicTemplateGroup(e) {\n    return this._idToTemplateGroup.has(e) ? (G(e) || g.error(\"mapview-template-store\", `Id ${e} does not refer to a dynamic template`), this._idToTemplateGroup.get(e)) : S;\n  }\n\n  getMosaicItem(e, t) {\n    const r = this._createTemplateId(),\n          s = new Promise(e => this._idToResolver.set(r, e));\n\n    return this._fetchQueue.push({\n      symbol: e,\n      id: r,\n      glyphIds: t\n    }), s;\n  }\n\n  finalize(e) {\n    return this._fetchQueue.length || this._lock.isHeld() ? T(this._lock, this._fetchAllQueuedResources.bind(this), e) : Promise.resolve();\n  }\n\n  _initErrorTemplates() {\n    this._errorTemplates || (this._errorTemplates = {\n      fill: this._createMeshTemplates([], L, !1),\n      marker: this._createMeshTemplates([], k, !1),\n      line: this._createMeshTemplates([], C, !1)\n    });\n  }\n\n  _fetchAllQueuedResources(t) {\n    if (!this._fetchQueue.length) return Promise.resolve();\n    const s = this._fetchQueue,\n          i = this._cimAnalyses;\n    return this._fetchQueue = [], this._cimAnalyses = [], Promise.all(i).then(() => this._fetchResource(s, t).then(e => {\n      for (const {\n        id: t,\n        mosaicItem: r\n      } of e) {\n        this._idToResolver.get(t)(r), this._idToResolver.delete(t);\n      }\n    })).catch(t => {\n      r(t) ? this._fetchQueue = this._fetchQueue.concat(s) : E(t) || g.error(new e(\"mapview-template-store\", \"Unable to fetch requested texture resources\", t));\n    });\n  }\n\n  _createGroupId(e) {\n    return this._idCounter++ << 1 | (e ? 1 : 0);\n  }\n\n  _createTemplateId() {\n    return this._templateIdCounter++;\n  }\n\n  async _createSMS(e) {\n    const {\n      spriteMosaicItem: t\n    } = await this.getMosaicItem(e);\n    return y(t, g) ? _.fromSimpleMarker(e, t) : this._markerError;\n  }\n\n  async _createPMS(e) {\n    const {\n      spriteMosaicItem: t\n    } = await this.getMosaicItem(e);\n    return y(t, g) ? _.fromPictureMarker(e, t) : this._markerError;\n  }\n\n  async _createSFS(e, t) {\n    const {\n      spriteMosaicItem: r\n    } = await this.getMosaicItem(e);\n    return y(r, g) ? p.fromSimpleFill(e, r, t) : this._fillError;\n  }\n\n  async _createPFS(e, t) {\n    const {\n      spriteMosaicItem: r\n    } = await this.getMosaicItem(e);\n    return y(r, g) ? p.fromPictureFill(e, r, t) : this._fillError;\n  }\n\n  async _createSLS(e, t) {\n    const {\n      spriteMosaicItem: r\n    } = await this.getMosaicItem(e);\n    return y(r, g) ? u.fromSimpleLine(e, r) : this._lineError;\n  }\n\n  async _createLMS(e) {\n    const {\n      spriteMosaicItem: t\n    } = await this.getMosaicItem(e);\n    return y(t, g) ? _.fromLineSymbolMarker(e, t) : this._markerError;\n  }\n\n  async _createTS(e) {\n    const {\n      glyphMosaicItems: t\n    } = await this.getMosaicItem(e);\n    return f.fromText(e, t);\n  }\n\n  async _createCIMText(e) {\n    const {\n      glyphMosaicItems: t\n    } = await this.getMosaicItem(d(e), I(e.text));\n    return y(t, g) ? f.fromCIMText(e, t, this._tileInfo) : this._textError;\n  }\n\n  async _createCIMFill(e) {\n    const {\n      spriteMosaicItem: t\n    } = await this.getMosaicItem(d(e));\n    return y(t, g) ? p.fromCIMFill(e, t, this._tileInfo) : this._fillError;\n  }\n\n  async _createCIMLine(e) {\n    const {\n      spriteMosaicItem: t\n    } = await this.getMosaicItem(d(e));\n    return y(t, g) ? u.fromCIMLine(e, t, this._tileInfo) : this._lineError;\n  }\n\n  async _createCIMMarker(e) {\n    const {\n      spriteMosaicItem: t\n    } = await this.getMosaicItem(d(e));\n    return y(t, g) ? _.fromCIMMarker(e, t, this._tileInfo) : this._markerError;\n  }\n\n  async _createCIM(e) {\n    const t = e.templateHash;\n    if (this._cimTemplateCache.has(t)) return this._cimTemplateCache.get(t);\n    let r;\n\n    switch (e.type) {\n      case \"marker\":\n        r = await this._createCIMMarker(e);\n        break;\n\n      case \"line\":\n        r = await this._createCIMLine(e);\n        break;\n\n      case \"fill\":\n        r = await this._createCIMFill(e);\n        break;\n\n      case \"text\":\n        r = await this._createCIMText(e);\n    }\n\n    return this._cimTemplateCache.set(t, r), r;\n  }\n\n  async _createDynamicCIM(e) {\n    const t = e.templateHash;\n    if (this._cimTemplateCache.has(t)) return this._cimTemplateCache.get(t);\n    let r;\n\n    switch (e.type) {\n      case \"marker\":\n        r = n.fromCIMMarker(e, this._tileInfo);\n        break;\n\n      case \"line\":\n        r = c.fromCIMLine(e, this._tileInfo);\n        break;\n\n      case \"fill\":\n        r = l.fromCIMFill(e, this._tileInfo);\n        break;\n\n      case \"text\":\n        r = h.fromCIMText(e, this._tileInfo);\n    }\n\n    return this._cimTemplateCache.set(t, r), r;\n  }\n\n  _createPrimitiveMeshTemplates(e, t, r) {\n    switch (t.type) {\n      case \"esriSMS\":\n        return b(e, this._createSMS(t));\n\n      case \"esriPMS\":\n        return b(e, this._createPMS(t));\n\n      case \"esriSFS\":\n        return b(e, this._createSFS(t, r));\n\n      case \"line-marker\":\n        return b(e, this._createLMS(t));\n\n      case \"esriPFS\":\n        return b(e, this._createPFS(t, r));\n\n      case \"esriSLS\":\n        return b(e, this._createSLS(t, !1));\n\n      case \"esriTS\":\n        return b(e, this._createTS(t));\n\n      default:\n        return g.error(\"Unable to create mesh template for unknown symbol type {: $ }{symbol.type}\"), e;\n    }\n  }\n\n  _createMeshTemplates(e, t, r) {\n    if (-1 !== t.type.indexOf(\"3d\")) return g.error(\"3D symbols are not supported with MapView\"), e;\n\n    if (\"expanded-cim\" === t.type) {\n      for (const r of t.layers) \"function\" == typeof r.materialHash ? b(e, this._createDynamicCIM(r)) : b(e, this._createCIM(r));\n\n      return e;\n    }\n\n    if (\"composite-symbol\" === t.type) {\n      for (const s of t.layers) this._createPrimitiveMeshTemplates(e, s, r);\n\n      return e;\n    }\n\n    return \"cim\" === t.type || \"label\" === t.type || \"web-style\" === t.type ? e : this._createPrimitiveMeshTemplates(e, t, r);\n  }\n\n}\n\nconst x = e => {\n  if (!e.layers) return !1;\n\n  for (const t of e.layers) if (\"function\" == typeof t.materialHash) return !0;\n\n  return !1;\n};\n\nexport { j as WGLTemplateStore, k as errorPointSchema2D, L as errorPolygonSchema2D, C as errorPolylineSchema2D, G as isDynamicId };","map":{"version":3,"sources":["D:/Github/CUSP_DataBase/CUSP_DB/src/main/gis/node_modules/@arcgis/core/views/2d/engine/webgl/mesh/templates/WGLTemplateStore.js"],"names":["e","t","isAbortError","r","errorPointSymbolJSON","s","errorPolylineSymbolJSON","i","errorPolygonSymbolJSON","a","WGLGeometryType","o","createMaterialKey","m","l","c","n","h","p","u","_","f","M","withLock","T","ok","y","codepoints","I","cimLayerToRasterizationInfo","d","g","getLogger","S","Array","w","isOutline","isOutlinedFill","placement","stride","fill","vvFlags","k","hash","JSON","stringify","materialKey","MARKER","C","LINE","L","FILL","b","length","push","then","G","E","name","j","constructor","_idCounter","_templateIdCounter","_idToTemplateGroup","Map","_symbolToTemplate","_fetchQueue","_idToResolver","_cimTemplateCache","_cimAnalyses","_lock","_fetchResource","_tileInfo","_markerError","_errorTemplates","marker","_fillError","_lineError","line","_textError","createTemplateGroup","_initErrorTemplates","has","get","_createMeshTemplates","_createGroupId","type","x","set","getTemplateGroup","getDynamicTemplateGroup","error","getMosaicItem","_createTemplateId","Promise","symbol","id","glyphIds","finalize","isHeld","_fetchAllQueuedResources","bind","resolve","all","mosaicItem","delete","catch","concat","_createSMS","spriteMosaicItem","fromSimpleMarker","_createPMS","fromPictureMarker","_createSFS","fromSimpleFill","_createPFS","fromPictureFill","_createSLS","fromSimpleLine","_createLMS","fromLineSymbolMarker","_createTS","glyphMosaicItems","fromText","_createCIMText","text","fromCIMText","_createCIMFill","fromCIMFill","_createCIMLine","fromCIMLine","_createCIMMarker","fromCIMMarker","_createCIM","templateHash","_createDynamicCIM","_createPrimitiveMeshTemplates","indexOf","layers","materialHash","WGLTemplateStore","errorPointSchema2D","errorPolygonSchema2D","errorPolylineSchema2D","isDynamicId"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport e from\"../../../../../../core/Error.js\";import t from\"../../../../../../core/Logger.js\";import{isAbortError as r}from\"../../../../../../core/promiseUtils.js\";import{errorPointSymbolJSON as s,errorPolylineSymbolJSON as i,errorPolygonSymbolJSON as a}from\"../../../../../../symbols/support/defaultsJSON.js\";import{WGLGeometryType as o}from\"../../enums.js\";import{createMaterialKey as m}from\"../../materialKey/MaterialKey.js\";import l from\"./WGLDynamicFillTemplate.js\";import c from\"./WGLDynamicLineTemplate.js\";import n from\"./WGLDynamicMarkerTemplate.js\";import h from\"./WGLDynamicTextTemplate.js\";import p from\"./WGLFillTemplate.js\";import u from\"./WGLLineTemplate.js\";import _ from\"./WGLMarkerTemplate.js\";import f from\"./WGLTextTemplate.js\";import M,{withLock as T}from\"../../util/Lock.js\";import{ok as y}from\"../../util/Result.js\";import{codepoints as I}from\"../../../../layers/features/textUtils.js\";import{cimLayerToRasterizationInfo as d}from\"../../../../layers/support/cimSymbolUtils.js\";const g=t.getLogger(\"esri.views.2d.engine.webgl.mesh.templates.WGLTemplateStore\"),S=new Array,w={isOutline:!1,isOutlinedFill:!1,placement:null,stride:{fill:\"default\"},vvFlags:0},k={...s,hash:JSON.stringify(s),materialKey:m(o.MARKER,w)},C={...i,hash:JSON.stringify(i),materialKey:m(o.LINE,w)},L={...a,hash:JSON.stringify(a),materialKey:m(o.FILL,w)};function b(e,t){const r=e.length;return e.push(null),t.then((t=>e[r]=t)),e}function G(e){return!!(1&e)}function E(e){return\"worker:port-closed\"===e.name}class j{constructor(e,t){this._idCounter=1,this._templateIdCounter=1,this._idToTemplateGroup=new Map,this._symbolToTemplate=new Map,this._fetchQueue=[],this._idToResolver=new Map,this._cimTemplateCache=new Map,this._cimAnalyses=[],this._lock=new M,this._fetchResource=e,this._tileInfo=t}get _markerError(){return this._errorTemplates.marker[0]}get _fillError(){return this._errorTemplates.fill[0]}get _lineError(){return this._errorTemplates.line[0]}get _textError(){return this._errorTemplates.line[0]}createTemplateGroup(e,t){this._initErrorTemplates();const r=e.hash;if(this._symbolToTemplate.has(r))return this._symbolToTemplate.get(r);const s=new Array;t&&this._createMeshTemplates(s,t,!0),this._createMeshTemplates(s,e,!1);const i=this._createGroupId(\"expanded-cim\"===e.type&&x(e));return this._idToTemplateGroup.set(i,s),this._symbolToTemplate.set(r,i),i}getTemplateGroup(e){return this._idToTemplateGroup.has(e)?this._idToTemplateGroup.get(e):S}getDynamicTemplateGroup(e){return this._idToTemplateGroup.has(e)?(G(e)||g.error(\"mapview-template-store\",`Id ${e} does not refer to a dynamic template`),this._idToTemplateGroup.get(e)):S}getMosaicItem(e,t){const r=this._createTemplateId(),s=new Promise((e=>this._idToResolver.set(r,e)));return this._fetchQueue.push({symbol:e,id:r,glyphIds:t}),s}finalize(e){return this._fetchQueue.length||this._lock.isHeld()?T(this._lock,this._fetchAllQueuedResources.bind(this),e):Promise.resolve()}_initErrorTemplates(){this._errorTemplates||(this._errorTemplates={fill:this._createMeshTemplates([],L,!1),marker:this._createMeshTemplates([],k,!1),line:this._createMeshTemplates([],C,!1)})}_fetchAllQueuedResources(t){if(!this._fetchQueue.length)return Promise.resolve();const s=this._fetchQueue,i=this._cimAnalyses;return this._fetchQueue=[],this._cimAnalyses=[],Promise.all(i).then((()=>this._fetchResource(s,t).then((e=>{for(const{id:t,mosaicItem:r}of e){this._idToResolver.get(t)(r),this._idToResolver.delete(t)}})))).catch((t=>{r(t)?this._fetchQueue=this._fetchQueue.concat(s):E(t)||g.error(new e(\"mapview-template-store\",\"Unable to fetch requested texture resources\",t))}))}_createGroupId(e){return this._idCounter++<<1|(e?1:0)}_createTemplateId(){return this._templateIdCounter++}async _createSMS(e){const{spriteMosaicItem:t}=await this.getMosaicItem(e);return y(t,g)?_.fromSimpleMarker(e,t):this._markerError}async _createPMS(e){const{spriteMosaicItem:t}=await this.getMosaicItem(e);return y(t,g)?_.fromPictureMarker(e,t):this._markerError}async _createSFS(e,t){const{spriteMosaicItem:r}=await this.getMosaicItem(e);return y(r,g)?p.fromSimpleFill(e,r,t):this._fillError}async _createPFS(e,t){const{spriteMosaicItem:r}=await this.getMosaicItem(e);return y(r,g)?p.fromPictureFill(e,r,t):this._fillError}async _createSLS(e,t){const{spriteMosaicItem:r}=await this.getMosaicItem(e);return y(r,g)?u.fromSimpleLine(e,r):this._lineError}async _createLMS(e){const{spriteMosaicItem:t}=await this.getMosaicItem(e);return y(t,g)?_.fromLineSymbolMarker(e,t):this._markerError}async _createTS(e){const{glyphMosaicItems:t}=await this.getMosaicItem(e);return f.fromText(e,t)}async _createCIMText(e){const{glyphMosaicItems:t}=await this.getMosaicItem(d(e),I(e.text));return y(t,g)?f.fromCIMText(e,t,this._tileInfo):this._textError}async _createCIMFill(e){const{spriteMosaicItem:t}=await this.getMosaicItem(d(e));return y(t,g)?p.fromCIMFill(e,t,this._tileInfo):this._fillError}async _createCIMLine(e){const{spriteMosaicItem:t}=await this.getMosaicItem(d(e));return y(t,g)?u.fromCIMLine(e,t,this._tileInfo):this._lineError}async _createCIMMarker(e){const{spriteMosaicItem:t}=await this.getMosaicItem(d(e));return y(t,g)?_.fromCIMMarker(e,t,this._tileInfo):this._markerError}async _createCIM(e){const t=e.templateHash;if(this._cimTemplateCache.has(t))return this._cimTemplateCache.get(t);let r;switch(e.type){case\"marker\":r=await this._createCIMMarker(e);break;case\"line\":r=await this._createCIMLine(e);break;case\"fill\":r=await this._createCIMFill(e);break;case\"text\":r=await this._createCIMText(e)}return this._cimTemplateCache.set(t,r),r}async _createDynamicCIM(e){const t=e.templateHash;if(this._cimTemplateCache.has(t))return this._cimTemplateCache.get(t);let r;switch(e.type){case\"marker\":r=n.fromCIMMarker(e,this._tileInfo);break;case\"line\":r=c.fromCIMLine(e,this._tileInfo);break;case\"fill\":r=l.fromCIMFill(e,this._tileInfo);break;case\"text\":r=h.fromCIMText(e,this._tileInfo)}return this._cimTemplateCache.set(t,r),r}_createPrimitiveMeshTemplates(e,t,r){switch(t.type){case\"esriSMS\":return b(e,this._createSMS(t));case\"esriPMS\":return b(e,this._createPMS(t));case\"esriSFS\":return b(e,this._createSFS(t,r));case\"line-marker\":return b(e,this._createLMS(t));case\"esriPFS\":return b(e,this._createPFS(t,r));case\"esriSLS\":return b(e,this._createSLS(t,!1));case\"esriTS\":return b(e,this._createTS(t));default:return g.error(\"Unable to create mesh template for unknown symbol type {: $ }{symbol.type}\"),e}}_createMeshTemplates(e,t,r){if(-1!==t.type.indexOf(\"3d\"))return g.error(\"3D symbols are not supported with MapView\"),e;if(\"expanded-cim\"===t.type){for(const r of t.layers)\"function\"==typeof r.materialHash?b(e,this._createDynamicCIM(r)):b(e,this._createCIM(r));return e}if(\"composite-symbol\"===t.type){for(const s of t.layers)this._createPrimitiveMeshTemplates(e,s,r);return e}return\"cim\"===t.type||\"label\"===t.type||\"web-style\"===t.type?e:this._createPrimitiveMeshTemplates(e,t,r)}}const x=e=>{if(!e.layers)return!1;for(const t of e.layers)if(\"function\"==typeof t.materialHash)return!0;return!1};export{j as WGLTemplateStore,k as errorPointSchema2D,L as errorPolygonSchema2D,C as errorPolylineSchema2D,G as isDynamicId};\n"]},"metadata":{},"sourceType":"module"}