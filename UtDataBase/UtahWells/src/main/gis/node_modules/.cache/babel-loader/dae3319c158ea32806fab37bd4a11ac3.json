{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport e from \"../../../../Color.js\";\nimport { unwrapOr as t, unwrap as i, isSome as s, isNone as a } from \"../../../../core/maybe.js\";\nimport { pt2px as o } from \"../../../../core/screenUtils.js\";\nimport { getMetersPerUnitForSR as l } from \"../../../../core/unitUtils.js\";\nimport { meterIn as r } from \"../../../../renderers/support/lengthUtils.js\";\nimport { DOT_DENSITY_MAX_FIELDS as n } from \"./definitions.js\";\nimport { isDefined as v, isNumber as d } from \"./Utils.js\";\nimport { getWebGL1Capabilities as u } from \"../../../webgl/capabilities.js\";\n\nfunction c(e, t) {\n  const i = t.length;\n  if (e < t[0].value || 1 === i) return t[0].size;\n\n  for (let s = 1; s < i; s++) if (e < t[s].value) {\n    const i = (e - t[s - 1].value) / (t[s].value - t[s - 1].value);\n    return t[s - 1].size + i * (t[s].size - t[s - 1].size);\n  }\n\n  return t[i - 1].size;\n}\n\nfunction p(e, t) {\n  let i = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n  if (a(t)) return e[i + 0] = 0, e[i + 1] = 0, e[i + 2] = 0, void (e[i + 3] = 0);\n  const {\n    r: s,\n    g: o,\n    b: l,\n    a: r\n  } = t;\n  e[i + 0] = s * r / 255, e[i + 1] = o * r / 255, e[i + 2] = l * r / 255, e[i + 3] = r;\n}\n\nclass h {\n  constructor() {\n    this.symbolLevels = [], this.vvColorValues = new Float32Array(8), this.vvColors = new Float32Array(32), this.vvOpacityValues = new Float32Array(8), this.vvOpacities = new Float32Array(8), this.vvSizeMinMaxValue = new Float32Array(4), this.ddColors = new Float32Array(32), this.ddBackgroundColor = new Float32Array(4), this.ddActiveDots = new Float32Array(8), this._vvMaterialParameters = {\n      vvSizeEnabled: !1,\n      vvColorEnabled: !1,\n      vvRotationEnabled: !1,\n      vvRotationType: \"geographic\",\n      vvOpacityEnabled: !1\n    };\n  }\n\n  getSizeVVFieldStops(e) {\n    const s = this._vvSizeFieldStops;\n\n    switch (s.type) {\n      case \"static\":\n        return s;\n\n      case \"level-dependent\":\n        return t(s.levels[e], () => {\n          let t = 1 / 0,\n              a = 0;\n\n          for (const i in s.levels) {\n            const s = parseFloat(i),\n                  o = Math.abs(e - s);\n            o < t && (t = o, a = s);\n          }\n\n          if (t === 1 / 0) return {\n            sizes: new Float32Array([0, 0, 0, 0, 0, 0]),\n            values: new Float32Array([0, 0, 0, 0, 0, 0])\n          };\n          const o = 2 ** ((e - a) / 2),\n                l = i(s.levels[a]),\n                r = new Float32Array(l.values);\n          return r[2] *= o, r[3] *= o, {\n            sizes: i(l.sizes),\n            values: r\n          };\n        });\n    }\n  }\n\n  get vvMaterialParameters() {\n    return this._vvMaterialParameters;\n  }\n\n  update(e) {\n    s(this._vvInfo) && this._updateVisualVariables(this._vvInfo.vvRanges, e);\n  }\n\n  setInfo(e, t, i) {\n    if (this._updateEffects(i), this._vvInfo = t, \"dot-density\" === e.type) this._updateDotDensityInfo(e);\n  }\n\n  getVariation() {\n    return {\n      ddDotBlending: this.ddDotBlending,\n      outsideLabelsVisible: this.outsideLabelsVisible,\n      oesTextureFloat: u().supportsTextureFloat\n    };\n  }\n\n  getVariationHash() {\n    return (this.ddDotBlending ? 1 : 0) | (this.outsideLabelsVisible ? 1 : 0) << 1;\n  }\n\n  _updateEffects(e) {\n    s(e) ? this.outsideLabelsVisible = e.excludedLabelsVisible : this.outsideLabelsVisible = !1;\n  }\n\n  _updateVisualVariables(e, t) {\n    const i = this._vvMaterialParameters;\n    if (i.vvOpacityEnabled = !1, i.vvSizeEnabled = !1, i.vvColorEnabled = !1, i.vvRotationEnabled = !1, !e) return;\n    const s = e.size;\n\n    if (s) {\n      if (i.vvSizeEnabled = !0, s.minMaxValue) {\n        const e = s.minMaxValue;\n        let i, a;\n        if (v(e.minSize) && v(e.maxSize)) if (d(e.minSize) && d(e.maxSize)) i = o(e.minSize), a = o(e.maxSize);else {\n          const s = t.scale;\n          i = o(c(s, e.minSize.stops)), a = o(c(s, e.maxSize.stops));\n        }\n        this.vvSizeMinMaxValue.set([e.minDataValue, e.maxDataValue, i, a]);\n      }\n\n      if (s.scaleStops && (this.vvSizeScaleStopsValue = o(c(t.scale, s.scaleStops.stops))), s.unitValue) {\n        const e = l(t.spatialReference) / r[s.unitValue.unit];\n        this.vvSizeUnitValueToPixelsRatio = e / t.resolution;\n      }\n\n      s.fieldStops && (this._vvSizeFieldStops = s.fieldStops);\n    }\n\n    const a = e.color;\n    a && (i.vvColorEnabled = !0, this.vvColorValues.set(a.values), this.vvColors.set(a.colors));\n    const n = e.opacity;\n    n && (i.vvOpacityEnabled = !0, this.vvOpacityValues.set(n.values), this.vvOpacities.set(n.opacities));\n    const u = e.rotation;\n    u && (i.vvRotationEnabled = !0, i.vvRotationType = u.type);\n  }\n\n  _updateDotDensityInfo(t) {\n    const i = t.attributes;\n    this.ddDotValue = t.dotValue, this.ddDotScale = t.referenceScale, this.ddDotSize = t.dotSize, this.ddDotBlending = t.dotBlendingEnabled, this.ddSeed = t.seed;\n\n    for (let s = 0; s < n; s++) {\n      const t = s >= i.length ? new e([0, 0, 0, 0]) : i[s].color;\n      p(this.ddColors, t, 4 * s);\n    }\n\n    for (let e = 0; e < 8; e++) this.ddActiveDots[e] = e < t.attributes.length ? 1 : 0;\n\n    p(this.ddBackgroundColor, t.backgroundColor);\n  }\n\n}\n\nexport { h as WGLRendererInfo };","map":{"version":3,"sources":["D:/Github/CUSP_DataBase/CUSP_DB/src/main/gis/node_modules/@arcgis/core/views/2d/engine/webgl/WGLRendererInfo.js"],"names":["e","unwrapOr","t","unwrap","i","isSome","s","isNone","a","pt2px","o","getMetersPerUnitForSR","l","meterIn","r","DOT_DENSITY_MAX_FIELDS","n","isDefined","v","isNumber","d","getWebGL1Capabilities","u","c","length","value","size","p","g","b","h","constructor","symbolLevels","vvColorValues","Float32Array","vvColors","vvOpacityValues","vvOpacities","vvSizeMinMaxValue","ddColors","ddBackgroundColor","ddActiveDots","_vvMaterialParameters","vvSizeEnabled","vvColorEnabled","vvRotationEnabled","vvRotationType","vvOpacityEnabled","getSizeVVFieldStops","_vvSizeFieldStops","type","levels","parseFloat","Math","abs","sizes","values","vvMaterialParameters","update","_vvInfo","_updateVisualVariables","vvRanges","setInfo","_updateEffects","_updateDotDensityInfo","getVariation","ddDotBlending","outsideLabelsVisible","oesTextureFloat","supportsTextureFloat","getVariationHash","excludedLabelsVisible","minMaxValue","minSize","maxSize","scale","stops","set","minDataValue","maxDataValue","scaleStops","vvSizeScaleStopsValue","unitValue","spatialReference","unit","vvSizeUnitValueToPixelsRatio","resolution","fieldStops","color","colors","opacity","opacities","rotation","attributes","ddDotValue","dotValue","ddDotScale","referenceScale","ddDotSize","dotSize","dotBlendingEnabled","ddSeed","seed","backgroundColor","WGLRendererInfo"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport e from\"../../../../Color.js\";import{unwrapOr as t,unwrap as i,isSome as s,isNone as a}from\"../../../../core/maybe.js\";import{pt2px as o}from\"../../../../core/screenUtils.js\";import{getMetersPerUnitForSR as l}from\"../../../../core/unitUtils.js\";import{meterIn as r}from\"../../../../renderers/support/lengthUtils.js\";import{DOT_DENSITY_MAX_FIELDS as n}from\"./definitions.js\";import{isDefined as v,isNumber as d}from\"./Utils.js\";import{getWebGL1Capabilities as u}from\"../../../webgl/capabilities.js\";function c(e,t){const i=t.length;if(e<t[0].value||1===i)return t[0].size;for(let s=1;s<i;s++)if(e<t[s].value){const i=(e-t[s-1].value)/(t[s].value-t[s-1].value);return t[s-1].size+i*(t[s].size-t[s-1].size)}return t[i-1].size}function p(e,t,i=0){if(a(t))return e[i+0]=0,e[i+1]=0,e[i+2]=0,void(e[i+3]=0);const{r:s,g:o,b:l,a:r}=t;e[i+0]=s*r/255,e[i+1]=o*r/255,e[i+2]=l*r/255,e[i+3]=r}class h{constructor(){this.symbolLevels=[],this.vvColorValues=new Float32Array(8),this.vvColors=new Float32Array(32),this.vvOpacityValues=new Float32Array(8),this.vvOpacities=new Float32Array(8),this.vvSizeMinMaxValue=new Float32Array(4),this.ddColors=new Float32Array(32),this.ddBackgroundColor=new Float32Array(4),this.ddActiveDots=new Float32Array(8),this._vvMaterialParameters={vvSizeEnabled:!1,vvColorEnabled:!1,vvRotationEnabled:!1,vvRotationType:\"geographic\",vvOpacityEnabled:!1}}getSizeVVFieldStops(e){const s=this._vvSizeFieldStops;switch(s.type){case\"static\":return s;case\"level-dependent\":return t(s.levels[e],(()=>{let t=1/0,a=0;for(const i in s.levels){const s=parseFloat(i),o=Math.abs(e-s);o<t&&(t=o,a=s)}if(t===1/0)return{sizes:new Float32Array([0,0,0,0,0,0]),values:new Float32Array([0,0,0,0,0,0])};const o=2**((e-a)/2),l=i(s.levels[a]),r=new Float32Array(l.values);return r[2]*=o,r[3]*=o,{sizes:i(l.sizes),values:r}}))}}get vvMaterialParameters(){return this._vvMaterialParameters}update(e){s(this._vvInfo)&&this._updateVisualVariables(this._vvInfo.vvRanges,e)}setInfo(e,t,i){if(this._updateEffects(i),this._vvInfo=t,\"dot-density\"===e.type)this._updateDotDensityInfo(e)}getVariation(){return{ddDotBlending:this.ddDotBlending,outsideLabelsVisible:this.outsideLabelsVisible,oesTextureFloat:u().supportsTextureFloat}}getVariationHash(){return(this.ddDotBlending?1:0)|(this.outsideLabelsVisible?1:0)<<1}_updateEffects(e){s(e)?this.outsideLabelsVisible=e.excludedLabelsVisible:this.outsideLabelsVisible=!1}_updateVisualVariables(e,t){const i=this._vvMaterialParameters;if(i.vvOpacityEnabled=!1,i.vvSizeEnabled=!1,i.vvColorEnabled=!1,i.vvRotationEnabled=!1,!e)return;const s=e.size;if(s){if(i.vvSizeEnabled=!0,s.minMaxValue){const e=s.minMaxValue;let i,a;if(v(e.minSize)&&v(e.maxSize))if(d(e.minSize)&&d(e.maxSize))i=o(e.minSize),a=o(e.maxSize);else{const s=t.scale;i=o(c(s,e.minSize.stops)),a=o(c(s,e.maxSize.stops))}this.vvSizeMinMaxValue.set([e.minDataValue,e.maxDataValue,i,a])}if(s.scaleStops&&(this.vvSizeScaleStopsValue=o(c(t.scale,s.scaleStops.stops))),s.unitValue){const e=l(t.spatialReference)/r[s.unitValue.unit];this.vvSizeUnitValueToPixelsRatio=e/t.resolution}s.fieldStops&&(this._vvSizeFieldStops=s.fieldStops)}const a=e.color;a&&(i.vvColorEnabled=!0,this.vvColorValues.set(a.values),this.vvColors.set(a.colors));const n=e.opacity;n&&(i.vvOpacityEnabled=!0,this.vvOpacityValues.set(n.values),this.vvOpacities.set(n.opacities));const u=e.rotation;u&&(i.vvRotationEnabled=!0,i.vvRotationType=u.type)}_updateDotDensityInfo(t){const i=t.attributes;this.ddDotValue=t.dotValue,this.ddDotScale=t.referenceScale,this.ddDotSize=t.dotSize,this.ddDotBlending=t.dotBlendingEnabled,this.ddSeed=t.seed;for(let s=0;s<n;s++){const t=s>=i.length?new e([0,0,0,0]):i[s].color;p(this.ddColors,t,4*s)}for(let e=0;e<8;e++)this.ddActiveDots[e]=e<t.attributes.length?1:0;p(this.ddBackgroundColor,t.backgroundColor)}}export{h as WGLRendererInfo};\n"]},"metadata":{},"sourceType":"module"}