{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../chunks/tslib.es6.js\";\nimport t from \"../../core/Accessor.js\";\nimport s from \"../../core/Handles.js\";\nimport r from \"../../core/Logger.js\";\nimport { unwrapOr as i, removeMaybe as a, isNone as u, isSome as o } from \"../../core/maybe.js\";\nimport n from \"../../core/PerformanceSampler.js\";\nimport h from \"../../core/PooledArray.js\";\nimport { isAborted as _, createAbortError as d, when as l } from \"../../core/promiseUtils.js\";\nimport { watch as E, initial as c, when as T } from \"../../core/reactiveUtils.js\";\nimport { Milliseconds as m } from \"../../core/time.js\";\nimport { property as I } from \"../../core/accessorSupport/decorators/property.js\";\nimport \"../../core/arrayUtils.js\";\nimport \"../../core/has.js\";\nimport \"../../core/accessorSupport/ensureType.js\";\nimport { subclass as g } from \"../../core/accessorSupport/decorators/subclass.js\";\nimport { PromiseQueue as p } from \"../../layers/support/PromiseQueue.js\";\nimport R from \"./debugFlags.js\";\nconst A = r.getLogger(\"esri.views.support.Scheduler\");\n\nfunction f(e) {\n  return new D.Scheduler({\n    nowFunc: e\n  });\n}\n\nvar L;\n!function (e) {\n  e.RESOURCE_CONTROLLER = \"schedule\", e.SLIDE = \"slide\", e.STREAM_DATA_LOADER = \"stream loader\", e.ELEVATION_QUERY = \"elevation query\", e.TERRAIN_SURFACE = \"terrain\", e.SURFACE_GEOMETRY_UPDATES = \"surface geometry updates\", e.GRAPHICS_CORE = \"Graphics3D\", e.I3S_CONTROLLER = \"I3S\", e.POINT_CLOUD_LAYER = \"point cloud\", e.FEATURE_TILE_FETCHER = \"feature fetcher\", e.OVERLAY = \"overlay\", e.STAGE = \"stage\", e.GRAPHICS_DECONFLICTOR = \"graphics deconflictor\", e.FILTER_VISIBILITY = \"Graphics3D filter visibility\", e.SCALE_VISIBILITY = \"Graphics3D scale visibility\", e.FRUSTUM_VISIBILITY = \"Graphics3D frustum visibility\", e.POINT_OF_INTEREST_FREQUENT = \"POI frequent\", e.POINT_OF_INTEREST_INFREQUENT = \"POI infrequent\", e.LABELER = \"labeler\", e.FEATURE_QUERY_ENGINE = \"feature query\", e.FEATURE_TILE_TREE = \"feature tile tree\", e.FEATURE_TILE_TREE_ACTIVE = \"fast feature tile tree\", e.ELEVATION_ALIGNMENT = \"elevation alignment\", e.TEXT_TEXTURE_ATLAS = \"text texture atlas\", e.TEXTURE_UNLOAD = \"texture unload\", e.LINE_OF_SIGHT_TOOL = \"line of sight tool\", e.LINE_OF_SIGHT_TOOL_INTERACTIVE = \"interactive line of sight tool\", e.ELEVATION_PROFILE = \"elevation profile\", e.SNAPPING = \"snapping\", e.SHADOW_ACCUMULATOR = \"shadow accumulator\", e.CLOUDS_GENERATOR = \"cloud generator\", e[e.TEST_PRIO = 1] = \"TEST_PRIO\";\n}(L || (L = {}));\nconst S = 0,\n      b = new Map([[L.RESOURCE_CONTROLLER, S], [L.SLIDE, S], [L.STREAM_DATA_LOADER, S], [L.ELEVATION_QUERY, S], [L.TERRAIN_SURFACE, 1], [L.SURFACE_GEOMETRY_UPDATES, 1], [L.GRAPHICS_CORE, 2], [L.I3S_CONTROLLER, 2], [L.POINT_CLOUD_LAYER, 2], [L.FEATURE_TILE_FETCHER, 2], [L.OVERLAY, 4], [L.STAGE, 4], [L.GRAPHICS_DECONFLICTOR, 4], [L.FILTER_VISIBILITY, 4], [L.SCALE_VISIBILITY, 4], [L.FRUSTUM_VISIBILITY, 4], [L.POINT_OF_INTEREST_FREQUENT, 6], [L.POINT_OF_INTEREST_INFREQUENT, 30], [L.LABELER, 8], [L.FEATURE_QUERY_ENGINE, 8], [L.FEATURE_TILE_TREE, 16], [L.FEATURE_TILE_TREE_ACTIVE, S], [L.ELEVATION_ALIGNMENT, 12], [L.TEXT_TEXTURE_ATLAS, 12], [L.CLOUDS_GENERATOR, 12], [L.TEXTURE_UNLOAD, 12], [L.LINE_OF_SIGHT_TOOL, 16], [L.LINE_OF_SIGHT_TOOL_INTERACTIVE, S], [L.SNAPPING, S], [L.SHADOW_ACCUMULATOR, 30]]);\n\nfunction k(e) {\n  return b.has(e) ? b.get(e) : \"number\" == typeof e ? e : 1;\n}\n\nvar N;\n!function (e) {\n  e[e.ANIMATING = 0] = \"ANIMATING\", e[e.INTERACTING = 1] = \"INTERACTING\", e[e.IDLE = 2] = \"IDLE\";\n}(N || (N = {}));\nconst O = m(6.5),\n      U = m(1),\n      P = m(30),\n      F = m(1e3 / 30),\n      y = m(100),\n      C = .9;\nvar D, w;\n!function (r) {\n  let _ = class extends t {\n    constructor(e) {\n      super(e), this.updating = !0, this._microTaskQueued = !1, this.performanceInfo = {\n        total: new n(\"total\"),\n        tasks: new Map()\n      }, this._frameTaskTimes = new Map(), this._budget = null, this._state = N.INTERACTING, this._tasks = new h(), this._runQueue = new h(), this._load = 0, this._idleStateCallbacks = new h(), this._idleUpdatesStartFired = !1, this._maxReschedule = M, this._forceTask = !1, this._debug = !1, this._debugHandle = E(() => R.SCHEDULER_LOG_SLOW_TASKS, e => this._debug = e, c), this._budget = new l(e.nowFunc);\n\n      for (const r of Object.keys(L)) this.performanceInfo.tasks.set(L[r], new n(L[r]));\n\n      let t;\n      const s = this;\n      this._test = {\n        get state() {\n          return i(t, s._state);\n        },\n\n        set state(e) {\n          t = e;\n        },\n\n        FRAME_SAFETY_BUDGET: O,\n        INTERACTING_BUDGET: F,\n        IDLE_BUDGET: y,\n\n        get budget() {\n          return s._budget.budget;\n        },\n\n        usedBudget: 0,\n        setBudget: e => s._budget = e,\n        updateTask: e => this._updateTask(e),\n        getState: e => this._getState(e),\n        getRuntime: e => this._getRuntime(e),\n        frameTaskTimes: this._frameTaskTimes,\n        resetRuntimes: () => this._resetRuntimes(),\n        getRunning: () => this._getRunning()\n      };\n    }\n\n    destroy() {\n      this._tasks.toArray().forEach(e => e.remove()), this._tasks.clear(), a(this._debugHandle), this._microTaskQueued = !1, this.updating = !1;\n    }\n\n    activate() {\n      this._budget.done || this._microTaskQueued || (this._microTaskQueued = !0, queueMicrotask(() => {\n        this._microTaskQueued && (this._microTaskQueued = !1, this._budget.done || (this._maxReschedule = M, this._schedule(), this.frame()));\n      }));\n    }\n\n    registerTask(e, t) {\n      const s = k(e),\n            r = new d(this, e, t, s);\n      return this._tasks.push(r), this.performanceInfo.tasks.has(e) || this.performanceInfo.tasks.set(e, new n(e)), r;\n    }\n\n    registerIdleStateCallbacks(e, t) {\n      const s = {\n        idleBegin: e,\n        idleEnd: t\n      };\n      this._idleStateCallbacks.push(s), this.state === N.IDLE && this._idleUpdatesStartFired && s.idleBegin();\n      const r = this;\n      return {\n        remove: () => this._removeIdleStateCallbacks(s),\n\n        set idleBegin(e) {\n          r._idleUpdatesStartFired && (s.idleEnd(), r._state === N.IDLE && e()), s.idleBegin = e;\n        },\n\n        set idleEnd(e) {\n          s.idleEnd = e;\n        }\n\n      };\n    }\n\n    get now() {\n      return this.nowFunc();\n    }\n\n    get load() {\n      return this._load;\n    }\n\n    set state(e) {\n      this._state !== e && (this._state = e, this.state !== N.IDLE && this._idleUpdatesStartFired && (this._idleUpdatesStartFired = !1, this._idleStateCallbacks.forAll(e => e.idleEnd())));\n    }\n\n    get state() {\n      return u(this._test.state) ? this._state : this._test.state;\n    }\n\n    updateBudget(e) {\n      this._test.usedBudget = 0;\n      let t = O,\n          s = e.frameDuration,\n          r = U;\n\n      switch (this.state) {\n        case N.IDLE:\n          t = m(0), s = m(Math.max(y, e.frameDuration)), r = P;\n          break;\n\n        case N.INTERACTING:\n          s = m(Math.max(F, e.frameDuration));\n\n        case N.ANIMATING:\n      }\n\n      return s = m(s - e.elapsedFrameTime - t), this.state !== N.IDLE && s < U && !this._forceTask ? (this._forceTask = !0, !1) : (s = m(Math.max(s, r)), this._budget.reset(s, this.state), this._maxReschedule = M, this._updateLoad(), this._schedule());\n    }\n\n    frame() {\n      switch (this._forceTask = !1, this._microTaskQueued = !1, this.state) {\n        case N.IDLE:\n          this._idleUpdatesStartFired || (this._idleUpdatesStartFired = !0, this._idleStateCallbacks.forAll(e => e.idleBegin())), this._runIdle();\n          break;\n\n        case N.INTERACTING:\n          this._runInteracting();\n\n          break;\n\n        default:\n          this._runAnimating();\n\n      }\n\n      this._test.usedBudget = this._budget.elapsed;\n    }\n\n    stopFrame() {\n      this._budget.reset(m(0), this._state), this._budget.madeProgress();\n    }\n\n    _removeIdleStateCallbacks(e) {\n      this._idleUpdatesStartFired && e.idleEnd(), this._idleStateCallbacks.removeUnordered(e);\n    }\n\n    removeTask(e) {\n      this._tasks.removeUnordered(e), this._runQueue.removeUnordered(e);\n    }\n\n    _updateTask(e) {\n      this._tasks.forAll(t => {\n        t.name === e && t.setPriority(e);\n      });\n    }\n\n    _getState(e) {\n      if (this._runQueue.some(t => t.name === e)) return w.SCHEDULED;\n      let t = w.IDLE;\n      return this._tasks.forAll(s => {\n        s.name === e && s.needsUpdate && (s.schedulePriority <= 1 ? t = w.READY : t !== w.READY && (t = w.WAITING));\n      }), t;\n    }\n\n    _getRuntime(e) {\n      let t = 0;\n      return this._tasks.forAll(s => {\n        s.name === e && (t += s.runtime);\n      }), t;\n    }\n\n    _resetRuntimes() {\n      this._tasks.forAll(e => e.runtime = 0);\n    }\n\n    _getRunning() {\n      const e = new Map();\n      if (this._tasks.forAll(t => {\n        t.needsUpdate && e.set(t.name, (e.get(t.name) || 0) + 1);\n      }), 0 === e.size) return null;\n      let t = \"\";\n      return e.forEach((e, s) => {\n        t += e > 1 ? ` ${e}x ${s}` : ` ${s}`;\n      }), t;\n    }\n\n    _runIdle() {\n      this._run();\n    }\n\n    _runInteracting() {\n      this._run();\n    }\n\n    _runAnimating() {\n      this._run();\n    }\n\n    _updateLoad() {\n      const e = this._tasks.reduce((e, t) => t.needsUpdate ? ++e : e, 0);\n\n      this._load = this._load * C + e * (1 - C);\n    }\n\n    _schedule() {\n      if (this._maxReschedule <= 0) return !1;\n\n      for (this._runQueue.filterInPlace(e => !!e.needsUpdate || (e.schedulePriority = e.basePriority, !1)), this._tasks.forAll(e => {\n        e.basePriority === S && e.needsUpdate && !this._runQueue.some(t => t === e) && this._runQueue.unshift(e);\n      }); 0 === this._runQueue.length;) {\n        let e = !1,\n            t = 0;\n        if (this._tasks.forAll(s => {\n          if (s.needsUpdate && 0 !== s.schedulePriority && s.basePriority !== S) if (e = !0, t = Math.max(t, s.basePriority), 1 === s.schedulePriority) s.schedulePriority = 0, this._runQueue.push(s);else --s.schedulePriority;\n        }), !e) return this.updating = !1, !1;\n        this._maxReschedule === M && (this._maxReschedule = t), --this._maxReschedule;\n      }\n\n      return this.updating = !0, !0;\n    }\n\n    _run() {\n      const e = this._budget.now();\n\n      this._startFrameTaskTimes();\n\n      do {\n        for (; this._runQueue.length > 0;) {\n          const s = this._budget.now(),\n                r = this._runQueue.pop();\n\n          this._budget.resetProgress();\n\n          try {\n            r.task.runTask(this._budget);\n          } catch (t) {\n            A.error(`Exception in task \"${r.name}\"`, t);\n          }\n\n          r.schedulePriority = r.basePriority;\n          const i = this._budget.now() - s;\n          if (r.runtime += i, this._frameTaskTimes.set(r.priority, this._frameTaskTimes.get(r.priority) + i), this._debug && this._budget.elapsed > 2 * this._budget.budget && console.log(\"Task\", r.name, \"used\", this._budget.elapsed, \"of max\", this._budget.budget, \"ms\"), this._budget.remaining <= 0) return this.updating = this._tasks.some(e => e.needsUpdate), void this._recordFrameTaskTimes(this._budget.now() - e);\n        }\n      } while (this._schedule());\n\n      this.updating = this._tasks.some(e => e.needsUpdate), this._recordFrameTaskTimes(this._budget.now() - e);\n    }\n\n    _startFrameTaskTimes() {\n      for (const e of Object.keys(L)) this._frameTaskTimes.set(L[e], 0);\n    }\n\n    _recordFrameTaskTimes(e) {\n      this._frameTaskTimes.forEach((e, t) => this.performanceInfo.tasks.get(t).record(e)), this.performanceInfo.total.record(e);\n    }\n\n    get test() {\n      return this._test;\n    }\n\n  };\n\n  e([I()], _.prototype, \"updating\", void 0), e([I()], _.prototype, \"nowFunc\", void 0), _ = e([g(\"esri.views.support.Scheduler\")], _), r.Scheduler = _;\n  let d = class extends t {\n    constructor(e, t, r, i) {\n      super({}), this._scheduler = e, this.name = t, this._basePriority = i, this.runtime = 0, this._queue = new p(), this._handles = new s(), this.schedulePriority = this._basePriority, this.task = o(r) ? r : this._queue, this._handles.add(T(() => this.task.running, () => e.activate()));\n    }\n\n    get updating() {\n      return this._queue.running;\n    }\n\n    normalizeCtorArgs() {\n      return {};\n    }\n\n    remove() {\n      this.processQueue(G), this._scheduler.removeTask(this), this.schedule = Q.schedule, this.reschedule = Q.reschedule, this._handles.destroy();\n    }\n\n    get basePriority() {\n      return this._basePriority;\n    }\n\n    setPriority(e) {\n      this.name = e;\n      const t = k(e);\n      this._basePriority !== S && 0 === this.schedulePriority || (this.schedulePriority = t), this._basePriority = t;\n    }\n\n    get priority() {\n      return this.name;\n    }\n\n    set priority(e) {\n      this.setPriority(e);\n    }\n\n    get needsUpdate() {\n      return this.updating || this.task.running;\n    }\n\n    schedule(e, t, s) {\n      return this._queue.push(e, t, s);\n    }\n\n    reschedule(e, t, s) {\n      return this._queue.unshift(e, t, s);\n    }\n\n    processQueue(e) {\n      this._queue.runTask(e);\n    }\n\n  };\n  e([I({\n    constructOnly: !0\n  })], d.prototype, \"task\", void 0), e([I({\n    readOnly: !0\n  })], d.prototype, \"updating\", null), d = e([g(\"esri.views.support.SchedulerTask\")], d);\n\n  class l {\n    constructor(e) {\n      this.now = e, this._begin = 0, this._budget = 0, this._state = N.IDLE, this._didWork = !1, this._enabled = !0;\n    }\n\n    run(e) {\n      return !this.done && (!0 === e() && (this._didWork = !0), !0);\n    }\n\n    get done() {\n      return this._didWork && this.elapsed >= this._budget && this._enabled;\n    }\n\n    get budget() {\n      return this._budget;\n    }\n\n    madeProgress() {\n      this._didWork = !0;\n    }\n\n    get state() {\n      return this._state;\n    }\n\n    get enabled() {\n      return this._enabled;\n    }\n\n    set enabled(e) {\n      this._enabled = e;\n    }\n\n    reset(e, t) {\n      this._begin = this.now(), this._budget = e, this._state = t, this._didWork = !1;\n    }\n\n    get remaining() {\n      return Math.max(this._budget - this.elapsed, 0);\n    }\n\n    get elapsed() {\n      return this.now() - this._begin;\n    }\n\n    resetProgress() {\n      this._didWork = !1;\n    }\n\n    get hasProgressed() {\n      return this._didWork;\n    }\n\n  }\n\n  r.Budget = l;\n}(D || (D = {})), function (e) {\n  e.SCHEDULED = \"s\", e.READY = \"r\", e.WAITING = \"w\", e.IDLE = \"i\";\n}(w || (w = {}));\n\nconst G = (() => {\n  const e = new D.Budget(() => performance.now());\n  return e.enabled = !1, e;\n})();\n\nclass v {\n  remove() {}\n\n  processQueue() {}\n\n  schedule(e, t, s) {\n    try {\n      if (_(t)) {\n        const e = d();\n        return s ? Promise.resolve(s(e)) : Promise.reject(e);\n      }\n\n      return l(e(G));\n    } catch (r) {\n      return Promise.reject(r);\n    }\n  }\n\n  reschedule(e, t, s) {\n    return this.schedule(e, t, s);\n  }\n\n}\n\nconst Q = new v(),\n      M = Number.MAX_SAFE_INTEGER;\nexport { Q as ImmediateTask, N as State, L as TaskPriority, w as TaskState, k as getTaskPriority, f as newScheduler, G as noBudget, b as taskPriorities };","map":{"version":3,"sources":["D:/Github/CUSP_DataBase/CUSP_DB/src/main/gis/node_modules/@arcgis/core/views/support/Scheduler.js"],"names":["_","e","t","s","r","unwrapOr","i","removeMaybe","a","isNone","u","isSome","o","n","h","isAborted","createAbortError","d","when","l","watch","E","initial","c","T","Milliseconds","m","property","I","subclass","g","PromiseQueue","p","R","A","getLogger","f","D","Scheduler","nowFunc","L","RESOURCE_CONTROLLER","SLIDE","STREAM_DATA_LOADER","ELEVATION_QUERY","TERRAIN_SURFACE","SURFACE_GEOMETRY_UPDATES","GRAPHICS_CORE","I3S_CONTROLLER","POINT_CLOUD_LAYER","FEATURE_TILE_FETCHER","OVERLAY","STAGE","GRAPHICS_DECONFLICTOR","FILTER_VISIBILITY","SCALE_VISIBILITY","FRUSTUM_VISIBILITY","POINT_OF_INTEREST_FREQUENT","POINT_OF_INTEREST_INFREQUENT","LABELER","FEATURE_QUERY_ENGINE","FEATURE_TILE_TREE","FEATURE_TILE_TREE_ACTIVE","ELEVATION_ALIGNMENT","TEXT_TEXTURE_ATLAS","TEXTURE_UNLOAD","LINE_OF_SIGHT_TOOL","LINE_OF_SIGHT_TOOL_INTERACTIVE","ELEVATION_PROFILE","SNAPPING","SHADOW_ACCUMULATOR","CLOUDS_GENERATOR","TEST_PRIO","S","b","Map","k","has","get","N","ANIMATING","INTERACTING","IDLE","O","U","P","F","y","C","w","constructor","updating","_microTaskQueued","performanceInfo","total","tasks","_frameTaskTimes","_budget","_state","_tasks","_runQueue","_load","_idleStateCallbacks","_idleUpdatesStartFired","_maxReschedule","M","_forceTask","_debug","_debugHandle","SCHEDULER_LOG_SLOW_TASKS","Object","keys","set","_test","state","FRAME_SAFETY_BUDGET","INTERACTING_BUDGET","IDLE_BUDGET","budget","usedBudget","setBudget","updateTask","_updateTask","getState","_getState","getRuntime","_getRuntime","frameTaskTimes","resetRuntimes","_resetRuntimes","getRunning","_getRunning","destroy","toArray","forEach","remove","clear","activate","done","queueMicrotask","_schedule","frame","registerTask","push","registerIdleStateCallbacks","idleBegin","idleEnd","_removeIdleStateCallbacks","now","load","forAll","updateBudget","frameDuration","Math","max","elapsedFrameTime","reset","_updateLoad","_runIdle","_runInteracting","_runAnimating","elapsed","stopFrame","madeProgress","removeUnordered","removeTask","name","setPriority","some","SCHEDULED","needsUpdate","schedulePriority","READY","WAITING","runtime","size","_run","reduce","filterInPlace","basePriority","unshift","length","_startFrameTaskTimes","pop","resetProgress","task","runTask","error","priority","console","log","remaining","_recordFrameTaskTimes","record","test","prototype","_scheduler","_basePriority","_queue","_handles","add","running","normalizeCtorArgs","processQueue","G","schedule","Q","reschedule","constructOnly","readOnly","_begin","_didWork","_enabled","run","enabled","hasProgressed","Budget","performance","v","Promise","resolve","reject","Number","MAX_SAFE_INTEGER","ImmediateTask","State","TaskPriority","TaskState","getTaskPriority","newScheduler","noBudget","taskPriorities"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import t from\"../../core/Accessor.js\";import s from\"../../core/Handles.js\";import r from\"../../core/Logger.js\";import{unwrapOr as i,removeMaybe as a,isNone as u,isSome as o}from\"../../core/maybe.js\";import n from\"../../core/PerformanceSampler.js\";import h from\"../../core/PooledArray.js\";import{isAborted as _,createAbortError as d,when as l}from\"../../core/promiseUtils.js\";import{watch as E,initial as c,when as T}from\"../../core/reactiveUtils.js\";import{Milliseconds as m}from\"../../core/time.js\";import{property as I}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/arrayUtils.js\";import\"../../core/has.js\";import\"../../core/accessorSupport/ensureType.js\";import{subclass as g}from\"../../core/accessorSupport/decorators/subclass.js\";import{PromiseQueue as p}from\"../../layers/support/PromiseQueue.js\";import R from\"./debugFlags.js\";const A=r.getLogger(\"esri.views.support.Scheduler\");function f(e){return new D.Scheduler({nowFunc:e})}var L;!function(e){e.RESOURCE_CONTROLLER=\"schedule\",e.SLIDE=\"slide\",e.STREAM_DATA_LOADER=\"stream loader\",e.ELEVATION_QUERY=\"elevation query\",e.TERRAIN_SURFACE=\"terrain\",e.SURFACE_GEOMETRY_UPDATES=\"surface geometry updates\",e.GRAPHICS_CORE=\"Graphics3D\",e.I3S_CONTROLLER=\"I3S\",e.POINT_CLOUD_LAYER=\"point cloud\",e.FEATURE_TILE_FETCHER=\"feature fetcher\",e.OVERLAY=\"overlay\",e.STAGE=\"stage\",e.GRAPHICS_DECONFLICTOR=\"graphics deconflictor\",e.FILTER_VISIBILITY=\"Graphics3D filter visibility\",e.SCALE_VISIBILITY=\"Graphics3D scale visibility\",e.FRUSTUM_VISIBILITY=\"Graphics3D frustum visibility\",e.POINT_OF_INTEREST_FREQUENT=\"POI frequent\",e.POINT_OF_INTEREST_INFREQUENT=\"POI infrequent\",e.LABELER=\"labeler\",e.FEATURE_QUERY_ENGINE=\"feature query\",e.FEATURE_TILE_TREE=\"feature tile tree\",e.FEATURE_TILE_TREE_ACTIVE=\"fast feature tile tree\",e.ELEVATION_ALIGNMENT=\"elevation alignment\",e.TEXT_TEXTURE_ATLAS=\"text texture atlas\",e.TEXTURE_UNLOAD=\"texture unload\",e.LINE_OF_SIGHT_TOOL=\"line of sight tool\",e.LINE_OF_SIGHT_TOOL_INTERACTIVE=\"interactive line of sight tool\",e.ELEVATION_PROFILE=\"elevation profile\",e.SNAPPING=\"snapping\",e.SHADOW_ACCUMULATOR=\"shadow accumulator\",e.CLOUDS_GENERATOR=\"cloud generator\",e[e.TEST_PRIO=1]=\"TEST_PRIO\"}(L||(L={}));const S=0,b=new Map([[L.RESOURCE_CONTROLLER,S],[L.SLIDE,S],[L.STREAM_DATA_LOADER,S],[L.ELEVATION_QUERY,S],[L.TERRAIN_SURFACE,1],[L.SURFACE_GEOMETRY_UPDATES,1],[L.GRAPHICS_CORE,2],[L.I3S_CONTROLLER,2],[L.POINT_CLOUD_LAYER,2],[L.FEATURE_TILE_FETCHER,2],[L.OVERLAY,4],[L.STAGE,4],[L.GRAPHICS_DECONFLICTOR,4],[L.FILTER_VISIBILITY,4],[L.SCALE_VISIBILITY,4],[L.FRUSTUM_VISIBILITY,4],[L.POINT_OF_INTEREST_FREQUENT,6],[L.POINT_OF_INTEREST_INFREQUENT,30],[L.LABELER,8],[L.FEATURE_QUERY_ENGINE,8],[L.FEATURE_TILE_TREE,16],[L.FEATURE_TILE_TREE_ACTIVE,S],[L.ELEVATION_ALIGNMENT,12],[L.TEXT_TEXTURE_ATLAS,12],[L.CLOUDS_GENERATOR,12],[L.TEXTURE_UNLOAD,12],[L.LINE_OF_SIGHT_TOOL,16],[L.LINE_OF_SIGHT_TOOL_INTERACTIVE,S],[L.SNAPPING,S],[L.SHADOW_ACCUMULATOR,30]]);function k(e){return b.has(e)?b.get(e):\"number\"==typeof e?e:1}var N;!function(e){e[e.ANIMATING=0]=\"ANIMATING\",e[e.INTERACTING=1]=\"INTERACTING\",e[e.IDLE=2]=\"IDLE\"}(N||(N={}));const O=m(6.5),U=m(1),P=m(30),F=m(1e3/30),y=m(100),C=.9;var D,w;!function(r){let _=class extends t{constructor(e){super(e),this.updating=!0,this._microTaskQueued=!1,this.performanceInfo={total:new n(\"total\"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=null,this._state=N.INTERACTING,this._tasks=new h,this._runQueue=new h,this._load=0,this._idleStateCallbacks=new h,this._idleUpdatesStartFired=!1,this._maxReschedule=M,this._forceTask=!1,this._debug=!1,this._debugHandle=E((()=>R.SCHEDULER_LOG_SLOW_TASKS),(e=>this._debug=e),c),this._budget=new l(e.nowFunc);for(const r of Object.keys(L))this.performanceInfo.tasks.set(L[r],new n(L[r]));let t;const s=this;this._test={get state(){return i(t,s._state)},set state(e){t=e},FRAME_SAFETY_BUDGET:O,INTERACTING_BUDGET:F,IDLE_BUDGET:y,get budget(){return s._budget.budget},usedBudget:0,setBudget:e=>s._budget=e,updateTask:e=>this._updateTask(e),getState:e=>this._getState(e),getRuntime:e=>this._getRuntime(e),frameTaskTimes:this._frameTaskTimes,resetRuntimes:()=>this._resetRuntimes(),getRunning:()=>this._getRunning()}}destroy(){this._tasks.toArray().forEach((e=>e.remove())),this._tasks.clear(),a(this._debugHandle),this._microTaskQueued=!1,this.updating=!1}activate(){this._budget.done||this._microTaskQueued||(this._microTaskQueued=!0,queueMicrotask((()=>{this._microTaskQueued&&(this._microTaskQueued=!1,this._budget.done||(this._maxReschedule=M,this._schedule(),this.frame()))})))}registerTask(e,t){const s=k(e),r=new d(this,e,t,s);return this._tasks.push(r),this.performanceInfo.tasks.has(e)||this.performanceInfo.tasks.set(e,new n(e)),r}registerIdleStateCallbacks(e,t){const s={idleBegin:e,idleEnd:t};this._idleStateCallbacks.push(s),this.state===N.IDLE&&this._idleUpdatesStartFired&&s.idleBegin();const r=this;return{remove:()=>this._removeIdleStateCallbacks(s),set idleBegin(e){r._idleUpdatesStartFired&&(s.idleEnd(),r._state===N.IDLE&&e()),s.idleBegin=e},set idleEnd(e){s.idleEnd=e}}}get now(){return this.nowFunc()}get load(){return this._load}set state(e){this._state!==e&&(this._state=e,this.state!==N.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll((e=>e.idleEnd()))))}get state(){return u(this._test.state)?this._state:this._test.state}updateBudget(e){this._test.usedBudget=0;let t=O,s=e.frameDuration,r=U;switch(this.state){case N.IDLE:t=m(0),s=m(Math.max(y,e.frameDuration)),r=P;break;case N.INTERACTING:s=m(Math.max(F,e.frameDuration));case N.ANIMATING:}return s=m(s-e.elapsedFrameTime-t),this.state!==N.IDLE&&s<U&&!this._forceTask?(this._forceTask=!0,!1):(s=m(Math.max(s,r)),this._budget.reset(s,this.state),this._maxReschedule=M,this._updateLoad(),this._schedule())}frame(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case N.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll((e=>e.idleBegin()))),this._runIdle();break;case N.INTERACTING:this._runInteracting();break;default:this._runAnimating()}this._test.usedBudget=this._budget.elapsed}stopFrame(){this._budget.reset(m(0),this._state),this._budget.madeProgress()}_removeIdleStateCallbacks(e){this._idleUpdatesStartFired&&e.idleEnd(),this._idleStateCallbacks.removeUnordered(e)}removeTask(e){this._tasks.removeUnordered(e),this._runQueue.removeUnordered(e)}_updateTask(e){this._tasks.forAll((t=>{t.name===e&&t.setPriority(e)}))}_getState(e){if(this._runQueue.some((t=>t.name===e)))return w.SCHEDULED;let t=w.IDLE;return this._tasks.forAll((s=>{s.name===e&&s.needsUpdate&&(s.schedulePriority<=1?t=w.READY:t!==w.READY&&(t=w.WAITING))})),t}_getRuntime(e){let t=0;return this._tasks.forAll((s=>{s.name===e&&(t+=s.runtime)})),t}_resetRuntimes(){this._tasks.forAll((e=>e.runtime=0))}_getRunning(){const e=new Map;if(this._tasks.forAll((t=>{t.needsUpdate&&e.set(t.name,(e.get(t.name)||0)+1)})),0===e.size)return null;let t=\"\";return e.forEach(((e,s)=>{t+=e>1?` ${e}x ${s}`:` ${s}`})),t}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const e=this._tasks.reduce(((e,t)=>t.needsUpdate?++e:e),0);this._load=this._load*C+e*(1-C)}_schedule(){if(this._maxReschedule<=0)return!1;for(this._runQueue.filterInPlace((e=>!!e.needsUpdate||(e.schedulePriority=e.basePriority,!1))),this._tasks.forAll((e=>{e.basePriority===S&&e.needsUpdate&&!this._runQueue.some((t=>t===e))&&this._runQueue.unshift(e)}));0===this._runQueue.length;){let e=!1,t=0;if(this._tasks.forAll((s=>{if(s.needsUpdate&&0!==s.schedulePriority&&s.basePriority!==S)if(e=!0,t=Math.max(t,s.basePriority),1===s.schedulePriority)s.schedulePriority=0,this._runQueue.push(s);else--s.schedulePriority})),!e)return this.updating=!1,!1;this._maxReschedule===M&&(this._maxReschedule=t),--this._maxReschedule}return this.updating=!0,!0}_run(){const e=this._budget.now();this._startFrameTaskTimes();do{for(;this._runQueue.length>0;){const s=this._budget.now(),r=this._runQueue.pop();this._budget.resetProgress();try{r.task.runTask(this._budget)}catch(t){A.error(`Exception in task \"${r.name}\"`,t)}r.schedulePriority=r.basePriority;const i=this._budget.now()-s;if(r.runtime+=i,this._frameTaskTimes.set(r.priority,this._frameTaskTimes.get(r.priority)+i),this._debug&&this._budget.elapsed>2*this._budget.budget&&console.log(\"Task\",r.name,\"used\",this._budget.elapsed,\"of max\",this._budget.budget,\"ms\"),this._budget.remaining<=0)return this.updating=this._tasks.some((e=>e.needsUpdate)),void this._recordFrameTaskTimes(this._budget.now()-e)}}while(this._schedule());this.updating=this._tasks.some((e=>e.needsUpdate)),this._recordFrameTaskTimes(this._budget.now()-e)}_startFrameTaskTimes(){for(const e of Object.keys(L))this._frameTaskTimes.set(L[e],0)}_recordFrameTaskTimes(e){this._frameTaskTimes.forEach(((e,t)=>this.performanceInfo.tasks.get(t).record(e))),this.performanceInfo.total.record(e)}get test(){return this._test}};e([I()],_.prototype,\"updating\",void 0),e([I()],_.prototype,\"nowFunc\",void 0),_=e([g(\"esri.views.support.Scheduler\")],_),r.Scheduler=_;let d=class extends t{constructor(e,t,r,i){super({}),this._scheduler=e,this.name=t,this._basePriority=i,this.runtime=0,this._queue=new p,this._handles=new s,this.schedulePriority=this._basePriority,this.task=o(r)?r:this._queue,this._handles.add(T((()=>this.task.running),(()=>e.activate())))}get updating(){return this._queue.running}normalizeCtorArgs(){return{}}remove(){this.processQueue(G),this._scheduler.removeTask(this),this.schedule=Q.schedule,this.reschedule=Q.reschedule,this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(e){this.name=e;const t=k(e);this._basePriority!==S&&0===this.schedulePriority||(this.schedulePriority=t),this._basePriority=t}get priority(){return this.name}set priority(e){this.setPriority(e)}get needsUpdate(){return this.updating||this.task.running}schedule(e,t,s){return this._queue.push(e,t,s)}reschedule(e,t,s){return this._queue.unshift(e,t,s)}processQueue(e){this._queue.runTask(e)}};e([I({constructOnly:!0})],d.prototype,\"task\",void 0),e([I({readOnly:!0})],d.prototype,\"updating\",null),d=e([g(\"esri.views.support.SchedulerTask\")],d);class l{constructor(e){this.now=e,this._begin=0,this._budget=0,this._state=N.IDLE,this._didWork=!1,this._enabled=!0}run(e){return!this.done&&(!0===e()&&(this._didWork=!0),!0)}get done(){return this._didWork&&this.elapsed>=this._budget&&this._enabled}get budget(){return this._budget}madeProgress(){this._didWork=!0}get state(){return this._state}get enabled(){return this._enabled}set enabled(e){this._enabled=e}reset(e,t){this._begin=this.now(),this._budget=e,this._state=t,this._didWork=!1}get remaining(){return Math.max(this._budget-this.elapsed,0)}get elapsed(){return this.now()-this._begin}resetProgress(){this._didWork=!1}get hasProgressed(){return this._didWork}}r.Budget=l}(D||(D={})),function(e){e.SCHEDULED=\"s\",e.READY=\"r\",e.WAITING=\"w\",e.IDLE=\"i\"}(w||(w={}));const G=(()=>{const e=new D.Budget((()=>performance.now()));return e.enabled=!1,e})();class v{remove(){}processQueue(){}schedule(e,t,s){try{if(_(t)){const e=d();return s?Promise.resolve(s(e)):Promise.reject(e)}return l(e(G))}catch(r){return Promise.reject(r)}}reschedule(e,t,s){return this.schedule(e,t,s)}}const Q=new v,M=Number.MAX_SAFE_INTEGER;export{Q as ImmediateTask,N as State,L as TaskPriority,w as TaskState,k as getTaskPriority,f as newScheduler,G as noBudget,b as taskPriorities};\n"]},"metadata":{},"sourceType":"module"}