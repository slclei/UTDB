{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport { pt2px as t } from \"../../core/screenUtils.js\";\n\nfunction e(t) {\n  return `rgb(${t.slice(0, 3).toString()})`;\n}\n\nfunction i(t) {\n  return `rgba(${t.slice(0, 3).toString()},${t[3]})`;\n}\n\nclass s {\n  constructor() {}\n\n  rasterizeText(t, s) {\n    this._textRasterizationCanvas || (this._textRasterizationCanvas = document.createElement(\"canvas\"));\n    const r = this._textRasterizationCanvas,\n          o = r.getContext(\"2d\");\n    this._setFontProperties(o, s), this.parameters = s, this.textLines = t.split(/\\r?\\n/), this.lineHeight = this._computeLineHeight();\n\n    const h = this._computeTextWidth(o, s),\n          {\n      decoration: a,\n      weight: l\n    } = s.font;\n\n    this.lineThroughWidthOffset = a && \"line-through\" === a ? .1 * this.lineHeight : 0;\n    const d = this.lineHeight * this.textLines.length;\n    r.width = h + 2 * this.lineThroughWidthOffset, r.height = d, this.renderedLineHeight = Math.round(this.lineHeight * s.pixelRatio), this.renderedHaloSize = s.halo.size * s.pixelRatio, this.renderedWidth = h * s.pixelRatio, this.renderedHeight = d * s.pixelRatio, this.lineThroughWidthOffset *= s.pixelRatio, this.fillStyle = i(s.color), this.haloStyle = e(s.halo.color);\n    const c = this.renderedLineHeight,\n          g = this.renderedHaloSize;\n\n    this._setFontProperties(o, s);\n\n    const f = n(o.textAlign, this.renderedWidth) + g,\n          u = g,\n          p = g > 0;\n    let x = this.lineThroughWidthOffset,\n        m = 0;\n    p && this._renderHalo(o, f, u, x, m, s), m += u, x += f;\n\n    for (const e of this.textLines) o.globalCompositeOperation = \"destination-out\", o.fillStyle = \"rgb(0, 0, 0)\", o.fillText(e, x, m), o.globalCompositeOperation = \"source-over\", o.fillStyle = this.fillStyle, o.fillText(e, x, m), a && \"none\" !== a && this._renderDecoration(o, x, m, a, l), m += c;\n\n    const _ = this.renderedWidth + 2 * this.lineThroughWidthOffset,\n          H = this.renderedHeight,\n          z = o.getImageData(0, 0, _, H),\n          w = new Uint8Array(z.data);\n\n    if (s.premultiplyColors) {\n      let t;\n\n      for (let e = 0; e < w.length; e += 4) t = w[e + 3] / 255, w[e] = w[e] * t, w[e + 1] = w[e + 1] * t, w[e + 2] = w[e + 2] * t;\n    }\n\n    return {\n      size: [_, H],\n      image: new Uint32Array(w.buffer),\n      sdf: !1,\n      simplePattern: !1,\n      anchorX: 0,\n      anchorY: 0\n    };\n  }\n\n  _renderHalo(t, e, i, s, n, r) {\n    const o = this.renderedWidth,\n          h = this.renderedHeight;\n    this._haloRasterizationCanvas || (this._haloRasterizationCanvas = document.createElement(\"canvas\")), this._haloRasterizationCanvas.width = o, this._haloRasterizationCanvas.height = h;\n    const a = this._haloRasterizationCanvas,\n          l = a.getContext(\"2d\");\n    l.clearRect(0, 0, o, h), this._setFontProperties(l, r);\n    const {\n      decoration: d,\n      weight: c\n    } = r.font;\n    l.fillStyle = this.haloStyle, l.strokeStyle = this.haloStyle;\n    const g = this.renderedHaloSize < 3;\n    l.lineJoin = g ? \"miter\" : \"round\", g ? this._renderHaloEmulated(l, e, i, d, c) : this._renderHaloNative(l, e, i, d, c), t.globalAlpha = this.parameters.halo.color[3], t.drawImage(a, 0, 0, o, h, s, n, o, h), t.globalAlpha = 1;\n  }\n\n  _renderHaloEmulated(t, e, i, s, n) {\n    const o = this.renderedLineHeight,\n          h = this.renderedHaloSize;\n\n    for (const a of this.textLines) {\n      for (const [s, n] of r) t.fillText(a, e + h * s, i + h * n);\n\n      s && \"none\" !== s && this._renderDecoration(t, e, i, s, n), i += o;\n    }\n  }\n\n  _renderHaloNative(t, e, i, s, n) {\n    const r = this.renderedLineHeight,\n          o = this.renderedHaloSize;\n\n    for (const h of this.textLines) {\n      const a = 2 * o,\n            l = 5,\n            d = .1;\n\n      for (let r = 0; r < l; r++) {\n        const o = 1 - (l - 1) * d + r * d;\n        t.lineWidth = o * a, t.strokeText(h, e, i), s && \"none\" !== s && this._renderDecoration(t, e, i, s, n);\n      }\n\n      i += r;\n    }\n  }\n\n  _setFontProperties(e, i) {\n    const s = i.font,\n          n = `${s.style} ${s.weight} ${t(i.size * i.pixelRatio)}px ${s.family}, sans-serif`;\n    let r;\n\n    switch (e.font = n, e.textBaseline = \"top\", i.horizontalAlignment) {\n      case \"left\":\n      default:\n        r = \"left\";\n        break;\n\n      case \"right\":\n        r = \"right\";\n        break;\n\n      case \"center\":\n        r = \"center\";\n    }\n\n    e.textAlign = r;\n  }\n\n  computeTextSize(t, e) {\n    this._textRasterizationCanvas || (this._textRasterizationCanvas = document.createElement(\"canvas\"));\n    const i = this._textRasterizationCanvas,\n          s = i.getContext(\"2d\");\n    this._setFontProperties(s, e), this.parameters = e, this.textLines = t.split(/\\r?\\n/), this.lineHeight = this._computeLineHeight();\n\n    const n = this._computeTextWidth(s, e),\n          r = this.lineHeight * this.textLines.length;\n\n    return i.width = n, i.height = r, [n * e.pixelRatio, r * e.pixelRatio];\n  }\n\n  _computeTextWidth(t, e) {\n    let i = 0;\n\n    for (const n of this.textLines) i = Math.max(i, t.measureText(n).width);\n\n    const s = e.font;\n    return (\"italic\" === s.style || \"oblique\" === s.style || \"string\" == typeof s.weight && (\"bold\" === s.weight || \"bolder\" === s.weight) || \"number\" == typeof s.weight && s.weight > 600) && (i += .3 * t.measureText(\"w\").width), i += 2 * this.parameters.halo.size, Math.round(i);\n  }\n\n  _computeLineHeight() {\n    let t = 1.275 * this.parameters.size;\n    const e = this.parameters.font.decoration;\n    return e && \"underline\" === e && (t *= 1.3), Math.round(t + 2 * this.parameters.halo.size);\n  }\n\n  _renderDecoration(t, e, i, s, n) {\n    const r = .9 * this.lineHeight,\n          o = \"bold\" === n ? .06 : \"bolder\" === n ? .09 : .04;\n\n    switch (t.textAlign) {\n      case \"center\":\n        e -= this.renderedWidth / 2;\n        break;\n\n      case \"right\":\n        e -= this.renderedWidth;\n    }\n\n    const h = t.textBaseline;\n    if (\"underline\" === s) switch (h) {\n      case \"top\":\n        i += r;\n        break;\n\n      case \"middle\":\n        i += r / 2;\n    } else if (\"line-through\" === s) switch (h) {\n      case \"top\":\n        i += r / 1.5;\n        break;\n\n      case \"middle\":\n        i += r / 3;\n    }\n    t.save(), t.beginPath(), t.strokeStyle = t.fillStyle, t.lineWidth = Math.ceil(r * o), t.moveTo(e - this.lineThroughWidthOffset, i), t.lineTo(e + this.renderedWidth + 2 * this.lineThroughWidthOffset, i), t.stroke(), t.restore();\n  }\n\n}\n\nfunction n(t, e) {\n  return \"center\" === t ? .5 * e : \"right\" === t ? e : 0;\n}\n\nconst r = [];\n{\n  const t = 16;\n\n  for (let e = 0; e < 360; e += 360 / t) r.push([Math.cos(Math.PI * e / 180), Math.sin(Math.PI * e / 180)]);\n}\nexport { s as TextRasterizer, s as default };","map":{"version":3,"sources":["D:/Github/CUSP_DataBase/CUSP_DB/src/main/gis/node_modules/@arcgis/core/symbols/cim/TextRasterizer.js"],"names":["pt2px","t","e","slice","toString","i","s","constructor","rasterizeText","_textRasterizationCanvas","document","createElement","r","o","getContext","_setFontProperties","parameters","textLines","split","lineHeight","_computeLineHeight","h","_computeTextWidth","decoration","a","weight","l","font","lineThroughWidthOffset","d","length","width","height","renderedLineHeight","Math","round","pixelRatio","renderedHaloSize","halo","size","renderedWidth","renderedHeight","fillStyle","color","haloStyle","c","g","f","n","textAlign","u","p","x","m","_renderHalo","globalCompositeOperation","fillText","_renderDecoration","_","H","z","getImageData","w","Uint8Array","data","premultiplyColors","image","Uint32Array","buffer","sdf","simplePattern","anchorX","anchorY","_haloRasterizationCanvas","clearRect","strokeStyle","lineJoin","_renderHaloEmulated","_renderHaloNative","globalAlpha","drawImage","lineWidth","strokeText","style","family","textBaseline","horizontalAlignment","computeTextSize","max","measureText","save","beginPath","ceil","moveTo","lineTo","stroke","restore","push","cos","PI","sin","TextRasterizer","default"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport{pt2px as t}from\"../../core/screenUtils.js\";function e(t){return`rgb(${t.slice(0,3).toString()})`}function i(t){return`rgba(${t.slice(0,3).toString()},${t[3]})`}class s{constructor(){}rasterizeText(t,s){this._textRasterizationCanvas||(this._textRasterizationCanvas=document.createElement(\"canvas\"));const r=this._textRasterizationCanvas,o=r.getContext(\"2d\");this._setFontProperties(o,s),this.parameters=s,this.textLines=t.split(/\\r?\\n/),this.lineHeight=this._computeLineHeight();const h=this._computeTextWidth(o,s),{decoration:a,weight:l}=s.font;this.lineThroughWidthOffset=a&&\"line-through\"===a?.1*this.lineHeight:0;const d=this.lineHeight*this.textLines.length;r.width=h+2*this.lineThroughWidthOffset,r.height=d,this.renderedLineHeight=Math.round(this.lineHeight*s.pixelRatio),this.renderedHaloSize=s.halo.size*s.pixelRatio,this.renderedWidth=h*s.pixelRatio,this.renderedHeight=d*s.pixelRatio,this.lineThroughWidthOffset*=s.pixelRatio,this.fillStyle=i(s.color),this.haloStyle=e(s.halo.color);const c=this.renderedLineHeight,g=this.renderedHaloSize;this._setFontProperties(o,s);const f=n(o.textAlign,this.renderedWidth)+g,u=g,p=g>0;let x=this.lineThroughWidthOffset,m=0;p&&this._renderHalo(o,f,u,x,m,s),m+=u,x+=f;for(const e of this.textLines)o.globalCompositeOperation=\"destination-out\",o.fillStyle=\"rgb(0, 0, 0)\",o.fillText(e,x,m),o.globalCompositeOperation=\"source-over\",o.fillStyle=this.fillStyle,o.fillText(e,x,m),a&&\"none\"!==a&&this._renderDecoration(o,x,m,a,l),m+=c;const _=this.renderedWidth+2*this.lineThroughWidthOffset,H=this.renderedHeight,z=o.getImageData(0,0,_,H),w=new Uint8Array(z.data);if(s.premultiplyColors){let t;for(let e=0;e<w.length;e+=4)t=w[e+3]/255,w[e]=w[e]*t,w[e+1]=w[e+1]*t,w[e+2]=w[e+2]*t}return{size:[_,H],image:new Uint32Array(w.buffer),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0}}_renderHalo(t,e,i,s,n,r){const o=this.renderedWidth,h=this.renderedHeight;this._haloRasterizationCanvas||(this._haloRasterizationCanvas=document.createElement(\"canvas\")),this._haloRasterizationCanvas.width=o,this._haloRasterizationCanvas.height=h;const a=this._haloRasterizationCanvas,l=a.getContext(\"2d\");l.clearRect(0,0,o,h),this._setFontProperties(l,r);const{decoration:d,weight:c}=r.font;l.fillStyle=this.haloStyle,l.strokeStyle=this.haloStyle;const g=this.renderedHaloSize<3;l.lineJoin=g?\"miter\":\"round\",g?this._renderHaloEmulated(l,e,i,d,c):this._renderHaloNative(l,e,i,d,c),t.globalAlpha=this.parameters.halo.color[3],t.drawImage(a,0,0,o,h,s,n,o,h),t.globalAlpha=1}_renderHaloEmulated(t,e,i,s,n){const o=this.renderedLineHeight,h=this.renderedHaloSize;for(const a of this.textLines){for(const[s,n]of r)t.fillText(a,e+h*s,i+h*n);s&&\"none\"!==s&&this._renderDecoration(t,e,i,s,n),i+=o}}_renderHaloNative(t,e,i,s,n){const r=this.renderedLineHeight,o=this.renderedHaloSize;for(const h of this.textLines){const a=2*o,l=5,d=.1;for(let r=0;r<l;r++){const o=1-(l-1)*d+r*d;t.lineWidth=o*a,t.strokeText(h,e,i),s&&\"none\"!==s&&this._renderDecoration(t,e,i,s,n)}i+=r}}_setFontProperties(e,i){const s=i.font,n=`${s.style} ${s.weight} ${t(i.size*i.pixelRatio)}px ${s.family}, sans-serif`;let r;switch(e.font=n,e.textBaseline=\"top\",i.horizontalAlignment){case\"left\":default:r=\"left\";break;case\"right\":r=\"right\";break;case\"center\":r=\"center\"}e.textAlign=r}computeTextSize(t,e){this._textRasterizationCanvas||(this._textRasterizationCanvas=document.createElement(\"canvas\"));const i=this._textRasterizationCanvas,s=i.getContext(\"2d\");this._setFontProperties(s,e),this.parameters=e,this.textLines=t.split(/\\r?\\n/),this.lineHeight=this._computeLineHeight();const n=this._computeTextWidth(s,e),r=this.lineHeight*this.textLines.length;return i.width=n,i.height=r,[n*e.pixelRatio,r*e.pixelRatio]}_computeTextWidth(t,e){let i=0;for(const n of this.textLines)i=Math.max(i,t.measureText(n).width);const s=e.font;return(\"italic\"===s.style||\"oblique\"===s.style||\"string\"==typeof s.weight&&(\"bold\"===s.weight||\"bolder\"===s.weight)||\"number\"==typeof s.weight&&s.weight>600)&&(i+=.3*t.measureText(\"w\").width),i+=2*this.parameters.halo.size,Math.round(i)}_computeLineHeight(){let t=1.275*this.parameters.size;const e=this.parameters.font.decoration;return e&&\"underline\"===e&&(t*=1.3),Math.round(t+2*this.parameters.halo.size)}_renderDecoration(t,e,i,s,n){const r=.9*this.lineHeight,o=\"bold\"===n?.06:\"bolder\"===n?.09:.04;switch(t.textAlign){case\"center\":e-=this.renderedWidth/2;break;case\"right\":e-=this.renderedWidth}const h=t.textBaseline;if(\"underline\"===s)switch(h){case\"top\":i+=r;break;case\"middle\":i+=r/2}else if(\"line-through\"===s)switch(h){case\"top\":i+=r/1.5;break;case\"middle\":i+=r/3}t.save(),t.beginPath(),t.strokeStyle=t.fillStyle,t.lineWidth=Math.ceil(r*o),t.moveTo(e-this.lineThroughWidthOffset,i),t.lineTo(e+this.renderedWidth+2*this.lineThroughWidthOffset,i),t.stroke(),t.restore()}}function n(t,e){return\"center\"===t?.5*e:\"right\"===t?e:0}const r=[];{const t=16;for(let e=0;e<360;e+=360/t)r.push([Math.cos(Math.PI*e/180),Math.sin(Math.PI*e/180)])}export{s as TextRasterizer,s as default};\n"]},"metadata":{},"sourceType":"module"}