{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport { _ as e } from \"../../../../../chunks/tslib.es6.js\";\nimport t from \"../../../../../core/has.js\";\nimport { isAbortError as i } from \"../../../../../core/promiseUtils.js\";\nimport \"../../../../../core/Logger.js\";\nimport \"../../../../../core/accessorSupport/ensureType.js\";\nimport \"../../../../../core/arrayUtils.js\";\nimport \"../../../../../core/accessorSupport/set.js\";\nimport { subclass as s } from \"../../../../../core/accessorSupport/decorators/subclass.js\";\nimport { create as r } from \"../../../../../geometry/support/aaBoundingRect.js\";\nimport { FeatureTile as a } from \"../../../engine/webgl/FeatureTile.js\";\nimport { simplifyVVRenderer as o } from \"../support/rendererUtils.js\";\nimport l from \"./BaseTileRenderer.js\";\nimport { convertVisualVariables as n } from \"./support/visualVariablesUtils.js\";\nimport { WGLFeatureView as u } from \"./support/WGLFeatureView.js\";\nlet p = class extends l {\n  install(e) {\n    const t = () => this.notifyChange(\"updating\"),\n          i = new u(this.tileInfoView, this.layerView, this.layer, t);\n\n    this.featuresView = i, e.addChild(i);\n  }\n\n  uninstall(e) {\n    e.removeChild(this.featuresView), this.featuresView.destroy(), this.featuresView = null;\n  }\n\n  fetchResource(e, t) {\n    const {\n      url: s\n    } = e,\n          r = this.featuresView.stage;\n\n    try {\n      return r.resourceManager.fetchResource(s, {\n        signal: t.signal\n      });\n    } catch (a) {\n      return i(a) ? Promise.resolve({\n        width: 0,\n        height: 0\n      }) : Promise.reject(a);\n    }\n  }\n\n  isUpdating() {\n    var e;\n    const i = super.isUpdating(),\n          s = !this.featuresView || this.featuresView.isUpdating(),\n          r = null == (e = this.featuresView) ? void 0 : e.hasEmptyAttributeView(),\n          a = i || s || i && r;\n    return t(\"esri-2d-log-updating\") && console.log(`Updating SymbolTileRenderer ${a}\\n  -> updatingTiles ${i}\\n  -> hasFeaturesView ${!!this.featuresView}\\n  -> updatingFeaturesView ${s}`), a;\n  }\n\n  hitTest(e) {\n    return this.featuresView.hitTest(e);\n  }\n\n  supportsRenderer(e) {\n    return null != e && -1 !== [\"simple\", \"class-breaks\", \"unique-value\", \"dot-density\", \"dictionary\"].indexOf(e.type);\n  }\n\n  onConfigUpdate(e) {\n    let t = null;\n\n    if (\"visualVariables\" in e) {\n      const i = (o(e).visualVariables || []).map(e => {\n        const t = e.clone();\n        return \"normalizationField\" in e && (t.normalizationField = null), e.valueExpression && \"$view.scale\" !== e.valueExpression && (t.valueExpression = null, t.field = \"nop\"), t;\n      });\n      t = n(i);\n    }\n\n    this.featuresView.setRendererInfo(e, t, this.layerView.featureEffect);\n  }\n\n  onTileData(e) {\n    const t = this.tiles.get(e.tileKey);\n    t && e.data && this.featuresView.onTileData(t, e.data), this.layerView.view.labelManager.requestUpdate();\n  }\n\n  onTileError(e) {\n    const t = this.tiles.get(e.tileKey);\n    t && this.featuresView.onTileError(t);\n  }\n\n  forceAttributeTextureUpload() {\n    this.featuresView.attributeView.forceTextureUpload();\n  }\n\n  lockGPUUploads() {\n    this.featuresView.attributeView.lockTextureUpload(), this.tiles.forEach(e => e.lock());\n  }\n\n  unlockGPUUploads() {\n    this.featuresView.attributeView.unlockTextureUpload(), this.tiles.forEach(e => e.unlock());\n  }\n\n  async getMaterialItems(e) {\n    return this.featuresView.getMaterialItems(e);\n  }\n\n  invalidateLabels() {\n    this.featuresView.hasLabels && this.layerView.view.labelManager.requestUpdate();\n  }\n\n  createTile(e) {\n    const t = this.tileInfoView.getTileBounds(r(), e),\n          i = () => this.layerView.view.labelManager.requestUpdate();\n\n    return new a(e, t[0], t[3], this.featuresView.attributeView, i);\n  }\n\n  disposeTile(e) {\n    this.featuresView.removeChild(e), e.destroy(), this.layerView.view.labelManager.requestUpdate();\n  }\n\n};\np = e([s(\"esri.views.2d.layers.features.tileRenderers.SymbolTileRenderer\")], p);\nconst c = p;\nexport { c as default };","map":{"version":3,"sources":["D:/Github/CUSP_DataBase/CUSP_DB/src/main/gis/node_modules/@arcgis/core/views/2d/layers/features/tileRenderers/SymbolTileRenderer.js"],"names":["_","e","t","isAbortError","i","subclass","s","create","r","FeatureTile","a","simplifyVVRenderer","o","l","convertVisualVariables","n","WGLFeatureView","u","p","install","notifyChange","tileInfoView","layerView","layer","featuresView","addChild","uninstall","removeChild","destroy","fetchResource","url","stage","resourceManager","signal","Promise","resolve","width","height","reject","isUpdating","hasEmptyAttributeView","console","log","hitTest","supportsRenderer","indexOf","type","onConfigUpdate","visualVariables","map","clone","normalizationField","valueExpression","field","setRendererInfo","featureEffect","onTileData","tiles","get","tileKey","data","view","labelManager","requestUpdate","onTileError","forceAttributeTextureUpload","attributeView","forceTextureUpload","lockGPUUploads","lockTextureUpload","forEach","lock","unlockGPUUploads","unlockTextureUpload","unlock","getMaterialItems","invalidateLabels","hasLabels","createTile","getTileBounds","disposeTile","c","default"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../../chunks/tslib.es6.js\";import t from\"../../../../../core/has.js\";import{isAbortError as i}from\"../../../../../core/promiseUtils.js\";import\"../../../../../core/Logger.js\";import\"../../../../../core/accessorSupport/ensureType.js\";import\"../../../../../core/arrayUtils.js\";import\"../../../../../core/accessorSupport/set.js\";import{subclass as s}from\"../../../../../core/accessorSupport/decorators/subclass.js\";import{create as r}from\"../../../../../geometry/support/aaBoundingRect.js\";import{FeatureTile as a}from\"../../../engine/webgl/FeatureTile.js\";import{simplifyVVRenderer as o}from\"../support/rendererUtils.js\";import l from\"./BaseTileRenderer.js\";import{convertVisualVariables as n}from\"./support/visualVariablesUtils.js\";import{WGLFeatureView as u}from\"./support/WGLFeatureView.js\";let p=class extends l{install(e){const t=()=>this.notifyChange(\"updating\"),i=new u(this.tileInfoView,this.layerView,this.layer,t);this.featuresView=i,e.addChild(i)}uninstall(e){e.removeChild(this.featuresView),this.featuresView.destroy(),this.featuresView=null}fetchResource(e,t){const{url:s}=e,r=this.featuresView.stage;try{return r.resourceManager.fetchResource(s,{signal:t.signal})}catch(a){return i(a)?Promise.resolve({width:0,height:0}):Promise.reject(a)}}isUpdating(){var e;const i=super.isUpdating(),s=!this.featuresView||this.featuresView.isUpdating(),r=null==(e=this.featuresView)?void 0:e.hasEmptyAttributeView(),a=i||s||i&&r;return t(\"esri-2d-log-updating\")&&console.log(`Updating SymbolTileRenderer ${a}\\n  -> updatingTiles ${i}\\n  -> hasFeaturesView ${!!this.featuresView}\\n  -> updatingFeaturesView ${s}`),a}hitTest(e){return this.featuresView.hitTest(e)}supportsRenderer(e){return null!=e&&-1!==[\"simple\",\"class-breaks\",\"unique-value\",\"dot-density\",\"dictionary\"].indexOf(e.type)}onConfigUpdate(e){let t=null;if(\"visualVariables\"in e){const i=(o(e).visualVariables||[]).map((e=>{const t=e.clone();return\"normalizationField\"in e&&(t.normalizationField=null),e.valueExpression&&\"$view.scale\"!==e.valueExpression&&(t.valueExpression=null,t.field=\"nop\"),t}));t=n(i)}this.featuresView.setRendererInfo(e,t,this.layerView.featureEffect)}onTileData(e){const t=this.tiles.get(e.tileKey);t&&e.data&&this.featuresView.onTileData(t,e.data),this.layerView.view.labelManager.requestUpdate()}onTileError(e){const t=this.tiles.get(e.tileKey);t&&this.featuresView.onTileError(t)}forceAttributeTextureUpload(){this.featuresView.attributeView.forceTextureUpload()}lockGPUUploads(){this.featuresView.attributeView.lockTextureUpload(),this.tiles.forEach((e=>e.lock()))}unlockGPUUploads(){this.featuresView.attributeView.unlockTextureUpload(),this.tiles.forEach((e=>e.unlock()))}async getMaterialItems(e){return this.featuresView.getMaterialItems(e)}invalidateLabels(){this.featuresView.hasLabels&&this.layerView.view.labelManager.requestUpdate()}createTile(e){const t=this.tileInfoView.getTileBounds(r(),e),i=()=>this.layerView.view.labelManager.requestUpdate();return new a(e,t[0],t[3],this.featuresView.attributeView,i)}disposeTile(e){this.featuresView.removeChild(e),e.destroy(),this.layerView.view.labelManager.requestUpdate()}};p=e([s(\"esri.views.2d.layers.features.tileRenderers.SymbolTileRenderer\")],p);const c=p;export{c as default};\n"]},"metadata":{},"sourceType":"module"}