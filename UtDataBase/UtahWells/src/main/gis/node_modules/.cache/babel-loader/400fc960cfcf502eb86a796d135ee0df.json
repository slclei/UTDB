{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport { someMap as t } from \"../../core/MapUtils.js\";\nimport { clamp as e } from \"../../core/mathUtils.js\";\nimport { isNone as i, isSome as o, applySome as r, unwrap as n } from \"../../core/maybe.js\";\nimport { createScreenPoint as a } from \"../../core/screenUtils.js\";\nimport { areToolManipulatorsEditable as s } from \"./interactiveToolUtils.js\";\nimport { createScreenPointFromEvent as l } from \"../support/screenUtils.js\";\n\nclass p {\n  constructor() {\n    this._pointerLocations = new Map(), this._hoveredManipulators = new Map(), this._grabbedManipulators = new Map(), this._draggedManipulators = new Map(), this._stopDrag = !1, this._currentlyActiveTool = null, this._revertToActiveTool = !1, this._cursor = null;\n  }\n\n  get cursor() {\n    return this._cursor;\n  }\n\n  handleInputEvent(t, a) {\n    const s = () => t.stopPropagation();\n\n    switch (t.type) {\n      case \"pointer-move\":\n        c(t.pointerType) && this._pointerLocations.set(t.pointerId, {\n          x: t.x,\n          y: t.y,\n          pointerType: t.pointerType\n        });\n        break;\n\n      case \"drag\":\n        this._grabbedManipulators.size > 0 && (this._stopDrag = !0), this._stopDrag && (s(), \"end\" === t.action && (this._stopDrag = !1));\n        break;\n\n      case \"pointer-down\":\n        {\n          if (!u(t)) break;\n\n          const e = l(t),\n                n = this._intersect(e, t.pointerType, a.forEachTool);\n\n          if (i(n)) break;\n\n          const p = this._findToolAndManipulatorByKey(n, a.forEachTool, h),\n                c = r(p, t => t.manipulator),\n                d = r(p, t => t.tool);\n\n          !(o(c) && o(d) && c.interactive) || c.grabbable && c.grabbableForEvent(t) || !c.grabbing || c.dragging || this._ungrabManipulatorBeforeDragging(c, d, t), o(c) && c.interactive && c.grabbable && c.grabbableForEvent(t) && !c.grabbing && (this._grabbedManipulators.set(t.pointerId, {\n            key: n,\n            start: e,\n            pointerType: t.pointerType\n          }), 1 === this._grabbedManipulators.size && a.activeTool !== n.tool && (this._currentlyActiveTool = a.activeTool, this._revertToActiveTool = !0, a.setActiveTool(n.tool)), c.grabbing = !0, c.events.emit(\"grab-changed\", {\n            action: \"start\",\n            pointerType: t.pointerType,\n            screenPoint: e\n          }), s());\n          break;\n        }\n\n      case \"pointer-up\":\n        this._handlePointerEnd(t, a);\n\n        break;\n\n      case \"pointer-drag\":\n        {\n          if (!u(t)) break;\n\n          const o = this._grabbedManipulators.get(t.pointerId),\n                p = this._draggedManipulators.get(t.pointerId),\n                c = r(o || p, _ref => {\n            let {\n              key: t\n            } = _ref;\n            return t;\n          }),\n                d = this._findManipulatorByKey(c, a.forEachTool);\n\n          if (i(d)) break;\n          const h = l(t);\n          h.x = e(h.x, 0, a.view.width), h.y = e(h.y, 0, a.view.height);\n          const g = n(o || p).start;\n\n          switch (t.action) {\n            case \"start\":\n            case \"update\":\n              \"update\" !== t.action && 1 !== this._grabbedManipulators.size || (d.dragging = !0, p ? d.events.emit(\"drag\", {\n                action: \"update\",\n                start: g,\n                screenPoint: h\n              }) : d.events.emit(\"drag\", {\n                action: \"start\",\n                start: g,\n                screenPoint: h,\n                pointerType: t.pointerType\n              }), this._draggedManipulators.set(t.pointerId, {\n                key: n(c),\n                start: g\n              }));\n              break;\n\n            case \"end\":\n              d.dragging = !1, p && d.events.emit(\"drag\", {\n                action: \"end\",\n                start: g,\n                screenPoint: h\n              }), this._draggedManipulators.delete(t.pointerId), this._handlePointerEnd(t, a);\n          }\n\n          s();\n          break;\n        }\n\n      case \"immediate-click\":\n        {\n          const e = l(t),\n                r = this._intersect(e, t.pointerType, a.forEachTool),\n                n = this._findToolAndManipulatorByKey(r, a.forEachTool, h);\n\n          if (d(t) || a.forEachTool(t => {\n            if ((!o(n) || n.tool !== t || t.automaticManipulatorSelection) && t.manipulators) {\n              let e = !1;\n              t.manipulators.forEach(_ref2 => {\n                let {\n                  manipulator: t\n                } = _ref2;\n                t.selected && (t.selected = !1, e = !0);\n              }), e && t.manipulatorSelectionChanged && t.manipulatorSelectionChanged();\n            }\n          }), i(n)) break;\n          const {\n            manipulator: p,\n            tool: c\n          } = n;\n          if (!p.interactive) break;\n          p.selectable && c.automaticManipulatorSelection && (p.selected = !p.selected, c.manipulatorSelectionChanged && c.manipulatorSelectionChanged());\n          const u = t.native.shiftKey;\n          p.events.emit(\"immediate-click\", {\n            screenPoint: e,\n            button: t.button,\n            pointerType: t.pointerType,\n            shiftKey: u,\n            stopPropagation: s\n          });\n          break;\n        }\n\n      case \"click\":\n        {\n          const e = l(t),\n                o = this._intersect(e, t.pointerType, a.forEachTool),\n                r = this._findManipulatorByKey(o, a.forEachTool);\n\n          if (i(r) || !r.interactive) break;\n          const n = t.native.shiftKey;\n          r.events.emit(t.type, {\n            screenPoint: e,\n            button: t.button,\n            pointerType: t.pointerType,\n            shiftKey: n\n          }), s();\n          break;\n        }\n\n      case \"double-click\":\n        {\n          const e = l(t),\n                o = this._intersect(e, t.pointerType, a.forEachTool),\n                r = this._findManipulatorByKey(o, a.forEachTool);\n\n          if (i(r) || !r.interactive) break;\n          const n = t.native.shiftKey;\n          r.events.emit(\"double-click\", {\n            screenPoint: e,\n            button: t.button,\n            pointerType: t.pointerType,\n            shiftKey: n,\n            stopPropagation: s\n          });\n          break;\n        }\n\n      case \"immediate-double-click\":\n        {\n          const e = l(t),\n                o = this._intersect(e, t.pointerType, a.forEachTool),\n                r = this._findManipulatorByKey(o, a.forEachTool);\n\n          if (i(r) || !r.interactive) break;\n          const n = t.native.shiftKey;\n          r.events.emit(\"immediate-double-click\", {\n            screenPoint: e,\n            button: t.button,\n            pointerType: t.pointerType,\n            shiftKey: n,\n            stopPropagation: s\n          });\n          break;\n        }\n    }\n\n    this._updateCursor(a.forEachTool);\n  }\n\n  _ungrabManipulatorBeforeDragging(t, e, i) {\n    t.grabbing = !1, t.events.emit(\"grab-changed\", {\n      action: \"end\",\n      pointerType: i.pointerType,\n      screenPoint: l(i)\n    }), this._grabbedManipulators.forEach((_ref3, o) => {\n      let {\n        key: i\n      } = _ref3;\n      i.tool === e && e.manipulators.findById(i.manipulatorId) === t && this._grabbedManipulators.delete(o);\n    });\n  }\n\n  _handlePointerEnd(t, e) {\n    const i = r(this._grabbedManipulators.get(t.pointerId), _ref4 => {\n      let {\n        key: t\n      } = _ref4;\n      return t;\n    }),\n          n = this._findManipulatorByKey(i, e.forEachTool);\n\n    o(n) && !n.dragging && (1 === this._grabbedManipulators.size && 0 === this._draggedManipulators.size && this._revertToActiveTool && (e.setActiveTool(this._currentlyActiveTool), this._revertToActiveTool = !1, this._currentlyActiveTool = null), n.grabbing && (n.grabbing = !1, n.events.emit(\"grab-changed\", {\n      action: \"end\",\n      pointerType: t.pointerType,\n      screenPoint: l(t)\n    })), this._grabbedManipulators.delete(t.pointerId));\n  }\n\n  _cursorFromMap(e, i) {\n    let r = null;\n    return t(e, _ref5 => {\n      let {\n        key: t\n      } = _ref5;\n\n      const e = this._findManipulatorByKey(t, i);\n\n      return !!(o(e) && e.interactive && \"cursor\" in e && e.cursor) && (r = e.cursor, !0);\n    }), r;\n  }\n\n  _updateCursor(t) {\n    this._grabbedManipulators.size > 0 ? this._cursor = this._cursorFromMap(this._grabbedManipulators, t) || \"grabbing\" : this._hoveredManipulators.size > 0 ? this._cursor = this._cursorFromMap(this._hoveredManipulators, t) || \"pointer\" : this._cursor = null;\n  }\n\n  clearPointers(t, e) {\n    let r = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : !0;\n    let n = arguments.length > 3 ? arguments[3] : undefined;\n\n    const a = e => e.tool === t && (i(n) || e.manipulatorId === n);\n\n    this._grabbedManipulators.forEach((_ref6, r) => {\n      let {\n        key: t,\n        pointerType: i\n      } = _ref6;\n\n      if (a(t)) {\n        this._grabbedManipulators.delete(r);\n\n        const n = this._findManipulatorByKey(t, e);\n\n        o(n) && (n.grabbing = !1, n.events.emit(\"grab-changed\", {\n          action: \"end\",\n          screenPoint: null,\n          pointerType: i\n        }));\n      }\n    }), this._draggedManipulators.forEach((_ref7, i) => {\n      let {\n        key: t\n      } = _ref7;\n\n      if (a(t)) {\n        this._draggedManipulators.delete(i);\n\n        const r = this._findManipulatorByKey(t, e);\n\n        o(r) && (r.dragging = !1, r.events.emit(\"drag\", {\n          action: \"cancel\"\n        }));\n      }\n    }), r && this._hoveredManipulators.forEach((_ref8, i) => {\n      let {\n        key: t\n      } = _ref8;\n\n      if (a(t)) {\n        this._hoveredManipulators.delete(i);\n\n        const r = this._findManipulatorByKey(t, e);\n\n        o(r) && (r.hovering = !1);\n      }\n    }), this._updateCursor(e);\n  }\n\n  _intersect(t, e, o) {\n    let r = null;\n    return o(o => {\n      if (null == o.manipulators || !s(o)) return !1;\n      const n = o.manipulators.intersect(t, e);\n      return !i(n) && (r = {\n        manipulatorId: n.id,\n        tool: o\n      }, !0);\n    }), r;\n  }\n\n  updateHoveredStateFromKnownPointers(t) {\n    this._pointerLocations.forEach((e, i) => {\n      this._updateHoveredStateForPointerAtScreenPosition(a(e.x, e.y), i, e.pointerType, t);\n    });\n  }\n\n  handleHoverEvent(t, e) {\n    \"pointer-up\" !== t.type && \"immediate-click\" !== t.type && \"pointer-move\" !== t.type || !c(t.pointerType) || this._updateHoveredStateForPointerAtScreenPosition(l(t), t.pointerId, t.pointerType, e);\n  }\n\n  _updateHoveredStateForPointerAtScreenPosition(t, e, i, a) {\n    const s = this._intersect(t, i, a);\n\n    let l = this._findManipulatorByKey(s, a);\n\n    const p = r(this._hoveredManipulators.get(e), _ref9 => {\n      let {\n        key: t\n      } = _ref9;\n      return t;\n    }),\n          c = this._findManipulatorByKey(p, a);\n\n    o(l) && !l.interactive && (l = null), c !== l && (o(c) && (c.hovering = !1), o(l) ? (l.hovering = !0, this._hoveredManipulators.set(e, {\n      key: n(s)\n    })) : this._hoveredManipulators.delete(e), this._updateCursor(a));\n  }\n\n  _findManipulatorByKey(t, e) {\n    return this._findToolAndManipulatorByKey(t, e, h) ? h.manipulator : null;\n  }\n\n  _findToolAndManipulatorByKey(t, e, r) {\n    return i(t) ? null : (r.tool = null, r.manipulator = null, e(e => {\n      if (e !== t.tool || null == e.manipulators || !s(e)) return !1;\n      const i = e.manipulators.findById(t.manipulatorId);\n      return !!o(i) && (r.manipulator = i, r.tool = e, !0);\n    }), r.manipulator ? r : null);\n  }\n\n}\n\nfunction c(t) {\n  return \"mouse\" === t;\n}\n\nfunction u(t) {\n  return \"mouse\" !== t.pointerType || 0 === t.button;\n}\n\nfunction d(t) {\n  return !!t.native.shiftKey;\n}\n\nconst h = {\n  manipulator: null,\n  tool: null\n};\nexport { p as default };","map":{"version":3,"sources":["D:/Github/CUSP_DataBase/CUSP_DB/src/main/gis/node_modules/@arcgis/core/views/interactive/ToolViewManagerManipulatorState.js"],"names":["someMap","t","clamp","e","isNone","i","isSome","o","applySome","r","unwrap","n","createScreenPoint","a","areToolManipulatorsEditable","s","createScreenPointFromEvent","l","p","constructor","_pointerLocations","Map","_hoveredManipulators","_grabbedManipulators","_draggedManipulators","_stopDrag","_currentlyActiveTool","_revertToActiveTool","_cursor","cursor","handleInputEvent","stopPropagation","type","c","pointerType","set","pointerId","x","y","size","action","u","_intersect","forEachTool","_findToolAndManipulatorByKey","h","manipulator","d","tool","interactive","grabbable","grabbableForEvent","grabbing","dragging","_ungrabManipulatorBeforeDragging","key","start","activeTool","setActiveTool","events","emit","screenPoint","_handlePointerEnd","get","_findManipulatorByKey","view","width","height","g","delete","automaticManipulatorSelection","manipulators","forEach","selected","manipulatorSelectionChanged","selectable","native","shiftKey","button","_updateCursor","findById","manipulatorId","_cursorFromMap","clearPointers","hovering","intersect","id","updateHoveredStateFromKnownPointers","_updateHoveredStateForPointerAtScreenPosition","handleHoverEvent","default"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport{someMap as t}from\"../../core/MapUtils.js\";import{clamp as e}from\"../../core/mathUtils.js\";import{isNone as i,isSome as o,applySome as r,unwrap as n}from\"../../core/maybe.js\";import{createScreenPoint as a}from\"../../core/screenUtils.js\";import{areToolManipulatorsEditable as s}from\"./interactiveToolUtils.js\";import{createScreenPointFromEvent as l}from\"../support/screenUtils.js\";class p{constructor(){this._pointerLocations=new Map,this._hoveredManipulators=new Map,this._grabbedManipulators=new Map,this._draggedManipulators=new Map,this._stopDrag=!1,this._currentlyActiveTool=null,this._revertToActiveTool=!1,this._cursor=null}get cursor(){return this._cursor}handleInputEvent(t,a){const s=()=>t.stopPropagation();switch(t.type){case\"pointer-move\":c(t.pointerType)&&this._pointerLocations.set(t.pointerId,{x:t.x,y:t.y,pointerType:t.pointerType});break;case\"drag\":this._grabbedManipulators.size>0&&(this._stopDrag=!0),this._stopDrag&&(s(),\"end\"===t.action&&(this._stopDrag=!1));break;case\"pointer-down\":{if(!u(t))break;const e=l(t),n=this._intersect(e,t.pointerType,a.forEachTool);if(i(n))break;const p=this._findToolAndManipulatorByKey(n,a.forEachTool,h),c=r(p,(t=>t.manipulator)),d=r(p,(t=>t.tool));!(o(c)&&o(d)&&c.interactive)||c.grabbable&&c.grabbableForEvent(t)||!c.grabbing||c.dragging||this._ungrabManipulatorBeforeDragging(c,d,t),o(c)&&c.interactive&&c.grabbable&&c.grabbableForEvent(t)&&!c.grabbing&&(this._grabbedManipulators.set(t.pointerId,{key:n,start:e,pointerType:t.pointerType}),1===this._grabbedManipulators.size&&a.activeTool!==n.tool&&(this._currentlyActiveTool=a.activeTool,this._revertToActiveTool=!0,a.setActiveTool(n.tool)),c.grabbing=!0,c.events.emit(\"grab-changed\",{action:\"start\",pointerType:t.pointerType,screenPoint:e}),s());break}case\"pointer-up\":this._handlePointerEnd(t,a);break;case\"pointer-drag\":{if(!u(t))break;const o=this._grabbedManipulators.get(t.pointerId),p=this._draggedManipulators.get(t.pointerId),c=r(o||p,(({key:t})=>t)),d=this._findManipulatorByKey(c,a.forEachTool);if(i(d))break;const h=l(t);h.x=e(h.x,0,a.view.width),h.y=e(h.y,0,a.view.height);const g=n(o||p).start;switch(t.action){case\"start\":case\"update\":\"update\"!==t.action&&1!==this._grabbedManipulators.size||(d.dragging=!0,p?d.events.emit(\"drag\",{action:\"update\",start:g,screenPoint:h}):d.events.emit(\"drag\",{action:\"start\",start:g,screenPoint:h,pointerType:t.pointerType}),this._draggedManipulators.set(t.pointerId,{key:n(c),start:g}));break;case\"end\":d.dragging=!1,p&&d.events.emit(\"drag\",{action:\"end\",start:g,screenPoint:h}),this._draggedManipulators.delete(t.pointerId),this._handlePointerEnd(t,a)}s();break}case\"immediate-click\":{const e=l(t),r=this._intersect(e,t.pointerType,a.forEachTool),n=this._findToolAndManipulatorByKey(r,a.forEachTool,h);if(d(t)||a.forEachTool((t=>{if((!o(n)||n.tool!==t||t.automaticManipulatorSelection)&&t.manipulators){let e=!1;t.manipulators.forEach((({manipulator:t})=>{t.selected&&(t.selected=!1,e=!0)})),e&&t.manipulatorSelectionChanged&&t.manipulatorSelectionChanged()}})),i(n))break;const{manipulator:p,tool:c}=n;if(!p.interactive)break;p.selectable&&c.automaticManipulatorSelection&&(p.selected=!p.selected,c.manipulatorSelectionChanged&&c.manipulatorSelectionChanged());const u=t.native.shiftKey;p.events.emit(\"immediate-click\",{screenPoint:e,button:t.button,pointerType:t.pointerType,shiftKey:u,stopPropagation:s});break}case\"click\":{const e=l(t),o=this._intersect(e,t.pointerType,a.forEachTool),r=this._findManipulatorByKey(o,a.forEachTool);if(i(r)||!r.interactive)break;const n=t.native.shiftKey;r.events.emit(t.type,{screenPoint:e,button:t.button,pointerType:t.pointerType,shiftKey:n}),s();break}case\"double-click\":{const e=l(t),o=this._intersect(e,t.pointerType,a.forEachTool),r=this._findManipulatorByKey(o,a.forEachTool);if(i(r)||!r.interactive)break;const n=t.native.shiftKey;r.events.emit(\"double-click\",{screenPoint:e,button:t.button,pointerType:t.pointerType,shiftKey:n,stopPropagation:s});break}case\"immediate-double-click\":{const e=l(t),o=this._intersect(e,t.pointerType,a.forEachTool),r=this._findManipulatorByKey(o,a.forEachTool);if(i(r)||!r.interactive)break;const n=t.native.shiftKey;r.events.emit(\"immediate-double-click\",{screenPoint:e,button:t.button,pointerType:t.pointerType,shiftKey:n,stopPropagation:s});break}}this._updateCursor(a.forEachTool)}_ungrabManipulatorBeforeDragging(t,e,i){t.grabbing=!1,t.events.emit(\"grab-changed\",{action:\"end\",pointerType:i.pointerType,screenPoint:l(i)}),this._grabbedManipulators.forEach((({key:i},o)=>{i.tool===e&&e.manipulators.findById(i.manipulatorId)===t&&this._grabbedManipulators.delete(o)}))}_handlePointerEnd(t,e){const i=r(this._grabbedManipulators.get(t.pointerId),(({key:t})=>t)),n=this._findManipulatorByKey(i,e.forEachTool);o(n)&&!n.dragging&&(1===this._grabbedManipulators.size&&0===this._draggedManipulators.size&&this._revertToActiveTool&&(e.setActiveTool(this._currentlyActiveTool),this._revertToActiveTool=!1,this._currentlyActiveTool=null),n.grabbing&&(n.grabbing=!1,n.events.emit(\"grab-changed\",{action:\"end\",pointerType:t.pointerType,screenPoint:l(t)})),this._grabbedManipulators.delete(t.pointerId))}_cursorFromMap(e,i){let r=null;return t(e,(({key:t})=>{const e=this._findManipulatorByKey(t,i);return!!(o(e)&&e.interactive&&\"cursor\"in e&&e.cursor)&&(r=e.cursor,!0)})),r}_updateCursor(t){this._grabbedManipulators.size>0?this._cursor=this._cursorFromMap(this._grabbedManipulators,t)||\"grabbing\":this._hoveredManipulators.size>0?this._cursor=this._cursorFromMap(this._hoveredManipulators,t)||\"pointer\":this._cursor=null}clearPointers(t,e,r=!0,n){const a=e=>e.tool===t&&(i(n)||e.manipulatorId===n);this._grabbedManipulators.forEach((({key:t,pointerType:i},r)=>{if(a(t)){this._grabbedManipulators.delete(r);const n=this._findManipulatorByKey(t,e);o(n)&&(n.grabbing=!1,n.events.emit(\"grab-changed\",{action:\"end\",screenPoint:null,pointerType:i}))}})),this._draggedManipulators.forEach((({key:t},i)=>{if(a(t)){this._draggedManipulators.delete(i);const r=this._findManipulatorByKey(t,e);o(r)&&(r.dragging=!1,r.events.emit(\"drag\",{action:\"cancel\"}))}})),r&&this._hoveredManipulators.forEach((({key:t},i)=>{if(a(t)){this._hoveredManipulators.delete(i);const r=this._findManipulatorByKey(t,e);o(r)&&(r.hovering=!1)}})),this._updateCursor(e)}_intersect(t,e,o){let r=null;return o((o=>{if(null==o.manipulators||!s(o))return!1;const n=o.manipulators.intersect(t,e);return!i(n)&&(r={manipulatorId:n.id,tool:o},!0)})),r}updateHoveredStateFromKnownPointers(t){this._pointerLocations.forEach(((e,i)=>{this._updateHoveredStateForPointerAtScreenPosition(a(e.x,e.y),i,e.pointerType,t)}))}handleHoverEvent(t,e){\"pointer-up\"!==t.type&&\"immediate-click\"!==t.type&&\"pointer-move\"!==t.type||!c(t.pointerType)||this._updateHoveredStateForPointerAtScreenPosition(l(t),t.pointerId,t.pointerType,e)}_updateHoveredStateForPointerAtScreenPosition(t,e,i,a){const s=this._intersect(t,i,a);let l=this._findManipulatorByKey(s,a);const p=r(this._hoveredManipulators.get(e),(({key:t})=>t)),c=this._findManipulatorByKey(p,a);o(l)&&!l.interactive&&(l=null),c!==l&&(o(c)&&(c.hovering=!1),o(l)?(l.hovering=!0,this._hoveredManipulators.set(e,{key:n(s)})):this._hoveredManipulators.delete(e),this._updateCursor(a))}_findManipulatorByKey(t,e){return this._findToolAndManipulatorByKey(t,e,h)?h.manipulator:null}_findToolAndManipulatorByKey(t,e,r){return i(t)?null:(r.tool=null,r.manipulator=null,e((e=>{if(e!==t.tool||null==e.manipulators||!s(e))return!1;const i=e.manipulators.findById(t.manipulatorId);return!!o(i)&&(r.manipulator=i,r.tool=e,!0)})),r.manipulator?r:null)}}function c(t){return\"mouse\"===t}function u(t){return\"mouse\"!==t.pointerType||0===t.button}function d(t){return!!t.native.shiftKey}const h={manipulator:null,tool:null};export{p as default};\n"]},"metadata":{},"sourceType":"module"}