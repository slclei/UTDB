{"ast":null,"code":"/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport { C_DEG_TO_RAD as e, C_PI as t, C_INFINITY as i, radToByte as n, positiveMod as s, C_2PI as o } from \"./GeometryUtils.js\";\nimport { SDF_GLYPH_SIZE as a, TextShaping as l, SDF_GLYPH_BASELINE as h } from \"./TextShaping.js\";\nimport { DECLUTTER_TILES as r } from \"./decluttering/config.js\";\nimport { RotationAlignment as c, SymbolAnchor as g } from \"./style/StyleDefinition.js\";\nimport { Point as m } from \"../webgl/Geometry.js\";\nconst x = 4096,\n      d = 512,\n      w = 8,\n      p = .5,\n      y = 2;\n\nclass T {\n  constructor(e, t) {\n    let i = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n    let n = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : -1;\n    let s = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : p;\n    this.x = e, this.y = t, this.angle = i, this.segment = n, this.minzoom = s;\n  }\n\n}\n\nclass f {\n  constructor(e, t, n, s, o) {\n    let a = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : p;\n    let l = arguments.length > 6 && arguments[6] !== undefined ? arguments[6] : i;\n    this.anchor = e, this.labelAngle = t, this.glyphAngle = n, this.page = s, this.alternateVerticalGlyph = o, this.minzoom = a, this.maxzoom = l;\n  }\n\n}\n\nclass I {\n  constructor(e, t, i, n, s, o, a, l, h, r, c, g) {\n    this.tl = e, this.tr = t, this.bl = i, this.br = n, this.mosaicRect = s, this.labelAngle = o, this.minAngle = a, this.maxAngle = l, this.anchor = h, this.minzoom = r, this.maxzoom = c, this.page = g;\n  }\n\n}\n\nclass b {\n  constructor(e) {\n    this.shapes = e;\n  }\n\n}\n\nclass u {\n  getIconPlacement(i, n, s) {\n    const o = new m(i.x, i.y),\n          a = s.rotationAlignment === c.MAP,\n          l = s.keepUpright;\n    let h = s.rotate * e;\n    a && (h += i.angle);\n    const g = new b([]);\n    return s.allowOverlap && s.ignorePlacement || !r || (g.iconColliders = []), this._addIconPlacement(g, o, n, s, h), a && l && this._addIconPlacement(g, o, n, s, h + t), g;\n  }\n\n  _addIconPlacement(e, t, n, s, o) {\n    const a = n.pixelRatio,\n          l = n.width / a,\n          h = n.height / a,\n          c = s.offset;\n    let x = c[0],\n        d = c[1];\n\n    switch (s.anchor) {\n      case g.CENTER:\n        x -= l / 2, d -= h / 2;\n        break;\n\n      case g.LEFT:\n        d -= h / 2;\n        break;\n\n      case g.RIGHT:\n        x -= l, d -= h / 2;\n        break;\n\n      case g.TOP:\n        x -= l / 2;\n        break;\n\n      case g.BOTTOM:\n        x -= l / 2, d -= h;\n        break;\n\n      case g.TOP_LEFT:\n        break;\n\n      case g.BOTTOM_LEFT:\n        d -= h;\n        break;\n\n      case g.TOP_RIGHT:\n        x -= l;\n        break;\n\n      case g.BOTTOM_RIGHT:\n        x -= l, d -= h;\n    }\n\n    const w = n.rect,\n          y = 2 / a,\n          T = x - y,\n          f = d - y,\n          b = T + w.width / a,\n          u = f + w.height / a,\n          P = new m(T, f),\n          O = new m(b, u),\n          _ = new m(T, u),\n          k = new m(b, f);\n\n    if (0 !== o) {\n      const e = Math.cos(o),\n            t = Math.sin(o);\n      P.rotate(e, t), O.rotate(e, t), _.rotate(e, t), k.rotate(e, t);\n    }\n\n    const M = new I(P, k, _, O, w, o, 0, 256, t, p, i, 0);\n\n    if (e.shapes.push(M), (!s.allowOverlap || !s.ignorePlacement) && r) {\n      const n = s.size,\n            a = s.padding,\n            r = {\n        xTile: t.x,\n        yTile: t.y,\n        dxPixels: x * n - a,\n        dyPixels: d * n - a,\n        hard: !s.optional,\n        partIndex: 0,\n        width: l * n + 2 * a,\n        height: h * n + 2 * a,\n        angle: o,\n        minLod: p,\n        maxLod: i\n      };\n      e.iconColliders.push(r);\n    }\n  }\n\n  getTextPlacement(n, s, o, r) {\n    const x = new m(n.x, n.y),\n          d = r.rotate * e,\n          T = r.rotationAlignment === c.MAP,\n          u = r.keepUpright,\n          P = r.padding;\n    let O = p;\n\n    const _ = !T ? 0 : n.angle,\n          k = n.segment >= 0 && T,\n          M = r.allowOverlap && r.ignorePlacement ? null : [],\n          E = [],\n          G = 4,\n          N = !k;\n\n    let A = Number.POSITIVE_INFINITY,\n        L = Number.NEGATIVE_INFINITY,\n        z = A,\n        F = L;\n    const v = (k || T) && u,\n          R = r.size / a;\n    let B = !1;\n\n    for (const e of s) if (e.vertical) {\n      B = !0;\n      break;\n    }\n\n    let H,\n        V = 0,\n        j = 0;\n\n    if (!k && B) {\n      const e = l.getTextBox(s, r.lineHeight * a);\n\n      switch (r.anchor) {\n        case g.LEFT:\n          V = e.height / 2, j = -e.width / 2;\n          break;\n\n        case g.RIGHT:\n          V = -e.height / 2, j = e.width / 2;\n          break;\n\n        case g.TOP:\n          V = e.height / 2, j = e.width / 2;\n          break;\n\n        case g.BOTTOM:\n          V = -e.height / 2, j = -e.width / 2;\n          break;\n\n        case g.TOP_LEFT:\n          V = e.height;\n          break;\n\n        case g.BOTTOM_LEFT:\n          j = -e.width;\n          break;\n\n        case g.TOP_RIGHT:\n          j = e.width;\n          break;\n\n        case g.BOTTOM_RIGHT:\n          V = -e.height;\n      }\n    }\n\n    V += r.offset[0] * a, j += r.offset[1] * a;\n\n    for (const e of s) {\n      const s = e.glyphMosaicItem;\n      if (!s || s.rect.isEmpty) continue;\n      const a = s.rect,\n            l = s.metrics,\n            c = s.page;\n\n      if (M && N) {\n        if (void 0 !== H && H !== e.y) {\n          let e, t, s, o;\n          B ? (e = -F + V, t = A + j, s = F - z, o = L - A) : (e = A + V, t = z + j, s = L - A, o = F - z);\n          const a = {\n            xTile: n.x,\n            yTile: n.y,\n            dxPixels: e * R - P,\n            dyPixels: t * R - P,\n            hard: !r.optional,\n            partIndex: 1,\n            width: s * R + 2 * P,\n            height: o * R + 2 * P,\n            angle: d,\n            minLod: p,\n            maxLod: i\n          };\n          M.push(a), A = Number.POSITIVE_INFINITY, L = Number.NEGATIVE_INFINITY, z = A, F = L;\n        }\n\n        H = e.y;\n      }\n\n      const g = [];\n\n      if (k) {\n        const t = .5 * s.metrics.width,\n              i = (e.x + l.left - G + t) * R * w;\n        if (O = this._placeGlyph(n, O, i, o, n.segment, 1, e.vertical, c, g), u && (O = this._placeGlyph(n, O, i, o, n.segment, -1, e.vertical, c, g)), O >= y) break;\n      } else g.push(new f(x, _, _, c, !1)), T && u && g.push(new f(x, _ + t, _ + t, c, !1));\n\n      const b = e.x + l.left,\n            C = e.y - h - l.top,\n            S = b + l.width,\n            Y = C + l.height;\n      let q, U, D, J, K, Q, W, X;\n      if (!k && B) {\n        if (e.vertical) {\n          const e = (b + S) / 2 - l.height / 2,\n                t = (C + Y) / 2 + l.width / 2;\n          q = new m(-t - G + V, e - G + j), U = new m(q.x + a.width, q.y + a.height), D = new m(q.x, U.y), J = new m(U.x, q.y);\n        } else q = new m(-C + G + V, b - G + j), U = new m(q.x - a.height, q.y + a.width), D = new m(U.x, q.y), J = new m(q.x, U.y);\n      } else q = new m(b - G + V, C - G + j), U = new m(q.x + a.width, q.y + a.height), D = new m(q.x, U.y), J = new m(U.x, q.y);\n\n      for (const t of g) {\n        let i, s, o, h;\n\n        if (t.alternateVerticalGlyph) {\n          if (!K) {\n            const e = (C + Y) / 2 + j;\n            K = new m((b + S) / 2 + V - l.height / 2 - G, e + l.width / 2 + G), Q = new m(K.x + a.height, K.y - a.width), W = new m(Q.x, K.y), X = new m(K.x, Q.y);\n          }\n\n          i = K, s = W, o = X, h = Q;\n        } else i = q, s = D, o = J, h = U;\n\n        const c = C,\n              g = Y,\n              x = t.glyphAngle + d;\n\n        if (0 !== x) {\n          const e = Math.cos(x),\n                t = Math.sin(x);\n          i = i.clone(), s = s.clone(), o = o.clone(), h = h.clone(), i.rotate(e, t), h.rotate(e, t), s.rotate(e, t), o.rotate(e, t);\n        }\n\n        let w = 0,\n            p = 256;\n        if (k && B ? e.vertical ? t.alternateVerticalGlyph ? (w = 32, p = 96) : (w = 224, p = 32) : (w = 224, p = 96) : (w = 192, p = 64), E.push(new I(i, o, s, h, a, t.labelAngle, w, p, t.anchor, t.minzoom, t.maxzoom, t.page)), M && (!v || this._legible(t.labelAngle))) if (N) b < A && (A = b), c < z && (z = c), S > L && (L = S), g > F && (F = g);else if (t.minzoom < y) {\n          const e = {\n            xTile: n.x,\n            yTile: n.y,\n            dxPixels: (b + V) * R - P,\n            dyPixels: (c + V) * R - P,\n            hard: !r.optional,\n            partIndex: 1,\n            width: (S - b) * R + 2 * P,\n            height: (g - c) * R + 2 * P,\n            angle: x,\n            minLod: t.minzoom,\n            maxLod: t.maxzoom\n          };\n          M.push(e);\n        }\n      }\n    }\n\n    if (O >= y) return null;\n\n    if (M && N) {\n      let e, t, s, o;\n      B ? (e = -F + V, t = A + j, s = F - z, o = L - A) : (e = A + V, t = z + j, s = L - A, o = F - z);\n      const a = {\n        xTile: n.x,\n        yTile: n.y,\n        dxPixels: e * R - P,\n        dyPixels: t * R - P,\n        hard: !r.optional,\n        partIndex: 1,\n        width: s * R + 2 * P,\n        height: o * R + 2 * P,\n        angle: d,\n        minLod: p,\n        maxLod: i\n      };\n      M.push(a);\n    }\n\n    const C = new b(E);\n    return M && M.length > 0 && (C.textColliders = M), C;\n  }\n\n  _legible(e) {\n    const t = n(e);\n    return t < 65 || t >= 193;\n  }\n\n  _placeGlyph(e, n, a, l, h, r, c, g, x) {\n    let d = r;\n    const w = d < 0 ? s(e.angle + t, o) : e.angle;\n    let p = 0;\n    a < 0 && (d *= -1, a *= -1, p = t), d > 0 && ++h;\n    let y = new m(e.x, e.y),\n        T = l[h],\n        I = i;\n    if (l.length <= h) return I;\n\n    for (;;) {\n      const e = T.x - y.x,\n            t = T.y - y.y,\n            i = Math.sqrt(e * e + t * t),\n            r = Math.max(a / i, n),\n            m = e / i,\n            b = t / i,\n            u = s(Math.atan2(b, m) + p, o);\n      if (x.push(new f(y, w, u, g, !1, r, I)), c && x.push(new f(y, w, u, g, !0, r, I)), r <= n) return r;\n      y = T.clone();\n\n      do {\n        if (h += d, l.length <= h || h < 0) return r;\n        T = l[h];\n      } while (y.isEqual(T));\n\n      let P = T.x - y.x,\n          O = T.y - y.y;\n\n      const _ = Math.sqrt(P * P + O * O);\n\n      P *= i / _, O *= i / _, y.x -= P, y.y -= O, I = r;\n    }\n  }\n\n}\n\nexport { T as Anchor, I as PlacedSymbol, b as Placement, u as PlacementEngine, x as TILE_COORD_SIZE, w as TILE_PIXEL_RATIO, d as TILE_PIXEL_SIZE };","map":{"version":3,"sources":["D:/Github/CUSP_DataBase/CUSP_DB/src/main/gis/node_modules/@arcgis/core/views/2d/engine/vectorTiles/Placement.js"],"names":["C_DEG_TO_RAD","e","C_PI","t","C_INFINITY","i","radToByte","n","positiveMod","s","C_2PI","o","SDF_GLYPH_SIZE","a","TextShaping","l","SDF_GLYPH_BASELINE","h","DECLUTTER_TILES","r","RotationAlignment","c","SymbolAnchor","g","Point","m","x","d","w","p","y","T","constructor","angle","segment","minzoom","f","anchor","labelAngle","glyphAngle","page","alternateVerticalGlyph","maxzoom","I","tl","tr","bl","br","mosaicRect","minAngle","maxAngle","b","shapes","u","getIconPlacement","rotationAlignment","MAP","keepUpright","rotate","allowOverlap","ignorePlacement","iconColliders","_addIconPlacement","pixelRatio","width","height","offset","CENTER","LEFT","RIGHT","TOP","BOTTOM","TOP_LEFT","BOTTOM_LEFT","TOP_RIGHT","BOTTOM_RIGHT","rect","P","O","_","k","Math","cos","sin","M","push","size","padding","xTile","yTile","dxPixels","dyPixels","hard","optional","partIndex","minLod","maxLod","getTextPlacement","E","G","N","A","Number","POSITIVE_INFINITY","L","NEGATIVE_INFINITY","z","F","v","R","B","vertical","H","V","j","getTextBox","lineHeight","glyphMosaicItem","isEmpty","metrics","left","_placeGlyph","C","top","S","Y","q","U","D","J","K","Q","W","X","clone","_legible","length","textColliders","sqrt","max","atan2","isEqual","Anchor","PlacedSymbol","Placement","PlacementEngine","TILE_COORD_SIZE","TILE_PIXEL_RATIO","TILE_PIXEL_SIZE"],"mappings":"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","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport{C_DEG_TO_RAD as e,C_PI as t,C_INFINITY as i,radToByte as n,positiveMod as s,C_2PI as o}from\"./GeometryUtils.js\";import{SDF_GLYPH_SIZE as a,TextShaping as l,SDF_GLYPH_BASELINE as h}from\"./TextShaping.js\";import{DECLUTTER_TILES as r}from\"./decluttering/config.js\";import{RotationAlignment as c,SymbolAnchor as g}from\"./style/StyleDefinition.js\";import{Point as m}from\"../webgl/Geometry.js\";const x=4096,d=512,w=8,p=.5,y=2;class T{constructor(e,t,i=0,n=-1,s=p){this.x=e,this.y=t,this.angle=i,this.segment=n,this.minzoom=s}}class f{constructor(e,t,n,s,o,a=p,l=i){this.anchor=e,this.labelAngle=t,this.glyphAngle=n,this.page=s,this.alternateVerticalGlyph=o,this.minzoom=a,this.maxzoom=l}}class I{constructor(e,t,i,n,s,o,a,l,h,r,c,g){this.tl=e,this.tr=t,this.bl=i,this.br=n,this.mosaicRect=s,this.labelAngle=o,this.minAngle=a,this.maxAngle=l,this.anchor=h,this.minzoom=r,this.maxzoom=c,this.page=g}}class b{constructor(e){this.shapes=e}}class u{getIconPlacement(i,n,s){const o=new m(i.x,i.y),a=s.rotationAlignment===c.MAP,l=s.keepUpright;let h=s.rotate*e;a&&(h+=i.angle);const g=new b([]);return s.allowOverlap&&s.ignorePlacement||!r||(g.iconColliders=[]),this._addIconPlacement(g,o,n,s,h),a&&l&&this._addIconPlacement(g,o,n,s,h+t),g}_addIconPlacement(e,t,n,s,o){const a=n.pixelRatio,l=n.width/a,h=n.height/a,c=s.offset;let x=c[0],d=c[1];switch(s.anchor){case g.CENTER:x-=l/2,d-=h/2;break;case g.LEFT:d-=h/2;break;case g.RIGHT:x-=l,d-=h/2;break;case g.TOP:x-=l/2;break;case g.BOTTOM:x-=l/2,d-=h;break;case g.TOP_LEFT:break;case g.BOTTOM_LEFT:d-=h;break;case g.TOP_RIGHT:x-=l;break;case g.BOTTOM_RIGHT:x-=l,d-=h}const w=n.rect,y=2/a,T=x-y,f=d-y,b=T+w.width/a,u=f+w.height/a,P=new m(T,f),O=new m(b,u),_=new m(T,u),k=new m(b,f);if(0!==o){const e=Math.cos(o),t=Math.sin(o);P.rotate(e,t),O.rotate(e,t),_.rotate(e,t),k.rotate(e,t)}const M=new I(P,k,_,O,w,o,0,256,t,p,i,0);if(e.shapes.push(M),(!s.allowOverlap||!s.ignorePlacement)&&r){const n=s.size,a=s.padding,r={xTile:t.x,yTile:t.y,dxPixels:x*n-a,dyPixels:d*n-a,hard:!s.optional,partIndex:0,width:l*n+2*a,height:h*n+2*a,angle:o,minLod:p,maxLod:i};e.iconColliders.push(r)}}getTextPlacement(n,s,o,r){const x=new m(n.x,n.y),d=r.rotate*e,T=r.rotationAlignment===c.MAP,u=r.keepUpright,P=r.padding;let O=p;const _=!T?0:n.angle,k=n.segment>=0&&T,M=r.allowOverlap&&r.ignorePlacement?null:[],E=[],G=4,N=!k;let A=Number.POSITIVE_INFINITY,L=Number.NEGATIVE_INFINITY,z=A,F=L;const v=(k||T)&&u,R=r.size/a;let B=!1;for(const e of s)if(e.vertical){B=!0;break}let H,V=0,j=0;if(!k&&B){const e=l.getTextBox(s,r.lineHeight*a);switch(r.anchor){case g.LEFT:V=e.height/2,j=-e.width/2;break;case g.RIGHT:V=-e.height/2,j=e.width/2;break;case g.TOP:V=e.height/2,j=e.width/2;break;case g.BOTTOM:V=-e.height/2,j=-e.width/2;break;case g.TOP_LEFT:V=e.height;break;case g.BOTTOM_LEFT:j=-e.width;break;case g.TOP_RIGHT:j=e.width;break;case g.BOTTOM_RIGHT:V=-e.height}}V+=r.offset[0]*a,j+=r.offset[1]*a;for(const e of s){const s=e.glyphMosaicItem;if(!s||s.rect.isEmpty)continue;const a=s.rect,l=s.metrics,c=s.page;if(M&&N){if(void 0!==H&&H!==e.y){let e,t,s,o;B?(e=-F+V,t=A+j,s=F-z,o=L-A):(e=A+V,t=z+j,s=L-A,o=F-z);const a={xTile:n.x,yTile:n.y,dxPixels:e*R-P,dyPixels:t*R-P,hard:!r.optional,partIndex:1,width:s*R+2*P,height:o*R+2*P,angle:d,minLod:p,maxLod:i};M.push(a),A=Number.POSITIVE_INFINITY,L=Number.NEGATIVE_INFINITY,z=A,F=L}H=e.y}const g=[];if(k){const t=.5*s.metrics.width,i=(e.x+l.left-G+t)*R*w;if(O=this._placeGlyph(n,O,i,o,n.segment,1,e.vertical,c,g),u&&(O=this._placeGlyph(n,O,i,o,n.segment,-1,e.vertical,c,g)),O>=y)break}else g.push(new f(x,_,_,c,!1)),T&&u&&g.push(new f(x,_+t,_+t,c,!1));const b=e.x+l.left,C=e.y-h-l.top,S=b+l.width,Y=C+l.height;let q,U,D,J,K,Q,W,X;if(!k&&B)if(e.vertical){const e=(b+S)/2-l.height/2,t=(C+Y)/2+l.width/2;q=new m(-t-G+V,e-G+j),U=new m(q.x+a.width,q.y+a.height),D=new m(q.x,U.y),J=new m(U.x,q.y)}else q=new m(-C+G+V,b-G+j),U=new m(q.x-a.height,q.y+a.width),D=new m(U.x,q.y),J=new m(q.x,U.y);else q=new m(b-G+V,C-G+j),U=new m(q.x+a.width,q.y+a.height),D=new m(q.x,U.y),J=new m(U.x,q.y);for(const t of g){let i,s,o,h;if(t.alternateVerticalGlyph){if(!K){const e=(C+Y)/2+j;K=new m((b+S)/2+V-l.height/2-G,e+l.width/2+G),Q=new m(K.x+a.height,K.y-a.width),W=new m(Q.x,K.y),X=new m(K.x,Q.y)}i=K,s=W,o=X,h=Q}else i=q,s=D,o=J,h=U;const c=C,g=Y,x=t.glyphAngle+d;if(0!==x){const e=Math.cos(x),t=Math.sin(x);i=i.clone(),s=s.clone(),o=o.clone(),h=h.clone(),i.rotate(e,t),h.rotate(e,t),s.rotate(e,t),o.rotate(e,t)}let w=0,p=256;if(k&&B?e.vertical?t.alternateVerticalGlyph?(w=32,p=96):(w=224,p=32):(w=224,p=96):(w=192,p=64),E.push(new I(i,o,s,h,a,t.labelAngle,w,p,t.anchor,t.minzoom,t.maxzoom,t.page)),M&&(!v||this._legible(t.labelAngle)))if(N)b<A&&(A=b),c<z&&(z=c),S>L&&(L=S),g>F&&(F=g);else if(t.minzoom<y){const e={xTile:n.x,yTile:n.y,dxPixels:(b+V)*R-P,dyPixels:(c+V)*R-P,hard:!r.optional,partIndex:1,width:(S-b)*R+2*P,height:(g-c)*R+2*P,angle:x,minLod:t.minzoom,maxLod:t.maxzoom};M.push(e)}}}if(O>=y)return null;if(M&&N){let e,t,s,o;B?(e=-F+V,t=A+j,s=F-z,o=L-A):(e=A+V,t=z+j,s=L-A,o=F-z);const a={xTile:n.x,yTile:n.y,dxPixels:e*R-P,dyPixels:t*R-P,hard:!r.optional,partIndex:1,width:s*R+2*P,height:o*R+2*P,angle:d,minLod:p,maxLod:i};M.push(a)}const C=new b(E);return M&&M.length>0&&(C.textColliders=M),C}_legible(e){const t=n(e);return t<65||t>=193}_placeGlyph(e,n,a,l,h,r,c,g,x){let d=r;const w=d<0?s(e.angle+t,o):e.angle;let p=0;a<0&&(d*=-1,a*=-1,p=t),d>0&&++h;let y=new m(e.x,e.y),T=l[h],I=i;if(l.length<=h)return I;for(;;){const e=T.x-y.x,t=T.y-y.y,i=Math.sqrt(e*e+t*t),r=Math.max(a/i,n),m=e/i,b=t/i,u=s(Math.atan2(b,m)+p,o);if(x.push(new f(y,w,u,g,!1,r,I)),c&&x.push(new f(y,w,u,g,!0,r,I)),r<=n)return r;y=T.clone();do{if(h+=d,l.length<=h||h<0)return r;T=l[h]}while(y.isEqual(T));let P=T.x-y.x,O=T.y-y.y;const _=Math.sqrt(P*P+O*O);P*=i/_,O*=i/_,y.x-=P,y.y-=O,I=r}}}export{T as Anchor,I as PlacedSymbol,b as Placement,u as PlacementEngine,x as TILE_COORD_SIZE,w as TILE_PIXEL_RATIO,d as TILE_PIXEL_SIZE};\n"]},"metadata":{},"sourceType":"module"}